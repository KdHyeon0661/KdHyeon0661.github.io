---
layout: post
title: 이산수학 - 순열과 조합
date: 2025-06-08 20:20:23 +0900
category: 이산수학
---
# 🔢 순열과 조합 (Permutation & Combination)

## 0. 한눈에 보는 치트시트

- **순열**(순서 O):  
  $$P(n,r)=n(n-1)\cdots(n-r+1)=\frac{n!}{(n-r)!}$$
- **조합**(순서 X):  
  $$C(n,r)=\binom{n}{r}=\frac{n!}{r!(n-r)!}=\frac{P(n,r)}{r!}$$
- **원형 순열**(회전 동일):  
  $$\text{원탁 좌석 }n\text{명}:\ (n-1)!$$
- **중복 순열**(중복 허용, 길이 r):  
  $$n^r$$
- **중복 조합**(중복 허용, 총 r개 선택):  
  $$\binom{n+r-1}{r}$$
- **다중집합(중복 원소) 순열**:  
  $$\frac{n!}{a_1!\,a_2!\cdots a_m!}\quad(\sum a_i=n)$$
- **전부 나열**: $$n!$$, **경계**: $$0!=1,\ \binom{n}{0}=\binom{n}{n}=1$$
- **자주 쓰는 항등식**:  
  파스칼 $$\binom{n}{r}=\binom{n-1}{r}+\binom{n-1}{r-1}$$  
  합 $$\sum_{r=0}^n\binom{n}{r}=2^n$$  
  반더몬드 $$\displaystyle \sum_k \binom{m}{k}\binom{n}{r-k}=\binom{m+n}{r}$$
- **금지 인접/고정점 없음(변형)**: 포함배제, 데랑주망 $$!n=(n-1)(!(n-1)+!(n-2))$$

---

## 1. 기본 개념: “순서가 중요하면 순열, 아니면 조합”

### 정의
- **순열**: 서로 다른 $$n$$개 중 $$r$$개를 **순서 있게** 배열  
  $$P(n,r)=\frac{n!}{(n-r)!}$$
- **조합**: 서로 다른 $$n$$개 중 $$r$$개를 **순서 없이** 선택  
  $$\binom{n}{r}=\frac{n!}{r!(n-r)!}$$

### 예시 비교
- “5명 중 3명 **줄 세우기**” → $$P(5,3)=60$$  
- “5명 중 3명 **팀 구성**(순서X)” → $$\binom{5}{3}=10$$

---

## 2. 순열 심화: 전순열, 원형, 중복, 다중집합

### 2.1 전순열
$$n! = n\cdot(n-1)\cdots 1$$  
예) 5명 모두 줄 세우기: $$5!=120$$

### 2.2 원형 순열 (원탁 좌석)
회전만 다르면 동일.  
- 구분점 없음(순수 원탁): $$(n-1)!$$  
- **호스트 고정 좌석**(머리맡 표식이 있음): $$n!$$  
- 원이 아니라 **목걸이/팔찌(뒤집기 동일)**면 $$\frac{(n-1)!}{2}$$ (대칭 고려, 단 예외 케이스 주의)

**예시**: 6명 원탁 식사 좌석 배치 수 = $$(6-1)! = 120$$

### 2.3 중복 순열 (같은 항목을 여러 번 선택, 길이 r)
$$n^r$$  
예) 10개의 숫자(0–9)로 길이 4 비밀번호: $$10^4=10000$$

### 2.4 다중집합 순열(동일 문자 반복)
문자 총합 $$n$$, 같은 문자의 개수가 $$a_1,\dots,a_m$$ 일 때
$$
\frac{n!}{a_1!\,a_2!\cdots a_m!}.
$$
예) “BANANA”(A×3, N×2, B×1): $$\frac{6!}{3!\,2!\,1!}=60$$

---

## 3. 조합 심화: 중복 조합(Stars and Bars), 분할, 역할 포함

### 3.1 중복 조합 (Stars and Bars)
“같은 종류 물건을 **중복 선택**해 총 $$r$$개”  
$$
\binom{n+r-1}{r}.
$$
**예시**: 3종 사탕에서 4개 고르기 → $$\binom{3+4-1}{4}=\binom{6}{4}=15$$  
**상황**: 재고 충분, 순서 무관, 동일 품목 중복 허용.

### 3.2 사람 뽑고 **직책**을 정하면?
“먼저 조합, 그다음 직책 순열”  
$$\binom{n}{r}\cdot r!=P(n,r).$$

**예시(상황)**: 10명 중 3명 위원 선발 후(순서X), **위원장/간사/서기** 배정(순서O)  
→ $$\binom{10}{3}\cdot 3!=P(10,3)=720$$

---

## 4. 제약 있는 순열/조합: 포함배제, 데랑주망, 금지 인접

### 4.1 포함배제 기본형
상자/조건을 $$A_i$$ 라 하고
$$
|\overline{A_1\cup\cdots\cup A_m}|
=\sum \binom{}{} - \sum \binom{}{} + \sum \binom{}{} - \cdots
$$
(조건을 만족하지 않는 수를 빼고 더하고… 반복)

### 4.2 데랑주망(고정점 없는 순열, “제자리 금지”)
$$
!n=(n-1)\big(!(n-1)+!(n-2)\big),\quad !0=1,\ !1=0.
$$
근사: $$!n \approx \frac{n!}{e}$$ (정확히는 가장 가까운 정수)

**예시**: 편지-봉투 잘못 넣기(아무도 자기 편지 못 받게) 경우의 수 $$=!n$$

### 4.3 인접 금지(예: ‘AA’ 붙지 않게)
- **라인 채우기 기법**: 먼저 B를 배치한 후 A를 끼워 넣을 수 있는 칸 수를 계산.  
예) A 3개, B 4개, ‘AA’ 금지 → B를 줄 세워 **빈칸 5개**(앞·사이·뒤). 이 빈칸에 A를 중복 없이 1개씩 넣어야 하면 조합 등으로 계산.  
- 보다 일반적이면 **포함배제**로 처리.

---

## 5. 조합 항등식과 “조합적 증명”

### 5.1 파스칼 항등식
$$
\binom{n}{r}=\binom{n-1}{r}+\binom{n-1}{r-1}.
$$
**조합적 해석**: $$n$$명 중 $$r$$명 선택. 한 사람 X를 **포함**하거나(오른쪽 항 둘째) **제외**(첫째).

### 5.2 합 공식
$$
\sum_{r=0}^{n}\binom{n}{r}=2^n.
$$
**의미**: $$n$$개 원소 부분집합의 총수.

### 5.3 호키스틱(빙산) 항등식
$$
\sum_{k=r}^{n}\binom{k}{r}=\binom{n+1}{r+1}.
$$
**해석**: “맨 마지막로 선택된 사람” 기준으로 누적.

### 5.4 반더몬드 항등식
$$
\sum_{k}\binom{m}{k}\binom{n}{r-k}=\binom{m+n}{r}.
$$
**해석**: 두 집합에서 합쳐서 $$r$$명 뽑기(케이스 나누기 = 직접 뽑기).

### 5.5 이항정리
$$
(x+y)^n=\sum_{r=0}^{n}\binom{n}{r}x^{n-r}y^r.
$$
**해석**: 각 항에서 $$y$$를 몇 번 선택하는가 = 조합.

---

## 6. 실제 모델링 패턴

### 6.1 좌석·이웃 제약
- “원탁에서 특정 두 사람이 **붙어 앉지 않게**”: 전체 원형 $$(n-1)!$$ 에서 **붙어 앉는 경우**(두 사람을 하나로 묶어 원형 배치) 빼기.

### 6.2 팀·직책·분과배정
- “12명에서 3팀(4,4,4)으로 나누기, 팀간 순서 무의미”:  
  $$\frac{12!}{(4!)^3\cdot 3!}$$ (다중집합 분할 + 팀 라벨 제거)

### 6.3 물건 분배(상자에 공 나누기)
- 구별되는 상자, **중복 허용**: 중복조합  
- 구별되는 상자, **최소 1개 이상**: **별과 막대**에서 **각 상자 1개 미리 배분** 후 나머지 중복조합  
- 상자가 **구별되지 않으면** 정수분할 문제가 되어 다른 기법이 필요(여기서는 생략)

### 6.4 샘플링/검정 배경
- 복원추출(독립) → **중복 순열**  
- 비복원추출(종속) → **조합/하이퍼지오메트릭** 기반

---

## 7. 경계·함정 체크리스트

- $$0! = 1,\ \binom{n}{0}=\binom{n}{n}=1$$ (경계값 필수)  
- $$\binom{n}{r}=0\ (r<0\ \text{또는}\ r>n)$$  
- **원형**과 **목걸이/팔찌(뒤집기 동일)** 혼동 금지  
- “먼저 뽑고 직책 부여” vs “바로 줄 세우기”: $$\binom{n}{r}\cdot r!=P(n,r)$$  
- **서로 다른가? 동일한가?**(다중집합/중복 여부)부터 판단  
- **독립**인지 **종속**인지(복원/비복원) 먼저 결정

---

## 8. Python 실습

> 표준 라이브러리로 정확 계산을 권장합니다. (파이썬은 큰 정수 자동 지원)

### 8.1 팩토리얼, 순열, 조합(정확)
```python
import math
from itertools import permutations, combinations

# 기본 수치
def P(n, r):
    return math.perm(n, r)  # Python 3.8+: math.perm
def C(n, r):
    return math.comb(n, r)  # Python 3.8+: math.comb

print("P(5,3) =", P(5,3))      # 60
print("C(5,3) =", C(5,3))      # 10
print("factorial(6) =", math.factorial(6))  # 720

# 실제 나열: 5명 중 3명 줄 세우기
people = ['A','B','C','D','E']
print("실제 순열 개수 =", len(list(permutations(people, 3))))  # 60
```

### 8.2 중복 조합(Stars and Bars) 도우미
```python
import math

def multiset_comb(n_types, r_total):
    # n_types 종류에서 중복 허용 총 r_total 선택
    return math.comb(n_types + r_total - 1, r_total)

print(multiset_comb(3, 4))  # 15
```

### 8.3 다중집합 순열
```python
import math
from collections import Counter

def multiset_perm_count(seq):
    c = Counter(seq)
    n = sum(c.values())
    denom = 1
    for a in c.values():
        denom *= math.factorial(a)
    return math.factorial(n) // denom

print(multiset_perm_count("BANANA"))  # 60
```

### 8.4 데랑주망 계산 (재귀/DP)
```python
import functools, math

@functools.lru_cache(None)
def derangement(n):
    if n == 0: return 1
    if n == 1: return 0
    return (n-1)*(derangement(n-1)+derangement(n-2))

for n in range(1,8):
    print(n, derangement(n), "≈", round(math.factorial(n)/math.e))
```

### 8.5 모듈러 조합 (큰 수, 소수 MOD)
```python
MOD = 10**9+7

def modinv(a, mod=MOD):
    return pow(a, mod-2, mod)  # 페르마 소정리 (mod가 소수)

def build_fact(n, mod=MOD):
    fact = [1]*(n+1)
    invf = [1]*(n+1)
    for i in range(1, n+1):
        fact[i] = fact[i-1]*i % mod
    invf[n] = modinv(fact[n], mod)
    for i in range(n, 0, -1):
        invf[i-1] = invf[i]*i % mod
    return fact, invf

def nCr_mod(n, r, fact, invf, mod=MOD):
    if r<0 or r>n: return 0
    return fact[n]*invf[r]%mod*invf[n-r]%mod

fact, invf = build_fact(1_000_000)
print(nCr_mod(1_000_000, 500_000, fact, invf))  # 거대 조합 mod 값
```

### 8.6 원형 좌석 계산기(간단)
```python
import math

def circular_seating(n, host_fixed=False):
    if n<=0: return 0
    return math.factorial(n) if host_fixed else math.factorial(n-1)

print(circular_seating(6))           # (6-1)! = 120
print(circular_seating(6, True))     # 6!      = 720
```

### 8.7 포함배제 예시(‘AA’ 금지 단순형, 검증용 완전탐색)
```python
from itertools import product

def count_no_adjacent_A(num_A, num_B):
    # 완전탐색으로 검증 (작은 값용)
    s = 'A'*num_A + 'B'*num_B
    # 중복 원소라 product 대신 조합/다중집합 순열 생성기가 필요하지만
    # 여기서는 길이가 작을 때 0/1 마스크로 전수조사
    n = num_A + num_B
    ans = 0
    for mask in range(1<<n):
        if bin(mask).count('1') != num_A: 
            continue
        arr = []
        for i in range(n):
            arr.append('A' if (mask>>i)&1 else 'B')
        ok = True
        for i in range(n-1):
            if arr[i]=='A' and arr[i+1]=='A':
                ok = False; break
        ans += ok
    return ans

print(count_no_adjacent_A(3,4))  # 검증용(작은 n)
```

---

## 9. 실전 예제 모음 (상황 → 해법)

### 예제 A: **좌석 배치** — 8명 원탁, 두 사람은 이웃 금지
1) 전체: $$(8-1)! = 5040$$  
2) 붙어 앉는 경우: 두 사람을 **하나의 묶음**으로 → 묶음 + 나머지 6명 = 총 7개 대상의 원형: $$(7-1)!=720$$  
   묶음 내부 자리 바꿈 2가지 → $$720\cdot 2=1440$$  
3) 결과: $$5040-1440=3600$$

### 예제 B: **위원 선발+직책** — 12명에서 4명 선발 후 회장·부회장·총무·서기
$$\binom{12}{4}\cdot 4! = P(12,4) = \frac{12!}{8!} = 11880.$$

### 예제 C: **사탕 배분** — 5종 사탕에서 9개(중복 허용, 순서X)
$$\binom{5+9-1}{9}=\binom{13}{9}=715.$$

### 예제 D: **다중집합 단어 수** — “MISSISSIPPI”
문자수 11, M×1, I×4, S×4, P×2
$$
\frac{11!}{1!\,4!\,4!\,2!}= \frac{39916800}{(24\cdot24\cdot2)}=34650.
$$

### 예제 E: **팀 나누기** — 9명 → 3팀(각 3명), 팀 레이블 없음
$$
\frac{9!}{(3!)^3\cdot 3!}=\frac{362880}{(6\cdot6\cdot6\cdot6)}=280.
$$

### 예제 F: **데랑주망** — 6명 편지 잘못배달
$$!6 = 265\quad (\text{재귀/근사로 검증 가능})$$

### 예제 G: **숫자 비밀번호** — 0–9로 길이 6, 같은 숫자 연속 금지?
- 전체: $$10^6$$  
- 인접 금지 카운트: 첫 자리 10, 이후 각 자리 9가지 → $$10\cdot 9^5$$

---

## 10. 근사·수치 안정: 큰 수 다루기

- 스털링 근사:  
  $$n!\approx \sqrt{2\pi n}\left(\frac{n}{e}\right)^n$$  
  로그 스케일에서  
  $$\log n! \approx n\log n - n + \tfrac12 \log(2\pi n).$$
- 큰 조합의 자릿수/크기 비교 → **로그 팩토리얼**로 계산.  
- 모듈러(소수)면 **팩토리얼 전처리 + 페르마 역원**으로 $$\binom{n}{r}\bmod p$$ 안정 계산.

---

## 11. 연습문제(미니 해설)

1) **기본**: 7명 중 3명 팀 구성?  
   $$\binom{7}{3}=35.$$

2) **역할 포함**: 7명 중 선발 3명에게 A/B/C 역할?  
   $$P(7,3)=7\cdot6\cdot5=210.$$

3) **원형**: 10명 원탁 좌석 수?  
   $$(10-1)! = 362880.$$

4) **중복 조합**: 4종 음료를 7잔 주문(동일 잔 허용)?  
   $$\binom{4+7-1}{7}=\binom{10}{7}=120.$$

5) **다중집합**: “BALLOON”(B×1,A×1,L×2,O×2,N×1)  
   $$\frac{7!}{2!\,2!}=1260.$$

6) **붙어앉지 않기**: A×3, B×4, ‘AA’ 금지 문자열 수?  
   B를 4개 배치 → 빈칸 5개, A를 3개 **서로 다른 빈칸**에 넣기:  
   $$\binom{5}{3}=10.$$

7) **데랑주망**: !5?  
   재귀로 $$!5=44.$$

---

## 12. 자주 묻는 질문(FAQ)

- **Q. $$\binom{n}{r}=\binom{n}{n-r}$$ 왜?**  
  **포함/미포함** 관점: $$r$$명 고르기 = **버릴** $$(n-r)$$명 고르기.

- **Q. 원탁과 목걸이 차이?**  
  원탁은 **회전만** 동일, 목걸이는 **회전+뒤집기** 동일(대칭군이 큼).

- **Q. 중복 조합에서 “순서”가 왜 사라지나요?**  
  별과 막대 모형은 **분리선의 위치**만 결정 → 집합 선택과 동일한 조합 수.

---

## 13. 요약

- “순서가 중요하면 **순열**”, “중요하지 않으면 **조합**”.
- **변형**: 원형/중복/다중집합/중복조합은 **상황을 기하·대칭·막대모형**으로 환원.
- **제약**: 금지 인접·고정점 없음은 **포함배제/데랑주망**으로.
- **정리**: 파스칼·호키스틱·반더몬드·이항정리로 **복잡식을 쪼개고 합친다**.
- **코드**: `math.comb/perm`, 전처리 팩토리얼, 포함배제·DP로 **정확하고 빠르게**.