---
layout: post
title: 정보보안기사 - 가상 사설망
date: 2025-11-12 09:25:23 +0900
category: 정보보안기사
---
# SECTION 05 네트워크 보안 프로토콜 — 01. 가상 사설망(VPN: Virtual Private Network)

## VPN 개념과 분류 — 어디에서 무엇을 “싸고” “인증”하는가
### 계층별 분류

| 계층 | 대표 | 특징/장점 | 유의점 |
|---|---|---|---|
| **L3(IP 계층)** | **IPsec/ESP + IKEv2** | 표준화·상호운용, 네이티브 라우팅, **사이트간** 탁월 | 설정 난이도↑, NAT·모빌리티 고려 필요  |
| **L4.5(UDP 기반 자체 프로토콜)** | **WireGuard** | 단순 구성, 고성능(커널), 최신 암호군/키교환 | 정책 세분화·엔터프라이즈 통합은 추가 설계 필요  |
| **L5/6/7(세션/표현/응용)** | **SSL/TLS VPN(OpenVPN, DTLS 1.3)** | 방화벽/NAT 친화(단일 포트), 포털·디바이스 검증 용이 | 애플리케이션 종속 구성 발생, TCP-over-TCP 주의  |

### 용도별 패턴

- **원격접속(VPN Client ↔ GW)**: 재택/모바일, **MFA/RADIUS/IdP** 연동, 분할/전구간 터널 선택.
- **사이트간(Site-to-Site)**: 지사↔본사, VPC↔온프레미스, **라우팅 통합**(BGP/OSPF).
- **클라우드 경계**: CSP 제공 IPsec/SSL 게이트웨이, **Transit VPC/VNet**.

---

## IPsec/IKEv2 핵심 — “무엇을 어떻게 보호하나”
### IPsec 아키텍처와 ESP

- **IPsec 아키텍처(RFC 4301)**: IP 계층에서 **기밀성·무결성·인증·재전송방지** 제공. **전송/터널 모드**, **SA(Security Association)**, SPD/SAD 모델 규정.
- **ESP(RFC 4303)**: 암호화(예: AES-GCM) + 무결성(TAG) + **Anti-Replay**(시퀀스 번호) 제공. **NAT-T**(UDP 4500)와 함께 운용 가능.

### 키교환: IKEv2

- **IKEv2(RFC 7296)**: 상호 인증(증명서/EAP), SA 생성·갱신, DDoS 저항(쿠키), 재키잉 규칙. **Internet Standard**.
- **MOBIKE(RFC 4555)**: 클라이언트 IP 변경 시 **세션 유지**(Wi-Fi↔LTE 핸드오버 등). 모바일/다중회선 필수 기능. 단, 일부 벤더는 ‘엔드포인트/클라이언트만’ 지원 등 차이가 있으니 확인.

### 표준 가이드

- **NIST SP 800-77r1**: IPsec VPN 설계·암호 스위트·운영 지침 총괄.

---

## SSL/TLS 기반 VPN(“SSL VPN”) — OpenVPN·DTLS 1.3

- **OpenVPN**: **TLS 제어 채널**(인증·키교환)과 **데이터 채널**(AEAD) 분리. 최근엔 **AES-GCM/ChaCha20-Poly1305** 선호, **data-ciphers**로 협상. UDP 1194(기본), TCP 사용 시 TCP-over-TCP 성능 저하 고려.
- **DTLS 1.3(RFC 9147)**: UDP 상에서 TLS1.3 동등 보안, 지연·손실 환경에서 효율적. 일부 SSL VPN 게이트웨이/리버스 프록시가 채택.
- **TLS 구성 가이드**: **TLS 1.2(안전구성) 최소, TLS 1.3 권장**. NIST SP 800-52r2 참고.

---

## WireGuard — “단순·현대적” 커널 터널

- **디자인**: **Noise 기반 핸드셰이크**, **Curve25519·ChaCha20-Poly1305·BLAKE2·HKDF** 등 현대 암호. 인터페이스는 `wg0` 등 **L3 터널**, 정책은 “AllowedIPs=라우팅+ACL”의 합성.
- **운영 감각**: 구성 파일 1~2개, 키쌍/피어 교환만으로 단시간 배포. 모바일·NAT 환경에서 **PersistentKeepalive**로 NAT 홀 유지.

---

## MTU/오버헤드 직관 — 왜 “1420/1380” 같은 숫자가 나오나
### 대략적 오버헤드(IPv4, NAT-T 가정)

- **IPsec(ESP-AES-GCM, 터널, NAT-T)**:
  외부 IP(20) + UDP(8) + ESP 헤더(8: SPI+SEQ) + **IV(8)** + 트레일러(2: PadLen+NextHdr) + 태그(**16**) + 패딩(0~15)
  → **대략 62~80B** 오버헤드. 실제 MTU 1500이면 **유효 페이로드 ≈ 1420~1438B**.
- **WireGuard(UDP)**: IP(20) + UDP(8) + WG 헤더/노스/태그(대략 32~40B) → **약 60~70B**. 실무에선 **MTU 1420** 권고가 흔하다.
- **OpenVPN(UDP, AEAD)**: IP+UDP(28) + OpenVPN 데이터헤더/태그(가변, 보통 30~40B) → **약 60~80B**.

> **공식 수치가 아니라 운영 감각치**다. 정확 MTU는 장비·암호군·옵션(ESN, DF, TCP/UDP)에 좌우되므로 **PMTUD**와 **MSS 클램핑**으로 검증할 것.

### 간단 공식

- 링크 MTU를 \(M\), 터널 오버헤드를 \(O\)라 할 때 **유효 페이로드**는
  $$ \text{Payload}_{\max} = M - O. $$
- TCP의 경우 세그먼트 크기 \(MSS\)를 **자동/정책**으로
  $$ MSS = \text{Payload}_{\max} - 20(\text{TCP}) - 20(\text{IP}) \quad(\text{IPv4 기준}). $$

---

## 설계 원칙 — 보안·운영·성능 균형

1) **암호군**: AEAD(예: **AES-GCM/ChaCha20-Poly1305**) 우선.
2) **인증**: 원격접속은 **사용자+기기** 2요소(MFA), 사이트간은 **서버 인증서/PSK** 병행 가능하되 **PSK 길이/엔트로피** 충분.
3) **키 수명**: IKE SA/Child SA 수명(예: 8h/1h)을 짧게 가져가 **Perfect Forward Secrecy**(ECDHE) 보장.
4) **분할 터널**: 최소권한 원칙으로 **업무 도메인만** 라우팅, 나머지 로컬브레이크아웃.
5) **DNS/라우팅**: 내부 도메인은 내부 DNS로, **DNS 유출 방지**(강제 내부 DNS).
6) **가용성**: 게이트웨이 이중화(HA)·모바일 핸드오버(**MOBIKE**)·헬스체크.

---

## 배포 시나리오 & 구성 예제

### 원격접속 — IKEv2(EAP-TLS) with strongSwan

**(A) 게이트웨이: strongSwan)**
`/etc/ipsec.conf`
```conf
config setup
  uniqueids=never

conn ikev2-eap-tls
  keyexchange=ikev2
  auto=add
  ike=aes256gcm16-prfsha384-ecp256!
  esp=aes256gcm16-ecp256!
  left=%any
  leftid=vpn.corp.example
  leftauth=pubkey
  leftcert=/etc/ipsec.d/certs/gw.crt
  leftsubnet=0.0.0.0/0
  right=%any
  rightid=%any
  rightauth=eap-tls
  rightsendcert=never
  eap_identity=%identity
  dpdaction=clear
  fragmentation=yes
  mobike=yes
  rekey=yes
  ikelifetime=8h
  lifetime=1h
```

`/etc/ipsec.secrets`
```conf
: RSA /etc/ipsec.d/private/gw.key
```

**(B) RADIUS/IdP(MFA) 연계**: EAP-TLS 또는 EAP-TTLS(점진 전환).
**(C) 방화벽**: UDP/500(IKE), UDP/4500(NAT-T) 허용.
**표준 참고**: IKEv2/ESP, MOBIKE.

---

### 원격접속 — WireGuard(wg-quick)

**서버: `/etc/wireguard/wg0.conf`**
```ini
[Interface]
Address = 10.20.0.1/24
ListenPort = 51820
PrivateKey = <SERVER_PRIVATE_KEY>
MTU = 1420
PostUp = iptables -t nat -A POSTROUTING -s 10.20.0.0/24 -o eth0 -j MASQUERADE
PostDown = iptables -t nat -D POSTROUTING -s 10.20.0.0/24 -o eth0 -j MASQUERADE

[Peer]
# Alice

PublicKey = <ALICE_PUBLIC_KEY>
AllowedIPs = 10.20.0.10/32
PersistentKeepalive = 25
```

**클라이언트:**
```ini
[Interface]
Address = 10.20.0.10/32
PrivateKey = <ALICE_PRIVATE_KEY>
DNS = 10.20.0.53

[Peer]
PublicKey = <SERVER_PUBLIC_KEY>
AllowedIPs = 10.20.0.0/24, 10.10.0.0/16   # 분할터널 예시
Endpoint = vpn.corp.example:51820
PersistentKeepalive = 25
```

> 암호·설계 배경: Noise/Curve25519/ChaCha20-Poly1305/HKDF. 가볍고 빠르며 구성 단순.

---

### 원격접속 — OpenVPN(UDP, TLS 1.3 우선)

**서버: `server.conf`**
```conf
port 1194
proto udp
dev tun
topology subnet
server 10.60.0.0 255.255.255.0

# TLS

tls-version-min 1.2
tls-cipher TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
remote-cert-tls client

# 데이터 채널(AEAD 협상)

data-ciphers AES-256-GCM:CHACHA20-POLY1305:AES-128-GCM
data-ciphers-fallback AES-256-GCM

# 인증서/키

ca ca.crt
cert server.crt
key server.key
dh none

# 클라이언트 푸시

push "redirect-gateway def1"
push "dhcp-option DNS 10.60.0.53"

# 보안/운영

user nobody
group nogroup
persist-key
persist-tun
explicit-exit-notify
```

**클라이언트: `client.ovpn`**
```conf
client
dev tun
proto udp
remote vpn.corp.example 1194
remote-cert-tls server
auth-nocache

# 데이터 채널 협상

data-ciphers AES-256-GCM:CHACHA20-POLY1305:AES-128-GCM
```

> OpenVPN은 **TLS 제어 채널 + 데이터 채널** 구조, 최신은 **AEAD(GCM/ChaCha20)** 사용 권장. DTLS 1.3 환경도 존재.

---

### 사이트간(Site-to-Site) — Cisco IOS(IPsec/IKEv2)

```ios
crypto ikev2 proposal PROP1
 encryption aes-gcm-256
 prf sha384
 group 19          ! ECP256

crypto ikev2 policy POL1
 proposal PROP1

crypto ikev2 keyring KR1
 peer PEER1
  address 203.0.113.2
  pre-shared-key local <LONG_RANDOM>
  pre-shared-key remote <LONG_RANDOM>

crypto ikev2 profile PROF1
 match identity remote address 203.0.113.2 255.255.255.255
 authentication remote pre-share
 authentication local pre-share
 keyring local KR1
 dpd 10 3 on-demand
 mobike

crypto ipsec transform-set TS1 esp-gcm 256
 mode tunnel

crypto ipsec profile IPSEC1
 set transform-set TS1

interface Tunnel10
 ip address 10.100.0.1 255.255.255.252
 tunnel source GigabitEthernet0/0
 tunnel destination 203.0.113.2
 tunnel protection ipsec profile IPSEC1
```
> 실제 명령은 IOS-XE 릴리스/플랫폼에 따라 상이. **MOBIKE** 지원 여부 벤더별 상이하니 데이터시트 확인.

---

### Windows 원격접속 — PowerShell로 IKEv2 프로파일

```powershell
# 관리자 PowerShell

$Server = "vpn.corp.example"
Add-VpnConnection -Name "CORP-IKEv2" -ServerAddress $Server `
  -TunnelType IKEv2 -EncryptionLevel Required -AuthenticationMethod Eap `
  -SplitTunneling `
  -AllUserConnection -Force

# (선택) 내부 도메인만 분할 터널 라우팅 예시

Add-VpnConnectionRoute -ConnectionName "CORP-IKEv2" -DestinationPrefix "10.10.0.0/16"

# (선택) 신뢰할 수 있는 루트 CA 배포, EAP-TLS 사용은 GPO/MDM로 구성

```

---

## 운영·관측(Observability) — 로그·메트릭·패킷
### 핵심 로그 포인트

- **IPsec/IKEv2**: SA 수립·재키잉·DPD/MOBIKE 이벤트, 암호 협상 실패, 인증서 오류.
- **WireGuard**: 핸드셰이크 수행·전송 바이트·키 로테이트 로그.
- **OpenVPN**: 제어/데이터 채널 cipher 협상, `data-ciphers` 미스매치, TLS 실패. (최근 버전은 **data-ciphers 협상**이 기본)

### 패킷 캡처 필터(점검용)

```bash
# IKEv2/ISAKMP

tcpdump -ni any udp port 500
# NAT-T ESP

tcpdump -ni any udp port 4500
# OpenVPN(기본)

tcpdump -ni any udp port 1194
# WireGuard

tcpdump -ni any udp port 51820
```

### 지표

- **세션 수/성공률**, **재키잉 주기**, **패킷 손실/지연**, **CPU(암호화)**, **MTU 관련 재전송**.
- **보안 지표**: 약한 cipher 요구/연결 차단 건수, 인증 실패(원인코드), 인증서 만료 임박.

---

## 성능·품질 최적화

1) **AEAD 가속**: 서버 CPU의 **AES-NI**/ARMv8-Crypt, 모바일은 **ChaCha20-Poly1305** 유리.
2) **UDP 우선**: OpenVPN은 UDP를 1순위로(지연·혼잡 완화).
3) **PMTUD + MSS Clamp**: 터널 오버헤드 고려, TCP 세션 단절 방지.
4) **멀티 코어**: WireGuard(커널)·strongSwan(스레드)·OpenVPN(멀티프로세스/멀티스레드) 스케일링.
5) **모빌리티**: IKEv2는 **MOBIKE** 활성(클라이언트 이동성).

---

## 보안 베스트프랙티스 체크리스트

**암호/정책**
- [ ] **IKEv2 + ESP-AES-GCM + PFS(ECDHE)**, 인증서는 ECDSA 또는 RSA-PSS(기관 표준 준수).
- [ ] **TLS 1.3/1.2(안전구성), AEAD**(AES-GCM/ChaCha20-Poly1305).
- [ ] **WireGuard**는 최신 커널/모바일 앱 사용, 키 안전 관리.

**인증·접속 통제**
- [ ] 원격접속 **MFA**(RADIUS/IdP), **디바이스 신뢰**(증명서/EAP-TLS).
- [ ] **분할 터널 원칙**: 필요한 도메인/네트워크만 내부 라우팅.
- [ ] **DNS 유출 방지**: 내부 DNS 강제, 외부 DNS 차단.

**운영**
- [ ] **키 수명**: IKE/Child SA 주기적 재키잉, OpenVPN/WG 키 순환.
- [ ] **로그 중앙화**: IKEv2/Auth 실패 사유, cipher 협상 미스매치 감시.
- [ ] **취약 구성 차단**: OpenVPN의 구식 `cipher` 단일 지정 대신 **`data-ciphers` 협상** 사용.

**네트워크**
- [ ] UDP/500, 4500, 1194, 51820 등 **방화벽 예외** 명시.
- [ ] NAT 환경은 **NAT-T** 또는 **UDP 기반** 터널 선호.
- [ ] **킬 스위치**: 터널 이탈 트래픽 차단(호스트 방화벽 규칙).

---

## 문제 해결(트러블슈팅) Q&A

- **증상: TLS 연결은 됐는데 데이터가 안 흐름(OpenVPN)**
  → 서버/클라이언트 **`data-ciphers` 불일치**. GCM/ChaCha20로 일치시켜 재시도.
- **증상: 무선↔셀룰러 이동 시 IPsec 끊김**
  → **MOBIKE** 활성, 클라이언트/게이트웨이 지원 매트릭스 확인.
- **증상: 특정 웹만 느리다**
  → MTU/PMTUD 문제 의심. **MSS Clamp** 적용, OpenVPN/WG MTU 1420 근처 시도.
- **증상: WireGuard는 연결되나 일부 대역만 접근**
  → `AllowedIPs`가 **라우팅+ACL 역할** → 필요한 프리픽스 추가.

---

## 실무 과제(랩)

1) **“원격접속 표준화”**: IKEv2(EAP-TLS) 프로파일 배포 + OpenVPN(UDP) 대체 경로 + WireGuard P2P(운영팀 전용).
2) **“분할터널 정책화”**: 업무망(10.10/16, *.corp.local)만 터널, 나머지는 로컬. DNS는 내부 DNS 강제.
3) **“가용성”**: 게이트웨이 **Active/Standby** + 헬스체크, 클라이언트는 **MOBIKE** 활성.
4) **“암호 포트폴리오”**: 서버 AES-GCM 고정, 모바일은 **ChaCha20** 우선 fallback 허용(성능).
5) **“감사 기준”**: 로그에 **암호군 협상 결과**, **실패 사유(EAP/TLS)**, **인증서 만료 임박** 경보 포함.

---

## 예상 실기 문제 & 모범 답안 골격

1) **IPsec(ESP)과 SSL VPN의 차이점을 계층·핸드셰이크·운용 관점에서 비교하라.**
   - 계층(L3 vs L7), 핸드셰이크(IKEv2 vs TLS/DTLS), NAT 친화성, 라우팅/성능 차이.
2) **MOBIKE의 목적과 동작을 설명하고, 어떤 환경에서 필수인지 쓰라.**
   - IP 변경 시 SA 유지를 위한 IKEv2 확장, 모바일/카페 Wi-Fi↔LTE 전환 환경.
3) **OpenVPN 최신 버전에서 `cipher` 대신 `data-ciphers`가 필요한 이유는?**
   - 양단 협상 기반, AEAD 우선, 하위 호환 제어. 설정 예시 제시.
4) **WireGuard의 암호 설계와 운영 장단점을 쓰라.**
   - Noise/Curve25519/ChaCha20, 구성 단순·고성능 vs 엔터프라이즈 정책 세분화는 추가 설계 필요.
5) **터널 오버헤드가 MTU에 미치는 영향과 MSS 조정 방법을 수식과 함께 설명하라.**
   - \( \text{Payload}_{\max}=M-O \), TCP MSS 계산, 실무 MTU 1420 근거.

---

## 참고 문헌(핵심 표준·가이드)

- **RFC 4301**(IPsec 아키텍처), **RFC 4303**(ESP).
- **RFC 7296**(IKEv2), **RFC 4555**(MOBIKE).
- **NIST SP 800-77r1**(IPsec VPN 가이드).
- **RFC 9147**(DTLS 1.3), **NIST SP 800-52r2**(TLS 구성).
- **OpenVPN Docs**(제어/데이터 채널·Cipher 협상), **WireGuard Docs/Whitepaper**.

---

## 요약 결론

- **기업 표준안(원칙)**:
  - 원격접속 1순위: **IKEv2(EAP-TLS)+ESP-GCM+MOBIKE**, 2순위: **OpenVPN(UDP, AEAD)**, 운영팀·특수 목적: **WireGuard**.
  - **분할 터널**·**내부 DNS 강제**·**MFA**·**키 수명 관리**는 필수.
  - **TLS 1.3/1.2 안전구성**, **AEAD** 통일, **로그·지표**로 협상/실패/성능 관측.
- **클라우드/지사 연동**은 **IPsec 사이트간**으로 라우팅 통합, 경계에서는 **Transit** 패턴으로 복잡도 최소화.

> 위 구성/정책은 **표준(RFC/NIST)**와 최근 실무 권고를 반영했다. 벤더별 세부 문법은 다르므로 **릴리스 노트**와 **상호운용성 매트릭스**를 반드시 확인하라.
