---
layout: post
title: 정보통신기사 - 운영보안
date: 2025-08-22 23:25:23 +0900
category: 정보통신기사
---
# 운영보안: 방화벽 / IDS / IPS / WAF · 취약점 관리 총정리

## 큰 그림: “차단(Prevention) + 탐지(Detection) + 대응(Response) + 개선(Improvement)”

- **방화벽**: L3/4/7 정책으로 **허용/차단/기록**(Default Deny 권장).
- **IDS/IPS**: **서명 기반 + 이상탐지**로 **침입 이벤트 탐지**, **IPS는 인라인 차단**.
- **WAF**: Web 트래픽(HTTP/HTTPS) **어플리케이션 레벨 보호**(OWASP Top 10 대응).
- **취약점 관리**: **자산 인벤토리 → 스캔 → 위험 평가(CVSS/EPSS/자산가치) → 패치/완화 → 검증**의 반복.
- **운영 체계**: **관측성(로그/메트릭/트레이스)** + **SIEM/SOAR** + **런북/훈련**.

---

## 네트워크 보안 아키텍처 한 장

```
[Internet]
   |
 [Edge Router] --(DDoS 보호/ACL)
   |
 [Perimeter FW (NGFW)] --(DMZ)--> [Reverse Proxy/WAF] --> [App/Tier]
   |                                   |
  (Egress Control)                     IDS/IPS(Inline or TAP)
   |
 [Core/Segmentation FW] --(VLAN/Zone 분리)--> [User/Laptop VLAN]
   |
 [SOC/SIEM] <--- (Logs from FW/IDS/WAF/Endpoints/Servers)
```

- **이중화**: 방화벽/IPS/WAF는 **Active-Active** 또는 **Active-Standby**(VRRP/연결동기화) 적용.
- **세그멘테이션**: 사용자/서버/OT/관리망 **Zone 분리** + **동서(East-West) 제어**(마이크로세그멘테이션).
- **암호화 경로**: TLS 종료/재암호화 경계와 복호의 **법/규정 준수** 고려(프라이버시·핀닝·HSTS).

---

## 방화벽(Firewall) 기본

### 유형

- **패킷 필터**(Stateless): 5튜플 매칭. 가볍지만 **상태 불인지**.
- **상태기반(Stateful)**: 연결 상태(ESTABLISHED/RELATED) 추적. **디폴트**.
- **어플리케이션/NGFW**: **App-ID**, 사용자/그룹, URL 카테고리, **IPS·AV·Sandbox** 통합.

### 정책 설계 원칙

1) **Default-Deny**(명시 허용만 통과).
2) **Least Privilege**(최소 권한 포트/대상/시간).
3) **Clean-Up Rule**(마지막 차단·로그).
4) **변경관리/MoP**와 **정기 검토**(휴면 룰 제거).
5) **Egress Control**(외부로 나가는 트래픽도 최소화·DNS/HTTP 프록시 고정).

### 주소 객체/서비스 객체/그룹

- **IP·서브넷/범위**, **FQDN**, **GeoIP**, **태그**로 관리 편의성↑.
- **서비스 그룹**으로 **포트 집합** 재사용.

### 간단 예시 (리눅스 nftables)

```bash
# /etc/nftables.conf

table inet filter {
  sets {
    web_ports { type inet_service; elements = { 80, 443 } }
  }
  chains {
    input {
      type filter hook input priority 0; policy drop;
      ct state established,related accept
      iif lo accept
      tcp dport { ssh } ip saddr 203.0.113.0/24 accept   # 관리망만 SSH
      counter drop
    }
    forward {
      type filter hook forward priority 0; policy drop;
      ct state established,related accept
      ip saddr 10.10.10.0/24 tcp dport @web_ports accept # DMZ로 웹만
    }
    output {
      type filter hook output priority 0; policy drop;
      ct state established,related accept
      tcp dport { 53, 80, 443 } accept                   # 제한적 이그레스
    }
  }
}
```

### 베스트 프랙티스

- **RFC 5735/6890** 등 **사설/예약** 주소 **인터넷 인터페이스에서 Drop**.
- **Bogon/장기 미사용 프로토콜 차단**(예: Telnet/SMB 인바운드).
- **Fragmentation/TTL** 등 **우회(evasion)** 방어: **정규화(normalization)**, MSS/DF/TCP 옵션 튜닝.

---

## IDS / IPS

### 개념

- **IDS**: **탐지**(오프라인/미러 포트/TAP).
- **IPS**: **인라인**으로 **차단**(성능/지연/오탐 관리 중요).

### 탐지 방식

- **서명(Signature)**: 정규식/바이트 패턴, CVE 매핑 → **정확/신속**, **제로데이 취약**.
- **이상(Anomaly/ML)**: 베이스라인 대비 편차 → **미지 위협 탐지**, **오탐 관리 필요**.
- **상관규칙**: 다중 이벤트·흐름 결합(스캔→익스플로잇→C2).

### 배치

- **인라인**: Internet↔FW 사이, 세그먼트 간. **Fail-Open/Close** 선택.
- **탭/미러**: **성능 영향 없음**, 차단 불가(권고: **NDR**로 가시성 강화).

### Suricata 설정 예(Inline IPS)

```yaml
af-packet:
  - interface: eth1
    cluster-id: 99
    cluster-type: cluster_flow
    defrag: yes
    copy-mode: ips
    tpacket-v3: yes

detect:
  profile: medium
  sgh-mpm-context: auto

# Drop policy 예: ET Open 룰셋에서 높은 신뢰도만 drop

rule-files:
  - suricata.rules
```

**샘플 룰(드롭)**
```snort
# 단순 예: MS-SQL 슬래머 웜 패턴

drop udp any any -> any 1434 (msg:"MS-SQL Slammer worm"; content:"|04|"; depth:1; content:"|11|"; offset:1; metadata: service mssql; sid:1000001; rev:1;)
```

### 성능·지연

- **패킷 처리 경로**(kernel bypass, DPDK)·**MPM 엔진**·**룰 수**·**TLS 해제 여부**에 좌우.
- 지연 예산:
  $$
  \text{총 지연} \approx \text{네트워크 RTT} + \text{LB/WAF/IPS 처리지연} + \text{서버 처리}
  $$
  → IPS/WAF 추가 시 p95·p99 지연 목표 **SLO 재설정**.

### 우회(Evasion)와 방어

- **조각화/오버랩 세그먼트**, **이중 인코딩/케이스 변형**, **TTL/경로 차이**.
- 방어: **스트림 재조립**, **정규화**, **서버 정책과 동일한 해석(HTTP 파서 설정)**.

---

## WAF (Web Application Firewall)

### 두 가지 모델

- **음성(Allowlist/Positive Security)**: 스키마/파라미터 화이트리스트(엄격·FP↓).
- **음성/양성 혼합**: **CRS(코어룰셋)** 기반 시그니처 + 앱별 화이트리스트.

### 보호 범위

- **OWASP Top 10**: **SQLi/XSS/XXE/세션 하이재킹/CSRF/파일업로드/RCE/SSRF** 등.
- **봇/크롤러/레이스/레이트리미트**.
- **가시성**: HTTP 메서드/URI/헤더/바디, **JSON/XML/GraphQL** 파싱.

### ModSecurity + CRS 예시(NGINX)

```nginx
load_module modules/ngx_http_modsecurity_module.so;
http {
  modsecurity on;
  modsecurity_rules '
    SecRuleEngine On
    SecRequestBodyAccess On
    SecResponseBodyAccess Off
    SecAuditEngine RelevantOnly
    SecAuditLog /var/log/modsec_audit.log
    Include /etc/modsecurity/modsecurity.conf
    Include /usr/local/owasp-modsecurity-crs/crs-setup.conf
    Include /usr/local/owasp-modsecurity-crs/rules/*.conf
  ';
  server {
    listen 443 ssl http2;
    location / {
      proxy_pass http://app_pool;
    }
    location = /healthz { return 200; }
  }
}
```

### 커스텀 룰(주의: 오탐)

```apache
# SQL 키워드 조합이면서 숫자/문자 혼합 ID 파라미터에만 적용

SecRule ARGS:id "@rx (?i)(union\s+select|or\s+1=1|--|\bupdate\b|\binsert\b)" \
 "id:2001001,phase:2,deny,log,status:403,msg:'Possible SQLi in id param',\
  chain"
 SecRule &ARGS:id "@eq 1" "t:urlDecodeUni,t:lowercase"
```

### 레이트 리미팅(프론트 리버스 프록시)

```nginx
limit_req_zone $binary_remote_addr zone=rl:10m rate=10r/s;
server {
  location /login {
    limit_req zone=rl burst=20 nodelay;
    proxy_pass http://auth;
  }
}
```

---

## 취약점 관리(Vulnerability Management)

### 프로세스

1) **자산 식별/분류**(CMDB, 태그: 소유자/중요도/데이터등급).
2) **스캔**: 네트워크 스캔(인증/비인증), 웹 DAST, 컨테이너/이미지, SBOM·라이브러리(OSS).
3) **평가**: **CVSS** + **EPSS(Exploit 예측)** + **노출도(인터넷/내부)** + **보상통제**.
4) **조치**: 패치/설정 변경/차단 룰/WAF 가상 패치.
5) **검증/보고**: 재스캔, SLA 준수율, 트렌드.

### CVSS v3.1 요지

- **기본(Base)**: AV/AC/PR/UI/S/C/I/A.
- **시간/환경** 가중 → 최종 점수(0~10).
- (간소화) **위험도**는 다음과 같이 가중 합산 가능(운영상):
$$
\text{Risk} = \text{CVSS}_N \times w_1 + \text{EPSS}_N \times w_2 + \text{Exposure} \times w_3 + \text{AssetCriticality} \times w_4
$$
- 여기서 $_N$은 0~1 정규화, $w_i$는 조직 가중치.

### 패치 우선순위 SLA(예)

| 심각도 | 예시 기준 | 인터넷 노출 | 내부 전용 |
|---|---|---|---|
| **Critical** | CVSS ≥ 9.0 or EPSS ≥ 0.7 | **72h 이내** | 7일 |
| High | 7.0–8.9 | 7일 | 14일 |
| Medium | 4.0–6.9 | 30일 | 45일 |
| Low | <4.0 | 60일 | 90일 |

### 도구/스캔 예

```bash
# nmap 기본 + 스크립트

nmap -sS -sV -O --script vuln -T4 203.0.113.10

# OpenVAS/GVM (개념) - 인증 스캔은 계정/권한 필요
# 컨테이너 이미지 스캔

trivy image --severity HIGH,CRITICAL registry/app:1.2.3

# SBOM 생성 (Syft) + 취약점 매칭

syft registry/app:1.2.3 -o json > sbom.json
grype sbom:sbom.json
```

### 가상 패치(WAF/IPS)

- **제로데이/패치 불가 기간**에 **시그니처 룰**로 **임시 차단** → 패치 후 **룰 완화**.

---

## 운영/관측성: 로그·메트릭·대시보드

### 수집 포인트

- 방화벽: **허용/차단** 로그, NAT, 세션 시작/종료, **패킷 이유코드**.
- IDS/IPS: **시그니처 ID/정규화 필드(src/dst/flow/파일해시)**.
- WAF: 요청 메타(메서드/URI/헤더/바디 길이), 룰ID, **엔티티(파라미터) 이름**.
- 스캐너: 자산/취약점 목록, 심각도, 해결상태.

### 예시 쿼리(Splunk-like)

```text
# 급증하는 차단 트래픽

index=fw sourcetype=fw_log action=deny
| timechart span=5m count by dest_port
| where _sum > 1000

# IDS 심각 이벤트 상위 소스IP

index=ids severity>=high
| stats count by src_ip signature
| sort -count | head 20

# WAF SQLi 룰 히트율/오탐 지표

index=waf rule_id=2001001
| stats count as hits, sum(if(action="blocked",1,0)) as blocked by uri
| eval block_rate=blocked/hits
```

### 경보 설계

- **임계+지속**(예: 10분 평균 이상), **상관/억제**(상위 장비 다운 시 하위 억제), **중복 제거**.
- **런북 링크** 포함(“High 5xx & WAF SQLi 차단 증가 → App 릴리즈/쿼리 확인”).

---

## 배치/설계 패턴

### 이중 방화벽 DMZ(Screened Subnet)

```
[Internet] -- [Edge FW] --(DMZ: Reverse Proxy/WAF) -- [Core FW] -- [App/DB]
```
- **북-남(North-South)**: Edge에서 1차 제어, **DMZ**에서 L7(WAF), Core에서 동서 제어.
- DB는 **App만 접근** 허용(포트·IP·서비스 계정 고정).

### 마이크로세그멘테이션

- **하이퍼바이저 분산 방화벽/에이전트**로 **VM↔VM** 트래픽 제어(라벨/태그 기반).
- **제로트러스트**: **ID·디바이스 신뢰** + **세션 컨텍스트**(시간/위치/위험) 기반 허용.

### TLS 프록시 위치

- **WAF에서 종료** 후 **백엔드로 재암호화(mTLS)**.
- **핀닝/의료/금융 데이터**: **가시성·규정** 충돌 시 **예외 경로** 설계.

---

## 벤더식 예시(개념 스니펫)

### Cisco ASA 스타일(Access-List)

```bash
access-list OUTSIDE_IN extended permit tcp any host 198.51.100.10 eq 443
access-list OUTSIDE_IN extended deny ip any any log warnings
access-group OUTSIDE_IN in interface outside

policy-map global_policy
 class inspection_default
  inspect dns preset_dns_map
  inspect http
```

### Palo Alto(세션 기반, 주소/서비스 객체)

```bash
# CLI 개념

set address web-vip ip-netmask 198.51.100.10/32
set service svc-https protocol tcp port 443
set rulebase security rules allow-web from any to untrust destination web-vip service svc-https application ssl action allow
set profiles vuln-protect vulnerability "strict" ...
```

### FortiGate(Policy + IPS/WAF)

```bash
config firewall policy
  edit 1
    set srcintf "wan1"
    set dstintf "dmz"
    set srcaddr "all"
    set dstaddr "web-vip"
    set action accept
    set schedule "always"
    set service "HTTPS"
    set utm-status enable
    set ips-sensor "strict"
    set waf-profile "crs-default"
  next
end
```

---

## DDoS / 레이트/폭주 방어 개요

- **L3/4**: **ACL/행동분석**, **SYN 쿠키**, **Conntrack 한계** 보호.
- **L7**: **챌린지(자바스크립트/쿠키)**, **캐시 오프로드**, **레이트/토큰버킷**.
- **용량 계획**:
  $$
  \text{최대 세션수} \ge \text{CPS} \times \text{세션 평균 지속(sec)}
  $$
  예) 5k CPS × 60s = **300k 세션** 처리 표(Table) 필요.

---

## 트러블슈팅 / 런북

### “새 규칙 적용 후 서비스 장애”

1) **Hit-Count/Rule Order** 확인(우선순위 충돌).
2) **세션 잔존**(Stateful) → 세션 테이블 **플러시** 또는 **그레이스 적용**.
3) **NAT/ALG** 상호작용 점검(SIP/FTP).
4) **롤백** 및 **Change Review**.

### “IPS 오탐/성능 저하”

- **룰 튜닝**: 저신뢰 룰은 **Alert-only**, 트래픽 많은 경로는 **정교한 조건**.
- **바이패스**: 특정 VLAN/서브넷 한시적 패스-스루(위험 인지 후).
- **하드웨어 가속/스레드/큐** 확인, **파일/HTTP 파서 옵션** 최적화.

### “WAF 차단으로 기능 장애”

- **오탐 재현**(요청 캡처), **룰ID** 확인 → **파라미터 스코프 제한/화이트리스트**.
- **보상통제**(레이트리밋·캡차)로 위험 완화 후 룰 완화.

---

## 보안·규정 매핑(요약)

- **ISO 27001 A.8/13/14**: 네트워크 보안/시스템 획득·개발/취약점 관리.
- **PCI DSS**: 경계 방화벽, 변경관리, 웹 애플리케이션 보안(WAF/코드 리뷰).
- **개인정보 보호**: **TLS**, 접근통제, 로그 보관/마스킹.

---

## 체크리스트(현장용)

### 정책/설계

- [ ] **Default Deny** + Clean-up Rule
- [ ] **Egress 제어**(DNS/HTTP 프록시 고정, 나머지 금지)
- [ ] **세그멘테이션**(사용자/서버/관리/OT)
- [ ] **WAF 적용 범위**(공개 웹/관리 콘솔) + **레이트리미트**
- [ ] IDS/IPS **Fail-Mode**, **우회 방어**(정규화/재조립)
- [ ] **로그 표준화**(공통 필드/타임스탬프/NTP)

### 운영/모니터링

- [ ] **룰 Hit-Count** 정기 검토/정리
- [ ] **SIEM 대시보드**(Top Blocks/5xx/WAF 룰 히트/스캔 지표)
- [ ] **서명 업데이트/튜닝** 주간 릴리즈
- [ ] **취약점 스캔 주기**(인터넷 자산 주간/내부 월간/컨테이너 파이프라인 매빌드)
- [ ] **패치 SLA** 추적, 가상패치 사용시 **만료** 관리
- [ ] **모의훈련**(Web 취약점, IPS 오탐, 대량 스캔)

---

## 자주 틀리는 포인트(정오표)

1) **Allow-List 없이 블록만 쌓기** → 예외 천국, 그림자 규칙.
2) **Egress 무제한** → C2/데이터 유출 통로 생김.
3) **IDS 경고 무시** → 튜닝 안 하면 **노이즈** → **무시 습관**.
4) **WAF=만능** 오해 → **입력 검증/인증/권한/비즈니스 로직** 취약은 개발 측면 해결 필요.
5) **취약점 점수만** 보고 우선순위 → **노출도/EPSS/자산가치** 함께 고려.
6) **TLS 가시성 확보** 안 함 → IDS/WAF 실효 급감(합법적 복호/프록시 경로 설계 필요).
7) **룰 순서/세션 캐시** 간과 → 배포 후 간헐 장애.

---

## 연습문제(풀이 포함)

**Q1.** Stateful FW에서 “ESTABLISHED, RELATED”가 의미하는 바와 이점은?
**A.** **기존에 허용된 연결의 역방향/관련 트래픽 자동 허용**. 반환 트래픽 룰 축소로 **안전·간결**.

**Q2.** IDS와 IPS의 차이와 배치 상 장단점 2가지씩?
**A.** IDS=탐지(미러/TAP, 성능영향↓/차단불가), IPS=인라인 차단(즉시 차단/지연·오탐 리스크↑).

**Q3.** WAF에서 Positive Model을 적용하는 장점/단점은?
**A.** 장점: **FP↓·정밀**, 단점: 스키마 변화에 **유지보수↑**.

**Q4.** 취약점 우선순위에서 EPSS가 높은데 CVSS가 낮은 경우 조치?
**A.** **실제 악용 가능성↑** → **우선 패치/가상패치** 검토(노출도·자산가치 고려).

**Q5.** 세션 테이블 용량 계산: 3k CPS, 평균 세션 90s. 최소 세션 엔트리 수는?
**A.** $3{,}000 \times 90 = 270{,}000$.

**Q6.** IDS 우회 기법 두 가지와 대응?
**A.** **조각화/오버랩**, **이중 인코딩**; 대응: **재조립/정규화**, 서버 동작과 **동일 파서**.

**Q7.** Egress 제어의 핵심 3가지?
**A.** **DNS/HTTP(S) 고정 경로**, **기타 포트 차단**, **프록시/SSL 검증**.

---

## 미니 레퍼런스 스니펫 모음

### pf(오픈BSD) 예시

```pf
set block-policy drop
block all
pass in on egress proto tcp to (egress) port { 80 443 }
pass out proto { tcp udp } to { 8.8.8.8 1.1.1.1 } port 53
pass out proto tcp to any port { 80 443 } flags S/SA modulate state
```

### Sigma 룰(방화벽 포트 스캔 감지 예)

```yaml
title: Firewall Port Scan Burst
logsource:
  product: firewall
detection:
  sel:
    action: deny
  timeframe: 1m
  condition: selection
  selection:
    dest_port|count: ">=100"
    src_ip: same
fields:
  - src_ip
  - dest_port
level: medium
```

### HTTP 헤더 보안(앱 협업)

```nginx
add_header X-Content-Type-Options nosniff always;
add_header X-Frame-Options DENY always;
add_header Referrer-Policy strict-origin-when-cross-origin always;
add_header Content-Security-Policy "default-src 'self'" always;
```

---

## 마무리

- **방화벽**은 “**허용만 통과**”의 질서, **IDS/IPS**는 **보이지 않는 위협을 드러내고 막는 손**, **WAF**는 **웹 계층의 안전벨트**입니다.
- **취약점 관리**는 **끊김 없는 공정**(자산 → 스캔 → 평가 → 조치 → 검증)으로 **기술·운영·개발**이 함께 굴러야 합니다.
- 핵심은 **정책의 단순함(Default Deny)**, **가시성(SIEM/대시보드)**, **튜닝/검증 루틴(주간 릴리즈/훈련)**,
  그리고 **Egress 포함 전방위 제어**입니다. 이 네 가지가 **운영보안의 품질**을 결정합니다.
