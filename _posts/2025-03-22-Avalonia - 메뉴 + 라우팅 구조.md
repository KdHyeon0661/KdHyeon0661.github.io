---
layout: post
title: Avalonia - ë©”ë‰´ + ë¼ìš°íŒ… êµ¬ì¡°
date: 2025-03-22 19:20:23 +0900
category: Avalonia
---
# ğŸ§­ Avalonia ì•±ì—ì„œ ë©”ë‰´ + ë¼ìš°íŒ…(Navigation) êµ¬ì¡° ì„¤ê³„

---

## ğŸ¯ ëª©í‘œ

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ğŸ§­ ì™¼ìª½ ì‚¬ì´ë“œ ë©”ë‰´ or ìƒë‹¨ ë©”ë‰´ êµ¬í˜„ |
| ğŸ”„ ViewModel ê¸°ë°˜ View ì „í™˜ |
| ğŸ”Œ DI ê¸°ë°˜ ë¼ìš°íŒ… ì„œë¹„ìŠ¤(INavigationService) ì„¤ê³„ |
| ğŸ§© ëª¨ë“ˆí™”ëœ íƒìƒ‰ êµ¬ì¡° í™•ì¥ ê°€ëŠ¥ |

---

## 1ï¸âƒ£ ê¸°ë³¸ UI êµ¬ì„± ì˜ˆì‹œ

```plaintext
+-----------------------+--------------------------+
|       ë©”ë‰´ ì˜ì—­       |     ì½˜í…ì¸  ì˜ì—­          |
| - ëŒ€ì‹œë³´ë“œ           |   ViewModelì— ë”°ë¥¸ View  |
| - ì‚¬ìš©ì ê´€ë¦¬        |   ì¶œë ¥                   |
| - ì„¤ì •               |                          |
+-----------------------+--------------------------+
```

---

## 2ï¸âƒ£ NavigationView ìŠ¤íƒ€ì¼ UI êµ¬ì„± (XAML)

```xml
<DockPanel>
  <!-- ì¢Œì¸¡ ë©”ë‰´ -->
  <ListBox DockPanel.Dock="Left"
           Width="200"
           Items="{Binding MenuItems}"
           SelectedItem="{Binding SelectedMenuItem}">
    <ListBox.ItemTemplate>
      <DataTemplate>
        <TextBlock Text="{Binding Title}" Margin="10" />
      </DataTemplate>
    </ListBox.ItemTemplate>
  </ListBox>

  <!-- ì½˜í…ì¸  ì˜ì—­ -->
  <ContentControl Content="{Binding CurrentView}" />
</DockPanel>
```

---

## 3ï¸âƒ£ MenuItem í´ë˜ìŠ¤ ì •ì˜

```csharp
public class MenuItem
{
    public string Title { get; set; }
    public Type ViewModelType { get; set; }
}
```

- ë©”ë‰´ì™€ ì—°ê²°ëœ `ViewModel` íƒ€ì…ì„ ë³´ìœ 

---

## 4ï¸âƒ£ MainViewModel ì„¤ê³„

```csharp
public class MainViewModel : ViewModelBase
{
    private readonly INavigationService _navigation;

    public ObservableCollection<MenuItem> MenuItems { get; }
    public MenuItem SelectedMenuItem
    {
        get => _selectedMenuItem;
        set
        {
            this.RaiseAndSetIfChanged(ref _selectedMenuItem, value);
            Navigate(value);
        }
    }

    private object _currentView;
    public object CurrentView
    {
        get => _currentView;
        set => this.RaiseAndSetIfChanged(ref _currentView, value);
    }

    private MenuItem _selectedMenuItem;

    public MainViewModel(INavigationService navigation)
    {
        _navigation = navigation;

        MenuItems = new ObservableCollection<MenuItem>
        {
            new MenuItem { Title = "ğŸ  ëŒ€ì‹œë³´ë“œ", ViewModelType = typeof(DashboardViewModel) },
            new MenuItem { Title = "ğŸ‘¥ ì‚¬ìš©ì", ViewModelType = typeof(UserViewModel) },
            new MenuItem { Title = "âš™ï¸ ì„¤ì •", ViewModelType = typeof(SettingsViewModel) }
        };

        SelectedMenuItem = MenuItems[0];
    }

    private void Navigate(MenuItem item)
    {
        CurrentView = _navigation.Resolve(item.ViewModelType);
    }
}
```

- ë©”ë‰´ ì„ íƒ â†’ í•´ë‹¹ ViewModel ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ Viewë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ

---

## 5ï¸âƒ£ INavigationService ì •ì˜

```csharp
public interface INavigationService
{
    object Resolve(Type viewModelType);
}
```

---

## 6ï¸âƒ£ NavigationService êµ¬í˜„

```csharp
public class NavigationService : INavigationService
{
    private readonly IServiceProvider _serviceProvider;

    public NavigationService(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }

    public object Resolve(Type viewModelType)
    {
        var vm = _serviceProvider.GetRequiredService(viewModelType);
        return ViewLocator.ResolveView(vm); // View ì—°ê²°
    }
}
```

- DIë¡œ ViewModelì„ ìƒì„±í•˜ê³ , ViewLocatorë¡œ View ì—°ê²°

---

## 7ï¸âƒ£ ViewLocator ì„¤ê³„

```csharp
public static class ViewLocator
{
    public static IControl ResolveView(object viewModel)
    {
        var vmName = viewModel.GetType().Name;
        var viewName = vmName.Replace("ViewModel", "View");
        var viewType = Type.GetType($"MyApp.Views.{viewName}");

        if (viewType == null)
            return new TextBlock { Text = "View Not Found" };

        return (IControl)Activator.CreateInstance(viewType);
    }
}
```

---

## 8ï¸âƒ£ DI ë“±ë¡ (Program.cs or App.xaml.cs)

```csharp
builder.Services.AddSingleton<INavigationService, NavigationService>();
builder.Services.AddTransient<DashboardViewModel>();
builder.Services.AddTransient<UserViewModel>();
builder.Services.AddTransient<SettingsViewModel>();
```

---

## 9ï¸âƒ£ View ì˜ˆì‹œ (DashboardView.axaml)

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="MyApp.Views.DashboardView">
  <TextBlock Text="Welcome to Dashboard!" />
</UserControl>
```

```csharp
public partial class DashboardView : UserControl
{
    public DashboardView()
    {
        InitializeComponent();
    }
}
```

---

## ğŸ” ê³ ê¸‰: ì»¤ë§¨ë“œë¡œ ì „í™˜

```csharp
public ReactiveCommand<Type, Unit> NavigateCommand { get; }

public MainViewModel(INavigationService navigation)
{
    NavigateCommand = ReactiveCommand.Create<Type>(type =>
    {
        CurrentView = navigation.Resolve(type);
    });
}
```

```xml
<Button Content="ì‚¬ìš©ì" Command="{Binding NavigateCommand}"
        CommandParameter="{x:Type vm:UserViewModel}" />
```

---

## ğŸ§  ëª¨ë“ˆë³„ ë©”ë‰´ ìë™ ë“±ë¡ ì˜ˆì‹œ

```csharp
public interface IModule
{
    IEnumerable<MenuItem> GetMenuItems();
}
```

â†’ App ì‹œì‘ ì‹œ `IModule` ëª©ë¡ì—ì„œ ë©”ë‰´ í•­ëª© ìë™ ë“±ë¡ ê°€ëŠ¥

---

## ğŸ“š í™•ì¥ ë°©í–¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ğŸ§© ë‹¤ì¤‘ ì°½ ë¶„ê¸° | MainWindow ì™¸ ë‹¤ë¥¸ ì°½ì—ì„œ ë¼ìš°íŒ… ê°€ëŠ¥ |
| ğŸ—‚ï¸ íƒ­ ê¸°ë°˜ íƒìƒ‰ | ContentControl ëŒ€ì‹  TabControl ì ìš© |
| ğŸ” ê¶Œí•œ ê¸°ë°˜ ë©”ë‰´ | `AuthService.IsAdmin` ì— ë”°ë¼ ë©”ë‰´ ì œí•œ |
| ğŸ§  íƒìƒ‰ íˆìŠ¤í† ë¦¬ | Stack êµ¬ì¡°ë¡œ Back/Forward ì§€ì› |
| ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ | ContentControl ì „í™˜ ì‹œ fade, slide íš¨ê³¼ ì¶”ê°€ |

---

## âœ… ì •ë¦¬

| ìš”ì†Œ | ì—­í•  |
|------|------|
| MenuItem | íƒìƒ‰ ê°€ëŠ¥í•œ ViewModel ëª©ë¡ |
| INavigationService | ViewModel â†’ View ìƒì„± ì±…ì„ |
| ViewLocator | ViewModelì— í•´ë‹¹í•˜ëŠ” View ì—°ê²° |
| MainViewModel | ì„ íƒëœ ë©”ë‰´ë¥¼ ë°”ì¸ë”©í•˜ê³  ì „í™˜ ìˆ˜í–‰ |
| ContentControl | í˜„ì¬ View ë Œë”ë§ ì˜ì—­ |

---

## ğŸ”š ê²°ë¡ 

AvaloniaëŠ” í”„ë ˆì„ ë‚´ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œì´ ì—†ì§€ë§Œ,  
MVVM + DI + ViewLocatorë¥¼ ì´ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê°•ë ¥í•œ ë¼ìš°íŒ… êµ¬ì¡°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:

- âœ… ìœ ì—°í•œ ViewModel ê¸°ë°˜ íƒìƒ‰
- âœ… ê¸°ëŠ¥/ëª¨ë“ˆ ë‹¨ìœ„ í™•ì¥ ê°€ëŠ¥
- âœ… ì‚¬ìš©ì ê¶Œí•œê³¼ ìƒíƒœì— ë”°ë¥¸ ìœ ë™ì  ë©”ë‰´

â†’ ì‹¤ë¬´ì—ì„œë„ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì„ í™•ë³´í•œ ë¼ìš°íŒ… êµ¬ì¡°ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
