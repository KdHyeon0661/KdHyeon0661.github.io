---
layout: post
title: AWS - S3의 종류
date: 2025-07-18 22:20:23 +0900
category: AWS
---
# Amazon S3의 종류(Storage classes · 기능 · 운영 옵션) 완전 정리 (재작성 · 실전 확장판)

> 규칙: **모든 코드 블록은 ``` 로, 수식은 반드시 $$...$$ 로 감싼다.**  
> 이 글은 당신의 초안을 **핵심을 보존**하면서, **스토리지 클래스 심화·보호/거버넌스·전송/성능·운영 자동화(IaC/CLI/SDK)·비용 모델**까지 확장한 실전 가이드다.

---

## 0. 한 장 요약

- **S3는 하나의 객체 스토리지 서비스**지만, **목적/비용/복구 지연**에 따라 여러 **스토리지 클래스**와 **운영 기능**을 제공한다.  
- 최적 전략은 **핫/웜/콜드**로 **수명 주기 정책(Lifecycle)**을 설계하고, **암호화·접근제어·불변성(Object Lock)·복제(Replication)**를 목적에 맞게 결합하는 것.  
- 운영은 **가시화(Storage Lens/CUR)** → **자동화(IaC/CI/CD)** → **가드레일(태그/정책/Config)** 순으로 정착한다.

---

## 1. S3의 “여러 종류”가 의미하는 바 (초안 보강)

- **스토리지 클래스**: 같은 “S3” 안의 **비용/가용성/복구 시간**이 상이한 저장 계층.
- **배포/접근 옵션**: S3 Website 엔드포인트, **CloudFront+OAC**(권장), **Multi-Region Access Points(MRAP)**, **Access Points**.
- **관리/보호 기능**: **버전 관리**, **Object Lock**, **암호화(SSE-S3/KMS/CSE)**, **Lifecycle**, **Replication(CRR/SRR)**.
- **데이터 처리/성능**: **S3 Select**, **Object Lambda**, **Multipart Upload**, **Transfer Acceleration**, **Requester Pays**.
- **온프레 확장**: **S3 on Outposts**.

---

## 2. 스토리지 클래스 비교표 (현업 관점)

| 클래스 | 주요 용도 | 내구성(개념) | 가용성/특성 | 복구/검색 시간 | 최소 보관 / 유의점 |
|---|---|---|---|---|---|
| **Standard** | 핫 데이터(웹/모바일/분석 소스) | 매우 높음(“11 9s” 표기 관례) | 다중 AZ, 낮은 지연 | 즉시 | 없음 |
| **Intelligent-Tiering** | 접근 패턴 불확실 | Standard 수준 | 자동 티어 이동(모니터링 소액 과금) | 즉시 | 작은 객체 대량 시 비효율 가능 |
| **Standard-IA** | 드문 접근, 즉시 필요(백업/DR) | 높음 | 다중 AZ, GET 비용 존재 | 즉시 | 최소 보관(예: 30일) |
| **One Zone-IA** | 비용 최우선, 재해 내구성 포기 | 높음(단일 AZ) | 단일 AZ 저장 | 즉시 | 최소 보관(예: 30일) |
| **Glacier Instant Retrieval** | 드문 접근 + 빠른 조회 | 높음 | 저비용 아카이브, 즉시 조회 | 거의 즉시 | 최소 보관 존재 |
| **Glacier Flexible Retrieval** | 장기 아카이브 | 높음 | 표준/신속/대량 복구 옵션 | 분~시간 | 최소 보관(예: 90일 등) |
| **Glacier Deep Archive** | 최저 비용 장기 보관 | 높음 | 매우 저렴, 복구 지연 김 | 시간대 | 최소 보관(예: 180일) |
| **S3 on Outposts** | 엄격한 로컬 보관/지연 | 로컬 HW 의존 | 온프레 가용성 | 로컬 | Outposts 요금/용량 모델 |

> 정확 요금/복구 지연/최소 보관 기간은 **리전/시점별 상이**하므로, 배포 전 **공식 가격표와 계산기** 확인 필수.

---

## 3. 클래스별 심화 설명 & 선택 팁

### 3.1 Standard
- **핫 트래픽**: 정적 웹 자산, API 결과, ML 피쳐 스토어 소스.  
- **장점**: 최소 지연/높은 처리량, 단순 비용 모델.  
- **권장**: 대다수 신규 워크로드의 기본값 → 이후 **Lifecycle**로 하향 전환.

### 3.2 Intelligent-Tiering
- **문제**: “일부는 자주, 일부는 드물게”처럼 **예측 어려운 접근 패턴**.  
- **해결**: 자동으로 빈번/비빈번/아카이브 인스턴트 등 **하위 티어 이동**.  
- **주의**: **모니터링/메타 과금**이 있어 **작은 객체 대량/단명 데이터**엔 불리할 수 있음. **임계 크기** 기준으로 선별 적용.

### 3.3 Standard-IA / One Zone-IA
- **IA**: DR/백업처럼 **즉시성**은 필요하지만 **자주 접근하지 않음**.  
- **One Zone-IA**: 비용을 더 낮추되 **리전 재해 내구성은 포기**. 복제/원본 존재 시 사용.

### 3.4 Glacier 계열
- **Instant Retrieval**: “아카이브지만 빠른 조회” 요구(로그 재조회 등).  
- **Flexible Retrieval**: 복구 등급(신속/표준/대량)으로 **비용/시간** 조정.  
- **Deep Archive**: 규제/준법 장기 보관. 복구 SLA가 길어도 OK.

### 3.5 S3 on Outposts
- **데이터 레지던시/지연/규제** 사유로 로컬 S3 API 필요할 때.  
- **운영**: Outposts 용량·하드웨어 라이프사이클 고려.

---

## 4. 핵심 기능(스토리지 “종류” 바깥의 운영 요소)

### 4.1 버전 관리(Versioning)
실수 덮어쓰기/삭제 방어. **비최신 버전 자동 정리**를 Lifecycle과 병행.

```bash
aws s3api put-bucket-versioning \
  --bucket my-bucket \
  --versioning-configuration Status=Enabled
```

### 4.2 수명 주기(Lifecycle) — 자동 티어 전환/만료
“핫(30d)→웜(90d)→콜드(365d)” 같은 체계화.

```json
{
  "Rules": [
    {
      "ID": "ArchiveOldObjects",
      "Status": "Enabled",
      "Filter": { "Prefix": "logs/" },
      "Transitions": [
        { "Days": 30, "StorageClass": "STANDARD_IA" },
        { "Days": 365, "StorageClass": "GLACIER" }
      ],
      "Expiration": { "Days": 1825 }
    }
  ]
}
```

```bash
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-bucket \
  --lifecycle-configuration file://lifecycle.json
```

### 4.3 암호화
- **SSE-S3**(자동), **SSE-KMS**(키/권한 제어), **SSE-C**, **클라이언트 측**.  
- **버킷 기본 암호화** 추천: 실수 노출 방지.

```bash
aws s3api put-bucket-encryption \
  --bucket my-bucket \
  --server-side-encryption-configuration '{
    "Rules":[{"ApplyServerSideEncryptionByDefault":{"SSEAlgorithm":"aws:kms","KMSMasterKeyID":"arn:aws:kms:ap-northeast-2:123456789012:key/abcd-ef01"}}]
  }'
```

### 4.4 Object Lock (WORM)
- **불변성**(규정 준수/감사/랜섬웨어 방어).  
- **버킷 생성 시 활성화 필수**(사후 전환 불가).

### 4.5 복제(Replication: CRR/SRR)
- 리전 재해복구/지리 근접/데이터 주권.  
- **대상 버킷 정책·암호화·Lifecycle** **동일/호환** 여부를 항상 짝지어 설계.

### 4.6 접근 제어
- **Bucket policy / IAM / ACL / Block Public Access**.  
- 대규모/다수 소비자 환경: **Access Points**.  
- 글로벌 단일 엔드포인트: **MRAP**(자동 지리 라우팅).

### 4.7 성능/전송
- **Multipart Upload**(대용량 안정성/병렬화).  
- **Transfer Acceleration**(전세계 업/다운로드 가속).  
- **Requester Pays**(수신자 과금).  
- **S3 Select**(부분 쿼리로 전송/처리 비용 절약).  
- **Object Lambda**(S3 응답을 온더플라이 변환).

---

## 5. 비용 모델 직관 & 선택 가이드

### 5.1 근사 수식
$$
\text{Cost}_{\text{month}} \approx
\sum_c (G_c \cdot p_c) +
\sum_t \frac{R_t}{1000}\cdot k_t +
\sum_e (B_e \cdot d_e)
$$

- \(G_c\): 클래스 \(c\) 월평균 GB, \(p_c\): GB·월 단가.  
- \(R_t\): 요청 수, \(k_t\): 1,000건당 단가.  
- \(B_e\): Egress GB, \(d_e\): GB당 단가.  
- **전략**: **Standard 체류 기간 최소화** + **IA/Glacier 적시 전환** + **요청/전송 절감(S3 Select/CloudFront)**.

### 5.2 선택 프레임
1) **핫 데이터**(대다수 앱 시작점): **Standard/IT**.  
2) **웜/백업**: **Standard-IA**.  
3) **비핵심·원본 있음**: **One Zone-IA**.  
4) **장기 아카이브**: **Glacier Flexible/Deep**.  
5) **패턴 불확실**: **IT**(모니터링 요금 주의, 임계 크기 이상 적용).

---

## 6. 실전 시나리오

### 6.1 로그/이벤트 레이크
- **ingest**: Standard → 30d 후 IA → 90d 후 Glacier → 2y 후 만료.  
- **Athena/Glue**로 분석, **S3 Select**로 샘플링/부분 조회.

### 6.2 미디어 자산
- 원본은 **IT**로 시작, 장기 미접근은 **Instant Retrieval/IA**로 이전.  
- 썸네일/메타만 Standard 강력 캐시(CloudFront).

### 6.3 규제 준수 보관
- **Object Lock + Compliance 모드** + **Glacier Deep Archive**.  
- **Lifecycle** 만료는 보존 종료 후에만 유효.

---

## 7. 예제 모음(콘솔/CLI/SDK/IaC)

### 7.1 업로드 시 클래스 지정
```bash
aws s3 cp movie.mov s3://my-bucket/media/ --storage-class STANDARD_IA
```

### 7.2 boto3 업로드(클래스/KMS/메타)
```python
import boto3
s3 = boto3.client("s3")
s3.upload_file(
  "file.parquet", "my-bucket", "lake/2025/11/part-000.parquet",
  ExtraArgs={
    "StorageClass": "INTELLIGENT_TIERING",
    "ServerSideEncryption": "aws:kms",
    "SSEKMSKeyId": "arn:aws:kms:ap-northeast-2:123456789012:key/abcd-ef01",
    "Metadata": {"project":"analytics","owner":"data-eng"}
  }
)
```

### 7.3 Glacier 복원(샘플)
```bash
aws s3api restore-object \
  --bucket my-bucket \
  --key archive/2023/01/report.zip \
  --restore-request '{"Days":7,"GlacierJobParameters":{"Tier":"Standard"}}'
```

### 7.4 S3 Select(압축 CSV에서 오류 행만 추출)
```bash
aws s3api select-object-content \
  --bucket my-bucket \
  --key logs/2025-11-10.csv.gz \
  --expression "SELECT * FROM s3object s WHERE s._3 = 'ERROR'" \
  --expression-type SQL \
  --input-serialization '{"CSV":{"FileHeaderInfo":"NONE"},"CompressionType":"GZIP"}' \
  --output-serialization '{"CSV":{}}' out.json
```

### 7.5 S3 Batch Operations(개념)
- Inventory CSV/Manifest → 대량 객체 **스토리지 클래스/메타** 일괄 변경.  
- 콘솔 마법사 또는 CloudFormation으로 **Job** 생성.

### 7.6 Terraform 요약(버킷/버전/Lifecycle)
```hcl
resource "aws_s3_bucket" "b" {
  bucket = "my-data-lake-2025"
}

resource "aws_s3_bucket_versioning" "v" {
  bucket = aws_s3_bucket.b.id
  versioning_configuration { status = "Enabled" }
}

resource "aws_s3_bucket_lifecycle_configuration" "lc" {
  bucket = aws_s3_bucket.b.id
  rule {
    id     = "lake-archive"
    status = "Enabled"
    filter { prefix = "lake/" }
    transition { days = 30  storage_class = "STANDARD_IA" }
    transition { days = 365 storage_class = "GLACIER" }
    expiration { days = 1825 }
    noncurrent_version_transition { noncurrent_days = 30 storage_class = "GLACIER" }
    noncurrent_version_expiration { noncurrent_days = 365 }
  }
}
```

---

## 8. 운영/거버넌스

### 8.1 비용/사용 가시화
- **S3 Storage Lens**: 비최신 비율/작은 객체/접두사 편향 파악.  
- **CUR + Athena**: 태그/버킷/클래스별 비용 쿼리.

**Athena 예시**
```sql
SELECT product_storage_class, SUM(line_item_unblended_cost) AS cost
FROM aws_billing_cur.cur_parquet
WHERE line_item_product_code = 'AmazonS3'
  AND usage_start_date >= date_add('day', -30, current_date)
GROUP BY 1
ORDER BY cost DESC;
```

### 8.2 태깅/정책/가드레일
- **Cost Allocation Tags**(Project/Owner/Env/Compliance).  
- **Block Public Access** 기본 ON, CloudFront+OAC 경유(정적 호스팅).  
- **AWS Config**로 암호화/버전/Lifecycle 미준수 탐지.

### 8.3 보안
- **SSE-KMS** 키 정책/Grant 정합성.  
- **Object Lock**과 Lifecycle의 **우선순위** 이해(보존 중 만료 불가).  
- **Replication**과 **KMS 교차계정 권한**.

---

## 9. 트러블슈팅

| 증상 | 원인 | 해결 |
|---|---|---|
| 전환/만료 지연 | Lifecycle 평가 비동기 | 1~2일 관찰, Filter/조건 재검토 |
| IA/Glacier 전환 실패 | KMS 권한/키 정책 문제 | 키 정책/Grant, 역할 권한 점검 |
| 비용 급증 | 비최신 버전 누적/작은 객체 폭증 | **Noncurrent** 규칙/압축/배치 전략 |
| 불법적 공개 | 정책/퍼블릭 차단 해제 | Block Public Access ON, OAC 경유 |
| 복제 누락 | 대상 버킷 정책/암호화/태그 조건 불일치 | 대상 규칙 동기화/조건 정합성 |

---

## 10. 체크리스트

- [x] 클래스 선택: **Standard/IT → IA → Glacier** 계단 설계  
- [x] **Lifecycle**: 전환/만료 + **Noncurrent** 규칙 세트  
- [x] **버전 관리** ON(필요 시) + **Object Lock**(규정/불변성)  
- [x] **암호화** 기본값(KMS) + 키 정책 점검  
- [x] **접근 제어**: Block Public Access / OAC / Access Points  
- [x] **복제**: 대상 정책/암호화/수명 주기 정합성  
- [x] **가시화**: Storage Lens, CUR+Athena 리포트  
- [x] **자동화**: Terraform/CloudFormation + CI/CD  
- [x] **비용 최적화**: S3 Select, CloudFront 캐시, 작은 객체 대책

---

## 11. 결론

- S3의 “종류”는 **스토리지 클래스**와 **운영 기능의 조합**이다.  
- **핵심 데이터는 Standard/IT**, 이후 **Lifecycle**로 자동 전환하여 비용을 통제하고,  
- **암호화/접근제어/Object Lock/Replication**으로 **보안·규제·가용성**을 충족한다.  
- **Storage Lens·CUR**로 **가시화**하고, **IaC·CI/CD**로 **일관성**과 **반복 가능성**을 확보하라.