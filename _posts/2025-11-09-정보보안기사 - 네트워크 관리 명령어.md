---
layout: post
title: 정보보안기사 - 네트워크 관리 명령어
date: 2025-11-09 17:25:23 +0900
category: 정보보안기사
---
# SECTION 04 네트워크 기본 학습 — 09. 네트워크 관리 명령어

## 1. 빠른 레퍼런스 — 목적 기반 치트시트

| 목적 | Linux/macOS | Windows (cmd/PowerShell) | 메모 |
|---|---|---|---|
| 인터페이스/주소 보기 | `ip a` / `ifconfig` | `ipconfig /all` | IPv6 포함 확인 |
| 링크 상태/속도 | `ethtool eth0` | `Get-NetAdapter` | 오프로드/듀플렉스 점검 |
| 라우팅 테이블 | `ip r` | `route print` / `Get-NetRoute` | 기본 게이트웨이 우선순위 |
| 규칙(PBR) | `ip rule` | (주로 라우팅 메트릭) | 정책 기반 라우팅 |
| ARP/NDP | `ip neigh` / `arp -n` / `ip -6 neigh` | `arp -a` | 비정상 MAC 확인 |
| ARP/NDP 탐색 | `arping` / `ndisc6` | (제한적) | L2 충돌/중복 IP 진단 |
| DNS 조회 | `dig`, `host`, `nslookup` | `Resolve-DnsName`, `nslookup` | 캐시/권위/재귀 구분 |
| 연결 검사 | `ping`, `traceroute`, `mtr` | `ping`, `tracert`, `pathping`, `Test-NetConnection` | 지연/손실/경로 |
| 포트 개방 확인 | `nc -vz host 443` / `telnet`(레거시) | `Test-NetConnection host -Port 443` | TLS 전 단계 |
| 소켓/포트 점유 | `ss -tulpn` / `lsof -i` | `netstat -ano`, `Get-NetTCPConnection` | LISTEN/ESTABLISHED |
| HTTP/HTTPS | `curl -v` | `Invoke-WebRequest -Verbose`, `curl`(별칭) | 프락시/인증/HTTP3 |
| 패킷 캡처 | `tcpdump`, `tshark` | `dumpcap`, `Wireshark` | 권한/필터 필수 |
| 방화벽 | `nft`, `iptables`, `firewalld` | `netsh advfirewall`, `Set-NetFirewallRule` | 상태/로그 |
| NAT 상태 | `conntrack -L` | (경계 장비에서 확인) | 쿠키/타임아웃 |
| 성능/품질 | `iperf3`, `tc`, `ethtool` | `iperf3` | 지연/지터/손실 |
| 로그 | `journalctl -u`, `dmesg` | 이벤트 뷰어, `Get-WinEvent` | 드라이버/커널 메시지 |

---

## 2. 인터페이스/주소 — IP·링크 상태·오프로드

### 2.1 Linux/macOS

```bash
# 주소/링크 한눈에
$ ip -br a    # -br: 간결 출력
$ ip a show dev eth0
$ ip link show

# IPv6만 보기
$ ip -6 a

# 링크 속도/듀플렉스/오프로드
# (root 권한 권장)
# ethtool이 없으면 설치: apt/yum/apk add ethtool
# 속도/듀플렉스/오토네고
# 오프로드 상태 확인(체크섬/GRO/LRO 등)
# 비정상 시 큰 프레임 드롭/CPU 사용률↑
# 일부 가상 NIC는 제한됨
# 아래 두 줄은 예시
# 1. 링크 정보
# 2. 오프로드
# 3. 특정 오프로드 끄기(문제 재현용)
#    ethtool -K eth0 gro off gso off tso off
#    원복: on
# -----------------------------------------
# ethtool eth0
# ethtool -k eth0
```

**macOS**  
```bash
# BSD ifconfig
$ ifconfig
# 상세 하드웨어/라우팅(하단의 3장에서 다룸)
$ networksetup -listallhardwareports
```

### 2.2 Windows

```powershell
# 모든 어댑터 상세
PS> Get-NetAdapter | Format-Table -Auto

# IP 주소 상세
PS> Get-NetIPAddress | Format-Table InterfaceAlias,IPAddress,AddressFamily,PrefixLength

# DNS 클라이언트 서버
PS> Get-DnsClientServerAddress -AddressFamily IPv4

# NIC 속도/상태
PS> Get-NetAdapter | Select Name, Status, LinkSpeed

# IPv4/IPv6 스택 상태
C:\> ipconfig /all
```

> 문제 재현 팁: **대역폭이 낮게 고정**되어 있거나 **Half-Duplex**면 충돌/재전송 급증 → 스위치/케이블 측도 점검.

---

## 3. 라우팅/정책 — 기본 게이트웨이·메트릭·PBR

### 3.1 Linux/macOS

```bash
# 라우팅 테이블(IPv4/IPv6)
$ ip r
$ ip -6 r

# 특정 목적지로 어떤 경로/장치가 선택되는지
$ ip route get 8.8.8.8
$ ip -6 route get 2001:4860:4860::8888

# 정책 기반 라우팅(마킹된 트래픽을 테이블 100으로)
# 1. fwmark 10 -> table 100
# 2. table 100의 default gw를 별도 회선으로
# 3. 마킹 예: 443 포트
# (root)
# ------------------------------------
# ip rule add fwmark 10 table 100
# ip route add default via 192.0.2.1 table 100
# iptables -t mangle -A PREROUTING -p tcp --dport 443 -j MARK --set-mark 10
```

### 3.2 Windows

```powershell
# 전체 라우팅 테이블
PS> route print

# PowerShell 객체로 경로 보기
PS> Get-NetRoute | Sort-Object -Property DestinationPrefix,RouteMetric | Select-Object -First 20

# 목적지별 실제 경로(TraceRoute 대안)
PS> Test-NetConnection 8.8.8.8 -TraceRoute
```

> 실무 팁: 멀티 NIC/다중 게이트웨이 환경에서 **메트릭**이 낮은 경로가 우선된다. VPN/전용망 충돌 시 메트릭 조정.

---

## 4. ARP/NDP — 이웃 캐시·L2 충돌·중복 IP

### 4.1 Linux/macOS

```bash
# ARP/NDP 캐시
$ ip neigh
$ ip -6 neigh

# 특정 MAC을 가진 이웃만
$ ip neigh | grep -i 'aa:bb:cc'

# L2 충돌/중복 IP 진단(같은 IP로 MAC이 바뀌는지)
$ watch -n1 'ip neigh show dev eth0'
```

**탐색/응답 확인(같은 세그먼트)**

```bash
# ARP Ping (IPv4만)
# 수신 호스트가 ARP Reply를 보내는지 체크
# (일부 환경은 제한)
# apt/yum install arping
# -----------------------
# arping -I eth0 192.168.10.50

# NDP 테스트(IPv6) — ndisc6 패키지
# ndisc6 fe80::1%eth0
```

### 4.2 Windows

```cmd
C:\> arp -a
```

> 장애 시나리오: 게이트웨이 IP의 MAC이 **갑자기 다른 장비로 바뀌면**(스푸핑/장애) 트래픽 블랙홀. 스위치 포트 보안/동적 ARP 검사(DAI) 검토.

---

## 5. DNS — 질의/캐시/권위·재귀 구분

### 5.1 Linux/macOS

```bash
# A/AAAA/CNAME/MX/NS 등
$ dig example.com any +norecurse
$ dig @1.1.1.1 example.com aaaa

# 반향/역방향
$ dig -x 8.8.8.8

# 간단 질의(host)
$ host -a example.com

# nslookup (레거시지만 보편)
$ nslookup example.com
```

### 5.2 Windows

```powershell
# 최신/권장
PS> Resolve-DnsName example.com -Type A
PS> Resolve-DnsName 8.8.8.8 -Type PTR
# 레거시
C:\> nslookup example.com
```

> 트러블슈팅: **재귀 DNS**와 **권위 DNS**를 혼동하지 말 것. 캐시 오염/오픈 리졸버 노출 여부도 점검.

---

## 6. 연결성/경로/품질 — Ping·Traceroute·mtr·PathPing

### 6.1 Linux/macOS

```bash
# ICMP Echo (IPv4/IPv6)
$ ping -c 5 8.8.8.8
$ ping6 -c 5 2001:4860:4860::8888

# 경로 추적
$ traceroute 8.8.8.8
$ traceroute -T -p 443 google.com   # TCP 443 기반 추적

# mtr: Ping + Traceroute(지연/손실 연속 측정)
$ mtr -rwzbc100 8.8.8.8   # -c: probe 횟수, -b: IP/호스트 둘 다
```

### 6.2 Windows

```cmd
C:\> ping -n 5 8.8.8.8
C:\> tracert 8.8.8.8
C:\> pathping 8.8.8.8
```

> 해석 포인트: 특정 홉에서 **100% 손실**로 보이더라도 **ICMP 제한**일 수 있다(다음 홉이 정상 응답이면 경로는 통과).

---

## 7. 포트/소켓 — LISTEN/ESTABLISHED·점유자(PID) 추적

### 7.1 Linux/macOS

```bash
# LISTEN 소켓
$ ss -tuln

# 프로세스(PID)까지
$ sudo ss -tulpn

# 포트별 점유 파일 핸들
$ sudo lsof -iTCP:443 -sTCP:LISTEN -n -P
$ sudo lsof -iUDP:53 -n -P
```

### 7.2 Windows

```cmd
C:\> netstat -ano | findstr LISTENING
C:\> netstat -ano | findstr :443
```

```powershell
# PowerShell 객체로 필터링 쉬움
PS> Get-NetTCPConnection -LocalPort 443 | Format-Table -Auto
PS> Get-Process -Id <PID>
```

> 포트 고갈: 대량 단기 연결로 **에페멀 포트**(49152–65535) 소진 가능. 클라이언트/서버 **TIME_WAIT** 행동을 이해하고 재사용 옵션 검토.

---

## 8. HTTP/HTTPS·프록시 — curl/Invoke-WebRequest/OpenSSL

### 8.1 Linux/macOS

```bash
# HTTP 요청/응답 헤더 확인
$ curl -v http://example.com/

# 프록시 경유
$ https_proxy=http://proxy.local:3128 curl -I https://example.com/

# SNI/TLS 핸드셰이크만 보기 (인증서/ALPN)
$ openssl s_client -connect example.com:443 -servername example.com -alpn h2,http/1.1 -showcerts
```

### 8.2 Windows

```powershell
# PowerShell 7+: HTTP/HTTPS
PS> Invoke-WebRequest https://example.com -Verbose -UseBasicParsing

# TCP 레벨 포트 개방 확인
PS> Test-NetConnection example.com -Port 443 -InformationLevel Detailed
```

> 프록시/SSL 문제는 **체인/루트 인증서**, **SNI**, **ALPN(HTTP/2/3)**, **중간 프록시의 TLS 종료** 여부를 확인.

---

## 9. 패킷 캡처/분석 — tcpdump/tshark/Wireshark

### 9.1 캡처 기본

```bash
# 모든 인터페이스 요약
$ tcpdump -D

# pcap 저장
$ sudo tcpdump -i any -w out.pcap

# 필터 예 (BPF)
$ sudo tcpdump -nni eth0 'tcp port 443 and (tcp[tcpflags] & (tcp-syn|tcp-ack) != 0)'
$ sudo tcpdump -nni any 'icmp and icmp[0]==3 and icmp[1]==4'  # Frag Needed
$ sudo tcpdump -nni any 'udp and port 53'
```

### 9.2 tshark(텍스트 기반)

```bash
# 10개 패킷만
$ tshark -i eth0 -c 10

# 디스플레이 필터
$ tshark -r out.pcap -Y "tcp.analysis.retransmission"
$ tshark -r out.pcap -Y "ip.ttl < 5"
```

### 9.3 편집/병합

```bash
# 대형 pcap 분할
$ editcap -c 100000 big.pcap split.pcap

# 병합
$ mergecap -w merged.pcap a.pcap b.pcap
```

> 보안/개인정보: 캡처 파일은 **민감 데이터** 포함 가능(쿠키/토큰). 저장/전송/보관 정책 준수.

---

## 10. 방화벽/NAT — nftables/iptables/firewalld & Windows

### 10.1 Linux (nftables 권장)

```bash
# 기본 드롭 + 상태 허용 + SSH/HTTP/HTTPS 허용
# (root)
nft add table inet filter
nft add chain inet filter input { type filter hook input priority 0; policy drop; }
nft add rule inet filter input ct state established,related accept
nft add rule inet filter input iifname "lo" accept
nft add rule inet filter input tcp dport {22,80,443} ct state new accept
nft add rule inet filter input icmp type { echo-request, destination-unreachable, time-exceeded } accept
```

```bash
# NAT(SNAT/DNAT)
nft add table ip nat
nft add chain ip nat prerouting  { type nat hook prerouting  priority -100; }
nft add chain ip nat postrouting { type nat hook postrouting priority  100; }
nft add rule  ip nat postrouting oifname "wan0" masquerade
nft add rule  ip nat prerouting  iifname "wan0" tcp dport 80 dnat to 192.168.10.100
```

**firewalld**

```bash
# 존/서비스 단위 추상화
$ firewall-cmd --get-active-zones
$ firewall-cmd --zone=public --add-service=https --permanent
$ firewall-cmd --reload
```

### 10.2 Windows

```cmd
C:\> netsh advfirewall show allprofiles
C:\> netsh advfirewall firewall add rule name="Allow HTTPS" dir=in action=allow protocol=TCP localport=443
```

```powershell
# PowerShell
PS> New-NetFirewallRule -DisplayName "Allow SSH" -Direction Inbound -LocalPort 22 -Protocol TCP -Action Allow
PS> Get-NetFirewallRule | ? DisplayName -Like "*SSH*"
```

> PMTUD/ICMP: `destination-unreachable`/`time-exceeded` 드롭하면 **대형 패킷 블랙홀**. 보안 정책과 기능 균형 필요.

---

## 11. QoS/트래픽 제어/성능 — tc/iperf3/오프로드

### 11.1 Linux `tc`/FQ-CoDel

```bash
DEV=eth0
# 기본 큐디스크를 fq_codel로 (지연에 강함)
# root 권한
tc qdisc replace dev $DEV root fq_codel

# 간단 레이트 리밋(전송률 제한)
tc qdisc replace dev $DEV root tbf rate 50mbit burst 32kbit latency 400ms
```

### 11.2 iperf3

```bash
# 서버
$ iperf3 -s
# 클라이언트(TCP/UDP)
$ iperf3 -c <server-ip> -t 15
$ iperf3 -c <server-ip> -u -b 100M -l 1200 -t 15
```

### 11.3 오프로드/대용량 프레임

```bash
# 문제 재현/완화 시 오프로드 토글
# (주의: 성능에 영향 큼)
# ethtool -K eth0 gro off gso off tso off
# ethtool -K eth0 gro on  gso on  tso on
```

> 실무 포인트: 고지연·고대역(예: 10G, RTT 50ms) 환경은 **대역폭-지연 곱(BDP)**에 맞는 버퍼/윈도우가 필요(상세는 TCP 편 참고).

---

## 12. 로그/이벤트 — 커널/서비스/드라이버

### 12.1 Linux

```bash
# systemd 서비스 로그
$ journalctl -u nginx --since "1 hour ago"

# 커널 메시지(링크 flap, 드라이버 에러)
$ dmesg | grep -i eth

# 네트워크 매니저
$ journalctl -u NetworkManager
```

### 12.2 Windows

```powershell
# 시스템/네트워크 드라이버 관련
PS> Get-WinEvent -LogName System -MaxEvents 100 | ? {$_.Message -match "Net|TCP|NDIS"} | Select TimeCreated, Id, Message

# NIC 드라이버 이벤트만(필터 튜닝 필요)
PS> Get-WinEvent -LogName System | ? Id -in 27,32,10400 | Select TimeCreated,Id,Message
```

> 드라이버 업데이트/전원관리 옵션(절전)으로 링크가 수시로 down/up(플랩)되는 경우가 많다.

---

## 13. 진단 자동화 — Bash/PowerShell “1회 수집” 스크립트

### 13.1 Bash: `netdiag.sh`

```bash
#!/usr/bin/env bash
# netdiag.sh — 네트워크 1회 점검 번들 (root 권장)
set -euo pipefail
OUT="netdiag_$(hostname)_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$OUT"

echo "[+] 인터페이스/주소"
ip -br a            | tee "$OUT/ip_a.txt"
ip r                | tee "$OUT/ip_r.txt"
ip -6 r             | tee "$OUT/ip6_r.txt"

echo "[+] 이웃/ARP"
ip neigh            | tee "$OUT/ip_neigh.txt"

echo "[+] 소켓"
ss -tuln            | tee "$OUT/ss_listen.txt"
ss -tan             | tee "$OUT/ss_tcp.txt"

echo "[+] DNS"
grep -H . /etc/resolv.conf | tee "$OUT/resolv.txt"

echo "[+] 라우트 대상 테스트"
ip route get 8.8.8.8 | tee "$OUT/route_get_8.8.8.8.txt"

echo "[+] 연결성"
ping -c 5 8.8.8.8    | tee "$OUT/ping_g8.txt"
mtr -rwzbc50 8.8.8.8 | tee "$OUT/mtr_g8.txt" || true

echo "[+] 캡처(60초, 백그라운드)"
timeout 60 tcpdump -i any -w "$OUT/sample.pcap" >/dev/null 2>&1 || true

echo "[+] 로그"
journalctl -n 200   | tee "$OUT/journal_tail.txt"
dmesg | tail -n 200 | tee "$OUT/dmesg_tail.txt"

echo "완료: $OUT/"
```

### 13.2 PowerShell: `Net-Diag.ps1`

```powershell
#Requires -RunAsAdministrator
$ts = Get-Date -Format "yyyyMMdd_HHmmss"
$OUT = "NetDiag_$env:COMPUTERNAME" + "_$ts"
New-Item -ItemType Directory -Path $OUT | Out-Null

"=== Adapter ===" | Tee-Object "$OUT\adapter.txt"
Get-NetAdapter | Format-List * | Tee-Object -Append "$OUT\adapter.txt"

"=== IP ===" | Tee-Object "$OUT\ip.txt"
Get-NetIPAddress | Format-Table -Auto | Tee-Object -Append "$OUT\ip.txt"

"=== Route ===" | Tee-Object "$OUT\route.txt"
route print | Tee-Object -Append "$OUT\route.txt"

"=== DNS ===" | Tee-Object "$OUT\dns.txt"
Get-DnsClientServerAddress | Format-Table -Auto | Tee-Object -Append "$OUT\dns.txt"

"=== Sockets ===" | Tee-Object "$OUT\sockets.txt"
netstat -ano | Tee-Object -Append "$OUT\sockets.txt"

"=== Connectivity ===" | Tee-Object "$OUT\conn.txt"
ping -n 5 8.8.8.8 | Tee-Object -Append "$OUT\conn.txt"
tracert 8.8.8.8 | Tee-Object -Append "$OUT\conn.txt"

"수집 완료: $OUT"
```

---

## 14. 시나리오별 절차 — 결정 트리

```
증상: "웹이 가끔 끊긴다"
1) ip a / Get-NetAdapter: 링크 플랩? 속도/듀플렉스 이상?
2) ping 게이트웨이: 로컬 구간 손실?
3) traceroute/mtr 외부: 특정 구간에서 지연/손실↑?
4) curl -v / Test-NetConnection -Port 443: 포트 개방/TLS?
5) ss/netstat: 포트 고갈/TIME_WAIT 급증?
6) journalctl/dmesg/이벤트: 드라이버/전원관리 이슈?
7) tcpdump: RST/ICMP/PMTUD(Frag Needed) 드롭?
8) 방화벽/nft/netsh: 정책 충돌/차단?
```

```
증상: "사내 DNS 응답이 느림"
1) dig @dns 내부 A/AAAA 지연 측정
2) nslookup(캐시) vs 권위질의 구분
3) ss -ulpn: 53/UDP 충돌 프로세스?
4) 방화벽: 53/UDP/TCP 허용/상호 통신?
5) tcpdump: 리졸버→권위 DNS 왕복 시간
6) 시스템 리소스(CPU/mem/IO) 병목?
7) 재귀 오픈 노출? RRL 적용/오용 트래픽?
```

---

## 15. 연습 문제(실무형)

1) **멀티 NIC** 서버에서 외부 통신이 가끔 내부망으로 나간다. Linux에서 **정책 기반 라우팅**으로 443/tcp만 전용 회선을 사용하게 하라(명령 세트 제시).  
2) Windows에서 특정 호스트의 **443 포트 개방**과 **SNI/TLS**가 정상인지 명령 조합으로 확인하라.  
3) **PMTUD 블랙홀**을 의심할 때, 어떤 **ICMP 타입/코드**를 어떻게 관찰해야 하는가? 캡처 필터 예시를 쓰라.  
4) **오픈 리졸버** 노출 여부를 명령으로 점검하고, 방화벽에서 내부 대역만 허용하는 규칙을 nftables로 작성하라.  
5) **포트 고갈** 조짐을 Linux/Windows 각각 어떤 명령으로 빠르게 확인하고, 단기 완화책은 무엇인가?

---

## 16. 점검 체크리스트

- [ ] **주소/라우팅**: `ip a`·`ip r` / `ipconfig`·`route print`로 기본 상태 확보  
- [ ] **링크/드라이버**: `ethtool`/`Get-NetAdapter`로 속도/듀플렉스/오프로드 확인  
- [ ] **ARP/NDP**: `ip neigh`/`arp -a`로 중복 IP·MAC 변동 감시  
- [ ] **DNS**: `dig/Resolve-DnsName`로 권위/재귀·지연 분리 진단  
- [ ] **경로/품질**: `traceroute/mtr` vs `tracert/pathping` 비교  
- [ ] **소켓**: `ss -tulpn` / `netstat -ano`로 LISTEN/ESTABLISHED 현황  
- [ ] **캡처**: `tcpdump -w`로 증상 시점 pcap 확보(개인정보 주의)  
- [ ] **방화벽/ICMP**: PMTUD 필요한 ICMP 허용(Frag Needed/Time Exceeded)  
- [ ] **성능**: `iperf3`로 TCP/UDP 품질 측정, `tc`로 지연 개선(fq_codel)  
- [ ] **로그**: `journalctl`/이벤트 뷰어로 드라이버·서비스 에러 코렐레이션  
- [ ] **자동화**: 현장 수집 스크립트(Bash/PowerShell) 준비

---

## 17. 마무리

- 본 문서는 **현장형 명령어와 해석 요령**을 모듈로 정리했다.  
- 장애는 “가설 → 관측(명령) → 반증/확증 → 완화” 순으로 빠르게 수렴한다.  
- 조직 표준에 맞춘 **진단 번들 스크립트**를 상시 최신화해 **증거 기반**으로 문제를 해결하라.