---
layout: post
title: Django -린트/포맷터
date: 2025-10-11 17:25:23 +0900
category: Django
---
# 린트/포맷터 — **Ruff / Black / isort**, 그리고 **pre-commit** 완전 정복 (Python 3.12 · Django/DRF/CLI 공통)

> 이 문서는 **Python 프로젝트**에서 가장 많이 사용하는 정적 품질 도구인 **Ruff(린터+isort 대체) / Black(포맷터)** 를 중심으로  
> **pre-commit** 훅, CI 연동, 점진 도입 전략까지 **실무 기준으로 끝까지** 설명합니다.  
> 모든 설정/스크립트는 복붙 가능하도록 제공하며, 예시 코드를 **수정 전/후** 비교로 제시합니다.

---

## 0) 빠른 길잡이 (TL;DR)

- **Ruff**: 초고속 린터 + **isort 내장**(import 정렬) + 상당수 자동수정.  
- **Black**: 견고한 코드 포맷터(“설정이 적다 = 팀 합의 비용 ↓”).  
- **isort**: 과거엔 표준. 지금은 Ruff가 **서브셋 완벽 대체**(권장: Ruff import 정렬 사용).  
- **pre-commit**: 로컬 커밋 전 자동 검사/수정. CI와 동일 루틴 공유.

### 권장 조합(2025 기준)

1) **Ruff = 린터 + import 정렬**  
2) **Black = 포맷터**  
3) pre-commit 훅으로 **Ruff → Black → Ruff --fix** 순서 실행  
   - Black이 포맷팅을 바꾸면 import 줄 바꿈이 바뀔 수 있어서 마지막에 Ruff로 재정렬.

---

## 1) 설치 & 기본 구조

### 1.1 패키지 설치

```bash
# pip
pip install --upgrade ruff black pre-commit

# (선택) Poetry
poetry add --group dev ruff black pre-commit
```

> isort는 Ruff가 대체 가능하나, **기존 팀 룰을 유지해야 한다면** `isort`를 함께 설치하고 pre-commit에서 실행 순서만 조정하세요.

### 1.2 프로젝트 기준 파일

```
project/
├─ pyproject.toml          # Ruff/Black 공유 설정 (권장)
├─ .pre-commit-config.yaml # pre-commit 훅
├─ .editorconfig           # 편집기 공통 규칙
└─ src/ or app/            # 코드 루트(선택)
```

---

## 2) `pyproject.toml` 예시 (Ruff + Black 한 번에)

> **하나의 파일**에 통합 설정 → 도구 간 일관성 ↑, 중복 ↓

```toml
[tool.black]
line-length = 100
target-version = ["py312"]
# Django 템플릿 문자열 등은 그대로. include/exclude는 보통 pre-commit에서 경로 제어.

[tool.ruff]
# 전체 규칙 선택: E,F,W(Pyflakes/pycodestyle), I(Imports), UP(단언된 최신문법), D(pep257 docstring) 등
# https://docs.astral.sh/ruff/rules/ 참고
select = ["E", "F", "W", "I", "UP", "D", "S", "B", "C4"]
ignore = [
  "D100", "D104",         # 모듈/패키지 docstring 강제 비활성화(선호에 맞게 조정)
  "D401",                 # "Imperative mood" 문구 강제 끔
  "S101",                 # assert 사용 금지 경고 해제(테스트에서 허용)
]
line-length = 100
target-version = "py312"
# Black과 충돌 최소화
indent-width = 4
# isort 대체용
[tool.ruff.lint]
select = ["E","F","W","I","UP","D","S","B","C4"]
fixable = ["ALL"]
# D(pep257) 설정
[tool.ruff.lint.pydocstyle]
convention = "google" # or "numpy", "pep257"

# import 정렬 옵션 (isort 호환)
[tool.ruff.lint.isort]
known-first-party = ["your_package_name"]
known-third-party = ["django", "rest_framework", "requests"]
combine-as-imports = true
force-sort-within-sections = true
lines-after-imports = 2

# 파일별 무시
[tool.ruff.lint.per-file-ignores]
"tests/**" = ["D"]          # 테스트는 docstring 강제 안함
"migrations/**" = ["E501"]  # 마이그레이션 파일은 줄 길이 검사 제외(자동 생성)
"**/__init__.py" = ["F401"] # __init__의 re-export 허용

# Ruff 포맷터(베타): Black 대신 Ruff formatter를 쓰려면 [tool.ruff.format] 설정
# 본 문서는 Black 고수(팀 선호) 기준
```

> **Line length**: Black/Ruff 모두 `100`으로 맞추는 것을 권장(협업 시 Diff 감소).  
> `select/ignore`는 **팀의 합의**가 필요합니다(보안 S*, bugbear B*, etc. 점진 도입 추천).

---

## 3) pre-commit 설정

> pre-commit은 **커밋 전** 로컬에서 자동 실행되어, CI 이전에 **품질 규칙**을 강제합니다.

### 3.1 `.pre-commit-config.yaml` (Ruff → Black → Ruff --fix)

```yaml
repos:
  # 0) 기본 위생
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-yaml
      - id: check-json
      - id: end-of-file-fixer
      - id: trailing-whitespace

  # 1) Ruff (lint + import sort + 일부 자동수정)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]  # 자동수정 후 diff 있으면 실패 → 재커밋 유도
        # stages: [commit]  # (선택) pre-push로 바꾸려면 변경

  # 2) Black (format)
  - repo: https://github.com/psf/black
    rev: 24.8.0
    hooks:
      - id: black

  # 3) Ruff 다시 (Black이 변경한 import 줄바꿈 재정렬)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        args: [--fix]
        # 이 단계는 실패하지 않도록 exit-non-zero-on-fix 제거
```

> **실행 순서** 중요:  
> Ruff(린트+일부 fix) → **Black 포맷** → Ruff(마무리 정렬/경고 재검).  
> 처음 훅에서 `--exit-non-zero-on-fix`를 주면 **자동수정이 발생한 커밋**은 실패(사용자가 다시 커밋) → 깔끔한 히스토리.

### 3.2 활성화

```bash
pre-commit install
pre-commit run --all-files  # 전체 파일에 한 번 적용
```

### 3.3 주기적 업그레이드

```bash
pre-commit autoupdate
git add .pre-commit-config.yaml
git commit -m "chore(pre-commit): autoupdate hooks"
```

---

## 4) isort를 함께 쓰는 경우(레거시 호환)

> **신규 프로젝트**는 Ruff의 isort 대체를 권장.  
> **기존 팀 룰 유지**가 필요하면 아래와 같이 isort 훅을 Black 앞에 배치합니다.

```yaml
# isort 추가 버전
- repo: https://github.com/pycqa/isort
  rev: 5.13.2
  hooks:
    - id: isort
      name: isort (python)
      args: ["--profile=black", "--filter-files"]
```

- 순서 권장: **isort → Black → Ruff**  
- `isort --profile=black` 로 Black과 줄바꿈 정책을 맞춥니다.

---

## 5) VS Code / IDE 통합

### 5.1 VS Code `settings.json`

```json
{
  "python.defaultInterpreterPath": ".venv/bin/python",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": false
  },
  "python.formatting.provider": "black",
  "python.analysis.typeCheckingMode": "basic",
  "black-formatter.args": ["--line-length", "100"],
  "ruff.organizeImports": true,
  "ruff.lint.args": ["--fix"],
  "[python]": {
    "editor.defaultFormatter": "ms-python.black-formatter"
  }
}
```

> 포맷은 **Black**, import 정리는 **Ruff**.  
> “Format on Save” 활성화로 저장할 때 자동 정리.

---

## 6) 코드 예시 — 포맷팅/린트 전·후

### 6.1 정렬/포맷 전 (나쁜 예)

```python
import os,sys, json
from django .http import  HttpResponse
from typing import  List,Optional

def add (a:int , b:int)->int:  return a+b

def view(request):  # noqa: D401 (docstring 없음)
    if request.method=="GET": 
        return HttpResponse (json.dumps( {"ok":True} ),content_type="application/json")
    else:
        raise Exception("bad") # noqa: E722
```

### 6.2 Ruff + Black 후 (좋은 예)

```python
import json
import os
import sys
from typing import List, Optional

from django.http import HttpResponse


def add(a: int, b: int) -> int:
    return a + b


def view(request):
    """Return simple JSON response."""
    if request.method == "GET":
        return HttpResponse(json.dumps({"ok": True}), content_type="application/json")
    raise RuntimeError("unsupported method")
```

- **Import 정렬**: 표준→서드파티→퍼스트파티 순서, 섹션 사이 공백 1~2 줄.  
- **E722**(bare except/Exception 남발) 같은 룰은 Ruff가 잡아줌 → 명시적 예외로.

---

## 7) 팀에 점진 도입하기 (기존 코드가 많은 경우)

1) **새 코드부터 강제**  
   - pre-commit을 설치하되 `--files` 로 변경된 파일만 검사(기본 동작).  
2) **폴더별 단계적 확대**  
   - 예: `src/new_app/**` 만 강제 → 점차 루트로 확장.  
3) **룰 그룹을 단계적 활성화**  
   - 처음엔 `E,F,W,I`(기본)만 → 이후 `UP`(pyupgrade), `B`(bugbear), `S`(bandit) 추가.  
4) **최대 줄 길이/Docstring 룰 완화**  
   - 긴 SQL/URL이 많으면 `E501` 을 ignore하거나 `line-length` 를 100~120으로 상향.  
5) **migrations 제외**  
   - 자동 생성 파일은 per-file-ignores로 린트 부담 제거.

---

## 8) 자주 쓰는 Ruff 룰 패키지

- **E, F, W**: pycodestyle/pyflakes 기반 기본 규칙(필수)  
- **I**: import 정렬(isort 대체)  
- **UP**: 최신 문법 권장(pyupgrade) → f-string 전환, `list()`→리터럴 등  
- **B**: bugbear(잠재 버그) → `B008`(mutable default) 등  
- **C4**: comprehensions 개선  
- **S**: bandit(간단 보안 체크) → 하드코딩 비밀, subprocess 위험 등  
- **D**: docstring 스타일(pep257)

> 팀/도메인에 따라 `S`(보안)은 **신중히**: 오탐이 싫다면 경고만 켜고 CI 실패는 안 하도록.

---

## 9) CI 연동 (GitHub Actions 예시)

> 로컬 pre-commit과 **동일한 훅**을 CI에서 실행 → “작동은 내 PC에서만” 제거.

```yaml
# .github/workflows/lint.yml
name: lint
on: [push, pull_request]
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.12" }
      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install ruff black pre-commit
      - name: Run pre-commit
        run: |
          pre-commit run --all-files
```

> 대규모 모노레포라면 **경로 필터**나 `pre-commit.ci` 서비스(자동 코멘트/자동수정 PR)도 고려.

---

## 10) 모노레포/하위 패키지 다중 관리

- 루트 `pyproject.toml` + 서브패키지별 `pyproject.toml` (필요시)  
- pre-commit은 **루트 기준**으로 실행하되, `exclude` 패턴을 써서 `vendor/`, `generated/` 폴더 제외.  
- Ruff의 `src` 레이아웃 인식: `tool.ruff.lint.isort.known-first-party` 에 패키지 추가.

```toml
[tool.ruff.lint.isort]
known-first-party = ["service_a", "service_b", "common_lib"]
```

---

## 11) Jupyter/노트북도 검사 (nbQA)

> 데이터 팀/분석 코드가 많다면 **nbQA**로 Ruff/Black을 노트북에 적용 가능.

```bash
pip install nbqa
```

```yaml
# .pre-commit-config.yaml (추가)
- repo: https://github.com/nbQA-dev/nbQA
  rev: 1.9.0
  hooks:
    - id: nbqa-ruff
      args: [--fix]
      files: \.ipynb$
    - id: nbqa-black
      args: [--line-length=100]
      files: \.ipynb$
```

---

## 12) .editorconfig (편집기 공통 규칙)

```ini
# .editorconfig
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
indent_style = space
indent_size = 4
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
```

---

## 13) ignore/예외 처리 — 언제, 어떻게

- 일시적 무시: `# noqa: <RULE>` (예: 긴 SQL 한 줄: `# noqa: E501`)  
- 파일 레벨: `per-file-ignores`  
- 디렉터리 레벨: pre-commit의 `exclude:` 또는 Ruff의 `extend-exclude`  
- **주의**: 무시가 늘어나면 규칙 무력화 → PR 리뷰에서 “정말 필요한가?” 승인 기준 유지.

---

## 14) 성능 & 캐시

- Ruff는 기본적으로 빠르지만, **pre-commit에서 변경 파일만 검사**되어 훨씬 경쾌.  
- `pre-commit run --all-files` 는 초기 1회만, 이후는 diff 대상만 검사.  
- CI에서는 **전체 검사**로 이탈 방지(로컬에서 빠뜨린 경우 커버).

---

## 15) 팀 합의 가이드 (정책 문서 샘플)

- **줄 길이**: 100(장문 URL/SQL 허용 시 120)  
- **문자열**: Black 기본(따옴표 변환 자동)  
- **Import**: 표준/서드파티/퍼스트파티 섹션 구분, 알파벳 정렬, as import 결합  
- **예외 처리**: `except Exception as exc:` → **특정 예외** 먼저, bare except 금지  
- **Docstring**: 공개 API는 Google 스타일, 테스트/스크립트는 선택  
- **테스트**: `tests/**` docstring 면제, 린트는 유지  
- **마이그레이션**: `migrations/**` E501 무시  
- **비밀 정보**: `.env`, 키/토큰이 코드에 들어오지 않도록 파일/경로 exclude

---

## 16) 트러블슈팅 모음

- **Black과 Ruff 충돌**: line-length/quote 등 **Black 우선**, Ruff는 포맷 룰 일부 끄기  
- **Ruff 자동수정 후 커밋 실패**: `--exit-non-zero-on-fix` 때문 → 재커밋하면 정상  
- **isort로 정렬했는데 다시 바뀜**: isort profile을 `black` 으로, 또는 Ruff만 사용  
- **운영 서버에서 느림**: 린트/포맷은 CI/개발에만. 운영 이미지는 **미리 포맷된 코드**로 빌드

---

## 17) 보너스: Git 훅 정책 팁

- **pre-commit**: 빠른 검사/자동수정  
- **pre-push**: 시간이 오래 걸리는 정적 분석/타입 체크/테스트 (옵션)  
- PR 머지 전 **CI 필수 통과**로 일관성 보장

예: pre-push에 pytest 추가(선택)

```yaml
# .pre-commit-config.yaml (추가)
- repo: local
  hooks:
    - id: pytest
      name: pytest (quick)
      entry: pytest -q -m "not slow"
      language: system
      pass_filenames: false
      stages: [push]
```

---

## 18) 체크리스트 (도입/운영)

- [ ] `pyproject.toml` 에 Ruff/Black 설정 통합  
- [ ] `.pre-commit-config.yaml` 설치 + 팀 전원 `pre-commit install`  
- [ ] **변경 파일만 검사**로 초기 진입 장벽 낮추기  
- [ ] CI에서 pre-commit 전체 검사  
- [ ] 룰 그룹(UP/B/S/C4) **점진 활성화**  
- [ ] 모노레포는 known-first-party/exclude 정리  
- [ ] 노트북(nbQA) 필요 시 도입  
- [ ] 룰 무시는 최소화 & 이유 주석

---

## 19) 최종 예제: 최소 세트 올인원

### 19.1 `pyproject.toml`

```toml
[tool.black]
line-length = 100
target-version = ["py312"]

[tool.ruff]
line-length = 100
target-version = "py312"

[tool.ruff.lint]
select = ["E","F","W","I","UP","B","C4"]
ignore = ["E501"]  # 줄 길이는 Black이 처리, 장문 URL 허용
fixable = ["ALL"]

[tool.ruff.lint.isort]
known-first-party = ["my_app"]
combine-as-imports = true
force-sort-within-sections = true
lines-after-imports = 2

[tool.ruff.lint.per-file-ignores]
"migrations/**" = ["ALL"]
"tests/**" = ["D"]
```

### 19.2 `.pre-commit-config.yaml`

```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: end-of-file-fixer
      - id: trailing-whitespace

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]

  - repo: https://github.com/psf/black
    rev: 24.8.0
    hooks:
      - id: black

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        args: [--fix]
```

### 19.3 첫 적용 명령

```bash
pre-commit install
pre-commit run --all-files
```

---

# 결론

- **Ruff + Black + pre-commit** 조합은 2025년 현재 **가장 생산적인 파이썬 코드 품질 스택**입니다.  
- **Ruff**로 대부분의 린트와 **import 정렬**을 처리하고, **Black**으로 **일관 포맷**을 보장하세요.  
- **pre-commit**으로 로컬/CI 모두 **동일 파이프라인**을 적용하면, 코드 리뷰는 **로직**에 집중하게 됩니다.
