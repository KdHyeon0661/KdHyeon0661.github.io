---
layout: post
title: AWS - 멀티 계정 전략 및 조직 관리
date: 2025-08-08 18:20:23 +0900
category: AWS
---
# 멀티 계정 전략 및 조직 관리 — **실전 확장 가이드**

> 목적: 본 문서는 기존 글의 골격(필요성 → Organizations → OU 설계 → SCP → Control Tower → 운영 모범사례)을 유지하면서, **예제 정책/코드/자동화 템플릿/운영 시나리오**까지 보강해 실무에 바로 적용 가능하도록 확장한다.  
> 규칙: 모든 **코드**는 ``` 로, 모든 **수식**은 반드시 $$...$$ 로 감싼다.

---

## 0) 한눈에 보기(요약)

- 계정은 **보안·비용·책임의 경계**다. 제품/환경/데이터 민감도별 **OU(Organizational Unit)** 로 구획하고, **Security/Network/Billing** 을 중앙 계정으로 **수렴**한다.  
- **SCP** 로 계정의 **최대 권한 상한**을 고정하고, **IAM Identity Center(SSO)** 로 권한 세트를 표준화한다.  
- **Control Tower** 로 계정 **생성→부트스트랩→가드레일**을 자동화한다.  
- **CloudTrail/Config/GuardDuty/Security Hub** 등은 **위임 관리자(Delegated Admin)** 로 중앙 계정 집계가 기본값이다.  
- 비용은 **Consolidated Billing + 태그 표준 + Budgets/Anomaly Detection** 으로 **선제 경보** 체계를 만든다.

---

## 1) 왜 멀티 계정인가? (핵심 이득 재정리)

- **보안 격리**: 한 계정의 사고가 다른 계정으로 번지지 않게 “폭발 반경” 최소화  
- **운영 독립성**: 팀·제품·환경별 거버넌스 차등 적용  
- **비용 가시성**: 청구/한도/할인(Reserved/Savings) 관리 최적화  
- **규정 준수**: 데이터 등급·보존 요건별로 통제 분리

---

## 2) AWS Organizations: 빌딩 블록

- **Organization**: 멀티 계정의 루트 컨테이너  
- **OU**: 정책(예: SCP) 상속 단위  
- **SCP**: 계정 내 **가능한 최대 권한 상한**  
- **Consolidated Billing**: 비용 통합 + 할인 공유  
- **Delegated Admin**: 보안/운영 서비스 중앙 위임(예: GuardDuty Admin)

### 2.1 기준 OU/계정 구조(확장 예시)
```
/ (Root)
├─ Security OU
│  ├─ Log-Archive (CloudTrail/Config/Access Logs, Object Lock)
│  └─ Security-Tooling (GuardDuty/Security Hub/Macie/Inspector Admin)
├─ Infrastructure OU
│  ├─ Network (TGW, Resolver, DX/VPN, FW Manager)
│  └─ Shared-Services (AD/SSO/SSM/Artifact/SRE툴)
├─ Workloads OU
│  ├─ Prod
│  ├─ Staging
│  └─ Dev
└─ Sandbox OU
   └─ Experiment
```

---

## 3) 서비스 제어 정책(SCP): 실전 라이브러리

> 원칙: **허용(Allow)** 는 IAM/리소스 정책에서, **제한(상한)** 은 SCP에서.  
> 주의: SCP는 “거부(Deny)” 중심이며, **루트 사용자 차단**, **리전 제한**, **태그 의무화**, **퍼블릭 차단** 등 **기본 가드레일**을 구성한다.

### 3.1 루트 사용자 전면 차단
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "DenyRootUser",
    "Effect": "Deny",
    "Action": "*",
    "Resource": "*",
    "Condition": {
      "StringLike": { "aws:PrincipalArn": ["arn:aws:iam::*:root"] }
    }
  }]
}
```

### 3.2 허용 리전 화이트리스트 (예: ap-northeast-2, us-east-1만)
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "DenyOtherRegions",
    "Effect": "Deny",
    "Action": "*",
    "Resource": "*",
    "Condition": {
      "ForAnyValue:StringNotEquals": {
        "aws:RequestedRegion": ["ap-northeast-2","us-east-1"]
      }
    }
  }]
}
```

### 3.3 필수 태그 없는 리소스 생성 거부 (비용/책임 추적)
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "DenyCreateWithoutTags",
    "Effect": "Deny",
    "Action": [
      "ec2:RunInstances","rds:CreateDBInstance","s3:CreateBucket","eks:CreateCluster"
    ],
    "Resource": "*",
    "Condition": {
      "Null": {
        "aws:RequestTag/CostCenter": "true",
        "aws:RequestTag/Owner": "true",
        "aws:RequestTag/Environment": "true"
      }
    }
  }]
}
```

### 3.4 IAM 사용자 금지(SSO 권장)
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "DenyIamUsers",
    "Effect": "Deny",
    "Action": ["iam:CreateUser","iam:CreateAccessKey","iam:PutUserPolicy"],
    "Resource": "*"
  }]
}
```

### 3.5 S3 퍼블릭 차단 강제(리소스 정책 병행 권장)
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "DenyS3PublicAclPolicy",
    "Effect": "Deny",
    "Action": ["s3:PutBucketPolicy","s3:PutBucketAcl"],
    "Resource": "arn:aws:s3:::*",
    "Condition": { "StringEquals": { "s3:PublicAccessBlockConfiguration.IgnorePublicAcls": "false" } }
  }]
}
```

> 팁: 위 예시는 **패턴**이다. 실제 제약 항목과 조건키는 조직 표준에 맞게 조정한다.

---

## 4) AWS Control Tower: 계정 수명주기 자동화

- **Landing Zone**: 표준 OU/계정/가드레일 자동 배치  
- **Account Factory**: 템플릿 기반 계정 생성(OU·이메일·권한세트)  
- **가드레일(Guardrails)**: 필수/권장 설정 자동 준수(탐지/예방형 혼합)

### 4.1 계정 생성 자동화(예: Organizations CLI)
```bash
aws organizations create-account \
  --email "dev-team@example.com" \
  --account-name "Dev-Team-Account" \
  --role-name "OrganizationAccountAccessRole" \
  --iam-user-access-to-billing ALLOW
```

### 4.2 부트스트랩(예: 필수 역할/로그 수집/에이전트 설치)
- SSM/SSO/CloudWatch 에이전트/Config/GuardDuty 가입을 **Account Vending 파이프라인**에 포함
- Drift 감지 및 재적용(재부트스트랩) 자동화

---

## 5) 중앙 로깅/감사 아키텍처(보안 계정)

### 5.1 CloudTrail 조직 트레일 + S3(Object Lock)
- **모든 계정/리전**의 관리·데이터 이벤트 수집
- **Log-Archive** 버킷: 버전관리 + **Object Lock(WRITE-ONCE)** + KMS 암호화

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid":"AllowOrgTrails",
      "Effect":"Allow",
      "Principal":{"Service":"cloudtrail.amazonaws.com"},
      "Action":"s3:PutObject",
      "Resource":"arn:aws:s3:::org-cloudtrail-logs/AWSLogs/*",
      "Condition":{"StringEquals":{"aws:PrincipalOrgID":"o-xxxxxxxxxx"}}
    },
    {
      "Sid":"DenyDelete",
      "Effect":"Deny",
      "Principal":"*",
      "Action":["s3:DeleteObject","s3:PutLifecycleConfiguration"],
      "Resource":"arn:aws:s3:::org-cloudtrail-logs/*"
    }
  ]
}
```

### 5.2 AWS Config Aggregator
```yaml
Resources:
  OrgConfigAggregator:
    Type: AWS::Config::ConfigurationAggregator
    Properties:
      OrganizationAggregationSource:
        AllAwsRegions: true
        RoleArn: arn:aws:iam::111111111111:role/OrgConfigAggRole
```

### 5.3 GuardDuty · Security Hub · Macie · Inspector (위임 관리자)
- **Security-Tooling** 계정에 각 서비스 관리자 위임 → **모든 계정 자동 등록**
- 탐지 이벤트 → EventBridge → SNS/ChatOps/Lambda 자동조치

---

## 6) 신원·접근: SSO/권한세트/역할 모델

### 6.1 IAM Identity Center(SSO) 권한세트 표준
- 읽기/개발/운영/보안 등 **권한 레벨 격자** 설계
- 각 권한세트는 **관리형 정책 + 커스텀** 조합

```json
{
  "Version":"2012-10-17",
  "Statement":[
    {"Effect":"Allow","Action":["ec2:Describe*","eks:List*","rds:Describe*","s3:ListAllMyBuckets"],"Resource":"*"},
    {"Effect":"Allow","Action":["cloudwatch:Get*","logs:Describe*","logs:Get*"],"Resource":"*"}
  ]
}
```

### 6.2 교차계정 운영(AssumeRole)
- 운영/보안 인원은 **중앙 IdP → SSO → 타계정 역할 가정**  
- **Break-glass Role**(비상용) 은 별도 MFA/승인 절차·감사 로그 필수

---

## 7) 네트워크(개요): 중앙 허브 & 일관성

> 본 글의 초점은 “멀티 계정”이지만, **네트워크 표준**이 계정 거버넌스의 핵심이므로 요약을 포함한다.

- **Network 계정**에 **Transit Gateway**, **Route 53 Resolver**, **(선택) Network Firewall/GWLB**  
- **VPC 공유(Shared VPC)** 또는 **TGW 허브-스포크**로 일관 설계  
- **VPC Endpoint Policy** 로 S3/DynamoDB 등 서비스 접근 최소화

```json
{
  "Statement":[
    {
      "Effect":"Allow",
      "Principal":"*",
      "Action":["s3:GetObject","s3:ListBucket"],
      "Resource":["arn:aws:s3:::corp-artifacts","arn:aws:s3:::corp-artifacts/*"],
      "Condition":{"StringEquals":{"aws:SourceVpce":"vpce-0abc..."}}
    }
  ]
}
```

---

## 8) 비용/FinOps: 통합 청구 → 태그 → 예산/이상탐지 → 약정 최적화

### 8.1 필수 태그 표준(조직 정책)
- `CostCenter`, `Project`, `Owner`, `Environment`, `ExpireAt(ISO8601)`  
- **Tag Policy** + **SCP(미태깅 거부)** + **Config Rule** 로 준수 강제

### 8.2 예산/경보 자동화(Budgets)
```bash
aws budgets create-budget --account-id 123456789012 --budget '{
  "BudgetName":"Prod-Monthly",
  "BudgetLimit":{"Amount":"5000","Unit":"USD"},
  "TimeUnit":"MONTHLY",
  "BudgetType":"COST"
}' --notifications-with-subscribers '[
  {"Notification":{"NotificationType":"ACTUAL","ComparisonOperator":"GREATER_THAN","Threshold":80,"ThresholdType":"PERCENTAGE"},
   "Subscribers":[{"SubscriptionType":"EMAIL","Address":"finops@example.com"}]}
]'
```

### 8.3 비용 모델 간략 수식(커버리지 의사결정)
$$
\text{월비용} \approx c\cdot U\cdot p_c + (1-c)\cdot U\cdot p_o
$$
- \(U\): 예상 사용량, \(p_o\): 온디맨드 단가, \(p_c\): 약정 단가, \(c\): 커버리지  
- 목표는 **업무 변동성**을 고려한 \(c^*\) (커버리지) 산출

### 8.4 Cost Categories / Anomaly Detection
- 계정/OU/프로젝트 축으로 비용 분할 보고서  
- 급증 패턴 자동 경보 → **티켓/ChatOps** 연계

---

## 9) 데이터 보호/KMS: 다계정 키 전략

- **SSE-KMS** 기본화(S3/EBS/RDS/EFS)  
- **Key Policy + Grants** 로 타계정 롤에게 최소권한 부여

```json
{
  "Version":"2012-10-17",
  "Statement":[
    {"Sid":"Admin","Effect":"Allow",
     "Principal":{"AWS":"arn:aws:iam::111111111111:root"},
     "Action":"kms:*","Resource":"*"},
    {"Sid":"UseKeyFromProdApps","Effect":"Allow",
     "Principal":{"AWS":"arn:aws:iam::222222222222:role/app-prod"},
     "Action":["kms:Encrypt","kms:Decrypt","kms:GenerateDataKey*","kms:DescribeKey"],
     "Resource":"*"}
  ]
}
```

---

## 10) 운영 모범사례: 중앙·표준·자동화

1. **계정 역할 기반 접근**: 루트 금지, SSO + AssumeRole  
2. **중앙집중 로깅**: CloudTrail/Config/Flow/DNS/ALB Logs → Log-Archive  
3. **보안 계정 분리**: Security-Tooling 에서 탐지/평가/허브 운영  
4. **비용 관리**: 태그 표준 + Consolidated Billing + 예산/이상탐지  
5. **네트워크 표준화**: TGW/Shared VPC/Endpoint Policy  
6. **계정 생명주기**: 생성 → 가드레일 → 부트스트랩 → 폐기 표준 절차  
7. **변경관리/배포**: IaC(Terraform/CF/CDK), Change sets, Drift 감시  
8. **감사/준수**: CIS/AWS FSBP Security Hub 점수 관리, 예외 승인 만료일 명시

---

## 11) 계정 생명주기 플레이북(샘플)

### 11.1 온보딩
- 요청서: OU/소유자/이메일/권한세트/태그 템플릿  
- Account Factory 실행 → **SCP/가드레일/SSO 권한** 자동 할당  
- 부트스트랩: SSM 에이전트/CloudWatch/Config/GuardDuty 등록

### 11.2 런타임
- 월간 **비용/보안/운영** 리뷰(대시보드)  
- 태그 준수/퍼블릭 노출 검사 자동 리포트

### 11.3 오프보딩
- 데이터 백업 이동(Log-Archive)  
- 역할/시크릿/키 폐기  
- 비용 정리/해지

---

## 12) 실전 구성 예제(코드·템플릿 모음)

### 12.1 Terraform – OU·계정·SCP 최소 예
```hcl
provider "aws" { region = "ap-northeast-2" }

resource "aws_organizations_organization" "org" {
  feature_set = "ALL"
}

resource "aws_organizations_organizational_unit" "workloads" {
  name      = "Workloads"
  parent_id = aws_organizations_organization.org.roots[0].id
}

resource "aws_organizations_policy" "deny_other_regions" {
  name        = "DenyOtherRegions"
  description = "Only ap-northeast-2, us-east-1 allowed"
  type        = "SERVICE_CONTROL_POLICY"
  content     = file("scp-deny-other-regions.json")
}

resource "aws_organizations_policy_attachment" "attach_scp" {
  policy_id = aws_organizations_policy.deny_other_regions.id
  target_id = aws_organizations_organizational_unit.workloads.id
}

resource "aws_organizations_account" "dev" {
  name      = "Dev-Account"
  email     = "dev-team@example.com"
  parent_id = aws_organizations_organizational_unit.workloads.id
  role_name = "OrganizationAccountAccessRole"
}
```

### 12.2 CloudFormation – Config Aggregator 요약
```yaml
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  Aggregator:
    Type: AWS::Config::ConfigurationAggregator
    Properties:
      OrganizationAggregationSource:
        AllAwsRegions: true
        RoleArn: arn:aws:iam::111111111111:role/OrgConfigAggRole
```

### 12.3 예산 생성(Budgets CLI)
```bash
aws budgets create-budget --account-id 123456789012 --budget '{
  "BudgetName":"DevOU-Monthly",
  "BudgetLimit":{"Amount":"1000","Unit":"USD"},
  "TimeUnit":"MONTHLY","BudgetType":"COST"
}'
```

---

## 13) 운영 시나리오(예제)

### 13.1 새 제품팀 온보딩
1) 요청 접수 → OU(Dev/Staging/Prod) 결정  
2) Control Tower Account Factory 실행 → SSO 권한세트 매핑  
3) 기본 태그 정책/예산 알림/버킷 퍼블릭 차단/엔드포인트 정책 적용  
4) 네트워크 계정에서 Shared VPC 서브넷 할당 or TGW Attachment 생성

### 13.2 비용 급등 탐지 → 즉시 조치
- Anomaly Detector 경보 → ChatOps  
- 임시 SCP로 비인가 리전/서비스 생성 차단  
- Cost Explorer로 드릴다운 → 리포트 & RCA

### 13.3 퍼블릭 노출 탐지
- Security Hub/Config Rule 위반 → EventBridge → Lambda  
- S3 Public Block 재적용, SG 0.0.0.0/0 차단, 티켓 생성

---

## 14) 검증(테스트) 체크리스트

- [ ] **SCP** 가 실제로 금지 동작(리전/태그/루트) 못 하게 막는가  
- [ ] 신규 계정이 **자동**으로 CloudTrail/Config/GuardDuty 에 등록되나  
- [ ] **SSO 권한세트**가 일관 적용되고 Break-glass는 MFA/감사 기록이 남는가  
- [ ] **태그 정책** 미준수 리소스 탐지/차단이 작동하는가  
- [ ] **예산/이상탐지** 경보가 실제 메일/ChatOps로 수신되는가

---

## 15) FAQ (확장)

**Q. OU를 세분화할수록 좋은가?**  
A. 정책 경계 최소 세트(보안 수준/데이터 민감도/환경)만 OU로, 팀·프로젝트는 태그/Cost Category로 분리하는 것이 민첩하다.

**Q. IAM 유저를 꼭 금지해야 하나?**  
A. SSO(Identity Center)로 단일 신원·MFA·세션 가시성을 확보하는 것이 운영·감사·폐기 측면에서 유리하다.

**Q. TGW vs Shared VPC?**  
A. 조직 규모·리전 수·온프레 연계가 크면 TGW, 단일 리전·중앙 거버넌스가 목표면 Shared VPC가 단순하다.

---

## 16) 결론

멀티 계정은 **격리(분리)** 와 **통합(집중)** 의 균형 예술이다.  
OU와 SCP로 경계를 **명확히** 하고, SSO/Control Tower/보안·비용 플랫폼을 **중앙화**하여 **표준·자동화·관측성**을 확보하라.  
본 문서의 **정책·코드 템플릿**을 바탕으로, 조직 상황에 맞춘 **표준 카탈로그**(계정/네트워크/보안/비용)를 만들고 분기별로 갱신하라.
