---
layout: post
title: 정보보안기사 - 취약점 점검, 무결성 점검,. 루트킷 점검
date: 2025-11-13 23:25:23 +0900
category: 정보보안기사
---
# · 02. 무결성 점검(Tripwire) · 03. 루트킷 점검(chkrootkit)

## → 보호(Protect) → 탐지(Detect) → 대응(Respond) → 복구(Recover)”

시스템 점검 도구는 세 갈래로 정리된다.

- **취약점 점검(Identify)**: 서비스·구성의 약점을 자동 탐색.
  - 네트워크/호스트 전반: **Nessus**
  - 웹 서버/웹 애플리케이션 표면: **Nikto**
- **무결성 점검(Detect/Protect)**: **Tripwire**로 “정상 상태 스냅샷(베이스라인)”을 보관하고, 변경 발생 시 탐지.
- **루트킷 점검(Detect)**: **chkrootkit**으로 은폐·갈취 목적의 변조 흔적 탐지.

운영에서 중요한 것은 **도구별 역할을 섞지 않는 것**, 그리고 **자동화 파이프라인**(정책·스케줄·보고·수정·재검증)을 갖추는 것이다.

```
[스캔 범위·허가서] -> [Nessus/Nikto] -> [취약점 큐레이션] -> [조치 티켓] -> [재검증]
                             |                            ^
                         [Tripwire] <--(변경 탐지/복구)---|
                             |
                        [chkrootkit] (의심 시 즉시 점검)
```

---

## 점검 도구 — Nessus / Nikto

### 공통 원칙(윤리·안전)

- **스코프/허가서**: 대상 IP/도메인/시간 창, 공격성 테스트 허용 범위 명시.
- **무중단 우선**: 생산계는 “안전 점검(Safe Checks)”·지연/레이트리밋 적용.
- **크리덴셜 기반(권장)**: SMB/SSH/WMI 자격증명을 사용하면 정확도↑, 오탐↓.
- **결과 해석**: **CVSS v3.1/v4.0**, 영향도(가용성/기밀성/무결성), 악용 가능성(Exploitability), 노출 범위 함께 본다.
- **재현·재검증**: 패치/설정 후 동일 조건으로 재스캔하여 “해결 확인(Close)” 처리.

---

### Nessus — 네트워크/호스트 통합 취약점 스캐너

#### 설치 및 서비스

> 배포판과 라이선스(에센셜/프로/매니지드)에 따라 패키지가 상이하다. 아래는 개념 단계와 서비스 제어 예시.

```bash
# 설치 후 데몬 제어

sudo systemctl enable nessusd
sudo systemctl start nessusd
sudo systemctl status nessusd

# 초기 셋업/관리(버전에 따라 명령어 상이)

sudo /opt/nessus/sbin/nessuscli update            # 플러그인 업데이트
sudo /opt/nessus/sbin/nessuscli fetch --challenge # 오프라인 업데이트용 토큰 요청
sudo /opt/nessus/sbin/nessuscli adduser           # UI 접근용 계정 생성
```

- **콘솔 접근**: `https://<scanner>:8834/`
- **템플릿**: Basic Network Scan, Advanced Network Scan, Web Application Tests 등.
- **크리덴셜 스캔**:
  - Windows: SMB/WMI/WinRM, 관리자 권한 필요(권장: 전용 로컬 계정+PAM 토큰).
  - Linux: SSH(비밀키 권장), `sudo` 최소권한 명시.

#### 스캔 구성 핵심 체크리스트

- **Safe Checks**: 제품/운영 환경 영향 최소화.
- **포트 스캐너**: SYN/UDP/서비스 식별(버전) 활성화.
- **인증 옵션**: 실패 시 로그로 원인 분석(계정/권한/방화벽).
- **정책 예외**: 관리 네트워크, 백업/복제 링크 등 제외 범위 명확화.
- **스케줄링**: 개발/스테이징은 주 1회↑, 생산은 변경 전후/월간 정기.

#### 예제 — /24 대역 스캔(요구사항: 안전 점검 + 크리덴셜)

1) 템플릿: *Advanced Network Scan*
2) Targets: `10.10.20.0/24`
3) Port Scanning: SYN(1–65535) + Service Detection
4) Credentials:
   - SSH 사용자 `scanner`, 키 인증 + 필요 명령만 `sudo` 허용
   - SMB: 읽기 전용 레지스트리 조회 권한
5) Performance: 동시성 제한(예: 10)
6) Safe Checks: Enabled → 운영 영향 최소화

> 결과 해석: **Critical/High 우선** → “노출 서비스/취약 서비스/패치 누락/약한 암호화”의 네 범주로 분류 후 조치.

#### 결과 활용 — XML/JSON 내보내기 & 요약 추출

Nessus는 `.nessus(XML)` 또는 JSON 내보내기를 지원한다(버전에 따라 API 키 필요).

```bash
# Nessus 결과를 XML(.nessus)로 저장했다고 가정

nessus_report="/reports/vscan_2025-11-12.nessus"

# Python으로 High 이상 취약점 CSV 요약 추출(간단 예시)

```

```python
import xml.etree.ElementTree as ET
import csv

tree = ET.parse('/reports/vscan_2025-11-12.nessus')
root = tree.getroot()

rows = []
for report in root.iter('Report'):
    for host in report.iter('ReportHost'):
        ip = host.attrib.get('name')
        for item in host.iter('ReportItem'):
            risk = item.attrib.get('severity')  # 4=Critical, 3=High, 2=Medium...
            if risk in ('3', '4'):
                name = item.attrib.get('pluginName')
                port = item.attrib.get('port')
                svc  = item.attrib.get('svc_name')
                cves = ','.join([c.text for c in item.findall('cve')])
                desc = (item.find('description').text or '').strip()[:200]
                rows.append([ip, port, svc, risk, name, cves, desc])

with open('/reports/vscan_high.csv', 'w', newline='', encoding='utf-8') as f:
    writer = csv.writer(f)
    writer.writerow(['IP','Port','Service','Severity','Plugin','CVEs','Description'])
    writer.writerows(rows)
```

---

### Nikto — 웹 서버 취약 구성/노출 점검

#### 목적과 범위

- **HTTP/HTTPS 서버의 일반적 취약 설정/파일/디폴트 페이지/구성 누락** 탐지에 특화.
- “웹앱 논리”보다는 **서버 표면(Headers/메소드/디렉터리/구성)** 관점.
- OWASP ZAP/Burp와 상호 보완(크롤링/액티브 스캔은 별도 도구에 더 적합).

#### 설치 & 업데이트

```bash
# Debian/Ubuntu

sudo apt-get update && sudo apt-get install -y nikto

# 서명/DB 업데이트(패키지 버전에 따라 자동/수동)

nikto -update
```

#### 사용 예시

```bash
# 기본 스캔

nikto -h https://app.example.com

# 포트 지정/멀티포트

nikto -h 10.10.30.15 -p 80,443

# 특정 경로 루트(가상호스트)·SSL·SNI 환경

nikto -h app.example.com -root / -ssl

# 출력 포맷/저장(CSV/JSON/HTML은 배포판에 따라 옵션 상이)

nikto -h app.example.com -o nikto_app.csv -Format csv

# — 숫자는 카테고리 ID, 조합 가능

nikto -h app.example.com -Tuning 123b
```

> **주의**: Nikto는 공격 트래픽이 아닌 “정보 수집/구성 점검” 성격이다. WAF/레이트리밋 정책과 충돌 없도록 속도 조정(`-timeout`, `-maxtime`)을 권장.

#### Nikto 결과 해석 샘플(요약)

```
+ Target IP:          10.10.30.15
+ Target Hostname:    app.example.com
+ Port:               443 TLS
+ Server:             nginx/1.24.0
+ Retrieved via:      HTTP/1.1
+ Allowed Methods:    GET, HEAD, POST
+ /server-status:     403 (Apache mod_status-like path exposed?)
+ X-Frame-Options:    MISSING
+ X-Content-Type-Options: MISSING
+ /backup.zip:        200 (Potential sensitive archive)
+ OSVDB-3233:         /icons/ (Default icons directory)
+ End Time:           2025-11-12 04:22:19 (GMT+9)
```

- **우선 조치 후보**: 백업 파일/디렉터리 노출 제거, 보안 헤더 추가, 불필요 메소드 차단.

#### Nmap과의 파이프라인 — “웹 포트 감지 → Nikto 연동”

```bash
# Nmap으로 웹 포트가 열린 호스트 추출

nmap -p 80,443,8080,8443 10.10.30.0/24 --open -oG - | \
awk '/Ports:/{print $2}' > /tmp/webhosts.txt

# Nikto 병렬 스캔(단, 속도/부하 주의)

cat /tmp/webhosts.txt | xargs -I{} -P 4 \
nikto -h {} -o /reports/nikto_{}.html -Format htm
```

---

## 점검 도구 — Tripwire

### 개념 — “베이스라인과 차이(Delta)”

- **베이스라인**: “신뢰하는 상태”의 파일 목록·속성·해시를 기록.
- 이후 **변경(추가/삭제/수정)**이 감지되면 **경보/보고**.
- 핵심 디렉터리: `/etc`, `/usr/bin`, `/sbin`, 애플리케이션 설정/바이너리, 중요 스크립트.
- 반대로 **휘발/자주 변경**되는 경로(`/var/log`, `/tmp`, 캐시, 스풀)는 **정책에서 제외/완화**.

> 해시 함수는 충돌 저항성이 높은 알고리즘을 사용(운영 정책에 맞춰 설정). Tripwire OSS는 SHA, Whirlpool 등 다중 선택을 지원(배포판·패키지에 의존).

### 설치·키 생성·정책 초기화(개념 순서)

```bash
# 설치

sudo apt-get update && sudo apt-get install -y tripwire

# 사이트/로컬 키 생성(프롬프트에 따라 암호 입력)

sudo twadmin --generate-keys --site-keyfile /etc/tripwire/site.key
sudo twadmin --generate-keys --local-keyfile /etc/tripwire/$(hostname)-local.key

# 생성(정책 템플릿 편집 후 컴파일)

sudo twadmin --create-polfile /etc/tripwire/twpol.txt

# 베이스라인 초기화(스냅샷)

sudo tripwire --init
```

### 커스터마이징 — 예시 스니펫

> 실제 문법은 배포된 `twpol.txt` 템플릿을 기준으로 한다.

```text
(
  rulename = "System Binaries (Critical)",
  severity = 100
)
{
  /bin      ->  $(ReadOnly) ;
  /sbin     ->  $(ReadOnly) ;
  /usr/bin  ->  $(ReadOnly) ;
  /usr/sbin ->  $(ReadOnly) ;
}

(
  rulename = "System Config",
  severity = 90
)
{
  /etc      ->  $(SEC_CONFIG) (recurse=1);
}

# 자주 변하는 경로는 제외 또는 속성 완화

(
  rulename = "Volatile/Logs (Ignored)",
  severity = 0
)
{
  /var/log  -> $(IgnoreAll) ;
  /tmp      -> $(IgnoreAll) ;
}
```

- **속성 프리셋 예시**: `$(ReadOnly)` = 권한, 소유자, 해시 등 변경 감지 / `$(IgnoreAll)` = 무시.
- 정책 변경 후에는 **재컴파일 → 재초기화**가 필요할 수 있다.

```bash
sudo twadmin --create-polfile /etc/tripwire/twpol.txt
sudo tripwire --init
```

### 정기 점검·보고·업데이트

```bash
# 수동 점검

sudo tripwire --check

# 리포트 보기

sudo twprint --print-report --report-level 4 --twrfile /var/lib/tripwire/report/<HOST>-YYYYMMDD-HHMMSS.twr

# 변경 승인(정상 변경분을 베이스라인에 반영)

sudo tripwire --update -r /var/lib/tripwire/report/<HOST>-YYYYMMDD-HHMMSS.twr
```

- **운영 팁**: 배포/패치 직후 대량 변경이 정상. 이때 “변경 승인(update)”을 수행해 **오탐**을 줄인다.
- **중요**: *의심 변경은 승인 금지*, 샘플링·조사 후 베이스라인 반영 여부 결정.

### Cron/SIEM 연동(간단 예시)

```bash
# /etc/cron.d/tripwire (매일 03:15 점검)

15 3 * * * root /usr/sbin/tripwire --check --quiet && \
  /usr/sbin/twprint --print-report --twrfile $(ls -t /var/lib/tripwire/report/*.twr | head -1) \
  | mail -s "[Tripwire] Daily report $(hostname)" sec-ops@example.com
```

---

## 점검 도구 — chkrootkit

### 개념 — 루트킷의 유형과 탐지 관점

- **유저랜드 루트킷**: `ps`, `ls`, `netstat` 등 명령의 출력 조작.
- **커널/모듈형 루트킷**: 시스템 콜/네트워크 스택 후킹, 은폐 정교.
- **탐지 기법**:
  - 알려진 시그니처/파일 경로·패턴 검사
  - “정상 출력”과 **이중 확인**(예: `/proc` 직접 확인)
  - 의심 포트/프로세스/모듈 탐지

### 설치·실행

```bash
# Debian/Ubuntu

sudo apt-get update && sudo apt-get install -y chkrootkit

# 기본 점검(소음 줄이기 위해 -q)

sudo chkrootkit -q

# 특정 디렉터리 루트 지정(-r)

sudo chkrootkit -r /
```

### 출력 해석(예시)

```
ROOTKIT CHECKING...
chkproc: nothing deleted
Searching for suspicious files and dirs...  Nothing found
Checking `bindshell'... INFECTED (PORTS: 465)
Checking `lkm'... nothing found
...
```

- `INFECTED`는 **의심**이지 확정이 아니다. 실제로는 정당한 서비스(예: SMTPs/465)일 수 있다.
- **다음 단계**: 해당 포트 프로세스/바이너리·실행 경로를 확인하고, 패키지 소스/서명/해시를 검증한다.

```bash
# 포트 465를 리스닝 중인 프로세스 파악

sudo ss -lntp | grep :465

# 프로세스 바이너리 경로·서명·무결성 검사

sudo readlink -f /proc/<pid>/exe
sudo dpkg -S /path/to/binary  # Debian/Ubuntu: 어떤 패키지 소속인지
sudo debsums -s <pkgname>     # 패키지 파일 무결성(설치된 해시와 비교)
# RHEL/Alma

sudo rpm -V <pkgname>         # 변조 여부(V=verify)
```

### 의심 모듈 조사

```bash
# 로드된 모듈 확인

lsmod | head

# 모듈 정보

modinfo suspicious.ko

# dmesg에서 의심 메시지

dmesg -T | egrep -i 'taint|module|error|oops'
```

### 포렌식·대응(요약 플레이북)

1) **격리**: 네트워크 분리(필요 서비스만 유지), 계정/키 일시 폐기.
2) **휘발성 수집**: 프로세스 트리, 네트워크 소켓, 열린 파일, 메모리 덤프(허용 시).
3) **지속성 훑기**: `systemd` 유닛, `cron`, `/etc/rc*.d`, `~/.bashrc`/`~/.ssh/authorized_keys` 등.
4) **무결성 확인**: Tripwire/AIDE, 패키지 DB 검증, 해시 비교.
5) **재이미징 권고**: 커널 레벨 감염 의심이면 **복구보다 재설치**가 안전.
6) **원인분석**: 최초 유입(취약 서비스/자격증명 탈취), 수평 이동 흔적, 외부 C2.
7) **재발 방지**: 패치·구성 강화, MFA/PAM, 네트워크 분리, EDR·로그 상관 룰.

---

## 실전 시나리오 통합 예제 — “웹서버 취약점 → 변경 탐지 → 루트킷 의심”

### 상황

- 외부 점검 중 **Nikto**가 `/backup.zip` 노출을 탐지.
- **Nessus**에서 동일 서버에 OpenSSH 구버전(High) 보고.
- **운영팀** 조사 결과, 지난주 Tripwire 리포트에 `/var/www/html/.well-known/` 내부 **정체불명 바이너리** 추가가 감지되었으나 승인 누락.
- 오늘 새벽 **chkrootkit**이 `INFECTED (PORTS: 465)` 경고를 출력.

### 대응 절차(핵심)

1) **서비스 중단 없이 격리**: 방화벽으로 외부→해당 서버의 비표준 포트 차단.
2) **증적 확보**: Tripwire 최신 리포트·chkrootkit 로그·웹서버 접근 로그/프로세스 스냅샷 보관.
3) **백업 파일 제거 및 루트 원인**: 백업 프로세스 정책 수정(디렉터리 외부 노출 방지).
4) **SSH 패치/재시작** 및 **Tripwire 업데이트**(정상 변경만 반영).
5) **465 리스닝 확인**: `ss -lntp` → 실제는 MTA의 SMTPS, 설정 정상 확인 → false positive로 분류.
6) **재검증**: Nikto/Nessus 재스캔 → 노출/취약점 해소 확인.

---

## 운영 자동화 스니펫 모음

### Nikto 결과에서 위험 항목만 요약

```bash
# HTML/CSV로 저장된 nikto 결과를 grep/awk로 요약 추출(간단)

grep -E "MISSING|Directory|backup|Admin|Trace|PUT|DELETE" nikto_app.csv \
  | awk -F',' '{print $1","$2","$5","$7}'
```

### Tripwire 마지막 리포트 SIEM 전송

```bash
LAST=$(ls -t /var/lib/tripwire/report/*.twr | head -1)
sudo twprint --print-report --twrfile "$LAST" \
 | curl -s -X POST -H "Content-Type: text/plain" \
   --data-binary @- https://siem.example.com/ingest/tripwire
```

### chkrootkit 정례 점검 + 알림

```bash
OUT=$(mktemp)
sudo chkrootkit -q > "$OUT"
if grep -q "INFECTED" "$OUT"; then
  mail -s "[ALERT] chkrootkit INFECTED on $(hostname)" sec-ops@example.com < "$OUT"
fi
rm -f "$OUT"
```

---

## 도구 선택 가이드 & 한계

| 목적 | 1차 도구 | 보완 |
|---|---|---|
| 범용 취약점(네트워크/호스트) | Nessus | 권한 기반 스캔·패치 관리 연계 |
| 웹서버/구성 노출 | Nikto | WAF/DAST(ZAP/Burp)와 병행 |
| 파일 무결성 | Tripwire | AIDE 등 대체/보완, 배포 파이프라인과 연동 |
| 루트킷 탐지 | chkrootkit | rkhunter 병행, 오탐 검증 절차 필수 |

- **Nessus**: 광범위 탐지, 정책/보고 우수. 다만 **인증 실패 시 품질 급락**.
- **Nikto**: 간단·빠른 웹 표면 점검. **논리적 취약점/인증 흐름**은 다른 도구와 병행.
- **Tripwire**: 변경 탐지의 표준 교본. **정책 설계/승인 프로세스**가 핵심.
- **chkrootkit**: 가벼운 1차 점검. **오탐 많을 수 있으며** “의심 신호”로 해석.

---

## 점검 보고서 템플릿(요약)

| 구분 | 요약 |
|---|---|
| 스코프 | 10.10.20.0/24, `app.example.com` |
| 일정 | 2025-11-12 01:00–04:00 (KST) |
| 도구/버전 | Nessus (플러그인 yyyy-mm-dd), Nikto 2.x, Tripwire OSS, chkrootkit 0.xx |
| 상위 리스크 | 1) 백업 파일 노출 2) SSH 구버전 3) 보안 헤더 미구현 |
| 근본 원인 | 배포 파이프라인에서 정적 파일 예외 미설정 / 패치 윈도 미준수 |
| 조치 | 백업 경로 비공개화, SSH 패치, Nginx 보안 헤더 추가, Tripwire 정책 조정 |
| 재검증 | 2025-11-12 16:00 KST 재스캔 완료(High 이상 0건) |

---

## 마무리

- **Nessus/Nikto**로 **표면 위험을 식별**하고, **Tripwire**로 **정상 상태를 고정**하며, **chkrootkit**으로 **의심 신호를 즉시 가려내는** 삼각 체계를 갖추자.
- 성공의 열쇠는 **스코프·허가·정책 일관성**, **변경 승인 절차**, **재검증 루프**다.
- 도구는 “시작점”이다. **조치·검증·지속 개선**이 곧 품질이다.
