---
layout: post
title: AspNet - ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì˜ì¡´ì„± ì£¼ì…
date: 2025-03-12 19:20:23 +0900
category: AspNet
---
# ğŸ”Œ ASP.NET Coreì—ì„œ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì˜ì¡´ì„± ì£¼ì… (DI)

ASP.NET CoreëŠ” **ì˜ì¡´ì„± ì£¼ì…(Dependency Injection, DI)**ì„ ê¸°ë³¸ìœ¼ë¡œ ì§€ì›í•©ë‹ˆë‹¤.  
ê·¸ ì¤‘ì—ì„œë„ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì´ ë°”ë¡œ **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DI**ì…ë‹ˆë‹¤.

ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì‹¤ì œ êµ¬í˜„ê³¼ì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ ,  
í…ŒìŠ¤íŠ¸ì™€ ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ ë§Œë“œëŠ” í•µì‹¬ ê°œë…ì…ë‹ˆë‹¤.

---

## ğŸ§  ì™œ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DIë¥¼ ì‚¬ìš©í• ê¹Œ?

### âœ… ë¬¸ì œ ìƒí™© (ê°•í•œ ê²°í•© êµ¬ì¡°)

```csharp
public class OrderService
{
    private readonly EmailSender _emailSender = new EmailSender();

    public void PlaceOrder()
    {
        // ì£¼ë¬¸ ì²˜ë¦¬
        _emailSender.Send("ì£¼ë¬¸ ì™„ë£Œ");
    }
}
```

- `OrderService`ëŠ” `EmailSender`ì˜ êµ¬ì²´ êµ¬í˜„ì— ê°•í•˜ê²Œ ë¬¶ì—¬ ìˆìŒ.
- í…ŒìŠ¤íŠ¸ë‚˜ ë¡œê¹…, ëŒ€ì²´ êµ¬í˜„ ì ìš©ì´ ì–´ë µë‹¤.

---

### âœ… í•´ê²°ì±…: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DI

```csharp
public interface IEmailSender
{
    void Send(string message);
}

public class EmailSender : IEmailSender
{
    public void Send(string message)
    {
        Console.WriteLine($"ğŸ“§ Email: {message}");
    }
}

public class OrderService
{
    private readonly IEmailSender _emailSender;

    public OrderService(IEmailSender emailSender)
    {
        _emailSender = emailSender;
    }

    public void PlaceOrder()
    {
        // ì£¼ë¬¸ ì²˜ë¦¬
        _emailSender.Send("ì£¼ë¬¸ ì™„ë£Œ");
    }
}
```

â†’ ì‹¤ì œ êµ¬í˜„ì²´ëŠ” ì™¸ë¶€ì—ì„œ ì£¼ì…ë¨ (ëŠìŠ¨í•œ ê²°í•©)

---

## âš™ï¸ ì„œë¹„ìŠ¤ ë“±ë¡ ë°©ë²•

### ğŸ“„ `Program.cs` ë˜ëŠ” `Startup.cs`

```csharp
builder.Services.AddScoped<IEmailSender, EmailSender>();
builder.Services.AddScoped<OrderService>();
```

- `OrderService`ë¥¼ ìƒì„±í•  ë•Œ, ASP.NET Coreê°€ `IEmailSender`ë¥¼ ìë™ìœ¼ë¡œ `EmailSender`ë¡œ ì£¼ì…í•´ì¤Œ.

---

## ğŸ“„ Razor Page / Controllerì—ì„œ ì£¼ì…ë°›ê¸°

```csharp
public class IndexModel : PageModel
{
    private readonly OrderService _orderService;

    public IndexModel(OrderService orderService)
    {
        _orderService = orderService;
    }

    public void OnGet()
    {
        _orderService.PlaceOrder();
    }
}
```

â†’ ìƒì„±ìì— ì„ ì–¸ë§Œ í•˜ë©´ DI ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ ì£¼ì…í•´ì¤Œ.

---

## ğŸ§ª DI íë¦„ ì‹œê°í™”

```text
ì¸í„°í˜ì´ìŠ¤: IEmailSender
         â†“
ë“±ë¡: AddScoped<IEmailSender, EmailSender>()
         â†“
ì‚¬ìš©: ìƒì„±ìì— IEmailSender ì£¼ì…
         â†“
ì‹¤í–‰ ì‹œ ì‹¤ì œ êµ¬í˜„ì²´ EmailSender ì¸ìŠ¤í„´ìŠ¤ ì „ë‹¬ë¨
```

---

## ğŸ§ª ì‹¤ì „ ì˜ˆì œ: SMS ì „ì†¡ê¸° êµ¬í˜„ êµì²´í•˜ê¸°

### 1. ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```csharp
public interface IMessageSender
{
    void Send(string message);
}
```

---

### 2. êµ¬í˜„ì²´ 1 - Email

```csharp
public class EmailSender : IMessageSender
{
    public void Send(string message)
    {
        Console.WriteLine($"Email ì „ì†¡: {message}");
    }
}
```

---

### 3. êµ¬í˜„ì²´ 2 - SMS

```csharp
public class SmsSender : IMessageSender
{
    public void Send(string message)
    {
        Console.WriteLine($"ğŸ“± SMS ì „ì†¡: {message}");
    }
}
```

---

### 4. ì„œë¹„ìŠ¤ ë“±ë¡

```csharp
// EmailSenderë¡œ ì‚¬ìš©
builder.Services.AddScoped<IMessageSender, EmailSender>();

// ë˜ëŠ” SMS ì „í™˜
// builder.Services.AddScoped<IMessageSender, SmsSender>();
```

### 5. ì‚¬ìš© í´ë˜ìŠ¤

```csharp
public class AlertService
{
    private readonly IMessageSender _sender;

    public AlertService(IMessageSender sender)
    {
        _sender = sender;
    }

    public void Alert(string msg) => _sender.Send(msg);
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°

### ğŸ‘ ì‹¤ì œ êµ¬í˜„ ëŒ€ì‹  ê°€ì§œ(mock) ì£¼ì… ê°€ëŠ¥

```csharp
public class FakeSender : IMessageSender
{
    public List<string> Messages = new();
    public void Send(string message) => Messages.Add(message);
}
```

â†’ í…ŒìŠ¤íŠ¸ì—ì„œ `FakeSender`ë¥¼ ì£¼ì…í•˜ë©´ ì‹¤ì œ ì´ë©”ì¼ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥!

---

## ğŸ“Œ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DI ì¥ì  ì •ë¦¬

| ì¥ì  | ì„¤ëª… |
|------|------|
| ëŠìŠ¨í•œ ê²°í•© | êµ¬í˜„ì²´ë¥¼ ììœ ë¡­ê²Œ êµì²´ ê°€ëŠ¥ |
| í…ŒìŠ¤íŠ¸ í¸ì˜ì„± | ëª¨ì˜(Mock) ê°ì²´ë¥¼ ì£¼ì…í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‰¬ì›€ |
| ëª…í™•í•œ ê³„ì•½ | ì˜ë„í•œ ê¸°ëŠ¥ë§Œ ì™¸ë¶€ì— ë…¸ì¶œ ê°€ëŠ¥ |
| í™•ì¥ì„± | ìƒˆë¡œìš´ êµ¬í˜„ì²´ë¥¼ ì¶”ê°€í•´ë„ ê¸°ì¡´ ì½”ë“œë¥¼ ìˆ˜ì •í•  í•„ìš” ì—†ìŒ |

---

## ğŸ”¥ ê³ ê¸‰: ì¡°ê±´ì— ë”°ë¥¸ êµ¬í˜„ ì„ íƒ (Factory íŒ¨í„´)

- íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ:

```csharp
public class SenderFactory
{
    private readonly IServiceProvider _provider;

    public SenderFactory(IServiceProvider provider)
    {
        _provider = provider;
    }

    public IMessageSender GetSender(string type)
    {
        return type switch
        {
            "sms" => _provider.GetRequiredService<SmsSender>(),
            "email" => _provider.GetRequiredService<EmailSender>(),
            _ => throw new InvalidOperationException()
        };
    }
}
```

---

## âœ… ë§ˆë¬´ë¦¬ ìš”ì•½

| ìš”ì†Œ | ì„¤ëª… |
|------|------|
| `ì¸í„°í˜ì´ìŠ¤` | êµ¬í˜„ì— ëŒ€í•œ ê³„ì•½ |
| `êµ¬í˜„ì²´` | ì‹¤ì œ ë™ì‘ ë¡œì§ |
| `DI ë“±ë¡` | `AddScoped`, `AddSingleton`, `AddTransient` |
| `ìƒì„±ì ì£¼ì…` | ìë™ìœ¼ë¡œ ì„œë¹„ìŠ¤ ìƒì„±ìì— ì£¼ì…ë¨ |
| `í…ŒìŠ¤íŠ¸ ëŒ€ì²´` | ëª¨ì˜ ê°ì²´ ì£¼ì…ì´ ì‰¬ì›€ |

---

## ğŸ”œ ë‹¤ìŒ ì¶”ì²œ ì£¼ì œ

- âœ… DIì—ì„œ `IOptions`, `IConfiguration` í™œìš©í•˜ê¸°
- âœ… Named ì„œë¹„ìŠ¤ ì£¼ì… / ì¡°ê±´ë¶€ ì£¼ì… ë°©ì‹
- âœ… ë¯¸ë“¤ì›¨ì–´, í•„í„°, ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ DI ì‚¬ìš©í•˜ê¸°
- âœ… DI + í…ŒìŠ¤íŠ¸ ì „ëµ: Moq, Fake, Stub

---

ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DIëŠ” ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±ì„ ë†’ì´ëŠ” **ê°€ì¥ ì¤‘ìš”í•œ ì„¤ê³„ ì›ì¹™ ì¤‘ í•˜ë‚˜**ì…ë‹ˆë‹¤.  
ì‹¤ì œ ASP.NET Core í”„ë¡œì íŠ¸ì—ì„œ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, ëŒ€ë¶€ë¶„ì˜ ê¸°ë³¸ ê¸°ëŠ¥ (ë¡œê·¸, ì¸ì¦, DB ë“±)ë„ ì´ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ìš”!