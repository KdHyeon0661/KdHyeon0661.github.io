---
layout: post
title: AWS - S3로 파일 업로드하기
date: 2025-07-12 22:20:23 +0900
category: AWS
---
# ☁️ S3로 파일 업로드하기: EC2 웹사이트 vs 로컬 업로드 실습

---

## 🧩 개요

AWS S3는 **확장 가능하고 내구성이 뛰어난 객체 저장소**로, 웹사이트의 이미지 업로드, 백업, 로그 저장 등 다양한 용도로 사용됩니다.  
이번 글에서는 **두 가지 방식으로 S3에 파일 업로드**를 실습해봅니다.

1. **EC2에 간단한 업로드 웹사이트 생성 → S3 업로드**
2. **로컬 PC에서 AWS CLI / Python으로 S3 업로드**

---

# 1️⃣ EC2에서 S3로 업로드하는 웹사이트 만들기

---

## 🧭 사전 준비

| 항목 | 내용 |
|------|------|
| EC2 인스턴스 | Amazon Linux 2, 퍼블릭 IP |
| S3 버킷 | 퍼블릭 읽기 허용 or presigned URL 사용 |
| IAM 역할 | S3 업로드 권한 포함 |
| Flask | 웹 프레임워크 |
| Boto3 | AWS SDK for Python |

---

## 🔐 1. IAM 역할 생성 및 EC2에 연결

1. **IAM → 역할 생성**
   - 서비스: EC2
   - 정책 추가: `AmazonS3FullAccess` (실습 목적)
2. **EC2 인스턴스에 역할 연결**
   - EC2 → 인스턴스 선택 → 작업 → IAM 역할 연결

---

## 📦 2. S3 버킷 생성 및 설정

1. S3 → 버킷 만들기
2. 버킷 이름: `my-upload-demo-2025` (고유)
3. **퍼블릭 액세스 차단 해제**
4. 권한 탭 → `모든 퍼블릭 액세스 허용`
5. 정적 웹 호스팅이 필요하면 활성화

---

## 🛠️ 3. EC2에 Python Flask 환경 구축

```bash
# Python 설치
sudo yum update -y
sudo yum install python3 git -y

# Flask, Boto3 설치
pip3 install flask boto3
```

---

## 📁 4. 간단한 업로드 서버 코드 작성

`app.py` 파일 생성:

```python
from flask import Flask, request, render_template_string
import boto3

app = Flask(__name__)
s3 = boto3.client('s3')
bucket_name = 'my-upload-demo-2025'

html = '''
<h2>파일 업로드</h2>
<form method="POST" enctype="multipart/form-data">
  <input type="file" name="file"><br>
  <input type="submit">
</form>
'''

@app.route('/', methods=['GET', 'POST'])
def upload():
    if request.method == 'POST':
        f = request.files['file']
        s3.upload_fileobj(f, bucket_name, f.filename)
        return f'{f.filename} 업로드 완료!'
    return render_template_string(html)

app.run(host='0.0.0.0', port=80)
```

---

## 🚀 5. Flask 서버 실행

```bash
sudo python3 app.py
```

브라우저에서 EC2 퍼블릭 IP로 접속 → 파일 업로드 → 성공 시 S3에서 확인 가능

---

## 📂 6. 업로드 결과 확인

- AWS S3 → 버킷 → 객체 리스트 확인
- 퍼블릭으로 설정했다면 업로드된 이미지/파일 URL로 바로 접근 가능

```text
https://<bucket-name>.s3.<region>.amazonaws.com/<filename>
```

---

## ✅ 7. EC2 방식 정리

| 장점 | 단점 |
|------|------|
| 사용자 인터페이스 제공 | Flask 서버 직접 유지해야 함 |
| IAM 역할로 키 관리 불필요 | 보안 그룹 설정 필요 |

---

# 2️⃣ 로컬에서 S3로 직접 업로드하기

---

## 🔧 1. AWS CLI 방식

### 🛠️ CLI 설치

```bash
# macOS
brew install awscli

# Ubuntu
sudo apt install awscli

# Windows
https://aws.amazon.com/cli/ 에서 다운로드
```

### 🔑 자격 증명 설정

```bash
aws configure
```

입력할 항목:

```text
AWS Access Key ID: ****************
AWS Secret Access Key: ************
Default region: ap-northeast-2
Default output: json
```

> IAM 사용자에서 프로그래밍 방식 액세스 키 발급 필요

---

## 📤 2. 파일 업로드 명령어

```bash
aws s3 cp ./example.jpg s3://my-upload-demo-2025/
```

결과:

```text
upload: ./example.jpg to s3://my-upload-demo-2025/example.jpg
```

---

## 🌐 3. 업로드된 파일 접근 URL

```text
https://my-upload-demo-2025.s3.ap-northeast-2.amazonaws.com/example.jpg
```

---

## 🐍 4. Python 코드로 업로드 (Boto3)

### 설치

```bash
pip install boto3
```

### 코드 예시

```python
import boto3

s3 = boto3.client('s3',
                  aws_access_key_id='YOUR_KEY',
                  aws_secret_access_key='YOUR_SECRET',
                  region_name='ap-northeast-2')

filename = 'example.jpg'
bucket_name = 'my-upload-demo-2025'

s3.upload_file(filename, bucket_name, filename)
print('업로드 완료')
```

> Access Key는 .env 또는 IAM Role을 통해 안전하게 관리하세요.

---

## ✅ 로컬 방식 정리

| 방식 | 특징 |
|------|------|
| AWS CLI | 빠르고 간단, 자동화에 적합 |
| Python SDK (Boto3) | 프로그램에서 제어 가능, 복잡한 로직 가능 |

---

# 📚 마무리 요약

| 항목 | EC2 업로드 | 로컬 업로드 |
|------|------------|-------------|
| 접근 방식 | 웹사이트 통해 업로드 | CLI 또는 코드 |
| 사용 기술 | Flask, Boto3 | CLI / Python |
| 자격 인증 | IAM Role (EC2에 연결) | Access Key 사용 |
| 사용자 경험 | 웹 기반 | 명령어 기반 |
| 보안 고려 | 포트 개방 필요 | Access Key 유출 주의 |