---
layout: post
title: 디지털신호처리 - D배 데시메이션, I배 보간
date: 2025-11-19 17:25:23 +0900
category: 디지털신호처리
---
# — D배 데시메이션(Decimation)과 I배 보간(Interpolation)

## 왜 샘플링률 변환이 중요한가?

샘플링률 변환은 “디지털 신호의 시간축 격자(step)”를 바꾸는 연산이다.
실무에서 샘플링률 변환은 거의 항상 필터와 같이 등장한다.

대표적 상황:

1. **오디오/음성**
   - 48 kHz로 녹음된 파일을 44.1 kHz(음악 표준)로 변환
   - VoIP/전화망(16 kHz, 8 kHz)과 고품질 음성(48 kHz) 사이의 호환

2. **통신/SDR**
   - RF 프론트엔드에서 고속 샘플링 후, 베이스밴드에서 낮은 샘플링으로 처리(데시메이션)
   - 심볼률에 맞게 오버샘플링된 신호를 적절히 “정수 배”로 바꾸는 보간/데시메이션

3. **계측·제어·센서**
   - 센서에서 높은 샘플링으로 수집한 데이터를
     제어기/저장/네트워크 대역폭에 맞춰 낮춰야 하는 경우(데시메이션)
   - 반대로, 저속 센서 데이터를 고속 표준 인터페이스에 맞춰 “간격을 채워” 보내야 하는 경우(보간)

핵심은:

- **다운**할 때는 **aliasing(스펙트럼 겹침)**을 막아야 하고
- **업**할 때는 **imaging(스펙트럼 복제)**을 없애야 한다.

이 둘을 해결하는 주역이 **안티앨리어싱/안티이미징 필터**다.

---

## 다중레이트 신호의 기본 표기

- 원 신호: $$x[n]$$, 샘플링 주기 $$T$$, 샘플링 주파수 $$F_s=1/T$$
- 데시메이션 후: $$y[n]$$, 샘플링 주기 $$T' = DT$$, 샘플링 주파수 $$F_s' = F_s/D$$
- 보간 후: $$v[n]$$, 샘플링 주기 $$T'' = T/I$$, 샘플링 주파수 $$F_s'' = IF_s$$

디지털 주파수는 항상 $$2\pi$$ 주기이며,
정규화 주파수(나이퀴스트=1)는 $$W = f/(F_s/2)$$로 쓴다.

---

## D배 데시메이션(Downsampling by D)

### 연산 정의 (시간 영역)

**D배 데시메이션**은 “샘플을 D개 중 1개만 남기고 버리는 것”이다.

$$
y[n] = x[nD]
$$

예: D=3일 때

- 입력: $$x[0], x[1], x[2], x[3], x[4], x[5], ...$$
- 출력: $$y[0]=x[0],\ y[1]=x[3],\ y[2]=x[6], ...$$

즉 “시간축이 D배 늘어난 것처럼 보인다”.

---

### 주파수 영역 효과: aliasing

DTFT $$X(e^{j\omega})$$가 있을 때, 데시메이션 후 스펙트럼은

$$
Y(e^{j\omega})
= \frac{1}{D}\sum_{k=0}^{D-1}
X\!\left(e^{j(\omega + 2\pi k)/D}\right)
$$

의 형태가 된다.

해석:

- 주파수 축을 **1/D로 압축**한 후
- $$2\pi/D$$ 간격으로 **D개가 겹쳐 합산**된다.

따라서, 입력이 $$|\omega| \le \pi/D$$를 넘어서는 고주파 성분을 가지면
압축된 스펙트럼이 서로 겹쳐 **aliasing 왜곡**이 생긴다.

---

### aliasing을 막는 조건

데시메이션 후의 새로운 나이퀴스트는

$$
\omega_N' = \pi/D
$$

따라서 입력이 이 범위를 넘지 않게 **사전 저역통과(anti-aliasing) 필터**로 제한해야 한다.

조건:

$$
X(e^{j\omega}) \approx 0 \quad \text{for } |\omega|>\pi/D
$$

즉, 데시메이션 전에

- 컷오프가 $$\pi/D$$ 근처인 LPF를 통과시켜
- 고주파를 제거해야 한다.

---

### 데시메이션 시스템의 표준 구조

블록도:

```text
x[n] ──▶ [Anti-alias LPF H(z)] ──▶ (↓D) ──▶ y[n]
```

수식:

- 필터 출력 $$u[n] = (h * x)[n]$$
- 다운샘플: $$y[n] = u[nD]$$

---

### 실전 설계 절차(데시메이션)

1. **목표 다운비 D 결정**
2. **입력 신호의 유효 대역** $$B_x$$ 확인
3. 새 나이퀴스트 $$F_s/(2D)$$보다 유효 대역이 작도록
   anti-alias LPF 설계
4. LPF → ↓D 순서로 구현
5. 응답/aliasing 여부 검증

---

## I배 보간(Upsampling by I)

### 연산 정의 (시간 영역)

**I배 보간**은 “샘플 사이에 0을 I-1개 끼워 넣는 것”이다 (zero-stuffing).

$$
v[n] =
\begin{cases}
x[n/I], & n = 0,\pm I,\pm 2I,\dots \\
0,      & \text{otherwise}
\end{cases}
$$

예: I=4일 때

- 입력: $$x[0], x[1], x[2],...$$
- 삽입 후:

$$
v[0]=x[0],\ v[1]=0,\ v[2]=0,\ v[3]=0,\ v[4]=x[1],\dots
$$

즉 “시간축에서 샘플 간격이 1/I로 줄어든 격자”지만,
실제 값은 0으로 ‘구멍난’ 상태다.

---

### 주파수 영역 효과: imaging

삽입된 신호의 스펙트럼은

$$
V(e^{j\omega}) = X(e^{j\omega I})
$$

해석:

- 주파수 축이 **I배 확장**된다.
- 확장되면서 주기성 때문에 **스펙트럼 복제(이미징)**가 생긴다.

구체적으로,

- 원래의 baseband(저주파) 성분이
- $$2\pi/I$$ 간격으로 반복되어 나타난다.

---

### imaging 제거: anti-imaging LPF

따라서 보간 후에는

- baseband만 남기고
- 위쪽으로 복제된 이미지를 제거하는 LPF가 필요하다.

조건:

$$
H(e^{j\omega}) \approx
\begin{cases}
I, & |\omega|\le \pi/I \\
0, & \pi/I < |\omega|\le \pi
\end{cases}
$$

여기서 통과대역 이득을 I로 설정하는 이유:

- zero-stuffing은 에너지를 I배 나눠 갖게 만들므로
- 최종 신호의 진폭을 원래와 맞추려면 I배 보상 필요.

---

### 보간 시스템의 표준 구조

```text
x[n] ──▶ (↑I) ──▶ [Anti-imaging LPF H(z)] ──▶ y[n]
```

수식:

- 0삽입 후 $$v[n]$$
- 필터 출력 $$y[n]=(h*v)[n]$$

---

### 실전 설계 절차(보간)

1. **목표 업비 I 결정**
2. 삽입 후의 **imaging 위치**는 $$\pi/I$$부터
3. 컷오프 $$\pi/I$$ 근처의 LPF(anti-imaging) 설계
4. (↑I) → LPF 순서로 구현
5. baseband 보존/이미지 제거 검증

---

## 데시메이션·보간에서 필터가 “반드시” 필요한 이유

둘 다 LPF가 필요하지만 목적이 다르다:

| 연산 | 문제 | 필터 목적 | 컷오프 |
|---|---|---|---|
| 데시메이션 ↓D | aliasing | 고주파 제거 | $$\pi/D$$ |
| 보간 ↑I | imaging | 복제 스펙트럼 제거 + 이득보상 | $$\pi/I$$ |

필터를 빼면?

- 데시메이션: 접힘 왜곡으로 원 신호 대역이 찌그러짐
- 보간: 고역에 거대한 이미지가 남아 후단 시스템을 오염

---

## 계산량 최적화: 폴리페이즈(Polyphase)와 노블 아이덴티티

### 데시메이션에서 폴리페이즈

문제:

```text
H(z) 필터는 입력 샘플 전체에 대해 계산
↓D 후 샘플의 1/D만 쓰임
```

즉, D배 데시메이션에서 **필터 계산의 (D-1)/D가 낭비**된다.

해결:

필터의 임펄스 응답을 D개 위상으로 분해:

$$
h[n] = \sum_{m=0}^{D-1} e_m[nD-m]
$$

전송함수:

$$
H(z)=\sum_{m=0}^{D-1} z^{-m}E_m(z^D)
$$

→ **각 위상 E_m만 필요한 시점에만 계산**하면 된다.

**노블 아이덴티티(noble identity)**:

$$
H(z)\downarrow D
\quad\equiv\quad
\sum_{m=0}^{D-1} z^{-m}E_m(z)\downarrow D
$$

결과:

- 필터 연산량이 **1/D로 감소**
- 대형 D(예: 64, 128)일수록 이득이 극대화

---

### 보간에서 폴리페이즈

보간도 마찬가지로

- 0삽입 후 대부분이 0인데
- 필터가 그 0에도 곱셈/덧셈을 수행 → 낭비

보간용 폴리페이즈 분해:

$$
H(z)=\sum_{m=0}^{I-1} z^{-m}E_m(z^I)
$$

보간 노블 아이덴티티:

$$
\uparrow I\, H(z)
\quad\equiv\quad
\sum_{m=0}^{I-1} z^{-m}E_m(z)
$$

즉

- **필터를 I개의 서브필터로 나눠**
- 원본 샘플이 들어올 때만
  필요한 위상을 출력에 배치

결과:

- 연산량이 역시 **1/I** 수준으로 감소.

---

## Octave 실습 1: D=3 데시메이션의 aliasing 비교

### 실험 시나리오

**상황**: 12 kHz로 샘플링된 신호에

- 1 kHz 저주파 톤
- 5 kHz 고주파 톤

이 섞여 있다고 하자.

이 신호를 **D=3**으로 데시메이션하면

- 새 샘플링률은 4 kHz
- 나이퀴스트는 2 kHz
- 5 kHz 성분은 반드시 aliasing을 일으킨다.

**실험 목표**:

1. **필터 없이 데시메이션** → aliasing 관찰
2. **anti-alias LPF 후 데시메이션** → aliasing 제거 확인

---

### Octave 코드

```octave
pkg load signal; clear; close all; clc;

Fs  = 12000;         % original sampling
D   = 3;             % decimation factor
Fs2 = Fs / D;        % new sampling
N   = 12000;         % 1 second

n = 0:N-1; t = n/Fs;

x = sin(2*pi*1000*t) + 0.7*sin(2*pi*5000*t);  % 1k + 5k

% (A) decimation WITHOUT anti-alias filter
y0 = x(1:D:end);

% (B) design anti-alias LPF
% cutoff slightly below new Nyquist (=Fs2/2)
Fc  = 1800;   % Hz
Wc  = Fc/(Fs/2);
M   = 127;    % FIR order for clean stopband (example)
b   = fir1(M, Wc, hann(M+1));  % window FIR LPF

u   = filter(b, 1, x);
y1  = u(1:D:end);

% spectra
Nfft=8192;
X  = fft(x.*hann(N)');  X = X(1:Nfft);
Y0 = fft(y0.*hann(length(y0))'); Y0=Y0(1:Nfft);
Y1 = fft(y1.*hann(length(y1))'); Y1=Y1(1:Nfft);

fX  = (0:Nfft-1)*Fs/Nfft;
fY  = (0:Nfft-1)*Fs2/Nfft;

figure;
subplot(3,1,1);
plot(fX, 20*log10(abs(X)+eps)); grid on; xlim([0 Fs/2]);
title("Original spectrum (Fs=12 kHz)");

subplot(3,1,2);
plot(fY, 20*log10(abs(Y0)+eps)); grid on; xlim([0 Fs2/2]);
title("After decimation WITHOUT filter (aliasing)");

subplot(3,1,3);
plot(fY, 20*log10(abs(Y1)+eps)); grid on; xlim([0 Fs2/2]);
title("After decimation WITH anti-alias LPF");
```

### 결과 해석

- 필터 없이 ↓3 하면
  5 kHz 성분이 4 kHz 샘플링에서
  $$5-1\cdot4=1\ \mathrm{kHz}$$ 로 접혀 들어와
  **1 kHz 근처에 가짜 성분**이 생긴다.
- LPF를 먼저 통과시킨 경우
  5 kHz가 제거되어 접힘이 사라지고
  **원래 1 kHz만 남는다.**

---

## Octave 실습 2: I=4 보간의 imaging 제거

### 실험 시나리오

**상황**: 8 kHz 오디오에 1 kHz 톤이 있다.
이를 **I=4**로 보간해서 32 kHz로 키우면

- 0삽입 직후 스펙트럼이 4개로 복제
- 이를 LPF로 제거해야 한다.

---

### Octave 코드

```octave
pkg load signal; clear; close all; clc;

Fs  = 8000;
I   = 4;
Fs2 = Fs*I;
N   = 8000;
n = 0:N-1; t = n/Fs;

x = sin(2*pi*1000*t);   % 1 kHz tone

% (A) upsample by zero-stuffing
v = zeros(1, I*N);
v(1:I:end) = x;

% (B) anti-imaging LPF
Fc = 1500;                % cutoff below original Nyquist (=4k)
Wc = Fc/(Fs2/2);          % normalized to new Fs2
M  = 127;
b  = fir1(M, Wc, hann(M+1));

y = filter(b, 1, v) * I;  % gain compensation by I

% spectra
Nfft=8192;
V = fft(v.*hann(length(v))'); V=V(1:Nfft);
Y = fft(y.*hann(length(y))'); Y=Y(1:Nfft);

f  = (0:Nfft-1)*Fs2/Nfft;

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(V)+eps)); grid on; xlim([0 Fs2/2]);
title("Zero-stuffed spectrum (imaging appears)");

subplot(2,1,2);
plot(f, 20*log10(abs(Y)+eps)); grid on; xlim([0 Fs2/2]);
title("After anti-imaging LPF (images removed)");
```

### 결과 해석

- 0삽입 직후
  1 kHz 성분이
  1 kHz, 7 kHz, 9 kHz, 15 kHz … 등
  $$2\pi/I$$ 주기로 복제된다.
- LPF 후
  baseband(0~2 kHz 근처)만 남고 복제는 사라진다.
- 곱하기 I는 원래 진폭 복원 목적이다.

---

## 설계 관점에서 자주 하는 실수와 주의점

### 데시메이션에서의 실수

1. **anti-alias 컷오프를 너무 높게 잡음**
   - 새 나이퀴스트 $$F_s/(2D)$$를 넘으면 aliasing 발생
2. **전이대역(transition band)을 고려하지 않음**
   - 실제 필터는 이상적 step이 아니므로
     $$F_p < F_s/(2D)$$로 여유를 둬야 한다.
3. **고차 IIR을 Direct Form으로 구현**
   - 데시메이터 앞단 고차 IIR은 수치적으로 민감
   - 가능하면 SOS 사용

---

### 보간에서의 실수

1. **안티이미징 필터를 빼먹음**
   - 다음 단계에서 고역 이미지가 문제를 만든다.
2. **이득 보상 I를 하지 않음**
   - 출력이 작아져 SNR/레벨 매칭 문제 발생
3. **필터 전이대역이 너무 좁아 계산량 폭증**
   - 폴리페이즈/다단 보간으로 분산하는 설계 필요

---

## 데시메이션/보간: 왜 쓰는가?

### 다단 데시메이션

예: D=64를 한 번에 하면

- $$\pi/64$$에 매우 급격한 LPF가 필요
- 차수 폭증

대신

$$
64 = 8 \times 8
$$

로 나누면,

- 1단: ↓8, 컷오프 $$\pi/8$$
- 2단: ↓8, 컷오프 $$\pi/8$$

각 필터가 훨씬 쉬워지고 총 연산량 감소.

---

### 다단 보간

예: I=16

$$
16 = 4 \times 4
$$

로 쪼개서

- 1단: ↑4 + LPF
- 2단: ↑4 + LPF

하면 각 단계의 필터 스펙이 완만해져 총 차수가 줄어든다.

---

## 연습문제(직접 풀어보기)

### 문제 10-1. aliasing 발생 주파수 계산

샘플링률 $$F_s=20\ \mathrm{kHz}$$인 신호에
$$f_1=2\ \mathrm{kHz}$$, $$f_2=7\ \mathrm{kHz}$$ 톤이 있다.
이를 D=4로 데시메이션할 때,

1. 새 샘플링률과 나이퀴스트는?
2. $$f_2$$는 aliasing 후 어떤 주파수로 보이는가?

**힌트 풀이**:

- 새 $$F_s' = 5\ \mathrm{kHz}$$, 새 나이퀴스트=2.5 kHz
- aliasing:
  $$
  f_a = |f_2 - kF_s'|
  $$
  $$k$$를 골라 나이퀴스트 안으로 들어오게 한다.

---

### 문제 10-2. anti-alias LPF 스펙 설정

문제 10-1에서 aliasing을 없애려면
anti-alias LPF의 통과대역/저지대역 경계를 어떻게 잡아야 하는가?

---

### 문제 10-3. I=5 보간에서 imaging 위치

원 신호가 3 kHz 대역까지 유효하고 $$F_s=12\ \mathrm{kHz}$$라 하자.
I=5로 보간하면 imaging은 어디서부터 시작하는가?

**힌트**:

- 새 나이퀴스트는 30 kHz
- baseband는 0~6 kHz(원 나이퀴스트)
- 복제 중심은 $$k\cdot F_s$$ 근처로 나타난다.

---

### 문제 10-4. 폴리페이즈 연산량 비교

FIR LPF가 차수 M=127(128탭)이고
D=8 데시메이션에 쓰일 때,

1. Direct 구조의 곱셈 횟수(출력 1샘플당)는?
2. 폴리페이즈로 바꾸면 곱셈 횟수는?
3. 이득 비율은?

---

## 전체 정리

- **D배 데시메이션**
  - 정의: $$y[n]=x[nD]$$
  - 효과: 스펙트럼 압축 + 겹침 → aliasing
  - 해결: 컷오프 $$\pi/D$$의 anti-alias LPF 선행
  - 최적화: 폴리페이즈로 계산량 1/D 수준

- **I배 보간**
  - 정의: 0삽입(up-sampling)
  - 효과: 스펙트럼 확장 + 복제 → imaging
  - 해결: 컷오프 $$\pi/I$$의 anti-imaging LPF 후단 + 이득 I 보상
  - 최적화: 폴리페이즈로 계산량 1/I 수준

- 실무 핵심은
  **“필터 스펙 여유 + 다단 구조 + 폴리페이즈 구현 + SOS/정밀도 검토”**
  네 가지를 같이 굴리는 것이다.

이제 다음 단계로는
**임의의 비율 L/M(유리수) 샘플링률 변환**과
그 구현에서 필수인 **polyphase rational resampler**로 확장하면
현실 시스템(44.1↔48k, SDR, 오디오 SRC)을 전부 다룰 수 있다.
