---
layout: post
title: Java - 자바 최신 문법 정리
date: 2025-08-18 17:25:23 +0900
category: Java
---
# 자바 최신 문법 정리 (Java 9~21)

아래는 **실무에서 바로 쓰기 좋은 최신 문법**을 핵심만 뽑아 정리했습니다.  
요청하신 항목(**`var`**, **switch expression**, **records**, **sealed classes**, **pattern matching**, **virtual threads**)을 먼저 정리하고, **알아두면 좋은 추가 최신 문법**도 함께 담았습니다.

---

## 1) `var` — 지역 변수 타입 추론 (Java 10)

- **로컬 변수**의 타입을 컴파일러가 추론.
- **가독성**이 좋아질 때만 사용(너무 모호해지면 명시 타입 권장).

```java
var list = new ArrayList<String>();   // list는 ArrayList<String>
var sum = 0;                          // int
for (var s : List.of("a","b")) { /* ... */ }

// 람다 파라미터에도 사용 가능 (Java 11+)
BiFunction<Integer, Integer, Integer> add = (var a, var b) -> a + b;
```

> ❗ `var`는 **필드/메서드 파라미터/리턴 타입**에는 사용할 수 없습니다(로컬 변수 전용).

---

## 2) Switch **Expression** (Java 14, JEP 361)

- `switch`가 **값을 반환**하는 **식(expression)**으로 확장.
- **화살표** 라벨(`->`), **`yield`** 키워드 지원.

```java
int numLetters = switch (day) {
    case MONDAY, FRIDAY, SUNDAY -> 6;
    case TUESDAY -> 7;
    case THURSDAY, SATURDAY -> 8;
    case WEDNESDAY -> {
        System.out.println("mid");
        yield 9;    // 블록이면 yield 사용
    }
};
```

> 장점: **누락된 `break` 버그 방지**, 컴파일러가 **완전성 검사**로 누락 케이스 경고.

---

## 3) Records — 불변 데이터 캐리어 (Java 16 GA)

- **불변 값 객체**를 **축약 문법**으로 생성. 자동으로 `equals/hashCode/toString` 생성.
- 주 생성자에서 **검증/정규화** 가능.

```java
public record User(long id, String name) {
    public User {
        if (name == null || name.isBlank()) throw new IllegalArgumentException();
        name = name.trim(); // 정규화
    }
}

// 사용
var u = new User(1L, " Alice ");
System.out.println(u.name()); // "Alice"
```

> 관례: **불변 컬렉션**과 함께 사용(내부에서 defensive copy 또는 `List.copyOf` 권장).

---

## 4) Sealed Classes/Interfaces — 상속 제어 (Java 17 GA)

- 특정 타입만 `extends/implements` 할 수 있게 **상속을 제한**.
- **상위**: `sealed`, **허용 목록**: `permits`, **하위**: `final`/`sealed`/`non-sealed` 중 하나 선택.

```java
public sealed interface Shape permits Circle, Rect {}
public final class Circle implements Shape { /* ... */ }
public non-sealed class Rect implements Shape { /* ... */ } // 다시 개방
```

> 장점: **패턴 매칭/switch**와 조합 시 **완전성 보장**(모든 서브타입 처리 확인).

---

## 5) Pattern Matching — `instanceof`, `switch`, **Record Patterns** (Java 21 GA)

### 5.1 `instanceof` 패턴 매칭 (Java 16 GA)
```java
if (obj instanceof String s && s.length() > 3) {
    System.out.println(s.toUpperCase());
}
```

### 5.2 **switch 패턴 매칭** (Java 21 GA)
- 타입/가드(when) 기반 분기, **널 안전** 처리(명시 필요).

```java
String render(Object o) {
    return switch (o) {
        case null                -> "null";
        case String s when s.isBlank() -> "blank";
        case String s            -> "str:" + s;
        case Integer i           -> "int:" + i;
        case List<?> list        -> "list(size=" + list.size() + ")";
        default                  -> "other";
    };
}
```

### 5.3 **Record Patterns** (Java 21 GA)
- 레코드의 **구성요소를 구조 분해**.

```java
record Point(int x, int y) {}
static String quad(Object o) {
    return switch (o) {
        case Point(int x, int y) when x >= 0 && y >= 0 -> "Q1";
        case Point(int x, int y) when x <  0 && y >= 0 -> "Q2";
        case Point(int x, int y) when x <  0 && y <  0 -> "Q3";
        case Point(int x, int y) when x >= 0 && y <  0 -> "Q4";
        default -> "N/A";
    };
}
```

> 함께 쓰면: **도메인 모델 분기**가 **간결·안전**해지고 **널 케이스**도 컴파일 타임 확인 가능.

---

## 6) Virtual Threads — 경량 스레드 (Java 21 GA, Project Loom)

- **OS 스레드와 1:1 아닌** 경량 스레드(고정 비용 작음).
- **대량 동시성 I/O**에 유리(수만~수백만 수준의 동시성도 가능).

```java
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    Future<String> f = executor.submit(() -> {
        // 블로킹 I/O 호출도 가볍게 처리
        return new String(Files.readAllBytes(Path.of("a.txt")));
    });
    System.out.println(f.get());
}
```

> 베스트 프랙티스: 기존 블로킹 API를 대거 바꾸지 않고도 **스레드 폭증 부담 없이** 동시성 처리 향상.

---

# (보너스) 그 외 알아두면 좋은 최신 문법/기능

## A) Text Blocks — 멀티라인 문자열 (Java 15 GA)

- `"""`로 감싸는 **가독성 높은 멀티라인**. JSON/SQL/HTML 작성에 최적.

```java
String json = """
{
  "name": "Alice",
  "age": 30
}
""";
```

> 들여쓰기 기준은 **마지막 `"""`의 위치**. 필요하면 `.stripIndent()`(JDK API) 패턴도 고려.

---

## B) String Templates (미리보기, Java 21 Preview)

- **`STR` 템플릿**으로 안전하고 가독성 높은 문자열 합성.
- (프리뷰이므로 `--enable-preview` 필요, GA 전 변경 가능)

```java
// import static java.lang.StringTemplate.STR;
String name = "Alice"; int n = 3;
// System.out.println(STR."Hello \{name}, you have \{n} msgs");
```

> 템플릿 프로세서로 **SQL/JSON 안전성** 강화 가능(인젝션 보호 목적의 커스텀 프로세서).

---

## C) Sequenced Collections — 양방향 순서 API (Java 21 GA)

- `List/Deque/Set` 계열에 **앞/뒤** 개념 도입: `reversed()`, `addFirst/addLast`, `getFirst/getLast`.

```java
SequencedCollection<String> sc = new ArrayList<String>();
sc.addFirst("a"); sc.addLast("b");
System.out.println(sc.reversed());    // 역순 뷰
```

> 기존 컬렉션을 더 **직관적인 순서 기반 API**로 다룰 수 있음.

---

## D) Unnamed Patterns & Variables — `_` (Java 21 Preview)

- 패턴/변수에서 **사용하지 않는 바인딩**을 `_`로 명시.

```java
record Pair(int a, int b) {}
switch (obj) {
    case Pair(int a, _) -> System.out.println(a); // b는 무시
    default -> {}
}
```

> 목적: “의도적으로 사용 안 함”을 드러내 **가독성 및 경고 억제**.

---

## E) `Stream`/`Optional`/`String` 등 “생활 밀착형” 개선 (Java 9~21)

- **Stream**: `takeWhile/dropWhile`(J9), `iterate(seed, hasNext, next)`(J9)
- **Optional**: `ifPresentOrElse`(J9), `or`(J9), `stream`(J9)
- **String**: `isBlank/lines/strip/repeat`(J11), `indent/transform`(J12)
  
```java
List<Integer> pfx = Stream.of(1,2,3,0,4,5).takeWhile(i -> i>0).toList(); // [1,2,3]
Optional<String> name = Optional.of("Alice");
name.ifPresentOrElse(System.out::println, () -> System.out.println("none"));
```

---

## F) Helpful NullPointerExceptions (Java 14 GA)

- NPE 메시지에 **어느 식이 null이었는지** 상세 표시 → 디버깅 효율 ↑.

```text
Cannot invoke "User.name()" because "user" is null
```

---

## G) HTTP Client 표준화 (Java 11 GA)

- `java.net.http.HttpClient`로 **HTTP/2, 비동기, 타임아웃** 표준 지원.

```java
HttpClient client = HttpClient.newHttpClient();
var res = client.send(
    HttpRequest.newBuilder(URI.create("https://example.com")).build(),
    HttpResponse.BodyHandlers.ofString()
);
```

---

## H) Records + 패턴매칭 조합 템플릿

```java
record Order(long id, String status) {}
String state(Order o) {
    return switch (o) {
        case Order(long id, String s) when s.equals("PAID") -> "정상";
        case Order(_, String s) when s.equals("CANCEL")     -> "취소";
        default -> "기타";
    };
}
```

---

# 실무 체크리스트

- [ ] **패턴 매칭 + sealed**로 분기 완전성 보장  
- [ ] DTO/값 객체는 **record**로 간결하게(불변 + 자동 메서드)  
- [ ] 동시성 I/O: **virtual threads**로 블로킹 API 그대로 성능 향상  
- [ ] 문자열/템플릿/텍스트 블록으로 **JSON/SQL** 가독성 향상  
- [ ] **switch expression**로 값 계산 로직 정리, `yield` 블록 적극 활용  
- [ ] 프리뷰 기능 사용 시 `--enable-preview` 및 **JDK 버전 호환 전략** 마련

---

## 마무리

- Java 21은 **LTS + 현대 문법 세트**(패턴 매칭, 레코드 패턴, 가상 스레드, 시퀀스 컬렉션)를 완성도 있게 제공합니다.  
- **Java 17 → 21 업그레이드**를 권장하며, 프리뷰(문자열 템플릿, 언네임드 패턴/변수)는 **도입 전 팀 합의/가이드라인**을 두고 점진 적용하세요.