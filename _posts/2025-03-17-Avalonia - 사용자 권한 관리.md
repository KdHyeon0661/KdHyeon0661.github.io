---
layout: post
title: Avalonia - ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬
date: 2025-03-17 20:20:23 +0900
category: Avalonia
---
# ğŸ›¡ï¸ Avaloniaì—ì„œ ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ (Admin vs ì¼ë°˜ ì‚¬ìš©ì)

---

## ğŸ¯ ëª©ì 

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ğŸ” ê¶Œí•œ ê¸°ë°˜ UI êµ¬ì„± | Adminë§Œ ì„¤ì • ë²„íŠ¼, ìœ ì €ëŠ” ì œí•œëœ ê¸°ëŠ¥ |
| ğŸ§© ViewModel ë¡œì§ ë¶„ë¦¬ | ê¶Œí•œë³„ë¡œ ë‹¤ë¥¸ ê¸°ëŠ¥ ë™ì‘ |
| ğŸ”„ ë™ì  ê¶Œí•œ ë³€ê²½ | ë¡œê·¸ì¸ í›„ ì—­í• ì— ë”°ë¼ ë™ì  ë°˜ì˜

---

## 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì¡°

### âœ… ì‚¬ìš©ì ê¶Œí•œ ì •ì˜

```csharp
public enum UserRole
{
    Guest,
    User,
    Admin
}
```

### âœ… ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ (AuthService)

```csharp
public class AuthService
{
    public UserRole CurrentRole { get; private set; } = UserRole.Guest;

    public void Login(string username, string password)
    {
        // ì¸ì¦ ë¡œì§ ìƒëµ
        if (username == "admin")
            CurrentRole = UserRole.Admin;
        else
            CurrentRole = UserRole.User;
    }

    public bool IsAdmin => CurrentRole == UserRole.Admin;
}
```

---

## 2ï¸âƒ£ ì „ì—­ ì„œë¹„ìŠ¤ë¡œ ë“±ë¡ (DI)

```csharp
builder.Services.AddSingleton<AuthService>();
```

> ë¡œê·¸ì¸ í›„ ViewModelì—ì„œ ê¶Œí•œ ì •ë³´ì— ì ‘ê·¼ ê°€ëŠ¥

---

## 3ï¸âƒ£ ViewModel ë‚´ ê¶Œí•œ ì œì–´

```csharp
public class MainViewModel : ViewModelBase
{
    private readonly AuthService _auth;

    public bool IsAdmin => _auth.IsAdmin;
    public bool IsUser => _auth.CurrentRole == UserRole.User;

    public MainViewModel(AuthService auth)
    {
        _auth = auth;
    }
}
```

> `IsAdmin` ì†ì„±ì€ View ë°”ì¸ë”©ì— ì‚¬ìš©ë¨

---

## 4ï¸âƒ£ XAMLì—ì„œ ê¶Œí•œ ê¸°ë°˜ UI ì²˜ë¦¬

```xml
<Button Content="ê´€ë¦¬ì ì„¤ì •"
        IsVisible="{Binding IsAdmin}" />

<Button Content="ì¼ë°˜ ì‚¬ìš©ì ê¸°ëŠ¥"
        IsVisible="{Binding IsUser}" />
```

ë˜ëŠ” `IsEnabled` ë¡œ ì œì–´ ê°€ëŠ¥:

```xml
<Button Content="ë°ì´í„° ì‚­ì œ"
        IsEnabled="{Binding IsAdmin}" />
```

---

## 5ï¸âƒ£ ê¶Œí•œì— ë”°ë¥¸ Navigation ì œì–´

```csharp
public void NavigateToAdminPage()
{
    if (!_auth.IsAdmin)
    {
        ShowMessage("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    NavigationService.Navigate(new AdminPageViewModel());
}
```

> ViewModelì—ì„œ ì§ì ‘ ê¶Œí•œ ì²´í¬ë¡œ ì ‘ê·¼ ì œì–´

---

## 6ï¸âƒ£ ë¡œê·¸ì¸ ì‹œ ê¶Œí•œ ì ìš© íë¦„ ì˜ˆì‹œ

```csharp
public class LoginViewModel : ViewModelBase
{
    private readonly AuthService _auth;
    private readonly NavigationService _nav;

    public string Username { get; set; }
    public string Password { get; set; }

    public LoginViewModel(AuthService auth, NavigationService nav)
    {
        _auth = auth;
        _nav = nav;
    }

    public void Login()
    {
        _auth.Login(Username, Password);
        _nav.Navigate(new MainViewModel(_auth));
    }
}
```

---

## 7ï¸âƒ£ ì—­í•  ê¸°ë°˜ ì»¤ë§¨ë“œ ì œì–´

```csharp
public ReactiveCommand<Unit, Unit> DeleteCommand { get; }

public MainViewModel(AuthService auth)
{
    _auth = auth;
    DeleteCommand = ReactiveCommand.Create(Delete, this.WhenAnyValue(x => x.IsAdmin));
}

private void Delete()
{
    // ì‚­ì œ ë¡œì§
}
```

> ê¶Œí•œ ê¸°ë°˜ìœ¼ë¡œ `Command` í™œì„±/ë¹„í™œì„±ë„ ì œì–´ ê°€ëŠ¥

---

## 8ï¸âƒ£ ê³ ê¸‰: RoleAttribute + Command Filter

> ê¶Œí•œë§ˆë‹¤ ì»¤ë§¨ë“œ ì ‘ê·¼ì„ ìë™ìœ¼ë¡œ í•„í„°ë§í•˜ë ¤ë©´ Attribute í™œìš©

```csharp
[AttributeUsage(AttributeTargets.Method)]
public class RequiresRoleAttribute : Attribute
{
    public UserRole Role { get; }

    public RequiresRoleAttribute(UserRole role)
    {
        Role = role;
    }
}
```

---

## 9ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

| ì‚¬ìš©ì | í™”ë©´ êµ¬ì„± | ê¸°ëŠ¥ ì œí•œ |
|--------|------------|------------|
| Guest  | ë¡œê·¸ì¸ í™”ë©´ë§Œ | ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨ |
| User   | ì¼ë°˜ í˜ì´ì§€ | ê´€ë¦¬ì ê¸°ëŠ¥ ìˆ¨ê¹€ |
| Admin  | ì „ì²´ í˜ì´ì§€ | ëª¨ë“  ê¸°ëŠ¥ í—ˆìš© |

---

## âœ… ì •ë¦¬

| í•­ëª© | ìš”ì•½ |
|------|------|
| ğŸ” AuthService | í˜„ì¬ ì‚¬ìš©ì ê¶Œí•œ ì¶”ì  |
| ğŸ§  ViewModel | ê¶Œí•œ ê¸°ë°˜ ë°”ì¸ë”© ì†ì„± ì •ì˜ (`IsAdmin` ë“±) |
| ğŸ–¼ï¸ View(XAML) | `IsVisible`, `IsEnabled` ë°”ì¸ë”© |
| ğŸš« ê¸°ëŠ¥ ì°¨ë‹¨ | Navigation, Command ì‹¤í–‰ ì œí•œ |
| ğŸ§ª í…ŒìŠ¤íŠ¸ | ì—­í• ë§ˆë‹¤ UI êµ¬ì„±/í–‰ë™ ê²€ì¦