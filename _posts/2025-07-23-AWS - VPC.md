---
layout: post
title: AWS - VPC
date: 2025-07-23 18:20:23 +0900
category: AWS
---
# 🕸️ VPC: 네트워크 구성, 서브넷, 라우팅, 보안 그룹

AWS에서 인프라를 구성할 때 가장 기본이 되는 개념 중 하나가 **VPC (Virtual Private Cloud)**입니다. 클라우드 상에서 독립적인 네트워크를 구성할 수 있게 해주며, 우리가 사용하는 EC2, RDS, Lambda 등 모든 AWS 리소스는 VPC 안에 존재하게 됩니다. 이 글에서는 VPC의 개념부터 서브넷, 라우팅 테이블, 인터넷 게이트웨이, 보안 그룹, ACL까지 자세히 다루겠습니다.

---

## 📌 1. VPC란?

**VPC(Virtual Private Cloud)**는 AWS에서 제공하는 **사용자 정의 가상 네트워크**입니다. 물리적인 네트워크처럼 구성되지만, 완전히 가상 환경에서 운영됩니다.

### ✅ VPC의 특징
- 사설 IP 범위를 정의할 수 있음 (CIDR 형식)
- 여러 서브넷을 포함할 수 있음
- 인터넷, VPN, Direct Connect 등 외부 연결 설정 가능
- 네트워크 ACL, 보안 그룹을 통해 보안 제어

### ✅ VPC 사용 이유
- 네트워크를 세분화하고 격리할 수 있음
- 보안 제어가 유연함 (보안 그룹, ACL)
- 하이브리드 아키텍처 구현이 가능 (VPN, Direct Connect)

---

## 📌 2. VPC 구성 요소

| 구성 요소           | 설명 |
|--------------------|------|
| 서브넷 (Subnet)    | VPC 내 논리적 네트워크 영역. 퍼블릭/프라이빗으로 구분됨 |
| 라우팅 테이블       | 네트워크 트래픽 경로를 정의 |
| 인터넷 게이트웨이    | VPC를 인터넷에 연결하는 장치 |
| NAT 게이트웨이      | 프라이빗 서브넷의 외부 통신 허용 |
| 보안 그룹 (Security Group) | 인스턴스 수준의 가상 방화벽 |
| 네트워크 ACL       | 서브넷 수준의 트래픽 제어 |
| DHCP 옵션 세트      | 도메인 이름, DNS 서버 등을 지정 |
| 피어링 연결        | VPC 간 통신을 위한 연결 |

---

## 📌 3. 서브넷 (Subnet)

### ✅ 서브넷이란?
VPC를 더 작은 네트워크 단위로 분할한 것. 리전 내 **가용 영역(AZ)**에 매핑되며, 퍼블릭 또는 프라이빗으로 구분됩니다.

### ✅ 퍼블릭 vs 프라이빗 서브넷

| 구분         | 퍼블릭 서브넷 | 프라이빗 서브넷 |
|--------------|---------------|----------------|
| 인터넷 연결    | O (IGW 있음)    | X              |
| NAT 필요 여부 | X             | O (NAT 사용)   |
| 예시         | 웹 서버       | DB 서버, 백엔드 |

### ✅ 서브넷 구성 예
```
VPC: 10.0.0.0/16

- 퍼블릭 서브넷 (AZ-a): 10.0.1.0/24
- 프라이빗 서브넷 (AZ-a): 10.0.2.0/24
- 퍼블릭 서브넷 (AZ-b): 10.0.3.0/24
- 프라이빗 서브넷 (AZ-b): 10.0.4.0/24
```

---

## 📌 4. 라우팅 테이블 (Route Table)

라우팅 테이블은 서브넷에서 발생하는 네트워크 트래픽의 경로를 정의합니다.

### ✅ 기본 구성
- **목적지 (Destination)**: CIDR 블록
- **대상 (Target)**: local, IGW, NAT 등

### ✅ 예시
| 목적지       | 대상        |
|--------------|-------------|
| 10.0.0.0/16  | local       |
| 0.0.0.0/0    | igw-xxxxxxx |

- `local`: VPC 내 통신
- `0.0.0.0/0`: 인터넷 통신 (IGW 필요)
- NAT 게이트웨이 사용 시 대상: `nat-xxxxxxxx`

---

## 📌 5. 인터넷 게이트웨이 (Internet Gateway)

퍼블릭 서브넷에서 외부와 통신하려면 **인터넷 게이트웨이(IGW)**가 필요합니다.

### ✅ 설정 절차
1. IGW 생성
2. VPC에 IGW 연결
3. 퍼블릭 서브넷의 라우팅 테이블에 `0.0.0.0/0` → IGW 설정
4. EC2에 퍼블릭 IP 부여

---

## 📌 6. NAT 게이트웨이 / NAT 인스턴스

프라이빗 서브넷에 있는 리소스가 **인터넷에 나갈 수 있게 하려면 NAT**를 사용합니다. 하지만 외부에서 접근은 불가합니다.

| 구분           | NAT 게이트웨이     | NAT 인스턴스      |
|----------------|-------------------|------------------|
| 관리           | AWS 관리형         | 수동 구성 필요     |
| 성능           | 고성능 (오토스케일) | EC2 성능에 따라 다름 |
| 고가용성        | AZ 간 자동 복구     | 수동 구성 필요     |
| 비용           | 상대적으로 비쌈     | 상대적으로 저렴함  |

---

## 📌 7. 보안 그룹 (Security Group)

EC2와 같은 리소스에 연결된 **가상 방화벽**으로, 인바운드와 아웃바운드 규칙을 정의합니다.

### ✅ 특징
- 상태 저장(Stateful): 응답 트래픽은 자동 허용
- 인스턴스에 직접 적용
- 허용만 가능, 거부는 불가

### ✅ 예시

```plaintext
# 인바운드 규칙
- HTTP: 80 포트, 0.0.0.0/0
- SSH: 22 포트, 내 IP

# 아웃바운드 규칙 (기본 허용)
- 0.0.0.0/0
```

---

## 📌 8. 네트워크 ACL (Access Control List)

**서브넷 수준**에서의 보안 제어로, 보안 그룹보다 더 낮은 레벨의 방화벽입니다.

### ✅ 특징
- 비상태(Stateless): 요청과 응답은 따로 명시해야 함
- 허용/거부 모두 설정 가능
- 서브넷에 적용됨

### ✅ 예시

| 규칙 번호 | 유형    | 프로토콜 | 포트 범위 | 소스        | 허용/거부 |
|-----------|---------|----------|-----------|-------------|-----------|
| 100       | HTTP    | TCP      | 80        | 0.0.0.0/0   | 허용      |
| 110       | SSH     | TCP      | 22        | 내 IP       | 허용      |
| 120       | 전체    | ALL      | ALL       | 0.0.0.0/0   | 거부      |

---

## 📌 9. 고급: VPC 피어링과 Transit Gateway

### ✅ VPC 피어링
- VPC 간 트래픽을 라우팅할 수 있는 기능
- 동일/다른 리전 간 가능
- 한 방향 통신만 허용됨

### ✅ Transit Gateway
- 여러 VPC, 온프레미스 연결을 중앙집중식으로 관리
- 더 복잡한 네트워크에 적합

---

## 📌 10. 실습 예: 퍼블릭 웹 서버 구성

### 단계
1. VPC 생성: CIDR 10.0.0.0/16
2. 서브넷 생성: 퍼블릭 서브넷 10.0.1.0/24
3. IGW 연결
4. 라우팅 테이블 수정 (0.0.0.0/0 → IGW)
5. EC2 생성 시 퍼블릭 IP 부여
6. 보안 그룹 HTTP/SSH 열기
7. EC2에 Nginx 설치

---

## 📌 11. 요약

| 항목         | 설명 |
|--------------|------|
| VPC          | AWS 내 사용자 정의 네트워크 |
| 서브넷       | VPC 내 논리적 네트워크 영역 |
| 라우팅 테이블 | 트래픽 경로 지정 |
| IGW          | 외부 통신 가능하게 함 |
| NAT          | 프라이빗 서브넷에서 외부로 나가는 통신 허용 |
| 보안 그룹    | 인스턴스 수준의 방화벽 |
| NACL         | 서브넷 수준의 방화벽 |

---

## ✅ 참고

- [AWS VPC 공식 문서](https://docs.aws.amazon.com/vpc/)
- [VPC 흐름 로그 분석](https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html)