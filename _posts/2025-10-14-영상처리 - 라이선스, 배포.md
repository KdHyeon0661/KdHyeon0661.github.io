---
layout: post
title: 영상처리 - 라이선스/배포
date: 2025-10-14 23:25:23 +0900
category: 영상처리
---
# **라이선스/배포**: libjpeg-turbo(“BSD-style”) 라이선스 고지 & DLL 배포 정책

> ⚠️ **비법률 고지**: 아래 내용은 실무 가이드일 뿐 **법률 자문이 아닙니다.** 배포 전 최종적으로 법무 검토를 권장합니다.
> ✅ 목표: **상용/사내 배포** 모두에서 **컴플라이언스(라이선스 고지/NOTICE 동봉)**와 **안전한 DLL 배포**를 확실히 하자.

---

## 한눈에 보기 — **무엇을 반드시 동봉해야 하나?**

libjpeg-turbo는 프로젝트 전반에 **호환되는 3가지 퍼미시브 라이선스**가 혼재합니다.

- **libjpeg-turbo 자체 라이선스(Modified BSD, 3-clause)**
- **IJG(Independent JPEG Group) 라이선스**
  (관례: “**This software is based in part on the work of the Independent JPEG Group.**” 고지 포함)
- **zlib 라이선스** (SIMD/유틸 일부 소스에 적용)

**배포(런타임 바이너리 동봉)** 시 일반적으로 다음 파일을 **같이** 넣습니다.

```
/licenses/
  libjpeg-turbo-LICENSE.txt      # BSD-3-Clause(변형)
  IJG-LICENSE.txt
  zlib-LICENSE.txt
  THIRD_PARTY_NOTICES.txt        # 우리 앱의 일괄 고지(권장)
```

그리고 앱 내 **About/Help → Licenses** 메뉴나 설치 마법사 마지막 페이지/설치 폴더 README에서 **클릭해 확인** 가능하게 합니다.

---

## 라이선스 의무 요약(실무 언어)

| 항목 | 의무 | 주의 |
|---|---|---|
| 소스/바이너리 재배포 | 허용 | **저작권/라이선스 고지 보존**(문서·배포물 포함) |
| 상표/이름 사용 | 금지 | IJG/리포지토리 이름을 광고/홍보에 사용하지 말 것 |
| 수정/정적·동적 링크 | 허용 | 수정 시 변경 사항 고지 권장(오픈소스 관례) |
| 소스 공개 의무 | 없음 | GPL/LGPL **아님**(퍼미시브) |
| 보증 부인 | 필수 | 라이선스 원문에 포함된 “AS IS” 고지 유지 |

**핵심**: **라이선스 파일과 저작권 표시를 배포물에 포함**하면 됩니다(정적/동적 링크 모두).

---

## 배포 시나리오별 체크리스트

### 상용 데스크톱 앱(Windows) — **권장 정책**

- 배포 방식: **MSIX/WiX/NSIS/Inno** 등
- **App-local DLL**: `turbojpeg.dll` 및(선택) `jpeg62*.dll` **앱 실행 파일과 같은 디렉터리**에 배치
  (시스템 전역 설치 최소화 → DLL 지옥 방지)
- **보안 로딩**: `LoadLibraryEx` with **safe search flags** 또는 단순 **정적 링크**(가능하면)
- **/licenses 폴더** 동봉 + 메뉴에서 열람 링크 제공
- (선택) 코드서명(signtool) + 해시/버전 로깅

### 서버/CLI(Windows·Linux)

- Linux: `rpath`/`RUNPATH` 또는 배포 이미지(Docker)에 **libjpeg-turbo 런타임** 포함
- Windows: 앱-local DLL or 설치 경로 PATH 등록(전자는 충돌 적음)
- Kubernetes/컨테이너: **이미지 레이어에 라이선스 파일 복사**(관례: `/licenses`)

### 플러그인(서드파티 호스트)

- **정적 링크 권장**: 호스트가 이미 다른 버전의 libjpeg 을 로드할 가능성(ABI 충돌)
- 동적 링크 시: 플러그인 디렉터리에 **자체 DLL을 동봉**하고 **지연 로딩** + **스코프 제한 로딩**으로 격리

---

## **THIRD_PARTY_NOTICES.txt** 예시(우리 앱 관점)

> *프로덕트 루트*에 `THIRD_PARTY_NOTICES.txt`(또는 `NOTICE`)를 두고, 개별 라이선스 파일을 `/licenses`에 보관.

```
This product includes software developed by the libjpeg-turbo Project.
Copyright (C) [연도] [저작권자].

libjpeg-turbo is available under a BSD-style license.
Additional components are licensed under the IJG (Independent JPEG Group) License
and the zlib License. Copies of these licenses are provided in the "licenses" folder.

Per IJG license convention:
"This software is based in part on the work of the Independent JPEG Group."
```

> 팀 표준: **고지 한 줄 + 라이선스 파일 경로**만으로도 충분하며, 원문 전체는 `/licenses` 폴더에 둡니다.

---

## **About/라이선스 보기** UI/코드 예시(MFC)

- 메뉴: `Help → Open Source Licenses…`
- 구현: **리소스에 포함**된 텍스트를 다이얼로그/뷰어로 표시하거나, 설치 폴더의 `/licenses`를 **파일 탐색기**로 엽니다.

```cpp
// MFC: 라이선스 텍스트 다이얼로그(간단)
void CMainFrame::OnHelpLicenses()
{
    CString path = GetAppInstallDir() + L"\\licenses\\THIRD_PARTY_NOTICES.txt";
    if (ShellExecuteW(m_hWnd, L"open", path, nullptr, nullptr, SW_SHOWNORMAL) <= (HINSTANCE)32)
    {
        AfxMessageBox(L"Cannot open license file. Please check the installation.");
    }
}
```

> 또는 **리소스에 임베드**한 텍스트를 `CDialog` 안 `CEdit`(멀티라인, read-only)로 표시해도 좋습니다.

---

## **CMake 패키징**(정적/동적, 라이선스 동봉)

### vcpkg/패키지 사용 가정 — 타깃 설정

```cmake
# CMakeLists.txt

find_package(libjpeg-turbo CONFIG REQUIRED)      # vcpkg 등
add_executable(ImageTool WIN32 main.cpp ...)
target_link_libraries(ImageTool PRIVATE turbojpeg)  # or jpeg-turbo, jpeg, turbojpeg-static

# 런타임 DLL 복사(Windows, 동적 링크 시)

if (WIN32)
  add_custom_command(TARGET ImageTool POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E make_directory "$<TARGET_FILE_DIR:ImageTool>/licenses"
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
      "$<TARGET_FILE:turbojpeg>"            "$<TARGET_FILE_DIR:ImageTool>"
    # jpeg API DLL이 별도로 생성되는 툴체인이라면 같이 복사
    # COMMAND ${CMAKE_COMMAND} -E copy_if_different "$<TARGET_FILE:jpeg>" "$<TARGET_FILE_DIR:ImageTool>"
    # 라이선스들 동봉
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
      "${CMAKE_SOURCE_DIR}/licenses/libjpeg-turbo-LICENSE.txt"
      "$<TARGET_FILE_DIR:ImageTool>/licenses/"
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
      "${CMAKE_SOURCE_DIR}/licenses/IJG-LICENSE.txt"
      "$<TARGET_FILE_DIR:ImageTool>/licenses/"
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
      "${CMAKE_SOURCE_DIR}/licenses/zlib-LICENSE.txt"
      "$<TARGET_FILE_DIR:ImageTool>/licenses/"
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
      "${CMAKE_SOURCE_DIR}/THIRD_PARTY_NOTICES.txt"
      "$<TARGET_FILE_DIR:ImageTool>/licenses/"
  )
endif()
```

### CPack(선택) — 인스톨러에 라이선스 포함

```cmake
# 설치 레이아웃

install(TARGETS ImageTool RUNTIME DESTINATION bin)
install(FILES "${CMAKE_SOURCE_DIR}/THIRD_PARTY_NOTICES.txt" DESTINATION licenses)
install(DIRECTORY "${CMAKE_SOURCE_DIR}/licenses/" DESTINATION licenses)

# CPack

set(CPACK_PACKAGE_NAME "ImageTool")
set(CPACK_GENERATOR "NSIS")    # or WIX/MSI, ZIP
include(CPack)
```

---

## **DLL 배포 정책**(Windows)

### 권장: **App-Local 배치**

- `ImageTool.exe`와 **같은 폴더**에 `turbojpeg.dll`(및 필요 시 jpeg API DLL)을 둡니다.
- 장점: 충돌 최소화, 업데이트 용이.
- 단점: 동일 머신의 다른 앱과 공유 캐시 부재(보통 문제 아님).

### 안전 로딩(하이재킹 방지)

- 기본 Windows DLL 탐색 순서 때문에 **현재 디렉터리/시스템 폴더** 혼동으로 **하이재킹** 위험 존재.
- 방안:
  1) **정적 링크**(가능하면 가장 안전/간단)
  2) 동적일 경우, 프로세스 시작 시:
     - `SetDefaultDllDirectories(LOAD_LIBRARY_SEARCH_APPLICATION_DIR | LOAD_LIBRARY_SEARCH_SYSTEM32);`
     - `AddDllDirectory(appDir);`
     - `LoadLibraryEx(L"turbojpeg.dll", NULL, LOAD_LIBRARY_SEARCH_DEFAULT_DIRS);`

```cpp
// 안전한 DLL 로딩(요약)
void InitSafeDllSearch()
{
    typedef BOOL (WINAPI *PFN)(DWORD);
    auto p = (PFN)GetProcAddress(GetModuleHandleW(L"kernel32.dll"), "SetDefaultDllDirectories");
    if (p) p(LOAD_LIBRARY_SEARCH_APPLICATION_DIR | LOAD_LIBRARY_SEARCH_SYSTEM32);
}
```

> 앱-local + 안전 탐색 플래그면 실무에서 충분히 강건합니다.

### 버전 고정/로그

- 실행 시 `tjVersion()`(TurboJPEG) 또는 `jpeg_std_error` 버전 문자열을 **로그**로 남겨 문제 재현성을 높입니다.

```cpp
#include <turbojpeg.h>

void LogJpegRuntimeVersion()
{
    const char* ver = tjVersion();
    // 예: "2.1.5.1" 또는 빌드에 따라 다름
    OutputDebugStringA(("libjpeg-turbo: " + std::string(ver) + "\n").c_str());
}
```

---

## **정적 vs 동적 링크** 비교

| 항목 | 정적 링크 | 동적 링크 |
|---|---|---|
| 배포 편의 | 👍 단일 exe | DLL 추가 필요 |
| 크기 | 👎 exe 커짐 | 👍 exe 슬림 |
| 충돌/ABI | 👍 호스트와 격리 | ⚠️ 동일 프로세스 내 중복 로드/심볼 충돌 가능 |
| 보안 | 👍 하이재킹 無 | ⚠️ DLL 하이재킹 주의 |
| 업데이트 | 👎 재빌드 필요 | 👍 DLL 교체로 핫픽스 가능 |

> **플러그인/서드파티 호스트**: **정적 링크 선호**(호스트와 충돌 회피).
> **단독 앱**: 동적/정적 모두 무방(팀 정책/릴리즈 전략에 따름).

---

## **MSIX/WiX/NSIS**에서 라이선스 표시

- **MSIX**: `Assets`에 PDF/MD 포함 → **App Settings → Licenses** 페이지에 연결(설정 페이지 만들기)
- **WiX**: `WixUI_InstallDir` 기반 커스텀 페이지 추가 또는 설치 완료 페이지에 **링크 버튼**
- **NSIS**: `LicenseData` 지시문으로 설치 중 라이선스 표시 + `/licenses` 복사

> 사용자 경험(UX): 설치 중 **원문 전체**를 강제 스크롤 시키기보다는, 설치 후 **Help→Licenses**로 접근을 주는 것이 일반적으로 덜 방해적입니다.

---

## **컨테이너/CI/CD** 팁

- **빌드 스테이지**에서 패키지 매니저(apt/yum/vcpkg)로 설치 → **런타임 스테이지**로 필요한 so/dll **만** 복사
- `/app/licenses` 폴더에 텍스트 복사, 컨테이너 라벨로 버전 기록
- SBOM(Software Bill of Materials) 생성(예: `syft`, `cyclonedx`) → **버전/라이선스 추적**

---

## **취약점·업데이트** 운영

- libjpeg-turbo 릴리즈 노트(CVE 포함)를 주기적으로 체크하고 **버전 pin/업데이트 정책** 수립
- 앱 시작 시 런타임 버전 로깅 + 헬스체크(문제 보고 시 빠른 상관관계 분석에 도움)

---

## **실전 배포 예시(Windows, app-local)**

```
ImageTool/
  ImageTool.exe
  turbojpeg.dll           # 또는 빌드 체인에 따른 이름
  (jpeg62.dll)            # libjpeg API 사용 시에만
  /licenses/
     libjpeg-turbo-LICENSE.txt
     IJG-LICENSE.txt
     zlib-LICENSE.txt
     THIRD_PARTY_NOTICES.txt
  /plugins/               # (옵션) 플러그인 분리
```

- 최초 실행 시:
  - `InitSafeDllSearch()` 호출
  - `LogJpegRuntimeVersion()` 로깅
  - `Help→Open Source Licenses…` 메뉴 활성화

---

## **상황별 Q&A**

- **Q: 소스 공개해야 하나요?**
  A: **아니요.** 퍼미시브(BSD/IJG/zlib)라 **소스 공개 의무 없음**. 다만 **라이선스 고지/저작권 표시**는 포함해야 함.

- **Q: 정적 링크하면 라이선스 고지 필요 없나요?**
  A: **필요합니다.** 정적/동적 관계없이 **저작권/라이선스 고지 보존**은 공통 의무.

- **Q: 광고/마케팅 자료에 “IJG” 이름 써도 되나요?**
  A: **권장되지 않음**(금지에 가깝다고 이해). IJG 이름/로고를 **홍보 용도**로 쓰지 마세요. NOTICE 수준의 사실 고지는 OK.

- **Q: 설치 마법사에서 라이선스 전체를 강제로 보여야 하나요?**
  A: 필수는 아님. **배포물에 동봉**하고 **접근 경로(About/Help)**를 제공하면 충분합니다(회사 정책에 따름).

---

## **실무용 템플릿**(리포지토리 루트)

```
/licenses/
  libjpeg-turbo-LICENSE.txt
  IJG-LICENSE.txt
  zlib-LICENSE.txt
THIRD_PARTY_NOTICES.txt
CMakeLists.txt
```

**THIRD_PARTY_NOTICES.txt**(템플릿):

```
Third-party notices for <Our Product>

libjpeg-turbo
- License: BSD-style (3-clause)
- Copyright (c) the libjpeg-turbo Project and contributors
- Notice: This software is based in part on the work of the Independent JPEG Group.
- Full texts: see ./licenses/libjpeg-turbo-LICENSE.txt, ./licenses/IJG-LICENSE.txt, ./licenses/zlib-LICENSE.txt
```

---

## (선택) 런타임 **라이선스 뷰어** 다이얼로그 코드 스케치

```cpp
// 간단 라이선스 뷰어(임베디드 리소스 → Edit Control)
// Res에 큰 텍스트 리소스를 담고, IDR_TPNOTICE로 로드한다 가정.
void CMainFrame::OnHelpOpenSource()
{
    HRSRC hrs = FindResource(AfxGetResourceHandle(), MAKEINTRESOURCE(IDR_TPNOTICE), L"TEXT");
    if (!hrs) { AfxMessageBox(L"License resource missing."); return; }
    HGLOBAL hg = LoadResource(AfxGetResourceHandle(), hrs);
    if (!hg) { AfxMessageBox(L"License resource load failed."); return; }
    DWORD sz = SizeofResource(AfxGetResourceHandle(), hrs);
    const char* p = (const char*)LockResource(hg);

    CStringW w; int n = MultiByteToWideChar(CP_UTF8, 0, p, (int)sz, nullptr, 0);
    w.GetBufferSetLength(n);
    MultiByteToWideChar(CP_UTF8, 0, p, (int)sz, w.GetBuffer(), n); w.ReleaseBuffer(n);

    CDialog dlg(IDD_DLG_LICENSE, this);
    auto edit = (CEdit*)dlg.GetDlgItem(IDC_EDIT_LICENSE);
    if (edit) edit->SetWindowTextW(w);
    dlg.DoModal();
}
```

---

## **요약**

- libjpeg-turbo는 **퍼미시브(BSD-style/IJG/zlib)** → **상용/사내 배포에 적합**
- **필수**: 배포물에 **라이선스 고지/파일 동봉**, IJG 관례 문구 포함
- **Windows DLL 정책**: **App-local 배치 + 안전 탐색 플래그** / 가능하면 **정적 링크**
- **패키징 자동화**: CMake **install/CPack**로 라이선스·DLL 복사 자동화
- **운영**: 런타임 버전 로깅, CVE 모니터링, 코드서명
