---
layout: post
title: Linux - ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬
date: 2024-11-29 19:20:23 +0900
category: Linux
---
# ë¦¬ëˆ…ìŠ¤ 27í¸: ğŸ–§ ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬

ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí¬ëŠ” ë‹¨ìˆœ ì—°ê²°ì„ ë„˜ì–´ **VLAN, NIC bonding, ë¸Œë¦¬ì§€ êµ¬ì„±**, **ê³ ê¸‰ IP ê´€ë¦¬**, **DNS ìºì‹œ ì„œë²„ ì„¤ì •** ë“± ë‹¤ì–‘í•œ ê³ ê¸‰ ê¸°ìˆ ì„ ìš”êµ¬í•©ë‹ˆë‹¤.  
ì´ í¸ì—ì„œëŠ” ê°€ìƒí™”, ì„œë²„ í™˜ê²½ ëª¨ë‘ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## 1. ğŸŒ VLAN (ê°€ìƒ LAN) ì„¤ì •

**VLAN**ì€ í•˜ë‚˜ì˜ ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë‚˜ëˆ  **ë³´ì•ˆ/íŠ¸ë˜í”½ ë¶„ë¦¬**ë¥¼ ì‹¤í˜„í•©ë‹ˆë‹¤.  
VLAN IDë¥¼ ì§€ì •í•´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.

### âœ… VLAN ì¸í„°í˜ì´ìŠ¤ ìƒì„± (`ip` ëª…ë ¹ì–´ ì‚¬ìš©)
```bash
# eth0ì˜ VLAN 10
sudo ip link add link eth0 name eth0.10 type vlan id 10
sudo ip addr add 192.168.10.2/24 dev eth0.10
sudo ip link set eth0.10 up
```

### âœ… VLAN í™•ì¸
```bash
ip -d link show eth0.10
```

- `eth0.100` â†’ `eth0` ê¸°ë°˜ VLAN 100
- `/etc/network/interfaces` ë˜ëŠ” `nmcli`ë¡œ ì˜êµ¬ ì„¤ì • ê°€ëŠ¥

---

## 2. ğŸ¤ Bonding (NIC ê²°í•©)

**Bonding**ì€ ì—¬ëŸ¬ NICì„ ê²°í•©í•´ í•˜ë‚˜ì²˜ëŸ¼ ì‚¬ìš©í•˜ì—¬ **ê³ ê°€ìš©ì„±** ë˜ëŠ” **ë¶€í•˜ ë¶„ì‚°**ì„ ì œê³µí•©ë‹ˆë‹¤.

### âœ… ëª¨ë“œ ì¢…ë¥˜

| ëª¨ë“œ ë²ˆí˜¸ | ë°©ì‹ | ì„¤ëª… |
|-----------|------|------|
| 0 | Round Robin | ìˆœì°¨ íŠ¸ë˜í”½ ì „ì†¡ (ì„±ëŠ¥ â†‘) |
| 1 | Active Backup | í•˜ë‚˜ë§Œ í™œì„±í™”, ë‚˜ë¨¸ì§€ëŠ” ëŒ€ê¸° (ì‹ ë¢°ì„± â†‘) |
| 2 | XOR | ì†¡ìˆ˜ì‹  MAC ê¸°ë°˜ ë¼ìš°íŒ… |
| 4 | LACP (802.3ad) | ìŠ¤ìœ„ì¹˜ ì§€ì› í•„ìš”, ë™ì  êµ¬ì„± |
| 6 | Adaptive Load Balancing | ARP ì¡°ì‘ í†µí•œ ë¶€í•˜ ë¶„ì‚° |

### âœ… ì„¤ì • ì˜ˆì‹œ (`/etc/network/interfaces` ìŠ¤íƒ€ì¼)
```bash
auto bond0
iface bond0 inet static
    address 192.168.1.100
    netmask 255.255.255.0
    bond-mode 1
    bond-miimon 100
    slaves eth0 eth1
```

> **bond-mode 1**: Active-Backup (HA),  
> **bond-mode 4**: 802.3ad (LACP, ìŠ¤ìœ„ì¹˜ ì—°ë™ í•„ìš”)

### âœ… í˜„ì¬ Bonding ìƒíƒœ í™•ì¸
```bash
cat /proc/net/bonding/bond0
```

---

## 3. ğŸŒ‰ ë¸Œë¦¬ì§€ (Bridge) êµ¬ì„±

ë¸Œë¦¬ì§€ëŠ” **ì„œë²„ë¥¼ ê°€ìƒ ìŠ¤ìœ„ì¹˜ì²˜ëŸ¼ ì‚¬ìš©**í•˜ì—¬, KVM/LXC ë“±ì˜ ê°€ìƒ ë¨¸ì‹ ì— IPë¥¼ ì§ì ‘ ë¶€ì—¬í•  ë•Œ í™œìš©ë©ë‹ˆë‹¤.

```bash
sudo ip link add name br0 type bridge
sudo ip link set eth0 master br0
sudo ip addr add 192.168.1.10/24 dev br0
sudo ip link set br0 up
sudo ip link set eth0 up
```

ë˜ëŠ” `nmcli` ì‚¬ìš©:

```bash
nmcli connection add type bridge con-name br0 ifname br0
nmcli connection add type ethernet con-name br0-port ifname eth0 master br0
```

- `bridge-utils` íŒ¨í‚¤ì§€ ì„¤ì¹˜ë¡œ `brctl` ëª…ë ¹ ì‚¬ìš© ê°€ëŠ¥ (`brctl addbr`, `brctl addif` ë“±)

---

## 4. ğŸ”§ ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ëª…ë ¹ì–´

### âœ… ip ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `ip link` | NIC ìƒíƒœ í™•ì¸ ë° up/down |
| `ip addr` | IP ì£¼ì†Œ ì¡°íšŒ/ì„¤ì • |
| `ip route` | ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸ |
| `ip neigh` | ARP ìºì‹œ í™•ì¸ |

```bash
ip link set eth0 down
ip addr add 192.168.1.10/24 dev eth0
```

---

### âœ… ethtool: NIC ìƒì„¸ ì •ë³´ ì¡°íšŒ

```bash
sudo ethtool eth0
```

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `-i` | ë“œë¼ì´ë²„ ì •ë³´ |
| `-s` | ì†ë„/ë“€í”Œë ‰ìŠ¤ ì„¤ì • |
| `-g` | RX/TX í ë²„í¼ í™•ì¸ |

---

### âœ… nmcli: NetworkManager CLI

```bash
nmcli device show
nmcli connection modify eth0 ipv4.addresses 192.168.0.100/24
nmcli connection up eth0
```

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `device` | ì¥ì¹˜ ìƒíƒœ í™•ì¸ |
| `connection` | ë„¤íŠ¸ì›Œí¬ ì„¤ì • |
| `general` | ì „ì²´ ìƒíƒœ |
| `radio` | WiFi/BT ì¼œê¸°/ë„ê¸° |

---

## 5. ğŸ“¡ DNSMasqë¡œ ë¡œì»¬ DNS ìºì‹œ ì„œë²„ êµ¬ì„±

**dnsmasq**ëŠ” ê²½ëŸ‰ DNS + DHCP ì„œë²„ë¡œ, ë‹¤ìŒ ìš©ë„ì— ìœ ìš©í•©ë‹ˆë‹¤:

- ë¡œì»¬ ë„¤ì„ì„œë²„ (ë‚´ë¶€ ë„ë©”ì¸ ë§¤í•‘)
- DNS ìºì‹œ ì„œë²„ (ì‘ë‹µ ì†ë„ í–¥ìƒ)

### âœ… ì„¤ì¹˜ ë° ì„¤ì •

```bash
sudo apt install dnsmasq
sudo systemctl enable dnsmasq
```

`/etc/dnsmasq.conf`ì—ì„œ ì„¤ì •:

```ini
domain-needed
bogus-priv
no-resolv
server=8.8.8.8
listen-address=127.0.0.1
cache-size=1000
```

- `domain-needed`: ë„ë©”ì¸ ì—†ëŠ” ìš”ì²­ ì°¨ë‹¨
- `server=`: ìƒìœ„ DNS ì„¤ì •
- `cache-size`: ìºì‹œ ê°œìˆ˜

---

## 6. ğŸ§­ ë¡œì»¬ ë„¤ì„ì„œë²„ ì„¤ì •

`/etc/hosts` ë˜ëŠ” `/etc/resolv.conf` íŒŒì¼ì„ í†µí•´ ì§ì ‘ ì´ë¦„ í•´ì„ ê°€ëŠ¥

### âœ… /etc/hosts ì˜ˆì‹œ

```
127.0.0.1   localhost
192.168.0.10   internal-server.local
```

### âœ… /etc/resolv.conf

```bash
nameserver 127.0.0.1
nameserver 8.8.8.8
```

- `dnsmasq`ê°€ 127.0.0.1ì—ì„œ ìš”ì²­ ìˆ˜ì‹ 

---

## âœ¨ ë§ˆë¬´ë¦¬

- **VLAN, Bonding, Bridge**ëŠ” ì„œë²„/ê°€ìƒí™” í™˜ê²½ì—ì„œ í•µì‹¬
- `ip`, `ethtool`, `nmcli`ëŠ” `ifconfig`ë³´ë‹¤ í›¨ì”¬ ê°•ë ¥í•œ í˜„ëŒ€ì  ë„êµ¬
- **dnsmasq**ë¥¼ í™œìš©í•˜ë©´ ë¡œì»¬ DNS í•´ì„ ë° ì†ë„ í–¥ìƒ ê°€ëŠ¥

ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì€ **ì„±ëŠ¥, ë³´ì•ˆ, ìœ ì—°í•œ ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°**ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì‹¤ë¬´ ì„œë²„ í™˜ê²½ì—ì„œëŠ” **ëª¨ë‘ ìµìˆ™í•´ì ¸ì•¼ í•  í•„ìˆ˜ ì˜ì—­**ì…ë‹ˆë‹¤.