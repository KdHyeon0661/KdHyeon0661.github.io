---
layout: post
title: 선형대수 - 행공간과 열공간
date: 2025-06-02 19:20:23 +0900
category: 선형대수
---
# 행공간(Row Space)과 열공간(Column Space) — 완전 가이드

> **핵심 요약**
> $$A\in\mathbb{R}^{m\times n}$$의 **열공간**은 $$\text{Col}(A)\subset\mathbb{R}^m$$, **행공간**은 $$\text{Row}(A)\subset\mathbb{R}^n$$.
> 두 공간의 차원은 항상 같고, 그 값이 **랭크(rank)**:
> $$\boxed{\dim(\text{Col}(A))=\dim(\text{Row}(A))=\operatorname{rank}(A)}$$

---

## 직관: “만들 수 있는 출력” vs “검사하는 제약”

- **열공간**: $$A\vec{x}$$로 **도달 가능한 모든 출력**의 집합. 선형시스템 $$A\vec{x}=\vec{b}$$의 **해 존재 여부**는 $$\vec{b}\in\text{Col}(A)$$인지로 판정.
- **행공간**: 행벡터들의 선형결합으로 이루어진 **제약 방정식의 공간**. 입력 좌표계에서 “무엇을 측정/검사하는가”를 담음.
- 두 공간의 차원(랭크)은 동일하며, 나머지 자유도는 **영공간(Null)**과 **좌영공간(Left Null)**로 흘러간다.

---

## 정의와 표기

### 열공간 Column Space

$$
A=\begin{bmatrix}\vec{a}_1&\vec{a}_2&\cdots&\vec{a}_n\end{bmatrix}\in\mathbb{R}^{m\times n}
$$
$$
\boxed{\text{Col}(A)=\operatorname{span}\{\vec{a}_1,\ldots,\vec{a}_n\}\subset\mathbb{R}^m}
$$

### 행공간 Row Space

$$
A=\begin{bmatrix}\vec{r}_1^\top\\ \vec{r}_2^\top\\ \vdots\\ \vec{r}_m^\top\end{bmatrix}
\quad\Rightarrow\quad
\boxed{\text{Row}(A)=\operatorname{span}\{\vec{r}_1,\ldots,\vec{r}_m\}\subset\mathbb{R}^n}
$$
또는 $$\text{Row}(A)=\text{Col}(A^\top).$$

### 차원 = 랭크

$$
\dim(\text{Col}(A))=\dim(\text{Row}(A))=\operatorname{rank}(A).
$$

---

## 기저(Basis) 추출과 계산 절차

### 열공간 기저(피벗 열 규칙)

- $$A$$를 가우스 소거로 **RREF**(행 기약 사다리꼴)로 만든다.
- **피벗이 선 위치(열 인덱스)**를 기록한다.
- **원래 행렬 $$A$$의 해당 열**들을 모으면 그게 **열공간의 기저**.
  - 주의: RREF의 열벡터가 아니라, **원본의 피벗 열**.

### 행공간 기저

- $$A$$를 RREF로 만들면, **영이 아닌 행들 자체가 행공간의 기저**(또는 원본의 그 행들과 동치인 기저).
- 즉, RREF의 nonzero 행들이 행공간의 정규화된 기저 벡터.

### SVD/QR을 이용한 수치적 기저(실무)

- 수치적 종속(거의 배수) 판정에는 **SVD** 권장: $$A=USV^\top$$.
  - $$\sigma_i$$(특이값)이 **임계치** 이하인 방향은 종속으로 간주.
  - **열공간 기저**: $$U$$의 앞쪽 열(유효한 $$\sigma_i$$에 해당).
  - **행공간 기저**: $$V$$의 앞쪽 열(유효한 $$\sigma_i$$에 해당).
- **QR 분해**로도 피벗 열을 안정적으로 선택 가능(컬럼 피벗팅 QR).

---

## 해 존재/구조와의 연결

### 해의 존재

$$
A\vec{x}=\vec{b}\ \text{가 풀리려면}\ \boxed{\vec{b}\in\text{Col}(A)}.
$$

### 해의 구조

한 개의 특정해 $$\vec{x}_p$$가 있으면,
$$
\boxed{\vec{x}=\vec{x}_p+\vec{z},\ \ \vec{z}\in\text{Null}(A)}.
$$
즉, 해 공간은 **특정해 + 영공간(아핀공간)**.

### 랭크–널리티 정리(참고)

$$
\operatorname{rank}(A)+\operatorname{nullity}(A)=n.
$$
랭크가 높을수록 **열공간 차원↑**, 반대로 **영공간 차원↓**(자유변수 감소).

---

## 기하학적 해석

- **열공간**: 입력을 선형결합해 모을 때 **출력이 “살아가는” 서브스페이스**.
  예: 센서들의 선형 조합으로 생성 가능한 모든 관측 벡터의 집합.
- **행공간**: 입력 벡터에 대해 **검사(내적) 가능한 모든 선형 제약**의 집합.
  각 행은 $$\vec{r}_i\cdot\vec{x}$$라는 측정/식별 기준.

또한,
- $$\text{Null}(A)\perp \text{Row}(A),\quad \text{Null}(A^\top)\perp \text{Col}(A)$$
  (네 개의 기본 공간 간 직교 관계)

---

## 완전 작동 예제 — 손으로 해보기

### 예제 A: 열공간이 1차원인 경우

$$
A=\begin{bmatrix}
1 & 2\\
2 & 4\\
3 & 6
\end{bmatrix}.
$$
두 번째 열은 첫 번째 열의 2배:
$$
\text{Col}(A)=\operatorname{span}\{(1,2,3)^\top\},\quad \operatorname{rank}(A)=1.
$$
- **해 존재성**: $$A\vec{x}=\vec{b}$$가 풀리려면 $$\vec{b}$$가 $$(1,2,3)^\top$$의 배수.

**행공간**은?
- 행벡터: $$(1,2),\ (2,4),\ (3,6)$$ → 전부 $$(1,2)$$의 배수 → $$\operatorname{rank}=1$$.
- $$\dim(\text{Row}(A))=\dim(\text{Col}(A))=1.$$

---

### 예제 B: RREF로 기저 뽑기

$$
A=\begin{bmatrix}
1&2&3\\
2&4&6\\
4&5&6
\end{bmatrix}.
$$

가우스 소거(핵심 단계만 표기):
- $$R_2\leftarrow R_2-2R_1\Rightarrow [0,0,0]$$
- $$R_3\leftarrow R_3-4R_1\Rightarrow [0,-3,-6]$$
- $$R_3\leftarrow -\frac{1}{3}R_3\Rightarrow [0,1,2]$$
- 피벗 열은 1열과 2열(2행에서 피벗 2열). 따라서
  - **열공간 기저**: 원래 $$A$$의 **1열, 2열**
    $$\Big\{(1,2,4)^\top,\ (2,4,5)^\top\Big\}$$
  - **행공간 기저(RREF의 비영 행)**: $$\{(1,2,3),\ (0,1,2)\}$$
- $$\operatorname{rank}(A)=2.$$

---

### 예제 C: 직교관계까지 확인

$$
A=\begin{bmatrix}
1&0&1\\
1&1&0\\
0&1&1
\end{bmatrix}.
$$
- RREF 계산 → 피벗 3개 → $$\operatorname{rank}=3$$ → 정방행렬이 가역, $$\text{Null}(A)=\{\vec{0}\}$$.
- **행공간=열공간=전체 공간**(각각 $$\mathbb{R}^3$$).

---

## 최소제곱과 투영: 열공간이 하는 일

**과결정(식이 더 많은) 문제** $$A\vec{x}\approx \vec{b}$$에서
최소제곱해 $$\vec{x}_{\min}$$는 $$\vec{b}$$를 **열공간으로 직교 투영**한 점의 계수다.
$$
\vec{p}=\operatorname{proj}_{\text{Col}(A)}\vec{b}=A(A^\top A)^{-1}A^\top\vec{b},\qquad
A\vec{x}_{\min}=\vec{p}.
$$
즉, 열공간은 **가장 가까운 설명(근사)을 담는 공간**.

---

## 실무 시나리오

- **데이터 공선성(다중공선성) 탐지**: 특성 행렬 $$X$$의 **열공간 차원 < 열 수**면 중복/의존 특성이 존재 → 회귀 불안정.
  SVD로 유효 랭크 산정 후 **특성 선택** 또는 정규화(릿지).
- **센서 융합**: 센서 측정 조합으로 생성 가능한 출력의 집합이 열공간. 원하는 목표 벡터가 이 안에 있어야 재현 가능.
- **압축/요약**: 열공간의 기저(예: SVD 상위 모드)로 신호를 근사 → 차원 축소/노이즈 억제.

---

## 파이썬 예제

### SymPy로 정확 기저/랭크/RREF

```python
from sympy import Matrix

A = Matrix([
    [1, 2, 3],
    [2, 4, 6],
    [4, 5, 6]
])

print("Rank:", A.rank())

print("\n=== Column Space Basis (from original pivot columns) ===")
for v in A.columnspace():
    print(v)

print("\n=== Row Space Basis (RREF nonzero rows) ===")
for v in A.rowspace():
    print(v)

print("\n=== RREF ===")
RREF, pivots = A.rref()
print(RREF)
print("Pivot columns:", pivots)  # 원본의 피벗 열 인덱스
```

### NumPy/SciPy로 수치 랭크와 기저(특이값 임계치)

```python
import numpy as np

A = np.array([
    [1., 2., 3.],
    [2., 4., 6.],
    [4., 5., 6.]
])

U, s, Vt = np.linalg.svd(A, full_matrices=False)
tol = max(A.shape) * np.max(s) * np.finfo(float).eps
rank = np.sum(s > tol)

print("Singular values:", s)
print("Numerical rank:", rank)

# 수치적 열공간/행공간 기저(유효 모드)

U_basis = U[:, :rank]   # 열공간의 직교기저
V_basis = Vt[:rank, :].T # 행공간의 직교기저

print("\nColumn-space orthonormal basis (U):\n", U_basis)
print("\nRow-space   orthonormal basis (V):\n", V_basis)
```

### 최소제곱: 열공간 투영 확인

```python
import numpy as np

A = np.array([
    [1., 1.],
    [0., 1.],
    [1., 0.]
])  # 3x2
b = np.array([2., 1., 3.])

# QR로 안정적으로 최소제곱 해

Q, R = np.linalg.qr(A)                  # Q: 3x2 (열직교), R: 2x2 상삼각
x_ls = np.linalg.solve(R, Q.T @ b)      # R x = Q^T b
p = A @ x_ls                            # b의 열공간 투영

print("x_ls:", x_ls)
print("projection p = A x_ls:", p)
print("residual b - p:", b - p)
print("Residual ⟂ Col(A)? (Q^T residual):", Q.T @ (b - p))  # 거의 0
```

---

## 체크리스트

1) **열공간 기저**: **원본 피벗 열**을 고른다.
2) **행공간 기저**: RREF의 **영이 아닌 행**.
3) **랭크**: 피벗 개수 = 열랭크 = 행랭크.
4) **해 존재**: $$\vec{b}\in\text{Col}(A)$$인지.
5) **해 구조**: 특정해 + 영공간. 자유도 = 널리티.
6) **수치안정성**: 거의 종속이면 SVD/QR 사용, 임계치로 유효랭크 판정.
7) **직교성**: $$\text{Null}(A)\perp \text{Row}(A),\ \text{Null}(A^\top)\perp \text{Col}(A)$$.

---

## 자주 하는 실수와 교정

- **RREF 열로 열공간 기저를 뽑는 실수** → **원본 행렬의 피벗 열**을 써야 함.
- **랭크를 행/열 중 하나로만 계산** → 둘은 항상 같다(수치오차를 제외).
- **해가 없는데 최소제곱을 해석 못함** → 열공간 투영으로 보면 직관적.
- **특이값 임계치 설정 무시** → 근접 종속 상황에서 랭크 과대평가 위험.

---

## 연습문제(핸드계산 권장)

1)
$$
A=\begin{bmatrix}
1&1&2\\
0&1&1\\
1&2&3
\end{bmatrix}
$$
- RREF로 피벗 열 찾고 **열공간/행공간 기저, 랭크**를 구하라.
- $$A\vec{x}=\vec{b}$$에서 해 존재 조건을 열공간 관점으로 설명하라.

2)
$$
A=\begin{bmatrix}
1&2&3&4\\
2&4&6&8\\
0&1&1&1
\end{bmatrix}
$$
- **랭크, 널리티**를 구하고, 열공간 기저를 제시하라.
- $$\mathbb{R}^4$$의 어떤 벡터 $$\vec{x}$$가 **행공간에 투영**될 때의 표현을 설명하라.

3) 최소제곱 문제
$$
A=\begin{bmatrix}
1&0\\
1&1\\
1&2\\
1&3
\end{bmatrix},\quad
b=\begin{bmatrix}1\\2\\2\\3\end{bmatrix}
$$
- QR로 $$x_{ls}$$를 구하고 $$p=A x_{ls}$$가 $$b$$를 **열공간으로 투영**한 결과임을 확인하라.

---

## 마무리 한 문장

**열공간은 “도달 가능한 출력의 스펙트럼”, 행공간은 “입력에서 검사되는 제약의 스펙트럼”이다.**
두 공간의 차원(랭크)을 파악하는 순간, 해의 존재/형태/자유도가 한눈에 보인다.
