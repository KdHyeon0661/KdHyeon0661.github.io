---
layout: post
title: 정보보안기사 - 윈도우 기본 학습
date: 2025-11-05 20:25:23 +0900
category: 정보보안기사
---
# SECTION 01 시스템 기본 학습 — 01. 윈도우 기본 학습

## 학습 목표와 준비 환경

- 윈도우 **내부 구조(사용자/커널 모드, 인증/권한/토큰, ACL/감사)**를 보안 관점에서 이해한다.
- **계정/그룹/권한**, **파일/레지스트리/서비스** 관리와 **감사/로깅**을 실습한다.
- **PowerShell 보안(실행정책, 스크립트 로깅, AMSI)**, **Defender(AV/EDR)와 방화벽 규칙**, **업데이트/패치**를 다룬다.
- 실제 사고분석에 필요한 **이벤트ID/로그 채널**을 손에 익힌다.

필수 도구(기본 내장 위주): PowerShell 5+/7+, Event Viewer, `wevtutil`, `auditpol`, `icacls`, `sc`, `netsh`/`New-NetFirewallRule`, Windows Defender(`MpCmdRun.exe`), `gpedit.msc`/`secpol.msc`(Pro/Server 에디션), Sysinternals(선택: Process Explorer/Autoruns/Procmon).

---

## 윈도우 내부 구조 개요

### 사용자/커널 모드와 보안 핵심 컴포넌트
- **사용자 모드**: 앱/서비스가 동작. Win32, PowerShell, 서비스 프로세스.
- **커널 모드**: NT 커널, 드라이버, **SRM(Security Reference Monitor)**가 접근 권한을 최종 판정.
- **인증/권한**: LSA/LSASS(자격증명·정책), 토큰(사용자 SID, 그룹, 권한/Privileges), UAC(권한 상승).
- **객체 보호**: NTFS ACL(Owner, DACL, SACL), 무결성 수준(IL: Low/Medium/High/System).
- **정책 저장**: 로컬 보안정책, 그룹정책(GPO), 레지스트리(정책/구성).

핸즈온(현재 토큰 살펴보기):
```powershell
whoami /user
whoami /groups
whoami /priv  # SeDebugPrivilege 등 권한 목록
```

---

## 계정/그룹/권한 기본

### 로컬 계정과 기본 그룹
- **내장 계정**: `Administrator`, `Guest`(비활성 권장).
- **주요 그룹**: `Administrators`, `Users`, `Remote Desktop Users`, `Backup Operators`(신중히).
- **권한(Privileges)**: 예) `SeDebugPrivilege`(프로세스 디버그), `SeBackupPrivilege`(백업/복원), `SeTcbPrivilege`(신뢰된 컴퓨팅 베이스).
  권한은 **“권리(사용자 권리 할당)”**이고, **ACL은 객체에 대한 접근 허용/거부**다.

핸즈온(새 계정/그룹/권한 부여):
```powershell
# 로컬 계정 생성(로그온 금지 등은 보안 정책에서 설정)
New-LocalUser -Name "svc_web" -NoPassword
# 웹 서비스 계정을 로컬 그룹에 추가 (과도한 Admin 금지)
Add-LocalGroupMember -Group "Users" -Member "svc_web"

# 사용자 권리 할당(로컬 보안정책 GUI가 편하지만, 스크립팅은 secedit/PowerShell 모듈 활용)
secedit /export /cfg C:\temp\secpol.inf
# -> secpol.inf 편집 후 /configure로 반영(실습에서는 GUI 권장)
```

체크리스트(권장)
- [ ] `Guest` 비활성, `Administrator` 이름 변경 또는 LAPS 활용.
- [ ] 로컬 관리자 최소화(`Administrators` 구성원 점검).
- [ ] 서비스용 계정 별도, **로그온 권리/거부 정책**으로 사용 범위 제한.

---

## 인증/로그온(로컬/도메인)

### NTLM vs Kerberos 요약
- **로컬/워크그룹**: NTLM 기반 인증 주로 사용.
- **도메인(AD)**: Kerberos가 기본. 티켓 기반 SSO, 위임/제약된 위임으로 세밀 제어.

핸즈온(티켓 상태 확인: 도메인 환경)
```powershell
klist           # 현재 Kerberos 티켓
klist purge     # 티켓 정리(문제 해결 시 유용)
```

핸즈온(보안 로그에서 로그인 이벤트 살펴보기)
```powershell
# 성공/실패 로그인 4624/4625 최근 50개
wevtutil qe Security /q:"*[System[(EventID=4624 or EventID=4625)]]" /c:50 /f:text
```

체크리스트
- [ ] RDP/SMB 등 원격 로그온은 MFA+허용목록 기반 네트워크 제어.
- [ ] `Protected Users`(도메인) 그룹 활용(평문·NTLM 캐시 제한) 검토.
- [ ] Credential Guard(엔터프라이즈) 등 자격 증명 보호 기능 검토.

---

## NTFS/ACL/감사(파일/디렉터리 제어)

### 핵심 개념
- **Owner**는 DACL 변경 권한을 가진다.
- **DACL**: 허용/거부 ACE 목록. **상속(Inheritance)**으로 폴더 계층 관리.
- **SACL**: 감사 규칙(성공/실패), 활성화를 위해 **감사 정책** 필요.

핸즈온(팀 전용 폴더 권한/감사 랩)
```powershell
# 1. 폴더/그룹 준비
New-Item -ItemType Directory -Path "C:\Data\Finance" -Force | Out-Null
New-LocalGroup -Name "FinanceRW"
Add-LocalGroupMember -Group "FinanceRW" -Member "$env:UserName"

# 2. 상속 끊고, FinanceRW에만 읽기/쓰기 부여
icacls C:\Data\Finance /inheritance:d
icacls C:\Data\Finance /grant "FinanceRW:(OI)(CI)(M)"  # Modify

# 3. 실패 접근 감사 규칙(Everyone) 추가 (감사 정책 켬 전제)
icacls C:\Data\Finance /setaudit "(OI)(CI)(F)" /t
# 주의: 실습에서는 범위를 좁혀 특정 사용자 대상으로 감사 설정 권장
```

핸즈온(감사 정책 활성화)
```powershell
# 고급 감사 정책(객체 접근) 활성화 예
auditpol /set /category:"Object Access" /subcategory:"File System" /success:enable /failure:enable
```

검증(이벤트 확인)
```powershell
# 파일 접근 감사 이벤트: 4663
wevtutil qe Security /q:"*[System[(EventID=4663)]]" /c:10 /f:text
```

체크리스트
- [ ] 민감 폴더는 **상속 해제**, 최소 권한만 부여.
- [ ] **감사 정책**을 켜고, **SACL**로 핵심 폴더 접근을 로깅.
- [ ] `icacls`/탐색기로 **권한/감사 규칙** 주기 점검.

---

## 레지스트리/서비스/드라이버

### 레지스트리 구조
- `HKLM`(컴퓨터 전역), `HKCU`(현재 사용자), `HKCR`(파일연결), `HKU`(모든 사용자), `HKCC`(하드웨어 프로필).
- 보안/정책 설정은 `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies` 등.

핸즈온(레지스트리 조회/설정)
```powershell
Get-Item 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' | fl
# 값 설정(관리자 권한)
reg add HKLM\SOFTWARE\...\System /v EnableLUA /t REG_DWORD /d 1 /f
```

### 서비스/드라이버
- `sc.exe`로 서비스 조회/시작/중지/설정, 보안 서술자(SD)도 확인 가능.
- 드라이버는 **커널 모드** 코드. 서명 정책/트러스트 중요.

핸즈온(서비스 관리)
```powershell
# 서비스 목록/상태
Get-Service | Sort-Object Status,DisplayName | Select-Object -First 10
# 특정 서비스 시작/중지
Stop-Service -Name Spooler
Start-Service -Name Spooler
# 서비스 보안 서술자(읽기)
sc.exe sdshow Spooler
```

체크리스트
- [ ] 불필요 서비스 **사용 안 함** 설정(특히 PC에서 서버용 서비스).
- [ ] 서비스 실행 계정 권한 최소화(로컬 시스템 계정 남용 금지).
- [ ] 서명되지 않은 드라이버 차단/점검.

---

## 프로세스/작업 스케줄러/시작 프로그램

### 프로세스/스레드/토큰
- 상속/자식 프로세스 체인, **명령줄(클)**은 행위 분석의 핵심.
- 토큰 무결성 수준(IL)에 따른 **쓰기 제한**(예: Medium → High 쓰기 불가).

핸즈온(프로세스 살펴보기)
```powershell
Get-Process | Sort-Object WS -Descending | Select-Object -First 10 Name,Id,WS,CPU
# 네트워크 연결(관리자 권한 권장)
Get-NetTCPConnection | ? {$_.State -eq "Established"} | Select-Object -First 20
```

### 작업 스케줄러/오토런
- **영속화** 주요 통로: 스케줄러, `Run` 키, 서비스, WMI 이벤트 구독.
- Autoruns(Sysinternals)로 전체 시작지점 점검 권장.

핸즈온(스케줄 작업 확인)
```powershell
schtasks /query /fo LIST /v | more
# 의심 작업 비활성화
schtasks /Change /TN "\Updater\Something" /Disable
```

체크리스트
- [ ] 시작 프로그램/스케줄러 등록 항목 **리뷰**.
- [ ] 브라우저 확장, Office 매크로 자동실행 **차단/서명만 허용**.

---

## 로깅/감사/이벤트 채널

### 핵심 이벤트 채널과 ID
- **Security**: 로그인(4624/4625), 권한할당/사용(4672/4673/4674), 파일 접근(4663).
- **System/Application**: 서비스/드라이버/앱 오류.
- **Microsoft-Windows-PowerShell/Operational**: PowerShell 명령/스크립트 로깅.
- **Sysmon(선택 설치)**: 프로세스 생성(1), 네트워크(3), 파일 생성(11), 레지스트리 등 풍부한 행위 로그.

핸즈온(빠른 질의)
```powershell
# 최근 보안 경보 200개
wevtutil qe Security /c:200 /f:text | Out-File C:\temp\sec_tail.txt
# PowerShell Operational 로그 켜기(정책/레지스트리로도 가능)
Set-ItemProperty 'HKLM:\SOFTWARE\Microsoft\Windows\PowerShell\3\PowerShellEngine' -Name EnableConsoleSessionLogging -Value 1
```

체크리스트
- [ ] **고급 감사 정책**(Account Logon, Logon/Logoff, Object Access, Policy Change 등) 구성.
- [ ] PowerShell **ScriptBlock/모듈 로깅** 활성화.
- [ ] 로그 **보존 기간/크기** 상향, 중앙 수집(SIEM) 연계.

---

## PowerShell 기본과 보안

### 실행 정책/서명/AMSI
- 실행정책은 **보안 경고 수준**(우회 가능)이지 **보안 경계가 아님**.
- **스크립트 서명** 및 **Constrained Language Mode(CLM)**, **AMSI**로 악성 스크립트 차단.

핸즈온(실행정책/로그/서명)
```powershell
Get-ExecutionPolicy -List
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine

# 스크립트 블록 로깅(GPO/레지스트리 권장)
New-Item -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging -Force | Out-Null
New-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging -Name EnableScriptBlockLogging -Type DWord -Value 1 -Force

# 서명 검증(코드 서명 인증서 필요)
Get-AuthenticodeSignature .\Deploy.ps1
```

핸즈온(웹 요청/AMSI 체험)
```powershell
# 정상 사용
Invoke-WebRequest https://example.com -UseBasicParsing

# 악성 행위 의심 문자열이 포함된 스크립트는 AMSI에서 탐지될 수 있음(실제 악성 실행 금지)
```

체크리스트
- [ ] 운영 서버는 **RemoteSigned 이상**, 서명 스크립트만 허용 검토.
- [ ] ScriptBlock/모듈/전사(Transcription) 로깅 활성화.
- [ ] PowerShell 2.0 기능 제거(레거시 기법 차단).

---

## 네트워킹과 방화벽(Windows Firewall)

핸즈온(방화벽 기본 규칙)
```powershell
# 인바운드/아웃바운드 규칙 나열
Get-NetFirewallRule -Direction Inbound | Select-Object -First 5 DisplayName,Enabled,Action,Direction
# 포트 22 인바운드 차단(예시)
New-NetFirewallRule -DisplayName "Block-SSH-In" -Direction Inbound -Protocol TCP -LocalPort 22 -Action Block
# 특정 프로세스 아웃바운드 허용만
New-NetFirewallRule -DisplayName "Allow-App-Out" -Direction Outbound -Program "C:\App\app.exe" -Action Allow
```

핸즈온(네트워크 세션 관찰)
```powershell
Get-NetTCPConnection | ? {$_.State -eq "Established"} | Sort-Object RemoteAddress | Select-Object -First 20
```

체크리스트
- [ ] 인바운드 기본 **차단**, 필요한 서비스만 허용.
- [ ] 아웃바운드도 **애플리케이션/목적지 기반 최소 허용** 검토.
- [ ] RDP/SMB는 내부 IP/VPN에서만 허용.

---

## 업데이트/패치/Defender(AV/EDR)

핸즈온(Windows Update)
```powershell
# Server: sconfig 또는 그룹정책/WSUS로 관리 권장
# 클라이언트: 설정 앱 또는 wuauclt /reportnow(신형에서는 제한적)
```

핸즈온(Defender – 실시간/스캔/ASR)
```powershell
Get-MpComputerStatus | fl AMServiceEnabled,AntispywareEnabled,RealTimeProtectionEnabled
# 빠른 스캔
Start-MpScan -ScanType QuickScan
# 서명 업데이트
Update-MpSignature
# ASR 규칙 켜기(대표 하나 예시: Office에서 자식 프로세스 차단)
Set-MpPreference -AttackSurfaceReductionRules_Ids D4F940AB-401B-4EFC-AADC-AD5F3C50688A -AttackSurfaceReductionRules_Actions Enabled
```

체크리스트
- [ ] 월간 누적 패치/Out-of-band 보안 패치 **적기 적용**.
- [ ] Defender 실시간 보호/클라우드 제공 분석/ASR 규칙 **활성**.
- [ ] 정기 스캔/서명 업데이트 **자동화**.

---

## 하드닝 미니 베이스라인(로컬 단독 서버 예시)

1) **계정/권한**: 로컬 Admin 최소화, 서비스 계정 분리, 로그온 권리 제어.
2) **네트워크**: 인바운드 기본 차단, RDP 제한, SMBv1 비활성.
3) **로깅/감사**: 고급 감사 정책, PowerShell ScriptBlock 로깅, 로그 보존 확대.
4) **파일/폴더**: 민감 경로 상속 해제, 최소 권한, SACL 감사.
5) **실행 제어**: AppLocker/WDAC(가능 시), Office 매크로 제한.
6) **업데이트/AV**: 패치 최신, Defender/ASR 켜기.
7) **백업/복구**: 정기 백업, 복구 리허설.

핸즈온(SMBv1 비활성)
```powershell
Disable-WindowsOptionalFeature -Online -FeatureName "SMB1Protocol" -NoRestart
```

핸즈온(AppLocker 기본 정책 예 — Enterprise/Server)
```powershell
# 로컬 보안정책/그룹정책에서 AppLocker 구성(실습은 감사 모드부터)
# PowerShell Providers for AppLocker 또는 secpol.msc → AppLocker
```

---

## 실습 프로젝트 A — 안전 폴더 운영(권한/감사/모니터링)

목표: `C:\Data\Finance`를 최소 권한 + 감사 활성 상태로 운영하고, 접근 이벤트 4663을 SIEM/로컬로 검증.

절차:
1) `FinanceRW` 로컬 그룹 생성, 구성원 지정.
2) `C:\Data\Finance` 상속 해제, `FinanceRW`에만 Modify, 관리자에 Full.
3) 고급 감사 정책(파일 시스템) 성공/실패 활성.
4) `icacls`로 SACL(감사 규칙) 추가(대상 범위 최소화).
5) 테스트 사용자로 접근/실패 이벤트 유도 → 이벤트ID 4663 수집.

검증:
```powershell
wevtutil qe Security /q:"*[System[(EventID=4663)]]" /c:5 /f:text
```

---

## 실습 프로젝트 B — PowerShell 로깅·방화벽·Defender 자동 구성 스크립트

```powershell
# 1. PowerShell ScriptBlock 로깅
New-Item -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging -Force | Out-Null
New-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging `
  -Name EnableScriptBlockLogging -Type DWord -Value 1 -Force | Out-Null

# 2. 방화벽: 인바운드 기본차단(권장), 서비스별 허용만 추가(예: WinRM 내부망)
Set-NetFirewallProfile -Profile Domain,Public,Private -DefaultInboundAction Block -DefaultOutboundAction Allow
New-NetFirewallRule -DisplayName "Allow-WinRM-From-IT" -Direction Inbound -Protocol TCP -LocalPort 5985 -RemoteAddress 10.0.0.0/24 -Action Allow

# 3. Defender: 서명 업데이트 + 빠른 스캔 + ASR 규칙 하나 활성
Update-MpSignature
Start-MpScan -ScanType QuickScan
Set-MpPreference -AttackSurfaceReductionRules_Ids D4F940AB-401B-4EFC-AADC-AD5F3C50688A -AttackSurfaceReductionRules_Actions Enabled
```

---

## 흔한 실수/사고 포인트와 대응

- **로컬 Administrators 방치**: 잔존 기본 계정, 퇴사자 계정 미정리 → 정기 점검 스케줄러로 목록 내보내기.
- **RDP 공개/약한 암호**: 무차별 대입, 랜섬웨어 진입 → VPN+MFA, 방화벽 원천지 제한.
- **감사 미구성/로그 과소**: 사고 시 재현 불가 → 고급 감사 정책 표준 템플릿 도입, 보존 주기 확대.
- **PowerShell 로깅 미흡**: 스크립트 기반 침해 추적 어려움 → ScriptBlock/모듈/전사 로깅.
- **SMBv1/낡은 프로토콜**: 웜·랜섬 확산 → 기능 제거, 서명/암호화 활성, 최신 SMB만.

---

## 예상문제 (필기형·실기형 혼합)

1) **[개념]** SRM과 DACL/SACL의 역할 차이를 설명하라.
2) **[실무]** `C:\Data\HR`에 대해 `HRRW` 그룹에만 Modify, 실패 접근 감사 활성화를 명령 3줄로 제시하라.
3) **[실무]** 최근 2시간의 경고 이상 보안 이벤트를 텍스트로 내보내는 명령을 작성하라.
4) **[개념]** Kerberos와 NTLM의 차이, 도메인 환경에서 Kerberos가 선호되는 이유 2가지.
5) **[실무]** PowerShell ScriptBlock 로깅을 레지스트리로 활성화하는 키/값을 명시하라.
6) **[실무]** Defender에서 ASR 하나를 활성화하는 PowerShell 한 줄.
7) **[실무]** 인바운드 22/TCP 차단 방화벽 규칙을 생성하는 PowerShell 명령.

예시 답안 스니펫:
```powershell
# Q2
icacls C:\Data\HR /inheritance:d
icacls C:\Data\HR /grant "HRRW:(OI)(CI)(M)"
auditpol /set /category:"Object Access" /subcategory:"File System" /success:enable /failure:enable
```
```powershell
# Q3
wevtutil qe Security /q:"*[System[TimeCreated[timediff(@SystemTime) <= 7200000] and (Level<=3)]]" /f:text > C:\temp\sec_2h.txt
```
```powershell
# Q5
New-Item -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging -Force | Out-Null
New-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging -Name EnableScriptBlockLogging -Type DWord -Value 1 -Force
```
```powershell
# Q6
Set-MpPreference -AttackSurfaceReductionRules_Ids D4F940AB-401B-4EFC-AADC-AD5F3C50688A -AttackSurfaceReductionRules_Actions Enabled
```
```powershell
# Q7
New-NetFirewallRule -DisplayName "Block-SSH-In" -Direction Inbound -Protocol TCP -LocalPort 22 -Action Block
```

---

## 최종 점검 체크리스트

- [ ] `whoami /groups`,`/priv` 결과를 해석할 수 있다.
- [ ] 로컬 계정/그룹/권한을 PowerShell로 생성/부여/회수할 수 있다.
- [ ] NTFS 상속 해제/권한/감사(SACL)를 `icacls`로 구성할 수 있다.
- [ ] 고급 감사 정책과 파일 접근 이벤트(4663)를 수집/해석할 수 있다.
- [ ] PowerShell 실행정책/ScriptBlock 로깅/Transcription을 활성화했다.
- [ ] 방화벽 인바운드 기본 차단, 필요 서비스만 허용 규칙을 만든다.
- [ ] Defender 서명/스캔/ASR 최소 1개 이상 활성 상태다.
- [ ] SMBv1 비활성, RDP/VPN/MFA/원천지 제한이 적용됐다.
- [ ] 주간 로그 덤프/보존 스크립트를 운영 중이다.

---

## 요약

이 장을 마치면 다음을 할 수 있어야 한다.
- 토큰/권한/ACL/감사 등 윈도우 보안의 **심장부 메커니즘**을 설명하고,
- **PowerShell·Defender·방화벽·감사 정책**을 조합해 **즉시 하드닝/분석**하며,
- 사고 시 **필요 로그를 빠르게 모아 재현**하고, **권한/네트워크 통로를 최소화**한다.
