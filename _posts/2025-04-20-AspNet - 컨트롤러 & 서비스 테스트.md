---
layout: post
title: AspNet - ì»¨íŠ¸ë¡¤ëŸ¬ & ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
date: 2025-04-10 21:20:23 +0900
category: AspNet
---
# ğŸ§ª ASP.NET Core ì»¨íŠ¸ë¡¤ëŸ¬ & ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ìì„¸íˆ ì•Œì•„ë³´ê¸°

---

## âœ… 1. í…ŒìŠ¤íŠ¸ ê³„ì¸µ êµ¬ì¡° ì´í•´

| í…ŒìŠ¤íŠ¸ ìœ í˜• | ëŒ€ìƒ | ì„¤ëª… |
|-------------|------|------|
| ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | ì„œë¹„ìŠ¤, í—¬í¼, ìœ í‹¸ë¦¬í‹° ë“± | ì˜ì¡´ì„± ê²©ë¦¬í•˜ì—¬ **ë‹¨ìœ„ ê¸°ëŠ¥ë§Œ ê²€ì¦** |
| ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ | Controller í´ë˜ìŠ¤ | DIëœ ì„œë¹„ìŠ¤ ëª¨í‚¹í•˜ì—¬ API ì‘ë‹µ ê²€ì¦ |
| í†µí•© í…ŒìŠ¤íŠ¸ | ì „ì²´ ì•± íë¦„ | ì‹¤ì œ HTTP ìš”ì²­/ì‘ë‹µ ê¸°ë°˜ìœ¼ë¡œ **ì—”ë“œ íˆ¬ ì—”ë“œ** ê²€ì¦ |

---

## ğŸ§© 2. ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ (Unit Test)

### ğŸ”¹ ì˜ˆì‹œ ì„œë¹„ìŠ¤

```csharp
public interface IUserService
{
    string GetUserName(int userId);
}

public class UserService : IUserService
{
    public string GetUserName(int userId)
    {
        if (userId <= 0) throw new ArgumentException("Invalid ID");
        return $"User_{userId}";
    }
}
```

---

### ğŸ§ª í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ (xUnit + Moq)

```csharp
public class UserServiceTests
{
    private readonly IUserService _service;

    public UserServiceTests()
    {
        _service = new UserService();
    }

    [Fact]
    public void GetUserName_ShouldReturnFormattedName()
    {
        var result = _service.GetUserName(3);
        Assert.Equal("User_3", result);
    }

    [Fact]
    public void GetUserName_InvalidId_ShouldThrow()
    {
        Assert.Throws<ArgumentException>(() => _service.GetUserName(0));
    }
}
```

---

## ğŸ§­ 3. ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)

### ğŸ”¹ ì˜ˆì‹œ ì»¨íŠ¸ë¡¤ëŸ¬

```csharp
[ApiController]
[Route("api/[controller]")]
public class UserController : ControllerBase
{
    private readonly IUserService _userService;
    public UserController(IUserService userService)
    {
        _userService = userService;
    }

    [HttpGet("{id}")]
    public IActionResult GetUserName(int id)
    {
        try
        {
            var name = _userService.GetUserName(id);
            return Ok(name);
        }
        catch (Exception)
        {
            return BadRequest("ì˜ëª»ëœ ì‚¬ìš©ì IDì…ë‹ˆë‹¤.");
        }
    }
}
```

---

### ğŸ§ª í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ (Moq ì‚¬ìš©)

```csharp
public class UserControllerTests
{
    private readonly Mock<IUserService> _mockService;
    private readonly UserController _controller;

    public UserControllerTests()
    {
        _mockService = new Mock<IUserService>();
        _controller = new UserController(_mockService.Object);
    }

    [Fact]
    public void GetUserName_ValidId_ReturnsOk()
    {
        _mockService.Setup(s => s.GetUserName(1)).Returns("User_1");

        var result = _controller.GetUserName(1) as OkObjectResult;

        Assert.NotNull(result);
        Assert.Equal(200, result.StatusCode);
        Assert.Equal("User_1", result.Value);
    }

    [Fact]
    public void GetUserName_InvalidId_ReturnsBadRequest()
    {
        _mockService.Setup(s => s.GetUserName(0)).Throws<ArgumentException>();

        var result = _controller.GetUserName(0) as BadRequestObjectResult;

        Assert.NotNull(result);
        Assert.Equal(400, result.StatusCode);
        Assert.Equal("ì˜ëª»ëœ ì‚¬ìš©ì IDì…ë‹ˆë‹¤.", result.Value);
    }
}
```

---

## ğŸ§° 4. ë„êµ¬ ìš”ì•½

| ë„êµ¬ | ì—­í•  |
|------|------|
| `xUnit` | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í”„ë ˆì„ì›Œí¬ |
| `Moq` | ì¸í„°í˜ì´ìŠ¤, ì„œë¹„ìŠ¤ ë“± ì˜ì¡´ì„± ëª¨í‚¹ |
| `FluentAssertions` | ê°€ë…ì„± ì¢‹ì€ Assertion ì‘ì„± |
| `Bogus` | ê°€ì§œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±ê¸° |
| `AutoFixture` | ìë™ ê°ì²´ ìƒì„± ìœ í‹¸ë¦¬í‹° |

---

## ğŸ”¬ 5. í†µí•© í…ŒìŠ¤íŠ¸ ê°œë… ì •ë¦¬

- ì‹¤ì œ **HTTP ìš”ì²­/ì‘ë‹µ** ê¸°ë°˜ í…ŒìŠ¤íŠ¸
- `TestServer`, `WebApplicationFactory<TEntryPoint>` ì‚¬ìš©
- ì‹¤ì œ DB ì—°ë™ ì—†ì´ `InMemory` DB ë“±ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥

### ê¸°ë³¸ êµ¬ì„± (ì˜ˆê³ í¸)

```csharp
public class CustomWebAppFactory : WebApplicationFactory<Program> { }

public class UserIntegrationTests : IClassFixture<CustomWebAppFactory>
{
    private readonly HttpClient _client;

    public UserIntegrationTests(CustomWebAppFactory factory)
    {
        _client = factory.CreateClient();
    }

    [Fact]
    public async Task GetUserName_ShouldReturnSuccess()
    {
        var response = await _client.GetAsync("/api/user/1");
        var body = await response.Content.ReadAsStringAsync();

        Assert.Equal(HttpStatusCode.OK, response.StatusCode);
        Assert.Equal("User_1", body);
    }
}
```

---

## âœ… í…ŒìŠ¤íŠ¸ ê´€ì  ì •ë¦¬ ìš”ì•½

| ëŒ€ìƒ | ìœ í˜• | ë„êµ¬ | ëª©ì  |
|------|------|------|------|
| ì„œë¹„ìŠ¤ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | xUnit, Moq | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ |
| ì»¨íŠ¸ë¡¤ëŸ¬ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | xUnit, Moq | API ì‘ë‹µ êµ¬ì¡° í™•ì¸ |
| ì „ì²´ ìš”ì²­ | í†µí•© í…ŒìŠ¤íŠ¸ | WebApplicationFactory | ì „ì²´ íë¦„ ê²€ì¦ |

---

## ğŸ§  ì‹¤ë¬´ íŒ

- ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ëŠ” **Mock ì„œë¹„ìŠ¤**ë¥¼ ë„£ê³  í…ŒìŠ¤íŠ¸
- `ActionResult<T>`ëŠ” `OkObjectResult`, `BadRequestObjectResult` ë“±ìœ¼ë¡œ í˜•ë³€í™˜ í•„ìš”
- ì„œë¹„ìŠ¤ ë ˆì´ì–´ëŠ” **ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥**í•˜ê²Œ ì„¤ê³„
- ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ëŠ” ë¹ ë¥´ì§€ë§Œ **ë³´ì•ˆ/ë¯¸ë“¤ì›¨ì–´ ê²€ì¦ ë¶ˆê°€**
- í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ëŠë¦¬ì§€ë§Œ **ì‹¤ì œ ìš”ì²­ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ ê°€ëŠ¥**