---
layout: post
title: 이산수학 - 이항 계수
date: 2025-06-08 21:20:23 +0900
category: 이산수학
---
# 이항 계수(Binomial Coefficient)

## 0. 표기와 관례

- $$\displaystyle \binom{n}{r}=\frac{n!}{r!(n-r)!},\quad 0\le r\le n$$
- 경계와 확장:
  - $$\binom{n}{r}=0\quad (r<0\ \text{또는}\ r>n)$$
  - $$0!=1,\ \binom{n}{0}=\binom{n}{n}=1$$
- 실수/복소 상수 $$\alpha$$ 에 대한 일반화:
  - $$\displaystyle \binom{\alpha}{r}=\frac{\alpha(\alpha-1)\cdots(\alpha-r+1)}{r!},\ r\ge 0,\ \binom{\alpha}{0}=1.$$

---

## 1. 정의(조합적/대수적)

### 1.1 조합적 정의
“서로 다른 $$n$$개 중 **순서 없이** $$r$$개 선택”의 경우의 수:
$$
\binom{n}{r}.
$$

### 1.2 대수적 정의
$$
\binom{n}{r}=\frac{n!}{r!(n-r)!}.
$$

### 1.3 흡수(Absorption) 항등식
$$
r\binom{n}{r}=n\binom{n-1}{r-1}.
$$
**해석:** $$n$$명 중 $$r$$명을 뽑고 그 중 1명을 ‘대표’로 표시(좌변)
= 먼저 대표를 뽑고(방법 $$n$$) 나머지 $$r-1$$명 뽑기(우변).

---

## 2. 기본 성질

### 2.1 대칭성
$$
\binom{n}{r}=\binom{n}{n-r}.
$$
> “뽑을 사람”을 고르는 것과 “버릴 사람”을 고르는 것은 동등.

### 2.2 파스칼 점화식
$$
\binom{n}{r}=\binom{n-1}{r-1}+\binom{n-1}{r}.
$$
> 특정 인원 X를 포함/제외 두 경우로 분할.

### 2.3 부분집합 총합
$$
\sum_{r=0}^{n}\binom{n}{r}=2^n.
$$
> $$n$$개 원소의 모든 부분집합 수.

### 2.4 중앙 이항 계수(중심항)와 근사
$$
\binom{2n}{n}\approx \frac{4^n}{\sqrt{\pi n}},\quad \text{(스털링 근사)}
$$
그리고
$$
\frac{4^n}{2\sqrt{n}}\le \binom{2n}{n}\le \frac{4^n}{\sqrt{3n+1}} \quad (\text{대표적 경계})
$$

---

## 3. 파스칼 삼각형(Pascal’s Triangle)

맨 위에서 시작해 양옆 밖은 0으로 보고, 바로 위 두 수의 합으로 채운다:

```
       1
      1 1
     1 2 1
    1 3 3 1
   1 4 6 4 1
  1 5 10 10 5 1
   ...
```

예:
$$
\binom{5}{2}=\binom{4}{1}+\binom{4}{2}=4+6=10.
$$

---

## 4. 대표 항등식과 조합적 증명

### 4.1 호키스틱(빙산) 항등식
$$
\sum_{k=r}^{n}\binom{k}{r}=\binom{n+1}{r+1}.
$$
**조합적 증명:** $$\{0,\dots,n\}$$에서 $$r+1$$개를 고를 때 **가장 큰 원소**를 $$j$$라 두고 분할.

### 4.2 반더몬드(Vandermonde)
$$
\sum_{k}\binom{m}{k}\binom{n}{r-k}=\binom{m+n}{r}.
$$
**해석:** 두 집합(크기 $$m,n$$)에서 합쳐 $$r$$명 선택 = 집합 A에서 $$k$$명, B에서 $$r-k$$명 선택을 합산.

### 4.3 상향/하향 이동(Shifting)
$$
\binom{n}{r}=\binom{n-1}{r}+\binom{n-1}{r-1}\ \Rightarrow\
\binom{n+1}{r}=\binom{n}{r}+\binom{n}{r-1}.
$$

### 4.4 부호 있는 상한(음수 상한) 공식
$$
\binom{-\alpha}{r}=(-1)^r\binom{\alpha+r-1}{r}.
$$
**용도:** 뉴턴 이항정리에서 실수/음수 지수 전개.

### 4.5 교대합
$$
\sum_{r=0}^{n}(-1)^r\binom{n}{r}=0\quad (n\ge 1).
$$
**증명:** $$(1-1)^n=0.$$

---

## 5. 생성함수와 이항정리

### 5.1 다항 생성함수(Ordinary GF)
$$
(1+x)^n=\sum_{r=0}^{n}\binom{n}{r}x^r.
$$

### 5.2 뉴턴 이항정리(실수 지수)
$$
(1+x)^\alpha=\sum_{r=0}^{\infty}\binom{\alpha}{r}x^r,\quad |x|<1.
$$

### 5.3 지수 생성함수(EGF)
열 $$\binom{n}{r}$$의 $$n$$에 대한 EGF:
$$
\sum_{n\ge r}\binom{n}{r}\frac{t^n}{n!}=\frac{t^r}{r!}e^t.
$$

---

## 6. 격자 경로·카탈랑·볼롯(응용 해석)

### 6.1 격자 경로
오른쪽(R)과 위(U)만 허용, $$(0,0)\to (a,b)$$ 경로 수:
$$
\binom{a+b}{a}=\binom{a+b}{b}.
$$

### 6.2 카탈랑 수
$$
C_n=\frac{1}{n+1}\binom{2n}{n}.
$$
“대각선 위로 넘지 않는” 경로 수, 올바른 괄호 수 등.

### 6.3 볼롯(Ballot) 문제(간단형)
후보 A가 $$p$$표, B가 $$q$$표$$(p>q)$$. 집계 동안 A가 항상 앞서는 경우의 수:
$$
\frac{p-q}{p+q}\binom{p+q}{q}.
$$

---

## 7. 확률: 이항분포와의 연결

### 7.1 이항분포
$$
X\sim \mathrm{Bin}(n,p)\quad\Rightarrow\quad
\mathbb{P}(X=r)=\binom{n}{r}p^r(1-p)^{n-r}.
$$

### 7.2 베르누이 시행의 합
성공/실패 독립 시행의 합이 이항분포를 따르고, **계수**가 이항 계수.

---

## 8. 계산 알고리즘(파이썬 실습 포함)

> 파이썬은 큰 정수를 정확히 다룹니다. 모듈러 연산, DP, 곱셈식, Lucas 등 상황별로 선택하세요.

### 8.1 내장 정밀 조합
```python
import math

def nCr(n, r):
    if r < 0 or r > n: return 0
    return math.comb(n, r)  # Python 3.8+
```

### 8.2 곱셈식(오버플로우 방지·약분 전략)
$$
\binom{n}{r}=\prod_{i=1}^{r}\frac{n-r+i}{i},\quad r=\min(r,n-r)
$$
```python
from math import gcd

def nCr_mul(n, r):
    if r < 0 or r > n: return 0
    r = min(r, n - r)
    num, den = 1, 1
    for i in range(1, r + 1):
        num *= (n - r + i)
        den *= i
        g = gcd(num, den)
        num //= g; den //= g
    return num  # den은 1이어야 함
```

### 8.3 DP(파스칼 테이블, O(nr))
```python
def nCr_dp(n, r):
    if r < 0 or r > n: return 0
    C = [0]*(r+1)
    C[0] = 1
    for i in range(1, n+1):
        # 역순 업데이트
        for j in range(min(i, r), 0, -1):
            C[j] += C[j-1]
    return C[r]
```

### 8.4 모듈러 연산(소수 MOD, 전처리)
$$
\binom{n}{r}\bmod p=\frac{n!\bmod p}{(r!(n-r)!)\bmod p}
$$
(페르마 역원)
```python
MOD = 10**9 + 7

def build_fact(N, mod=MOD):
    fact = [1]*(N+1)
    invf = [1]*(N+1)
    for i in range(1, N+1):
        fact[i] = fact[i-1]*i % mod
    invf[N] = pow(fact[N], mod-2, mod)  # Fermat inverse
    for i in range(N, 0, -1):
        invf[i-1] = invf[i]*i % mod
    return fact, invf

def nCr_mod(n, r, fact, invf, mod=MOD):
    if r < 0 or r > n: return 0
    return fact[n]*invf[r]%mod*invf[n-r]%mod

# 예시
fact, invf = build_fact(1_000_000)
print(nCr_mod(1000000, 500000, fact, invf))
```

### 8.5 Lucas 정리(매우 큰 n, r에 대해 p진 전개)
$$
\binom{n}{r}\equiv \prod_i \binom{n_i}{r_i}\pmod p,
$$
여기서 $$n=\sum n_ip^i,\ r=\sum r_ip^i$$.
```python
import math

def nCr_small(n, r, p):
    # 0<=n,r<p 소수 p에서 작은 조합 (팩토리얼 전처리 가능)
    if r < 0 or r > n: return 0
    num = den = 1
    for i in range(1, r+1):
        num = (num * (n - r + i)) % p
        den = (den * i) % p
    return (num * pow(den, p-2, p)) % p

def nCr_lucas(n, r, p):
    res = 1
    while n > 0 or r > 0:
        ni, ri = n % p, r % p
        res = (res * nCr_small(ni, ri, p)) % p
        n //= p; r //= p
    return res

print(nCr_lucas(10**18, 10**9, 1_000_003))
```

### 8.6 Kummer 정리(소인수 지수)
**정리:** $$\nu_p\!\big(\binom{n}{r}\big)=$$ $$n$$과 $$r$$을 더할 때 **기수 $$p$$**에서 발생하는 **올림 횟수**.
용도: “$$p$$로 나누어떨어지나?”를 빠르게 판단.

### 8.7 Combinadic(조합 인덱싱: 랭크/언랭크)
#### 언랭크: 인덱스 → 조합(사전식)
```python
import math

# 0-indexed rank, choose r from [0..n-1]
def unrank_comb(n, r, rank):
    comb = []
    x = 0
    for k in range(r, 0, -1):
        while math.comb(n - 1 - x, k - 1) <= rank:
            rank -= math.comb(n - 1 - x, k - 1)
            x += 1
        comb.append(x); x += 1
    return comb

print(unrank_comb(5, 3, 17 % math.comb(5,3)))  # 예시
```
#### 랭크: 조합 → 인덱스
```python
def rank_comb(n, comb):
    # comb: 오름차순 인덱스 리스트
    r = len(comb)
    rank = 0
    prev = -1
    for i, c in enumerate(comb):
        for x in range(prev+1, c):
            rank += math.comb(n - 1 - x, r - 1 - i)
        prev = c
    return rank

print(rank_comb(5, [0,2,4]))  # 예시
```

### 8.8 이항 변환(바이노미얼 트랜스폼)과 역변환
$$
b_n=\sum_{k=0}^n \binom{n}{k} a_k,\quad
a_n=\sum_{k=0}^n (-1)^{n-k}\binom{n}{k} b_k.
$$
```python
def binomial_transform(a):
    n = len(a)
    b = [0]*n
    for i in range(n):
        s = 0
        for k in range(i+1):
            s += math.comb(i, k)*a[k]
        b[i] = s
    return b

def inverse_binomial_transform(b):
    n = len(b)
    a = [0]*n
    for i in range(n):
        s = 0
        for k in range(i+1):
            s += ((-1)**(i-k))*math.comb(i, k)*b[k]
        a[i] = s
    return a
```

---

## 9. 실전 문제 패턴(모델링)

### 9.1 좌석/배치
- “$$n$$명 줄세우기”는 $$n!$$,
- “팀 뽑고 직책 부여”는 $$\binom{n}{r}r!=P(n,r)$$,
- 인접 금지는 **포함배제** 또는 “빈칸 끼워넣기” 기법.

### 9.2 분할/분배
- 서로 다른 $$n$$개를 라벨된 $$m$$상자에 **각 $$r_i$$개씩**:
  $$\frac{n!}{r_1!\cdots r_m!}$$ (다항계수).
- **중복 허용** 분배(같은 종류 물건): “별과 막대”
  $$\binom{n+r-1}{r}.$$

### 9.3 격자/경로/제약
- 경로 수는 기본적으로 이항 계수, 대각선 제한은 반사법/카탈랑.

---

## 10. 항등식 모음(요긴한 레퍼런스)

- **반더몬드**: $$\displaystyle \sum_k \binom{m}{k}\binom{n}{r-k}=\binom{m+n}{r}$$
- **호키스틱**: $$\displaystyle \sum_{k=r}^{n}\binom{k}{r}=\binom{n+1}{r+1}$$
- **흡수**: $$r\binom{n}{r}=n\binom{n-1}{r-1}$$
- **중심합**: $$\displaystyle \sum_{r=0}^{n} \binom{n}{r}^2 = \binom{2n}{n}$$
- **교대합**: $$\displaystyle \sum_{r=0}^{n} (-1)^r\binom{n}{r}=0\ (n\ge1)$$
- **가중교대합**: $$\displaystyle \sum_{r=0}^{n} (-1)^r\binom{n}{r}r^k=0\ (0\le k<n)$$
- **음수 상한**: $$\binom{-\alpha}{r}=(-1)^r\binom{\alpha+r-1}{r}$$
- **다항(다중) 계수**: $$(x_1+\cdots+x_m)^n=\sum_{r_1+\cdots+r_m=n}\binom{n}{r_1,\dots,r_m}\prod_i x_i^{r_i}$$

---

## 11. 예제 풀이(상황 → 수식 → 값)

### 예제 1) 조합 계산
- 문제: $$\binom{6}{2}=?$$
- 풀이: $$\displaystyle \frac{6!}{2!\,4!}=\frac{720}{48}=15.$$

### 예제 2) 부분집합 총수
- 문제: 크기 12 집합의 모든 부분집합 수?
- 풀이: $$\displaystyle \sum_{r=0}^{12}\binom{12}{r}=2^{12}=4096.$$

### 예제 3) 격자 경로
- 문제: $$(0,0)\to(7,3)$$ 경로 수?
- 풀이: R 7번, U 3번 → $$\binom{10}{3}=120.$$

### 예제 4) 중복 조합
- 문제: 5종 음료에서 8잔 주문(중복 허용, 순서X)
- 풀이: $$\displaystyle \binom{5+8-1}{8}=\binom{12}{8}=495.$$

### 예제 5) 중앙 이항 근사
- 문제: $$\binom{200}{100}\approx ?$$
- 근사: $$\approx \frac{4^{100}}{\sqrt{\pi\cdot 100}}\approx \frac{1.6\times 10^{60}}{17.7}\approx 9.0\times 10^{58}$$ (대략 규모 파악).

### 예제 6) 모듈러 계산
- 문제: $$\binom{10^6}{10^5}\bmod (10^9+7)$$
- 풀이: 팩토리얼/역팩토리얼 전처리로 한 번에.

---

## 12. 연습문제(간단 해설)

1) 증명: $$\binom{n}{r}=\binom{n-1}{r}+\binom{n-1}{r-1}$$ (포함/제외로)
2) 계산: $$\sum_{k=0}^n \binom{n}{k}^2=\binom{2n}{n}$$ (격자 경로 쌍/반더몬드로)
3) 증명: $$\sum_{r=0}^n (-1)^r\binom{n}{r}=0$$ (단서: $$(1-1)^n$$)
4) 경로: 대각선 위로 넘지 않는 $$(0,0)\to (n,n)$$ 경로 수 = $$C_n$$
5) 모듈러: 소수 $$p$$에 대해 $$\binom{ap}{bp}\equiv \binom{a}{b}\pmod p$$ (Lucas로)

---

## 13. 파이썬 미니 실험

### 13.1 항등식 검증: 중심합
```python
import math

def check_central_sum(nmax=50):
    for n in range(nmax+1):
        lhs = sum(math.comb(n, r)**2 for r in range(n+1))
        rhs = math.comb(2*n, n)
        assert lhs == rhs
    print("OK up to", nmax)

check_central_sum()
```

### 13.2 확률 실험: 이항분포 빈도 vs 이론
```python
import random, math

def empirical_binom(n=20, p=0.3, trials=10000):
    from collections import Counter
    cnt = Counter()
    for _ in range(trials):
        s = sum(1 if random.random() < p else 0 for _ in range(n))
        cnt[s] += 1
    # 비교 출력
    for r in range(n+1):
        theo = math.comb(n, r)*(p**r)*((1-p)**(n-r))
        emp = cnt[r]/trials
        print(r, f"emp={emp:.4f}", f"theo={theo:.4f}")

empirical_binom()
```

---

## 14. 마무리 요약

- **정의**: $$\displaystyle \binom{n}{r}=\frac{n!}{r!(n-r)!}$$, “순서 없이 $$r$$개 선택”.
- **핵심 성질**: 대칭, 파스칼 점화, 총합 $$2^n$$, 다양한 조합적 항등식.
- **도구**: 생성함수/이항정리로 전개·합 계산, 격자경로/카탈랑 등으로 구조 해석.
- **계산**: 내장 `math.comb`, 곱셈식/DP, 모듈러(페르마 역원), Lucas, Combinadic.
- **응용**: 확률(이항분포), 배치/분할/경로, 알고리즘 분석의 핵심 카운팅 기본기.
