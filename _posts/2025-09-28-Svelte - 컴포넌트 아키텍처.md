---
layout: post
title: Svelte - ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜
date: 2025-09-28 22:25:23 +0900
category: Svelte
---
# 6. ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜
**Prop/ì´ë²¤íŠ¸/ìŠ¬ë¡¯ ì„¤ê³„ ê·œì¹™ Â· ì»¨í…ìŠ¤íŠ¸ API(`setContext/getContext`) Â· ì»¨í…Œì´ë„ˆâ€“í”„ë¦¬ì  í…Œì´ì…˜ íŒ¨í„´ Â· ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì•¡ì…˜/ìœ í‹¸ ëª¨ë“ˆí™”**

> ì´ ì¥ì€ â€œì»´í¬ë„ŒíŠ¸ë¥¼ ì–´ë–»ê²Œ **ì„¤ê³„**í•  ê²ƒì¸ê°€?â€ì— ì´ˆì ì„ ë‘”ë‹¤.
> - ì»´í¬ë„ŒíŠ¸ì˜ **ê³µê°œ API(Prop/ì´ë²¤íŠ¸/ìŠ¬ë¡¯)**ë¥¼ ì¼ê´€ëœ ê·œì¹™ìœ¼ë¡œ ì„¤ê³„í•˜ê³ 
> - **ì»¨í…ìŠ¤íŠ¸ API**ë¡œ íŠ¸ë¦¬ ê¹Šì€ ê³³ê¹Œì§€ ìƒíƒœ/í–‰ë™ì„ ì•ˆì „í•˜ê²Œ ì£¼ì…í•˜ë©°
> - **ì»¨í…Œì´ë„ˆâ€“í”„ë¦¬ì  í…Œì´ì…˜**ìœ¼ë¡œ ë°ì´í„°/í‘œí˜„ ë¶„ë¦¬ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸Â·í™•ì¥ì„±ì„ ë†’ì´ê³ 
> - **ì•¡ì…˜/ìœ í‹¸/ìŠ¤í† ì–´**ë¥¼ ëª¨ë“ˆí™”í•´ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¹Œë”© ë¸”ë¡ì„ ë§Œë“ ë‹¤.

---

## 6.1 Prop / ì´ë²¤íŠ¸ / ìŠ¬ë¡¯ â€” **ê³µê°œ API**ì˜ 3ìš”ì†Œ

### 6.1.1 ì„¤ê³„ ì›ì¹™ (ìš”ì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸)

- **Prop**
  - ê¸°ë³¸ê°’ì„ ì œê³µí•˜ê³  `export let`ì— **ëª…í™•í•œ íƒ€ì…/ì„¤ëª…**ì„ ë‚¨ê¸´ë‹¤.
  - **ë¶ˆë³€ ë°ì´í„°**ë¥¼ ì„ í˜¸í•˜ê³ , ë³€ê²½ì€ **ì´ë²¤íŠ¸**ë¡œ ì•Œë¦°ë‹¤.
  - ì´ë¦„ ê·œì¹™: ì˜ë¯¸+ìƒíƒœ(ex. `size`, `variant`, `disabled`, `value`).
  - `...$$restProps`ë¡œ **ì›ì‹œ DOM ì†ì„±**ì„ **ê·¸ëŒ€ë¡œ ì „ë‹¬**í•  ì—¬ì§€ë¥¼ ë‘”ë‹¤.

- **ì´ë²¤íŠ¸**
  - **`createEventDispatcher()`**ë¡œ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ë¥¼ ë§Œë“¤ê³ , ì´ë¦„ì€ `change`, `open`, `select`, `submit`ì²˜ëŸ¼ **í–‰ë™ ì¤‘ì‹¬**ìœ¼ë¡œ.
  - payloadëŠ” `{ detail: ... }`ì— **ìµœì†Œí•œì˜ í•„ìš”í•œ ì •ë³´**ë§Œ ë„£ëŠ”ë‹¤.
  - **ë²„ë¸”ë§/ìº¡ì²˜** ë™ì‘ì„ ê³ ë ¤í•˜ê³ , í•„ìš” ì‹œ ë¬¸ì„œí™”í•œë‹¤.

- **ìŠ¬ë¡¯**
  - **ê¸°ë³¸ ìŠ¬ë¡¯**ê³¼ **ì´ë¦„ ìŠ¬ë¡¯**ì„ ì œê³µí•˜ë˜, ì»´í¬ë„ŒíŠ¸ì˜ ë ˆì´ì•„ì›ƒ/ì ‘ê·¼ì„± ê³¨ê²©ì€ ìœ ì§€í•œë‹¤.
  - **ìŠ¬ë¡¯ props**ë¡œ ë‚´ë¶€ ìƒíƒœë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìœ¼ë‚˜, â€œí•„ìš” ìµœì†Œí•œâ€ë§Œ.
  - skeleton/placeholder ë“± **ëŒ€ì²´ ì½˜í…ì¸ **ë¥¼ ê¸°ë³¸ ìŠ¬ë¡¯ì— ë„£ì–´ UXë¥¼ ë³´ì¥í•œë‹¤.

---

### 6.1.2 ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ: API í‘œë©´ ì„¤ê³„

```svelte
<!-- src/lib/components/ui/Button.svelte -->
<script lang="ts">
  import { createEventDispatcher } from 'svelte';

  // 1) Props
  export let variant: 'primary' | 'outline' | 'ghost' = 'primary';
  export let size: 'sm' | 'md' | 'lg' = 'md';
  export let disabled = false;
  export let loading = false;
  export let type: 'button' | 'submit' = 'button';

  // $$restProps: ì›ì‹œ DOM ì†ì„±(aria-*, data-*, id ë“±) ì „ë‹¬
  export let $$restProps: svelte.JSX.HTMLAttributes<HTMLButtonElement>;

  // 2) Dispatch
  const dispatch = createEventDispatcher<{ click: MouseEvent }>();

  function onClick(e: MouseEvent) {
    if (disabled || loading) {
      e.preventDefault();
      return;
    }
    dispatch('click', e);
  }

  // 3) í´ë˜ìŠ¤ ê³„ì‚°
  $: cls = [
    'btn',
    `btn--${variant}`,
    `btn--${size}`,
    disabled && 'is-disabled',
    loading && 'is-loading'
  ].filter(Boolean).join(' ');
</script>

<button
  class={cls}
  disabled={disabled}
  type={type}
  on:click|preventDefault={onClick}
  {...$$restProps}
>
  <!-- ì´ë¦„ ìŠ¬ë¡¯: ì•„ì´ì½˜ ì˜ì—­ -->
  <slot name="leading" />
  <slot />
  <slot name="trailing" />
</button>

<style>
  .btn { display:inline-flex; align-items:center; gap:.5rem; border-radius:12px; padding:.5rem .9rem; border:1px solid var(--border); }
  .btn--primary { background: var(--color-btn); color: var(--color-btn-fg); border-color: var(--color-btn); }
  .btn--outline { background: var(--surface); color: var(--fg); }
  .btn--ghost { background: transparent; color: var(--fg); border-color: transparent; }
  .btn--sm { padding:.35rem .6rem; font-size:.9rem; }
  .btn--md { font-size:1rem; }
  .btn--lg { padding:.65rem 1rem; font-size:1.05rem; }
  .is-disabled { opacity:.6; pointer-events:none; }
  .is-loading { cursor:progress; }
</style>
```

ì‚¬ìš©:

```svelte
<script>
  import Button from '$lib/components/ui/Button.svelte';
  const save = () => console.log('save!');
</script>

<Button variant="outline" on:click={save} aria-label="Save">
  <svelte:fragment slot="leading">ğŸ’¾</svelte:fragment>
  Save
</Button>
```

> í¬ì¸íŠ¸
> - **DOM ì†ì„± ì „ë‹¬**ì„ ìœ„í•´ `$$restProps` í™œìš©(ì ‘ê·¼ì„±/í…ŒìŠ¤íŠ¸ì— ìœ ìš©).
> - ì´ë²¤íŠ¸ëŠ” `dispatch('click', e)` í˜•íƒœë¡œ **í‘œë©´ì„ ë‹¨ìˆœí™”**.
> - ìŠ¬ë¡¯ìœ¼ë¡œ **ì•„ì´ì½˜/í…ìŠ¤íŠ¸** êµ¬ì¡°ë¥¼ í™•ì¥ ê°€ëŠ¥.

---

### 6.1.3 ì…ë ¥ ì»´í¬ë„ŒíŠ¸: `bind:value` ì§€ì› + `change/input` ì´ë²¤íŠ¸

```svelte
<!-- src/lib/components/form/TextField.svelte -->
<script lang="ts">
  import { createEventDispatcher } from 'svelte';

  export let value = '';
  export let label = '';
  export let id = crypto.randomUUID();
  export let placeholder = '';
  export let disabled = false;
  export let required = false;

  // ì»´í¬ë„ŒíŠ¸ ë°”ì¸ë”©ì„ ìœ„í•´ value prop + change ì´ë²¤íŠ¸ë¥¼ í•¨ê»˜ ì œê³µ
  const dispatch = createEventDispatcher<{ change: string, input: string }>();

  function onInput(e: Event) {
    const v = (e.currentTarget as HTMLInputElement).value;
    value = v;                    // ë‚´ë¶€ ìƒíƒœ ê°±ì‹ 
    dispatch('input', v);         // input ì´ë²¤íŠ¸
    dispatch('change', v);        // ë°”ì¸ë”© ëŒ€ì‘
  }
</script>

<label for={id} class="label">{label}</label>
<input
  id={id}
  class="textfield"
  {placeholder}
  {required}
  {disabled}
  value={value}
  on:input={onInput}
/>

<style>
  .label { display:block; font-weight:600; margin-bottom:.25rem; }
  .textfield { width:100%; border:1px solid var(--border); border-radius:10px; padding:.5rem .7rem; }
</style>
```

ë¶€ëª¨ì—ì„œ **ì»´í¬ë„ŒíŠ¸ ë°”ì¸ë”©**:

```svelte
<script>
  import TextField from '$lib/components/form/TextField.svelte';
  let name = '';
</script>

<TextField bind:value={name} label="Name" placeholder="Your name" />
<p>Hi, {name || '...'}</p>
```

> ë°”ì¸ë”©ì„ ì§€ì›í•˜ë ¤ë©´ â€œprop + ê°™ì€ ì´ë¦„ì˜ change ì´ë²¤íŠ¸â€ë¥¼ ë‚´ë³´ë‚´ëŠ” íŒ¨í„´ì´ ì§ê´€ì ì´ë‹¤. (ë˜ëŠ” Svelte 5 Runesì—ì„œëŠ” `$state`ë¥¼ ë…¸ì¶œí•˜ëŠ” ì»´í¬ì§€ì…˜ë„ ê°€ëŠ¥í•˜ë‚˜, ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ APIë¡œëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ì´ ì•ˆì „í•˜ë‹¤.)

---

### 6.1.4 ìŠ¬ë¡¯ props â€” ë‚´ë¶€ ìƒíƒœ ì¼ë¶€ë¥¼ í•„ìš”ì‹œì—ë§Œ ë…¸ì¶œ

```svelte
<!-- src/lib/components/data/Table.svelte -->
<script lang="ts">
  export let rows: any[] = [];
  export let empty = 'No data';
</script>

<table class="tbl">
  <thead><slot name="head" /></thead>
  <tbody>
    {#if rows.length === 0}
      <tr><td colspan="100%">{empty}</td></tr>
    {:else}
      {#each rows as row, i}
        <slot name="row" {row} {i}>
          <!-- ê¸°ë³¸ ë Œë” -->
          <tr><td>{JSON.stringify(row)}</td></tr>
        </slot>
      {/each}
    {/if}
  </tbody>
</table>

<style>
  .tbl { width:100%; border-collapse: collapse; }
  td, th { border:1px solid var(--border); padding:.5rem; }
</style>
```

ì‚¬ìš©:

```svelte
<script>
  import Table from '$lib/components/data/Table.svelte';
  const users = [{id:1,name:'Ada'},{id:2,name:'Linus'}];
</script>

<Table {rows}= {users} empty="ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤">
  <svelte:fragment slot="head">
    <tr><th>ID</th><th>Name</th></tr>
  </svelte:fragment>

  <svelte:fragment slot="row" let:row>
    <tr><td>{row.id}</td><td>{row.name}</td></tr>
  </svelte:fragment>
</Table>
```

> **ê¸°ë³¸ ë™ì‘**ì„ ì œê³µí•˜ë©´ì„œ, í•„ìš” ì‹œ ìŠ¬ë¡¯ìœ¼ë¡œ **ì™„ì „ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ** ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

---

## 6.2 ì»¨í…ìŠ¤íŠ¸ API â€” íŠ¸ë¦¬ ê¹Šìˆ™ì´ **ì˜ì¡´ì„± ì£¼ì…**

### 6.2.1 ê¸°ë³¸ ê°œë…

- `setContext(key, value)` : **ì¡°ìƒ** ì»´í¬ë„ŒíŠ¸ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ê°’ì„ ì„¤ì •
- `getContext(key)` : **í•˜ìœ„(í›„ì†)** ì»´í¬ë„ŒíŠ¸ì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜´
- keyëŠ” **Symbol**ì„ ê¶Œì¥(ì´ë¦„ ì¶©ëŒ ë°©ì§€)
- **SSR ìš”ì²­ ë‹¨ìœ„**ë¡œ ìŠ¤ì½”í”„ë˜ë¯€ë¡œ ì„œë²„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìš°ë ¤ê°€ ë‚®ë‹¤.

### 6.2.2 ë©”ë‰´/ì„ íƒ ê·¸ë£¹ ì„¤ê³„ (ì•¡ì…˜ê³¼ ì„ì§€ ë§ê³  **ì»¨í…ìŠ¤íŠ¸**ë¡œ ì—°ê²°)

**ì»¨í…Œì´ë„ˆ(Menu)**ê°€ ìƒíƒœë¥¼ ì†Œìœ í•˜ê³ , **Item**ì€ ì»¨í…ìŠ¤íŠ¸ë¡œ ì œì–´ í•¨ìˆ˜ë¥¼ ë°›ì•„ ì„ íƒì„ ë³´ê³ í•œë‹¤.

```ts
// src/lib/context/menu.ts
export type MenuCtx = {
  register: (id: string) => void;
  select: (id: string) => void;
  isSelected: (id: string) => boolean;
};
export const MENU_CTX = Symbol('menu');
```

```svelte
<!-- src/lib/components/menu/Menu.svelte -->
<script lang="ts">
  import { setContext } from 'svelte';
  import { MENU_CTX, type MenuCtx } from '$lib/context/menu';

  export let value: string | null = null;
  let ids = new Set<string>();

  function register(id: string) { ids.add(id); }
  function select(id: string) { value = id; }
  function isSelected(id: string) { return value === id; }

  const ctx: MenuCtx = { register, select, isSelected };
  setContext(MENU_CTX, ctx);
</script>

<div class="menu" role="listbox" aria-activedescendant={value ?? undefined}>
  <slot />
</div>

<style>
  .menu { display:grid; gap:.25rem; }
</style>
```

```svelte
<!-- src/lib/components/menu/Item.svelte -->
<script lang="ts">
  import { getContext, onMount } from 'svelte';
  import { MENU_CTX, type MenuCtx } from '$lib/context/menu';

  export let id: string;
  export let as: 'button' | 'div' = 'button';

  const ctx = getContext<MenuCtx>(MENU_CTX);

  onMount(() => ctx.register(id));
  $: selected = ctx.isSelected(id);

  function pick() { ctx.select(id); }
</script>

<svelte:element
  this={as}
  role="option"
  aria-selected={selected}
  class:selected
  on:click={pick}
>
  <slot />
</svelte:element>

<style>
  .selected { background:#0ea5e9; color:#fff; border-radius:10px; }
</style>
```

ì‚¬ìš©:

```svelte
<script>
  import Menu from '$lib/components/menu/Menu.svelte';
  import Item from '$lib/components/menu/Item.svelte';
  let current = 'b';
</script>

<Menu bind:value={current}>
  <Item id="a">Alpha</Item>
  <Item id="b">Bravo</Item>
  <Item id="c">Charlie</Item>
</Menu>

<p>Selected: {current}</p>
```

> ì¥ì 
> - í˜•ì œ/ì†ì ì»´í¬ë„ŒíŠ¸ ê°„ **í”„ë¡­ ë“œë¦´ë§ ì—†ì´** ìƒíƒœ ê³µìœ .
> - ì»´í¬ë„ŒíŠ¸ APIëŠ” **ê°„ë‹¨**(ë¶€ëª¨ëŠ” `bind:value`ë§Œ), ë‚´ë¶€ëŠ” **ì»¨í…ìŠ¤íŠ¸**ë¡œ ì •ëˆ.
> - ì‹œë§¨í‹±/ì ‘ê·¼ì„± ì—­í• (`listbox/option`)ë„ í•œ ê³³ì—ì„œ ì •ì˜.

---

### 6.2.3 Form ì»¨í…ìŠ¤íŠ¸: í¼ ë°”ì¸ë”©/ì—ëŸ¬ ìˆ˜ì§‘

```ts
// src/lib/context/form.ts
export type FormCtx = {
  register: (name: string) => void;
  setError: (name: string, message: string | null) => void;
  errors: Record<string, string | null>;
  values: Record<string, any>;
};
export const FORM = Symbol('form');
```

```svelte
<!-- src/lib/components/form/Form.svelte -->
<script lang="ts">
  import { setContext } from 'svelte';
  import { FORM, type FormCtx } from '$lib/context/form';

  export let onSubmit: (data: Record<string, any>) => void;

  const ctx: FormCtx = {
    errors: {},
    values: {},
    register(name) { ctx.values[name] ??= ''; },
    setError(name, message) { ctx.errors[name] = message; }
  };
  setContext(FORM, ctx);

  function submit(e) {
    e.preventDefault();
    onSubmit(structuredClone(ctx.values));
  }
</script>

<form on:submit={submit}>
  <slot />
  <div class="errors">
    {#each Object.entries(ctx.errors) as [k, v] (k)}
      {#if v}<p style="color:#b00020">{k}: {v}</p>{/if}
    {/each}
  </div>
</form>
```

```svelte
<!-- src/lib/components/form/Field.svelte -->
<script lang="ts">
  import { getContext } from 'svelte';
  import { FORM, type FormCtx } from '$lib/context/form';

  export let name: string;
  export let label = name;
  export let required = false;

  const form = getContext<FormCtx>(FORM);
  form.register(name);

  function input(e) {
    form.values[name] = e.currentTarget.value;
    if (required) form.setError(name, form.values[name] ? null : 'í•„ìˆ˜ì…ë‹ˆë‹¤');
  }
</script>

<label>
  <span>{label}</span>
  <input name={name} value={form.values[name]} on:input={input} aria-invalid={!!form.errors[name]} />
</label>
```

ì‚¬ìš©:

```svelte
<script>
  import Form from '$lib/components/form/Form.svelte';
  import Field from '$lib/components/form/Field.svelte';

  const submit = (data) => alert(JSON.stringify(data, null, 2));
</script>

<Form {submit} onSubmit={submit}>
  <Field name="email" required />
  <Field name="name" />
  <button type="submit">Submit</button>
</Form>
```

> ì»¨í…ìŠ¤íŠ¸ëŠ” í¼ì²˜ëŸ¼ **ë¶„ì‚°ëœ ì…ë ¥**ì„ **í•œ ê³³ì—ì„œ ìˆ˜ì§‘/ê²€ì¦**í•˜ê¸°ì— ì í•©.

---

## 6.3 ì»¨í…Œì´ë„ˆâ€“í”„ë¦¬ì  í…Œì´ì…˜ íŒ¨í„´

> **ì»¨í…Œì´ë„ˆ(Container)**: ë°ì´í„° ë¡œë”©/ìƒíƒœ/í–‰ë™ì„ ì†Œìœ (ìŠ¤í† ì–´/URL/ë„¤íŠ¸ì›Œí¬).
> **í”„ë¦¬ì  í…Œì´ì…˜(Presentational)**: ìˆœìˆ˜ UI, propsë¡œë§Œ ì…ë ¥ ë°›ì•„ ë Œë”.

ì¥ì :
- ë³€ê²½ ì´ìœ  ë¶„ë¦¬(SOLIDì˜ SRP)
- í…ŒìŠ¤íŠ¸/ìŠ¤í† ë¦¬ ì‘ì„±ì´ ì‰¬ì›€(í”„ë¦¬ì  í…Œì´ì…˜ì€ **ìˆœìˆ˜ í•¨ìˆ˜**ì²˜ëŸ¼)
- ì¬ì‚¬ìš© ê°€ëŠ¥(ì»¨í…Œì´ë„ˆ êµì²´ë¡œ ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ ëŒ€ì‘)

### 6.3.1 ëª©ë¡ í˜ì´ì§€ ì˜ˆì‹œ

**í”„ë¦¬ì  í…Œì´ì…˜**:

```svelte
<!-- src/lib/components/products/ProductGrid.svelte -->
<script lang="ts">
  export type Product = { id: string; name: string; price: number };
  export let items: Product[] = [];
  export let loading = false;
  export let onSelect: (p: Product) => void;
</script>

{#if loading}
  <p>Loadingâ€¦</p>
{:else if items.length === 0}
  <p>No products</p>
{:else}
  <div class="grid">
    {#each items as p (p.id)}
      <article class="card" on:click={() => onSelect?.(p)}>
        <h3>{p.name}</h3>
        <p>${p.price}</p>
      </article>
    {/each}
  </div>
{/if}

<style>
  .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:12px; }
  .card { border:1px solid var(--border); border-radius:12px; padding:.75rem; cursor:pointer; }
</style>
```

**ì»¨í…Œì´ë„ˆ**(SvelteKit ë¼ìš°íŠ¸):

```svelte
<!-- src/routes/products/+page.svelte -->
<script lang="ts">
  import ProductGrid from '$lib/components/products/ProductGrid.svelte';
  import { onMount } from 'svelte';

  let items = [];
  let loading = true;

  onMount(async () => {
    const res = await fetch('/api/products');
    items = await res.json();
    loading = false;
  });

  function select(p) { console.log('select', p); }
</script>

<ProductGrid {items} {loading} onSelect={select} />
```

> ë‚˜ì¤‘ì— ë°ì´í„° ì†ŒìŠ¤ë¥¼ **ìŠ¤í† ì–´/GraphQL/IndexedDB** ë“±ìœ¼ë¡œ ë°”ê¾¸ì–´ë„ ê·¸ë¦¬ë“œëŠ” ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ë‹¤.

---

### 6.3.2 ì»¨í…Œì´ë„ˆì—ì„œ **URL ë™ê¸°í™”**ê¹Œì§€ ë‹´ë‹¹

```svelte
<!-- src/routes/products/+page.svelte -->
<script lang="ts">
  import ProductGrid from '$lib/components/products/ProductGrid.svelte';
  import { page } from '$app/stores';
  import { goto } from '$app/navigation';
  import { onDestroy } from 'svelte';

  let search = $page.url.searchParams.get('q') ?? '';
  let items = [];
  let loading = false;

  async function load() {
    loading = true;
    const res = await fetch('/api/products?q=' + encodeURIComponent(search));
    items = await res.json();
    loading = false;
  }

  // URL ë³€ê²½ â†’ ë¡œì»¬ ìƒíƒœ ê°±ì‹ (ë’¤/ì•ìœ¼ë¡œê°€ê¸° ëŒ€ì‘)
  const un = page.subscribe(($p) => {
    const q = $p.url.searchParams.get('q') ?? '';
    if (q !== search) { search = q; load(); }
  });
  onDestroy(un);

  function apply() {
    const url = new URL($page.url);
    if (search) url.searchParams.set('q', search); else url.searchParams.delete('q');
    goto(url, { replaceState: true });
  }

  $: load(); // ìµœì´ˆ ë¡œë“œ ë° search ë³€ê²½ ì‹œ
</script>

<input bind:value={search} placeholder="Searchâ€¦" />
<button on:click={apply}>Apply</button>

<ProductGrid {items} {loading} onSelect={(p)=>console.log(p)} />
```

> ì»¨í…Œì´ë„ˆëŠ” **ë¼ìš°íŒ…/ìƒíƒœ/ë„¤íŠ¸ì›Œí¬**ë¥¼ ì±…ì„ì§€ê³ , í”„ë¦¬ì  í…Œì´ì…˜ì€ **UI**ë§Œ.

---

## 6.4 ì¬ì‚¬ìš© ê°€ëŠ¥í•œ **ì•¡ì…˜** / **ìœ í‹¸** / **ìŠ¤í† ì–´** ëª¨ë“ˆí™”

### 6.4.1 ì•¡ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í´ë”ë§

```
src/lib/actions/
  autofocus.ts
  clickOutside.ts
  intersect.ts
  longpress.ts
```

**`clickOutside`**:

```ts
// src/lib/actions/clickOutside.ts
export function clickOutside(node: HTMLElement, handler: (e: MouseEvent) => void) {
  const onDoc = (e: MouseEvent) => !node.contains(e.target as Node) && handler(e);
  document.addEventListener('mousedown', onDoc);
  return { destroy: () => document.removeEventListener('mousedown', onDoc) };
}
```

**`longpress`**:

```ts
// src/lib/actions/longpress.ts
export function longpress(node: HTMLElement, ms = 500) {
  let t: number | null = null;

  const start = () => {
    t = window.setTimeout(() => {
      node.dispatchEvent(new CustomEvent('longpress'));
    }, ms);
  };
  const clear = () => t && (clearTimeout(t), (t = null));

  node.addEventListener('pointerdown', start);
  node.addEventListener('pointerup', clear);
  node.addEventListener('pointerleave', clear);

  return {
    update(newMs: number) { ms = newMs; },
    destroy() {
      clear();
      node.removeEventListener('pointerdown', start);
      node.removeEventListener('pointerup', clear);
      node.removeEventListener('pointerleave', clear);
    }
  };
}
```

ì‚¬ìš©:

```svelte
<script>
  import { clickOutside } from '$lib/actions/clickOutside';
  import { longpress } from '$lib/actions/longpress';
  let open = true;
</script>

<div class="panel" use:clickOutside={() => open = false}>
  <button use:longpress on:longpress={() => alert('Hold!')}>Hold me</button>
</div>
```

> ì•¡ì…˜ì€ **DOM ë™ì‘ì„ ìº¡ìŠí™”**í•˜ë¯€ë¡œ, ì»´í¬ë„ŒíŠ¸/í˜ì´ì§€ ì–´ë””ì„œë‚˜ ë°”ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

### 6.4.2 ìœ í‹¸ ëª¨ë“ˆ: fetcher/format/query

```ts
// src/lib/utils/fetcher.ts
export async function getJSON<T>(input: RequestInfo, init?: RequestInit) {
  const res = await fetch(input, init);
  if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
  return res.json() as Promise<T>;
}
```

```ts
// src/lib/utils/format.ts
export const money = (n: number, currency = 'USD') =>
  new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(n);
```

```ts
// src/lib/utils/query.ts
export function setQuery(url: URL, dict: Record<string, string | number | null | undefined>) {
  for (const [k, v] of Object.entries(dict)) {
    if (v == null || v === '') url.searchParams.delete(k);
    else url.searchParams.set(k, String(v));
  }
}
```

> **ìœ í‹¸**ì€ í…ŒìŠ¤íŠ¸ê°€ ì‰¬ìš°ë©°, ì»¨í…Œì´ë„ˆì—ì„œ ì£¼ì…í•´ ì‚¬ìš©í•˜ë©´ API ì˜ì¡´ì„±ì„ í•œ ê³³ì— ë¬¶ì„ ìˆ˜ ìˆë‹¤.

---

### 6.4.3 ìŠ¤í† ì–´ ëª¨ë“ˆ: ë„ë©”ì¸ë³„ API ìº¡ìŠí™”

```ts
// src/lib/stores/cart.ts
import { writable, derived } from 'svelte/store';

type Item = { id: string; name: string; price: number; qty: number };

function createCart() {
  const { subscribe, update, set } = writable<Item[]>([]);

  return {
    subscribe,
    add(p: Omit<Item, 'qty'>, qty = 1) {
      update((xs) => {
        const i = xs.findIndex((it) => it.id === p.id);
        if (i >= 0) {
          const next = xs.slice();
          next[i] = { ...next[i], qty: next[i].qty + qty };
          return next;
        }
        return [...xs, { ...p, qty }];
      });
    },
    remove(id: string) { update((xs) => xs.filter((x) => x.id !== id)); },
    clear() { set([]); }
  };
}

export const cart = createCart();
export const total = derived(cart, ($c) =>
  $c.reduce((s, i) => s + i.price * i.qty, 0)
);
```

ì‚¬ìš©:

```svelte
<script>
  import { cart, total } from '$lib/stores/cart';
  const add = () => cart.add({ id: 'b1', name:'Book', price:12 });
</script>

<button on:click={add}>Add</button>
<p>Total: {$total}</p>
```

> ìŠ¤í† ì–´ëŠ” ì „ì—­/ê³µìœ  ìƒíƒœë¥¼ ë‹´ë‹¹í•˜ê³ , **ì»´í¬ë„ŒíŠ¸ëŠ” ì–‡ê²Œ** ìœ ì§€í•œë‹¤.

---

## 6.5 ì•ˆì •ì„±Â·ì ‘ê·¼ì„±Â·í…ŒìŠ¤íŠ¸ ì „ëµ

1) **ì ‘ê·¼ì„± ìš°ì„ **
   - ì—­í• /ë ˆì´ë¸”/í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ **ë””í´íŠ¸ ì œê³µ**
   - `aria-*`/`role`ì„ **`$$restProps`**ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆê²Œ í•œë‹¤.

2) **íƒ€ì´í•‘/ë¬¸ì„œí™”**
   - `export let`ì— **íƒ€ì…Â·ê¸°ë³¸ê°’Â·JSDoc**ì„ ë‚¨ê¸´ë‹¤.
   - ì´ë²¤íŠ¸ì˜ **detail íƒ€ì…**ë„ ì œë„¤ë¦­ìœ¼ë¡œ ëª…ì‹œ.

3) **ë¶ˆë³€ ë°ì´í„° ì „ë‹¬**
   - í”„ë¦¬ì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸ì—ëŠ” **ë¶ˆë³€ props**ë¥¼ ì „ë‹¬(ì°¸ì¡° ì´ìŠˆ ìµœì†Œí™”).

4) **ë³€ê²½ ì´ìœ  ë¶„ë¦¬**
   - ì»¨í…Œì´ë„ˆëŠ” ë¼ìš°íŒ…/ë°ì´í„°/ìŠ¤í† ì–´, í”„ë¦¬ì  í…Œì´ì…˜ì€ ë Œë”ë§ë§Œ.

5) **í…ŒìŠ¤íŠ¸**
   - í”„ë¦¬ì  í…Œì´ì…˜ì€ **@testing-library/svelte**ë¡œ ì ‘ê·¼ì„± ì¿¼ë¦¬(`getByRole`, `getByLabelText`) ì¤‘ì‹¬ í…ŒìŠ¤íŠ¸.
   - ë„ë©”ì¸ ìŠ¤í† ì–´/ìœ í‹¸ì€ **Vitest**ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸.

---

## 6.6 ì•ˆí‹° íŒ¨í„´ & ê°œì„ 

- **ëª¨ë“  ìƒíƒœë¥¼ ìƒìœ„ì—ì„œ propsë¡œ ë‚´ë¦¬ëŠ” ê²½ìš°(Prop Drilling)**
  â†’ ì»¨í…ìŠ¤íŠ¸/ìŠ¤í† ì–´ë¡œ **ì†Œìœ ì**ë¥¼ ëª…í™•íˆ í•˜ì.

- **ì»´í¬ë„ŒíŠ¸ê°€ ë„¤íŠ¸ì›Œí¬ì™€ DOMì„ ë™ì‹œì— ë‹¤ë£¨ëŠ” ê²½ìš°**
  â†’ **ì»¨í…Œì´ë„ˆâ€“í”„ë¦¬ì  í…Œì´ì…˜**ìœ¼ë¡œ ë¶„ë¦¬. íš¨ê³¼ëŠ” onMount/ì•¡ì…˜ìœ¼ë¡œ.

- **ì´ë²¤íŠ¸ detailì— ê±°ëŒ€í•œ ê°ì²´ ì „ë‹¬**
  â†’ í•„ìš”í•œ ìµœì†Œ ì •ë³´ë§Œ ì „ë‹¬, ë‚˜ë¨¸ì§€ëŠ” ì»¨í…Œì´ë„ˆê°€ **ì„œë¹„ìŠ¤/ìŠ¤í† ì–´**ë¡œ ì¡°íšŒ.

- **ì „ì—­ ìŠ¤íƒ€ì¼ ê³¼ë„/`:global` ë‚¨ìš©**
  â†’ ìŠ¤ì½”í”„ CSS ìœ ì§€, ì „ì—­ì€ í† í°/ìœ í‹¸ í´ë˜ìŠ¤ë§Œ.

---

## 6.7 ì¢…í•© ì˜ˆì œ â€” â€œí•„í„° ê°€ëŠ¥í•œ ì œí’ˆ ë¦¬ìŠ¤íŠ¸â€

ìš”êµ¬ì‚¬í•­
- ì¹´í…Œê³ ë¦¬/ê²€ìƒ‰/ì •ë ¬ ìƒíƒœëŠ” **ì»¨í…Œì´ë„ˆ**ê°€ ì†Œìœ  + **URL**ì— ë™ê¸°í™”
- ê·¸ë¦¬ë“œëŠ” **í”„ë¦¬ì  í…Œì´ì…˜**
- **TextField/Button/Table** ì¬ì‚¬ìš©
- **clickOutside** ì•¡ì…˜ìœ¼ë¡œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°

**í”„ë¦¬ì  í…Œì´ì…˜ â€“ FilterBar**:

```svelte
<!-- src/lib/components/products/FilterBar.svelte -->
<script lang="ts">
  export let q = '';
  export let category: string | null = null;
  export let sort: 'recent'|'price'|'name' = 'recent';

  export let onChange: (next: { q: string; category: string | null; sort: typeof sort }) => void;

  let open = false;
  function emit() { onChange?.({ q, category, sort }); }
</script>

<div class="bar">
  <input class="search" placeholder="Searchâ€¦" bind:value={q} on:change={emit} />
  <select bind:value={sort} on:change={emit}>
    <option value="recent">Recent</option>
    <option value="price">Price</option>
    <option value="name">Name</option>
  </select>
  <div class="dropdown">
    <button on:click={() => (open = !open)}>Category</button>
    {#if open}
      <ul class="menu">
        <li on:click={() => (category=null, open=false, emit())}>All</li>
        <li on:click={() => (category='book', open=false, emit())}>Book</li>
        <li on:click={() => (category='tool', open=false, emit())}>Tool</li>
      </ul>
    {/if}
  </div>
</div>

<style>
  .bar { display:flex; gap:.5rem; align-items:center; }
  .search { flex:1; }
  .dropdown { position:relative; }
  .menu { position:absolute; top:100%; left:0; background:#fff; border:1px solid var(--border); border-radius:10px; padding:.2rem; }
  .menu>li { padding:.35rem .6rem; cursor:pointer; }
  .menu>li:hover { background:#f8fafc; }
</style>
```

**í”„ë¦¬ì  í…Œì´ì…˜ â€“ Grid**: (ì•ì˜ `ProductGrid.svelte` ì¬ì‚¬ìš©)

**ì»¨í…Œì´ë„ˆ â€“ í˜ì´ì§€**:

```svelte
<!-- src/routes/catalog/+page.svelte -->
<script lang="ts">
  import FilterBar from '$lib/components/products/FilterBar.svelte';
  import ProductGrid from '$lib/components/products/ProductGrid.svelte';
  import { page } from '$app/stores';
  import { goto } from '$app/navigation';
  import { onMount, onDestroy } from 'svelte';

  let q = $page.url.searchParams.get('q') ?? '';
  let category = $page.url.searchParams.get('cat');
  let sort = ($page.url.searchParams.get('sort') ?? 'recent') as 'recent'|'price'|'name';

  let items = []; let loading = false;

  function syncURL() {
    const url = new URL($page.url);
    const set = (k: string, v?: string | null) => v ? url.searchParams.set(k, v) : url.searchParams.delete(k);
    set('q', q || null);
    set('cat', category || null);
    set('sort', sort);
    goto(url, { replaceState: true, keepfocus: true, noscroll: true });
  }

  async function load() {
    loading = true;
    const url = `/api/products?q=${encodeURIComponent(q)}&sort=${sort}${category?`&cat=${category}`:''}`;
    const res = await fetch(url);
    items = await res.json();
    loading = false;
  }

  // URL â†’ ìƒíƒœ
  const un = page.subscribe(($p) => {
    const Q = $p.url.searchParams.get('q') ?? '';
    const C = $p.url.searchParams.get('cat');
    const S = ($p.url.searchParams.get('sort') ?? 'recent') as typeof sort;
    if (Q !== q || C !== category || S !== sort) {
      q = Q; category = C; sort = S; load();
    }
  });
  onDestroy(un);

  // ìµœì´ˆ ë¡œë“œ
  onMount(load);

  function onChange(next) {
    q = next.q; category = next.category; sort = next.sort;
    syncURL();          // URLì„ ì§„ì‹¤ì›ì²œìœ¼ë¡œ
    load();             // ë°ì´í„° ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
  }

  function onSelect(p) { console.log('select', p); }
</script>

<FilterBar {q} {category} {sort} {onChange} />

<ProductGrid {items} {loading} onSelect={onSelect} />
```

> ê²°ê³¼: ì»¨í…Œì´ë„ˆëŠ” **URL ë™ê¸°í™” + ë„¤íŠ¸ì›Œí¬**ë¥¼ ì±…ì„ì§€ê³ , ë‘ í”„ë¦¬ì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸ëŠ” **ì…ë ¥/ì¶œë ¥**ë§Œ ë‹¤ë£¬ë‹¤.

---

## 6.8 ë§ˆë¬´ë¦¬ ìš”ì•½

- **Props/ì´ë²¤íŠ¸/ìŠ¬ë¡¯**ì€ ì»´í¬ë„ŒíŠ¸ì˜ ê³µê°œ ê³„ì•½(Contract) â€” **ê°„ê²°Â·ì¼ê´€**í•˜ê²Œ.
- **ì»¨í…ìŠ¤íŠ¸ API**ë¡œ íŠ¸ë¦¬ ê¹Šì€ í˜‘ì—…ì„ í•´ê²°, **Symbol í‚¤**ì™€ íƒ€ì…ìœ¼ë¡œ ì•ˆì „ì„± í™•ë³´.
- **ì»¨í…Œì´ë„ˆâ€“í”„ë¦¬ì  í…Œì´ì…˜**ìœ¼ë¡œ ë°ì´í„°/í‘œí˜„ ë¶„ë¦¬ â†’ í…ŒìŠ¤íŠ¸Â·ì¬ì‚¬ìš©Â·í™•ì¥ì„± â†‘.
- **ì•¡ì…˜/ìœ í‹¸/ìŠ¤í† ì–´**ëŠ” í´ë”ë¡œ ëª¨ë“ˆí™”í•´ ì–´ë””ì„œë“  ê°€ì ¸ë‹¤ ì“°ê¸°.
- ì ‘ê·¼ì„±/íƒ€ì´í•‘/ë¬¸ì„œí™”ë¥¼ **ì´ˆê¸°ë¶€í„° ë‚´ì¥**í•´ íŒ€ í’ˆì§ˆì„ ì˜¬ë¦°ë‹¤.
