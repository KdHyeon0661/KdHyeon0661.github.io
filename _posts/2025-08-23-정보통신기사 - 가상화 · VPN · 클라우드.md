---
layout: post
title: 정보통신기사 - 가상화 · VPN · 클라우드
date: 2025-08-23 13:25:23 +0900
category: 정보통신기사
---
# 가상화 · VPN · 클라우드 개념 총정리

## 큰 그림: ‘가상화로 자원 추상화’ + ‘VPN으로 안전한 오버레이’ + ‘클라우드로 탄력/운영 자동화’

```
[물리 HW] ── Hypervisor ──[VM]──OS/앱
                 └─[컨테이너 런타임]──[컨테이너]──프로세스/라이브러리
                           ↑
                    (CNI/overlay)
Internet ====== [VPN] ====== Branch/Remote
                (IPsec/SSL/WG)
Cloud: [Region]─[VPC]─[Subnet]─[EC2/VM/K8s]─[LB/ASG]─[DB/Storage]
         └─IAM/Key/KMS/Logs/Monitoring ── IaC/Terraform ── CI/CD
```

- **가상화**: HW를 논리적으로 분할/격리(**VM**) 또는 OS 커널을 공유(**컨테이너**).
- **VPN**: 공중망 위에 **암호화된 터널**을 구성해 지점/사용자 연결.
- **클라우드**: 자원을 **서비스**로 제공(IaaS/PaaS/SaaS), **VPC 네트워킹**과 **IAM**으로 제어, **자동복구/오토스케일** 내장.

---

## 가상화(하이퍼바이저 중심)

### 분류/용어

- **Type-1(네이티브)**: HW 위에 직접(ESXi, Hyper-V, Xen, KVM은 리눅스 커널 모듈).
- **Type-2(호스트형)**: 호스트 OS 위(QEMU/VirtualBox/VMware Workstation).
- **에뮬레이션** vs **하드웨어 지원(VT-x/AMD-V)** vs **준가상화(PV)**.
- **CPU 가상화**: 트랩/에뮬레이트, **µop 변환**, 링 보호(Guest Ring0→Host 관리).
- **메모리 가상화**: **Shadow PT** → **EPT/NPT(2차 주소변환)**.
- **I/O 가상화**: **에뮬 디바이스**, **paravirt(virtio)**, **SR-IOV(가상함수 VF 직결)**.
- **네트워킹**: vSwitch/OVS, **브리지/NAT**, 오버레이(VXLAN/Geneve).

### KVM/QEMU 빠른 예제

```bash
# CPU 가상화 지원 확인

egrep -o 'vmx|svm' /proc/cpuinfo | head

# 브리지 생성(예: br0) 후 클라우드 이미지 부팅

qemu-img create -f qcow2 vm01.qcow2 40G
virt-install \
  --name vm01 --memory 4096 --vcpus 2 \
  --disk path=vm01.qcow2,format=qcow2,bus=virtio \
  --cdrom /iso/ubuntu-22.04.iso \
  --network bridge=br0,model=virtio --graphics none
```
- **QCOW2**: **Copy-On-Write** 스냅샷/압축/암호화 가능.
- **virtio**: paravirt 드라이버로 대역/지연 개선.

### 라이브 마이그레이션

- **Pre-copy**: 메모리를 복사하며 더티 페이지 반복 → 짧은 스톱.
- **Post-copy**: 먼저 전환 후 페이지 demand-paging → 빠른 전환, 위험도↑.
- 공통 필요: **공유 스토리지**(또는 블록 복제), **동일 CPU 세트(마이그레이션 호환성)**, **저지연 네트워크**.

### 성능/튜닝 한 줄

- vCPU:pCPU **오버커밋** 비율, **NUMA** 어핀, **HugePage**(2MB/1GB), **SR-IOV/DPDK**로 네트워킹 가속.
- 스토리지: **write-back 캐시**, **멀티큐 블록/NET**, 스케줄러 `none`/`mq-deadline`.

---

## 컨테이너/쿠버네티스(OS 레벨 가상화)

### 원리

- **Namespaces**(pid/net/mount/user/uts/ipc)로 격리, **cgroups**로 자원 제한, **chroot/overlayfs**로 파일시스템.
- 이미지: **OCI** 레이어, **Registry**에서 pull. 런타임: runc/containerd/CRI-O.

### Dockerfile 스니펫

```dockerfile
FROM python:3.12-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn","--bind","0.0.0.0:8080","app:app"]
```

### 네트워킹/CNI

- **브리지/NAT**(단일 호스트), **Overlay**(VXLAN), **라우팅형**(Calico).
- 서비스 디스커버리: kube-proxy(IPVS), **Service/EndpointSlice**, **Ingress**(L7 LB).

### K8s 초간단 매니페스트

```yaml
apiVersion: apps/v1
kind: Deployment
metadata: {name: web}
spec:
  replicas: 3
  selector: {matchLabels: {app: web}}
  template:
    metadata: {labels: {app: web}}
    spec:
      containers:
      - name: web
        image: ghcr.io/acme/web:1.2.3
        ports: [{containerPort: 8080}]
---
apiVersion: v1
kind: Service
metadata: {name: web-svc}
spec:
  selector: {app: web}
  ports: [{port: 80, targetPort: 8080}]
  type: ClusterIP
```

### 보안/격리

- **rootless** 컨테이너, **seccomp/AppArmor/SELinux**, **read-only FS**, **capabilities 최소화**.
- 이미지 **서명/스캔**, SBOM, 비밀은 **Secret/KMS**로.

---

## VPN 개요와 선택

### 목적

- **기밀성/무결성/인증** 확보, **오버레이**로 사설망 확장(지점-간/원격접속).
- **Split-tunnel**(필요 경로만) vs **Full-tunnel**(모든 트래픽).

### 유형

- **IPsec**(L3, 표준, 하드웨어 가속 용이)
- **SSL/TLS**(L4/7, NAT 친화, 포트 443), **OpenVPN**
- **WireGuard**(UDP, 단순/고성능, 키기반)
- (참고) **L2TP(IPsec 상단 L2 터널)**, **SSTP**(TLS/443), **GRE over IPsec**(라우팅/멀티프로토콜)

---

## IPsec 깊게 보기

### 구성요소

- **IKEv2**: 키교환/인증(Phase1), **ESP**: 데이터 보호(Phase2).
- 모드: **터널모드**(네트워크-네트워크), **트랜스포트**(호스트-호스트).
- **NAT-T**: UDP 4500 캡슐화, **DPD**: Dead Peer Detection.

### 정책/라우팅

- **Policy-based**: (src,dst,proto) 매칭하여 보호.
- **Route-based(VTI/GRE)**: 가상 인터페이스에 라우팅(동적 라우팅/BGP 용이).

### strongSwan 예제(사이트-투-사이트, VTI)

```ini
# /etc/ipsec.conf

config setup
  uniqueids=never
conn s2s
  keyexchange=ikev2
  left=203.0.113.10         # 로컬 공인
  leftsubnet=10.10.0.0/16
  leftauth=psk
  right=198.51.100.20       # 원격 공인
  rightsubnet=10.20.0.0/16
  rightauth=psk
  ike=aes256-sha256-modp2048!
  esp=aes256-sha256!
  type=tunnel
  auto=start
  mark=100
  # Route-based: XFRM→VTI
  leftupdown=/usr/lib/ipsec/_updown iptables
```
```bash
# PSK

echo ': PSK "s3cr3t-psk"' > /etc/ipsec.secrets

# VTI 인터페이스(예: vti0) 생성 & 라우팅

ip link add vti0 type vti local 203.0.113.10 remote 198.51.100.20 key 100
ip addr add 169.254.100.1/30 dev vti0
ip link set vti0 up
ip route add 10.20.0.0/16 dev vti0
```

### MTU/MSS 클램핑

- IPsec/UDP 캡슐화로 헤더 오버헤드 ↑ → **조각화** 방지 위해 **MSS 1360~1380** 근사.
```bash
# nftables: TCP MSS 클램프

add rule inet filter forward tcp flags syn tcp option maxseg size set rt mtu
```

### 고가용성/라우팅

- **BGP over IPsec**: VTI 상에 BGP 수립(동적 경로/페일오버).
- **두 터널(Active/Standby)** + 헬스체크 → 우회.

---

## WireGuard(경량/고성능)

### 개념

- **UDP 기반**(포트 자유), **Curve25519/XChaCha20-Poly1305** 등 현대 암호, **키 기반 단순 구성**.
- 로밍/모바일 친화, **스몰 코드베이스**.

### 설정 예(사이트-투-사이트)

```bash
# 양 단말에서 키 생성

wg genkey | tee /etc/wireguard/privatekey | wg pubkey > /etc/wireguard/publickey

# /etc/wireguard/wg0.conf

[Interface]
Address = 10.254.0.1/30
ListenPort = 51820
PrivateKey = <LOCAL_PRIVATE>
PostUp   = ip route add 10.20.0.0/16 dev wg0
PostDown = ip route del 10.20.0.0/16 dev wg0

[Peer]
PublicKey = <REMOTE_PUBLIC>
Endpoint  = 198.51.100.20:51820
AllowedIPs = 10.254.0.2/32, 10.20.0.0/16
PersistentKeepalive = 25
```
```bash
# 활성화

wg-quick up wg0
wg show
```
- **AllowedIPs**가 **정책/라우팅** 역할을 겸함(간단 명료).
- **Keepalive**로 NAT 뒤에서도 연결 유지.

---

## OpenVPN(SSL/TLS)

### 서버 설정

```conf
port 1194
proto udp
dev tun
server 10.8.0.0 255.255.255.0
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 10.8.0.1"
cipher AES-256-GCM
user nobody
group nogroup
keepalive 10 60
persist-key
persist-tun
# 인증

ca ca.crt
cert server.crt
key server.key
dh none
auth SHA256
```

### 클라이언트 설정(ovpn)

```conf
client
dev tun
proto udp
remote vpn.example.com 1194
resolv-retry infinite
nobind
cipher AES-256-GCM
auth SHA256
<ca>...</ca>
<cert>...</cert>
<key>...</key>
```

### 언제 무엇을 쓰나?

- **IPsec**: 표준/기업간, **HW 가속/라우팅 통합**.
- **WireGuard**: 구성 간단/모바일/고성능.
- **OpenVPN**: TLS 에코시스템/프록시/443 관통 용이.
- 복잡한 멀티프로토콜/멀티캐스트 → **GRE over IPsec**.

---

## 클라우드 기본 모델

### 서비스/배치 모델

- **IaaS**: VM/스토리지/네트워크(자가 구축 유연성).
- **PaaS**: 런타임/DB/큐(운영 부담↓).
- **SaaS**: 완성 소프트웨어(운영 최소).
- **FaaS/Serverless**: 이벤트 기반 함수, **자동 스케일**/과금=사용량.
- **Public/Private/Hybrid/Multi-cloud/Edge**.

### 공유책임모델(요지)

- **클라우드 벤더**: 인프라 보안/가용성.
- **사용자**: OS/앱/데이터/IAM/구성/네트워크 정책.

---

## VPC/네트워킹(클라우드 공통 개념)

### 구성 요소

- **VPC**(사설 IP 공간), **서브넷**(AZ 단위), **라우트테이블**, **IGW/NATGW**, **보안그룹/네트워크 ACL**, **LB(ALB/NLB)**.
- **Transit Gateway/Hub-Spoke**: 다 VPC/온프렘 허브.
- **하이브리드**: **Site-to-Site IPsec** 또는 **전용회선(Direct Connect/ExpressRoute)**.

### 라우팅 예(허브-스포크)

```
[On-Prem 10.0.0.0/16]
    |  (IPsec)
[Hub VPC] 10.1.0.0/16
   ├─ TGW/Router
   ├─ SpokeA 10.2.0.0/16
   └─ SpokeB 10.3.0.0/16
정책: On-Prem ↔ SpokeA/B 허용, Spoke 간 통신은 보안그룹/NACL로 제어
```

### 보안 그룹 팁

- **상태기반**, 아웃바운드 **화이트리스트**(Egress 제어) 권장.
- **VPC Endpoint**로 S3/내부 서비스 **프라이빗 접근**.

---

## 스토리지/DB(클라우드)

- **오브젝트**(S3/GCS): 버킷/키, 버저닝/수명주기, **저렴/확장**.
- **블록**(EBS/PremiumDisk): VM 디스크, IOPS/처리량 프로파일.
- **파일**(EFS/FSx/AzureFiles): 공유 POSIX/SMB.
- **관리형 DB**: **RDS/CloudSQL**(OLTP), **NoSQL**(Dynamo/Cosmos), **DW**(Redshift/BigQuery/Synapse).
- **백업/스냅샷/PITR** 기본 제공(보존/암호화 정책 필수).

---

## 가용성/복구/확장

### 설계 원칙

- **AZ 다중 배치**(멀티AZ), 상태는 **다중 AZ 복제**.
- **오토스케일**(CPU/QPS/큐 길이), **헬스체크+재생성**.
- **IaC**로 **불변 인프라**(재현 가능).
- **관측성**(로그/메트릭/트레이스), **알람 런북**.

### 수식/감

$$
\text{가용성(연)} = \prod_i (1 - \text{Downtime}_i)
\qquad
A = \frac{\text{MTBF}}{\text{MTBF}+\text{MTTR}}
$$
- 단일 인스턴스 99.5%와 LB 뒤 **이중 배치(독립)**면 $1-(1-0.995)^2\approx 99.9975\%$.

### DR 전략

- **백업/복구**(저비용, RTO↑), **Pilot Light**, **Warm Standby**, **Active-Active**(고비용/최고 RTO/RPO).
- **RTO/RPO**를 **시나리오별**로 명시·테스트.

---

## 클라우드 보안 실무

- **IAM 원칙**: 최소권한, **정책 조건(태그/시간/소스IP)**, **권한경계**.
- **KMS/비밀관리**: 키 순환, BYOK/HYOK 검토.
- **네트워크**: SG/NACL, WAF, **프라이빗 서브넷 + NAT** 패턴.
- **로깅**: API 감사, VPC 플로우로그, LB/웹로그, **중앙 수집(SIEM)**.
- **이미지 하드닝**: CIS 벤치마크, OS/AMI 패치.
- **제로트러스트**: IdP/OIDC, SSO, 디바이스 상태 기반 접근.

---

## IaC/자동화

### Terraform 스니펫(개념)

```hcl
provider "aws" { region = "ap-northeast-2" }

resource "aws_vpc" "main" {
  cidr_block = "10.10.0.0/16"
  tags = { Name = "main" }
}

resource "aws_subnet" "a" {
  vpc_id     = aws_vpc.main.id
  cidr_block = "10.10.1.0/24"
  availability_zone = "ap-northeast-2a"
}
```

### CI/CD 개념

- **Build → Test → Scan → Deploy**.
- 배포 전략: **Rolling/Blue-Green/Canary**.
- 컨테이너: 이미지 태그/서명, 정책으로 **허용 레지스트리만**.

---

## 하이브리드/엣지

- 온프렘 ↔ 클라우드: **S2S IPsec**(초기), 중요 워크로드는 **전용회선**(QoS/대역).
- **SD-WAN**: 여러 링크를 **정책/측정 기반**으로 집적, 클라우드 게이트웨이 연동.
- 엣지/지사: **프록시/캐시/CDN**, 로컬 처리 + 클라우드 집계.

---

## 트러블슈팅 & 튜닝 모음

### VPN 공통

- **Phase1/IKE 실패**: 시간/PSK/ID 불일치, 방화벽(500/4500/ESP) 차단.
- **DPD/키프얼라이브**로 안정성, **MSS clamp**로 조각화 방지.
- **비대칭 라우팅**/NAT 순서 주의.

### IPsec vs WireGuard 지연/처리량

- IPsec은 **AES-NI**로 가속, 대역 좋음. WG는 **커널 모듈/UDP**로 **레이트변동 적고** 설정 단순.
- 대역폭 $B\approx \min(\text{링크}, \text{CPU 암복호 처리})$. CPU 1코어 1Gbps AES-GCM 가능(환경차 있음).

### VM/컨테이너

- **CPU steal**↑ → 오버커밋, 핀/배치 조정.
- **NUMA local** 확인, **HugePage**/THP 모드(서버 워크로드=always/VM=explicit).
- **SR-IOV**로 NIC 직결, 레이턴시 민감 워크로드(DPDK/NFV).

### 클라우드 네트워크

- **Security Group** 상태기반: **리턴 트래픽 규칙 불요**.
- **NACL**는 서브넷 레벨(무상태), 과도한 룰은 관리 위험.
- **Route Table** 누락/정책 경로 겹침 체크.

---

## 보안 심화(가상화/클라우드)

- **하이퍼바이저 보안**: VM Escape 방지(패치), **VT-d/IOMMU**로 DMA 격리.
- **가상 TPM/디스크 암호화**, **SEV/TDX**(메모리 암호화)로 **클라우드 내 데이터 보호**.
- **네트워크 마이크로세그멘테이션**(SG/NSG/카리스토/Calico), **호스트 방화벽** 이중방어.
- **WAF/IDS/IPS** + Cloud DDoS 보호.
- **비밀/키**: HSM/KMS, 람다/컨테이너에서 **IAM Role/SA**로 단기 자격증명.

---

## 예제 시나리오(엔드-투-엔드)

### 온프렘 ERP ↔ 클라우드 앱 양방향 통신

- 요건: 상호 통신, 대역 ≥ 200 Mbps, 지연 민감 X, 99.9%
- 설계: **S2S IPsec 2터널**(다른 AZ), **BGP**로 경로 우선/페일오버, **NAT-T**.
- 보안: **온프렘↔클라우드 SG/ACL 최소화**, **VPC Endpoint**로 백엔드 오브젝트 접근.
- 운영: 터널 모니터링(SLA), **키 롤테이션/DPD**, IaC로 재현.

### 글로벌 사용자 VPN(원격근무)

- 요건: 모바일/노트북, 방화벽 443만 허용 가능
- 설계: **OpenVPN/WireGuard** 게이트웨이 **세계 PoP**(Anycast LB), **Geo 라우팅**.
- 보안: **MFA+Device Posture**, 풀터널 기본, 고위험 조건 시 **DNS 필터링/Proxy**.

---

## 체크리스트(현장용)

### 가상화/VM

- [ ] CPU VT-x/AMD-V, EPT/NPT 켜짐
- [ ] vCPU/pCPU 계획, NUMA/핀, HugePage
- [ ] virtio/SR-IOV/멀티큐 활성
- [ ] 스토리지: QCOW2/씬/스냅샷 정책

### 컨테이너/K8s

- [ ] 이미지 서명/스캔, 루트리스/권한 최소
- [ ] 리소스 요청/제한, HPA/PodDisruptionBudget
- [ ] 네트워크 정책/Ingress/WAF
- [ ] 로깅/메트릭/트레이싱 표준화

### VPN

- [ ] 암호군(IKE/ESP) 표준 강도, PFS
- [ ] DPD/Keepalive, 재키교환 적절
- [ ] MTU/MSS 조정, NAT-T 확인
- [ ] 로그/플로우/헬스체크 대시보드

### 클라우드

- [ ] VPC/Subnet/Route/SG 정합성
- [ ] 멀티AZ 배치/오토스케일
- [ ] IAM 최소권한/키 순환/KMS
- [ ] 백업/스냅샷/PITR/DR 연습
- [ ] IaC/태깅/비용 모니터링

---

## 자주 틀리는 포인트(정오표)

1) **컨테이너=VM만큼 격리** → **커널 공유**로 모델 다름(보안옵션 필수).
2) **IPsec=느림** → 하드웨어/커널 가속 시 고성능. 튜닝 부재가 원인.
3) **NAT-T이면 다 된다** → 방화벽/대칭 NAT 환경에서 **엔드포인트/Keepalive** 필요.
4) **Cloud SG 열었는데 안됨** → **라우트/NACL/OS 방화벽**까지 체인 확인.
5) **멀티리전=고가용성=끝** → 데이터 복제 지연/일관성/비용/운영 복잡 고려.
6) **스냅샷=백업 대체** → 랜섬웨어/오염 복제됨. **오프사이트/불변 백업** 필요.
7) **SR-IOV면 항상 좋다** → VF 수 제한/라이브 마이그레이션 제약.

---

## 연습문제(풀이 포함)

**Q1. (가상화)** EPT/NPT의 장점 2가지는?
**A.** 2차 주소변환으로 **페이지 테이블 트랩 감소**, **성능↑**(TLB에 게스트→호스트 매핑 캐시).

**Q2. (컨테이너)** 네임스페이스 3가지와 역할?
**A.** **pid**(프로세스 트리 격리), **net**(네트워크 스택 격리), **mnt**(마운트 네임스페이스).

**Q3. (IPsec)** IKEv2 Phase1/Phase2의 차이?
**A.** Phase1=**IKE SA**(피어 인증/암호군/채널), Phase2=**Child SA**(트래픽 보호 파라미터/서브넷).

**Q4. (WireGuard)** AllowedIPs가 0.0.0.0/0이면 의미는?
**A.** **풀터널**(모든 IPv4 트래픽을 터널로 라우팅).

**Q5. (OpenVPN)** MTU 문제로 패킷 손실 시 조치 2가지는?
**A.** **fragment/mssfix 설정**, 또는 **서버/클라 MTU 낮추기**.

**Q6. (클라우드)** 멀티AZ 웹앱의 HA 향상을 위해 최소 구성 3가지?
**A.** **ALB/NLB + 다중 AZ 인스턴스 + 멀티AZ DB/세션 외부화(캐시)**.

**Q7. (DR)** Warm Standby와 Active-Active 차이?
**A.** 전자는 **소규모/대기 인프라**, 장애 시 확장; 후자는 **양쪽 모두 활성**, RTO/RPO 최상이나 비용↑.

**Q8. (보안)** 최소권한 구현 수단 3가지?
**A.** **IAM 정책 조건/태그**, **권한경계/Session Policy**, **SG/NACL로 네트워크 최소화**.

**Q9. (성능)** IPsec 터널 오버헤드로 유효 MSS가 줄었다. 링크 MTU 1500에서 안전한 MSS는?
**A.** 약 **1360~1380** 바이트(ESP+UDP+IP 헤더 감안, 환경에 따라 조정).

**Q10. (IaC)** Terraform 장점 2가지?
**A.** **선언형/재현성**, **상태관리/변경 계획(plan)**로 안전 배포.

---

## 암기표(초압축 24줄)

1) Type-1/Type-2 하이퍼바이저, KVM=커널 모듈+QEMU
2) CPU(VT-x/AMD-V), 메모리(EPT/NPT), I/O(virtio/SR-IOV)
3) 라이브 마이그레이션: pre/post-copy, 공유 스토리지
4) 컨테이너: namespaces+cgroups, rootless/seccomp
5) CNI: 브리지/오버레이(VXLAN)/라우팅, Ingress
6) IPsec: IKEv2+ESP, NAT-T, VTI=Route-based
7) WireGuard: UDP, 키기반, AllowedIPs=정책/라우팅
8) OpenVPN: TLS/1194, 443 우회 용이
9) MTU/MSS 클램프, DPD/재키교환
10) VPC: Subnet/Route/SG/NACL/IGW/NATGW
11) 허브-스포크/Transit GW, S2S/BGP
12) 스토리지: Object/Block/File, 관리형 DB
13) 멀티AZ+오토스케일+헬스체크
14) 가용성 곱, A=MTBF/(MTBF+MTTR)
15) DR: 백업→Pilot→Warm→Active-Active
16) IAM 최소권한, KMS/비밀관리
17) 로깅/플로우/SIEM, 제로트러스트
18) IaC(Terraform), 불변 인프라
19) 태깅/비용/리소스 거버넌스
20) NUMA/HugePage/SR-IOV/멀티큐
21) 컨테이너 이미지 서명/SBOM
22) WAF/IDS/IPS/DDoS 보호
23) CDN/엣지/프록시
24) 트러블슈팅: 레이어별(라우팅→보안→MTU)

---

## 마무리

가상화는 **격리/밀도/이식성**, VPN은 **안전한 연결**, 클라우드는 **탄력/자동화/운영 단순화**를 제공합니다.
설계의 핵심은 **경계와 책임(격리/암호/권한)**, 운영의 핵심은 **관측성과 자동화(IaC/CI-CD)**,
안정성의 핵심은 **다중화와 복구 계획(HA/DR)**입니다.
**원리 → 표준 → 예제 → 체크리스트** 루틴으로, 환경이 달라도 흔들리지 않는 설계를 완성하세요.
