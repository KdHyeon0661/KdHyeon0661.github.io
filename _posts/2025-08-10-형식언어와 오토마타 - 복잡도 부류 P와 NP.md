---
layout: post
title: 형식언어와 오토마타 - 복잡도 부류 P와 NP
date: 2025-08-10 22:20:23 +0900
category: 형식언어와 오토마타
---
# 복잡도 부류 **P**와 **NP**

이 글은 계산 복잡도 이론의 중심인 **P**와 **NP**를 한눈에 정리한다.
핵심은 “**다항시간에 풀 수 있는가(P)**” vs “**다항시간에 검증할 수 있는가(NP)**”, 그리고 **NP-완전성**·**감소**·**P ?= NP**의 의미다.

---

## 형식적 정의와 직관

### $$\mathbf{P}$$ (Polynomial time)

결정 문제(언어) $$L\subseteq \Sigma^*$$ 에 대해
$$
L\in \mathbf{P} \iff \exists\ \text{결정적 TM } M,\ \exists k\in\mathbb{N}:\ \forall x,\ \text{시간 } O(|x|^k)\ \text{내에 } M(x)\in\{0,1\},\ x\in L \Leftrightarrow M(x)=1.
$$
- **직관**: “입력 길이에 대해 **다항식 시간** 안에 ‘해를 계산’할 수 있다.”
- **대표 예시**: 정렬, 최단경로(Dijkstra/ Bellman–Ford), 최대유량(Dinic/ Push–Relabel), 최소신장트리, 이분 최대매칭(Hopcroft–Karp), **2-SAT**, 선형계 풀이(가우스 소거), **소수 판정(AKS)**, **선형계획(내부점)** 등.

### $$\mathbf{NP}$$ (Nondeterministic Polynomial time)

$$
L\in \mathbf{NP} \iff \exists\ \text{다항시간 검증기 } V,\ \exists k:\ \forall x,\
\begin{cases}
x\in L \Rightarrow \exists y,\ |y|\le |x|^k,\ V(x,y)=1,\\
x\notin L \Rightarrow \forall y,\ V(x,y)=0.
\end{cases}
$$
- **직관**: “Yes 인 입력은 **짧은 증명서(증인)** 로 **빨리 검증** 가능.”
- **동치 정의**: 비결정적 튜링 기계(NTM)가 다항시간에 수용하는 언어.
- **기본 포함**: $$\mathbf{P}\subseteq \mathbf{NP}$$ (스스로 계산한 결과가 곧 증명서).

> **결정 vs 검증**
> - **P**는 “답을 **계산**한다”.
> - **NP**는 “Yes인 경우, 답의 ‘증거’를 **검증**할 수 있다”.

---

## 스펙트럼: P와 NP의 대표 문제

### **NP (및 NP-완전)** 문제들

- **SAT/3-SAT**: CNF 식의 만족 가능성 — **NP-완전(쿠크–레빈 정리)**
- **CLIQUE/Independent Set/Vertex Cover** — **NP-완전**
- **Hamiltonian Path/Cycle**, **TSP(결정판)**, **Graph Coloring (k≥3)** — **NP-완전**
- **Subset-Sum/Partition**, **0/1-Knapsack(결정판)** — **NP-완전**

### **P**에 속하는 흥미로운 문제

- **2-SAT**(함축 그래프의 SCC), **Bipartite Matching**(Hopcroft–Karp), **최대유량**,
- **Linear Programming**(다항시간), **Primality Test(AKS)**, **평면 그래프**의 다수 문제(거의 선형/선형).

---

## 닫힘(폐포) 성질과 관련 계층

### 닫힘 성질 요약

| 연산/성질 | **P** | **NP** |
|---|---|---|
| 합집합/교집합 | 닫힘 | 닫힘(증명서 병렬 제시) |
| 보수 $$\overline{\cdot}$$ | 닫힘 | **미지** → $$\mathbf{coNP}$$ 정의 (일반적으로 $$\mathbf{NP}\stackrel{?}{=}\mathbf{coNP}$$ 미해결) |
| 연접/정규 연산 | 닫힘 | 대부분 닫힘(상세는 정의에 의존) |

- **coNP**: 보수가 NP에 있는 언어의 집합. 예) **UNSAT**(모든 절이 참이 될 수 없음)의 자연 후보는 coNP-완전.
- **위치**: $$\mathbf{P}\subseteq \mathbf{NP}\cap \mathbf{coNP}\subseteq \mathbf{NP}\cup \mathbf{coNP}\subseteq \mathbf{PSPACE}\subseteq \mathbf{EXP}.$$

---

## 다항시간 **감소**와 **NP-완전성**

### many-one 감소(정의)

다항시간 계산 가능한 함수 $$f$$ 가 있어
$$
x\in A \iff f(x)\in B.
$$
이를 $$A \le^p_m B$$ 로 표기.
- **의미**: “B가 적어도 A만큼 **어렵다**”.
- **전이**: A가 NP-완전이고 $$A\le^p_m B$$, 그리고 $$B\in \mathbf{NP}$$이면 B도 **NP-완전**.

### **Cook–Levin 정리**

$$\mathbf{NP}$$ 의 **모든** 문제는 다항시간에 **SAT**로 환원된다 → **SAT**는 **NP-완전의 원점**.

---

## 결정/탐색/최적화의 관계

- **결정판**: 예/아니오. (복잡도 이론의 표준 객체)
- **탐색판**: 실제 해를 구함. (SAT는 self-reduction으로 결정↔탐색 다항 동등)
- **최적화판**: 최적값을 구함(보통 NP-어려움).

```text
# SAT 탐색: self-reduction 스케치

for 변수 x_i:
  φ0 := φ with x_i := 0
  if SAT(φ0) then set x_i=0; φ := φ0
  else set x_i=1; φ := φ with x_i := 1
# SAT(·) 호출은 결정판 판별기(=오라클)라고 생각해도 됨

```

---

## 대표 감소 예 — 3-SAT → CLIQUE

### 감소 정리(스케치)

3-CNF $$\phi=\bigwedge_{j=1}^m(\ell_{j1}\vee \ell_{j2}\vee \ell_{j3})$$ 가 주어졌을 때 그래프 $$G$$ 를 다음처럼 만든다.
- 각 절의 각 리터럴을 **정점**으로(총 $$3m$$ 개).
- 같은 절에 속한 정점끼리는 **간선 없음**.
- 서로 **모순되는 리터럴**(예: $$x$$ vs $$\lnot x$$) 사이에도 **간선 없음**.
- 나머지 모든 쌍에는 **간선**.

그럼
$$
\phi\ \text{만족 가능} \iff G\ \text{에 크기 } m \text{의 clique 존재}.
$$

### 의사코드(구성 절차)

```text
Reduce-3SAT-to-CLIQUe(φ):
  V := {}
  for j in 1..m:               # 각 절
    for t in {1,2,3}:          # 각 리터럴 노드
      add node v_{j,t} to V
  E := {}
  for (j,t) != (j',t'):
    if j != j' and not (l_{j,t} contradicts l_{j',t'}):
      add edge (v_{j,t}, v_{j',t'}) to E
  return (G=(V,E), k=m)
```

---

## P와 NP 사이: **Ladner 정리**와 중간 후보

- **Ladner(1975)**: $$\mathbf{P}\ne\mathbf{NP}$$ 라면 **NP-완전도 아니고 P도 아닌** **NP-중간** 문제가 존재.
- **후보**: **Graph Isomorphism(GI)**(최근 준다항), **정수 인수분해(Factoring)**(양자 Shor로는 다항), **Parity Games** 등.
- **의미**: NP는 “P vs NP-완전”의 이분이 아닐 수 있다.

---

## 무작위화·근사·파라미터: 현실적 우회로

### 무작위화

- 클래스: $$\mathbf{RP}\subseteq \mathbf{BPP}\subseteq \mathbf{\Sigma_2^P}$$, 실무에선 **Miller–Rabin** 등 확률적 판정이 널리 쓰임.
- **Derandomization** 관점: 충분한 하드니스 가정 아래 $$\mathbf{BPP}=\mathbf{P}$$ 가능성이 제기됨.

### 근사 알고리즘(대표)

- **Metric-TSP**: **Christofides 1.5-근사**.
- **Vertex-Cover**: **2-근사**(최대 매칭 기반).
- **Set-Cover**: **\((1+\ln n)\)-근사**(탐욕).
- **Max-Cut**: **0.878**(Goemans–Williamson, SDP).

### 파라미터화(FPT)

- **Vertex-Cover(k)**: $$O(1.27^k+kn)$$ 등.
- **Treewidth 기반** DP: 많은 NP-완전 문제를 $$f(\mathrm{tw})\cdot n^{O(1)}$$ 로.
- 반면 **Clique/Independent-Set(k)** 는 **W[1]-완전**(FPT 어려움).

---

## **P = NP?** — 의미와 파급효과

- **P=NP**라면
  - 모든 **NP-완전** 문제가 **다항시간 해결** ⇒ 대다수 **공개키/일방향성** 기반 암호가 **붕괴**.
  - **다항식 계층(PH)** 이 **P**로 **붕괴**.
  - 실제론 “다항 차수/상수”가 커서 실무 효율성은 별개 이슈가 될 수 있음.
- **P≠NP**라면
  - 강한 하한을 증명하려면 **Relativization**, **Natural Proofs**, **Algebrization** 같은 **장벽 이론**을 넘어야 함.

---

## 실무 체크리스트 — NP-완전 문제를 만났을 때

1) **구조 활용**: 평면/유한 트리폭/이분 그래프, 제약 제한(Horn-SAT, 2-SAT).
2) **근사**: 보장 비율(VC 2-근사, Set-Cover 로그 근사, Metric-TSP 1.5).
3) **FPT/커널화**: 매개변수(해 크기, 컷 수, 트리폭)로 분리.
4) **무작위화/휴리스틱**: SAT **CDCL**, 지역탐색(WSAT), 메타휴리스틱.
5) **수리최적화로 변형**: ILP/LP-relaxation + 분기한계/커팅플레인.
6) **문제 재정의**: 서비스 레벨 관점에서 “충분히 좋은” 해(근사/제약 완화).

---

## 작동 예제 모음(코드 & 상황)

### **2-SAT**: P에 속하는 이유(함축 그래프)

- **상황**: 제약 $$C=(x\lor \lnot y)\land(\lnot x\lor z)\land\cdots$$
- **핵심**: 각 절 $$(a\lor b)$$ 를 **함축** $$(\lnot a\Rightarrow b),(\lnot b\Rightarrow a)$$ 로 바꿔 **2|V|** 정점의 유향 그래프를 만든다.
- **정리**: 어떤 변수 $$x$$ 에 대해 $$x$$ 와 $$\lnot x$$ 가 **같은 SCC**면 **불만족**.

```text
TwoSAT(clauses):
  build implication graph G on literals {x, ¬x}
  for each (a ∨ b): add edges (¬a→b), (¬b→a)
  compute SCCs
  if ∃x: scc(x) == scc(¬x): return UNSAT
  else: assign variables in reverse topological order of SCC-DAG
```

### **Vertex-Cover 2-근사**(최대 매칭 기반)

```text
Approx-VC(G):
  M := any maximal matching
  C := { both endpoints of every edge in M }
  return C      # |C| ≤ 2·OPT
```
- **상황**: 네트워크 감시 카메라 최소 설치. 매칭의 각 간선은 서로 다른 꼭짓점을 요구 ⇒ **하한** $$|M|$$, 우리는 각 간선에 2개씩 넣음 ⇒ **2-근사**.

### **Subset-Sum** 의사다항/근사

- **의사다항식 DP**: 목표 합 $$T$$ 에 대해 $$O(nT)$$.
- **FPTAS(리스트-트림)** 스케치:
```text
FPTAS-SubsetSum(A, T, ε):
  L := {0}
  for x in A:
    L := merge-sort-and-unique( L ∪ {ℓ+x | ℓ∈L} )
    L := trim(L, δ=ε/(2|A|))    # 인접 값을 (1+δ) 비율로 대표값만 유지
    remove all ℓ > T
  return max L
```

### **TSP(결정판)**: Held–Karp DP(정확) & Christofides(근사)

```text
# Held–Karp (정확, O(n^2·2^n))

DP[S][j] = min_{i∈S\{j}} DP[S\{j}][i] + dist(i,j),  S⊆V, 1∈S, j∈S
answer = min_j DP[V][j] + dist(j,1)
```
- **Metric-TSP 1.5-근사**(MST → 홀수차 정점 최소 퍼펙트매칭 → 오일러 투어 숏컷).

### **SAT 실무**: DPLL → CDCL 골격

```text
CDCL(φ):
  assign := {}
  while true:
    unit-propagation(assign, φ)
    if conflict:
      if decision-level == 0: return UNSAT
      learn-clause, backjump
    elif all variables assigned: return SAT(assign)
    else:
      decide a branching literal (VSIDS/LSIDS), push decision level
```
- **상황**: 하드웨어 검증/스케줄링/소프트웨어 모델체킹에서 수백만 변수도 실전 해결(강력한 휴리스틱·학습 효과).

---

## 강/약 NP-난도, 의사다항, FPTAS

- **약(weakly) NP-난도**: 수치 크기에 의존해 **의사다항식** 알고리즘이 존재(예: Knapsack, Subset-Sum). → 종종 **FPTAS** 가능.
- **강(strongly) NP-난도**: 입력 수치의 크기를 **단위(유니터리) 부호**로 줘도 어렵다. → **PTAS/FPTAS** 어려움(일반적).

---

## PCP·근사불가능성과 구조 복잡도 스냅샷

- **PCP 정리**: $$\mathbf{NP}=\mathbf{PCP}(\log n, O(1))$$ → **상수 인자 근사**의 **근본적 하한** 도출(예: Set-Cover의 $$\ln n$$ 장벽, Clique 근사 불가 등).
- **PH(다항식 계층)**: $$\mathbf{P}=\mathbf{NP} \Rightarrow \mathbf{PH}=\mathbf{P}$$ 로 붕괴.
- **IP=PSPACE**, **MIP=NEXP**: 상호작용/멀티프로버 증명과 복잡도의 놀라운 등식.

---

## 평균-경우, 암호, “P=NP이면?”

- **평균-경우 난도**: 암호는 **평균-경우** 어려움을 요구.
- **If P=NP**: 대부분의 고전 암호(OWF, PRG, PRF 기반) 불가 → **광범위한 붕괴**.
  (안전한 암호가 존재하면 **P≠NP**는 강하게 시사되지만, 논리적 동치는 아님.)

---

## 현업용 “문제 지도”와 의사결정

1) **문제 분류**: 구조(그래프 클래스/제약 형태), 수치 범위, 실무 허용 오차(근사) 파악.
2) **모델링 선택**: SAT/SMT/ILP/CP(제약프로그래밍).
3) **알고리즘 전략**:
   - **빠른 판정**(2-SAT/유량/매칭/네트워크 단축)으로 전처리,
   - **커팅 플레인** & **분기한계** & **휴리스틱**(탐욕, 로컬서치),
   - **FPT/커널화**(트리폭/해 크기).
4) **근사 허용**: 성능–품질 트레이드오프 명시(예: “1.1-근사 내 최적”).

---

## 요약 표 — P vs NP

| 항목 | **P** | **NP** |
|---|---|---|
| 정의 | 결정적 TM이 **다항시간**에 해결 | **증명서**가 있으면 다항시간 **검증** |
| 예 | 2-SAT, 최단경로, 최대유량, LP, AKS | SAT, Clique, TSP(dec), 3-Coloring, Knapsack(dec) |
| 닫힘 | $$\cup,\cap,\overline{\cdot}$$ | $$\cup,\cap$$ (보수는 미지: coNP와의 관계 미해결) |
| 핵심 도구 | 유량/매칭, DP, 그리디, matroid | **다항시간 감소**, 가젯, PCP |
| 미해결 | — | **P ?= NP**, **NP ?= coNP** |

---

## 자주 하는 오해(퀵 체크)

- “NP = 비결정적 = ‘랜덤으로 찍는다’?” → **아님**. NP는 “**검증**이 빠름”의 클래스.
- “NP-완전이면 전부 다 똑같이 어렵다?” → **아님**. 이론상 동등(다항환원)이나, 실무 난이도는 구조·상수·분포에 크게 좌우.
- “확률적 알고리즘은 항상 틀릴 수 있다?” → **RP/BPP**는 **오류 확률**을 **지수적으로** 낮출 수 있음.

---

## 미니 연습

1) 3-SAT → Vertex-Cover 표준 감소를 작성하라(보완: “각 절을 덮기 위해 최소 하나의 정점 선택” 장치).
2) 2-SAT 인스턴스를 만들어 함축 그래프–SCC로 풀어보라.
3) Subset-Sum에 대해 $$n=40$$, 합이 $$T$$ 일 때 meet-in-the-middle(약 $$2^{n/2}$$)을 구현해보라.
4) 동일 인스턴스를 ILP로 모델링해 상용/오픈소스 MIP 솔버와 성능 비교.

---

## 결론

- **P**: “다항시간에 **계산** 가능.”
- **NP**: “Yes인 경우 **증명서**로 **검증** 가능.”
- **NP-완전**은 서로 **감소**로 얽힌 난문들의 핵 — **P ?= NP**는 이론·암호·최적화 전반에 결정적.
- 실무적으로는 **구조 활용·근사·FPT·무작위화**와 **모델링(ILP/SAT/CP)** 이 사실상의 해결 계층을 이룬다.

---

### 부록 A: 수식 모음

$$
\mathbf{P}=\bigcup_{k\ge 1}\mathrm{TIME}(n^k),\quad
\mathbf{NP}=\{L\mid \exists\ \text{poly }p,\ \exists V\in \mathbf{P}:\ x\in L \Leftrightarrow \exists y,\ |y|\le p(|x|),\ V(x,y)=1\}.
$$

$$
\mathbf{P}\subseteq \mathbf{NP}\subseteq \mathbf{PSPACE}\subseteq \mathbf{EXP},\quad
\mathbf{NP}\cup \mathbf{coNP}\subseteq \mathbf{PH}.
$$

---

### 부록 B: 현업 예(간단 ILP/ SAT 모델 스니펫)

**Vertex-Cover (ILP)**
```text
# 변수: x_v ∈ {0,1}  (v를 커버에 넣으면 1)

minimize  Σ_v x_v
subject to  x_u + x_v ≥ 1   for all edges (u,v)
```

**3-Coloring (SAT)**
```text
# 변수: X_{v,c}  (정점 v가 색 c인지)
# 각 정점은 정확히 1색

( X_{v,1} ∨ X_{v,2} ∨ X_{v,3} )  and  pairwise at-most-one clauses
# 인접 정점은 같은 색 금지

for each edge (u,v), for c in {1,2,3}: (¬X_{u,c} ∨ ¬X_{v,c})
```

**Knapsack(dec) (DP 테이블)**
```text
DP[i][w] = true if some subset of first i items achieves weight ≤ w and value ≥ B
# 또는 가치 기준 DP로 FPTAS 적용

```
