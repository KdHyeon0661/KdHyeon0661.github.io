---
layout: post
title: DB - 분산 데이터베이스와 성능
date: 2025-02-12 21:20:23 +0900
category: DB
---
# 🌐 분산 데이터베이스와 성능

## 📌 분산 데이터베이스란?

**분산 데이터베이스(Distributed Database)**는 하나의 논리적 데이터베이스가 **물리적으로 여러 위치에 분산된 시스템**을 의미합니다. 사용자는 이를 단일 데이터베이스처럼 사용하지만, 내부적으로는 여러 노드에 걸쳐 데이터가 분산되어 저장·처리됩니다.

> 예: Cassandra, MongoDB(샤딩), Google Spanner, CockroachDB, YugabyteDB 등

---

## 🎯 분산 데이터베이스 도입 목적

- 대량 데이터 저장/처리 성능 향상
- 수평 확장(Scale-out)으로 처리량 증가
- 글로벌 서비스 대응 (지리적 분산)
- 장애 허용성 및 고가용성 확보

---

## ⚙️ 성능 향상 요인

| 요소 | 설명 |
|------|------|
| 🔄 수평 확장 (Horizontal Scaling) | 노드를 추가해 저장 공간 및 처리능력을 확장 가능 |
| 🧠 병렬 처리 | 데이터가 여러 노드에 분산되므로 동시에 다수의 쿼리/트랜잭션 처리 가능 |
| 🧭 지역 분산 (Geo-distribution) | 사용자와 가까운 데이터 노드에서 처리하여 **지연(Latency)** 감소 |
| 📚 샤딩 (Sharding) | 데이터를 특정 키 기준으로 나눠 노드별로 저장 → 단일 노드 병목 회피 |

---

## 🔻 성능 저하 요인 및 고려사항

| 원인 | 영향 | 대응 방안 |
|------|-------|-------------|
| 📡 네트워크 지연 | 노드 간 통신 필요 시 응답 시간 증가 | 노드 위치 최적화, 캐싱 활용 |
| 🔁 데이터 일관성 유지 비용 | 동기화 지연, 충돌 처리 등 | CAP 이론 기반 설계, Eventually Consistent 모델 |
| ⚠️ 분산 트랜잭션 비용 | 트랜잭션이 다수 노드를 걸칠 경우 성능 저하 | Local write 우선 구조, SAGA 패턴 도입 |
| 🧩 샤딩 키 설계 미흡 | 데이터 쏠림(Skew)으로 일부 노드 과부하 | 균형 잡힌 샤딩 키 설계 필요 (예: 해시 기반) |

---

## 🧱 분산 아키텍처 유형별 성능 특성

| 구조 | 특징 | 성능 특성 |
|------|------|-----------|
| Master-Slave 복제 | 하나의 주노드 + 다수의 복제 노드 | 읽기 성능 ↑, 쓰기 병목 주의 |
| Peer-to-Peer (P2P) | 모든 노드가 대등 | 병렬 처리 우수, 노드 증가 시 확장성 높음 |
| 샤딩 기반 | 데이터 분할 저장 | 고속 쓰기 및 대용량 처리 우수, 쿼리 복잡성 ↑ |
| Global Distributed DB (ex. Spanner) | 전 지리적 노드에 동기화 | 글로벌 서비스에 적합, 고비용 고복잡도 |

---

## 🧮 성능 최적화를 위한 분산 설계 전략

1. **샤딩 키 선정**
   - 사용자 ID, 날짜, 해시 등으로 균등 분산
   - 피해야 할 예: 연속 증가하는 값 (Hotspot 발생)

2. **쿼리 라우팅 최적화**
   - 쿼리 범위를 샤드 단위로 분리
   - Cross-shard JOIN, GROUP BY 최소화

3. **일관성 수준 조정**
   - 읽기/쓰기 성능 요구에 따라 Strong / Eventual Consistency 선택

4. **쓰기/읽기 분리**
   - Master → 쓰기 전용, Slave → 읽기 전용

5. **지연 최소화를 위한 노드 배치**
   - 사용자 지리적 위치에 따른 최적화 배치

---

## 🔁 실무 적용 예시

### 📍 MongoDB 샤딩 예시
- 10억 건 이상의 로그 데이터 처리
- 샤딩 키: 사용자 ID (균등 분산)
- 장점: 병렬 INSERT/SELECT 성능 뛰어남
- 주의: Cross-shard Aggregation에서 병목 발생 → Spark와 연계 처리

### 📍 Google Spanner
- 글로벌 트랜잭션 처리
- TrueTime API로 지연 + 일관성 동시 보장
- 매우 높은 SLA를 요구하는 글로벌 결제 시스템에 적용

---

## ⚖️ 분산 DB와 성능: 요약 정리

| 장점 | 단점 |
|------|------|
| 대용량 데이터 분산 저장 | 복잡한 설계 및 운용 |
| 수평 확장 → 처리량 증가 | 네트워크 병목, 트랜잭션 비용 증가 |
| 장애에 강한 구조 | 일관성 보장 비용 증가 |
| 병렬 처리 가능 | 샤딩 키 설계 실패 시 성능 악화 |

---

## ✅ 결론

- 분산 데이터베이스는 **성능 향상**의 강력한 수단이지만, 잘못된 구조 설계나 샤딩 키 선택은 오히려 **병목**을 유발할 수 있음.
- 단일 RDBMS보다 복잡하지만, 데이터량 증가와 트래픽 급증 시대에서는 **필수 전략**이 되어가고 있음.
- 분산 구조는 반드시 **목표 성능 지표(SLA)**에 따른 **균형 잡힌 설계**가 필요함.

> 성능을 얻기 위해 일관성을 얼마나 포기할 수 있는가?  
> 이것이 분산 데이터베이스 설계의 핵심 질문입니다.