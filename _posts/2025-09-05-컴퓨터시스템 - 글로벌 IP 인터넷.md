---
layout: post
title: 컴퓨터시스템 - 글로벌 IP 인터넷
date: 2025-09-05 23:20:23 +0900
category: 컴퓨터시스템
---
# 글로벌 IP와 인터넷

## 글로벌 IP란?

**글로벌 IP(Global/Public IP)** 는 전 세계 인터넷에서 **고유하게 식별되는 공인 주소**입니다.
라우팅 가능한 범위에 속하며, 인터넷 상의 다른 호스트가 이 주소로 직접 패킷을 보낼 수 있습니다.

- **고유성**: 전 세계에서 중복되지 않도록 **ICANN/IANA**가 전역 자원 관리 → **RIR**(APNIC/ARIN/RIPE NCC/LACNIC/AFRINIC) → **NIR/ISP** → **최종 사용자**로 위임
- **라우팅 가능성**: 기본적으로 글로벌 라우팅 테이블에 광고(BGP)될 수 있는 주소 범위
- **가시성**: 공격 스캔 대상에 바로 노출 → **방화벽/필터링/업데이트** 중요

---

## 글로벌 vs 사설(Private) IP

| 구분 | 글로벌 IP (Public) | 사설 IP (Private) |
|---|---|---|
| 용도 | 인터넷 직결 통신 | 내부(LAN/VPC/VNet) 통신 |
| 전역 고유성 | O | X (중복 허용) |
| 예시(IPv4) | 8.8.8.8, 1.1.1.1, 203.0.113.5* | 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 |
| 예시(IPv6) | 2001:db8::/32* (문서용), 2400::/7 등 | ULA(fc00::/7), 링크로컬(fe80::/10) |
| 할당 | ISP/RIR | 네트워크 관리자(자체) |
| 외부 접속 | 직접 가능 | NAT/프록시를 통해 |

\* `203.0.113.0/24`, `2001:db8::/32`는 **문서용(테스트/예시)** 블록.

### IPv4 사설/특수 범위 보충

- **Private**: `10/8`, `172.16/12`, `192.168/16`
- **CGNAT**: `100.64.0.0/10` (통신사 내부 NAT 풀)
- **Loopback**: `127.0.0.0/8`
- **Link-local**: `169.254.0.0/16`(APIPA)
- **문서/테스트**: `192.0.2.0/24`, `198.51.100.0/24`, `203.0.113.0/24`
- **멀티캐스트**: `224.0.0.0/4`

### IPv6 범위 개요

- **Global Unicast**: `2000::/3` (인터넷 라우팅)
- **Unique Local Address(ULA)**: `fc00::/7` (사설, NAT 없이 내부 라우팅)
- **Link-local**: `fe80::/10` (세그먼트 내, 라우팅 불가)
- **Loopback**: `::1/128`
- **멀티캐스트**: `ff00::/8`

---

## IPv4와 IPv6 — 설계 차이와 실무 관점

### IPv4

- 32비트(약 43억) → 고갈 → **NAT, CGNAT** 광범위 사용
- V4 전용 환경에서 서버 개방은 **포트 포워딩**이 필수(가정/소규모)

### IPv6

- 128비트(거의 무한대) → 각 단말이 **직접 글로벌 주소** 보유 가능
- **주소 구성**: SLAAC(RA), DHCPv6, 수동
- **프라이버시 확장**: 임시 주소(Privacy Extensions)로 추적 난이도 증가
- **NAT66 비권장**: 종단간 원칙 유지(필요하면 방화벽/프록시)

> **수학(주소 개수 감)**
> $$\text{IPv4}:\ 2^{32}\approx 4.29\times 10^9,\quad \text{IPv6}:\ 2^{128}\approx 3.4\times 10^{38}$$

---

## 주소 할당 — 고정 vs 동적, 프리픽스 길이

- **고정(Static)**: 서버/온프레미스 서비스 운영에 적합(역방향 DNS 설정, 화이트리스트 편리)
- **동적(Dynamic)**: 재연결/임대 만료 시 변경 가능(가정/모바일 일반적)
- **프리픽스**: IPv4 `x.x.x.x/24`, IPv6 `2001:db8:abcd::/48` 등

### ISP/클라우드 시나리오

- 가정/소호: **동적 IP + CGNAT** 빈번 → 외부에서 **직접 접속 어려움**
- 클라우드: **Elastic IP/Static IP** 제공, **BGP Anycast** IP로 전세계 POP 제공(CDN/보안 프록시)

---

## NAT와 포트 포워딩 — CGNAT, PAT, Hairpin

**NAT(Network Address Translation)** 은 사설 ↔ 글로벌 주소 변환.
일반적으로 **PAT(Port Address Translation)** 로 **여러 호스트가 하나의 공인 IP 공유**.

- **Static NAT(1:1)**: 내부 1 ↔ 외부 1
- **Dynamic NAT**: 풀에서 동적 할당
- **PAT(NAT Overload)**: 다수 내부 → 1개 글로벌 IP (포트로 구분)

### CGNAT(Carrier-Grade NAT)

- 통신사 단계의 대규모 NAT (주소: `100.64.0.0/10`)
- **결과**: 개인 라우터의 포트 포워딩만으로는 **외부 진입 불가**
- 해결: **IPv6 사용**, **터널링(VPN/WireGuard)**, **리버스 프록시**, **중계 서버**

### 포트 포워딩/UPnP/PCP

- 수동: 라우터에서 WAN:포트 → 내부:IP:포트 매핑
- 자동: **UPnP IGD**, **NAT-PMP/PCP**로 앱이 동적으로 포트 열기(보안 검토 필수)
- **Hairpin NAT(루프백)**: 내부에서 공인 IP로 접속 시 라우터가 다시 내부로 포워딩(일부 라우터 옵션)

### NAT 트래버설

- **STUN**: 외부에서 보이는 공인 IP/포트 탐지
- **TURN**: 중계 서버로 릴레이
- **ICE**: 후보 경로 탐색/선택(WebRTC)

---

## 글로벌 IP 확인/진단

### 명령어

```bash
# 공인 IP 확인

curl -s ifconfig.me
curl -s https://api.ipify.org
dig +short myip.opendns.com @resolver1.opendns.com

# 로컬 인터페이스 주소/라우팅

ip addr
ip -6 addr
ip route
ip -6 route

# ASN/프리픽스/리버스 DNS 대략 보기

whois $(curl -s ifconfig.me)
```

### C 예제(외부 서비스 호출)

```c
#include <stdio.h>
#include <stdlib.h>

int main(void) {
    printf("My public IPv4: ");
    fflush(stdout);
    system("curl -s https://api.ipify.org");
    printf("\n");
    return 0;
}
```

### 파이썬(표준 라이브러리 + 외부 호출)

```python
import urllib.request
ip = urllib.request.urlopen("https://api.ipify.org").read().decode()
print("Public IP:", ip)
```

> **주의**: 외부 IP 확인은 **신뢰 가능한 엔드포인트**를 사용하고, 프록시/VPN 사용 시 결과가 달라질 수 있습니다.

---

## DNS와 역방향 DNS(PTR)

- **정방향**: 이름 → IP (A/AAAA)
- **역방향**: IP → 이름 (PTR, in-addr.arpa / ip6.arpa)
- **메일 서버**: PTR 설정이 스팸 필터 신뢰에 영향
- **동적 IP** 는 PTR이 ISP 기본값(랜덤 호스트명) → 메일 송신 가산점 낮음

```bash
# 역방향(PTR) 확인

dig -x 203.0.113.45 +short
```

---

## BGP/ASN/Anycast/RPKI — 글로벌 라우팅 관점

- **ASN(자치 시스템 번호)**: 네트워크 운영 주체 식별. BGP에서 경로 광고 단위
- **BGP**: ISP 간 라우팅 프로토콜. 프리픽스/경로 정책/우회 등
- **Anycast**: 동일 IP를 여러 지점에서 광고 → **가까운 POP로 트래픽 유도**(DNS 루트/Cdn/보안 게이트웨이)
- **RPKI**: 라우트 기원 검증(ROA)으로 **하이재킹/오류 광고** 완화

---

## 보안 — 스캔·DDoS·필터링·BCP 38

### 위험

- 무차별 포트 스캔, 취약 서비스 자동 공격
- DDoS/Reflection(증폭) 공격(UDP: NTP/SSDP/DNS 등)
- 봇넷 감염 후 C2 통신/스팸 송신

### 대응

- **최소 개방**: 필요한 포트만, 나머지는 **DROP/DENY**
- **방화벽**: iptables/nftables/ufw, 클라우드 SG/NSG
- **애플리케이션 게이트웨이/리버스 프록시/WAF**
- **레이트 리미트**: `hashlimit`, `fail2ban`, API 게이트웨이
- **업데이트/취약점 패치**
- **원치 않는 egress 차단(BCP 38)**: 스푸핑 트래픽 방지(사업자·기관 필수)

### 리눅스 예시(nftables)

```bash
nft add table inet filter
nft add chain inet filter input { type filter hook input priority 0; }
nft add rule inet filter input ct state established,related accept
nft add rule inet filter input iif lo accept
nft add rule inet filter input tcp dport {22,443,80} accept
nft add rule inet filter input ip protocol icmp accept
nft add rule inet filter input ip6 nexthdr icmpv6 accept
nft add rule inet filter input counter drop
```

---

## 성능 — MTU/PMTUD/QUIC/NAT 비용

- **MTU**: 이더넷 1500, 터널/VPN은 더 작을 수 있음
- **PMTUD**: 경로 MTU 발견. ICMP 블록은 단편화 문제 유발 → **ICMP 필요 트래픽 허용**
- **QUIC(UDP 기반)**: TLS+전송 통합, 연결 마이그레이션, 혼잡제어 개선
- **NAT 비용**: 상태 테이블 관리/포트 변환 → 고부하 라우터에서 병목 가능

---

## 서버 공개 — 포워딩, 동적 DNS, IPv6

### IPv4만 있는 환경

- 공인 IP를 라우터가 보유 → 내부 서버에 **포트 포워딩**
- CGNAT이면 **직접 공개 어려움** → **역방향 터널/중계 서버/VPN**

### IPv6 가능 환경

- 단말이 글로벌 IPv6 보유 → **방화벽에서 인바운드 정책**만 열면 외부 접근 가능(포워딩 불필요)
- 개인정보 보호를 위해 **프라이버시 임시 주소**와 **고정 서버 주소**를 분리

### 동적 DNS

- IP가 바뀔 때 자동으로 DNS 업데이트
```bash
# ddclient 예시(conf 요지)

protocol=cloudflare
use=web, web=ifconfig.me/ip
ssl=yes
```

---

## 운영/관찰 — 로그/지오IP/오류 해석

- **지오IP**: 접속 국가/도시 대략 추정(정확도는 한계)
- **로그**: src IP/ASN/Geo, user-agent, 응답코드, 바이트 수, 지연 시간
- **오류**: `ENETUNREACH`(경로 없음), `ECONNREFUSED`(포트 닫힘), `ETIMEDOUT`(방화벽/유실)

---

## 실습 — 포트 개방/포워딩 점검

### 외부에서 포트 확인

```bash
# 외부 노드에서

nc -vz your.public.ip 22
# 또는

curl -I http://your.public.ip:80/
```

### 라우터 포워딩(개념)

```
WAN:203.0.113.45:443  ──>  LAN:192.168.1.10:443
```
- 내부 서버(192.168.1.10)는 로컬 방화벽에서 443 허용
- 라우터에서 **TCP 443**을 해당 서버로 포워딩

---

## IPv6 구성 — SLAAC/DHCPv6/프라이버시

### SLAAC

- 라우터 광고(RA)로 프리픽스 알림 → NIC가 인터페이스 ID 생성(EUI-64 또는 임의)
- 간단/무상태, 라우팅 자동화

### DHCPv6

- 상태 기반 할당(주소/옵션). 엔터프라이즈에서 선호

### 프라이버시 확장

- 임시 주소(Temporary Address)로 추적 위험 낮춤
- 리눅스:
```bash
# 일시 주소 활성화(예: Ubuntu/Debian)

sysctl -w net.ipv6.conf.all.use_tempaddr=2
sysctl -w net.ipv6.conf.default.use_tempaddr=2
```

---

## 수학 — CIDR, 서브넷 규모 직관

- 서브넷의 호스트 수(IPv4):
  $$
  \text{호스트 수} \approx 2^{(32 - \text{prefix})} \quad (\text{네트워크/브로드캐스트 제외 고려})
  $$
  예) `/24` → 약 256개 주소
- IPv6는 매우 큼. 가정/소호에서도 `/56` 또는 `/64` 프리픽스를 받는 경우가 흔함.

---

## 코드/스크립트 모음

### 현재 경로/게이트웨이/MTU

```bash
ip route get 8.8.8.8
ip -4 link show dev eth0 | grep mtu
ip -6 route
```

### 역방향 터널(ssh -R)로 외부 공개

```bash
# 내부 서버에서 외부 VPS로 역방향 포트 개방

ssh -N -R 0.0.0.0:8443:127.0.0.1:443 user@vps.example.com
```

### 간단 HTTP 서버(테스트)

```bash
# 파이썬

python3 -m http.server 8080
# 골:
# 라우터 TCP 8080 포워딩 → 외부에서 http://공인IP:8080 접속

```

---

## 체크리스트 — 목표별 빠른 가이드

**서버 공개(IPv4)**
- [ ] 공인 IP 또는 **CGNAT 아님** 확인(모뎀 WAN IP vs 외부에서 보이는 IP 비교)
- [ ] 라우터 **포트 포워딩**, 내부 서버 방화벽 허용
- [ ] DNS 레코드(A) 설정, 필요 시 **동적 DNS**
- [ ] SSL/TLS(ACME/Let’s Encrypt) 적용

**서버 공개(IPv6)**
- [ ] 인터페이스에 글로벌 IPv6 존재 확인(`ip -6 addr`)
- [ ] 라우터/호스트 방화벽 인바운드 허용
- [ ] AAAA 레코드 추가

**보안/운영**
- [ ] 불필요 포트/서비스 비활성화
- [ ] **nftables/SG** 최소 개방 정책
- [ ] 소프트웨어 업데이트/패치
- [ ] 로그/모니터링(Geo/ASN/Rate-limit)
- [ ] 필요 시 **DDoS 보호/Anycast 프록시** 도입

---

## 자주 묻는 질문(FAQ)

**Q1. CGNAT 환경인데 집에서 서버 열 수 있나요?**
A. 직접 포워딩은 어렵습니다. **IPv6 사용**, **역방향 터널/중계 서버**, **클라우드 프록시** 중 택하세요.

**Q2. IPv6를 켜면 더 위험해지나요?**
A. 노출 표면이 넓어질 수 있으므로 **방화벽 기본 거부**와 **필요 포트만 허용**이 중요합니다. NAT가 보안 기능을 대체하지 않습니다.

**Q3. 공인 IP가 자주 바뀝니다.**
A. **동적 DNS** 를 쓰거나, 고정 IP 상품을 신청하세요. 프록시/터널 경유도 대안입니다.

**Q4. 역방향 DNS(PTR)가 왜 필요하죠?**
A. 특히 메일 송신 신뢰(스팸 필터)에 중요합니다. 고정 IP+정상 PTR 설정 권장.

---

## 한 줄 결론

**글로벌 IP** 는 인터넷에서 **직접 식별·접속 가능한 주소**이고, **NAT/CGNAT/IPv6** 는 그 주소 부족과 설계 철학의 변화를 반영합니다.
**방화벽/라우팅/DNS/BGP/RPKI** 까지 시야를 넓히면, 서버 공개·원격 접속·성능·보안을 **체계적으로 설계**할 수 있습니다.
