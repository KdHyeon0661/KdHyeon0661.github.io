---
layout: post
title: TCPIP - HTTP 엔터티
date: 2025-12-08 19:25:23 +0900
category: TCPIP
---
# HTTP 엔터티, 전송, 인코딩 방법 및 콘텐츠 관리

## HTTP 엔터티와 인터넷 미디어 타입
HTTP에서 **엔터티(Entity)** 는 요청이나 응답으로 전송되는 실제 데이터의 표현을 말합니다. 각 엔터티는 **엔터티 헤더(Entity Header)** 필드와 선택적인 **엔터티 본문(Entity Body)** 으로 구성됩니다. 엔터티 헤더는 `Content-Type`, `Content-Length`, `Content-Encoding` 등의 필드를 포함하여 본문 데이터의 특성을 설명합니다.

**인터넷 미디어 타입(Internet Media Types)**, MIME(Multipurpose Internet Mail Extensions) 타입으로도 알려진 이 형식은 엔터티 본문의 데이터 형식을 지정하는 데 사용됩니다. 이는 `type/subtype` 형태로 표현되며, 가장 일반적인 예시로는:
- `text/html` - HTML 문서
- `text/css` - CSS 스타일시트
- `application/json` - JSON 데이터
- `image/jpeg` - JPEG 이미지
- `video/mp4` - MP4 비디오

미디어 타입은 `Content-Type` 헤더를 통해 전달되며, 클라이언트와 서버가 데이터를 올바르게 해석하고 처리할 수 있도록 합니다. 또한 `charset` 매개변수를 포함하여 문자 인코딩을 지정할 수 있습니다(예: `text/html; charset=utf-8`).

## HTTP 데이터 전송, 콘텐츠 인코딩 및 전송 인코딩
HTTP는 다양한 방식으로 데이터를 효율적이고 안전하게 전송하기 위한 메커니즘을 제공합니다. 이는 크게 **콘텐츠 인코딩(Content Encoding)** 과 **전송 인코딩(Transfer Encoding)** 으로 구분됩니다.

**콘텐츠 인코딩**은 엔터티 본문의 압축이나 변환을 의미하며, 주로 데이터 크기를 줄이기 위해 사용됩니다. 이는 엔터티 자체의 표현 형식을 변경합니다. 일반적인 콘텐츠 인코딩 방식으로는:
- `gzip` - GNU zip 압축 (가장 널리 사용됨)
- `deflate` - deflate 압축 알고리즘
- `br` - Brotli 압축 (더 높은 압축률 제공)
- `identity` - 인코딩 없음 (기본값)

콘텐츠 인코딩은 `Content-Encoding` 헤더로 지정되며, 클라이언트는 `Accept-Encoding` 헤더를 통해 지원하는 인코딩 방식을 서버에 알릴 수 있습니다.

**전송 인코딩**은 메시지 전송 과정에서 적용되는 인코딩으로, 메시지 자체의 전송 방식을 지정합니다. `Transfer-Encoding` 헤더로 표시되며, 가장 중요한 예시가 **청크 전송 인코딩(Chunked Transfer Encoding)** 입니다. 이는 데이터를 미리 알 수 없는 경우나 스트리밍 전송에 유용합니다.

## HTTP 데이터 길이 문제, "청크" 전송 및 메시지 트레일러
HTTP 메시지의 본문 길이를 결정하는 방법은 여러 가지가 있습니다:

1. **명시적 콘텐츠 길이**: `Content-Length` 헤더로 정확한 바이트 수 지정
2. **청크 전송 인코딩**: `Transfer-Encoding: chunked`로 청크 단위 분할 전송
3. **연결 종료로 판단**: 지속 연결이 아닌 경우 연결 종료로 메시지 끝을 판단

**청크 전송 인코딩(Chunked Transfer Encoding)** 은 데이터를 일련의 청크(조각)로 분할하여 전송하는 방식입니다. 각 청크는 자신의 크기(16진수)와 데이터로 구성되며, 크기가 0인 청크로 메시지의 끝을 표시합니다. 이 방식의 장점은:
- 전체 데이터 크기를 미리 알 수 없는 경우에도 전송 가능
- 대용량 데이터를 점진적으로 처리 및 표시 가능
- 메모리 사용 효율성 향상

**메시지 트레일러(Message Trailers)** 는 청크 전송 인코딩과 함께 사용될 수 있는 특수한 헤더입니다. 메시지 본문이 전송된 후에 추가 정보를 제공하기 위해 사용되며, `Trailer` 헤더로 어떤 트레일러 헤더가 뒤따를 것인지 미리 알려줍니다. 주로 체크섬, 서명, 처리 상태 등 본문을 완전히 읽은 후에야 계산할 수 있는 메타데이터를 포함하는 데 사용됩니다.

## HTTP 콘텐츠 협상과 "품질 값"
HTTP **콘텐츠 협상(Content Negotiation)** 은 하나의 URL이 여러 가지 표현(representation)을 가질 수 있을 때, 클라이언트와 서버가 가장 적합한 표현을 선택하는 과정입니다. 이는 클라이언트의 언어 선호도, 인코딩 지원, 장치 특성 등에 따라 다른 콘텐츠를 제공할 수 있게 합니다.

콘텐츠 협상의 주요 유형:
1. **서버 주도 협상(Server-driven)**: 클라이언트가 선호 정보를 보내면 서버가 결정
2. **에이전트 주도 협상(Agent-driven)**: 서버가 가능한 옵션을 보내면 클라이언트가 선택
3. **투명 협상(Transparent)**: 중간 프록시가 협상에 참여

협상은 다양한 요청 헤더를 통해 이루어집니다:
- `Accept` - 원하는 미디어 타입
- `Accept-Language` - 선호 언어
- `Accept-Charset` - 선호 문자 집합
- `Accept-Encoding` - 선호 인코딩 방식

**품질 값(Quality Values, q-values)** 은 0.0부터 1.0까지의 소수점 값으로 선호도를 수치화합니다. 값이 높을수록 더 선호됩니다. 예시:
```
Accept-Language: ko-KR, ko;q=0.9, en-US;q=0.8, en;q=0.7
```
이 경우 한국어(대한민국)가 가장 선호되고(기본값 1.0), 한국어 일반(0.9), 미국 영어(0.8), 영어 일반(0.7) 순으로 선호됨을 의미합니다.

서버는 `Vary` 헤더를 응답에 포함시켜, 어떤 요청 헤더에 따라 응답이 달라질 수 있는지 캐시 시스템에 알려줍니다. 예를 들어 `Vary: Accept-Language`는 언어 헤더에 따라 다른 콘텐츠가 반환될 수 있음을 나타냅니다.

## 결론
HTTP의 엔터티 처리 및 콘텐츠 관리 메커니즘은 웹의 유연성과 효율성을 뒷받침하는 핵심 요소입니다. 미디어 타입 시스템은 다양한 형식의 데이터 교환을 표준화하고, 인코딩 메커니즘은 네트워크 대역폭을 효율적으로 사용할 수 있게 합니다.

특히 청크 전송 인코딩은 실시간 스트리밍, 대용량 파일 전송, 동적 콘텐츠 생성 등 현대 웹의 요구사항에 부응하는 중요한 기술로 자리매김했습니다. 이는 서버가 전체 응답 크기를 미리 알지 못해도 전송을 시작할 수 있게 하여, 사용자 경험과 서버 자원 활용도를 동시에 향상시킵니다.

콘텐츠 협상 메커니즘은 글로벌 웹 환경에서 지역화와 접근성을 구현하는 데 필수적입니다. 품질 값 시스템을 통한 정교한 선호도 표현은 다국어・다문화 사용자에게 맞춤형 경험을 제공하는 기반이 됩니다. 이러한 기술들은 단순한 데이터 전송을 넘어, 사용자 중심의 지능형 웹 서비스를 가능하게 하는 HTTP 프로토콜의 진화된 모습을 보여줍니다.

현대 웹 아키텍처에서는 이러한 HTTP 기능들이 RESTful API 설계, 마이크로서비스 통신, 엣지 컴퓨팅 등 다양한 맥락에서 계속해서 중요한 역할을 수행하고 있으며, HTTP/2와 HTTP/3에서도 이러한 기본 개념들은 새로운 구현 방식으로 계승되고 발전되고 있습니다.