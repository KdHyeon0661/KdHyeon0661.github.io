---
layout: post
title: Docker - ì»¨í…Œì´ë„ˆë³„ ë¦¬ì†ŒìŠ¤ ì œí•œ
date: 2025-03-29 19:20:23 +0900
category: Docker
---
# ğŸ§© Docker ì»¨í…Œì´ë„ˆë³„ ë¦¬ì†ŒìŠ¤ ì œí•œ (CPU, Memory, blkio)

---

## ğŸ“Œ ì™œ ë¦¬ì†ŒìŠ¤ ì œí•œì´ ì¤‘ìš”í•œê°€?

| ìƒí™© | ë¬¸ì œ |
|------|------|
| ë¬´ì œí•œ ì‹¤í–‰ | í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆê°€ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë…ì  |
| ê³¼ë„í•œ ë©”ëª¨ë¦¬ ì‚¬ìš© | OOM-Killerì— ì˜í•´ ì»¨í…Œì´ë„ˆ í˜¹ì€ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ |
| IO í­ì£¼ | ëŠë ¤ì§„ ë””ìŠ¤í¬ë¡œ ì „ì²´ ì„œë¹„ìŠ¤ ì§€ì—° ë°œìƒ |
| ê³µìœ  í˜¸ìŠ¤íŠ¸ | ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ ê°„ì˜ ë¦¬ì†ŒìŠ¤ ì¶©ëŒ |

â†’ **ë¦¬ì†ŒìŠ¤ ì œí•œì€ ìš´ì˜ í™˜ê²½ì—ì„œ í•„ìˆ˜ì **

---

## ğŸ§  í•µì‹¬ ê°œë… ìš”ì•½

| ìì› | ì„¤ì • ì˜µì…˜ | ë‹¨ìœ„ |
|------|------------|-------|
| CPU | `--cpus`, `--cpu-shares`, `--cpuset-cpus` | ë…¼ë¦¬ CPU, ìƒëŒ€ ë¹„ìœ¨ |
| ë©”ëª¨ë¦¬ | `--memory`, `--memory-swap` | MB, GB |
| ë””ìŠ¤í¬ I/O | `--device-read-bps`, `--device-write-bps` | bytes/sec |
| ë¸”ë¡ IO | `--blkio-weight` | 10~1000 (ê¸°ë³¸ 500) |

---

## ğŸ–¥ï¸ 1. CPU ì œí•œ ì˜µì…˜

### âœ… 1-1. `--cpus`

- ì‚¬ìš© ê°€ëŠ¥í•œ CPU ê°œìˆ˜ ì œí•œ

```bash
docker run --cpus="1.5" ubuntu
```

â†’ ì´ 1.5ê°œ ë…¼ë¦¬ CPUë§Œ ì‚¬ìš© ê°€ëŠ¥

---

### âœ… 1-2. `--cpu-shares` (ìƒëŒ€ì  ë¹„ìœ¨)

- ê¸°ë³¸ê°’ì€ 1024
- ìƒëŒ€ì ì¸ ê°€ì¤‘ì¹˜ë¡œ CPU ì‚¬ìš©ëŸ‰ì„ ì¡°ì ˆ  
  (CPU idle ìƒíƒœì—ì„œëŠ” ì œí•œ ì—†ìŒ)

```bash
docker run --cpu-shares=512 myapp
```

â†’ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆë³´ë‹¤ ë‚®ì€ ìš°ì„ ìˆœìœ„

---

### âœ… 1-3. `--cpuset-cpus`

- íŠ¹ì • CPUì—ë§Œ ë°”ì¸ë”©

```bash
docker run --cpuset-cpus="0,1" ubuntu
```

â†’ 0ë²ˆê³¼ 1ë²ˆ CPUë§Œ ì‚¬ìš©

---

## ğŸ’¾ 2. ë©”ëª¨ë¦¬ ì œí•œ ì˜µì…˜

### âœ… 2-1. `--memory`

- ìµœëŒ€ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ì§€ì •

```bash
docker run --memory="512m" myapp
```

â†’ 512MBë¥¼ ì´ˆê³¼í•˜ë©´ OOM(Out-Of-Memory) ë°œìƒ

---

### âœ… 2-2. `--memory-swap`

- ë©”ëª¨ë¦¬ + ìŠ¤ì™‘ ì˜ì—­ì„ í•©ì¹œ ì´ëŸ‰ ì œí•œ

```bash
docker run --memory="512m" --memory-swap="1g" myapp
```

â†’ ì‹¤ì œ RAMì€ 512MB, swap í¬í•¨ ìµœëŒ€ 1GB ì‚¬ìš© ê°€ëŠ¥

- `--memory-swap = --memory`: ìŠ¤ì™‘ í—ˆìš© ì•ˆí•¨ (í•˜ë“œ ì œí•œ)
- `--memory-swap = -1`: ë¬´ì œí•œ ìŠ¤ì™‘ í—ˆìš©

---

### âœ… 2-3. `--oom-kill-disable`

- OOM ë°œìƒ ì‹œ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ë§‰ê¸° (ë¹„ì¶”ì²œ)

```bash
docker run --memory=256m --oom-kill-disable myapp
```

â†’ ì‹œìŠ¤í…œ ì „ì²´ê°€ ìœ„í—˜í•´ì§ˆ ìˆ˜ ìˆìŒ

---

## ğŸ§® 3. ë””ìŠ¤í¬ I/O ì œí•œ (blkio)

### âœ… 3-1. `--blkio-weight`

- I/O ë¹„ìœ¨ ì¡°ì • (ê¸°ë³¸ê°’ 500, ë²”ìœ„ 10~1000)

```bash
docker run --blkio-weight=300 myapp
```

â†’ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆ ëŒ€ë¹„ ë””ìŠ¤í¬ ì‚¬ìš© ìš°ì„ ìˆœìœ„ ë‚®ìŒ

---

### âœ… 3-2. `--device-read-bps` / `--device-write-bps`

- ì¥ì¹˜ ë‹¨ìœ„ë¡œ ì´ˆë‹¹ I/O ì†ë„ ì œí•œ

```bash
docker run \
  --device-read-bps /dev/sda:1mb \
  --device-write-bps /dev/sda:512kb \
  myapp
```

> ì‹¤ì œ ë””ë°”ì´ìŠ¤ ì´ë¦„ì€ `lsblk` ë˜ëŠ” `df`ë¡œ í™•ì¸ ê°€ëŠ¥

---

## ğŸ§ª 4. ë¦¬ì†ŒìŠ¤ ì œí•œ ì¢…í•© ì˜ˆì‹œ

```bash
docker run -d \
  --name app1 \
  --cpus="1.0" \
  --memory="1g" \
  --memory-swap="1.5g" \
  --blkio-weight=200 \
  --device-read-bps /dev/sda:2mb \
  --device-write-bps /dev/sda:1mb \
  myapp:latest
```

---

## ğŸ” 5. ì‹¤í–‰ ì¤‘ ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ í™•ì¸

```bash
docker stats
```

ì¶œë ¥ ì˜ˆì‹œ:

```
CONTAINER ID   NAME   CPU %   MEM USAGE / LIMIT   NET I/O   BLOCK I/O
a12b34c        app1   4.32%   512MiB / 1GiB       10MB/9MB   50MB/40MB
```

---

## âš ï¸ 6. ì£¼ì˜ì‚¬í•­

| ì£¼ì˜ì  | ì„¤ëª… |
|--------|------|
| swap ì œí•œ | swapì„ ë„ˆë¬´ í¬ê²Œ ë‘ë©´ ì„±ëŠ¥ ì €í•˜ |
| blkio ë””ë°”ì´ìŠ¤ ì§€ì • | ë¬¼ë¦¬ ë””ìŠ¤í¬ ê²½ë¡œ í•„ìš” (`/dev/sda`) |
| `cpu-shares`ëŠ” idle ì‹œ ë¬´íš¨ | ë¹„ìœ¨ì€ ìœ íœ´ ìƒíƒœì—ì„œ ì˜ë¯¸ ì—†ìŒ |
| `--cpus`ëŠ” ë©€í‹° í”Œë«í¼ì—ì„œ ì¶”ì²œ | ì •í™•í•˜ê³  ì§ê´€ì ì„ |

---

## ğŸ“š ì°¸ê³  ë§í¬

- [Docker ê³µì‹ ë¦¬ì†ŒìŠ¤ ì œí•œ ë¬¸ì„œ](https://docs.docker.com/config/containers/resource_constraints/)
- [ë¦¬ëˆ…ìŠ¤ cgroups ê°œë…](https://man7.org/linux/man-pages/man7/cgroups.7.html)
- `docker stats`, `docker inspect` í™œìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì‚¬ìš© ë¶„ì„

---

## âœ… ìš”ì•½

| ìì› | ì œí•œ ì˜µì…˜ | ì„¤ëª… |
|------|------------|------|
| CPU | `--cpus`, `--cpu-shares`, `--cpuset-cpus` | ì‚¬ìš©ëŸ‰ ë° ê°€ì¤‘ì¹˜ ì„¤ì • |
| Memory | `--memory`, `--memory-swap` | ìµœëŒ€ ë©”ëª¨ë¦¬/ìŠ¤ì™‘ ì œí•œ |
| I/O | `--blkio-weight`, `--device-read-bps` | ë””ìŠ¤í¬ ìš°ì„ ìˆœìœ„ ë° ì†ë„ ì œí•œ |

â†’ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ ì„¤ì •í•˜ì—¬ **ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´**