---
layout: post
title: AspNet - ê¸€ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬
date: 2025-04-10 22:20:23 +0900
category: AspNet
---
# ğŸ› ï¸ ASP.NET Core ê¸€ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬ ì™„ì „ ê°€ì´ë“œ

---

## âœ… 1. ì™œ ì˜ˆì™¸ ì²˜ë¦¬ ë¯¸ë“¤ì›¨ì–´ê°€ í•„ìš”í•œê°€?

- ì›¹ ì•±ì—ì„œ **ì˜ˆì™¸(Exception)**ëŠ” ì–¸ì œë“  ë°œìƒí•  ìˆ˜ ìˆìŒ
- ê° ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ try-catchë¥¼ ë°˜ë³µí•˜ëŠ” ê±´ **ë¹„íš¨ìœ¨ì **
- ì˜ˆì™¸ë¥¼ **ê¸€ë¡œë²Œí•˜ê²Œ ì²˜ë¦¬**í•˜ê³ , í™˜ê²½ì— ë”°ë¼ **ë‹¤ë¥´ê²Œ ì‘ë‹µ**í•˜ê¸° ìœ„í•´
  â†’ **ë¯¸ë“¤ì›¨ì–´ ê¸°ë°˜ ì˜ˆì™¸ ì²˜ë¦¬**ë¥¼ ì‚¬ìš©í•¨

---

## ğŸ§± 2. ê¸°ë³¸ êµ¬ì„± ìš”ì•½

| ë¯¸ë“¤ì›¨ì–´ | ì„¤ëª… |
|----------|------|
| `UseDeveloperExceptionPage()` | ê°œë°œí™˜ê²½ì—ì„œ **ì˜ˆì™¸ ìƒì„¸ ì •ë³´ í‘œì‹œ** |
| `UseExceptionHandler("/Error")` | ìš´ì˜í™˜ê²½ì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ **ì§€ì • í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸** |
| `app.UseStatusCodePages()` | 404, 403 ê°™ì€ **HTTP ìƒíƒœ ì½”ë“œ ì˜¤ë¥˜ í˜ì´ì§€** í‘œì‹œ |

---

## ğŸŒ 3. ì˜ˆì™¸ ì²˜ë¦¬ íë¦„ êµ¬ì¡° (Program.cs)

```csharp
if (app.Environment.IsDevelopment())
{
    app.UseDeveloperExceptionPage();  // ìƒì„¸ ì˜ˆì™¸ í˜ì´ì§€
}
else
{
    app.UseExceptionHandler("/Error"); // ì‚¬ìš©ì ì¹œí™”ì  ì˜¤ë¥˜ í˜ì´ì§€
    app.UseHsts(); // HTTPS ë³´ì•ˆ ê°•í™”
}
```

---

## ğŸ§ª 4. `UseDeveloperExceptionPage()` (ê°œë°œìš©)

- **ê°œë°œ í™˜ê²½**ì—ì„œë§Œ ì‚¬ìš©
- ë¸Œë¼ìš°ì €ì— **ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤, ì˜ˆì™¸ ë‚´ìš©, ìš”ì²­ ì •ë³´** ë“±ì„ í‘œì‹œ
- ë¹ ë¥´ê²Œ ë””ë²„ê¹… ê°€ëŠ¥

```csharp
app.UseDeveloperExceptionPage();
```

> ë³´ì•ˆìƒ ì´ìœ ë¡œ **Productionì—ì„œëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ**

---

## ğŸš§ 5. `UseExceptionHandler("/Error")` (ìš´ì˜ìš©)

- ì˜ˆì™¸ ë°œìƒ ì‹œ, ì§€ì •í•œ ê²½ë¡œ(ì˜ˆ: `/Error`)ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
- **ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ í˜ì´ì§€**ë¡œ ì‘ë‹µ

```csharp
app.UseExceptionHandler("/Error");
```

### ğŸ”¹ ì˜ˆì‹œ: `/Error` í˜ì´ì§€ êµ¬ì„± (Razor Pages)

`Pages/Error.cshtml`:

```html
@page
@model ErrorModel
<h1>ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</h1>
<p>ì£„ì†¡í•©ë‹ˆë‹¤. ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
```

`Error.cshtml.cs`:

```csharp
public class ErrorModel : PageModel
{
    public void OnGet()
    {
        // í•„ìš” ì‹œ ë¡œê¹… ë“± ê°€ëŠ¥
    }
}
```

---

## ğŸ›‘ 6. ì˜ˆì™¸ í•¸ë“¤ë§ ìƒì„¸ ì„¤ì •

ì›í•œë‹¤ë©´ ì˜ˆì™¸ ì •ë³´ë¥¼ ê°€ì ¸ì™€ **ë¡œê¹…í•˜ê±°ë‚˜ ì»¤ìŠ¤í…€ ì²˜ë¦¬**ë„ ê°€ëŠ¥:

```csharp
app.UseExceptionHandler(errorApp =>
{
    errorApp.Run(async context =>
    {
        var exceptionHandlerPathFeature = context.Features.Get<IExceptionHandlerPathFeature>();
        var error = exceptionHandlerPathFeature?.Error;

        var path = exceptionHandlerPathFeature?.Path;
        Console.WriteLine($"âŒ ì˜ˆì™¸ ë°œìƒ ê²½ë¡œ: {path}");
        Console.WriteLine($"ğŸ“‹ ì˜ˆì™¸ ë©”ì‹œì§€: {error?.Message}");

        context.Response.StatusCode = 500;
        await context.Response.WriteAsync("ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
});
```

---

## ğŸ“„ 7. ìƒíƒœ ì½”ë“œ ì˜¤ë¥˜ ì²˜ë¦¬ (`UseStatusCodePages()`)

```csharp
app.UseStatusCodePages(); // 404, 403 ë“± ìƒíƒœì½”ë“œ ë°œìƒ ì‹œ ê°„ë‹¨í•œ ë©”ì‹œì§€ ì¶œë ¥
```

ë˜ëŠ” íŠ¹ì • í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ë„ ê°€ëŠ¥:

```csharp
app.UseStatusCodePagesWithRedirects("/StatusCode/{0}");
```

`/StatusCode/404`, `/StatusCode/403` ë“±ì„ êµ¬ì„±í•´ì„œ ì‚¬ìš©ì ì •ì˜ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŒ.

---

## ğŸ” 8. ì˜ˆì™¸ ì²˜ë¦¬ ì‹œ ì£¼ì˜ì‚¬í•­

| í•­ëª© | ì„¤ëª… |
|------|------|
| `UseExceptionHandler`ëŠ” ë°˜ë“œì‹œ **ìµœìƒë‹¨ì— ê°€ê¹Œì´ ë°°ì¹˜** |
| ì˜ˆì™¸ ì²˜ë¦¬ í›„ì—ë„ `await _next(context)` í˜¸ì¶œí•˜ì§€ ì•ŠìŒ (íŒŒì´í”„ë¼ì¸ ì¢…ë£Œ) |
| ì‘ë‹µì´ ì´ë¯¸ ì‹œì‘ëœ ê²½ìš°ì—” ì˜ˆì™¸ í˜ì´ì§€ê°€ ì ìš©ë˜ì§€ ì•ŠìŒ |

---

## âœ… 9. ìš”ì•½ ì •ë¦¬

| í™˜ê²½ | ì˜ˆì™¸ ì²˜ë¦¬ ë°©ë²• |
|------|----------------|
| ê°œë°œ (`Development`) | `UseDeveloperExceptionPage()` |
| ìš´ì˜ (`Production`) | `UseExceptionHandler("/Error")` |
| ëª¨ë“  í™˜ê²½ | `UseStatusCodePages()`ë¡œ HTTP ì˜¤ë¥˜ ì²˜ë¦¬ ê°€ëŠ¥ |

---

## ğŸ“¦ 10. ì¶”ì²œ í™•ì¥ ì˜ˆì œ

- ğŸ“Œ ì˜ˆì™¸ ë¡œê¹… ì¶”ê°€ (`ILogger` ë˜ëŠ” Serilog)
- ğŸ“Œ JSON ì‘ë‹µ ê¸°ë°˜ API ì˜¤ë¥˜ ì²˜ë¦¬ (`UseExceptionHandler` ì»¤ìŠ¤í„°ë§ˆì´ì§•)
- ğŸ“Œ ê³µí†µ ì˜¤ë¥˜ View + Layout ì ìš©
- ğŸ“Œ Exception Filter / ProblemDetails ì—°ë™