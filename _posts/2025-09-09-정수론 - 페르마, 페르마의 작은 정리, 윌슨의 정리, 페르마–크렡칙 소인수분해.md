---
layout: post
title: 정수론 - 페르마, 페르마의 작은 정리, 윌슨의 정리, 페르마–크렡칙 소인수분해
date: 2025-09-09 19:25:23 +0900
category: 정수론
---
# 페르마, 페르마의 작은 정리(유사소수 포함), 윌슨의 정리, 페르마–크렡칙 소인수분해

> **작성 원칙**
> - 예제는 **적게** 두되 **아주 자세히** 설명한다.
> - 가능한 곳에 **증명**(또는 엄밀한 증명 스케치)을 포함한다.
> - 모든 수식은 $$\dots$$ 로 표기한다.
> - 표기: 정수 전역에서 $$p$$ 는 소수, $$n,m,a,b$$ 는 정수(필요 시 양의 정수), $$\varphi(\cdot)$$ 는 오일러 피 함수.

---

## — 맥락과 두 개의 “페르마 정리”

- **페르마의 작은 정리(Fermat’s little theorem)**: 소수 $$p$$ 와 $$p\nmid a$$ 에 대해
  $$
  a^{p-1}\equiv 1 \pmod p.
  $$
  일반형으로 $$a^p\equiv a\pmod p$$ 도 자주 쓴다.
- **페르마–크렡칙(Fermat–Kraitchik) 소인수분해**: 정수 $$N$$ 을 **두 제곱의 차** 형태
  $$
  N=x^2-y^2=(x-y)(x+y)
  $$
  로 만들어 인수를 얻는 기법. 페르마의 고전적 아이디어(연속 제곱 시도)에서 출발, 크렡칙(Kraitchik)이 “합동된 제곱(congruent squares)”을 체계화했다(현대의 **Quadratic Sieve** 류로 이어짐).

> 본 문서는 이 둘을 중심으로 **유사소수(pseudoprime)**, **윌슨의 정리**까지 연결한다.

---

## 페르마의 작은 정리(FLT)

### 진술

- **정리(FLT, 표준형)**: $$p$$ 가 소수이고 $$p\nmid a$$ 이면
  $$
  a^{p-1}\equiv 1\pmod p.
  $$
- **동치 진술**: 모든 정수 $$a$$ 에 대해
  $$
  a^p\equiv a\pmod p.
  $$

### 증명 A — 군론(가장 간결)

$$\mathbb{Z}/p\mathbb{Z}$$ 의 비영 원소들은 곱셈에 대해 **군**을 이룬다(원소 수 $$p-1$$). 라그랑주 정리에 의해 임의의 원소의 위수는 군의 크수를 나눈다. 따라서
$$
(a \bmod p)^{p-1}=1 \quad (\text{단 } a\not\equiv 0\pmod p).
$$
즉 $$a^{p-1}\equiv 1\pmod p$$. 또한 임의의 $$a$$ 에 대해
$$
a^p\equiv a\pmod p
$$
은 $$a\equiv 0$$ 인 경우 자명, 그렇지 않으면 위 결과에 $$a$$ 를 곱하면 된다. □

### 증명 B — 가우스의 잔여 재배열(초등적)

서로소 잔여계 $$\{1,2,\dots,p-1\}$$ 를 $$a$$ 배만큼 곱해 얻는 집합
$$
\{a\cdot 1,\ a\cdot 2,\ \dots,\ a\cdot (p-1)\}\pmod p
$$
은( $$\gcd(a,p)=1$$ 이므로) **서로 다른** 잔여들의 재배열이다. 곱을 비교하면
$$
a^{p-1}\cdot (p-1)! \equiv (p-1)! \pmod p.
$$
$$p$$ 는 소수이므로 $$(p-1)!$$ 가 $$p$$ 의 배수가 아니다(곱의 각 인자가 1,…,p−1로 모두 서로소). 따라서 양변을 소거하여 $$a^{p-1}\equiv 1\pmod p$$. □

### 예제(적게, 하지만 자세히)

- **예제 1(직접 검산)**: $$p=13,\ a=5$$.
  $$
  5^{12}\equiv 1\pmod{13}
  $$
  를 빠른 거듭제곱으로 확인해 보자.
  $$
  5^2=25\equiv -1,\quad 5^4\equiv (-1)^2=1,\quad 5^8\equiv 1,\quad 5^{12}=5^8\cdot 5^4\equiv 1\cdot 1\equiv 1.
  $$

- **예제 2(동치형)**: 임의의 정수 $$a$$ 에 대해 $$a^{13}\equiv a\ (\bmod 13)$$.
  $$a\equiv 0$$ 인 경우 제외하고는 예제 1과 동일하며, $$a\equiv 0$$ 이면 좌우 모두 0.

---

## 유사소수(pseudoprime)와 카마이클 수(Carmichael number)

### 페르마 유사소수(기본)

**정의.** 합성수 $$n$$ 이 어떤 밑 $$a$$ ( $$\gcd(a,n)=1$$ )에 대해
$$
a^{n-1}\equiv 1\pmod n
$$
을 만족하면, $$n$$ 을 **밑 $$a$$ 에 대한 페르마 유사소수**라 한다. (Fermat pseudoprime to base $$a$$)

> FLT는 “소수라면 항상 성립”이지만, **역은 거짓**: 합성수 중에도 저 합동을 만족하는 값이 존재(유사소수).

- **대표 예**: $$n=341=11\cdot 31$$ 은 밑 $$a=2$$ 에 대해
  $$
  2^{340}\equiv 1\pmod{341}.
  $$
  실제로 $$2^{5}=32\equiv 32-31=1\ (\bmod 31)$$ 와 지수분해/중국인의 나머지 정리로 확인한다(아래 스케치).
  - 모듈러 분해:
    $$2^{340}\equiv 1\ (\bmod 31)$$ (왜냐하면 $$\varphi(31)=30,\ 340\equiv 10 \pmod{30}$$ 이어도 추가 확인 필요하나 실제 계산상 1),
    $$2^{340}\equiv 1\ (\bmod 11)$$ (유사 확인).
    두 합동을 CRT로 합치면 $$\bmod 341$$ 에서도 1.

> 한 밑에서만 속일 수 있음 ⇒ **“밑을 바꾸어 재시험”** 이 필요. 실무에서는 **Miller–Rabin(강한 유사소수)** 같은 확률적 검정으로 개선.

### 카마이클 수(Carmichael number)

**정의.** 합성수 $$n$$ 이 **모든** $$a$$ (단, $$\gcd(a,n)=1$$)에 대해
$$
a^{n-1}\equiv 1\pmod n
$$
이면 **카마이클 수**라 부른다. 가장 작은 예는 $$561=3\cdot 187=3\cdot 11\cdot 17$$.

- **Korselt의 조건(필요충분)**: 정수 $$n>1$$ 이 카마이클 수일 필요충분조건은
  (i) $$n$$ 이 제곱인수를 갖지 않는 square-free,
  (ii) 모든 소인수 $$p\mid n$$ 에 대해 $$p-1\mid n-1$$.
  (증명 스케치) ⇒ 방향은 CRT와 FLT 조합으로, ⇐ 방향은 위 조건으로 각 모듈러 $$p$$ 에서 1이 되어 CRT로 통합.

> **의의**: 단순한 페르마 검정은 **카마이클 수**에서 완전히 실패. 따라서 실제 소수판정은 **여러 밑** 또는 **강한 조건(Miller–Rabin/Proth/AKS 등)** 을 사용.

---

## 윌슨의 정리(Wilson’s theorem)

### 진술

- **정리(윌슨)**: 정수 $$n\ge 2$$ 에 대해
  $$
  (n-1)! \equiv -1 \pmod n
  $$
  이면 그리고 오직 그 때에만 $$n$$ 은 소수이다.

### 증명

- **(⇒) 소수이면 합동 성립**: $$p$$ 가 소수. 집합 $$\{1,2,\dots,p-1\}$$ 의 원소들은 각자 **역원**을 갖는다. 역원이 자기 자신인 원소는 $$x^2\equiv 1\ (\bmod p)$$ 의 해, 즉 $$x\equiv \pm 1$$ 뿐이다. 따라서 곱
  $$
  (p-1)! \equiv (+1)\cdot(-1)\cdot \prod_{\substack{x=2\\ x\ne p-1}}^{p-2} x\cdot x^{-1} \equiv -1 \pmod p.
  $$
- **(⇐) 합성수이면 합동 불성립**: $$n$$ 합성.
  ① 만약 $$n$$ 이 서로 다른 두 소수의 곱 등으로 **square-free** 라 해도, 어떤 약수 $$d\ (1<d<n)$$ 가 존재하고, $$(n-1)!$$ 는 $$d$$ 를 포함하므로 $$\gcd((n-1)!,n)\ne 1$$. 동시에 $$(n-1)!\equiv -1\ (\bmod n)$$ 라면 좌변과 $$n$$ 의 최대공약수가 1이어야 하므로 모순.
  ② $$n$$ 에 제곱인수가 있으면 더 강하게 모순(세부 전개 가능).
  결론적으로 합성수는 윌슨 합동을 만족하지 않는다. □

### 예제(짧고 자세히)

- **예제**: $$p=11$$.
  $$
  10!\equiv -1\pmod{11}\ ?
  $$
  역원 쌍을 짝지어 보자.
  $$
  2\cdot 6\equiv 1,\quad 3\cdot 4\equiv 1,\quad 5\cdot 9\equiv 1,\quad 7\cdot 8\equiv 1\pmod{11},
  $$
  그리고 $$1,10(=-1)$$ 이 남는다. 따라서
  $$
  10!\equiv 1\cdot(-1)\cdot 1\cdot 1\cdot 1\cdot 1 \equiv -1\pmod{11}.
  $$

> **실전성**: 윌슨 판정은 **정확**하지만 $$(n-1)!$$ 계산이 매우 무거워 **실용적 소수판정**에는 부적합. 이 점에서 FLT 기반 확률적 검정이 더 효율적이다.

---

## 페르마–크렡칙 소인수분해(Fermat–Kraitchik Factorization)

핵심은 **합동된 제곱(congruent squares)** 을 찾아
$$
x^2 \equiv y^2 \pmod N \quad \Rightarrow\quad N \mid (x-y)(x+y)
$$
에서 **비자명 인수**를 얻는 것. 가장 단순형은 **페르마의 방법**(연속 제곱 차), 크렡칙은 이를 “여러 개의 약소 인수 분해값을 모아 제곱으로 만드는” 방향으로 일반화(현대 체 방법의 원형).

### 페르마의 방법(Fermat’s method)

- **아이디어**: 홀수 $$N$$ 에 대해
  $$
  N = x^2 - y^2 = (x-y)(x+y).
  $$
  $$x=\lceil \sqrt{N}\rceil,\ \lceil \sqrt{N}\rceil+1,\dots$$ 를 올려 가며 $$x^2-N$$ 이 **완전제곱** $$y^2$$ 이 되는 순간을 찾으면 끝.

- **복잡도 감각**: 인수들이 **가까울수록**(즉 $$N=pq$$ 에서 $$p\approx q$$) 매우 빠르다. 반대로 인수 차이가 크면 느리다.

#### — $$N=8051$$ 분해

1) $$\sqrt{8051}\approx 89.72$$ 이므로 $$x_0=90$$.
2) $$x_0^2 - N = 90^2 - 8051 = 8100-8051=49=7^2$$ → 바로 성공!
3) 따라서
   $$
   N=(x-y)(x+y)=(90-7)(90+7)=83\cdot 97.
   $$
4) **검증**: $$83\cdot 97=8051$$.

> 이 예시는 페르마 방법이 “인수들이 가깝다”는 이상적 상황에서 얼마나 빠른지 보여준다(첫 시도에 성공).

### 크렡칙의 아이디어(Kraitchik; 합동 제곱 만들기)

- **요지**: 작은 소수들의 곱으로 **준분해**를 만들며,
  $$
  x_i^2 \equiv \prod p_j^{e_{i,j}} \pmod N
  $$
  들을 **여러 개** 모아 **지수들의 합을 모두 짝수**로 만드는 조합(선형대수 mod 2)으로 **제곱 합동**을 만든다.
- **절차(개념)**:
  1) $$x=\lceil\sqrt{N}\rceil,\lceil\sqrt{N}\rceil+1,\dots$$ 에 대해 $$x^2\bmod N$$ 을 **작은 소수들**로 나누어 보고 “부드럽게( smooth )” 분해될 때를 기록.
  2) 적당히 많은 관계를 모으면(변수 수 > 소수 기반의 차원) **선형 종속**이 생겨 지수 벡터 합이 짝수가 되는 부분집합을 얻는다.
  3) 해당 부분집합들의 곱을 취해
     $$
     X^2 \equiv Y^2 \pmod N
     $$
     을 구성.
  4) $$\gcd(X\pm Y, N)$$ 로 비자명 인수를 구한다.
- **현대화**: 이 철학이 **Quadratic Sieve**, 더 나아가 **Number Field Sieve** 의 뼈대.

> 크렡칙 방식은 “언젠가” 제곱 합동을 찾게 해주지만, 구현 세부(부드러운 기준, 소인수분해, 선형대수)와 파라미터 설정이 성능을 좌우한다.

---

## FLT·윌슨·유사소수·분해의 상호작용 — 실전 관점 메모

1) **소수 판정**:
   - **FLT 단일 밑**: 빠르지만 유사소수/카마이클에 취약.
   - **여러 밑의 Fermat** 또는 **Miller–Rabin**: 실무 표준(확률적 오판정 확률을 지수적으로 낮춤).
   - **윌슨**: 정확하지만 비실용적(팩토리얼 비용).
2) **분해**:
   - 페르마 방법: **근접한 두 인수**에 매우 강력.
   - 크렡칙/Quadratic Sieve: 중형 정수(수백 비트)에서 실전적.
   - NFS: 아주 큰 정수.
3) **CRT**: 유사소수/분해에서 모듈러 조건을 묶는 데 필수(예: $$a^{n-1}\equiv 1\pmod{pq}$$ 를 $$\bmod p,\bmod q$$ 로 쪼갰다 다시 합치는 과정).

---

## 추가 예제 두 개(아주 제한적으로, 자세히)

### 유사소수 점검 — $$n=341=11\cdot 31$$, 밑 $$a=2$$

- 목표: $$2^{340}\equiv 1\ (\bmod 341)$$ 을 “분해-재조합”으로 확인.
- **모듈러 11**: $$\varphi(11)=10,\ 340\equiv 0\pmod{10}$$ 이므로
  $$
  2^{340}\equiv (2^{10})^{34}\equiv 1^{34}\equiv 1\pmod{11}.
  $$
- **모듈러 31**: $$\varphi(31)=30,\ 340\equiv 10\pmod{30}$$ 이라 즉시 1은 아니므로 더 본다.
  $$
  2^5=32\equiv 1\pmod{31}\ \Rightarrow\ 2^{10}\equiv 1,\ 2^{340}=(2^{10})^{34}\equiv 1.
  $$
- **CRT로 결론**: 양쪽에서 1이므로 $$\bmod 341$$ 에서도 1.
  ⇒ **341은 밑 2에 대한 페르마 유사소수**(하지만 합성수).

> 이 예는 “**단일 밑 FLT 검정이 위험**”함을 정교하게 보여준다.

### 페르마 분해 — $$N=10403$$

- $$\sqrt{10403}\approx 101.999\Rightarrow x_0=102$$.
- $$x_0^2-N=10404-10403=1=1^2$$ → 즉시 성공.
- $$
  10403=(102-1)(102+1)=101\cdot 103.
  $$

> 두 예제 모두 “인수들이 가깝다”는 조건을 반영했다. 멀리 떨어진 경우에는 시도가 더 필요할 수 있다.

---

## 부록: 유용한 파생 정리·관계식(증명 스케치 포함)

### 오일러의 정리(Euler)

**정리.** $$\gcd(a,n)=1$$ 이면
$$
a^{\varphi(n)}\equiv 1\pmod n.
$$
**증명 스케치**: $$\bmod n$$ 의 단위군 $$(\mathbb{Z}/n\mathbb{Z})^\times$$ 의 크기가 $$\varphi(n)$$ 이므로 라그랑주 정리로 즉시.

> FLT는 $$n=p$$ 일 때의 특수한 경우.

### 페르마–윌슨 간의 상호 참조

- 윌슨에서의 “역원 짝짓기” 아이디어는 FLT의 **가우스 재배열 증명**과 맥락을 공유.
- $$p=2$$ 인 경우 윌슨식은 $$1!\equiv -1\ (\bmod 2)$$ → $$1\equiv 1$$, 자명.

---

## 요약

- **FLT**: $$p\nmid a \Rightarrow a^{p-1}\equiv 1\ (\bmod p)$$. 군론/재배열로 증명 가능.
- **유사소수**: 합성수 중에도 $$a^{n-1}\equiv 1\ (\bmod n)$$ 을 만족하는 값 존재. **카마이클 수**는 모든 밑에 대해 성립(단, 서로소). ⇒ FLT 단일 밑 검정은 **불충분**.
- **윌슨**: $$(n-1)!\equiv -1\ (\bmod n)\ \Leftrightarrow\ n\ \text{소수}$$. 이론적으로 정확하지만 계산량이 커 실전에 부적합.
- **페르마–크렡칙 분해**: $$N=x^2-y^2$$ 를 찾는 것이 핵심. 인수들이 **가까울수록** 빠르며, 크렡칙의 일반화는 현대 체 방법으로 이어짐.

> 이 네 축을 연결하면 **소수 판정 ↔ 분해 ↔ 모듈러 연산**의 기본 지형을 한눈에 잡을 수 있다. 실무에서는 Miller–Rabin(강한 유사소수), Pollard-ρ, Quadratic/Number Field Sieve 등이 이 사상 위에서 동작한다.
