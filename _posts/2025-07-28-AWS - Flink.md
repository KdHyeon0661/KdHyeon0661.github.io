---
layout: post
title: AWS - Flink
date: 2025-07-28 21:20:23 +0900
category: AWS
---
# 📘 Flink 애플리케이션 고급 처리

## 🌀 1. Apache Flink란?

Apache Flink는 실시간 스트림 데이터 처리에 최적화된 **분산형 스트리밍 데이터 처리 엔진**입니다.

### 주요 특징
- **Event Time 기반 처리**: 실제 이벤트 발생 시간을 기준으로 처리 가능.
- **Exactly-once 보장**: 정확히 한 번의 처리 보장.
- **상태 기반 처리(Stateful)**: 스트림 내 상태를 유지하며 복잡한 계산 가능.
- **고급 윈도우(Windowing)** 지원: 시간/카운트 기반 윈도우를 통한 집계 처리.
- **복구(Checkpointing & Savepoint)**: 장애 복구를 위한 내결함성.

---

## ☁️ 2. AWS에서 Flink: Kinesis Data Analytics for Apache Flink

AWS는 Flink를 기반으로 한 **Kinesis Data Analytics for Apache Flink** 서비스를 제공합니다. 이를 통해 사용자는 클러스터 설정 없이 Flink 애플리케이션을 실행할 수 있습니다.

### 사용 목적
- 스트리밍 ETL
- 실시간 대시보드 분석
- 이상 탐지, 실시간 경고 시스템
- 실시간 머신러닝 전처리

---

## 🧠 3. 고급 데이터 처리 기능

### 1️⃣ 상태 기반(Stateful) 연산

Flink는 상태를 기반으로 한 연산을 수행하여 복잡한 처리를 구현할 수 있습니다.

```java
ValueState<Integer> sum;

public void flatMap(Event event, Collector<Integer> out) {
    Integer currentSum = sum.value();
    sum.update(currentSum + event.getValue());
    out.collect(currentSum);
}
```

- `KeyedStream`에서 상태를 관리하며 사용자별 누적 처리, 감지 등을 구현 가능.

---

### 2️⃣ 시간 처리(Time Characteristic)

Flink는 세 가지 시간 처리 방식을 지원합니다.

| 유형         | 설명                                      |
|--------------|-------------------------------------------|
| Processing Time | 데이터가 처리되는 시스템 시간 기준 |
| Event Time      | 이벤트가 실제 발생한 시간 기준       |
| Ingestion Time  | 스트림이 시스템에 유입된 시간 기준   |

```java
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);
```

---

### 3️⃣ 윈도우(Window) 처리

시간 단위나 개수 단위로 데이터를 집계할 수 있는 윈도우를 제공합니다.

```java
stream
  .keyBy(value -> value.getKey())
  .window(TumblingEventTimeWindows.of(Time.minutes(1)))
  .reduce(new SumReducer());
```

- **Tumbling**: 고정 길이
- **Sliding**: 중첩 가능
- **Session**: 유휴 간격 기반

---

### 4️⃣ CEP (Complex Event Processing)

이벤트 패턴을 정의하고 복잡한 이벤트 시퀀스를 탐지할 수 있습니다.

```java
Pattern<Event, ?> pattern = Pattern.<Event>begin("start")
  .where(evt -> evt.getType().equals("click"))
  .next("next")
  .where(evt -> evt.getType().equals("purchase"));
```

- 이상 거래 탐지
- 사용자 행동 분석

---

### 5️⃣ Watermark 및 지연 이벤트 처리

Event Time 처리를 위해 Watermark를 설정합니다.

```java
.assignTimestampsAndWatermarks(
    WatermarkStrategy
      .<Event>forBoundedOutOfOrderness(Duration.ofSeconds(5))
      .withTimestampAssigner((event, timestamp) -> event.getTime())
);
```

- 일정 시간 지연된 이벤트도 정확히 집계 가능.

---

### 6️⃣ Flink SQL

Java/Python 없이도 SQL로 스트림을 처리할 수 있습니다.

```sql
SELECT user_id, COUNT(*) 
FROM clickstream 
GROUP BY TUMBLE(event_time, INTERVAL '1' MINUTE), user_id;
```

- AWS Kinesis Data Analytics에서 지원.

---

## 🛠️ 4. 실전 구성 예시 (ETL + 실시간 분석)

### 시스템 구성도

```
Kinesis Data Streams → Flink Application → S3 / DynamoDB / Redshift
                                  ↘︎
                               CloudWatch Logs
```

- Flink는 실시간으로 데이터를 수집하여 S3로 저장하거나,
- 조건별 분기 처리 후 데이터베이스로 전송.

---

## 🧩 5. AWS에서 Flink 애플리케이션 배포 흐름

1. **Kinesis Data Stream** 생성
2. **IAM Role** 생성 (Kinesis, CloudWatch, S3 접근 허용)
3. **Flink 애플리케이션 코드 작성**
   - Maven 기반 Java 프로젝트
   - `application.properties` 작성
4. **JAR 빌드 후 업로드**
   - Amazon S3에 업로드
5. **Kinesis Data Analytics for Flink 애플리케이션 생성**
   - JAR 경로, IAM Role 설정
6. **애플리케이션 실행 및 모니터링**

---

## 💰 6. 비용 고려

- Kinesis Data Analytics는 **사용 시간과 처리된 데이터량** 기준으로 요금이 부과됨.
- S3, CloudWatch, DynamoDB 등 연계 서비스 비용도 고려해야 함.
- 불필요한 리소스 정지 및 버퍼 최적화 필요.

---

## ✅ 7. 활용 사례

- 실시간 로그 수집 및 필터링 후 저장
- 사용자 이벤트 기반 행동 분석
- 주식, IoT 센서 데이터 실시간 분석
- 실시간 마케팅 캠페인 제어

---

## 🔚 결론

Apache Flink는 AWS의 Kinesis Data Analytics 서비스를 통해 손쉽게 배포 및 운영이 가능하며, 복잡한 실시간 스트림 처리를 안정적이고 효율적으로 수행할 수 있는 도구입니다. 상태 기반, 시간 기반, 패턴 인식, 윈도우 처리 등 고급 기능을 적극 활용하면 다양한 실시간 애플리케이션을 구현할 수 있습니다.
