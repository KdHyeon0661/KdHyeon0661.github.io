---
layout: post
title: 컴퓨터시스템 - 파일 메타데이터 읽기
date: 2025-09-05 15:20:23 +0900
category: 컴퓨터시스템
---
# 파일 메타데이터 읽기 — 개념, API, 활용

> **파일 메타데이터(File Metadata)**는 파일 자체의 데이터(내용)가 아니라, **파일에 대한 속성과 상태 정보**를 의미합니다.  
> 예를 들어 **크기, 권한, 소유자, 생성·수정 시간, 파일 종류(일반, 디렉터리, 심볼릭 링크 등)** 같은 정보가 여기에 속합니다.  
> Unix/Linux에서는 이러한 정보가 **inode**에 저장되며, **시스템 콜**을 통해 읽어올 수 있습니다.

---

## 1. 파일 메타데이터란?

- **정의**: 파일 시스템에서 파일에 부가적으로 저장하는 속성 정보.
- **저장 위치**: 대부분의 유닉스 계열 파일 시스템에서는 **inode** 구조체에 저장.
- **포함 정보 예시**:
  - 파일 종류 (regular file, directory, symbolic link, character device, block device 등)
  - 파일 크기 (bytes)
  - 파일 권한 (읽기/쓰기/실행)
  - 소유자/그룹 ID
  - 링크 수 (hard link count)
  - 타임스탬프:
    - **atime** (access time): 마지막 읽기 접근 시간
    - **mtime** (modification time): 내용 변경 시간
    - **ctime** (change time): inode 변경 시간(권한, 소유자 등 메타데이터 변경 시)
  - 블록 할당 정보
  - 특수 파일의 경우 주/부 장치 번호

---

## 2. 메타데이터를 읽는 주요 시스템 콜

| 함수 | 심볼릭 링크 처리 | 특징 |
|------|----------------|------|
| `stat` | 링크를 따라감 | 대상이 심볼릭 링크면 링크가 가리키는 파일 정보를 반환 |
| `lstat` | 링크를 따라가지 않음 | 심볼릭 링크 자체의 정보를 반환 |
| `fstat` | 이미 열린 파일 디스크립터 사용 | 열린 파일에 대한 메타데이터를 얻음 |

---

## 3. `stat` 구조체

Linux의 `<sys/stat.h>`에 정의된 구조체 예시:

```c
struct stat {
    dev_t     st_dev;     /* 파일이 위치한 장치 ID */
    ino_t     st_ino;     /* inode 번호 */
    mode_t    st_mode;    /* 파일 종류 + 권한 비트 */
    nlink_t   st_nlink;   /* 하드 링크 개수 */
    uid_t     st_uid;     /* 소유자 사용자 ID */
    gid_t     st_gid;     /* 소유자 그룹 ID */
    dev_t     st_rdev;    /* 특수 파일의 경우 주/부 장치 번호 */
    off_t     st_size;    /* 파일 크기 (바이트) */
    blksize_t st_blksize; /* 파일 시스템 I/O 블록 크기 */
    blkcnt_t  st_blocks;  /* 할당된 512B 블록 수 */
    struct timespec st_atim;  /* 마지막 접근 시간 */
    struct timespec st_mtim;  /* 마지막 수정 시간 */
    struct timespec st_ctim;  /* 마지막 상태 변경 시간 */
};
```

> 일부 시스템에서는 `st_atime`, `st_mtime`, `st_ctime`처럼 초 단위(`time_t`)만 제공하기도 합니다.

---

## 4. 기본 사용 예제

### 4.1 `stat()` 예제 — 파일 크기, 권한, 시간 정보 출력
```c
#include <stdio.h>
#include <sys/stat.h>
#include <unistd.h>
#include <time.h>

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, "사용법: %s <파일 경로>\n", argv[0]);
        return 1;
    }

    struct stat sb;
    if (stat(argv[1], &sb) == -1) {
        perror("stat");
        return 1;
    }

    printf("파일 크기: %lld bytes\n", (long long)sb.st_size);
    printf("권한: %o (8진수)\n", sb.st_mode & 0777);
    printf("하드 링크 수: %ld\n", (long)sb.st_nlink);
    printf("마지막 수정 시간: %s", ctime(&sb.st_mtime));

    return 0;
}
```

---

### 4.2 `lstat()` 예제 — 심볼릭 링크 정보 읽기
```c
#include <stdio.h>
#include <sys/stat.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    struct stat sb;
    if (lstat(argv[1], &sb) == -1) {
        perror("lstat");
        return 1;
    }

    if (S_ISLNK(sb.st_mode))
        printf("이 파일은 심볼릭 링크입니다.\n");
    else
        printf("이 파일은 심볼릭 링크가 아닙니다.\n");

    return 0;
}
```

---

## 5. 파일 종류 판별 매크로

`st_mode`의 상위 비트를 검사하여 파일 종류 판별 가능. `<sys/stat.h>` 매크로 사용:

```c
S_ISREG(m)   // 일반 파일
S_ISDIR(m)   // 디렉터리
S_ISLNK(m)   // 심볼릭 링크
S_ISCHR(m)   // 문자 장치
S_ISBLK(m)   // 블록 장치
S_ISFIFO(m)  // FIFO/파이프
S_ISSOCK(m)  // 소켓
```

---

## 6. 권한 비트 해석

- `st_mode`의 하위 9비트가 권한 정보  
- 8진수 표기 예: `0644`, `0755`  
- 권한 마스크:

| 심볼 | 값 | 의미 |
|------|----|------|
| S_IRUSR | 0400 | 소유자 읽기 |
| S_IWUSR | 0200 | 소유자 쓰기 |
| S_IXUSR | 0100 | 소유자 실행 |
| S_IRGRP | 0040 | 그룹 읽기 |
| S_IWGRP | 0020 | 그룹 쓰기 |
| S_IXGRP | 0010 | 그룹 실행 |
| S_IROTH | 0004 | 기타 읽기 |
| S_IWOTH | 0002 | 기타 쓰기 |
| S_IXOTH | 0001 | 기타 실행 |

---

## 7. 타임스탬프 차이

- **atime**: 사용자가 파일을 읽거나 실행할 때 갱신  
- **mtime**: 파일 내용이 바뀌면 갱신  
- **ctime**: 파일 메타데이터 변경 시 갱신 (권한 변경, 소유자 변경 등)

> **주의**: `ctime`은 "creation time"이 아니라 "change time"입니다.

---

## 8. 고급 활용

1. **파일 동기화 여부 확인**: mtime과 현재 시간을 비교해 변경 여부 감지
2. **백업 도구**: inode 번호, mtime, ctime 비교로 변경된 파일만 선택
3. **접근 제한 로직**: 권한 비트와 UID/GID를 확인하여 접근 허용 여부 결정
4. **디렉터리 순회**: `opendir()` + `readdir()`로 파일 이름 읽고, `stat()`로 메타데이터 수집

---

## 9. 주의사항

- **심볼릭 링크 처리**: `stat` vs `lstat` 구분 필요
- **네트워크 파일 시스템(NFS)**: 타임스탬프가 지연될 수 있음
- **대용량 파일 시스템**: 블록 수(`st_blocks`) 단위는 512바이트 기준
- **타임스탬프 해상도**: 시스템마다 나노초 단위 지원 여부 다름

---

## 10. 요약

- 파일 메타데이터는 파일의 **속성 정보**이며 inode에 저장됨
- `stat` / `lstat` / `fstat`로 읽을 수 있음
- 파일 종류, 권한, 소유자, 크기, 타임스탬프 등이 주요 항목
- 활용 예: 백업, 접근 제어, 로그 분석, 동기화 판단