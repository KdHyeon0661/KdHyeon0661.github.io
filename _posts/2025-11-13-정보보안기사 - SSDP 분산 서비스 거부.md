---
layout: post
title: 정보보안기사 - SSDP 분산 서비스 거부
date: 2025-11-13 23:25:28 +0900
category: 정보보안기사
---
# SSDP 분산 서비스 거부(DDoS) 취약점

## 개요

**SSDP(Simple Service Discovery Protocol)** 는 UPnP 장치 검색을 위해 **UDP/1900** 멀티캐스트(239.255.255.250)를 사용합니다. 이 특성과 **소스 IP 스푸핑**이 결합되면, 인터넷에 노출된 UPnP/SSDP 장치가 **반사·증폭(reflection/amplification)** 공격의 **증폭기(amplifier)** 로 악용됩니다. 업계 관측에 따르면 SSDP의 일반적인 **증폭 계수(AF)**는 **약 30배** 수준으로 보고되어 왔으며(요청 수십 바이트 → 응답 수백~수천 바이트), 최근 분기별 위협 리포트에서도 SSDP 기반 공격의 급증이 반복적으로 관찰됩니다.

> **수식: 증폭 계수(AF)**
> $$AF \;=\; \frac{\text{응답 바이트(UDP/IP 헤더 포함)}}{\text{요청 바이트(UDP/IP 헤더 포함)}}$$
> 예) 요청 100B → 응답 3,000B이면 \(AF \approx 30\).

**핵심 요약**
- **공격 벡터**: 스푸핑된 M-SEARCH(또는 변형) 요청 → 장치가 **피해자 IP**로 큰 SSDP 응답을 전송.
- **영향**: 대역폭·패킷 PPS 급증, 방화벽/로드밸런서·서버 자원 소모, 링크 포화. **대규모 다중 벡터** 공격의 일부로 혼합되기도 함.
- **완화**: (1) **엣지에서 UPnP/SSDP 비노출**(CPE/라우터·게이트웨이), (2) **UDP/1900 필터링·레이트리밋**, (3) **uRPF/BCP38** 기반 스푸핑 차단, (4) **상위 사업자/클라우드 DDoS 보호** 연계.

---

## 프로토콜과 공격 동작 방식

### SSDP 기본

- **전송 계층**: UDP
- **멀티캐스트 그룹**: 239.255.255.250:1900
- **요청 유형 예**
  - `M-SEARCH * HTTP/1.1` (클라이언트가 장치 검색)
  - `NOTIFY * HTTP/1.1` (장치가 스스로 광고)
- **헤더 키워드**: `HOST: 239.255.255.250:1900`, `ST:`(Search Target), `MAN: "ssdp:discover"`, `MX:`(초 단위 대기) 등.

**합법 트래픽 예시(요약형)**
```
M-SEARCH * HTTP/1.1
HOST: 239.255.255.250:1900
ST: ssdp:all
MAN: "ssdp:discover"
MX: 3
```

### 공격 시퀀스(반사·증폭)

1) 공격자가 인터넷을 **스캔**하여 응답하는 UPnP/SSDP 장치를 수집
2) **피해자 IP로 스푸핑**된 UDP/1900 **M-SEARCH** 요청 발송
3) 수많은 장치가 **피해자 IP로 SSDP 응답**(device description 위치 등 포함) 송신 → **증폭·집중** 트래픽 발생
4) 네트워크·서비스 중단 또는 성능 저하.

**증폭 규모**: 공개 자료·실험 연구에서 **SSDP AF ≈ 30x**가 반복 보고. (프로토콜·구성·응답 길이에 따라 상이)

---

## 위협 동향과 리스크 맵핑

- **DDoS 위협 환경**: 글로벌 사업자 보고서에 따르면 **초고용량·초고PPS** 공격이 증가하며, UDP 증폭 벡터(SSDP 포함)가 **다중 벡터** 시나리오의 일부로 자주 활용됨.
- **일반적 보안 권고**: **UDP 기반 증폭**(NTP/DNS/SSDP/WS-Discovery/SLP 등) 전반에 대해 **소스 스푸핑 차단(BCP38/uRPF)** 과 **공개 서비스 비활성화**가 핵심.

---

## 합법 테스트(내 자산 한정)와 악용 징후

> **주의**: 아래 모든 점검은 **본인 조직·승인된 대상**에서만 수행. 제3자·무허가 스캔/테스트는 불법·침해 행위에 해당.

### 자기 점검 — 장치 노출 확인

- **nmap** 스크립트
```bash
# 사내 대역(예: 192.168.0.0/24)에서 SSDP 응답 장치 확인

nmap -sU -Pn -p1900 --script upnp-info 192.168.0.0/24
```
- **tshark** 간이 캡처
```bash
# 수신 인터페이스에서 SSDP 멀티캐스트 트래픽 관찰

tshark -i eth0 -f "udp port 1900 and host 239.255.255.250"
```

### 로그/패킷 특이값(침해 의심)

- **대량의 수신 UDP/1900** 트래픽이 **외부 다원 소스**에서 동시 발생
- 패킷 페이로드에 **"HTTP/1.1 200 OK", "UPnP/1.0", "LOCATION:", "ST:"** 등 포함
- 단시간 **PPS/Gbps 급증**으로 방화벽·로드밸런서 세션 압박
- 다른 벡터(DNS/NTP/WS-Discovery 등) **동시 혼합** 징후.

---

## 탐지 규칙/쿼리 예시

### Suricata(개념 예시)

```yaml
# SSDP M-SEARCH 요청 탐지(내부 → 외부 비정상 확산도 탐지 가능)

alert udp $HOME_NET any -> $EXTERNAL_NET 1900 (
  msg:"SSDP M-SEARCH outbound";
  content:"M-SEARCH * HTTP/1.1"; nocase; sid:1900001; rev:1;
)

# 대량 SSDP 응답(외부 -> 내부 피해자) 탐지

alert udp $EXTERNAL_NET any -> $HOME_NET any (
  msg:"Potential SSDP reflection to internal";
  content:"HTTP/1.1 200 OK"; nocase;
  content:"UPnP/1.0"; nocase; distance:0; within:500;
  dsize:>400;  # 응답 페이로드 큰 편일 때
  sid:1900002; rev:1;
)
```

### Zeek(간이 스크립트)

```zeek
# 응답 바이트 크기와 비정상 빈도 기반 경고

event udp_contents(u: connection, is_orig: bool, contents: string)
    {
    if (u$id$resp_p == 1900/udp && !is_orig)
      {
        if (|contents| > 400 && /HTTP\/1\.1 200 OK/i in contents && /UPnP\/1\.0/i in contents)
          NOTICE([$note=Notice::Sensitive_Signature,
                  $msg=fmt("Large SSDP response to %s", u$id$orig_h),
                  $conn=u]);
      }
    }
```

### SIEM(예: Splunk) 탐지 쿼리

```spl
index=netflow (dport=1900 OR sport=1900) protocol=udp
| eval dir=if(dport=1900,"to-ssdp","from-ssdp")
| stats count sum(bytes) as bytes by src_ip, dst_ip, dir
| where bytes>500000 OR count>5000
```

---

## 완화/차단 전략(계층별)

### 엔드포인트/장치(UPnP/SSDP 비활성화)

- **가정용 공유기·CPE**: **UPnP를 끄고** WAN에서의 SSDP 접근 차단 권장(제조사 UI/CLI 상이). 공공 가이드도 동일 권고.
- **Linux**: `miniupnpd` 등 데몬 중지/비활성화
```bash
sudo systemctl stop miniupnpd
sudo systemctl disable miniupnpd
```
- **OpenWrt**
```bash
uci set upnpd.config.enabled='0'
uci commit upnpd
/etc/init.d/miniupnpd stop; /etc/init.d/miniupnpd disable
```
- **Windows**: SSDP Discovery 서비스·UPnP Device Host 비활성화
```powershell
# 관리자 PowerShell

Stop-Service SSDPSRV -Force
Set-Service  SSDPSRV -StartupType Disabled
Stop-Service upnphost -Force
Set-Service  upnphost -StartupType Disabled
```

### 서버/호스트 방화벽(수신/발신 제어)

- **Windows Defender Firewall**
```cmd
netsh advfirewall firewall add rule name="Block SSDP Inbound" dir=in  action=block protocol=UDP localport=1900
netsh advfirewall firewall add rule name="Block SSDP Outbound" dir=out action=block protocol=UDP remoteport=1900
```
- **Linux nftables**(예: 외부 인터페이스에서 SSDP 차단·율제어)
```bash
sudo nft add table inet filter
sudo nft add chain inet filter input  '{ type filter hook input  priority 0; }'
sudo nft add chain inet filter output '{ type filter hook output priority 0; }'

# 외부에서 들어오는 SSDP 차단

sudo nft add rule inet filter input  udp dport 1900 drop

# 내부에서 바깥으로 나가는 SSDP 응답 억제(원치 않는 반사기 방지)

sudo nft add rule inet filter output udp dport 1900 drop

# (선택) 내부 멀티캐스트만 허용하고 WAN은 드롭하는 구체화
# sudo nft add rule inet filter input  ip daddr 239.255.255.250 udp dport 1900 ip saddr 10.0.0.0/8 accept

```

### 네트워크 엣지(라우터/게이트웨이)

- **uRPF(BCP38)로 스푸핑 차단**: 소스 IP가 라우팅 상 **합당한 방향**에서 오지 않으면 드롭. 미국 CISA 등 공공 권고의 핵심.
  - **Cisco IOS**
    ```cisco
    interface GigabitEthernet0/0
      ip verify unicast source reachable-via rx
      ip verify unicast source reachable-via rx allow-default
      ip verify unicast source reachable-via rx allow-self-ping
    !
    access-list 111 deny   udp any any eq 1900
    access-list 111 permit ip any any
    interface GigabitEthernet0/0
      ip access-group 111 in
    ```
  - **JunOS**
    ```junos
    set interfaces ge-0/0/0 unit 0 family inet rpf-check mode strict
    set firewall family inet filter WAN-IN term BLOCK-SSDP from protocol udp
    set firewall family inet filter WAN-IN term BLOCK-SSDP from destination-port 1900
    set firewall family inet filter WAN-IN term BLOCK-SSDP then discard
    set firewall family inet filter WAN-IN term ALLOW-ELSE then accept
    set interfaces ge-0/0/0 unit 0 family inet filter input WAN-IN
    ```
- **CoPP/폴리싱**: 컨트롤 플레인 보호(폭주 시 라우터 CPU 보호)
  - **Cisco CoPP 개념**
    ```cisco
    class-map match-any SSDP
     match access-group name SSDP-UDP
    !
    ip access-list extended SSDP-UDP
     permit udp any any eq 1900
    !
    policy-map CONTROL-PLANE-POLICY
     class SSDP
      police 256000 8000 exceed-action drop
    !
    control-plane
     service-policy input CONTROL-PLANE-POLICY
    ```

### 상위 회선·클라우드 연계

- **RTBH/FlowSpec**: 공격 접두어·포트 기반의 **상위 차단** 요청
- **DDoS 보호 서비스**(스케일 아웃 스크러빙): 대규모 UDP 증폭 방어에 필수적(대세 트렌드).

---

## 대응(운영) 플레이북

### 인시던트 대응 단계

1) **탐지/알림**: NetFlow/SIEM 임계치·규칙 기반 알림(UDP/1900 폭증)
2) **식별**: 패킷 샘플링(미러링/TAP), **SSDP 시그니처** 확인(`UPnP/1.0`, `LOCATION:` 등)
3) **완화**:
   - 엣지 ACL로 UDP/1900 드롭(또는 비정상 소스 ASN/국가 기반 차단)
   - uRPF 활성화 점검·적용
   - 상위 사업자에 **RTBH/FlowSpec** 요청
   - 클라우드 스크러빙 경로로 트래픽 우회
4) **사후**: 내부 자산의 **UPnP/SSDP 비활성화** 범위 점검, 외부 노출 스캔, CMDB 반영, 재발 방지 정책화.

---

## 포렌식/가시성 — 패킷·로그 분석

### tshark로 간단 분석

```bash
# 피해 인터페이스에서 SSDP 응답 급증 캡처

sudo tshark -i eth0 -f "udp port 1900" -T fields \
  -e frame.time_epoch -e ip.src -e ip.dst -e udp.length -e data \
  | tee ssdp.log
```
분석 포인트
- 다수 **ip.src**의 단시간 집중(봇넷/리플렉터 분산)
- `udp.length` 급증(수백~수천 바이트)
- 페이로드 내 `HTTP/1.1 200 OK`, `ST:`, `USN:`, `LOCATION:` 존재

### NetFlow/IPFIX 예시(가시성)

```text
Key: dport=1900, protocol=udp, bytes, packets, src_asn, dst_asn
- 비정상 시간대에 src_asn 다변화 + bytes/PPS 급상승
- dst_ip가 우리 서비스 VIP(피해자)로 수렴
```

---

## 정책·컴플라이언스 맵핑

| 영역 | 통제 예 | SSDP DDoS와의 연결 |
|---|---|---|
| 네트워크 보안 표준 | **BCP38/uRPF** 소스 검증 | **스푸핑 차단**의 업계 표준 관행.  |
| 구성 하드닝 | **UPnP/SSDP 비활성화** | 증폭기 노출 방지(라우터·CPE·서버).  |
| 모니터링 | **NetFlow/SIEM** 임계치 | UDP/1900 볼륨/빈도 기반 탐지 |
| 공급망 | CPE/가전·IoT 관리 | 출고 기본설정 검토, 원격관리 폐쇄 |
| 대응 계약 | 상위 회선사업자·스크러빙 | **대용량 흡수·우회·RTBH/FlowSpec** 준비.  |

---

## 보안 테스트(랩) 시나리오 — “내 폐쇄 랩” 전용

### 랩 구성

- **네트워크**: attacker VM, reflector VM(UPnP/SSDP 에뮬레이터), victim VM
- **세그먼트**: 인터넷 격리된 **폐쇄 네트워크**
- **도구**: Scapy, tshark, Suricata

### 합법 트래픽 생성(스푸핑 없이)

```python
# scapy: 로컬 테스트(스푸핑 금지, 랩 전용)

from scapy.all import *
p = IP(dst="239.255.255.250")/UDP(sport=54321,dport=1900)/Raw(\
b"M-SEARCH * HTTP/1.1\r\nHOST: 239.255.255.250:1900\r\nST: ssdp:all\r\nMAN: \"ssdp:discover\"\r\nMX: 1\r\n\r\n")
send(p, iface="eth0", count=3)
```

### 방어 정책 검증 체크

- UDP/1900 **인바운드/아웃바운드** ACL 동작 확인
- uRPF 적용 인터페이스에서 **스푸핑 패킷 드롭** 확인(랩 라우터)
- Suricata 알림/대시보드 이벤트 발생 검증

---

## 운영 체크리스트

**구성/하드닝**
- [ ] 엣지 라우터·게이트웨이 **UPnP/SSDP 서비스 노출 금지**(기본 비활성화)
- [ ] 내부 세그먼트에서만 멀티캐스트 허용, **WAN 경계 UDP/1900 차단**
- [ ] 서버·워크스테이션 **SSDP/UPnP 서비스 중지** 자동화(GPO/Ansible)

**탐지/모니터링**
- [ ] NetFlow/IPFIX에서 **UDP/1900 볼륨/빈도** 임계값·알림
- [ ] IDS/IPS(또는 Suricata) **M-SEARCH/대형 응답** 시그니처 활성화
- [ ] SIEM 대시보드에 **상위 src_ip/src_asn, dport=1900** 위젯

**네트워크 제어**
- [ ] **uRPF/BCP38** 적용(가능 시 **strict**)
- [ ] WAN-IN ACL: `deny udp any any eq 1900` / 예외는 **화이트리스트**
- [ ] CoPP/폴리싱으로 라우터 컨트롤 플레인 보호

**대응/연계**
- [ ] 상위 회선 사업자 **RTBH/FlowSpec** 절차·연락망 준비
- [ ] **스크러빙/클라우드 DDoS** 서비스 연계 테스트(재루팅·BGP 커뮤니티)

**사후/지속**
- [ ] CMDB에 **UPnP/SSDP 기능 사용 자산 = 0** 정책화
- [ ] 분기별 인터넷 외부 노출 스캔(공급망·지점 포함)
- [ ] 최신 위협 리포트로 임계값·룰 재튜닝(분기/반기)

---

## FAQ

**Q1. “UDP/1900을 전면 차단해도 되나?”**
A. **인터넷 경계**에서는 권장됩니다. 내부 홈 IoT·프린터 등에서만 필요합니다. 사업 요구로 외부 통신이 필요하다면 **정확한 목적지·세그먼트 제한**과 **레이트리밋**을 병행하십시오.

**Q2. “SSDP만 막으면 충분한가?”**
A. 대부분의 대형 공격은 **다중 벡터**입니다(DNS/NTP/WS-Discovery/SLP/CLDAP 등). SSDP와 함께 **보편적 UDP 증폭 벡터** 전반 대응이 필요합니다.

---

## 한 장 요약(보드 발표용)

1) **문제**: SSDP(UDP/1900)는 스푸핑 악용 시 **~30배 증폭** 반사 공격의 증폭기. 서비스 중단·링크 포화 초래.
2) **탐지**: dport/sport=1900 급증, `UPnP/1.0`, `LOCATION` 서명, 다원 소스·고PPS.
3) **차단**: **UPnP/SSDP OFF**, WAN 경계 UDP/1900 드롭, **uRPF/BCP38**, CoPP, 상위 RTBH/스크러빙.
4) **운영**: 분기 스캔·룰 튜닝, CMDB “0 노출”, 비즈니스 예외는 화이트리스트+레이트리밋.
5) **트렌드**: 전 세계적으로 **대형·다중 벡터 DDoS 증가** — 예보·완화 자동화 체계 필수.

---

## 참고 문헌 / 권고(발췌)

- **CISA** — UDP 증폭 공격 개요/대응 권고(BCP38 등).
- **Cloudflare** — SSDP DDoS 메커니즘 설명 및 분기 위협 리포트(24년/25년).
- **A10 Networks·CyberGreen** — SSDP 평균 증폭 계수 ~30배 자료.
- **Rapid7** — SSDP/UPnP 동작과 M-SEARCH·rootDesc.xml 설명.
