---
layout: post
title: Linux - 권한 관리 기초와 고급 설정
date: 2024-11-04 19:20:23 +0900
category: Linux
---
# 권한 관리 기초와 고급 설정

## 1. 파일 권한 및 고급 설정

- 운영체제에서 파일 권한은 파일이나 디렉터리에 대해 누가 어떤 행위를 할 수 있는지를 제어하는 중요한 보안 수단입니다. 일반적으로 다음 세 가지 권한으로 나뉩니다:

-- 읽기(read, r): 파일 내용을 읽을 수 있음을 의미합니다. 디렉터리의 경우 파일 목록 조회 권한입니다.
-- 쓰기(write, w): 파일 내용을 수정하거나 삭제할 수 있는 권한입니다. 디렉터리의 경우 파일 생성, 삭제 권한을 포함합니다.
-- 실행(execute, x): 파일 실행 권한, 또는 디렉터리 접근 권한(디렉터리 안으로 들어갈 수 있는 권한)입니다.

- 권한은 보통 세 가지 사용자 그룹에 대해 각각 지정됩니다:

-- 소유자(owner): 파일을 만든 사용자 또는 지정된 사용자
-- 그룹(group): 파일 소유자와 연관된 사용자 그룹
-- 기타(others): 소유자나 그룹에 속하지 않은 모든 사용자

> 예를 들어, 권한 문자열 rwxr-x--x 는
> 소유자는 읽기, 쓰기, 실행 모두 가능
> 그룹은 읽기와 실행 가능
> 기타 사용자는 실행만 가능
> 을 의미합니다.
---

### `chmod` - 권한 변경

```bash
chmod 755 script.sh
chmod u+x file.sh
```

| 숫자 | 권한 | 의미 |
|------|-------|------|
| 7    | rwx   | 읽기, 쓰기, 실행 |
| 6    | rw-   | 읽기, 쓰기 |
| 5    | r-x   | 읽기, 실행 |
| 4    | r--   | 읽기 |
| 0    | ---   | 없음 |

| 옵션 | 설명 |
|------|------|
| `-R` | 재귀적으로 하위 항목까지 적용 |

---

### `chown` - 소유자 변경

```bash
chown user:group file.txt
sudo chown -R www-data:www-data /var/www
```

| 옵션 | 설명 |
|------|------|
| `-R` | 재귀적으로 하위 디렉토리까지 변경 |

---

### `umask` - 파일 생성 시 기본 권한 설정

```bash
umask
umask 022
```

| umask 값 | 실제 권한 (파일) | 설명 |
|----------|------------------|------|
| 022      | 644              | 기본: rw-r--r-- |
| 077      | 600              | 나만 접근 가능 |

---

### Special Bits - `setuid`, `setgid`, `sticky`

| 기능     | 설명 |
|----------|------|
| `setuid` | 실행 시 파일 소유자의 권한으로 실행 |
| `setgid` | 실행 시 그룹 권한 상속 / 디렉토리 그룹 고정 |
| `sticky` | 디렉토리 내에서 본인 파일만 삭제 가능 |

```bash
chmod u+s script.sh    # setuid
chmod g+s dir/         # setgid
chmod +t /tmp          # sticky bit
```

> 숫자 예: `chmod 4755` → setuid + 755

---

### 고급 권한 - ACL (Access Control List)

기본 권한만으로는 세분화가 어렵습니다. 이럴 때 ACL을 사용하면 특정 사용자/그룹에게 별도 권한을 줄 수 있습니다.

#### ACL 설정 전 준비

```bash
sudo apt install acl       # Debian/Ubuntu
sudo yum install acl       # RHEL/CentOS
```

#### ACL 활성화 확인 (마운트 시)

```bash
mount | grep acl
```

또는 `/etc/fstab`에 `acl` 옵션 포함 필요:

```fstab
UUID=xxxx / ext4 defaults,acl 0 1
```

---

#### setfacl - ACL 권한 추가

```bash
setfacl -m u:john:r-- file.txt     # john에게 읽기 권한 부여
setfacl -m g:devs:rw- project.log  # devs 그룹에게 읽기/쓰기
```

| 명령어 구성 | 의미 |
|-------------|------|
| `-m`        | 수정(modify) |
| `u:user`    | 사용자 권한 설정 |
| `g:group`   | 그룹 권한 설정 |

#### 디렉토리에 ACL 추가 (하위 포함)

```bash
setfacl -Rm u:john:rwX /data/project/
```

- `-R`: 재귀적으로 적용
- `X`: 디렉토리에만 실행 권한 추가

---

#### ACL 삭제

```bash
setfacl -x u:john file.txt     # 특정 사용자 삭제
setfacl -b file.txt            # ACL 전체 제거
```

---

#### ACL 확인

```bash
getfacl file.txt
```

---

## 2. 추가 보안 명령어 상세 정리

### `passwd` - 비밀번호 설정 및 변경

```bash
passwd [사용자]
```

| 옵션 | 설명 |
|------|------|
| (없음)     | 현재 사용자 비밀번호 변경 |
| 사용자명   | 다른 사용자 비밀번호 변경 (sudo 필요) |
| `-l`       | 계정 잠금 |
| `-u`       | 계정 잠금 해제 |
| `-e`       | 다음 로그인 시 비밀번호 변경 요구 |

#### 예시
```bash
passwd             # 현재 사용자 비밀번호 변경
sudo passwd devkim # 다른 사용자 비밀번호 설정
sudo passwd -l testuser   # 사용자 계정 잠금
```

---

### `su`, `sudo` - 사용자 전환 / 관리자 권한 실행

#### `su` (switch user)

```bash
su [사용자]
```

| 명령어 | 설명 |
|--------|------|
| `su`       | root 사용자로 전환 (root 비밀번호 필요) |
| `su devkim`| devkim 사용자로 전환 |
| `su -`     | root 로그인 환경까지 로드 (`/root`로 이동 등) |

#### 예시
```bash
su -             # 완전한 root 환경으로 로그인
su otheruser     # 다른 사용자로 전환
```

---

#### `sudo` (superuser do)

```bash
sudo [명령어]
```

| 옵션 | 설명 |
|------|------|
| (없음) | 관리자 권한으로 명령어 실행 |
| `-i`  | root 로그인 쉘 실행 |
| `-u`  | 특정 사용자로 명령 실행 |
| `-l`  | sudo 가능한 명령 확인 |

#### 예시
```bash
sudo apt update
sudo -u www-data ls /var/www
sudo -i            # root 쉘 진입
```

---

### `id`, `whoami` - 사용자 및 그룹 정보 확인

#### `id`

```bash
id [사용자]
```

| 출력 항목 | 설명 |
|-----------|------|
| `uid`     | 사용자 ID |
| `gid`     | 기본 그룹 ID |
| `groups`  | 보조 그룹 목록 |

#### 예시
```bash
id
id devkim
```

출력:
```
uid=1000(devkim) gid=1000(devkim) groups=1000(devkim),27(sudo)
```

---

#### `whoami`

```bash
whoami
```

- 현재 로그인한 **사용자 이름** 출력 (ID 아님)

#### 예시
```bash
whoami
```

출력:
```
devkim
```

---

## 3. 요약

| 명령어      | 설명 |
|-------------|------|
| `ls`, `cd`, `pwd` | 탐색 명령어 |
| `touch`, `mkdir` | 파일/디렉토리 생성 |
| `cp`, `mv`, `rm` | 파일 복사/이동/삭제 |
| `find` | 고급 검색 |
| `chmod`, `chown`, `umask` | 권한 제어 |
| `setfacl`, `getfacl` | 세부 권한 설정 (ACL) |
| `chmod +t` | 디렉토리 보호 (sticky bit) |

---

## 4. 마무리

파일 관리와 권한 제어는 리눅스를 사용하는 데 있어 가장 중요한 기초 중 하나입니다. 이번 편에서 기본 명령어와 고급 권한 설정까지 통합하여 정리했습니다.