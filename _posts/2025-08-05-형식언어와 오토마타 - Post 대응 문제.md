---
layout: post
title: 형식언어와 오토마타 - Post 대응 문제
date: 2025-08-05 23:20:23 +0900
category: 형식언어와 오토마타
---
# Post 대응 문제(PCP, Post Correspondence Problem)

> **핵심 요지**
> - **PCP**는 두 목록의 문자열 쌍을 이어 붙여 **위·아래 문자열을 같게** 만들 수 있느냐를 묻는 문제다.
> - PCP는 **반결정 가능(RE)** 이지만 **결정 불가능(undecidable)** 이다. (더 나아가 **RE-완전**)
> - **수정형(MPCP)** 을 거쳐 **튜링 기계 수용성**이나 **정지 문제**로부터 표준 감소를 한다.
> - 알파벳이 **이진**이어도(문자 2개) 여전히 결정 불가능.
> - **유계(bounded) PCP**(해 길이를 상한으로 주면)는 **결정 가능**(완전 탐색으로 됨).
> - **단문자(단일 알파벳) PCP**는 **결정 가능**(길이 합 문제로 환원됨).

---

## 정의

알파벳 \(\Sigma\) 위의 문자열 쌍
\[
P=\big((u_1,v_1), (u_2,v_2),\dots,(u_k,v_k)\big),\quad u_i,v_i\in\Sigma^*
\]
가 주어졌을 때, **지수열** \(i_1,i_2,\dots,i_m\) (\(m\ge 1\))이 존재하여
\[
u_{i_1}u_{i_2}\cdots u_{i_m} \;=\; v_{i_1}v_{i_2}\cdots v_{i_m}
\]
가 되는지 묻는다. 존재하면 **해(solution)** 가 있다고 한다.

- **MPCP (Modified PCP)**: 해가 **반드시 1번 타일로 시작**해야 한다(즉, \(i_1=1\) 이도록 강제).

> 직관: **타일** \(\dfrac{u_i}{v_i}\) 를 줄 세워 **윗줄·아랫줄이 동일**한 긴 문자열을 만들 수 있느냐.

---

## 작동 감각 잡기 — **작은 예시**

\[
\Sigma=\{a,b\},\quad
P=\left\{
\frac{ab}{a},\;
\frac{b}{ba},\;
\frac{a}{ab}
\right\}
\]

열 \(1,2,3\)을 차례로 놓으면
\[
\text{위: } ab\cdot b\cdot a = abba,\qquad
\text{아래: } a\cdot ba\cdot ab = abba
\]
로 같아진다 ⇒ **해 존재**.

**연습**: 아래 인스턴스는 해가 있을까?
\[
\left\{
\frac{ab}{aba},\;
\frac{aba}{ab},\;
\frac{b}{ba}
\right\}
\]
힌트: `aba`/`ab`의 **접두사-접미사** 균형을 이용한 짧은 해를 먼저 시도해 보라.

---

## 알고리즘적 성질 — **RE**이지만 **결정 불가능**

### 반결정 가능(RE)

길이가 1,2,3,… 인 모든 지수열을 **열거**하며 위·아래를 비교하면,

- 해가 **있으면** 언젠가 발견(accept),
- 해가 **없으면** 영원히 탐색(루프) → **반결정**.

```text
# 완전탐색 열거기(의사코드)

for m = 1,2,3,...:
  for all sequences (i1,...,im) ∈ {1..k}^m:
    if u_{i1}...u_{im} == v_{i1}...v_{im}:
      accept   # 해 발견!
# 해가 없으면 멈추지 않음 → RE(튜링 인식 가능)

```

> **팁(가지치기)**: 어느 시점까지의 위/아래 접합이 **서로 접두사 관계가 아니면** 더 붙여도 절대 같아질 수 없다 → 그 지수열 분기를 **가지치기**로 버려라(§8 참조).

### 결정 불가능(Undecidable)

- **정리**: PCP는 **결정 불가능**. (심지어 \(|\Sigma|=2\) 이진 알파벳에서도)
- 표준 증법 흐름:
  \[
  A_{TM}(\text{튜링 수용성}) \;\le_m\; \text{MPCP} \;\le_m\; \text{PCP}
  \]
  즉, **튜링기계 수용성** 혹은 **정지 문제**에서 **(수정형)PCP**로의 **many-one 감소**.

> 결론: PCP는 **RE-완전**. 따라서 보수 \(\overline{\text{PCP}}\)는 일반적으로 **RE가 아님**.

---

## MPCP와 PCP — **시작 강제**를 어떻게 일반 PCP로 옮길까?

- **MPCP ⇒ PCP**: “반드시 1번으로 시작”을 PCP로 강제하는 전형적 트릭:
  - 새 기호 `#`, `$` 등 **머리·꼬리 표식**을 도입.
  - **시작 타일** \(\dfrac{\#u_1}{\#v_1}\) 을 추가해, 해가 1번으로 시작하지 않으면 **첫 글자 `#` 정렬이 불가능**.
  - **정렬 유지 타일**(예: \(\dfrac{a}{a}\), \(\dfrac{x\#}{\#x}\))을 넣어, 1번으로 시작한 경우에만 전체가 맞게 진행되도록 설계.

> 핵심은 “1번을 맨 앞에서 쓰지 않으면 **첫 글자 동기화가 어긋나도록**” 타일 집합을 꾸미는 것이다.

---

## **정지 문제 → MPCP** 감소(고전 개요)

목표: 주어진 TM \(M\)과 입력 \(w\)에 대해
\[
M\text{이 }w\text{를 수용} \iff \text{구성한 } \text{MPCP}(M,w)\text{가 해를 가짐}.
\]

### 인코딩**

- \(M\)의 한 순간 상태를 문자열로:
  \[
  C = \alpha\, q\, a\, \beta
  \]
  (머리가 \(a\) 위에 있고, 왼쪽 내용 \(\alpha\), 오른쪽 내용 \(\beta\), 현재 상태 \(q\)).
- 수용 계산 전체는
  \[
  C_0\ \#\ C_1\ \#\ \cdots\ \#\ C_t
  \]
  꼴(구분자 \(\#\))의 문자열로 표현.

### 설계 원리**

1) **시작 강제**
   - 첫 타일을 \(\dfrac{\#}{\#C_0\#}\) (혹은 반대)로 하여, 한 줄에 **초기 구성**이 먼저 등장하도록 함.

2) **문자-복사 타일**
   - 모든 기호 \(x\in\Gamma\cup\{ \# \}\) 에 대해 \(\dfrac{x}{x}\) 타일 제공 → 일치하는 문자들의 자유로운 복사.

3) **전이-일치 타일**
   - 전이 \((q,a)\mapsto(q',c,R)\)이면,
     \[
     \cdots x\, q\, a\, y\cdots \Rightarrow \cdots x\, c\, q'\, y\cdots
     \]
     형태의 **국소 패턴**만 허용되도록, 위·아래가 오직 “합법적 전이”일 때만 **맞물려 이어지게** 하는 타일을 넣는다.
     (L-이동도 유사하게 좌측 기호와 함께 동기화)

4) **행(구성) 경계 동기화**
   - \(\#\) 전후 이동을 제어하는 타일(\(\dfrac{\#}{\#}\), \(\dfrac{x\#}{\#x}\))로 **구성-경계**가 **같은 위치**에서만 나타나게 함.

5) **수용 종결**
   - 수용 상태 \(q_{acc}\)에 진입하면 마무리 표식 `\$` 등을 붙여 **완벽한 위=아래 정렬**이 완성되도록 닫는다.

### **정당성(양방향)**

- **정(⇒)** \(M\)이 \(w\)를 수용한다면, 실제 계산 테이블 \(C_0\#C_1\#\dots\#C_t\) 를 따라 타일을 순서대로 택하면 **정확히 일치**한다.
- **역(⇐)** 해가 존재한다면, \(\#\)-정렬과 전이-일치 타일의 제약으로 인해 위·아래 문자열은 **합법적 계산 테이블**을 이루며 마지막이 수용 구성이어야 한다.

> 요컨대, **PCP 해 ≡ 합법적 수용 계산 표**로 동치화된다.

---

## **결정 가능한** 변형·제한

### **유계 PCP (k-bounded PCP)**

- “해의 길이 \(m\)이 \(k\) 이하인가?”라는 **유계판**은 **결정 가능**.
- 이유: 길이 \(≤k\)의 지수열은 유한하므로 **완전탐색** 가능.
- 복잡도는 \(k\)의 부호화(단항/이항)와 \(k,\,k^k\) 급의 조합 수에 따라 터지지만, **결정 가능성** 자체는 명확.

### PCP**

- \(\Sigma=\{a\}\)라면, 각 문자열은 길이만 의미 있음.
- 각 타일의 “길이 차이” \(d_i=|u_i|-|v_i|\) 를 정의.
- 어떤 지수열 \(i_1,\dots,i_m\)에 대해 \(\sum_j d_{i_j}=0\) 이면 해.
- 이는 정수 합성/배수성의 문제로 환원되어 **결정 가능**(간단 동적계획/정수선 탐색으로 판정).

> **주의**: “단문자 PCP는 결정 가능”이지만, 알파벳 크기가 2만 되어도 **결정 불가능**으로 급변한다.

---

## **이진 알파벳**에서도 왜 여전히 **결정 불가능**인가?

- 정지 문제에서의 감소 구성은 본질적으로 **아주 작은 기호 집합**으로도 구현 가능하다.
- 전이-일치 타일과 경계 동기화 타일을 **2개 기호**만으로 인코딩하도록 조금 더 정교하게 만들면, \(|\Sigma|=2\)에서도 동일한 논증이 성립.

> 메시지: “문자 종류가 적다”는 **쉬워진다**를 의미하지 않는다. **로컬 문법**을 꼼꼼하게 꾸미면 **정지 문제의 복잡성**을 그대로 옮겨올 수 있다.

---

## **작은 인스턴스 푸는 요령(백트래킹/휴리스틱)**

### 접두사-접미사 관계 유지(필수 가지치기)

- 현재까지의 접합 \(U\) (위)와 \(V\) (아래) 에 대해, \((U,V)\)가 **접두사 관계**여야만 **희망**이 있다.
  - 만약 \(U\)와 \(V\)가 접두사 관계가 아니라면, 어떤 타일을 더 붙여도 **절대 같아질 수 없음** → **백트래킹**.

### “차이 문자열” 관찰

- 길이 관점에서 \(\Delta=|U|-|V|\) 를 추적. \(\Delta>0\)이면 아래를 늘려 “채우는” 타일, \(\Delta<0\)이면 위를 늘리는 타일을 우선 고려.
- **루프 패턴**(반복하면 \(|\Delta|\)가 줄어드는 서브시퀀스)을 찾으면 빠르게 수렴 가능.

### 지능형 열거기(의사코드)

```python
# 단순한 가지치기 포함 열거기 (교육용 의사코드)

def pcp_search(pairs, max_depth=None):
    # pairs: list of (u_i, v_i)
    from collections import deque
    Q = deque()
    Q.append(("", "", []))  # (U, V, seq)
    while Q:
        U, V, seq = Q.popleft()
        # 목표 검사
        if U == V and seq:        # 공허한 해 방지: 길이 ≥ 1
            return seq
        if max_depth is not None and len(seq) >= max_depth:
            continue
        # 접두사 가지치기
        if not (U.startswith(V) or V.startswith(U)):
            continue
        # 브랜치 확장
        for i,(u,v) in enumerate(pairs, start=1):
            Q.append( (U+u, V+v, seq+[i]) )
    return None  # (유계 내) 해 없음
```

> **주의**: 위는 유계/휴리스틱 탐색 예시일 뿐, 일반 PCP의 “해 없음”을 **증명**해주지 못한다(무한 루프 가능).
> “유계 PCP”나 실습·퍼즐에는 유용.

---

## **감소의 힘** — PCP로부터 얻는 결과들

- **CFG 모호성**: 주어진 문맥 자유 문법이 모호한가? → **결정 불가능**(PCP로부터).
- **CFG 보편성/동일성/포함성**: 합성 가젯을 더하면 PCP에서 연쇄적으로 **불가능성**이 전이.
- **평면 타일링 문제**: 문자열 대신 격자 타일링으로 바꿔도 **유사한 불가능성**이 귀결(문자열→격자 인코딩).

> PCP는 형식언어/계산이론에서 **불가능성의 만능 감쇄기**처럼 쓰인다.

---

## **워크드 예제** — 작은 퍼즐을 끝까지 풀어 보기

다음 인스턴스 \(P\)를 보자:
\[
\left\{
\frac{ab}{a},\;
\frac{b}{ba},\;
\frac{a}{ab}
\right\}
\]
우리는 앞서 해가 \(1,2,3\)임을 보았다.
이번엔 **탐색 과정**을 흉내 내보자.

1. 시작: \(U=\epsilon, V=\epsilon\). 가능한 모든 타일 확장:
   - 붙인 뒤 접두사 관계 유지 여부 검사.

2. \(1\)을 붙이면: \(U=ab, V=a\). 접두사 관계 OK(\(V\subset U\)).
   - \(\Delta=|U|-|V|=1\) → **아래**를 키울 타일(아랫줄 더 길어지는 효과)을 선호.

3. \(2\)를 붙이면: \(U=abb, V=aba\). 접두사 관계 OK(\(V\subset U\) 아님, 이번엔 \(U\subset V\)도 아님? 검사!)
   - 실제로 `abb` vs `aba`: 세 번째 글자에서 불일치 → **가지치기**.
   - 대신 순서를 바꿔 \(1,3\): \(U=aba, V=aab\) — 이것도 세 번째 글자서 **불일치** → 가지치기.

4. \(1,2\)는 실패여서 \(1,2,3\)을 시도:
   - \(U=abba, V=abaa b = abba\) → **성공**.

> 핵심: **접두사 검사**로 분기를 대거 줄이고, \(\Delta\) 힌트를 따라 **길이 불균형**을 빠르게 해소한다.

---

## **MPCP → PCP** 기계적 변환(스케치)

MPCP 인스턴스 \(\{(u_i,v_i)\}_{i=1}^k\) 가 주어졌다고 하자(해는 \(i_1=1\)로 시작해야 함).
다음 PCP 인스턴스를 구성한다(대표 패턴):

- 새 기호 `#`, `$` 도입(원래 알파벳과 구분).
- 타일 집합:
  - \(\dfrac{\#u_1}{\#v_1}\) (시작 강제)
  - \(\dfrac{u_i}{v_i}\) for \(i=1..k\) (원 타일 유지)
  - \(\dfrac{x}{x}\) for 모든 \(x\) (동기화 복사)
  - \(\dfrac{x\#}{\#x}\) (경계 이동 동기화)
  - 마감 타일: \(\dfrac{\$}{\$}\), \(\dfrac{x\$}{\$x}\) 등
- 올바른 해라면 **반드시 첫 칸**에서 `#` 의 좌우 정렬을 지켜야 하므로, 1번 타일로 시작하지 않으면 정렬이 깨진다.

> 실제 교과서 구성은 표식과 순서를 조금 달리하지만, 요지(“**처음 글자 동기화를 땡겨 1번을 강제**”)는 같다.

---

## **실습 과제**

1) (**따뜻한 몸풀기**)
   \[
   \left\{\frac{01}{0},\;\frac{1}{10},\;\frac{0}{01}\right\}
   \]
   의 해를 찾아라(있다면 **가장 짧은** 해).

2) (**프루닝 훈련**)
   아래 인스턴스에 대해 접두사 조건으로 가지치기를 넣은 **BFS 열거기**(§8.3 의사코드 참고)를 손 코딩하라.
   \[
   \left\{\frac{ab}{aba},\;\frac{aba}{ab},\;\frac{b}{ba}\right\}
   \]
   탐색 트리의 “방문 노드 수”를 프루닝 유무로 비교해 보라.

3) (**단문자 PCP 판정기**)
   \(\Sigma=\{a\}\) 일 때, 길이 차이 \(d_i=|u_i|-|v_i|\) 를 이용하여
   \(\sum_j d_{i_j}=0\) 을 달성할 수 있는지 **동적계획**으로 판정하는 루틴을 설계하라.
   (힌트: 가능한 \(\Delta\) 값을 집합으로 유지하며 점화)

4) (**감소 이해**)
   임의의 오른쪽 이동 전이 \((q,a)\to(q',c,R)\)를 강제하는 **국소 타일** 2~3개를 구체적으로 설계하라.
   (목표: 위줄에 `... q a ...`, 아래줄에 `... c q' ...` 가 **딱 맞아떨어져야** 다음 구성이 이어지게)

---

## **자주 하는 실수 & 함정**

- 특정 **하나의 지수열**만 반례로 든다 → **불충분**. PCP는 **어떤 지수열**이라도 가능하다.
- 접두사 가지치기 없이 브루트포스 → **조합 폭발**로 금방 막힌다.
- MPCP와 PCP를 헷갈려 시작 강제를 놓침 → 감쇄 연쇄가 **깨짐**.
- 단문자 PCP와 이진 PCP의 난이도를 **같게** 보거나 반대로 생각 → 난이도는 **급변**한다(단문자=결정 가능, 이진=결정 불가능).

---

## **마무리 요약표**

### 문제/모형

| 항목 | 요지 |
|---|---|
| **PCP** | \((u_i,v_i)\) 타일로 위/아래 접합이 같아지게 할 지수열 존재? |
| **MPCP** | 해가 반드시 **1번 타일로 시작** |
| **해(space)** | 지수열 길이 ≥ 1 |

### 결정성/복잡도

| 성질 | 결과 | 메모 |
|---|---|---|
| 반결정성 | **Yes(RE)** | 길이별 지수열 열거로 인식 가능 |
| 결정 가능성 | **No** | \(|\Sigma|=2\)에서도 No |
| RE-완전성 | **Yes** | \(A_{TM}\) 등에서 many-one 감소 |
| 유계 PCP | **Yes** | 완전탐색(시간 폭증) |
| 단문자 PCP | **Yes** | 길이차 정수합 문제 |
| 이진 PCP | **No** | 감소 유지 |

---

## 부록: **미니 실험 코드**(교육용 의사 파이썬)

> 실제 퍼즐/유계판 실습에 쓸 수 있는 **간단 탐색기**의 뼈대.
> (일반 PCP의 “해 없음” 판정은 여전히 불가능함에 주의)

```python
def bounded_pcp(pairs, max_len):
    """
    pairs: list[tuple[str,str]] = [(u1,v1), ... , (uk,vk)]
    max_len: 최장 지수열 길이(유계)
    return: 한 해의 지수열(list[int]) 또는 None
    """
    from collections import deque
    # 항등 복사 최적화(선택): (x,x) 타일은 앞뒤로 합쳐도 무의미 → 생략 가능
    Q = deque()
    Q.append(("", "", []))  # (U,V,seq)
    while Q:
        U, V, seq = Q.popleft()
        if seq and U == V:
            return seq
        if len(seq) == max_len:
            continue
        # 프루닝: 접두사 관계 유지
        if not (U.startswith(V) or V.startswith(U)):
            continue
        # 길이 차 힌트(선택적)
        delta = len(U) - len(V)
        # 휴리스틱: delta>0이면 아래를 늘리는 v가 긴 타일부터
        order = range(len(pairs))
        # 브랜치
        for idx in order:
            u, v = pairs[idx]
            Q.append((U+u, V+v, seq+[idx+1]))
    return None
```

**테스트 팁**
- §2의 예시를 넣고 `max_len=4~6` 범위에서 결과를 확인해보라.
- §12(2)의 인스턴스로 프루닝 효과를 수치로 비교해보라(방문 노드 수).

---

## 결론

- **PCP**는 간단한 정의에도 불구하고 **정지 문제**의 본질을 고스란히 담는 **RE-완전** 문제다.
- **MPCP**를 매개로 하는 표준 감소는 “계산 표의 로컬 일치”를 **문자열 타일**로 흉내 내는 정교한 가젯의 예시다.
- **유계/단문자** 같은 제한에서는 다시 **결정 가능**으로 뒤집히며, 이는 문제의 **핵심 난점**(무한 탐색/자유로운 상호접두사 맞춤)에 있음을 시사한다.
- 실습에서는 **접두사 가지치기**와 **길이 차 힌트**만으로도 작은 퍼즐의 난이도가 크게 낮아진다.
