---
layout: post
title: Git - Git 실수 복구 전략
date: 2025-02-11 21:20:23 +0900
category: Git
---
# Git 실수 복구 완벽 가이드

## Git 복구의 핵심 개념 이해하기

Git은 데이터를 영구적으로 삭제하지 않습니다. 대부분의 "실수"는 사실 복구 가능한 상태 변화일 뿐입니다. Git의 핵심 구조를 이해하면 왜 복구가 가능한지 알 수 있습니다.

### Git의 기본 구조
- **객체(Object)**: 커밋, 파일 내용, 디렉토리 구조 등 모든 데이터는 객체로 저장됩니다.
- **참조(Ref)**: 브랜치와 태그는 특정 객체를 가리키는 포인터입니다.
- **reflog**: Git은 참조가 이동한 모든 기록을 보관합니다. 이것이 복구의 열쇠입니다.

### 기본 복구 원칙
1. **가장 먼저 `git reflog` 확인하기**: 최근 작업 기록을 살펴보세요.
2. **참조가 없더라도 객체는 살아있습니다**: 가비지 컬렉션 실행 전까지는 데이터가 유지됩니다.
3. **파일 단위 복구도 가능합니다**: 특정 커밋에서 개별 파일을 추출할 수 있습니다.

---

## 자주 발생하는 실수와 즉시 대응법

### 1. 잘못된 `git reset --hard` 실행
실수로 중요한 커밋을 삭제한 경우:

```bash
# 1. 작업 기록 확인
git reflog

# 2. 출력 예시:
# a3c22fb HEAD@{0}: reset: moving to HEAD~1
# 7b9d3f2 HEAD@{1}: commit: 중요한 기능 추가
# adf23f1 HEAD@{2}: commit: 기본 구조 작성

# 3. 원하는 시점으로 복구
git reset --hard HEAD@{1}

# 또는 안전하게 새 브랜치로 복구
git checkout -b 복구된브랜치 HEAD@{1}
```

### 2. 브랜치 실수로 삭제
```bash
# 삭제된 브랜치의 마지막 커밋 찾기
git reflog

# 출력에서 브랜치가 마지막으로 가리키던 커밋 확인
git checkout -b 복구된브랜치 [커밋해시]
```

### 3. 스태시(stash) 내용 잃어버림
```bash
# 1. 스태시 목록 확인
git stash list

# 2. 스태시가 비어있다면 dangling 객체 검색
git fsck --lost-found

# 3. 출력된 객체 확인
git show [객체해시]

# 4. 스태시로 복구
git stash apply [찾은커밋]
```

### 4. 리베이스(rebase) 중 문제 발생
```bash
# 현재 리베이스 중단하고 원래 상태로 복귀
git rebase --abort

# 또는 reflog를 사용해 완전히 되돌리기
git reflog
git reset --hard HEAD@{적절한번호}
```

### 5. 잘못된 파일 변경
```bash
# 특정 파일의 변경 이력 확인
git log --all -- 파일경로

# 과거 버전의 파일 복구
git checkout [커밋해시] -- 파일경로

# 또는 파일로 추출
git show [커밋해시]:파일경로 > 복구된파일.txt
```

---

## 고급 복구 기술

### `git fsck`로 완전히 연결이 끊긴 객체 찾기
참조가 완전히 사라진 객체도 복구할 수 있습니다:

```bash
# 고립된 객체 찾기
git fsck --lost-found

# 출력 예시:
# dangling commit 2e4f9a1d...
# dangling blob e1c1aa5b...

# 객체 내용 확인
git show 2e4f9a1d

# 브랜치로 승격
git checkout -b 복구된작업 2e4f9a1d
```

### 협업 환경에서의 실수: 강제 푸시 문제
다른 사람의 작업을 덮어쓴 경우:

```bash
# 안전한 강제 푸시 (다른 사람의 새 커밋이 있으면 거부)
git push --force-with-lease

# 이미 문제가 발생했다면 팀원에게 도움 요청
# 다른 팀원의 로컬 저장소에서 이전 상태를 찾아 복구
```

---

## 예방이 최선의 치료: 안전한 작업 습관

### 1. 위험한 명령어 사용 전 확인하기
```bash
# reset 하기 전 현재 상태 저장
git stash
# 또는
git switch -c 백업브랜치

# 브랜치 삭제 전 확인
git log --oneline --graph --decorate --all
```

### 2. 자동화된 백업 설정
```bash
# Git 설정에 유용한 알리아스 추가
git config --global alias.oops 'reflog --date=local'
git config --global alias.backup '!git switch -c backup/$(date +%Y%m%d-%H%M)'
```

### 3. 반복적인 충돌 해결 자동화
```bash
# 같은 충돌 패턴을 자동으로 해결하도록 학습
git config --global rerere.enabled true
```

### 4. 팀 차원의 안전 장치
- GitHub/GitLab의 브랜치 보호 규칙 설정
- PR(풀 리퀘스트) 필수화
- 코드 리뷰 의무화

---

## 실전 복구 연습

### 연습 1: `reset --hard` 실수 복구
```bash
# 테스트 저장소 생성
mkdir 복구연습 && cd 복구연습
git init

# 몇 개의 커밋 생성
echo "버전 1" > 파일.txt
git add . && git commit -m "커밋 1"
echo "버전 2" >> 파일.txt
git commit -am "커밋 2"
echo "버전 3" >> 파일.txt
git commit -am "커밋 3"

# 실수로 마지막 커밋 삭제
git reset --hard HEAD~1

# reflog로 복구
git reflog
git reset --hard HEAD@{1}
```

### 연습 2: 삭제된 브랜치 복구
```bash
# 브랜치 생성과 작업
git checkout -b 실험브랜치
echo "실험 내용" > 실험.txt
git add . && git commit -m "실험 작업"

# 브랜치 삭제 (실수)
git checkout main
git branch -D 실험브랜치

# 복구
git reflog
# 삭제된 브랜치가 마지막으로 가리키던 커밋 찾기
git checkout -b 복구된실험브랜치 [커밋해시]
```

---

## 상황별 빠른 참조표

| 상황 | 즉시 실행할 명령어 | 참고사항 |
|------|-------------------|----------|
| 커밋 날림 | `git reflog` → `git reset --hard HEAD@{n}` | n은 몇 단계 전인지 |
| 브랜치 삭제 | `git reflog` → `git checkout -b 새이름 [해시]` | 해시는 삭제 전 브랜치의 마지막 커밋 |
| 파일 실수 | `git checkout [커밋] -- 파일경로` | 특정 커밋의 파일 버전 추출 |
| 스태시 분실 | `git fsck --lost-found` → `git show [해시]` | dangling 객체 검색 |
| 리베이스 문제 | `git rebase --abort` | 즉시 중단하고 시작으로 복귀 |
| 강제푸시 사고 | `git push --force-with-lease` | 예방적 사용 권장 |

---

## 마무리: Git 복구 마인드셋

Git 실수는 개발자라면 누구나 경험하는 일입니다. 중요한 것은 당황하지 않고 체계적으로 접근하는 방법을 아는 것입니다.

### 기억해야 할 핵심 원칙

1. **Git은 기본적으로 데이터를 삭제하지 않습니다**: 대부분의 "삭제"는 참조(포인터)만 제거한 것이며, 실제 데이터는 일정 기간 유지됩니다.

2. **`git reflog`는 가장 강력한 복구 도구입니다**: 최근 90일간의 모든 작업 기록을 보관하므로, 대부분의 실수는 여기서 해결됩니다.

3. **예방이 최선의 복구책입니다**:
   - `reset --hard` 전에 항상 `git stash`나 백업 브랜치 생성
   - `git push --force-with-lease`로 안전한 강제 푸시
   - 복잡한 작업 전에 현재 상태 스냅샷 저장

4. **팀워크가 중요합니다**: 협업 환경에서는 한 사람의 실수가 모두에게 영향을 미칩니다. 브랜치 보호 규칙, 코드 리뷰, CI/CD 파이프라인 등 팀 차원의 안전 장치를 마련하세요.

5. **연습이 완벽을 만듭니다**: 실제 위기 상황에서 침착하게 대응하려면 평소에 복구 절차를 연습해보세요. 테스트 저장소를 만들어 다양한 실수 시나리오를 경험하는 것이 좋습니다.

Git은 강력한 버전 관리 시스템이지만, 그 힘은 사용법을 이해할 때 발휘됩니다. 실수를 두려워하지 말고, 오히려 실수를 통해 Git의 내부 동작을 더 깊이 이해하는 기회로 삼으세요. 이 지식은 단순한 복구 기술을 넘어, 더 효율적이고 안전한 개발 워크플로우를 구축하는 데 도움이 될 것입니다.