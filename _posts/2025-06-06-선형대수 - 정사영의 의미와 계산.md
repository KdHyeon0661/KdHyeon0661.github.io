---
layout: post
title: ì„ í˜•ëŒ€ìˆ˜ - ì •ì‚¬ì˜ì˜ ì˜ë¯¸ì™€ ê³„ì‚°
date: 2025-06-06 19:20:23 +0900
category: ì„ í˜•ëŒ€ìˆ˜
---
# ğŸ¯ ì •ì‚¬ì˜(Projection) ì™„ì „ ì •ë³µ â€” ì •ì˜ â†’ ìœ ë„ â†’ QR/SVD â†’ PyTorch ì‹¤ìŠµ

ì •ì‚¬ì˜ì€ **ë²¡í„°ë¥¼ ì§ì„ /í‰ë©´/ë¶€ë¶„ê³µê°„ì— ìˆ˜ì§ìœ¼ë¡œ ë‚´ë¦° ê·¸ë¦¼ì**ë‹¤.
ì´ í•œ ì¤„ì´ **ìµœì†Œì œê³±(Least Squares)**, **ì§êµ ë¶„í•´**, **ê±°ë¦¬ ê³„ì‚°**, **PCA/íšŒê·€**ê¹Œì§€ ê´€í†µí•œë‹¤.
ì•„ë˜ì—ì„œëŠ” ì§ê´€ â†’ ìˆ˜ì‹ â†’ êµ¬í˜„(ì•ˆì •ì„± ê³ ë ¤)ê¹Œì§€ í•œ ë²ˆì— ì •ë¦¬í•œë‹¤.

---

## í‘œê¸°ì™€ ì „ì œ

- ë²¡í„°ëŠ” êµµê²Œ: **v**, **u** (ì—´ë²¡í„°ë¡œ ìƒê°).
- ë‚´ì ê³¼ ë…¸ë¦„:
  $$
  \mathbf{a}\cdot\mathbf{b}=\mathbf{a}^\top \mathbf{b},\qquad
  \|\mathbf{a}\|=\sqrt{\mathbf{a}^\top\mathbf{a}}
  $$
- ë¶€ë¶„ê³µê°„ \(W=\mathrm{Col}(A)\): í–‰ë ¬ \(A\)ì˜ **ì—´ê³µê°„**.

---

## ë²¡í„° ìœ„ ì •ì‚¬ì˜ (1ì°¨ì› ì„œë¸ŒìŠ¤í˜ì´ìŠ¤)

### ì •ì˜(ë°©í–¥ **u**ë¡œì˜ ì •ì‚¬ì˜)

$$
\boxed{\;\mathrm{proj}_{\mathbf{u}}\mathbf{v}
= \frac{\mathbf{v}\cdot\mathbf{u}}{\mathbf{u}\cdot\mathbf{u}}\;\mathbf{u}\;}
$$

- **ìŠ¤ì¹¼ë¼ ì„±ë¶„(component)**:
  $$
  \mathrm{comp}_{\mathbf{u}}(\mathbf{v})=\frac{\mathbf{v}\cdot\mathbf{u}}{\|\mathbf{u}\|}
  $$
- **ì •ì‚¬ì˜ ë²¡í„°**(ë‹¨ìœ„ë°©í–¥ \(\hat{\mathbf{u}}=\mathbf{u}/\|\mathbf{u}\|\)):
  $$
  \mathrm{proj}_{\mathbf{u}}\mathbf{v}=(\mathbf{v}\cdot\hat{\mathbf{u}})\,\hat{\mathbf{u}}
  $$

### ìµœì í™” ê´€ì (ìœ ë„)

$$
\min_{\alpha\in\mathbb{R}}\|\mathbf{v}-\alpha \mathbf{u}\|^2
\;\Rightarrow\;
\alpha^\star=\frac{\mathbf{v}\cdot\mathbf{u}}{\mathbf{u}\cdot\mathbf{u}}
\quad\Rightarrow\quad
\mathrm{proj}_{\mathbf{u}}\mathbf{v}=\alpha^\star \mathbf{u}.
$$

### ì”ì°¨ì˜ ì§êµì„±

$$
\mathbf{r}=\mathbf{v}-\mathrm{proj}_{\mathbf{u}}\mathbf{v}\quad\Rightarrow\quad
\mathbf{r}\cdot \mathbf{u}=0.
$$

---

## ë¶€ë¶„ê³µê°„(ë‹¤ì°¨ì›) ìœ„ ì •ì‚¬ì˜

### ë¬¸ì œ ì„¤ì •

- \(W=\mathrm{Col}(A)\subset\mathbb{R}^m\) (ì—´ë²¡í„°ê°€ ê¸°ì € í›„ë³´), \(\mathbf{v}\in\mathbb{R}^m\).
- ëª©í‘œ: \(\mathbf{p}\in W\) ì¤‘ \(\|\mathbf{v}-\mathbf{p}\|\) ìµœì†Œ.

### ì •ê·œë°©ì •ì‹(Least Squares) ìœ ë„

$$
\mathbf{p}=A\mathbf{c},\quad
\min_{\mathbf{c}}\|\,\mathbf{v}-A\mathbf{c}\|^2
\;\Rightarrow\;
A^\top A\,\mathbf{c}=A^\top \mathbf{v}.
$$
(ì—´ë…ë¦½ ì‹œ)
$$
\mathbf{c}=(A^\top A)^{-1}A^\top\mathbf{v},\qquad
\boxed{\;\mathrm{proj}_{W}\mathbf{v}=A(A^\top A)^{-1}A^\top\mathbf{v}\;}
$$

### ì •ì‚¬ì˜ í–‰ë ¬ \(P\)

$$
\boxed{\,P=A(A^\top A)^{-1}A^\top\,},\qquad
\mathrm{proj}_{W}\mathbf{v}=P\mathbf{v}.
$$
ì„±ì§ˆ: ëŒ€ì¹­ \(P^\top=P\), ë©±ë“± \(P^2=P\), \(\mathrm{rank}(P)=\dim W\), ê³ ìœ ê°’ì€ 0/1.

### QR/SVD ê´€ì (ìˆ˜ì¹˜ ì•ˆì •)

- \(A=QR\) (ê²½ì œí˜• QR, \(Q\in\mathbb{R}^{m\times r}\), \(r=\mathrm{rank}(A)\))ì´ë©´
  $$
  \boxed{\,P=QQ^\top\,},\qquad \mathrm{proj}_{W}\mathbf{v}=Q(Q^\top \mathbf{v}).
  $$
- SVD \(A=U\Sigma V^\top\), ìœ íš¨ ë­í¬ \(r\):
  $$
  P=U_{[:,1:r]}U_{[:,1:r]}^\top.
  $$

### ë­í¬ ê²°í• ì‹œ(ì˜ì‚¬ì—­í–‰ë ¬)

$$
\boxed{\,P=AA^+\,}\quad(\text{ë¬´ì–´â€“íœë¡œì¦ˆ }A^+),\qquad \mathrm{proj}_{W}\mathbf{v}=AA^+\mathbf{v}.
$$

---

## ì›ì ì„ ì§€ë‚˜ì§€ ì•ŠëŠ” Affine ì§ì„ /í‰ë©´ ìœ„ ì •ì‚¬ì˜

### ì§ì„  \(\ell=\{\mathbf{p}_0+\alpha \mathbf{u}\}\)

$$
\boxed{\;\mathrm{proj}_{\ell}\mathbf{v}
=\mathbf{p}_0+\frac{(\mathbf{v}-\mathbf{p}_0)\cdot\mathbf{u}}{\mathbf{u}\cdot\mathbf{u}}\;\mathbf{u}\;}
$$

### í‰ë©´ \(\Pi\) (ë²•ì„  \(\mathbf{n}\), ì  \(\mathbf{p}_0\)) ë˜ëŠ” í‰ë©´ì‹ \(\mathbf{n}\cdot\mathbf{x}=d\)

$$
\mathrm{proj}_{\Pi}\mathbf{v}
=\mathbf{v}-\frac{(\mathbf{v}-\mathbf{p}_0)\cdot\mathbf{n}}{\|\mathbf{n}\|^2}\mathbf{n}
\quad\text{or}\quad
\mathbf{v}-\frac{\mathbf{n}\cdot\mathbf{v}-d}{\|\mathbf{n}\|^2}\mathbf{n}.
$$

---

## ê°ë„Â·ê±°ë¦¬Â·ì½”ì‚¬ì¸ ìœ ì‚¬ë„

- ê°ë„:
  $$
  \cos\theta=\frac{\mathbf{v}\cdot\mathbf{u}}{\|\mathbf{v}\|\,\|\mathbf{u}\|}.
  $$
- ì •ì‚¬ì˜ ê¸¸ì´: \(\|\mathrm{proj}_{\mathbf{u}}\mathbf{v}\|=\|\mathbf{v}\|\,|\cos\theta|\)
- ì§ì„ /í‰ë©´ê¹Œì§€ì˜ ê±°ë¦¬: \(\|\mathbf{v}-\mathrm{proj}\_\cdot \mathbf{v}\|\)
- í”¼íƒ€ê³ ë¼ìŠ¤(ì§êµ ë¶„í•´):
  $$
  \|\mathbf{v}\|^2=\|\mathrm{proj}_W\mathbf{v}\|^2+\|\mathbf{v}-\mathrm{proj}_W\mathbf{v}\|^2.
  $$

---

## ê³„ì‚° ë ˆì‹œí”¼(ì•ˆì •ì„± ìš°ì„ )

- \((A^\top A)^{-1}\) **ì§ì ‘ ê³„ì‚° ê¸ˆì§€**(ì¡°ê±´ìˆ˜ ì•…í™”).
- ê¶Œì¥: **QR**ë¡œ \(Q\)ë§Œ êµ¬í•´ \(Q(Q^\top v)\) ë˜ëŠ” **lstsq/SVD**.
- ëŒ€í˜• ë¬¸ì œì—ì„  **Pë¥¼ ë§Œë“¤ì§€ ë§ê³ ** ë°”ë¡œ \(Q(Q^\top v)\).

---

## PyTorch ì‹¤ì „ ì½”ë“œ(ê²€ì‚° í¬í•¨)

```python
import torch

def proj_on_vector(v, u, eps=1e-12):
    """
    v, u: (..., d) ë°°ì¹˜ ê°€ëŠ¥. u=0 ì²˜ë¦¬ì— ëŒ€ë¹„í•´ epsë¡œ ë¶„ëª¨ í•˜í•œ.
    """
    v = torch.as_tensor(v, dtype=torch.float64)
    u = torch.as_tensor(u, dtype=torch.float64)
    denom = (u * u).sum(dim=-1, keepdim=True).clamp_min(eps)
    alpha = (v * u).sum(dim=-1, keepdim=True) / denom
    return alpha * u

def proj_on_affine_line(v, p0, u, eps=1e-12):
    """
    ì  p0ë¥¼ ì§€ë‚˜ê³  ë°©í–¥ uì¸ ì§ì„ ì— vë¥¼ ì •ì‚¬ì˜.
    """
    v = torch.as_tensor(v, dtype=torch.float64)
    p0 = torch.as_tensor(p0, dtype=torch.float64)
    u  = torch.as_tensor(u, dtype=torch.float64)
    denom = (u*u).sum().clamp_min(eps)
    alpha = ((v - p0) * u).sum() / denom
    return p0 + alpha * u

def proj_on_plane_by_normal(v, n, d=None, p0=None, eps=1e-12):
    """
    ë²•ì„  n, í‰ë©´ì‹ nÂ·x=d ë˜ëŠ” í‰ë©´ ìœ„ ì  p0 ì œê³µ.
    """
    v = torch.as_tensor(v, dtype=torch.float64)
    n = torch.as_tensor(n, dtype=torch.float64)
    nn = (n*n).sum().clamp_min(eps)
    if d is not None:
        return v - ((v @ n - d)/nn) * n
    elif p0 is not None:
        return v - (((v - p0) @ n)/nn) * n
    else:
        raise ValueError("d ë˜ëŠ” p0 ì¤‘ í•˜ë‚˜ë¥¼ ì œê³µí•˜ì„¸ìš”.")

def proj_on_subspace_QR(v, A):
    """
    W=Col(A) ì •ì‚¬ì˜. A: (m, r), v: (m,) or (m, k)
    QRë¡œ Që¥¼ ì–»ì–´ proj = Q(Q^T v).
    """
    A = torch.as_tensor(A, dtype=torch.float64)
    v = torch.as_tensor(v, dtype=torch.float64)
    Q, R = torch.linalg.qr(A, mode='reduced')  # Q: (m,r)
    return Q @ (Q.T @ v)

def projection_matrix_QR(A):
    """
    êµìœ¡/ê²€ì‚°ìš©: P = Q Q^T (ëŒ€í˜• ë¬¸ì œì—ì„œëŠ” Pë¥¼ ë§Œë“¤ì§€ ë§ ê²ƒ)
    """
    A = torch.as_tensor(A, dtype=torch.float64)
    Q, R = torch.linalg.qr(A, mode='reduced')
    return Q @ Q.T

# ====== ê°„ë‹¨ ê²€ì‚° =======

v = torch.tensor([2., 3.])
u = torch.tensor([1., 0.])
p = proj_on_vector(v, u)
print("proj_u(v) =", p.tolist())            # [2., 0.]

p0 = torch.tensor([1., 1.])
u  = torch.tensor([2., 1.])
v  = torch.tensor([3., 4.])
p_line = proj_on_affine_line(v, p0, u)
print("proj_line(v) =", p_line.tolist())

n = torch.tensor([0., 0., 1.])
v3 = torch.tensor([2., 3., 4.])
p_plane = proj_on_plane_by_normal(v3, n, d=0.)  # z=0 í‰ë©´
print("proj_plane(v3) =", p_plane.tolist())     # [2., 3., 0.]

A = torch.tensor([[1.,0.],
                  [1.,1.],
                  [0.,1.]])  # R^3ì˜ 2D í‰ë©´
v = torch.tensor([1.,2.,3.])
pW = proj_on_subspace_QR(v, A)
print("proj_W(v) =", pW.tolist())

P = projection_matrix_QR(A)
sym_err = torch.norm(P - P.T).item()
idem_err = torch.norm(P @ P - P).item()
print("symmetry error:", sym_err, " idempotency error:", idem_err)
```

---

## ì†ìœ¼ë¡œ í‘¸ëŠ” ì˜ˆì œ

### 2D ë‹¨ì¼ ë²¡í„°

$$
\mathbf{v}=\begin{bmatrix}3\\4\end{bmatrix},\quad
\mathbf{u}=\begin{bmatrix}1\\1\end{bmatrix}.
$$
$$
\mathrm{proj}_{\mathbf{u}}\mathbf{v}
=\frac{3\cdot1+4\cdot1}{1^2+1^2}\begin{bmatrix}1\\1\end{bmatrix}
=\frac{7}{2}\begin{bmatrix}1\\1\end{bmatrix}
=\begin{bmatrix}3.5\\3.5\end{bmatrix}.
$$
ê±°ë¦¬ \(=\|\,[3,4]-[3.5,3.5]\,\|=\sqrt{0.5^2+0.5^2}=\sqrt{0.5}\).

### 3D í‰ë©´(ë²•ì„ ì‹)

í‰ë©´ \(x+2y+2z=6\) (ë²•ì„  \(\mathbf{n}=[1,2,2]\), \(d=6\)), ì  \(\mathbf{v}=[2,3,4]\):
$$
\mathrm{proj}_\Pi\mathbf{v}
=\mathbf{v}-\frac{\mathbf{n}\cdot\mathbf{v}-d}{\|\mathbf{n}\|^2}\mathbf{n}
=[2,3,4]-\frac{(2+6+8)-6}{1+4+4}[1,2,2]
=[2,3,4]-\frac{10}{9}[1,2,2]
=\left[\frac{8}{9},\frac{7}{9},\frac{8}{9}\right].
$$
í‰ë©´ê¹Œì§€ ê±°ë¦¬ \(=\dfrac{|\mathbf{n}\cdot\mathbf{v}-d|}{\|\mathbf{n}\|}=\dfrac{10}{3}\).

### ë¶€ë¶„ê³µê°„(ì—´ê³µê°„) â€” ê¸°ì €ê°€ ë¹„ì§êµì¼ ë•Œ

$$
A=\begin{bmatrix}
1&0\\
1&1\\
0&1
\end{bmatrix},\quad
\mathbf{v}=\begin{bmatrix}1\\2\\3\end{bmatrix}.
$$
ì •ê·œë°©ì •ì‹ \(A^\top A\,\mathbf{c}=A^\top \mathbf{v}\):
$$
A^\top A=\begin{bmatrix}2&1\\1&2\end{bmatrix},\quad
A^\top \mathbf{v}=\begin{bmatrix}3\\5\end{bmatrix}
\Rightarrow
\mathbf{c}=\begin{bmatrix}\frac{1}{3}\\ \frac{7}{3}\end{bmatrix},
\quad
\mathbf{p}=A\mathbf{c}
=\begin{bmatrix}\frac{1}{3}\\ \frac{8}{3}\\ \frac{7}{3}\end{bmatrix}.
$$

---

## ì‘ìš© ìš”ì•½

- **ìµœì†Œì œê³± íšŒê·€**: \( \hat{\beta}=(X^\top X)^{-1}X^\top y \)ëŠ” \(y\)ë¥¼ \(\mathrm{Col}(X)\)ë¡œ ì •ì‚¬ì˜í•œ ê³„ìˆ˜.
- **PCA**: ë°ì´í„° ì¤‘ì‹¬í™” í›„ ì£¼ì„±ë¶„ \(U_r\)ì— ì •ì‚¬ì˜ \( \hat{x}=U_rU_r^\top x \).
- **ê·¸ë˜í”½ìŠ¤/ê¸°í•˜**: ì -ì§ì„ /í‰ë©´ ìµœë‹¨ ê±°ë¦¬, ê·¸ë¦¼ì/ì¡°ëª….
- **ì‹ í˜¸ì²˜ë¦¬**: ì„œë¸ŒìŠ¤í˜ì´ìŠ¤ íˆ¬ì˜(ì¡ìŒ ì œê±°), ë¹”í¬ë°.

---

## ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜ & ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

1) ê¸°ì €ê°€ **ì •ê·œì§êµê°€ ì•„ë‹Œë°** ì¶•ë³„ ë‹¨ìˆœ íˆ¬ì˜ í•©ì‚° â†’ âŒ â†’ ì •ê·œë°©ì •ì‹/QR ì‚¬ìš©.
2) \((A^\top A)^{-1}\) **ì§ì ‘** ê³„ì‚° â†’ âŒ â†’ `QR`, `lstsq`, SVD.
3) \(\mathbf{u}=\mathbf{0}\) ê²½ê³„ ì²˜ë¦¬ ëˆ„ë½ â†’ âŒ â†’ `eps`ë¡œ í•˜í•œ/ì˜ˆì™¸.
4) **ì •ì‚¬ì˜ í–‰ë ¬ P**ë¥¼ ëŒ€ê·œëª¨ë¡œ ìƒì„± â†’ ë©”ëª¨ë¦¬/ì‹œê°„ í­ë°œ â†’ \(Q(Q^\top v)\)ë¡œ ì§ì ‘ ì ìš©.
5) ë­í¬ ê²°í•/ììœ ë³€ìˆ˜ ë¬´ì‹œ â†’ ê²°ê³¼ ë¶ˆì•ˆì • â†’ `lstsq(rcond=â€¦)`, SVD ê¸°ë°˜ ì˜ì‚¬ì—­í–‰ë ¬.

---

## ì¹˜íŠ¸ì‹œíŠ¸

- ë²¡í„°:
  $$
  \mathrm{proj}_{\mathbf{u}}\mathbf{v}
  =\frac{\mathbf{v}\cdot\mathbf{u}}{\mathbf{u}\cdot\mathbf{u}}\mathbf{u}
  $$
- ì„œë¸ŒìŠ¤í˜ì´ìŠ¤(ì—´ë…ë¦½ ê°€ì •):
  $$
  P=A(A^\top A)^{-1}A^\top,\qquad \mathrm{proj}_{W}\mathbf{v}=P\mathbf{v}
  $$
- QR:
  $$
  A=QR\Rightarrow P=QQ^\top,\quad \mathrm{proj}_{W}\mathbf{v}=Q(Q^\top v)
  $$
- í‰ë©´(ë²•ì„  \(n\), ìƒìˆ˜ \(d\)):
  $$
  \mathrm{proj}_\Pi v=v-\frac{n\cdot v-d}{\|n\|^2}n
  $$
- ì§ì„ (ì  \(p_0\), ë°©í–¥ \(u\)):
  $$
  \mathrm{proj}_\ell v=p_0+\frac{(v-p_0)\cdot u}{\|u\|^2}u
  $$
- ì”ì°¨ ì§êµ: \((v-\mathrm{proj}_W v)\perp W\)
- \(P\) ì„±ì§ˆ: ëŒ€ì¹­, ë©±ë“±, ê³ ìœ ê°’ \(\{0,1\}\)
