---
layout: post
title: 미적분 - 벡터곱
date: 2025-08-25 17:20:23 +0900
category: 미적분
---
# 벡터곱(Cross Product) 완전 정복

## 1. 정의(성분 표현)와 행렬식 공식

두 벡터 $$\vec a=\langle a_1,a_2,a_3\rangle,\ \vec b=\langle b_1,b_2,b_3\rangle$$ 에 대해
$$
\vec a \times \vec b \;=\;
\begin{vmatrix}
\hat{\imath}&\hat{\jmath}&\hat{k}\\
a_1&a_2&a_3\\
b_1&b_2&b_3
\end{vmatrix}
\;=\;
\big(a_2b_3-a_3b_2,\; a_3b_1-a_1b_3,\; a_1b_2-a_2b_1\big).
$$

- 결과는 **벡터**이고, 항상 $$\vec a,\vec b$$ 가 생성하는 평면에 **수직**이다.
- **오른손 법칙**으로 방향(부호)을 정한다.

---

## 2. 기하학적 의미(정향·넓이·법선)

- **크기**: $$\lVert \vec a\times \vec b\rVert = \lVert \vec a\rVert \,\lVert \vec b\rVert \,\sin\theta.$$
  - 두 벡터가 만드는 **평행사변형 넓이**와 동일.
  - **삼각형 넓이**는 $$\frac12 \lVert \vec a\times \vec b\rVert.$$
- **방향**: $$\vec a,\vec b$$ 에 모두 수직이며, $$\vec a$$ 에서 $$\vec b$$ 로 **회전하는 방향**에 대해 오른손 법칙을 따른다.
- **정향(orientation)**: 정규화된 $$\hat n = \frac{\vec a\times\vec b}{\lVert \vec a\times\vec b\rVert}$$ 는 면의 **법선**(정향 포함)을 준다.

> 평행(또는 하나가 영벡터)이면 $$\vec a\times \vec b=\vec 0$$. 이때 법선이 정의되지 않으므로 별도 처리 필요.

---

## 3. 핵심 항등식과 성질

| 항등식 | 내용/의미 |
|---|---|
| 반교환성 | $$\vec a\times\vec b=-(\vec b\times\vec a)$$ |
| 분배법칙 | $$\vec a\times(\vec b+\vec c)=(\vec a\times\vec b)+(\vec a\times\vec c)$$ |
| 스칼라 결합 | $$(k\vec a)\times\vec b=k(\vec a\times\vec b)$$ |
| **라그랑주 항등식** | $$\lVert \vec a\times\vec b\rVert^2=\lVert \vec a\rVert^2\lVert \vec b\rVert^2-(\vec a\cdot\vec b)^2$$ |
| **BAC–CAB**(벡터 삼중곱) | $$\vec a\times(\vec b\times\vec c)=\vec b(\vec a\cdot\vec c)-\vec c(\vec a\cdot\vec b)$$ |
| **혼합 삼중곱** | $$(\vec a\times\vec b)\cdot\vec c=\det[\vec a\,\vec b\,\vec c]$$(부호 있는 **부피**) |

- 혼합 삼중곱의 절댓값은 세 벡터가 만드는 **평행육면체 부피**. 0이면 세 벡터는 **공면(또는 선형 종속)**.

---

## 4. 2차원과의 관계: “유사 교차”(부호 있는 넓이)

2D 벡터 $$\mathbf{u}=(x_1,y_1),\ \mathbf{v}=(x_2,y_2)$$ 에 대해  
$$
\text{cross2D}(\mathbf{u},\mathbf{v}) \;=\; x_1y_2 - y_1x_2
$$
는 3D 교차곱의 **z-성분**에 해당한다.

- $$\text{sign}(\text{cross2D})$$ 로 **정향(좌/우회전)** 판정.
- $$\frac12\sum_i x_i y_{i+1}-y_i x_{i+1}$$ 는 다각형의 **부호 있는 면적**(그린 정리/신발끈 공식).

---

## 5. 실무 응용 패턴(그래픽스·물리·기하)

### 5.1 삼각형/다각형 면적
- 삼각형 $$\triangle ABC$$:  
  $$\text{Area}=\frac12\lVert (\vec B-\vec A)\times(\vec C-\vec A)\rVert.$$
- 다각형(평면)은 인접 변의 cross2D 합으로 계산(정점 반시계 정렬 시 양수).

### 5.2 면 법선과 평면 방정식
- $$\vec n=(\vec B-\vec A)\times(\vec C-\vec A),\quad \text{평면: } \vec n\cdot(\vec x-\vec A)=0.$$
- **단위 법선** $$\hat n=\vec n/\lVert\vec n\rVert$$ 은 셰이딩/충돌에서 필수.

### 5.3 선·평면까지의 거리
- 점 $$\vec p$$ 에서 직선 $$\vec x=\vec a+t\vec d$$ 까지:  
  $$\text{dist}=\frac{\lVert(\vec p-\vec a)\times\vec d\rVert}{\lVert\vec d\rVert}.$$
- 점에서 평면 $$\vec n\cdot(\vec x-\vec a)=0$$ 까지:  
  $$\text{dist}=\frac{|\vec n\cdot(\vec p-\vec a)|}{\lVert\vec n\rVert}.$$

### 5.4 토크와 각운동량
- **토크**: $$\vec\tau=\vec r\times\vec F.$$
- **각운동량**: $$\vec L=\vec r\times\vec p.$$

### 5.5 기저 구성(오소노멀 프레임)
주어진 단위 벡터 $$\hat u$$ 에 수직인 방향 $$\hat v$$ 를 잡고  
$$\hat w=\hat u\times\hat v$$ 로 **우수좌표계(RHS)** 를 구성(카메라/월드 프레임).

### 5.6 평행/수직 판정(수치 허용오차 포함)
- $$\lVert\vec a\times\vec b\rVert\approx 0$$ 이면 **평행**(또는 영벡터 포함).  
- $$\vec a\cdot\vec b\approx 0$$ 이면 **수직**.  
- 실무에선 $$\varepsilon$$ 임계값을 둔다.

---

## 6. 예제 계산(손계산)

### 예제 1) 기본 계산
$$
\vec a=(1,2,3),\ \vec b=(4,5,6)\ \Rightarrow\
\vec a\times\vec b=(-3,6,-3).
$$
검산:  
$$\lVert\vec a\times\vec b\rVert^2=9+36+9=54,$$
라그랑주 항등식 RHS  
$$\lVert\vec a\rVert^2\lVert\vec b\rVert^2-(\vec a\cdot\vec b)^2=(14)(77)-32^2=1078-1024=54.$$

### 예제 2) 삼각형 넓이
$$
A=(1,0,0),\ B=(0,1,0),\ C=(0,0,1).
$$
$$
(B-A)\times(C-A)=(-1,1,0)\times(-1,0,1)=(1,1,1),
$$
$$
\text{Area}=\frac12\sqrt{3}.
$$

### 예제 3) 토크
$$
\vec r=(0.5,0,0),\ \vec F=(0,10,0)\Rightarrow \vec\tau=(0,0,5).
$$

### 예제 4) 점–직선 거리
$$
\vec a=(0,0,0),\ \vec d=(1,1,0),\ \vec p=(1,0,1):
$$
$$
\text{dist}=\frac{\lVert(1,0,1)\times(1,1,0)\rVert}{\sqrt{2}}
=\frac{\lVert(-1,1,1)\rVert}{\sqrt{2}}=\frac{\sqrt{3}}{\sqrt{2}}.
$$

### 예제 5) 평면 방정식
$$
A=(1,0,0),\ B=(0,1,0),\ C=(0,0,1),
$$
$$
\vec n=(B-A)\times(C-A)=(1,1,1).
$$
평면: $$x+y+z=1.$$

---

## 7. 구현과 검산 코드

### 7.1 Python/NumPy — 교차·넓이·거리·법선
```python
import numpy as np

def cross(a, b):
    a = np.asarray(a, dtype=float)
    b = np.asarray(b, dtype=float)
    return np.array([
        a[1]*b[2] - a[2]*b[1],
        a[2]*b[0] - a[0]*b[2],
        a[0]*b[1] - a[1]*b[0]
    ])

def triangle_area(A, B, C):
    return 0.5 * np.linalg.norm(cross(np.subtract(B,A), np.subtract(C,A)))

def point_line_distance(p, a, d):
    # line x = a + t d
    return np.linalg.norm(cross(np.subtract(p,a), d)) / np.linalg.norm(d)

def plane_from_points(A, B, C):
    n = cross(np.subtract(B,A), np.subtract(C,A))
    d = -np.dot(n, A)
    return n, d  # plane: n·x + d = 0

# tests
a = np.array([1,2,3]); b = np.array([4,5,6])
print("a×b =", cross(a,b))  # [-3, 6, -3]

A = np.array([1,0,0]); B = np.array([0,1,0]); C = np.array([0,0,1])
print("Triangle area =", triangle_area(A,B,C))  # ~0.8660254

p = np.array([1,0,1]); L_a = np.array([0,0,0]); L_d = np.array([1,1,0])
print("Point-line distance =", point_line_distance(p, L_a, L_d))

n, d = plane_from_points(A,B,C)
print("Plane: n·x + d = 0 -> n, d =", n, d)  # n=[1,1,1], d=-1
```

### 7.2 PyTorch — 배치 교차/면적(메시 처리)
```python
import torch

def batch_cross(a, b):
    # a,b: (...,3)
    return torch.stack([
        a[...,1]*b[...,2] - a[...,2]*b[...,1],
        a[...,2]*b[...,0] - a[...,0]*b[...,2],
        a[...,0]*b[...,1] - a[...,1]*b[...,0]
    ], dim=-1)

def triangle_areas(verts, faces):
    # verts: (V,3), faces: (F,3) long
    A = verts[faces[:,0]]
    B = verts[faces[:,1]]
    C = verts[faces[:,2]]
    X = B - A; Y = C - A
    return 0.5 * torch.linalg.vector_norm(batch_cross(X,Y), dim=-1)

# example
verts = torch.tensor([[1,0,0],[0,1,0],[0,0,1]], dtype=torch.float)
faces = torch.tensor([[0,1,2]])
print("Areas:", triangle_areas(verts, faces))  # tensor([0.8660])
```

### 7.3 C++ — 교차/도트/평면 방정식/거리(간결 구현)
```cpp
#include <array>
#include <cmath>
#include <iostream>

using Vec3 = std::array<double,3>;

Vec3 cross(const Vec3& a, const Vec3& b){
    return {
        a[1]*b[2]-a[2]*b[1],
        a[2]*b[0]-a[0]*b[2],
        a[0]*b[1]-a[1]*b[0]
    };
}
double dot(const Vec3& a, const Vec3& b){
    return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];
}
Vec3 sub(const Vec3& a, const Vec3& b){
    return {a[0]-b[0], a[1]-b[1], a[2]-b[2]};
}
double norm(const Vec3& v){ return std::sqrt(dot(v,v)); }

double triangle_area(const Vec3& A, const Vec3& B, const Vec3& C){
    Vec3 X=sub(B,A), Y=sub(C,A);
    return 0.5*norm(cross(X,Y));
}

double point_line_distance(const Vec3& p, const Vec3& a, const Vec3& d){
    return norm(cross(sub(p,a), d)) / norm(d);
}

int main(){
    Vec3 a{1,2,3}, b{4,5,6};
    Vec3 c = cross(a,b);
    std::cout<<"a×b = ("<<c[0]<<","<<c[1]<<","<<c[2]<<")\n";

    Vec3 A{1,0,0}, B{0,1,0}, C{0,0,1};
    std::cout<<"Triangle area = "<<triangle_area(A,B,C)<<"\n";

    Vec3 p{1,0,1}, L_a{0,0,0}, L_d{1,1,0};
    std::cout<<"Point-line distance = "<<point_line_distance(p,L_a,L_d)<<"\n";
}
```

---

## 8. 수치적 주의사항(현업 체크리스트)

1) **정규화와 안정성**: 평행·근접 평행이면 $$\lVert\vec a\times\vec b\rVert$$ 가 매우 작아진다.  
   - 임계값 $$\varepsilon$$ 로 분기 처리(예: 면 법선 결손 시 보정/재샘플).  
2) **정향 일관성**: 메시에서 삼각형 정점 순서(시계/반시계) 불일치 시 **플립**되어 조명/유량 부호가 뒤집힌다.  
3) **단위계/스케일**: 토크/각운동량 계산 시 단위(예: N·m, kg·m²/s) 확인.  
4) **반사 변환**: 거울 반사(음의 determinant) 적용 시 오른손 좌표계가 좌수계로 뒤집혀 **법선 방향 반전**.  
5) **영벡터/축퇴**: $$\vec a=\vec 0$$ 또는 $$\vec a\parallel\vec b$$ 일 때 예외 케이스로 처리.

---

## 9. 추가 심화: 외적과 외미분/쐐기곱(개념적 연결)

- 외적은 3차원에서 **쐐기곱(wedge, ∧)** 과 **호지 쌍대(Hodge dual)** 를 통해 얻은 **유사벡터**.  
- 좌표계 반전(반사)에서 외적 벡터는 **부호가 바뀌는** 성질(유사벡터)을 가진다.  
- 혼합 삼중곱은 $$\vec a\wedge\vec b\wedge\vec c$$ 의 부피형과 일치.

---

## 10. 빠른 요약

- **크기**: $$\lVert\vec a\times\vec b\rVert=\lVert\vec a\rVert\lVert\vec b\rVert\sin\theta$$ → 넓이  
- **방향**: $$\vec a,\vec b$$ 에 수직, **오른손 법칙**  
- **항등식**: 라그랑주, BAC–CAB, 혼합 삼중곱  
- **응용**: 면 법선, 면적, 거리, 평면식, 토크/각운동량, 오소노멀 기저  
- **2D**: cross2D로 정향/면적, 그린 정리/신발끈 공식  
- **실무**: 정향 일관성, 평행/축퇴 예외, 수치 안정성

---

## 11. 연습문제(풀이 아이디어 포함)

1) (넓이) 임의의 점 집합 $$\{V_i\}$$ 의 다각형 면적을 cross2D로 계산하고, 점 순서를 뒤집었을 때 부호가 어떻게 변하는지 확인하라.  
2) (부피/공면성) 임의의 $$\vec a,\vec b,\vec c$$ 에 대해 $$(\vec a\times\vec b)\cdot\vec c$$ 를 계산하고 0이 되는 조건을 기하학적으로 해석하라.  
3) (BAC–CAB) $$\vec a\times(\vec b\times\vec c)$$ 와 $$\vec b(\vec a\cdot\vec c)-\vec c(\vec a\cdot\vec b)$$ 을 임의 수치 예로 대입해 동치임을 검산하라.  
4) (거리) 점–직선 거리 공식을 유도하고, 수치 예로 오차를 검산하라(직교 투영 길이와의 비교).  
5) (법선) 삼각형 메시에서 각 면의 단위 법선을 계산한 뒤 정점 노말을 인접 면 노말의 가중 평균으로 구성해 보라(면적 가중).