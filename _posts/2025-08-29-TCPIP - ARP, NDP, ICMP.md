---
layout: post
title: TCPIP - ARP, NDP, ICMP
date: 2025-08-29 18:25:23 +0900
category: TCPIP
---
# ARP / NDP / ICMP

**(ğŸ”° ARP ë™ì‘Â·GARPÂ·ARP ìºì‹œ, ğŸ”° NDP/RA/RSÂ·DAD, âš™ï¸ ICMP ì—ëŸ¬/ì—ì½”ì™€ ì§„ë‹¨ í™œìš©)**

> ì´ ê¸€ì€ **ì£¼ì†Œ â†” ë§í¬ ê³„ì¸µ ì£¼ì†Œ ë§¤í•‘(ARP/NDP)** ê³¼ **ì˜¤ë¥˜Â·ì§„ë‹¨ ë©”ì‹œì§€(ICMP/ICMPv6)** ë¥¼ **í˜„ì¥ ê´€ì°° í¬ì¸íŠ¸**ì™€ í•¨ê»˜ ì •ë¦¬í•©ë‹ˆë‹¤.
> ì½”ë“œ ëŒ€ì‹  **íŒ¨í‚· í•„ë“œÂ·ë‹¤ì´ì–´ê·¸ë¨Â·ëª…ë ¹ ì¶œë ¥(ì˜ˆì‹œ)** ì¤‘ì‹¬ì´ë©°, ìˆ˜ì‹ì€ MathJaxë¡œ í‘œê¸°í•©ë‹ˆë‹¤.

---

## ì™œ ARP / NDP / ICMP ì¸ê°€

- **ARP(IPv4)** & **NDP(IPv6)**: ê°™ì€ L2 ë„ë©”ì¸ì—ì„œ **IP â†’ MAC** ë§¤í•‘ì„ í•´ê²°í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ê°€ ë¶ˆì•ˆì •í•˜ë©´ **í•‘ íƒ€ì„ì•„ì›ƒÂ·ê°„í— ëŠê¹€**ì´ L3/L7 ë¬¸ì œì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.
- **ICMP**: ê²½ë¡œ ì˜¤ë¥˜/í˜¼ì¡Â·MTU ë¬¸ì œë¥¼ **í‘œì¤€ ë°©ì‹ìœ¼ë¡œ ì•Œë¦¼**. ICMPë¥¼ ë§‰ìœ¼ë©´ **PMTUD ë¸”ë™í™€** ë“± **â€œí° ì‘ë‹µë§Œ ëŠê¹€â€** ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ë™ì‘, GARP, ARP ìºì‹œ  (ğŸ”°)

### ARPë€?

- ê°™ì€ L2(ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë„ë©”ì¸)ì—ì„œ **IPv4 â†’ MAC**ì„ ì•Œì•„ë‚´ê¸° ìœ„í•œ í”„ë¡œí† ì½œ.
- **í”„ë ˆì„ ëŒ€ìƒ**: ARP ìš”ì²­ì€ L2 ë¸Œë¡œë“œìºìŠ¤íŠ¸(`ff:ff:ff:ff:ff:ff`), ì‘ë‹µì€ ë³´í†µ ìœ ë‹ˆìºìŠ¤íŠ¸.

#### ARP íŒ¨í‚·(í•µì‹¬ í•„ë“œ)

```
Hardware Type  : 1 (Ethernet)
Protocol Type  : 0x0800 (IPv4)
HLEN/PLEN      : 6/4 (MAC 6ë°”ì´íŠ¸ / IPv4 4ë°”ì´íŠ¸)
Opcode         : 1=Request, 2=Reply
Sender MAC/IP  : ìš”ì²­ì MAC/IP
Target MAC/IP  : (ìš”ì²­ ì‹œ) ë¯¸ìƒ/ì§ˆì˜ ëŒ€ìƒ IP
```

### ARP ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤

```text
Host A (192.0.2.10, MAC A)
Host B (192.0.2.20, MAC B)

1) Aê°€ Bì—ê²Œ IP íŒ¨í‚·ì„ ë³´ë‚´ë ¤ í•¨ â†’ Bì˜ MACì„ ëª¨ë¦„
2) A: "ëˆ„ê°€ 192.0.2.20 ì´ë‹ˆ? MAC ì•Œë ¤ì¤˜!"  (ARP Request, ë¸Œë¡œë“œìºìŠ¤íŠ¸)
3) B: "ë‚˜ì•¼! ë‚´ MACì€ Bì•¼."                (ARP Reply, ìœ ë‹ˆìºìŠ¤íŠ¸)
4) AëŠ” (192.0.2.20 â†’ MAC B)ë¥¼ ìºì‹œì— ì €ì¥í•˜ê³  L2 ìœ ë‹ˆìºìŠ¤íŠ¸ë¡œ í†µì‹ 
```

#### ëª…ë ¹ ì˜ˆì‹œ(ì‹¤í–‰ ì»¨ì…‰)

```text
# Linux

ip neigh show
# Windows

arp -a
```

> **ê´€ì°° í¬ì¸íŠ¸**: â€œARP ìš”ì²­ í­ì¦â€ì€ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë¶€í•˜ì™€ í•¨ê»˜ ì „ì²´ ì§€ì—°ì„ í‚¤ìš¸ ìˆ˜ ìˆìœ¼ë©°, **ë£¨í”„/ìŠ¤í†°**ì˜ ë‹¨ì„œê°€ ë˜ê¸°ë„ í•©ë‹ˆë‹¤.

### GARP(Gratuitous ARP)

- **ARP ìš”ì²­**ì´ì§€ë§Œ **ëŒ€ìƒ IP = ì†¡ì‹ ì IP** (ì‘ë‹µì„ ê¸°ëŒ€í•˜ì§€ ì•ŠìŒ).
- **ìš©ë„**
  1) **IP ì¶©ëŒ íƒì§€**: ë™ì¼ IPë¥¼ ê°€ì§„ ë‹¤ë¥¸ ë…¸ë“œê°€ ì‘ë‹µí•˜ë©´ ì¶©ëŒ.
  2) **ARP ìºì‹œ ê°±ì‹ **: HA(ì˜ˆ: VRRP) ì‹œ Active ì¸ìŠ¤í„´ìŠ¤ê°€ ë°”ë€Œë©´, ì£¼ë³€ ì¥ë¹„ ìºì‹œë¥¼ ë¹ ë¥´ê²Œ ìƒˆ MACìœ¼ë¡œ ì—…ë°ì´íŠ¸.
  3) **ì´ë™ ì•Œë¦¼**: VM/ì„œë²„ê°€ NIC ì´ë™Â·vMotion ëœ ë’¤ ê²½ë¡œ í•™ìŠµ ì´‰ì§„.

#### GARP ì˜ˆì‹œ(ê°œë…)

```text
VRRP ë§ˆìŠ¤í„° ì¥ì•  â†’ ë°±ì—…ì´ ë§ˆìŠ¤í„° ìŠ¹ê¸‰
â†’ ë°±ì—… ì¥ë¹„ê°€ VIPì— ëŒ€í•´ GARP ì „ì†¡
â†’ ìŠ¤ìœ„ì¹˜/í˜¸ìŠ¤íŠ¸ ARP ìºì‹œê°€ ìƒˆ MACìœ¼ë¡œ ê°±ì‹ 
â†’ ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ì„ ë‹¨ì¶•
```

### ARP ìºì‹œì™€ ìƒíƒœ

- **ìºì‹œ í•­ëª© ìƒíƒœ**(OSë³„ í‘œê¸° ë‹¤ë¦„): INCOMPLETE/REACHABLE/STALE/DELAY/PROBE ë“±.
- **ì—ì´ì§•**: ì¼ì • ì‹œê°„ í†µì‹ ì´ ì—†ìœ¼ë©´ STALE â†’ í•„ìš” ì‹œ ì¬ê²€ì¦(NS/Probe) í›„ REACHABLE.
- **ë¬¸ì œ íŒ¨í„´**
  - **í”Œë˜í•‘**: ê°™ì€ IPê°€ ë‹¤ë¥¸ MACìœ¼ë¡œ ìì£¼ ë°”ë€œ(HA ì „í™˜, ë£¨í”„, ìŠ¤í‘¸í•‘ ì˜ì‹¬).
  - **ìºì‹œ í¬ì´ì¦ˆë‹**: ì•…ì˜ì  ìŠ¤í‘¸í•‘ìœ¼ë¡œ ê²Œì´íŠ¸ì›¨ì´ MACì„ ê³µê²©ì MACìœ¼ë¡œ ë°”ê¿” L3 ë‹¨ì ˆ/ì¤‘ê°„ì ê³µê²© ê°€ëŠ¥ â†’ **DAI(ë™ì  ARP ê²€ì‚¬)** ë“± ë°©ì–´ í•„ìš”.

> **ë³´ì•ˆ ë©”ëª¨**: ì—¬ê¸°ì„œëŠ” **ê³µê²© ë°©ë²•**ì´ ì•„ë‹Œ **ë°©ì–´ ê°œë…**ë§Œ ë‹¤ë£¹ë‹ˆë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆ ë„¤íŠ¸ì›Œí¬ëŠ” **DAI/í¬íŠ¸ ë³´ì•ˆ/ë¶„ë¦¬Â·ì„¸ê·¸ë©˜í…Œì´ì…˜**ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

---

## NDP(IPv6): RS/RA, NS/NA, DAD (ğŸ”°)

> IPv6ì—ëŠ” ARPê°€ ì—†ê³ , **ICMPv6 ê¸°ë°˜ì˜ NDP**ê°€ ê·¸ ì—­í• ì„ í•©ë‹ˆë‹¤. IPv6ëŠ” **ë¸Œë¡œë“œìºìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©°**, í•„ìˆ˜ ë©€í‹°ìºìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### NDP ë©”ì‹œì§€ íƒ€ì…(í•µì‹¬)

- **Router Solicitation (RS, Type 133)**: í˜¸ìŠ¤íŠ¸ â†’ ë¼ìš°í„°. â€œRA ì¢€ ì£¼ì„¸ìš”.â€
- **Router Advertisement (RA, Type 134)**: ë¼ìš°í„° â†’ í˜¸ìŠ¤íŠ¸. í”„ë¦¬í”½ìŠ¤Â·ê²Œì´íŠ¸ì›¨ì´Â·MTUÂ·M/O í”Œë˜ê·¸ ë“±.
- **Neighbor Solicitation (NS, Type 135)**: ì´ì›ƒì˜ MAC ì§ˆì˜, ë˜ëŠ” DAD.
- **Neighbor Advertisement (NA, Type 136)**: NSì— ëŒ€í•œ ì‘ë‹µ(ìì‹ ì˜ L2 ì£¼ì†Œ ì•Œë¦¼).
- **Redirect (Type 137)**: ë” ì¢‹ì€ ë‹¤ìŒ í™‰ ì•Œë¦¼(ë³´ì•ˆìƒ ì œí•œì  ì‚¬ìš© ê¶Œì¥).

### RA/RSì™€ SLAAC

- **SLAAC**: RAê°€ ì œê³µí•˜ëŠ” ë³´ë¼ë²¨(prefix) ì •ë³´ë¡œ í˜¸ìŠ¤íŠ¸ê°€ **ììœ¨ì ìœ¼ë¡œ ì£¼ì†Œ êµ¬ì„±**.
- **M/O í”Œë˜ê·¸**
  - **M(Managed)**=1 â†’ DHCPv6ë¡œ ì£¼ì†Œ/ì˜µì…˜ ë°›ê¸°
  - **O(Other)**=1 â†’ ì£¼ì†ŒëŠ” SLAAC, ì¶”ê°€ ì˜µì…˜ì€ DHCPv6
- **RDNSS(Recursive DNS Server) ì˜µì…˜**: RAì— DNS ì •ë³´ í¬í•¨ ê°€ëŠ¥(RFC 8106).

#### RS/RA íë¦„(ì˜ˆì‹œ)

```text
í˜¸ìŠ¤íŠ¸ ë¶€íŒ… â†’ RS ì „ì†¡(ff02::2 ëª¨ë“  ë¼ìš°í„°)
ë¼ìš°í„° â†’ RA ì „ì†¡(í”„ë¦¬í”½ìŠ¤ 2001:db8:1::/64, MTU, ê²Œì´íŠ¸ì›¨ì´, RDNSS ë“±)
í˜¸ìŠ¤íŠ¸ â†’ ì¸í„°í˜ì´ìŠ¤ ì‹ë³„ì + í”„ë¦¬í”½ìŠ¤ë¡œ ê¸€ë¡œë²Œ ì£¼ì†Œ êµ¬ì„± (SLAAC)
```

### NDPì˜ ì´ì›ƒ íƒìƒ‰(NS/NA)

- **Solicited-Node ë©€í‹°ìºìŠ¤íŠ¸**(ff02::1:ffXX:XXXX) í™œìš©: í•„ìš”í•œ ëŒ€ìƒë§Œ ê¹¨ì›Œ íš¨ìœ¨ì .
- **NS**: â€œì´ IPv6 ì£¼ì†Œì˜ L2 ì£¼ì†ŒëŠ”?â€
- **NA**: â€œë‚´ MACì€ ì´ê²ƒì´ì•¼.â€ (í”Œë˜ê·¸: Solicited, Override ë“±)

#### ì˜ˆì‹œ(ê°œë…)

```text
í´ë¼ì´ì–¸íŠ¸(2001:db8:1::abcd:1234)ê°€ ê²Œì´íŠ¸ì›¨ì´(2001:db8:1::1)ì˜ MACì„ ëª¨ë¦„
â†’ ëŒ€ìƒì˜ Solicited-Node ê·¸ë£¹ìœ¼ë¡œ NS ì „ì†¡
â†’ ê²Œì´íŠ¸ì›¨ì´ê°€ NAë¡œ MAC ì•Œë¦¼
â†’ ì´í›„ ìœ ë‹ˆìºìŠ¤íŠ¸ í”„ë ˆì„ ìˆ˜ì†¡
```

### DAD(Duplicate Address Detection: ì¤‘ë³µì£¼ì†Œ íƒì§€)

- í˜¸ìŠ¤íŠ¸ê°€ ì£¼ì†Œë¥¼ **tentative(ê°€ì‹œì  ì‚¬ìš© ì „)** ìƒíƒœë¡œ ì¡ê³  **NSë¥¼ ìì‹ ì˜ ì£¼ì†Œì— ëŒ€í•´** ì†¡ì‹ (ì¶œë°œì§€ `::`).
- **ì‘ë‹µ(NA)ì´ ì˜¤ë©´ ì¶©ëŒ** â†’ ì£¼ì†Œ ì‚¬ìš© í¬ê¸°/ì¬ì‹œë„.
- **ê°€ìƒí™”Â·HA ì „í™˜Â·ì»¨í…Œì´ë„ˆ** í™˜ê²½ì—ì„œ DAD ë¯¸ìŠ¤ ì‹œ ìˆœê°„ ì¶©ëŒ/ëŠê¹€ ê°€ëŠ¥ â†’ RA/RS íƒ€ì´ë°Â·ND í”„ë¡ì‹œ ê³ ë ¤.

### NDP ë³´ì•ˆ ê°œìš”

- **RA-Guard**: ë¹„ì¸ê°€ RAë¥¼ ì°¨ë‹¨(ìŠ¤ìœ„ì¹˜ ì—£ì§€).
- **ND Inspection**(ë²¤ë”ë³„ ëª…ì¹­): IPv6ì— ëŒ€í•œ ARP Inspection ìœ ì‚¬ ê°œë….
- **SEND(SeND)**: Cryptographically Generated Addressë¡œ ND ë³´ì•ˆ ê°•í™”(ë³´ê¸‰ì€ ì œí•œì ).

---

## ICMP / ICMPv6: ì—ëŸ¬Â·ì—ì½”, ì§„ë‹¨ í™œìš© (âš™ï¸)

### & ICMPv6(IPv6) í° ê·¸ë¦¼

- **ì˜¤ë¥˜ ì•Œë¦¼ê³¼ ì§„ë‹¨**ì„ ìœ„í•œ ì œì–´ ë©”ì‹œì§€. ë¼ìš°í„°/í˜¸ìŠ¤íŠ¸ê°€ **ì™œ íŒ¨í‚·ì„ ì „ë‹¬/ì²˜ë¦¬í•  ìˆ˜ ì—†ì—ˆëŠ”ì§€** í‘œì¤€í™”ëœ ì´ìœ ë¥¼ ëŒë ¤ì¤ë‹ˆë‹¤.
- **ë§‰ìœ¼ë©´**: PMTUD ì‹¤íŒ¨, íŠ¸ë ˆì´ìŠ¤/í•‘ ë¶ˆê°€, ì›ì¸ ë¶„ì„ ë‚œì´ë„ ê¸‰ìƒìŠ¹.

### ëŒ€í‘œ íƒ€ì…Â·ì½”ë“œ(ìš”ì•½)

#### IPv4 ICMP (ì¼ë¶€)

| Type | ì´ë¦„ | ì£¼ìš” ì½”ë“œ | ì˜ë¯¸/í™œìš© |
|---|---|---|---|
| 0   | Echo Reply | 0 | í•‘ ì‘ë‹µ |
| 3   | Destination Unreachable | 0=Net, 1=Host, 3=Port, 4=Frag Needed | ê²½ë¡œ/í¬íŠ¸ ë¶ˆê°€, **Frag Needed**ëŠ” PMTUD í•µì‹¬ |
| 4   | Source Quench (êµ¬ì‹) | - | í˜¼ì¡ ì•Œë¦¼(íê¸°ë¨) |
| 5   | Redirect | - | ë” ì¢‹ì€ ê²Œì´íŠ¸ì›¨ì´(ë³´ì•ˆìƒ ì œí•œì ) |
| 8   | Echo Request | 0 | í•‘ ìš”ì²­ |
| 11  | Time Exceeded | 0=ì „ì†¡, 1=ì¬ì¡°ë¦½ | íŠ¸ë ˆì´ìŠ¤ë£¨íŠ¸ í•µì‹¬ |

#### IPv6 ICMPv6 (ì¼ë¶€)

| Type | ì´ë¦„ | ì˜ë¯¸ |
|---|---|---|
| 1   | Destination Unreachable | ë„ë‹¬ ë¶ˆê°€ |
| 2   | Packet Too Big | **PMTUD í•µì‹¬**(ê²½ë¡œ MTU ì•Œë¦¼) |
| 3   | Time Exceeded | í™‰ ì œí•œ ì´ˆê³¼(íŠ¸ë ˆì´ìŠ¤) |
| 4   | Parameter Problem | í—¤ë” ë¬¸ì œ |
| 128 | Echo Request | í•‘ ìš”ì²­ |
| 129 | Echo Reply | í•‘ ì‘ë‹µ |
| 133 | Router Solicitation | NDP |
| 134 | Router Advertisement | NDP |
| 135 | Neighbor Solicitation | NDP |
| 136 | Neighbor Advertisement | NDP |
| 137 | Redirect | NDP |

> **í•µì‹¬**: IPv4ì˜ `Frag Needed`ì™€ IPv6ì˜ `Packet Too Big`ì€ **PMTUDì— í•„ìˆ˜**ì…ë‹ˆë‹¤.

### Tracerouteì˜ ì›ë¦¬

- **TTL/Hop Limitì„ 1ë¶€í„° ì¦ê°€**ì‹œí‚¤ë©° ì „ì†¡ â†’ ê° í™‰ ë¼ìš°í„°ê°€ **Time Exceeded** ICMPë¥¼ íšŒì‹  â†’ **ê²½ë¡œ ì§€ë„** íšë“.
- UDP/ICMP/TCP ê¸°ë°˜ êµ¬í˜„ì´ ìˆìœ¼ë©°, ë°©í™”ë²½ ì •ì±…ì— ë”°ë¼ ì¼ë¶€ íƒ€ì…ì´ ì°¨ë‹¨ë  ìˆ˜ ìˆìŒ.

### PMTUDì™€ ICMP í•„í„°ë§

- PMTUDëŠ” **ICMPì— ì˜ì¡´**(v6ì€ `Packet Too Big`, v4ëŠ” `Frag Needed`).
- **ê³¼ë„í•œ ICMP ì°¨ë‹¨**ì€ â€œì‘ì€ ìš”ì²­ OK, **í° ì‘ë‹µë§Œ Hang**â€ ê³¼ ê°™ì€ **ë¸”ë™í™€**ì„ ìœ ë°œ.

> **ì‹¤ë¬´ íŒ**: ê²½ê³„ ë°©í™”ë²½ì—ì„œëŠ” **í•„ìˆ˜ ICMP íƒ€ì…Â·ì½”ë“œë§Œ í—ˆìš©**(ì˜ˆ: Too Big/Frag Needed, Time Exceeded)ì„ ê¶Œì¥. **ëª¨ë‘ ì°¨ë‹¨ â‰  ë³´ì•ˆ ê°•í™”**ê°€ ì•„ë‹™ë‹ˆë‹¤.

---

## ì—”ë“œíˆ¬ì—”ë“œ ì˜ˆì œ(í˜„ì¥ ì²´ê°)

### â€œì‘ì€ JSONì€ ë˜ëŠ”ë°, í° ë‹¤ìš´ë¡œë“œë§Œ ëŠê¸´ë‹¤â€

```text
ì¦ìƒ: ì‘ì€ API í˜¸ì¶œ OK, í° íŒŒì¼ ë‹¤ìš´ë¡œë“œ Hang/ëŠë¦¼
ê°€ì„¤: ì˜¤ë²„ë ˆì´(VXLAN)/QinQ/íƒœê¹…ìœ¼ë¡œ ì‹¤íš¨ MTU â†“ + ICMP í•„í„°ë§ â†’ PMTUD ì‹¤íŒ¨
ê´€ì°°: (v4) Frag Needed ì—†ìŒ / (v6) Packet Too Big ì—†ìŒ, ì¬ì „ì†¡ ë°˜ë³µ
ì¡°ì¹˜: í•„ìˆ˜ ICMP í—ˆìš©, MSS í´ë¨í•‘, ê²½ë¡œ MTU í‘œì¤€í™”
ê²°ê³¼: ëŒ€ìš©ëŸ‰ ì‘ë‹µë„ ì •ìƒ
```

### â€œê°‘ìê¸° ê°™ì€ ì¸µë§Œ í•‘ì´ íŠ„ë‹¤â€

```text
ì¦ìƒ: ë™ì¼ VLAN ì‚¬ìš©ìë“¤ì´ ê°„í—ì  íƒ€ì„ì•„ì›ƒ/ì§€ì—°
ê°€ì„¤: ARP ìš”ì²­ í­ì¦(ë£¨í”„/ìŠ¤í†°), ê²Œì´íŠ¸ì›¨ì´ MAC í”Œë˜í•‘
ê´€ì°°: ìŠ¤ìœ„ì¹˜ì—ì„œ MAC move/TC ì´ë²¤íŠ¸, ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¹´ìš´í„° ìƒìŠ¹, ARP í…Œì´ë¸” ê¸‰ë³€
ì¡°ì¹˜: STP/RSTP ì ê²€, BPDU Guard/PortFast, ìŠ¤í†° ì»¨íŠ¸ë¡¤, ì‚¬ìš©ì í—ˆë¸Œ ì œê±°
ê²°ê³¼: ì•ˆì •í™”
```

### â€œIPv6ë§Œ ëŠë¦¬ë‹¤ (Happy Eyeballsë¡œ v4ê°€ ë” ë¹¨ë¦¬ ì„ íƒ)â€

```text
ì¦ìƒ: ë“€ì–¼ìŠ¤íƒ í™˜ê²½ì—ì„œ v6 ì—°ê²°ì´ ì¼ê´€ë˜ê²Œ ëŠë ¤ v4ë¡œ í´ë°±
ê°€ì„¤: RA/RS ì§€ì—°, NDP ìºì‹œ ë¬¸ì œ, MTU/Packet Too Big ì°¨ë‹¨
ê´€ì°°: RA ê°„ê²©/ì§€ì—°, NS/NA ì‘ë‹µ ì‹œê°„, Too Big ë¶€ì¬
ì¡°ì¹˜: RA-Guard ì¬ê²€í† (ì˜¤íƒ ì°¨ë‹¨), ND Inspection, MTU ê²½ë¡œÂ·ICMPv6 í—ˆìš© ì¡°ì •
ê²°ê³¼: v6 ê²½ë¡œë„ ì•ˆì •ì  ì„ íƒ
```

---

## ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ARP / NDP

```text
- ARP/NDP ìºì‹œ ìƒíƒœ: INCOMPLETE/STALE ê³¼ë‹¤ ì—¬ë¶€
- GARP/NA(Override) ì´ë²¤íŠ¸: HA ì „í™˜ ì‹œì ê³¼ ì‚¬ìš©ì ëŠê¹€ ìƒê´€
- ë¸Œë¡œë“œìºìŠ¤íŠ¸/ë©€í‹°ìºìŠ¤íŠ¸ íŠ¸ë˜í”½ ë¹„ìœ¨(ë„ë©”ì¸ ê³¼ëŒ€ ì—¬ë¶€)
- DAI/RA-Guard/ND Inspection í™œì„±í™”(ì˜¤íƒ/ë¯¸ì ìš© ì ê²€)
- ê²Œì´íŠ¸ì›¨ì´ MAC í”Œë˜í•‘/ì´ë™ í”ì 
```

### ICMP / PMTUD

```text
- í•„ìˆ˜ ICMP íƒ€ì…/ì½”ë“œ í—ˆìš©(Frag Needed / Packet Too Big / Time Exceeded)
- ê²½ë¡œ MTU í‘œì¤€ê°’ê³¼ MSS í´ë¨í•‘ ì¼ê´€ì„±
- íŠ¸ë ˆì´ìŠ¤(ì‹œê°„ëŒ€ë³„)ë¡œ ê²½ë¡œ ê¸¸ì´Â·ì†ì‹¤Â·Too Big ê´€ì¸¡
```

### ë¡œê·¸Â·ê°€ì‹œì„±

```text
- ìŠ¤ìœ„ì¹˜: MAC Move/TC, ìŠ¤í†° ì¹´ìš´í„°, BPDU Guard íŠ¸ë¦¬ê±°
- ë¼ìš°í„°/ë°©í™”ë²½: ICMP rate-limit/ë“œë¡­ ë¡œê·¸
- í˜¸ìŠ¤íŠ¸: ip neigh / ndp í…Œì´ë¸” ìƒíƒœ, DAD ì‹¤íŒ¨ ì‚¬ë¡€
```

---

## ë¯¸ë‹ˆ ì‹¤ìŠµ(ì˜ë„ ì¤‘ì‹¬)

### â€œGARPë¡œ HA ì „í™˜ ì²´ê°â€

```text
ì˜ë„: VRRP/Keepalived ì „í™˜ ì‹œ ARP ê°±ì‹  ì²´ê°
ì ˆì°¨: Active ì¥ì•  ìœ ë„ â†’ ë°±ì—… ìŠ¹ê¸‰(GARP ë°œìƒ) â†’ ë‹¨ë§ í†µì‹  ì¤‘ë‹¨ ì‹œê°„ ì¸¡ì •
ê¸°ë¡: ëŠê¹€ ì‹œê°„(í‰ê· /ìµœëŒ€), ìŠ¤ìœ„ì¹˜ ë¡œê·¸ì˜ MAC ì´ë™
ê²°ê³¼: GARP ìœ ë¬´/ìˆ˜ëŸ‰ì— ë”°ë¥¸ ë³µêµ¬ ì‹œê°„ ì°¨ì´ ì²´ê°
```

### â€œNDP DAD ê´€ì°°â€

```text
ì˜ë„: IPv6 ì£¼ì†Œ ì¶©ëŒ ë°©ì§€ ì ˆì°¨ ì´í•´
ì ˆì°¨: ë™ì¼ ë§í¬ì—ì„œ ì¤‘ë³µ ì£¼ì†Œ ì„¤ì • ì‹œë„(í…ŒìŠ¤íŠ¸ë§) â†’ NS(DAD) ìˆ˜ì‹ /ì‘ë‹µ ê´€ì°°
ê²°ê³¼: DAD ì‹¤íŒ¨ ì‹œ ì£¼ì†Œ ë¯¸í™œì„±í™”/ì¬ì‹œë„ ë¡œì§ í™•ì¸
```

### â€œPMTUD ë¸”ë™í™€ ì¬í˜„â€

```text
ì˜ë„: í° ì‘ë‹µ ì‹¤íŒ¨ â†” ICMP ì°¨ë‹¨ì˜ ìƒê´€
ì ˆì°¨: DF ì„¤ì • í° íŒ¨í‚· ì „ì†¡ â†’ (v4) Frag Needed / (v6) Too Big ìˆ˜ì‹  ì—¬ë¶€ í™•ì¸
ëŒ€ì•ˆ: ICMP í—ˆìš© ì „í›„, MSS í´ë¨í•‘ ì „í›„ ë¹„êµ
ê²°ê³¼: í•„ìˆ˜ ICMP ì°¨ë‹¨ì´ ì•¼ê¸°í•˜ëŠ” ë¸”ë™í™€ í™•ì¸
```

### â€œTracerouteë¡œ ë¹„ëŒ€ì¹­ ê²½ë¡œ ê°ì§€â€

```text
ì˜ë„: ì™•ë³µ ê²½ë¡œê°€ ë‹¤ë¥¼ ë•Œ ì§„ë‹¨ì˜ ì–´ë ¤ì›€ ì²´ê°
ì ˆì°¨: ì–‘ë°©í–¥ì—ì„œ íŠ¸ë ˆì´ìŠ¤ â†’ í™‰/RTT ì°¨ì´ ê¸°ë¡
ê²°ê³¼: L4/L7 ì¦ìƒì´ L3 ì •ì±…/ë¹„ëŒ€ì¹­ ë•Œë¬¸ì„ì„ ì—°ê²°
```

---

## ìˆ˜ì¹˜Â·ìˆ˜ì‹ ë©”ëª¨

### ARP/NDP íŠ¸ë˜í”½ê³¼ ë¶€ë‹´

- ë¸Œë¡œë“œìºìŠ¤íŠ¸/ë©€í‹°ìºìŠ¤íŠ¸ ì¦ê°€ë¡œ **ëª¨ë“  ë…¸ë“œê°€ ì¸í„°ëŸ½íŠ¸**ë¥¼ ë°›ìœ¼ë¯€ë¡œ,
  ë§í¬ê°€ ë¹ ë¥¸ í™˜ê²½ì—ì„œë„ **CPU ì§€ì—°**ì´ ëŠ˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë„ë©”ì¸ ë¶„í• (VLAN), **í”„ë¡ì‹œ ARP/ND**, ìºì‹œ íƒ€ì´ë¨¸ íŠœë‹, ìŠ¤í†° ì»¨íŠ¸ë¡¤ë¡œ ì™„í™”.

### PMTUDì™€ ì²˜ë¦¬ëŸ‰ ì§ê´€

- **í° ì„¸ê·¸ë¨¼íŠ¸ê°€ ì§€ì† ë“œë¡­**ë˜ë©´ TCPëŠ” ì¬ì „ì†¡/í˜¼ì¡ ìœˆë„ìš° ì¶•ì†Œ â†’ ì²˜ë¦¬ëŸ‰ ê¸‰ê°.
- ì•ˆì „íŒìœ¼ë¡œ **MSS í´ë¨í•‘**ì„ ë‘ë˜, ì¥ê¸°ì ìœ¼ë¡œ **ê²½ë¡œ MTU ì •í•©/ICMP í—ˆìš©**ì´ ê·¼ë³¸ í•´ê²°.

\[
\text{ì‹¤íš¨ MSS} = \text{MTU} - \bigl(\text{IP í—¤ë”} + \text{TCP í—¤ë”} + \text{ì˜µì…˜/ì˜¤ë²„ë ˆì´}\bigr)
\]

---

## ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤(ìš”ì•½ ì¹´ë“œ)

- **ARP/NDP ì•ˆì •í™”**: VLAN ì„¸ë¶„í™”, DAI/RA-Guard/ND Inspection, GARP/NA í™œìš©, ìºì‹œÂ·íƒ€ì´ë¨¸ ì¼ê´€ì„±.
- **ICMP í•„ìˆ˜ í—ˆìš©**: (v4) **Frag Needed**, (v6) **Packet Too Big**, **Time Exceeded**. â€œICMP ì˜¬ì°¨ë‹¨â€ì€ **ì•ˆí‹° íŒ¨í„´**.
- **ë¬¸ì„œí™”**: ê²Œì´íŠ¸ì›¨ì´ MAC, VRRP/HSRP/VIP, ND/ARP ì •ì±…, MTUÂ·MSS ê¸°ì¤€.
- **ê°€ì‹œì„±**: MAC Move/TC/ìŠ¤í†°/ICMP ë“œë¡­ ì•ŒëŒ, ND/ARP ì‹¤íŒ¨ ì¹´ìš´í„° ìˆ˜ì§‘.
- **ë³€ê²½ê´€ë¦¬**: HA ì „í™˜Â·íŒì›¨ì–´ ì—…ê·¸ë ˆì´ë“œÂ·VLAN ë³€ê²½ ì‹œ **ë³€ê²½ ì°½/ë¡¤ë°±**.

---

## í•œ ì¥ ìš”ì•½(í¬ìŠ¤í„°)

- **ARP(IPv4)**: IPâ†’MAC ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì§ˆì˜/ìœ ë‹ˆìºìŠ¤íŠ¸ ì‘ë‹µ, **GARP**ë¡œ ì¶©ëŒíƒì§€/ìºì‹œê°±ì‹ .
- **NDP(IPv6)**: RS/RAë¡œ ê²½ë¡œÂ·í”„ë¦¬í”½ìŠ¤, NS/NAë¡œ ì´ì›ƒ MAC, **DAD**ë¡œ ì¤‘ë³µ ë°©ì§€. ë¸Œë¡œë“œìºìŠ¤íŠ¸ **ì—†ìŒ**, í•„ìˆ˜ ë©€í‹°ìºìŠ¤íŠ¸ ì‚¬ìš©.
- **ICMP/ICMPv6**: PMTUDÂ·íŠ¸ë ˆì´ìŠ¤Â·ì˜¤ë¥˜ ì•Œë¦¼ì˜ ìƒëª…ì„ . **í•„ìˆ˜ íƒ€ì… ì°¨ë‹¨ ê¸ˆì§€**.
- **í˜„ì¥ ì¦ìƒ**: â€œì‘ì€ ê±´ OK/í° ê±´ Failâ€, â€œê°™ì€ ì¸µë§Œ í•‘ íŠâ€, â€œIPv6ë§Œ ëŠë¦¼â€ â†’ **L2/ICMP/MTU**ë¶€í„° ì ê²€.

---

### ë¶€ë¡ A â€” ëª…ë ¹ ì¶œë ¥ ì˜ˆì‹œ(ê°œë…)

```text
# Linux: ì´ì›ƒ í…Œì´ë¸”

$ ip neigh
192.0.2.1 dev eth0 lladdr 00:11:22:33:44:55 REACHABLE
2001:db8:1::1 dev eth0 lladdr 00:11:22:33:44:66 STALE

# Windows: ARP í…Œì´ë¸”

C:\> arp -a
ì¸í„°í˜ì´ìŠ¤: 192.0.2.10 --- 0x9
  ì¸í„°ë„· ì£¼ì†Œ      ë¬¼ë¦¬ì  ì£¼ì†Œ           í˜•ì‹
  192.0.2.1        00-11-22-33-44-55     ë™ì 
```

```text
# ìŠ¤ìœ„ì¹˜(ë²¤ë” ì˜ˆì‹œ ê°œë…): ARP/NDP Inspection/RA-Guard ìƒíƒœ

Switch# show ip arp inspection
Switch# show ipv6 nd inspection
Switch# show ipv6 ra-guard policy
```

### ë¶€ë¡ B â€” íŒ¨í‚· í•„ë“œ ìŠ¤ëƒ…ìƒ·(ìš”ì•½)

```text
ARP Request:
- htype=1, ptype=0x0800, hlen=6, plen=4
- op=1 (request)
- sha=MAC(A), spa=192.0.2.10
- tha=00:00:00:00:00:00, tpa=192.0.2.20
(L2 dst=ff:ff:ff:ff:ff:ff)

ICMPv6 Neighbor Solicitation:
- Type=135 (NS), Code=0
- Target Address=2001:db8:1::1
- Option: Source Link-Layer Address (ìš”ì²­ì MAC)
(L2 dst=ff02::1:ff00:0001ì˜ ë§µí•‘ ë©€í‹°ìºìŠ¤íŠ¸ MAC)
```

### ë¶€ë¡ C â€” ê´€ì°° í…œí”Œë¦¿

```text
[ë‚ ì§œ/êµ¬ê°„] L2 VLAN-10(ì‚¬ë¬´ë™ 3ì¸µ) / L3 GW(192.0.2.1) / ë°©í™”ë²½(ê²½ê³„)
[ì¦ìƒ] í° íŒŒì¼ ë‹¤ìš´ë¡œë“œ Hang, ARP ìš”ì²­ ê¸‰ì¦, v6ë§Œ ëŠë¦¼
[ê°€ì„¤] PMTUD ë¸”ë™í™€, ê²Œì´íŠ¸ì›¨ì´ MAC í”Œë˜í•‘, RA ì˜¤íƒ ì°¨ë‹¨
[ê·¼ê±°] ICMP Too Big/Frag Needed ë¶€ì¬, MAC Move/TC ë¡œê·¸, RA-Guard ì¹´ìš´í„°
[ì¡°ì¹˜] í•„ìˆ˜ ICMP í—ˆìš©, BPDU Guard/Storm Control, RA-Guard ì •ì±… ì¡°ì •, MSS í´ë¨í•‘
[ê²°ê³¼/í›„ì†] ë³µêµ¬ ì‹œê°„, í‘œì¤€ MTU/MSS/ND/ARP ì •ì±… ë¬¸ì„œ ì—…ë°ì´íŠ¸
```
