---
layout: post
title: 네트워크보안 - 보안 아키텍처 사례집
date: 2025-10-31 23:25:23 +0900
category: 네트워크보안
---
# 28. 보안 아키텍처 사례집

> 목표  
> - **현실성 있는 3가지 레퍼런스 아키텍처**(온프렘 중소기업 / 클라우드 네이티브 스타트업 / 하이브리드 본사–지사–클라우드)와 각 구성 요소의 **보안 포인트, 운영 상의 지뢰**를 정리한다.  
> - “예산·인력·복잡도”의 **트레이드오프**를 명확히 하고, **표준 설정/템플릿/IaC** 샘플로 바로 시작할 수 있게 한다.  
> - **실습**: 레거시(Flat L2·공유 계정·무단 포트포워딩·NAS 무방비) 환경을 **제로트러스트 지향**으로 리디자인·마이그레이션하는 **핸즈온 절차**를 제공한다.  

---

## 28.1 온프렘 중소기업 표준 아키텍처

### 28.1.1 요구사항 가정(50~200명, 본사 1곳)
- **업무 시스템**: AD(또는 Azure AD Connect), 파일서버/NAS, 그룹웨어, 몇 개의 내부 웹앱
- **인터넷 경계**: 이중화 라우터/방화벽 + 프록시/URL 필터 + 이메일 보안 게이트웨이
- **엔드포인트**: Windows 10/11, 일부 Mac, 모바일 기기 BYOD 제한적 허용
- **보안 기본**: EDR/AV, 취약점 스캐너(분기), 패치/자산관리, 백업(오프사이트)
- **예산 제약**: **관리형 서비스 + OSS 혼합**, 인력 1~3명(IT/보안 겸임)

### 28.1.2 레퍼런스 토폴로지(논리)

```
         ┌──────── Internet ────────┐
         │                          │
   [SMTP 보호]  [DNS 필터]   [Threat Intel 피드]
         │             │             │
    ┌────▼────┐   ┌────▼────┐   ┌────▼────┐
    │  WAF/   │   │ Secure  │   │  SASE/  │(선택)
    │ Reverse │   │  Proxy  │   │ CASB    │
    └────┬────┘   └────┬────┘   └────┬────┘
         │             │             │
     ┌───▼─────────────▼─────────────▼───┐
     │           Next-Gen FW (HA)         │
     └───┬─────────────┬─────────────┬───┘
         │             │             │
      [DMZ]         [UserLAN]     [ServerLAN]
      Web/Jump       PC/Mac       AD, File, DB
         │                           │
         └─────►  NAC/802.1X  ◄─────┘
                    (Guest VLAN)
```

**핵심 포인트**
- **경계**: NGFW(앱 제어/IPS) + **리버스 프록시/WAF**로 외부 노출 최소화.  
- **UserLAN 분리**: 서버/관리 네트워크와 *L3 분할*, 최소 ACL.  
- **NAC/802.1X**: 인증 실패→**Guest VLAN**(인터넷 제한·내부 접근 불가).  
- **디렉터리**: AD(또는 Entra ID 하이브리드) + SSO(Conditional Access).  
- **백업**: 3-2-1(미디어 2종, 1개 오프사이트/오프라인), **암호화·복구 테스트** 필수.

### 28.1.3 방화벽·세그먼테이션(샘플 ACL)
- **원칙**: “모든 방향 **기본 거부** → **업무 플로우 단위** 허용”
```text
# ServerLAN(10.10.20.0/24) → DB(10.10.30.10:5432) 허용
permit tcp 10.10.20.0/24 host 10.10.30.10 eq 5432
# UserLAN → AD(DC: 10.10.30.5) Kerberos/LDAP/WinRM 제한 허용
permit tcp 10.10.10.0/24 host 10.10.30.5 eq 88,389,636,5985
# UserLAN → FileServer SMB(445) 허용, Guest VLAN 제외
permit tcp 10.10.10.0/24 10.10.40.0/24 eq 445
deny   ip  10.10.50.0/24 any   # Guest VLAN는 내부 차단
```

### 28.1.4 프록시·TLS·DNS 정책(예)
- **프록시**: 인증 프록시(+카테고리 필터, 파일형식 제한, 업로드 크기 제한)
- **TLS**: 내/외부 **TLS 1.2+**, HSTS 외부 서비스, 내부는 **mTLS(민감구간)** 검토
- **DNS**: 내부는 **로컬 리졸버 → 보안 DNS(DoT/DoH) 업스트림**, **악성 도메인 싱크홀**

**프록시 예시(Nginx 일부)**
```nginx
map $request_method $cacheable { default 0; GET 1; HEAD 1; }
map $http_content_type $upload_block { default 0; ~*multipart 1; }

server {
  # … TLS/인증 생략 …
  if ($upload_block) { return 403; }           # 대용량 업로드 차단 (정책 예)
  proxy_read_timeout 15s;
  proxy_send_timeout 15s;
  # 카테고리/URL 필터는 상용 게이트웨이/ICAP 연계 권장
}
```

### 28.1.5 엔드포인트/ID/로그
- **EDR/AV**: 공격면 최소화(취약 소프트 제거), **USB 제한/읽기전용**  
- **ID**: **MFA 기본**, 관리자 계정 분리, **Break-glass** 오프라인 보관  
- **로그**: FW/프록시/DNS/AD/EDR → **SIEM**(저비용: 오픈소스+S3 수명주기)

**Filebeat 수집 예(요약)**
```yaml
filebeat.inputs:
- type: filestream
  paths: ["/var/log/nginx/access.log"]
  fields: {source: "proxy"}
output.elasticsearch:
  hosts: ["http://es:9200"]
  index: "sec-%{[fields.source]}-%{+yyyy.MM.dd}"
```

### 28.1.6 백업·DR
- **중요 서버** 스냅샷(주 1회), 파일 단위 백업(매일 증분), **백업 네트워크 분리**  
- **복구 리허설**: 분기별 “From Scratch” 복구, **RTO/RPO 문서화**

---

## 28.2 클라우드 네이티브 스타트업 레퍼런스

### 28.2.1 요구사항 가정(서비스 빠른 출시·오토스케일)
- **클라우드 우선**(IaC/CI-CD), 매니지드 DB/메시지큐, 컨테이너 오케스트레이션(Kubernetes)
- **트래픽**: HTTPS REST/GraphQL + WebSocket, 글로벌 사용자
- **보안 기본**: **제로트러스트 지향**(ID 중심), **mTLS**(서비스 간), **비밀관리/회전**, **런타임 정책**

### 28.2.2 논리 아키텍처

```
          Internet
             |
        [ CDN / WAF ]
             |
         [ API GW ]
             |
        ┌────┴─────┐
   [Public Svc]  [Private Svc]
(K8s Ingress/ALB)  (K8s Internal Svc/mTLS)
        │              │
   [Service Mesh]  <---┘ (mTLS/Policy/Telemetry)
        │
   [Managed DB/Cache/Queue] (Private Endpoint)
        │
 [Observability] (Logs/Traces/Metrics → SIEM)
```

### 28.2.3 IAM·네트워킹·비밀관리

**IAM 원칙**
- 사람은 **SSO+MFA**, 권한은 **그룹/역할 기반**.  
- 워크로드는 **OIDC/Federated role**로 **키리스(Keyless)** 접근(장기 키 금지).  
- **권한 경계**: Prod/Stg/Dev 계정·프로젝트 분리, **정책 최소화**.

**VPC/보안 포인트**
- 퍼블릭/프라이빗 서브넷 분리, **NAT 게이트웨이** 최소화(비용/경로 관리)  
- **PrivateLink/Service Endpoint**로 DB/SaaS 접근, Security Group는 **흐름 단위**로 최소 허용  
- egress **제한**(만능 0.0.0.0/0 금지), **DNS 라우팅 정책**(사내 도메인 분리)

**비밀관리/회전**
- Secret Manager/Parameter Store + **KMS** 암호화  
- **자동 회전**: DB 사용자/인증서/토큰(파이프라인에 회전 훅)  
- 런타임 노출 방지: **Env 파일 금지**, **sidecar** 또는 SDK로 주입

**Terraform 스니펫(개념화)**
```hcl
# KMS Key
resource "aws_kms_key" "app" {
  description = "app-data"
  enable_key_rotation = true
}

# VPC (요약)
resource "aws_vpc" "main" { cidr_block = "10.1.0.0/16" }
# ... public/private subnets, route tables, nat gw 생략 ...

# SG 예: ALB → app only 443
resource "aws_security_group" "app_sg" {
  vpc_id = aws_vpc.main.id
  ingress {
    protocol = "tcp"
    from_port=443
    to_port  =443
    security_groups = [aws_security_group.alb_sg.id]
  }
  egress { from_port=0 to_port=0 protocol="-1" cidr_blocks=["10.1.0.0/16"] }
}
```

### 28.2.4 Kubernetes 보안 포인트
- **네임스페이스별 격리**, **NetworkPolicy** 기본 거부 → 필요한 흐름만 허용  
- **Service Mesh(mTLS)**: S2S 암호화 + **인증/인가 정책**(JWT/claim 기반)  
- **이미지 보안**: 서명/검증(COSIGN), 취약점 스캔, 런타임 프로파일(eBPF/Falco)  
- **Pod 보안**: 최소 권한(SA·PSP/PodSecurity), 읽기전용 루트, 능력(capabilities) 제거

**NetworkPolicy 예**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata: { name: allow-api-gw, namespace: prod }
spec:
  podSelector: { matchLabels: { app: backend } }
  policyTypes: ["Ingress","Egress"]
  ingress:
  - from:
    - namespaceSelector: { matchLabels: { role: "edge" } }
    ports: [{ protocol: TCP, port: 8443 }]
  egress:
  - to:
    - namespaceSelector: { matchLabels: { role: "data" } }
    ports: [{ protocol: TCP, port: 5432 }]
```

### 28.2.5 데이터/키 관리 패턴
- **테이블/객체 암호화**(투명 + 앱 레벨 AEAD 혼합)  
- **행/필드 단위 가명화**(목적 기반 접근)  
- **키 계층**: HSM Root → KMS Data Key → Field Key, **분리 권한/감사 로그**

### 28.2.6 관측·IR
- **수집**: Ingress/Envoy, App logs, K8s Audit, CloudTrail → 중앙 저장(S3/클라우드 로깅)  
- **탐지**: WAF/보호, API abuse, CORS 오남용, 토큰 재사용  
- **IR**: 이미지 롤백/파드 격리/네임스페이스 차단/토큰 폐기/키 회전 **플레이북** 문서화

---

## 28.3 하이브리드(본사-지사-클라우드) 연결 보안

### 28.3.1 과제
- **레거시 온프렘** + **지사 수십 개** + **클라우드**.  
- 요구: **일관된 ID·정책**, **안전한 WAN**, **로컬 브레이크아웃(인터넷)**, **SaaS 접근 통제**.

### 28.3.2 패턴 비교

| 패턴 | 장점 | 주의 |
|---|---|---|
| **IPsec VPN (Hub&Spoke)** | 단순, 상용 FW 호환 | 스케일/라우팅 복잡, 장애 시 영향 큼 |
| **SD-WAN** | 중앙정책, 애플리케이션 라우팅, SASE 연동 | 벤더 종속, PoP/라이선스 비용 |
| **Direct Cloud (Transit VPC/VNet)** | 클라우드간 라우팅 단순화 | 설계 난이도/비용, 리전 의존 |
| **ZTNA/SDP** | 사용자·디바이스 중심, 지사 장비 간소화 | L4/L7 프록시 한계·특정 트래픽 우회 필요 |

**권장 조합(현실)**: **SD-WAN + SASE**(지사 인터넷 로컬 브레이크아웃) + **클라우드 Transit** + **ZTNA**(원격·3rd party).

### 28.3.3 아이덴티티·세그먼트·프록시
- **아이덴티티**: Entra ID/Okta 등 **하나로 묶고**, **조건부 접근(MFA, 디바이스 포스처)**  
- **세그먼트**: 본사 DC(서버), OT/IoT(별도), 지사 UserLAN/Guest 분리, **클라우드 VPC/VNet 별도**  
- **프록시**: SASE PoP에서 **URL 카테고리/샌드박스/DLP**, 민감 앱은 **프라이빗 액세스(ZTNA)**

### 28.3.4 클라우드 경로(Transit + PrivateLink)
- 본사 ↔ 클라우드: **IPsec/Direct Connect/ExpressRoute**  
- 지사 ↔ SaaS/인터넷: **SASE PoP** 통해 검사  
- 내부 서비스: **PrivateLink/Endpoint**로 퍼블릭 우회, **mTLS** 강제

### 28.3.5 운영 체크리스트
- [ ] **라우팅 수렴/이중화**(BGP/ECMP), 최대 프리픽스 보호  
- [ ] **암호화 종단** 위치 문서화(클라우드–온프렘–사용자)  
- [ ] **중앙 로그**(지사 장비도 에이전트/수집)  
- [ ] **변경관리·템플릿화**(지사 신규 개설 자동화)  
- [ ] **IR**: 지사 격리/우회 경로 플레이북

---

## 28.4 실습: 레거시 환경 리디자인

> **시나리오**  
> - 문제: Flat L2, 공유 관리자 계정, NAS가 445/TCP 외부 노출, 임의 포트포워딩, 백업 미검증  
> - 목표: ① **L3 세그먼트** + 최소 ACL, ② **ID 기반 접근(SSO+MFA)**, ③ **프록시/이메일 보안**, ④ **백업/DR 정립**, ⑤ **가시성·탐지** 구축

### 28.4.1 단계별 로드맵(4주형)

**W1: 발견/모델링**
- 자산 스캔(Nmap/AD/CMDB), 포트포워딩/공개 서비스 목록화  
- 데이터 흐름(사용자→앱→DB→인터넷) **DFA** 작성, **RTO/RPO** 정의  
- 빠른 승리: **외부 SMB/NAS 차단**, 관리자 공유 계정 폐지 계획

**W2: L3 세그먼트 & 경계 보안**
- `UserLAN(10.10.10.0/24)`, `ServerLAN(10.10.20.0/24)`, `Guest(10.10.50.0/24)` 생성  
- FW 정책: **기본 거부** + 업무 플로우 허용(AD/Kerberos/SMB 제한, DB 최소)  
- 리버스 프록시/WAF로 외부 노출 앱만 공개, **NAS 외부 차단**

**W3: ID·프록시·백업**
- SSO+MFA(관리자 필수→전사 확장), **권한 분리**  
- 인증 프록시/카테고리 필터/멀웨어 검사, **DNS 싱크홀**  
- 백업: 3-2-1, 테스트 복구 리허설, **불변성(WORM)** 대상 정함

**W4: 로깅·탐지·훈련**
- FW/프록시/DNS/AD/EDR → SIEM 수집, 기본 룰(계정 잠금/SMB 탐지/내부 스캔)  
- IR 플레이북(격리/암호 리셋/티켓/법무 통지), 모의훈련(피싱·랜섬웨어 가정)

### 28.4.2 샘플 설계 아티팩트

**① 세그먼트 설계표**
| 세그먼트 | CIDR | 목적 | 출/입 규칙(요약) |
|---|---|---|---|
| UserLAN | 10.10.10.0/24 | 직원 단말 | → AD(Krb/LDAP), → Proxy(80/443), → File(445), ← 관리 금지 |
| ServerLAN | 10.10.20.0/24 | AD/File/DB | ← UserLAN 일부(AD/SMB), → DB 내부, → 백업 |
| Guest | 10.10.50.0/24 | 방문객 | 인터넷만, 내부 차단 |
| Mgmt | 10.10.60.0/24 | 관리 | Jump/Ansible 전용, Prod에만 접근 |

**② 방화벽 룰(예)**
```text
# 기본
deny ip any any

# User → Proxy (웹)
permit tcp 10.10.10.0/24 PROXY_LB eq 443

# Proxy → Internet (카테고리/ICAP 검사 통과 트래픽만)
permit tcp PROXY_LB 0.0.0.0/0 eq 80,443

# User → AD (Kerberos/LDAP/LDAPS/WinRM)
permit tcp 10.10.10.0/24 DCs eq 88,389,636,5985

# User → File (SMB 445), 시간대 제한(선택)
permit tcp 10.10.10.0/24 FILE_SRV eq 445 time-range BUSINESS_HOURS
```

**③ Nginx 리버스 프록시(WAF 앞단 또는 뒤)**
```nginx
upstream app { server 10.10.20.30:8443; keepalive 64; }
server {
  listen 443 ssl http2;
  # ssl_ciphers/headers/HSTS…
  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_pass https://app;
    proxy_read_timeout 10s;
    add_header X-Frame-Options DENY;
    add_header Content-Security-Policy "default-src 'self'";
  }
}
```

**④ DNS 싱크홀(BIND 개념)**
```conf
zone "malicious.example" { type master; file "/etc/bind/db.sink"; };
# db.sink: A 0.0.0.0 / TXT "Blocked"
```

**⑤ SIEM 기초 룰(Elastic KQL)**
```kql
/* 1) 내부 스캔 의심: 동일 호스트가 1분 내 20개 이상 포트 시도 */
index:firewall-* action: "deny" 
| stats count() as c by src_ip, dest_ip, dest_port, date_histogram(field="@timestamp", fixed_interval="1m")
| where c > 20

/* 2) SMB 외부 차단 검증 */
index:firewall-* dest_port: 445 and (dest_ip: NOT 10.0.0.0/8)
```

### 28.4.3 마이그레이션 절차(핸즈온)

**Step 1 — 외부 노출 차단/정상화**
- 포트포워딩 목록 → **WAF/리버스 프록시 경유**로 전환, NAS/SMB는 외부 완전 차단
- 외부 DNS 레코드 점검(CAA/SPF/DMARC/DKIM), **MX 스푸핑 경로 차단**

**Step 2 — 세그먼트 생성 & 라우팅**
- 코어 스위치/게이트웨이에서 **SVI** 생성, DHCP 스코프 분리  
- ACL 적용 후 각 세그먼트에 **테스트 단말** 배치 → 업무 플로우 체크리스트로 검증

**Step 3 — ID/프록시 연결**
- SSO 도입(SSO 포털→SaaS), **MFA→관리자→전사** 순 적용  
- 프록시 PAC/투명 프록시 설정, **파일/업로드 제한/샌드박스** 룰 점검

**Step 4 — 백업/DR**
- 파일/DB 백업 잡 구성, **복구 리허설**(샘플 데이터) 후 RTO/RPO 기록  
- 스냅샷/LTR(Long-Term Retention) 정책 설정, **WORM/Immutable** 기능 검토

**Step 5 — 로그/탐지**
- 수집 경로 테스트(FW/프록시/DNS/AD/EDR), 대시보드 위젯 배치  
- 알림 채널(Slack/Teams/Email), **티켓 자동 생성** 연결

### 28.4.4 운영 리스크 vs 이득 표

| 변경 | 기대 이득 | 리스크/부작용 | 완화책 |
|---|---|---|---|
| L3 세그먼트 + 기본 거부 | 측면 이동 차단, 사고 범위 축소 | 초기 업무 장애 | 점진적 릴리스, 화이트리스트 기반 |
| 프록시/카테고리 필터 | 맬웨어/피싱 차단, 로그 품질↑ | 오탐/속도 이슈 | 카나리 그룹, 캐시/정책 튜닝 |
| MFA 전사 적용 | 계정 탈취 방지 | 초기 반발 | 쉬운 기기 등록, 헬프데스크 보조 |
| 백업 Immutable | 랜섬웨어 복구력↑ | 저장비용↑ | 레벨별 보존기간 최적화 |
| 로그→SIEM 규칙 | 조기 탐지 | 경보 소음 | 억제/상관분석/UEBA 도입 |

### 28.4.5 검증 시나리오(테스트 케이스)
1) **세그먼트 간 차단**: UserLAN→DB(5432) 직접 접근 **불가**  
2) **프록시 우회 방지**: 단말에서 80/443 직접 접속 시 **차단/리다이렉트**  
3) **피싱 메일**: 샘플 캠페인 발송→게이트웨이/프록시/EDR 반응 기록  
4) **랜섬웨어 드릴**: FileServer 스냅샷 복구 시간 측정(RTO 확인)  
5) **로그 품질**: 24h 동안 탐지 룰 히트→오탐률 추정(억제 목록 업데이트)

---

## 부록 A. 의사결정 매트릭스(간단)

| 상황 | 권장 | 이유 |
|---|---|---|
| 인력 1~2명, 온프렘 중심 | **NGFW+프록시+EDR+AD+NAC(게스트)** | 표준·템플릿·장비 집중으로 운영 단순화 |
| 서비스 출시 빠름, 클라우드 100% | **IaC+WAF+API GW+Mesh mTLS+SecretMgr** | 자동화·분리권한·키리스 필수 |
| 지사 많음, SaaS 중심 | **SD-WAN+SASE+ZTNA** | 로컬 브레이크아웃+일관 정책 |
| 규제·데이터 지역성 | **현지 리전 저장+전송 암호화+mTLS** | 데이터 영지/감사 대응 |

---

## 부록 B. 체크리스트 (요약)

- [ ] **세그먼트 분리**(User/Server/Guest/Mgmt), **기본 거부**  
- [ ] **경계 보호**(WAF/프록시/이메일 보안/DNS 싱크홀)  
- [ ] **SSO+MFA**/권한 분리/Break-glass  
- [ ] **비밀관리/KMS/회전**, 장기 키 제거  
- [ ] **EDR/패치/자산관리**, 로컬 관리자 금지  
- [ ] **백업 3-2-1**, 복구 리허설·Immutable  
- [ ] **로그→SIEM**, 억제/상관 규칙, 알림→티켓  
- [ ] **문서화/운영 절차/롤백 계획** 유지

---

## 요약
- **온프렘 중소기업**은 **L3 세그먼트 + NGFW + 프록시 + EDR + 백업**을 최소 세트로 삼고, **ID 중심(MFA/SSO)**로 운영 복잡도를 줄인다.  
- **클라우드 네이티브**는 **IaC·메시(mTLS)·PrivateLink·키리스**를 기본값으로 삼아 **권한 경계**를 계정/프로젝트 단위로 격리한다.  
- **하이브리드**는 **SD-WAN+SASE+ZTNA**로 사용자·지사·클라우드 간 **일관된 정책면**을 만들고, **Transit/LB**로 경로를 단순화한다.  
- **실습 리디자인**은 4주 로드맵으로 **외부 노출 차단→세그먼트→ID/프록시→백업→SIEM/IR** 순서로 이행하면 위험을 최소화하며 효과를 즉시 체감할 수 있다.