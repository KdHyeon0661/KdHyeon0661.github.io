---
layout: post
title: 논리회로설계 - 래치와 플립플롭
date: 2025-09-03 23:25:23 +0900
category: 논리회로설계
---
# 래치와 플립플롭 — **S–R 래치**, **게이티드 D 래치**, **에지-트리거 D 플립플롭**, **S–R 플립플롭**

> 핵심 용어  
> - **래치(latch)**: **레벨-감지(level-sensitive)** 저장소. **Enable/CLK**가 특정 레벨일 때 입력을 “투명(transparent)”하게 통과시키고, 나머지 시간엔 유지(hold).  
> - **플립플롭(flip-flop)**: **에지-감지(edge-triggered)** 저장소. 클록의 특정 **에지**(↑ 또는 ↓)에서만 입력을 샘플해 저장.  
> - 기호: \( \overline{X} \) 또는 \(X'\)=NOT \(X\).

---

## 0) 큰 그림: 래치 vs 플립플롭

| 구분 | 민감도 | 동작 | 장점 | 주의점 |
|---|---|---|---|---|
| 래치 | 레벨 | Enable 구간에 **투명**, 그 외 **유지** | **타임 보로잉**(time borrowing) 가능 | 투명 창(window) 동안 **글리치 전파**, 의도치 않은 인퍼런스 위험 |
| 플립플롭 | 에지 | 에지 순간에만 샘플 | 동기 설계에 안전, 타이밍 분석 용이 | **셋업/홀드** 위반 시 메타안정성 |

---

## 1) **S–R 래치(Set–Reset Latch)**

### 1.1 NOR형(활성-High S,R) — 교차 결합 NOR
- 방정식(이상적 모델):
  \[
  \begin{aligned}
  Q &= \overline{R + \overline{\overline{S + \overline{Q}}}} \quad\text{(교차 결합)}\\
  \Rightarrow\ &\text{실무적으로는 진리표로 이해}
  \end{aligned}
  \]
- 진리표(이전 상태 \(Q_{prev}\)):
  
  | S | R | \(Q_{next}\) | 설명 |
  |:-:|:-:|:--:|:--|
  | 0 | 0 | \(Q_{prev}\) | 유지(hold) |
  | 1 | 0 | 1 | **Set** |
  | 0 | 1 | 0 | **Reset** |
  | 1 | 1 | **금지** | (둘 다 1 → 두 출력이 일시 0, 해제 시 **불확정/메타**) |

### 1.2 NAND형(활성-Low \( \overline{S},\overline{R} \)) — 교차 결합 NAND
- 진리표:

  | \(\overline{S}\) | \(\overline{R}\) | \(Q_{next}\) |
  |:-:|:-:|:--:|
  | 1 | 1 | \(Q_{prev}\) |
  | 0 | 1 | 1 (**Set**) |
  | 1 | 0 | 0 (**Reset**) |
  | 0 | 0 | **금지** |

### 1.3 특성/주의
- \(S\)와 \(R\)을 **동시에 활성**하면 **금지 상태**(메타안정성 위험).  
- 실제 게이트엔 관성 지연이 있어 “금지→해제” 순서에 따라 **어느 쪽으로 settle**할지 **예측 불가**.  
- **비동기 제어** 신호로서 **간단/저지연**이 장점이나, **글리치** 입력에 매우 민감.

### 1.4 VHDL 모델(시뮬/합성 가능)
```vhdl
-- 활성 High S,R  (금지 S=R='1'은 'X' 처리 권장)
entity sr_latch is
  port (S,R: in  std_logic; Q: out std_logic);
end entity;
architecture rtl of sr_latch is
  signal q_i: std_logic := '0';
begin
  process(all) is
  begin
    if    (S='1' and R='0') then q_i <= '1';
    elsif (S='0' and R='1') then q_i <= '0';
    elsif (S='0' and R='0') then q_i <= q_i;  -- hold
    else                           q_i <= 'X'; -- 금지
    end if;
  end process;
  Q <= q_i;
end architecture;
```

---

## 2) **게이티드 D 래치(Gated D Latch)**

### 2.1 아이디어
- S–R 래치의 **금지 상태 방지**:  
  \( S = \text{EN}\cdot D,\quad R = \text{EN}\cdot \overline{D} \) (NOR형 기준)  
  → EN=1일 때 **\(S,R\)이 동시에 1일 수 없음**.
- 동작:
  - **EN=1(투명)**: \(Q \leftarrow D\) (D의 변동이 **즉시** Q로)  
  - **EN=0(잠금)**: \(Q\) 유지

### 2.2 타이밍/장단점
- **장점**: 구현 간단, **시간 차용(time borrowing)**으로 느린 경로가 다음 단계로 일부 밀릴 수 있음(수정 가능 설계 기법).  
- **주의**: EN=1 동안 입력 **글리치**가 그대로 **Q에 전파**. 동기 설계에서 **의도치 않은 래치 인퍼런스**(불완전 할당)가 빈번한 버그 원인.

### 2.3 VHDL 모델
```vhdl
entity d_latch is
  port (D, EN: in  std_logic; Q: out std_logic);
end entity;
architecture rtl of d_latch is
  signal q_i: std_logic := '0';
begin
  process(all) is
  begin
    if EN='1' then
      q_i <= D;          -- 투명
    else
      q_i <= q_i;        -- 유지(합성기는 래치로 인식)
    end if;
  end process;
  Q <= q_i;
end architecture;
```

### 2.4 NAND-게이트 구현(활성-Low)
- \( \overline{S} = \overline{\text{EN}\cdot D},\ \overline{R} = \overline{\text{EN}\cdot \overline{D}} \)  
- EN가 ‘1’일 때만 내부 S/R 경로가 열림.

---

## 3) **에지-트리거 D 플립플롭(Edge-Triggered D FF)**

### 3.1 마스터–슬레이브 개념(래치 2개 직렬)
- **양(+) 에지 FF**:  
  - **마스터**: **CLK=0**에서 **투명**, **CLK=1**에서 **잠금**  
  - **슬레이브**: **CLK=1**에서 **투명**, **CLK=0**에서 **잠금**  
  → **상승(0→1) 에지 직후** 마스터가 막히며 입력을 캡처, 슬레이브가 열려 Q 갱신.
- **음(–) 에지 FF**는 위 극성이 반대.

### 3.2 타이밍 파라미터
- **셋업 \(t_{su}\)**: 에지 **이전**에 D가 안정되어야 하는 최소 시간  
- **홀드 \(t_h\)**: 에지 **이후**에 D가 유지되어야 하는 최소 시간  
- **클록→Q \(t_{CQ}\)**: 에지로부터 Q가 유효해지는 시간  
- **클록 최소 펄스폭 \(t_{w}\)**: CLK High/Low 최소 유지 시간  
- **(비동기) 복구·제거 \(t_{rec}, t_{rem}\)**: async set/reset 해제/적용 타이밍 제약

### 3.3 메타안정성
- \(t_{su}/t_h\) 위반 시 내부 노드가 **메타안정** 상태(중간 전압)로 머물 수 있음 → **불확정 지연** 후 0/1로 수렴.  
- **MTBF**(평균고장간격) 모델(개념):
  \[
  \mathrm{MTBF} \approx \frac{1}{f_{\text{clk}} f_{\text{data}}}\,C\,e^{\frac{T - T_0}{\tau}}
  \]
  - \(f_{\text{clk}}, f_{\text{data}}\): 시도 빈도, \(T\): 허용 여유, \(\tau\): 공정 상수  
  - **CDC** 입력엔 **2단(또는 그 이상) 동기화 FF 체인** 사용 권장.

### 3.4 VHDL 모델(비동기 리셋 포함)
```vhdl
entity dff_async is
  port (clk, rst_n: in std_logic; D: in std_logic; Q: out std_logic);
end;
architecture rtl of dff_async is
  signal q_i: std_logic := '0';
begin
  process(clk, rst_n) is
  begin
    if rst_n='0' then            -- 비동기 Active-Low Reset
      q_i <= '0';
    elsif rising_edge(clk) then  -- 에지 샘플
      q_i <= D;
    end if;
  end process;
  Q <= q_i;
end;
```

---

## 4) **S–R 플립플롭(Synchronous SR FF)**

### 4.1 정의
- **S**(set)와 **R**(reset)을 **클록 에지에서만** 샘플하는 FF.  
- **비동기 SR 입력**(preset/clear)과 구분: 동기형은 **에지**에만 반응.

### 4.2 진리표(양(+) 에지 기준, \(S,R\) 활성-High)
| S | R | \(Q_{next}\) | 비고 |
|:-:|:-:|:--:|:--|
| 0 | 0 | \(Q\) 유지 | Hold |
| 1 | 0 | 1 | Set |
| 0 | 1 | 0 | Reset |
| 1 | 1 | **금지** | 구현마다 금지/우선순위 정의 필요 |

> 실무에선 **D FF + 로직**으로 대체: \(D = S + \overline{R}\cdot Q\). (단, \(S=R=1\) 금지 규칙 유지)

### 4.3 VHDL 모델(동기 SR, 금지 시 ‘X’)
```vhdl
entity sr_ff is
  port (clk: in std_logic; S,R: in std_logic; Q: out std_logic);
end;
architecture rtl of sr_ff is
  signal q_i: std_logic := '0';
begin
  process(clk) is
  begin
    if rising_edge(clk) then
      if    (S='0' and R='0') then q_i <= q_i;
      elsif (S='1' and R='0') then q_i <= '1';
      elsif (S='0' and R='1') then q_i <= '0';
      else                         q_i <= 'X'; -- 금지
      end if;
    end if;
  end process;
  Q <= q_i;
end;
```

---

## 5) 타이밍도(ASCII)로 보는 동작

### 5.1 게이티드 D 래치 (EN=1 투명)
```
EN: ────████████───────████──────     (█=1 구간)
D : ──0────1110──0─────1───
Q : ──0────1110──0─────0───  ← EN=1 구간에 D가 그대로 통과
```

### 5.2 에지-트리거 D FF (↑에지)
```
CLK: _/‾\_/‾\_/‾\_/‾\_
D  : 0──1──0────1────0
Q  : 0───1────0────1──  ← 상승에지 직후에만 갱신, 중간 글리치 차단
```

---

## 6) 설계 지침(현장 포인트)

1. **동기 설계 기본**: 내부 상태 저장은 **에지 FF**로. 래치는 의도적으로 쓰는 경우(타임 보로잉, 저전력 게이팅) 외에는 **지양**.  
2. **래치 인퍼런스 주의**: VHDL **조합 프로세스**에서 **불완전 할당**을 하면 **래치**가 합성됨. `process(all)`+기본값/`others`로 방지.  
3. **비동기 리셋/셋**:  
   - **적용**은 비동기 가능, **해제**는 **클록 동기**로(회로 전체 일정한 상태로 시작).  
   - **복구/제거 시간** 준수(\(t_{rec}, t_{rem}\)).  
4. **CDC**: 다른 클록 도메인/비동기 입력은 **2단 이상 동기화 체인**으로 메타안정 리스크 저감.  
5. **펄스 폭**: 에지 FF는 **CLK 최소 펄스폭**, 래치는 **EN 최소 폭**을 충족해야 정상 동작.  
6. **SR 금지 상태**: 회피(우선순위 정의 or D 변환). 시스템 요건상 동시에 1이 가능한 경우는 **JK/T-FF** 또는 **동기 로직**으로 구조를 바꿔라.

---

## 7) 하드웨어 구현 스케치(논리 등가)

- **D 래치 = SR 래치 + 디코딩**  
  \[
  S = \text{EN}\cdot D,\quad R=\text{EN}\cdot \overline{D}
  \]
- **D FF(↑) = 래치(EN=\(\overline{\text{CLK}}\)) → 래치(EN=\(\text{CLK}\))**  
  (마스터–슬레이브, 반대 레벨 투명)  
- **SR FF(동기) = D FF + 조합**  
  \[
  D = S + \overline{R}\cdot Q
  \]

---

## 8) 빠른 비교 요약

| 소자 | 입력 | 제어 | 민감도 | 금지 상태 | 전형적 용도 |
|---|---|---|---|---|---|
| S–R 래치 | S,R | 없음 | 레벨 | **있음** | 간단 메모리, 비동기 제어 |
| D 래치 | D | EN | 레벨 | 없음(구조상 방지) | 버퍼/타임 보로잉 |
| D FF | D | CLK(↑/↓) | **에지** | 없음 | 동기 파이프라인 |
| S–R FF | S,R | CLK | **에지** | 구현에 따라 금지/우선 | 이벤트 래칭(금지 관리 필요) |

---

## 9) 체크리스트

- [ ] SR 금지 상태 입력이 존재하지 않게 **명세**/검증했는가?  
- [ ] 래치 사용 시 **EN 구간 글리치**가 Q로 전파되지 않도록 상위 로직을 안정시켰는가?  
- [ ] FF의 \(t_{su}, t_h, t_{CQ}, t_w\)를 **타이밍 분석**에 반영했는가?  
- [ ] 비동기 리셋의 **해제**를 **클록 동기화**했는가?  
- [ ] CDC 신호에 **2단 동기화**를 적용했는가?

---

### 부록: 간단 테스트벤치 아이디어
- 래치엔 **EN 펄스 폭 변화**와 **D 글리치**를 주어 Q 변화를 관찰.  
- D FF엔 **셋업/홀드 위반**(시뮬) 상황을 만들어 경고/파형 확인.  
- SR FF엔 \(S=R=1\) 케이스에 대해 **assert**로 금지 위반 탐지.