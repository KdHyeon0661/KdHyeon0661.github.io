---
layout: post
title: ì‹œìŠ¤í…œë³´ì•ˆ - ì²´í¬ë¦¬ìŠ¤íŠ¸/ì¹˜íŠ¸ì‹œíŠ¸
date: 2025-11-03 18:30:23 +0900
category: ì‹œìŠ¤í…œë³´ì•ˆ
---
# 20. ì²´í¬ë¦¬ìŠ¤íŠ¸/ì¹˜íŠ¸ì‹œíŠ¸ ëª¨ìŒ

## 20.1 ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ ì ê²€í‘œ(Win/Linux)

> ëª©í‘œ: â€œ**ê¶Œí•œ ìƒìŠ¹ ê²½ë¡œ**ê°€ ì¡´ì¬í•˜ëŠ”ì§€â€ë¥¼ ë¹ ë¥´ê²Œ ìŠ¤í¬ë¦¬ë‹í•˜ê³ , ë°œê²¬ ì‹œ **ì·¨ì•½ êµ¬ì„±ì„ ìˆ˜ì •**í•©ë‹ˆë‹¤.
> (â€» ì‹¤ìš´ì˜ì—ì„œëŠ” ëª¨ë“  ëª…ë ¹ì„ **ì½ê¸° ëª¨ë“œ**ë¡œ ìˆ˜í–‰í•˜ê³ , ë³€ê²½ì€ ë³€ê²½ê´€ë¦¬ ì ˆì°¨ì— ë”°ë¥´ì„¸ìš”.)

### 20.1.1 Windows LPE ì ê²€í‘œ

**A) ê³„ì •/ê¶Œí•œ/í† í°**
- âœ… ë¡œì»¬ ê´€ë¦¬ì/ì„œë“œíŒŒí‹° ì„œë¹„ìŠ¤ ê³„ì • **ìµœì†Œí™”**
- âœ… **UAC**: ê´€ë¦¬ì ìŠ¹ì¸ ëª¨ë“œ, Secure Desktop
- âœ… **LSA ë³´í˜¸(ì˜ë¬´)**: `RunAsPPL` í™œì„±í™”
- âœ… **Credential Guard** ê°€ëŠ¥ ì‹œ ì‚¬ìš©
- âœ… **ê°ì‚¬ ì •ì±…**: í”„ë¡œì„¸ìŠ¤ ìƒì„±(4688), ì„œë¹„ìŠ¤ ì„¤ì¹˜(7045), ì‘ì—… ìƒì„±(4698)

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```powershell
# ê´€ë¦¬ì ê·¸ë£¹ êµ¬ì„±ì›
Get-LocalGroupMember -Group "Administrators"

# UAC / LSA ë³´í˜¸ / Device Guard / Credential Guard
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" `
| Select-Object ConsentPromptBehaviorAdmin, PromptOnSecureDesktop

Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa" `
| Select-Object RunAsPPL

# ê¶Œí•œ(Privileges) ìš”ì•½
whoami /priv
```

**B) ì„œë¹„ìŠ¤/ìŠ¤ì¼€ì¤„ëŸ¬/ì´ë¯¸ì§€ ê²½ë¡œ ì·¨ì•½**
- âœ… ì„œë¹„ìŠ¤ **ë°”ì´ë„ˆë¦¬ ê²½ë¡œ ê³µë°±** + **ë”°ì˜´í‘œ ë¯¸ì„¤ì •** ê¸ˆì§€
- âœ… ì„œë¹„ìŠ¤ **ACL**: ë¹„ê´€ë¦¬ì ì“°ê¸° ê¸ˆì§€
- âœ… ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ **ë™ì‘ íŒŒì¼ ê²½ë¡œ** ê²€ì¦, ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ í™•ì¸
- âœ… **DLL ê²€ìƒ‰ ìˆœì„œ** í•˜ì´ì¬í‚¹ ë°©ì§€(ì‘ì—… ë””ë ‰í„°ë¦¬/ìƒëŒ€ê²½ë¡œ ê¸ˆì§€)

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```powershell
# ì„œë¹„ìŠ¤ ë°”ì´ë„ˆë¦¬ ê²½ë¡œ/ê³„ì •/ê¶Œí•œ í™•ì¸
Get-WmiObject win32_service | Select Name, StartName, PathName, State | Format-Table -Auto

# ì·¨ì•½ ê°€ëŠ¥ì„±(ë”°ì˜´í‘œX ê²½ë¡œ ì¤‘ ê³µë°± í¬í•¨)
Get-WmiObject win32_service | ? { $_.PathName -match '^[A-Za-z]:\\[^"]* [^"]*\.exe' -and $_.PathName -notmatch '"' } `
| Select Name, PathName

# ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ìš”ì•½
schtasks /query /fo LIST /v | findstr /i /c:"ì‘ì—… ì´ë¦„" /c:"ì‘ì—… ì‹¤í–‰" /c:"ì‹¤í–‰í•˜ëŠ” ê³„ì •"
```

**C) íŒŒì¼/ë ˆì§€ìŠ¤íŠ¸ë¦¬/ë¦¬ì†ŒìŠ¤ ê¶Œí•œ**
- âœ… ì‹œìŠ¤í…œ ë””ë ‰í„°ë¦¬(Program Files, Windows, System32) **Users ì“°ê¸° ê¸ˆì§€**
- âœ… **HKLM\...\Run/Services** ë“± ìë™ ì‹œì‘ ìœ„ì¹˜ **ê¶Œí•œ í™•ì¸**
- âœ… **Temp/Downloads** â†’ ì‹¤í–‰ê¶Œí•œ ì œí•œ(AppLocker/WDAC)

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```powershell
# í´ë” ACL ì ê²€(Usersì— Write/Modify ìˆìœ¼ë©´ ìœ„í—˜)
$paths = @("$env:ProgramFiles","$env:ProgramFiles(x86)","$env:windir")
foreach ($p in $paths) {
  Write-Host "== $p =="; icacls $p | Select-String -Pattern "Users:.\(M\)|(W)"
}

# ìë™ ì‹œì‘ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í™•ì¸
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Run"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run"
```

**D) ë©”ëª¨ë¦¬/ë“œë¼ì´ë²„/ì»¤ë„ í‘œë©´**
- âœ… ì»¤ë„ ë“œë¼ì´ë²„ **ì„œëª…ê°•ì œ**(HVCI) ì‚¬ìš© ê²€í† 
- âœ… ETW/AMSI **ë¹„í™œì„± íšŒí”¼ ì‹œë„ ì°¨ë‹¨ ì •ì±…** ì ìš©
- âœ… ë¶ˆí•„ìš”í•œ ë“œë¼ì´ë²„ ì œê±°

---

### 20.1.2 Linux LPE ì ê²€í‘œ

**A) ê³„ì •/ê¶Œí•œ**
- âœ… `sudo` ì œí•œ: **NOPASSWD ìµœì†Œí™”**, ëª…ë ¹ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
- âœ… `su`/root ì›ê²© ë¡œê·¸ì¸ ê¸ˆì§€(SSH `PermitRootLogin no`)
- âœ… `umask` ê¸°ë³¸ ê°•í™”(ì˜ˆ: 027)

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```bash
# sudoers(íŒŒì¼+include) ì ê²€
sudo grep -R "NOPASSWD" -n /etc/sudoers /etc/sudoers.d || true

# root ë¡œê·¸ì¸/íŒ¨ìŠ¤ì›Œë“œ ì •ì±…
sudo grep -nE '^(PermitRootLogin|PasswordAuthentication)' /etc/ssh/sshd_config

# ê³„ì •/ì‰˜/ë§Œë£Œ
sudo awk -F: '($7!="/usr/sbin/nologin" && $7!="/bin/false"){print}' /etc/passwd
sudo chage -l <user>
```

**B) SUID/SGID/Capabilities**
- âœ… ë¶ˆí•„ìš” **SUID/SGID ë°”ì´ë„ˆë¦¬ ì œê±°**
- âœ… **capabilities**(file caps) ë¶€ì—¬ ìµœì†Œí™”
- âœ… `LD_PRELOAD`/`PATH`/`IFS` ì•…ìš© ê°€ëŠ¥ ê²½ë¡œ ì œê±°

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```bash
# SUID/SGID ë‚˜ì—´
sudo find / -xdev -type f -perm -4000 -o -perm -2000 2>/dev/null | sort

# file capabilities
sudo getcap -r / 2>/dev/null | sort

# world-writable ë””ë ‰í„°ë¦¬/íŒŒì¼
sudo find / -xdev -type d -perm -0002 2>/dev/null
sudo find / -xdev -type f -perm -0002 2>/dev/null
```

**C) íŒŒì¼ê¶Œí•œ/ê²½ë¡œ í•˜ì´ì¬í‚¹**
- âœ… `PATH` ì•ìª½ì— **world-writable** ë””ë ‰í„°ë¦¬ ê¸ˆì§€
- âœ… **ì„œë¹„ìŠ¤(Unit) ExecStart** ê²½ë¡œ ìœ íš¨ì„± í™•ì¸
- âœ… **cron/anacron/systemd timer** ìŠ¤í¬ë¦½íŠ¸ ê¶Œí•œ

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```bash
echo $PATH | tr ':' '\n' | while read d; do [ -w "$d" ] && ls -ld "$d"; done

# systemd ì„œë¹„ìŠ¤ ì‹¤í–‰ ê²½ë¡œ í™•ì¸
systemctl list-units --type=service --all | awk '{print $1}' | xargs -I{} bash -lc 'echo == {}; systemctl cat {} | grep -E "ExecStart|User="'

# cron íŒŒì¼ ê¶Œí•œ
sudo ls -l /etc/cron* /var/spool/cron
```

**D) ì»¤ë„/ëª¨ë“ˆ/ë©”ëª¨ë¦¬ ë³´í˜¸**
- âœ… `kernel.randomize_va_space=2` (ASLR)
- âœ… `kernel.kptr_restrict=2`
- âœ… `fs.protected_hardlinks=1`, `fs.protected_symlinks=1`
- âœ… **ì•…ìš© ê°€ëŠ¥ ëª¨ë“ˆ ë¸”ë¡**(USB storage ë“± í•„ìš” ì—†ìœ¼ë©´ blacklist)

**ğŸ§ª ëª…ë ¹ ìŠ¤ë‹ˆí«**
```bash
sysctl kernel.randomize_va_space kernel.kptr_restrict fs.protected_hardlinks fs.protected_symlinks
grep -R "blacklist" /etc/modprobe.d || true
```

---

## 20.2 í¬ë Œì‹ ìŠ¤í… ì¹´ë“œ & ëª…ë ¹ì–´ ìŠ¤ë‹ˆí«

> ëª©í‘œ: **í˜„ì¥ 30â€“60ë¶„ íŠ¸ë¦¬ì•„ì§€**ì—ì„œ ë™ì¼í•œ ìˆœì„œë¡œ ë°Ÿì„ **ì¹´ë“œí˜• ì ˆì°¨**ì…ë‹ˆë‹¤. (ë³€ê²½Â·ì‚­ì œÂ·ì „íŒŒ í–‰ìœ„ ê¸ˆì§€)

### 20.2.1 ê³µí†µ ì›ì¹™(í˜„ì¥)

- âœ… **ì‚¬ì§„/ë©”ëª¨**: í™”ë©´/ì—°ê²°/ì‹œê°„/ì‚¬ìš©ì ì„¸ì…˜ ê¸°ë¡
- âœ… **ë³€ê²½ ìµœì†Œí™”**: ë¼ì´ë¸Œ/íœ˜ë°œì„± ìˆ˜ì§‘ í›„ ë””ìŠ¤í¬ ì´ë¯¸ì§€
- âœ… **ì²´ì¸ì˜¤ë¸Œì»¤ìŠ¤í„°ë””(CoC)** ë¬¸ì„œí™”(ìˆ˜ì§‘ì, ì‹œê°„, í•´ì‹œ)

---

### 20.2.2 Windows íŠ¸ë¦¬ì•„ì§€ ì¹´ë“œ

**[W-01] ì»¨í…ìŠ¤íŠ¸**
- ëª…ë ¹: `whoami /all`, `query user`, `ipconfig /all`, `netstat -abno`
- PowerShell:
```powershell
Get-Date
Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName"
Get-WmiObject Win32_ComputerSystem | Select UserName, Manufacturer, Model
```

**[W-02] í”„ë¡œì„¸ìŠ¤/ë„¤íŠ¸ì›Œí¬**
```powershell
# í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬(ë¶€ëª¨-ìì‹)
Get-CimInstance Win32_Process | Select ProcessId,ParentProcessId,Name,CommandLine | Sort ParentProcessId,ProcessId

# í¬íŠ¸ ë°”ì¸ë”©
Get-NetTCPConnection | Where-Object {$_.State -eq "Listen"} | Select-Object LocalAddress,LocalPort,OwningProcess
```

**[W-03] ì§€ì†ì„± ì§€ì **
```powershell
# Run/RunOnce
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"

# ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬(í‚¤ì›Œë“œ í•„í„°)
schtasks /query /fo LIST /v | findstr /i /c:"ì‘ì—… ì‹¤í–‰" /c:"ttplab" /c:"AppData"
```

**[W-04] ì´ë²¤íŠ¸ ë¡œê·¸(í•µì‹¬ ì±„ë„)**
```powershell
# ìµœê·¼ 2ì‹œê°„ 4688/7045/4698
$since=(Get-Date).AddHours(-2)
Get-WinEvent -FilterHashtable @{LogName='Security';ID=4688;StartTime=$since} -MaxEvents 1000 | Select TimeCreated,Id,Message
Get-WinEvent -FilterHashtable @{LogName='System';ID=7045;StartTime=$since} -MaxEvents 1000 | Select TimeCreated,Id,Message
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-TaskScheduler/Operational';ID=4698;StartTime=$since} -MaxEvents 1000 | Select TimeCreated,Id,Message
```

**[W-05] ë©”ëª¨ë¦¬/ì•„í‹°íŒ©íŠ¸ ë³´ì¡´**
- ë©”ëª¨ë¦¬ ë¤í”„(ë„êµ¬ í‘œì¤€ì— ë”°ë¦„, ì˜ˆ: `winpmem`) â†’ SHA256 í•´ì‹œ
- Prefetch, ShimCache, Amcache, SRUM, RecentFiles ë°±ì—…(ì½ê¸°)

---

### 20.2.3 Linux íŠ¸ë¦¬ì•„ì§€ ì¹´ë“œ

**[L-01] ì»¨í…ìŠ¤íŠ¸**
```bash
date -u; whoami; id; uname -a
last -n 10
ip -br addr; ip route
ss -ltnp
```

**[L-02] í”„ë¡œì„¸ìŠ¤/ë„¤íŠ¸ì›Œí¬/ì˜¤í”ˆíŒŒì¼**
```bash
ps -eo pid,ppid,user,group,etimes,cmd --sort=ppid,pid | head -n 50
lsof -n -P -iTCP -sTCP:LISTEN
lsof -p <PID> 2>/dev/null | head
```

**[L-03] ì§€ì†ì„± ì§€ì **
```bash
# systemd ì„œë¹„ìŠ¤ì™€ íƒ€ì´ë¨¸
systemctl list-timers --all
systemctl list-unit-files --type=service --state=enabled

# cron
ls -l /etc/cron* /var/spool/cron
```

**[L-04] ìµœê·¼ ë³€ê²½ íŒŒì¼**
```bash
sudo find / -xdev -type f -mtime -2 -printf '%TY-%Tm-%Td %TT %u %g %m %p\n' 2>/dev/null | sort | tail -n 100
```

**[L-05] ìˆ˜ì§‘ íŒ¨í‚¤ì§•(ì½ê¸° ì „ìš©)**
```bash
# tarë¡œ ë©”íƒ€ë§Œ ìˆ˜ì§‘(íŒŒì¼ ë‚´ìš© ì œì™¸, -h í•´ì‹œ/ì¶”ê°€ë„êµ¬ ê¶Œì¥)
mkdir -p /tmp/triage
ps auxww > /tmp/triage/ps.txt
ss -panto > /tmp/triage/net.txt
journalctl -S -2h > /tmp/triage/journal_2h.txt
tar -czf /tmp/triage.tar.gz /tmp/triage
sha256sum /tmp/triage.tar.gz
```

---

### 20.2.4 ë¯¸ë‹ˆ â€œíƒ€ì„ë¼ì¸ ë³µì›â€ ìŠ¤ë‹ˆí«

**Windows Kusto(KQL)**
```kusto
let since = ago(2h);
let p = SecurityEvent | where TimeGenerated > since and EventID==4688
  | project TimeGenerated, Computer, Account, NewProcessName=TargetFileName, CommandLine;
let s = System | where TimeGenerated > since and EventID==7045
  | project TimeGenerated, Computer, ServiceName, ImagePath;
let t = Event | where TimeGenerated > since and EventLog has "TaskScheduler" and EventID==4698
  | project TimeGenerated, Computer, RenderedDescription;

union p, s, t | order by TimeGenerated asc
```

---

## 20.3 í•˜ë“œë‹ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ìš”ì•½(ì„œë²„/ì›Œí¬ìŠ¤í…Œì´ì…˜)

> ëª©í‘œ: â€œ**ê¸°ë³¸ê°’ ê°•í™”** + **ì •ì±… ì½”ë“œí™”** + **ëª¨ë‹ˆí„°ë§ ê¸°ì¤€**â€ì˜ 3ë‹¨ê³„.
> ì„œë²„/ì›Œí¬ìŠ¤í…Œì´ì…˜ ê³µí†µ, ì„œë¹„ìŠ¤ ì„±ê²©ì— ë”°ë¼ ì„ íƒ ì ìš©.

### 20.3.1 ê³µí†µ ì •ì±…

- âœ… **ìµœì†Œ ê¶Œí•œ**: ë¡œì»¬ ê´€ë¦¬ì ê¸ˆì§€, ì„œë¹„ìŠ¤ ê³„ì • ë¶„ë¦¬(ê¶Œí•œÂ·ì•”í˜¸ìˆ˜ëª…)
- âœ… **íŒ¨ì¹˜ íŒŒì´í”„ë¼ì¸**: ì›”ê°„ ì •ê¸° + ê³ ìœ„í—˜ ì¦‰ì‹œ, **ìë™ ì¬ë¶€íŒ… ìœˆë„ìš° ì§€ì •**
- âœ… **EDR/AV**: ì‹¤ì‹œê°„ ë³´í˜¸ + ì •ì±… ì ê¸ˆ, **Self-Protection** ëª¨ë“œ
- âœ… **ë¡œê¹… í‘œì¤€**: Sysmon(Win) / auditd + journald(Linux), ê³µí†µ ìŠ¤í‚¤ë§ˆ
- âœ… **ì›ê²© ê´€ë¦¬**: Just-In-Time(JIT) ì ‘ê·¼, MFA, bastion í†µì œ, ì„¸ì…˜ ë¡œê¹…
- âœ… **ì•”í˜¸/ë¹„ë°€**: Password Manager/SSO, **Keyless(OIDC)** í™œìš©, ë¹„ë°€ íšŒì „

---

### 20.3.2 Windows ì„œë²„/ì›Œí¬ìŠ¤í…Œì´ì…˜

**êµ¬ì„±(ìš”ì•½)**
- **UAC** ê°•ì œ(ê´€ë¦¬ì ìŠ¹ì¸ ëª¨ë“œ + Secure Desktop)
- **LSA ë³´í˜¸**: `RunAsPPL=1`, Credential Guard ê°€ëŠ¥ ì‹œ ì‚¬ìš©
- **AppLocker/WDAC** í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸(ì—…ë¬´ ì•± ì„œëª… ê¸°ë°˜ í—ˆìš©)
- **PowerShell ë¡œê¹…**: Module/ScriptBlock/Transcription
- **ì›ê²© ë°ìŠ¤í¬í†±**: NLA ê°•ì œ, ì™¸ë¶€ë…¸ì¶œ ê¸ˆì§€, ê²Œì´íŠ¸ì›¨ì´ ê²½ìœ 

**ğŸ§ª GPO/PowerShell ìŠ¤ë‹ˆí«**
```powershell
# PowerShell ë¡œê¹…
Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name EnableScriptBlockLogging -Value 1 -Force
Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription" -Name EnableTranscripting -Value 1 -Force

# LSA ë³´í˜¸
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RunAsPPL /t REG_DWORD /d 1 /f
```

**Sysmon ê¸°ë³¸ ê¶Œì¥(EventID)**
- 1(í”„ë¡œì„¸ìŠ¤ ìƒì„±), 3(ë„¤íŠ¸ì›Œí¬), 7(DLL ë¡œë“œ), 11(íŒŒì¼ ìƒì„±), 13(ë ˆì§€ìŠ¤íŠ¸ë¦¬), 22(DNS), 24/25(ëª…ë ¹ì œì–´) ë“±

---

### 20.3.3 Linux ì„œë²„/ì›Œí¬ìŠ¤í…Œì´ì…˜

**êµ¬ì„±(ìš”ì•½)**
- **SSH í•˜ë“œë‹**: `Protocol 2`, `PermitRootLogin no`, `PasswordAuthentication no`, `PubkeyAuthentication yes`, `AllowUsers`/`AllowGroups`
- **íŒŒì¼ì‹œìŠ¤í…œ**: `/var/tmp`, `/home`, `/tmp`ì— `nodev,nosuid,noexec`(ì—…ë¬´ ì˜í–¥ ê²€í† )
- **ì„œë¹„ìŠ¤ ìµœì†Œí™”**: `systemctl disable --now` ë¶ˆí•„ìš” ë°ëª¬
- **Audit**: `auditd` ê·œì¹™(ì •ì±…íŒŒì¼ ê´€ë¦¬)
- **SELinux/AppArmor**: `enforcing`/í”„ë¡œíŒŒì¼ ë§ì¶¤

**ğŸ§ª ìŠ¤ë‹ˆí«**
```bash
# SSH í•˜ë“œë‹
sudo tee -a /etc/ssh/sshd_config >/dev/null <<'EOF'
Protocol 2
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
ClientAliveInterval 300
ClientAliveCountMax 2
EOF
sudo systemctl reload sshd

# fstab ì˜ˆì‹œ(ì—…ë¬´ ê²€í†  å¿…)
sudo cp /etc/fstab /etc/fstab.bak.$(date +%F)
echo "tmpfs /tmp tmpfs defaults,noatime,nosuid,nodev,noexec,mode=1777 0 0" | sudo tee -a /etc/fstab
```

**auditd ê·œì¹™(ë°œì·Œ)**
```bash
# /etc/audit/rules.d/hardening.rules
-w /etc/sudoers -p wa -k scope
-w /etc/sudoers.d/ -p wa -k scope
-w /etc/ssh/sshd_config -p wa -k sshd
-a always,exit -F arch=b64 -S execve -F euid=0 -k exec_as_root
```

---

### 20.3.4 ì• í”Œë¦¬ì¼€ì´ì…˜/ì»¨í…Œì´ë„ˆ

- **ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„**: root ê¸ˆì§€, `readOnlyRootFilesystem`, `capabilities: drop=["ALL"]`, `seccomp: RuntimeDefault`
- **ì´ë¯¸ì§€**: SBOM ì²¨ë¶€, ì„œëª…(cosign), ì·¨ì•½ì  ìŠ¤ìº”(Trivy/Grype)
- **K8s**: Admission(OPA/Gatekeeper/Kyverno)ë¡œ ì •ì±… ê°•ì œ, ëŸ°íƒ€ì„ íƒì§€(Falco)

**ğŸ§ª Pod ë³´ì•ˆ ì˜ˆì‹œ**
```yaml
securityContext:
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  seccompProfile: { type: RuntimeDefault }
  capabilities: { drop: ["ALL"] }
```

---

## 20.4 ê°œì¸ ì¥ë¹„ ë³´ì•ˆ ê°€ì´ë“œ(ì—°êµ¬ììš©): VM ìŠ¤ëƒ…ìƒ·Â·ê²©ë¦¬ ìŠµê´€

> ëª©í‘œ: ë¦¬ì„œì¹˜/ë¶„ì„/í…ŒìŠ¤íŠ¸ë¥¼ **ì•ˆì „í•˜ê²Œ ê²©ë¦¬**í•˜ê³ , **ì‚¬ìƒí™œ/ë³¸ì—… í™˜ê²½**ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê²Œ í•˜ëŠ” ìŠµê´€í™”.

### 20.4.1 ê¸°ê¸° ê¸°ë³¸

- âœ… OS ìµœì‹  ì—…ë°ì´íŠ¸ ìë™
- âœ… **ë””ìŠ¤í¬ ì•”í˜¸í™”**(BitLocker/FileVault/LUKS)
- âœ… **ê³„ì • ë¶„ë¦¬**: ì¼ìƒ/ì—°êµ¬ ë¡œì»¬ ê³„ì • ë¶„ë¦¬, ê´€ë¦¬ì ì„¸ì…˜ ìµœì†Œí™”
- âœ… **íŒ¨ìŠ¤ì›Œë“œ ê´€ë¦¬ì** + **FIDO2/U2F í‚¤**(ê°€ëŠ¥í•˜ë©´)
- âœ… ë¸Œë¼ìš°ì € **ì»¨í…Œì´ë„ˆ/í”„ë¡œí•„ ë¶„ë¦¬**(ê°œì¸/ì—…ë¬´/ì—°êµ¬)

---

### 20.4.2 ë„¤íŠ¸ì›Œí¬/í”„ë¡ì‹œ ê²©ë¦¬

- âœ… ì—°êµ¬ìš© VMì€ ê¸°ë³¸ **NAT** â†’ ì™¸ë¶€ ë…¸ì¶œ ë°©ì§€
- âœ… ì˜ì‹¬ ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ ì‹œ **Host-only**ë¡œ ì™„ì „ ì˜¤í”„ë¼ì¸
- âœ… í•„ìš” ì‹œ **HTTP/DNS í”„ë¡ì‹œ**ë¥¼ í†µí•´ **ë¡œê·¸/í•„í„°** ë‚¨ê¸°ê¸°

**ğŸ§ª ì˜ˆì‹œ: Linux í˜¸ìŠ¤íŠ¸ì—ì„œ ì—°êµ¬ VMìš© í”„ë¡ì‹œ ë¡œê·¸**
```bash
# tinyproxy ì„¤ì¹˜/ë¡œê·¸ í™•ì¸
sudo apt-get install -y tinyproxy
sudo sed -i 's/^#LogLevel.*/LogLevel Info/' /etc/tinyproxy/tinyproxy.conf
sudo systemctl restart tinyproxy
# VM ë¸Œë¼ìš°ì € í”„ë¡ì‹œë¥¼ í˜¸ìŠ¤íŠ¸IP:8888ë¡œ ì„¤ì • í›„ /var/log/tinyproxy/tinyproxy.log í™•ì¸
```

---

### 20.4.3 VM ìŠ¤ëƒ…ìƒ· ìŠµê´€(â€œê¹¨ë—í•œ ê¸°ì¤€ì„  â†’ ë¶„ê¸° â†’ í•©ë¥˜â€)

1) **Baseline ìŠ¤ëƒ…ìƒ·**: OS + í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ í›„ `Baseline-YYYYMM`
2) **ë¶„ì„ ìŠ¤ëƒ…ìƒ·**: ì¼€ì´ìŠ¤ë³„ `Case-<id>-start`
3) **ì‹¤í—˜**: íŒŒì¼/ë ˆì§€ìŠ¤íŠ¸ë¦¬/ë„¤íŠ¸ì›Œí¬ ë³€í™” **ë©”ëª¨**
4) **ì¢…ë£Œ í›„ ë¡¤ë°±**: `Case-<id>-start`ë¡œ ë˜ëŒë¦¬ê¸°
5) **ì£¼ê¸°ì  ì¬ìƒì„±**: Baseline ë¶„ê¸° ì˜¤ë˜ ìœ ì§€ ê¸ˆì§€(íŒ¨ì¹˜ ë°˜ì˜)

**ğŸ§ª VBoxManage ì˜ˆì‹œ**
```bash
VBoxManage snapshot "Win10-Lab" take "Baseline-2025-11"
VBoxManage snapshot "Win10-Lab" take "Case-123-start"
# ì‹¤í—˜ í›„
VBoxManage snapshot "Win10-Lab" restore "Case-123-start"
```

---

### 20.4.4 ìƒŒë“œë°•ìŠ¤/ì—ë®¬ë ˆì´ì…˜ ë³´ì¡°

- âœ… **QEMU/Bochs**: ì‚¬ìš©ì ëª¨ë“œ ì—ë®¬ë¡œ ìœ„í—˜í–‰ìœ„ ì°¨ë‹¨
- âœ… **Frida Gadget**: ë™ì  ê´€ì°°(ìì²´ ì½”ë“œ ì£¼ì…ì€ ê²©ë¦¬ëœ ë©ì—ì„œë§Œ)
- âœ… **Docker ë„êµ¬ ìƒì**: ë¶„ì„ íˆ´ ì»¨í…Œì´ë„ˆí™”í•˜ì—¬ í˜¸ìŠ¤íŠ¸ ì˜¤ì—¼ ë°©ì§€

**ğŸ§ª Docker íˆ´ë°•ìŠ¤ ì˜ˆì‹œ**
```bash
docker run --rm -it --network none -v "$PWD:/work" python:3.11-slim bash
# ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰, ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨ ìƒíƒœì—ì„œ ì²˜ë¦¬
```

---

### 20.4.5 ë¸Œë¼ìš°ì €/ë¬¸ì„œ ì•ˆì „ ì—´ëŒ

- âœ… **ì½ê¸° ì „ìš© ë·°ì–´**(PDF/SVG/ë¯¸ë””ì–´)ëŠ” **ê²©ë¦¬ VM**ì—ì„œ
- âœ… ë¸Œë¼ìš°ì € **ì‚¬ì´íŠ¸ ê²©ë¦¬**, `chrome://flags`(Strict-Origin-Isolation ë“±)
- âœ… **ë‹¤ìš´ë¡œë“œ ìë™ ì‹¤í–‰ ê¸ˆì§€**, ë¯¸í™•ì¸ í™•ì¥/í”ŒëŸ¬ê·¸ì¸ ê¸ˆì§€

---

### 20.4.6 ìˆ˜ì§‘/ë…¸íŠ¸/íê¸°

- âœ… ë¶„ì„ ë…¸íŠ¸ëŠ” **íƒ€ì„ìŠ¤íƒ¬í”„+í•´ì‹œ**ì™€ í•¨ê»˜ ê¸°ë¡
- âœ… ìƒ˜í”Œ/ì•„í‹°íŒ©íŠ¸ëŠ” **ì•”í˜¸í™” ì»¨í…Œì´ë„ˆ**ì— ë³´ê´€, **ë³´ì¡´ê¸°í•œ** ì„¤ì • í›„ íê¸°
- âœ… ì—…ë¬´ë§ ì—…ë¡œë“œ ê¸ˆì§€(ê²©ë¦¬ ë„¤íŠ¸ì›Œí¬/ì „ìš© ì €ì¥ì†Œ ì‚¬ìš©)

---

## 20.5 ë¶€ë¡ â€” ìë™ ì ê²€ ë¯¸ë‹ˆ ìŠ¤í¬ë¦½íŠ¸

### 20.5.1 Windows ê¶Œí•œ/ì„œë¹„ìŠ¤ ë¹ ë¥¸ í—¬ìŠ¤ì²´í¬ (PowerShell)

```powershell
# QuickWinHardening.ps1
$report = @{}

# Admin ê·¸ë£¹
$report.Admins = (Get-LocalGroupMember -Group "Administrators" | Select-Object Name, PrincipalSource)

# UAC/LSA
$sysPol = Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System"
$lsa    = Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa"
$report.UAC = $sysPol | Select ConsentPromptBehaviorAdmin, PromptOnSecureDesktop
$report.LSA = $lsa | Select RunAsPPL

# ì„œë¹„ìŠ¤ ì¸ìš©ë¶€í˜¸ ê²°í•¨
$report.ServiceQuoteIssues = Get-WmiObject win32_service | ? {
  $_.PathName -match '^[A-Za-z]:\\[^"]* [^"]*\.exe' -and $_.PathName -notmatch '"'
} | Select Name, PathName

# ìŠ¤ì¼€ì¤„ëŸ¬
$report.Tasks = (schtasks /query /fo LIST /v) -join "`n"

$report | ConvertTo-Json -Depth 5 | Out-File .\win_hardening_report.json -Encoding utf8
Write-Host "Saved win_hardening_report.json"
```

### 20.5.2 Linux SUID/Caps/SSH/NOPASSWD ë¹ ë¥¸ í—¬ìŠ¤ì²´í¬ (bash)

```bash
#!/usr/bin/env bash
# quick_linux_hardening.sh
set -euo pipefail
OUT=${1:-linux_hardening_report.txt}
{
echo "== DATE =="; date -u
echo "== SUDOERS NOPASSWD =="; sudo grep -R "NOPASSWD" -n /etc/sudoers /etc/sudoers.d || true
echo "== SSHD CONFIG =="; sudo grep -nE '^(PermitRootLogin|PasswordAuthentication|PubkeyAuthentication)' /etc/ssh/sshd_config
echo "== SUID/SGID =="; sudo find / -xdev -type f \( -perm -4000 -o -perm -2000 \) 2>/dev/null | sort | head -n 100
echo "== FILE CAPABILITIES =="; sudo getcap -r / 2>/dev/null | head -n 100
echo "== WORLD WRITABLE DIR =="; sudo find / -xdev -type d -perm -0002 2>/dev/null | head -n 50
echo "== SYSCTL KEYS =="; sysctl kernel.randomize_va_space kernel.kptr_restrict fs.protected_hardlinks fs.protected_symlinks
} > "$OUT"
echo "Saved $OUT"
```

---

## 20.6 ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸(ìš”ì•½ ì¹´ë“œ)

**LPE(Win)**
- [ ] Admin ê·¸ë£¹/ì„œë¹„ìŠ¤ ê³„ì • ìµœì†Œí™”
- [ ] UAC(ìŠ¹ì¸+ë³´ì•ˆ ë°ìŠ¤í¬í†±), LSA ë³´í˜¸/CG
- [ ] ì„œë¹„ìŠ¤ ê²½ë¡œ ë”°ì˜´í‘œ/ACL ì•ˆì „
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬/Run í‚¤ ê²€í† 
- [ ] Sysmon(EventID 1/3/7/11/13/22) ìˆ˜ì§‘

**LPE(Linux)**
- [ ] sudo NOPASSWD ì œê±°, SSH root ë¡œê·¸ì¸ ê¸ˆì§€
- [ ] SUID/SGID/Cap ìµœì†Œí™”
- [ ] PATH ì•ìª½ world-writable ì œê±°
- [ ] ASLR/kptr_restrict ë“± ì»¤ë„ ë³´í˜¸
- [ ] auditd ê·œì¹™ ì ìš©

**í¬ë Œì‹ íŠ¸ë¦¬ì•„ì§€**
- [ ] ì»¨í…ìŠ¤íŠ¸ â†’ í”„ë¡œì„¸ìŠ¤/ë„¤íŠ¸ì›Œí¬ â†’ ì§€ì†ì„± â†’ ìµœê·¼ë³€ê²½ â†’ ìˆ˜ì§‘/í•´ì‹œ
- [ ] 4688/7045/4698, Sysmon 11/22, journald/auditd

**í•˜ë“œë‹**
- [ ] íŒ¨ì¹˜ íŒŒì´í”„ë¼ì¸ & ì¬ë¶€íŒ… ìœˆë„ìš°
- [ ] AppLocker/WDAC(Win), SELinux/AppArmor(Linux)
- [ ] EDR/AV ì •ì±… ì ê¸ˆ
- [ ] ê³µí†µ ìŠ¤í‚¤ë§ˆ ë¡œê¹…

**ê°œì¸ ì¥ë¹„(ì—°êµ¬ì)**
- [ ] ì•”í˜¸í™”, ê³„ì • ë¶„ë¦¬, FIDO2
- [ ] ë¸Œë¼ìš°ì € í”„ë¡œí•„/ì»¨í…Œì´ë„ˆ
- [ ] VM ìŠ¤ëƒ…ìƒ· ë£¨í‹´, Host-only ê²©ë¦¬
- [ ] í”„ë¡ì‹œ ë¡œê·¸, ìƒ˜í”Œ ì•”í˜¸í™” ë³´ê´€

---

# ë§ˆë¬´ë¦¬

ì´ ì¹˜íŠ¸ì‹œíŠ¸ëŠ” â€œ**ë¹¨ë¦¬ ì²´í¬í•˜ê³ , ë°”ë¡œ ê³ ì¹  ìˆ˜ ìˆëŠ”**â€ í•­ëª© ì¤‘ì‹¬ì…ë‹ˆë‹¤.
ìœ„ ìŠ¤í¬ë¦½íŠ¸(Windows PowerShell, Linux bash)ë¥¼ ì €ì¥ì†Œì— ë„£ê³  **ì£¼ê¸°ì  ë¦¬í¬íŠ¸**ë¥¼ ìˆ˜ì§‘í•˜ë©´, **ê¶Œí•œ ìƒìŠ¹ ë…¸ì¶œÂ·í¬ë Œì‹ ì¤€ë¹„ ìƒíƒœÂ·í•˜ë“œë‹ ìˆ˜ì¤€**ì„ ê¾¸ì¤€íˆ **ê°€ì‹œí™”**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
