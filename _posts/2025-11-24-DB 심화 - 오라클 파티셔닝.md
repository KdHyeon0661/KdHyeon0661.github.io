---
layout: post
title: DB 심화 - 오라클 파티셔닝
date: 2025-11-24 18:25:23 +0900
category: DB 심화
---
# 오라클 파티셔닝 : **11g에서 추가된 유형**과 **그 이후 버전의 확장**

## 0) 배경: 11g 이전에 이미 존재하던 기본/복합 파티셔닝

- **기본**: Range / List / Hash
- **복합(Composite)**: `range-hash`, `range-list` 등 (상세 조합은 11gR2에서 크게 확장됨)

> 11gR2에서 복합 조합의 가짓수 자체가 크게 풍성해졌고, 이후 절에서 표로 정리합니다.

---

## 1) 11g에서 **새롭게 추가/확장**된 파티션 “유형/전략”

### Interval Partitioning (자동 Range 확장)

- **개념**
  Range 파티션의 확장판. **첫 번째 Range 파티션을 전이점(transition point)** 로 두고, 그 이후 구간은 `INTERVAL` 정의에 따라 **필요 시 자동 생성**됩니다. 예: “월 단위” Interval이면 해당 월 데이터가 처음 들어오는 순간 새 파티션이 자동 생성.
  > 11g에서 도입. 또한 11gR2 백서는 **Interval-Range / Interval-List / Interval-Hash** 같은 **복합 Interval** 전략도 기술합니다.

- **DDL 예제 (월 단위 Interval)**

```sql
-- 월 단위 자동 생성 Interval-Range
CREATE TABLE sales (
  sales_id     NUMBER PRIMARY KEY,
  sales_date   DATE   NOT NULL,
  amount       NUMBER
)
PARTITION BY RANGE (sales_date)
INTERVAL (NUMTOYMINTERVAL(1, 'MONTH'))      -- 월 단위
(
  PARTITION p0 VALUES LESS THAN (DATE '2023-01-01')  -- 전이점(최초 Range)
);

-- 데이터 삽입 시, 해당 월 파티션이 자동 생성됨
INSERT INTO sales VALUES (1, DATE '2023-02-15', 1000);
INSERT INTO sales VALUES (2, DATE '2023-03-05', 2000);

-- 생성된 파티션 확인
SELECT partition_name, high_value
FROM   user_tab_partitions
WHERE  table_name = 'SALES'
ORDER  BY high_value;
```

- **활용 포인트**
  운영 시 **월/분기 등의 시간축**으로 파티션을 운용할 때, 사전 DDL 없이도 파티션이 늘어납니다.
  > Interval 파티션의 자동 생성/경계 규칙 및 Range/Interval 차이는 오라클 가이드에 상세.

---

### Reference Partitioning (부모 파티션을 **자식이 상속**)

- **개념**
  자식 테이블이 **부모의 파티션 키를 물리 컬럼으로 갖지 않아도**, **외래키(FK)** 를 통해 **부모의 파티션 전략을 상속**하는 방법. 부모/자식이 **자연스럽게 등분**되어 **Partition-Wise Join** 효율과 **유지보수(Truncate/Exchange의 연쇄)** 가 좋아집니다.
  > 11g에서 도입(11gR2 백서에 상세). 12c 이후에는 **Interval Reference Partitioning** 등 확장도 추가됨.

- **DDL/실습**

```sql
-- 부모: 주문 헤더 (월 단위 Interval 파티션)
CREATE TABLE orders (
  order_id     NUMBER PRIMARY KEY,
  order_date   DATE   NOT NULL,
  customer_id  NUMBER NOT NULL
)
PARTITION BY RANGE (order_date)
INTERVAL (NUMTOYMINTERVAL(1, 'MONTH'))
(
  PARTITION p0 VALUES LESS THAN (DATE '2023-01-01')
);

-- 자식: 주문 품목 (부모의 파티셔닝을 '참조'로 상속)
CREATE TABLE order_items (
  order_id     NUMBER NOT NULL,
  line_no      NUMBER NOT NULL,
  product_id   NUMBER NOT NULL,
  qty          NUMBER,
  CONSTRAINT pk_order_items PRIMARY KEY (order_id, line_no),
  CONSTRAINT fk_order_items_orders
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
)
PARTITION BY REFERENCE (fk_order_items_orders);

-- 부모만 파티션 관리해도 자식의 동일 파티션이 자동 반영(Truncate/Exchange 등)
```

- **장점 요약**
  - 자식에 파티션 키를 **중복 저장할 필요 X** → 모델 순수성·공간 효율
  - **Partition-Wise Join**로 대용량 조인 비용 감소
  - 파티션 유지보수(추가/병합/교체)가 **상속되어 일관성** 확보
  > 동작/효익은 11gR2 백서 및 12c 발표 자료에서 반복 강조.

---

### System Partitioning (애플리케이션이 직접 파티션을 지정)

- **개념**
  파티션 키/경계가 아닌, **INSERT 시 개발자가 파티션을 직접 지정**하는 전략. **라우팅 로직이 DB 밖에 있고**, 파티션 배치를 “수동”으로 통제하고 싶을 때 사용합니다.
  > 11g에서 제공.

- **DDL/실습**

```sql
CREATE TABLE session_log (
  sid        NUMBER,
  log_time   DATE,
  payload    VARCHAR2(4000)
)
PARTITION BY SYSTEM
(
  PARTITION p_hot  TABLESPACE ts_hot,
  PARTITION p_warm TABLESPACE ts_warm,
  PARTITION p_cold TABLESPACE ts_cold
);

-- 애플리케이션이 파티션을 '찍어서' 적재
INSERT /*+ APP CONTROLS HOT/COLD */ INTO session_log PARTITION(p_hot)
  VALUES (1001, SYSDATE, 'hot path');

INSERT INTO session_log PARTITION(p_cold)
  VALUES (1002, ADD_MONTHS(SYSDATE,-6), 'cold path');
```

- **사용 시 유의**
  - 잘못된 파티션에 넣으면 **재배치 비용** 발생
  - 파티션 선택 로직의 **일관성**을 애플리케이션에서 보장해야 함
  > 제품 문헌에서 소개된 11g 기능.

---

### Virtual Column-based Partitioning (가상 컬럼을 파티션 키로)

- **개념**
  11g의 **Virtual Column**(메타데이터로만 보관)을 **파티션 키로 사용**할 수 있습니다. 원본 컬럼에 **의미를 내포**(예: `account_id` 앞 3자리 = 지점)하는 상황을 깔끔히 모델링.
  > 11g에서 강화된 기능. 백서에 구체 예시가 있음.

- **DDL/실습**

```sql
CREATE TABLE accounts (
  account_id   VARCHAR2(10) NOT NULL,
  opened_on    DATE         NOT NULL,
  amount       NUMBER,
  branch_code  GENERATED ALWAYS AS (SUBSTR(account_id,1,3)) VIRTUAL
)
PARTITION BY LIST (branch_code)
(
  PARTITION p_001 VALUES ('001'),
  PARTITION p_002 VALUES ('002'),
  PARTITION p_def VALUES (DEFAULT)
);
```

---

### 11gR2의 **복합(Composite) 전략 확대**

- **새/확대 조합**
  `range-range`, `range-list`, `range-hash`, `list-range`, `list-list`, `list-hash`, **hash-hash(신규)**
  또한 Interval의 복합 확장: **Interval-Range / Interval-List / Interval-Hash**
  > 모두 11gR2 백서에 공식 표로 정리되어 있습니다.

- **예시: Hash-Hash Composite**

```sql
CREATE TABLE meter_event (
  id        NUMBER,
  device_id NUMBER,
  event_ts  DATE,
  payload   VARCHAR2(100)
)
PARTITION BY HASH (device_id)         -- 1단계: 해시 파티셔닝
PARTITIONS 8
SUBPARTITION BY HASH (id)             -- 2단계: 해시 서브파티셔닝
SUBPARTITIONS 4
ENABLE ROW MOVEMENT;
```

- **예시: Interval-List Composite** (상위 Interval, 하위 List)

```sql
CREATE TABLE sales_regioned (
  id         NUMBER,
  sales_date DATE,
  region     VARCHAR2(10)
)
PARTITION BY RANGE(sales_date)
INTERVAL (NUMTOYMINTERVAL(1,'MONTH'))                 -- 상위 Interval
SUBPARTITION BY LIST (region) SUBPARTITION TEMPLATE    -- 하위 List
(
  SUBPARTITION sp_apac  VALUES ('APAC'),
  SUBPARTITION sp_emea  VALUES ('EMEA'),
  SUBPARTITION sp_amer  VALUES ('AMER'),
  SUBPARTITION sp_other VALUES (DEFAULT)
)
(
  PARTITION p0 VALUES LESS THAN (DATE '2023-01-01')
);
```

> **정리**: 11g에서 **Interval / Reference / System / Virtual Column**이 추가·강화되고, 11gR2에서 **복합 조합(특히 hash-hash)** 및 **Interval-Composite**가 폭넓게 지원됩니다.

---

## 2) 11g **이후** 버전에서 추가·확장된 유형/전략

### 12cR1: **Interval Reference Partitioning** (확장)

- **개념**
  부모가 **Interval(자동)** 파티션이라도, 자식이 **Reference**로 이를 **상속**할 수 있는 확장. (부모 파티션이 자동으로 늘어날 때 자식도 같이 늘어나는 운영 패턴을 지원)
  > 오라클 12c 자료에서 **Interval Reference Partitioning**을 명시.

- **예시 흐름**
  1) 부모 `orders`는 `INTERVAL` 파티션
  2) 자식 `order_items`는 `PARTITION BY REFERENCE`
  3) 새 월 데이터가 들어오면 부모에 자동 파티션 생성 → 자식도 **동일 파티션 자동 상속**(유지보수 일원화)

---

### 12cR2: **Auto-List Partitioning** / Multi-Column List / Partitioned External Tables

- **Auto-List**
  List 파티션의 확장판. **새 값이 등장하면 해당 값 전용 파티션을 자동 생성**하는 전략. 기존 List를 나중에 **자동화로 진화(ALTER … SET PARTITIONING AUTOMATIC)** 시킬 수도 있음.

```sql
-- 12cR2: Auto-List
CREATE TABLE events (
  sensor_type VARCHAR2(50),
  channel     VARCHAR2(50),
  created_at  DATE
)
PARTITION BY LIST (sensor_type) AUTOMATIC;
-- 'LIDAR' 값이 처음 들어오면 LIDAR 전용 파티션이 자동 생성
INSERT INTO events VALUES ('LIDAR','A1',SYSDATE);
```

> 자동 List와 전환(진화) 예시는 오라클 제품팀 블로그 및 기술 브리프에서 소개.

- **Multi-Column List**: List 파티션을 **2컬럼** 키로 지정 가능
- **Partitioned External Tables**: **External Table 자체를 파티션** 가능 (12.2)
> 12.2의 신규 기능 목록은 2018 기술 자료에 정리.

---

### 19c: **Hybrid Partitioned Tables (HPT)**

- **개념**
  **내부(Internal) 파티션**과 **외부(External) 파티션**을 **한 테이블에 혼합**. **활성 데이터는 내부**에, **콜드/보관 데이터는 외부**(CSV/HDFS/Object Storage 등)에 두어 **비용과 성능을 모두 최적화**할 수 있습니다.

- **핵심 포인트**
  - 내부/외부 파티션을 혼합(하나의 테이블)
  - 외부 파티션은 `ORACLE_LOADER / ORACLE_DATAPUMP / ORACLE_HDFS / ORACLE_HIVE` 형태 지원
  - 파티션 프루닝(정적/동적) 및 Bloom Pruning 등 최적화 동작
  - 제약/인덱스 등 일부 **제약사항** 존재(외부 파티션에는 제약 강제 불가 등)
  > 19c 문서·튜토리얼·예제 기사로 확인 가능.

- **하이브리드 예시 (개념형)**
```sql
-- 디렉터리(외부 파일 위치) 준비
CREATE OR REPLACE DIRECTORY ext_dir AS '/u01/data/ext';

-- 하이브리드 테이블: LIST 파티션(내부+외부 혼합)
CREATE TABLE cust_orders_hpt (
  country_code  VARCHAR2(3),
  order_id      NUMBER,
  order_date    DATE,
  amount        NUMBER
)
PARTITION BY LIST (country_code)
(
  PARTITION p_usa VALUES ('USA')            -- 내부 파티션
    TABLESPACE ts_hot,

  PARTITION p_gbr VALUES ('GBR')            -- 외부 파티션
    EXTERNAL PARTITION ATTRIBUTES
      (TYPE ORACLE_LOADER DEFAULT DIRECTORY ext_dir
       ACCESS PARAMETERS (FIELDS TERMINATED BY ','))
    LOCATION ('gbr_orders_2023.csv'),

  PARTITION p_ire VALUES ('IRE')            -- 외부 파티션
    EXTERNAL PARTITION ATTRIBUTES
      (TYPE ORACLE_DATAPUMP DEFAULT DIRECTORY ext_dir)
    LOCATION ('ire_orders_23.dmp')
);

-- (운영 패턴) 1년 지나 콜드된 'USA_2023' 파티션을 외부로 교체/이관하는 시나리오도 흔함
```

> 문서/튜토리얼의 예제 구문과 같은 구조(내부+외부 혼합, `EXTERNAL PARTITION ATTRIBUTES`, LOCATION 지정)를 따라가면 안전합니다.

- **21c/23ai 이후 보충**
  23ai/26ai에선 HPT가 **Interval/Auto-List**와의 결합 제약이 완화되는 등 확장(향상)도 소개됩니다(버전에 따라 가능/불가 조합이 다를 수 있으니 운영 전 확인 권장).

---

## 3) 버전 타임라인 요약

| 버전 | 핵심 추가/확장 |
|---|---|
| **11g / 11gR2** | **Interval**(자동 생성), **Reference**(부모 상속), **System**(애플리케이션 지정), **Virtual Column-based**(가상 컬럼으로 파티션), **복합 확대**: `range-range`, `list-list`, `list-range`, `list-hash`, **hash-hash(신규)**, 그리고 **Interval-Composite**(`Interval-Range / -List / -Hash`) |
| **12cR1** | **Interval Reference Partitioning**(부모가 Interval이어도 Reference 상속 가능) |
| **12cR2** | **Auto-List Partitioning**, **Multi-Column List**, **Partitioned External Tables** |
| **19c** | **Hybrid Partitioned Tables**(내부+외부 혼합) |

> 위 표의 모든 항목은 오라클 백서/가이드/튜토리얼에 공식 기술되어 있습니다.

---

## 4) 실전 설계 가이드

1) **시간 축**(월/분기/일)로 Data Lifecycle이 뚜렷하면 **Interval**이 기본값
2) 부모-자식 **정규 모델** 유지 + 파티션 일치가 중요하면 **Reference**
3) 애플리케이션 라우팅/데이터 온도(Hot/Warm/Cold) **명확**하면 **System**
4) **의미가 컬럼 내포**(코드 앞자리 등)면 **Virtual Column-based**
5) **값이 계속 늘어나는 구분값(리스트)**라면 **Auto-List**(12.2+)
6) **핫/콜드 혼합 저장**·데이터 티어링 필요하면 **Hybrid**(19c)

---

## 5) 한 번에 보는 실습 시나리오

### “월별 자동 생성 + 자식 상속 + 지역 서브파티션” 통합

```sql
-- 1) 상위: 월별 Interval, 하위: 지역 List 서브파티션
CREATE TABLE sales_all (
  sales_id    NUMBER PRIMARY KEY,
  sales_date  DATE NOT NULL,
  region      VARCHAR2(10),
  amount      NUMBER
)
PARTITION BY RANGE (sales_date)
INTERVAL (NUMTOYMINTERVAL(1,'MONTH'))
SUBPARTITION BY LIST (region) SUBPARTITION TEMPLATE
(
  SUBPARTITION apac VALUES ('APAC'),
  SUBPARTITION emea VALUES ('EMEA'),
  SUBPARTITION amer VALUES ('AMER'),
  SUBPARTITION other VALUES (DEFAULT)
)
(
  PARTITION p0 VALUES LESS THAN (DATE '2023-01-01')
);

-- 2) 자식: Reference Partitioning (부모 sales_all 상속)
CREATE TABLE sales_detail (
  sales_id    NUMBER NOT NULL,
  line_no     NUMBER NOT NULL,
  product_id  NUMBER,
  qty         NUMBER,
  CONSTRAINT pk_sales_detail PRIMARY KEY (sales_id, line_no),
  CONSTRAINT fk_sales_detail_sales
    FOREIGN KEY (sales_id) REFERENCES sales_all(sales_id)
)
PARTITION BY REFERENCE (fk_sales_detail_sales);

-- 3) 데이터 적재 (새 달 유입 시 자동 생성 + 자식도 동일 파티션 상속)
INSERT INTO sales_all VALUES (1001, DATE '2023-02-03', 'APAC', 1200);
INSERT INTO sales_detail VALUES (1001, 1, 501, 2);

-- 4) 파티션/서브파티션 확인
SELECT partition_name, subpartition_count
FROM   user_tab_partitions
WHERE  table_name = 'SALES_ALL';

SELECT subpartition_name, high_value
FROM   user_tab_subpartitions
WHERE  table_name = 'SALES_ALL';
```

> Interval-Composite + Reference 동작은 11gR2 백서와 21c/19c 가이드의 개념에 부합합니다.

---

### “리스트 값 자동 증식(12.2+) → 하이브리드로 콜드 데이터 외부화(19c)”

```sql
-- 1) Auto-List (12.2+): 국가코드 등장 시 자동 파티션 생성
CREATE TABLE country_events (
  country_code  VARCHAR2(3),
  event_time    DATE,
  payload       VARCHAR2(100)
)
PARTITION BY LIST (country_code) AUTOMATIC;

INSERT INTO country_events VALUES ('USA', SYSDATE, 'hot events');
INSERT INTO country_events VALUES ('GBR', SYSDATE, 'first GBR event'); -- GBR 파티션 자동 생성

-- 2) 19c: Hybrid로 전환(개념 흐름)
--  - GBR 과거 데이터는 외부로 이관하여 콜드/아카이브
ALTER TABLE country_events
  ADD PARTITION p_gbr_2023 VALUES ('GBR')
    EXTERNAL PARTITION ATTRIBUTES
      (TYPE ORACLE_LOADER DEFAULT DIRECTORY ext_dir
       ACCESS PARAMETERS (FIELDS TERMINATED BY ','))
    LOCATION ('gbr_events_2023.csv');

-- 3) 내부/외부 파티션 관리 DDL (추가/삭제/이름 변경 등) 수행
ALTER TABLE country_events DROP PARTITION p_gbr_2022;
```

> Auto-List 전환과 HPT 관련 DDL/튜토리얼은 각각 12.2/19c 자료에 실려 있습니다.

---

## 6) 운영 팁

- **Interval**: 전이점(최초 Range)을 **명확**히, 보정 필요 시 Range/Interval 경계규칙 숙지
- **Reference**: FK/PK 무결성과 **파티션 유지보수의 연쇄 효과** 이해(Truncate/Exchange)
- **System**: 애플리케이션 라우팅 로직의 **검증**·**감사** 필요
- **Auto-List**: DEFAULT 파티션 존재 시 **자동 전환 불가**(전환 전 제거)
- **Hybrid**: 외부 파티션의 **제약/인덱스 제한**과 **디렉터리/파일 접근권한**을 점검
> 제한/지원 목록은 19c 파티셔닝 가이드에 정리.

---

## 참고(출처)

- 11gR2 백서: **Interval / Reference / Virtual Column**, 복합조합(특히 **hash-hash**) 및 **Interval-Composite** 정리.
- 12c 발표/가이드: **Interval Reference Partitioning**, **Auto-List / Multi-Column List / Partitioned External Tables**.
- 19c 가이드/튜토리얼: **Hybrid Partitioned Tables**, 외부 파티션 타입/제약/프루닝, 관리 DDL.
