---
layout: post
title: AWS - CDK
date: 2025-08-03 16:20:23 +0900
category: AWS
---
# 📦 CDK: AWS Cloud Development Kit

AWS CDK(Cloud Development Kit)는 AWS 인프라를 프로그래밍 언어를 이용해 정의할 수 있게 해주는 **인프라 코드화(Infrastructure as Code, IaC)** 툴입니다. CDK는 AWS CloudFormation을 추상화하여, 인프라 구성을 쉽고 모듈화할 수 있게 도와줍니다.

---

## 🔧 CDK의 핵심 개념

### 1. **언어 지원**
CDK는 여러 프로그래밍 언어를 지원합니다:

- TypeScript / JavaScript
- Python
- Java
- C#
- Go (experimental)

이 중 가장 활발하게 사용되는 언어는 **TypeScript**와 **Python**입니다.

---

### 2. **스택(Stack)과 앱(App)**

CDK는 CloudFormation의 Stack 개념을 기반으로 구성됩니다.

- **App**: 하나 이상의 Stack을 포함하는 루트 구조입니다.
- **Stack**: 리소스를 선언하는 단위. AWS CloudFormation 스택과 일대일로 매핑됩니다.
- **Construct**: 리소스를 추상화한 객체. AWS 리소스를 선언할 수 있습니다.

```ts
// TypeScript 예제
import * as cdk from 'aws-cdk-lib';
import { Bucket } from 'aws-cdk-lib/aws-s3';

class MyStack extends cdk.Stack {
  constructor(scope: cdk.App, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    new Bucket(this, 'MyFirstBucket', {
      versioned: true
    });
  }
}

const app = new cdk.App();
new MyStack(app, 'MyS3Stack');
```

---

### 3. **Construct (생성자)**

CDK에서 모든 리소스는 **Construct**로 생성됩니다. 예를 들어, S3 Bucket은 `Bucket`, Lambda 함수는 `Function`, DynamoDB 테이블은 `Table` 등으로 표현됩니다.

Construct는 3단계 계층 구조를 가집니다:

1. **L1 Construct**: CloudFormation 리소스를 직접 대응 (예: `CfnBucket`)
2. **L2 Construct**: AWS 리소스를 더 추상화하여 쉽게 사용할 수 있도록 제공
3. **L3 Construct**: 여러 리소스를 묶은 패턴 (ex: ECS + ALB + AutoScaling 등)

---

## 🛠 CDK 설치 및 초기화

### 1. 설치

```bash
npm install -g aws-cdk
```

### 2. 프로젝트 생성

```bash
cdk init app --language typescript
```

### 3. 의존성 설치

```bash
npm install aws-cdk-lib constructs
```

---

## 🌐 실습 예제: S3 + Lambda 연결

```ts
import * as cdk from 'aws-cdk-lib';
import { Bucket } from 'aws-cdk-lib/aws-s3';
import { Function, Runtime, Code } from 'aws-cdk-lib/aws-lambda';
import { S3EventSource } from 'aws-cdk-lib/aws-lambda-event-sources';

class LambdaS3Stack extends cdk.Stack {
  constructor(scope: cdk.App, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const bucket = new Bucket(this, 'MyBucket');

    const fn = new Function(this, 'MyFunction', {
      runtime: Runtime.NODEJS_18_X,
      handler: 'index.handler',
      code: Code.fromAsset('lambda'),
    });

    fn.addEventSource(new S3EventSource(bucket, {
      events: ['s3:ObjectCreated:*']
    }));
  }
}
```

---

## 🔄 배포 및 관리

### 1. CloudFormation 템플릿 확인

```bash
cdk synth
```

### 2. 실제 스택 배포

```bash
cdk deploy
```

### 3. 스택 삭제

```bash
cdk destroy
```

---

## 🧩 CDK의 장점

| 항목 | 설명 |
|------|------|
| **모듈화** | 일반 코드처럼 클래스, 함수 등으로 재사용 가능 |
| **테스트** | 유닛 테스트, 통합 테스트 적용 가능 |
| **추상화** | 복잡한 리소스를 간단한 코드로 구성 가능 |
| **강력한 타입 지원** | IDE 자동완성, 타입 검증 등 개발 생산성 향상 |
| **CloudFormation 연동** | 기존 IaC 스택과도 호환성 유지 |

---

## ⚠️ 주의할 점

1. **기존 CloudFormation 템플릿과 직접 호환 불가** (변환 불가능)
2. **AWS 리소스 명세 변경 시, 최신 CDK 버전 유지 필요**
3. **복잡한 조건, 루프가 오히려 읽기 어렵게 만들 수 있음**

---

## 🧪 테스트 및 CI/CD

- **jest**, **pytest** 등으로 유닛 테스트 가능
- **GitHub Actions / CodePipeline** 과 통합하여 자동 배포 구성 가능

```ts
test('Lambda Created', () => {
  const app = new cdk.App();
  const stack = new LambdaS3Stack(app, 'TestStack');

  expect(stack).toHaveResource('AWS::Lambda::Function');
});
```

---

## 🧱 자주 사용하는 리소스 구성 요소

| 리소스 | Construct |
|--------|-----------|
| S3     | `aws-cdk-lib/aws-s3` |
| Lambda | `aws-cdk-lib/aws-lambda` |
| API Gateway | `aws-cdk-lib/aws-apigateway` |
| DynamoDB | `aws-cdk-lib/aws-dynamodb` |
| VPC     | `aws-cdk-lib/aws-ec2` |
| IAM     | `aws-cdk-lib/aws-iam` |

---

## 🔚 마무리

CDK는 AWS 인프라를 **개발자 친화적인 방식**으로 정의할 수 있게 해주는 강력한 도구입니다. 코드 기반으로 인프라를 구성하고, 재사용성과 테스트 가능성, 확장성을 확보할 수 있어 DevOps, SRE, 클라우드 개발자에게 필수적인 도구로 자리 잡고 있습니다.

> 앞으로 IaC는 단순 선언형에서, 점점 더 **프로그래밍 기반 추상화**로 이동할 것입니다. CDK는 그 중심에 있는 도구입니다.
