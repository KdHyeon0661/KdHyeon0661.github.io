---
layout: post
title: AWS - S3 ë¹„ìš© ë¶„ì„ ë° ì ˆê°
date: 2025-07-18 20:20:23 +0900
category: AWS
---
# ğŸ’¸ AWS S3 ë¹„ìš© ë¶„ì„ ë° ì ˆê° ì „ëµ

## 0) ì™œ S3 ë¹„ìš© ìµœì í™”ì¸ê°€?

- ë°ì´í„°ëŠ” **ëŠë¦¬ê²Œ ì¦ê°€í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ê³„ë‹¨ì‹ìœ¼ë¡œ í­ì¦**í•œë‹¤.  
- S3ëŠ” **ì €ì¥ + ìš”ì²­ + ì „ì†¡ + ê´€ë¦¬ ê¸°ëŠ¥**ì´ ëª¨ë‘ ë¹„ìš©ì— ë°˜ì˜ëœë‹¤.  
- **ë²„ì „ ê´€ë¦¬/Replication/ë¡œê·¸**ë¥¼ ì¼œê³  ìŠëŠ” ìˆœê°„ ë¹„ìš©ì€ ëˆˆë©ì´ì²˜ëŸ¼ ë¶ˆì–´ë‚œë‹¤.

í•µì‹¬ì€ **(1) ì¸¡ì • â†’ (2) ê³„ì¸µí™” â†’ (3) ìë™í™” â†’ (4) ê°ì‹œ**ì˜ ë£¨í”„ë‹¤.

---

## 1) ë¹„ìš© êµ¬ì¡° ì •í™•íˆ ì´í•´í•˜ê¸° (ëª¨ë¸í™”)

S3 ë¹„ìš©ì€ í¬ê²Œ 4ê°œì˜ ì¶•ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

| ì¶• | ì˜ˆì‹œ | ë¹„ê³  |
|---|---|---|
| **ì €ì¥(Storage)** | GBÂ·ì›” x ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ | Standard, IA, Intelligent-Tiering, Glacier ê³„ì—´ |
| **ìš”ì²­(Requests)** | PUT/GET/LIST/SELECT ë“± 1,000ê±´ë‹¹ | DELETEëŠ” ë³´í†µ ë¬´ë£Œ |
| **ì „ì†¡(Data Transfer)** | **S3â†’ì¸í„°ë„·** ê³¼ê¸ˆ, **ë™ì¼ ë¦¬ì „ S3â†’EC2**ëŠ” ë³´í†µ ë¬´ë£Œ | ë¦¬ì „ ê°„ ì „ì†¡ ê³¼ê¸ˆ |
| **ê´€ë¦¬/ë¶€ê°€(Management)** | Inventory, Replication, Object Lambda ë“± | ì¼ë¶€ ë¬´ë£Œ/ìœ ë£Œ ì„ì„ |

### 1.1 ê°„ë‹¨ ê·¼ì‚¬ ìˆ˜ì‹

$$
\text{Cost}_{\text{S3}} \approx 
\underbrace{\sum_{m} G_m \cdot c_m}_{\text{Storage}} \;+\;
\underbrace{\sum_{t} \frac{R_t}{1000} \cdot k_t}_{\text{Requests}} \;+\;
\underbrace{\sum_{e} B_e \cdot d_e}_{\text{Data Transfer}} \;+\;
\text{(ì˜µì…˜: Replication/Inventory/Select/TA ë“±)}
$$

- \(G_m\): më²ˆì§¸ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ì›” í‰ê·  GB  
- \(c_m\): í•´ë‹¹ í´ë˜ìŠ¤ì˜ GBÂ·ì›” ë‹¨ê°€  
- \(R_t\): tìœ í˜• ìš”ì²­ ìˆ˜(ê±´)  
- \(k_t\): tìœ í˜• 1,000ê±´ë‹¹ ë‹¨ê°€  
- \(B_e\): eìœ í˜• ì•„ì›ƒë°”ìš´ë“œ GB  
- \(d_e\): eìœ í˜• GBë‹¹ ë‹¨ê°€  

> ì‹¤ì œ ë‹¨ê°€ëŠ” ì§€ì—­/ì‹œì /ì˜µì…˜ì— ë”°ë¼ ë‹¤ë¥´ë‹¤. **ì •í™• ë‹¨ê°€ ì¡°íšŒ**ëŠ” ì½˜ì†”/ê³µì‹ ê°€ê²©í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ì.

---

## 2) ë¶„ì„ ë„êµ¬ë¡œ â€œë³´ì´ëŠ” ìƒíƒœâ€ ë§Œë“¤ê¸°

### 2.1 AWS Cost Explorer (ë¹ ë¥¸ ê°€ì‹œí™”)
- **Service=S3** í•„í„° + **íƒœê·¸/ë²„í‚·/í´ë˜ìŠ¤ë³„** ë¶„ì„
- ì›”ê°„/ì¼ê°„ ë¹„ìš© ì¶”ì„¸, ì˜ˆì¸¡(í¬ìºìŠ¤íŒ…)ë„ ì œê³µ

```text
Cost Explorer â†’ Explore costs â†’ Filter: Service = Amazon Simple Storage Service (S3)
Group by: Usage type / Tag (Project, Owner) / Storage class
```

### 2.2 S3 Storage Lens (ë²„í‚· ë‚´ë¶€ êµ¬ì¡° ê´€ì°°)
- **ê°ì²´ ìˆ˜/ìš©ëŸ‰/ë¹„ìµœì‹  ë²„ì „ ë¹„ìœ¨/ìˆ˜ëª…ì£¼ê¸° ì ìš©ë¥ ** ë“± ëŒ€ì‹œë³´ë“œ
- ë¬´ë£Œ ìš”ì•½ ë¦¬í¬íŠ¸ + ìƒì„¸(ìœ ë£Œ, ì„ íƒ)

### 2.3 AWS Budgets (ì˜ˆì‚° ê²½ë³´)
- ì›” ì˜ˆì‚° ì´ˆê³¼ ì‹œ ì´ë©”ì¼/SNS ê²½ë³´

```bash
ACCOUNT_ID=123456789012
aws budgets create-budget \
  --account-id $ACCOUNT_ID \
  --budget '{
    "BudgetName": "s3-monthly-50usd",
    "BudgetLimit": {"Amount":"50","Unit":"USD"},
    "TimeUnit":"MONTHLY",
    "BudgetType":"COST"
  }' \
  --notifications-with-subscribers '[
    {"Notification":{"NotificationType":"ACTUAL","ComparisonOperator":"GREATER_THAN","Threshold":100,"ThresholdType":"PERCENTAGE"},"Subscribers":[{"SubscriptionType":"EMAIL","Address":"you@example.com"}]}
  ]'
```

### 2.4 Cost and Usage Report(CUR) + Athena (ì •ë°€ SQL ë¶„ì„)
- **ëª¨ë“  ë¹„ìš©/ì‚¬ìš©ëŸ‰**ì„ S3ì— **Parquet/ORC**ë¡œ ì ì¬ â†’ Athenaë¡œ ì¿¼ë¦¬
- í”„ë¡œì íŠ¸/íƒœê·¸/ë²„í‚·/í´ë˜ìŠ¤ ë‹¨ìœ„ ìƒì‹œ ë¦¬í¬íŒ… ê°€ëŠ¥

**Athena ì˜ˆì‹œ(ê°œë… SQL)**:
```sql
-- ìµœê·¼ 30ì¼ S3 ë¹„ìš©, ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ë³„ í•©ì‚°
SELECT
  line_item_product_code,
  product_storage_class AS storage_class,
  SUM(line_item_unblended_cost) AS cost
FROM aws_billing_cur.cur_parquet
WHERE usage_start_date >= date_add('day', -30, current_date)
  AND line_item_product_code = 'AmazonS3'
GROUP BY 1, 2
ORDER BY cost DESC;
```

---

## 3) ì ˆê° ì „ëµ â‘  ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ìµœì í™” (í•µì‹¬)

**ì›ì¹™**: â€œìì£¼ vs ë“œë¬¼ê²Œâ€ ì ‘ê·¼ ì—¬ë¶€ì— ë”°ë¼ í´ë˜ìŠ¤ ì„ íƒ.

| í´ë˜ìŠ¤ | ê°œë… | ì‚¬ìš© ì˜ˆ |
|---|---|---|
| **Standard** | ê³ ê°€ìš©/ì €ì§€ì—° | ì›¹ ìì‚°, í•«ë°ì´í„° |
| **Standard-IA** | ë“œë¬¸ ì ‘ê·¼ + ë¹ ë¥¸ ë³µêµ¬ | ë°±ì—…/ë¦¬í¬íŠ¸ |
| **One Zone-IA** | ë‹¨ì¼ AZ, ì €ê°€ | ë³µì œ/ì¬ìƒ ê°€ëŠ¥ ë¡œê·¸(ë‚´ê²°í•¨ì„± ìš”ê±´ ë‚®ì„ ë•Œ) |
| **Intelligent-Tiering** | **ìë™ ê³„ì¸µ ì´ë™** | ì•¡ì„¸ìŠ¤ íŒ¨í„´ ë¶ˆê·œì¹™ |
| **Glacier Instant Retrieval** | ë“œë¬¸ ì ‘ê·¼ + **ì¦‰ì‹œ ë³µì›** | ëŒ€ìš©ëŸ‰ ë¯¸ë””ì–´ ìŠ¤ëƒ…ìƒ· |
| **Glacier Flexible/Bulk(Deep Archive)** | ì¥ê¸° ë³´ê´€ | ê·œì œ/ê°ì‚¬ìš© ì¥ê¸° ì•„ì¹´ì´ë¸Œ |

**ì‹¤ì „ ëª…ë ¹: ì—…ë¡œë“œ ì‹œ í´ë˜ìŠ¤ ì§€ì •**
```bash
aws s3 cp myfile.txt s3://my-bucket/ --storage-class STANDARD_IA
```

**boto3 ì˜ˆì‹œ**
```python
import boto3
s3 = boto3.client("s3")
s3.upload_file(
    "file.txt", "my-bucket", "archive/file.txt",
    ExtraArgs={"StorageClass": "DEEP_ARCHIVE"}  # or GLACIER, INTELLIGENT_TIERING ...
)
```

> **Intelligent-Tiering**ì€ ëª¨ë‹ˆí„°ë§ ìˆ˜ìˆ˜ë£Œ/ì•„ì¹´ì´ë¸Œ í‹°ì–´ ë³µì› ìš”ê¸ˆ ìš”ì†Œê°€ ìˆìœ¼ë¯€ë¡œ **ì‘ì€ ê°ì²´ ëŒ€ëŸ‰**ì—” ì í•©ì¹˜ ì•Šì„ ìˆ˜ ìˆë‹¤. **Storage Lens/CURë¡œ ì„ê³„ê°’ íŒŒì•…**ì´ ì¤‘ìš”.

---

## 4) ì ˆê° ì „ëµ â‘¡ ìˆ˜ëª…ì£¼ê¸° ì •ì±…(Lifecycle)ìœ¼ë¡œ ìë™í™”

### 4.1 ê¸°ë³¸ íŒ¨í„´
- 30ì¼ í›„ â†’ IA  
- 90ì¼ í›„ â†’ Glacier  
- 365ì¼ í›„ â†’ ì‚­ì œ

**Json ì˜ˆì‹œ**
```json
{
  "Rules": [
    {
      "ID": "ArchiveLogs",
      "Filter": { "Prefix": "logs/" },
      "Status": "Enabled",
      "Transitions": [
        { "Days": 30, "StorageClass": "STANDARD_IA" },
        { "Days": 90, "StorageClass": "GLACIER" }
      ],
      "Expiration": { "Days": 365 }
    }
  ]
}
```

ì ìš©:
```bash
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-bucket \
  --lifecycle-configuration file://lifecycle.json
```

### 4.2 **ë²„ì „ ê´€ë¦¬ì™€ í•¨ê»˜**: ë¹„ìµœì‹  ë²„ì „ ì •ë¦¬
```json
{
  "Rules": [
    {
      "ID": "Purge-Noncurrent-180",
      "Status": "Enabled",
      "Filter": { "Prefix": "" },
      "NoncurrentVersionTransitions": [
        { "NoncurrentDays": 30, "StorageClass": "GLACIER" }
      ],
      "NoncurrentVersionExpiration": { "NoncurrentDays": 180 }
    }
  ]
}
```

> ë²„ì „ ê´€ë¦¬ + Lifecycle = **ë¹„ìš© í­ì¦ì„ ë°©ì§€í•˜ëŠ” í‘œì¤€ ì½¤ë³´**.

---

## 5) ì ˆê° ì „ëµ â‘¢ ì¤‘ë³µ ì œê±° & ë°ì´í„° ì •ë¦¬

- **ì¤‘ë³µ íŒŒì¼**: í•´ì‹±(ETag/Content-MD5) ë¹„êµ í›„ ì œê±°
- **ì„ì‹œ/í…ŒìŠ¤íŠ¸ ì ‘ë‘ì‚¬**: `tmp/`, `staging/`ì— **ë‹¨ê¸° ë§Œë£Œ ê·œì¹™**
- **ë¶ˆí•„ìš”í•œ ë¹„ìµœì‹  ë²„ì „**: **NoncurrentVersionExpiration**ë¡œ ìë™ ì‚­ì œ

**ê°„ì´ ìŠ¤ìºë„ˆ(ì˜ˆì‹œ)**
```python
import boto3, hashlib
s3 = boto3.client("s3")
bucket = "my-bucket"

paginator = s3.get_paginator("list_objects_v2")
hash_map = {}
for page in paginator.paginate(Bucket=bucket, Prefix="data/"):
    for obj in page.get("Contents", []):
        key = obj["Key"]
        head = s3.head_object(Bucket=bucket, Key=key)
        etag = head["ETag"].strip('"')
        if etag in hash_map:
            print("[DUP]", key, "==", hash_map[etag])
        else:
            hash_map[etag] = key
```

---

## 6) ì ˆê° ì „ëµ â‘£ ìš”ì²­(Request) ë¹„ìš© ìµœì í™”

| ìš”ì²­ | ê³¼ê¸ˆ |
|---|---|
| PUT/COPY/POST/LIST | ê³¼ê¸ˆ |
| GET/SELECT | ê³¼ê¸ˆ |
| DELETE | ë³´í†µ ë¬´ë£Œ |

### ì‹¤ë¬´ íŒ
- **Batch Upload**: ë§ì€ ì‘ì€ PUT â†’ **ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ**ë¡œ ë¬¶ê±°ë‚˜ **ì••ì¶•/ë°°ì¹˜**  
- **LIST ìµœì†Œí™”**: **í‚¤ ì„¤ê³„(ì ‘ë‘ì‚¬/íŒŒí‹°ì…˜)** + **ì¸ë±ì‹±/ì¸ë²¤í† ë¦¬** í™œìš©  
- **S3 Select**: ê°ì²´ ì „ì²´ ëŒ€ì‹  í•„ìš”í•œ **ì—´/ì¡°ê±´**ë§Œ ì½ì–´ ì „ì†¡ëŸ‰ ì ˆê°

**S3 Select ì˜ˆì‹œ(ì••ì¶• CSVì—ì„œ íŠ¹ì • ì»¬ëŸ¼ë§Œ)**
```bash
aws s3api select-object-content \
  --bucket my-bucket \
  --key logs/2025-11-10.csv.gz \
  --expression "SELECT s._1, s._5 FROM s3object s WHERE s._3 = 'ERROR'" \
  --expression-type SQL \
  --input-serialization '{"CSV":{"FileHeaderInfo":"NONE"},"CompressionType":"GZIP"}' \
  --output-serialization '{"CSV":{}}' out.json
```

---

## 7) ì ˆê° ì „ëµ â‘¤ ë°ì´í„° ì „ì†¡ ë¹„ìš© ìµœì í™”

| ê²½ë¡œ | ë¹„ìš© |
|---|---|
| **S3 â†’ ì¸í„°ë„·** | ê³¼ê¸ˆ |
| **S3 â†’ EC2 (ë™ì¼ ë¦¬ì „)** | ë³´í†µ ë¬´ë£Œ |
| **ë¦¬ì „ ê°„ ì „ì†¡** | ê³¼ê¸ˆ |

### ì‹¤ë¬´ íŒ
- **EC2ì™€ ê°™ì€ ë¦¬ì „**ì— ë²„í‚· ë°°ì¹˜
- ëŒ€ì™¸ ë°°í¬ëŠ” **CloudFront**ë¥¼ í†µí•´ ìºì‹œ/ì „ì†¡ë£Œ ìµœì í™”  
- ë‚´ë¶€ íŠ¸ë˜í”½ì€ **VPC Gateway/Interface Endpoint**ë¡œ **ì‚¬ì„¤ ê²½ë¡œ** í™•ë³´(ë³´ì•ˆ + ìš”ê¸ˆ ì˜ˆì¸¡ì„±)

---

## 8) ì‹œë‚˜ë¦¬ì˜¤ë³„ ì¢…í•© ì˜ˆì œ

### 8.1 ì‹œë‚˜ë¦¬ì˜¤ A: â€œëŒ€ìš©ëŸ‰ ë¡œê·¸ ì €ì¥ì†Œâ€
- ìš”ê±´: `logs/`ì— í•˜ë£¨ ìˆ˜ TB, ì¥ê¸° ë¶„ì„ìš©
- ì „ëµ:  
  - 30ì¼ í›„ **IA**, 90ì¼ í›„ **Glacier**, 2ë…„ í›„ **ì‚­ì œ**  
  - Athena/Glue ì¹´íƒˆë¡œê·¸ë¡œ **ì„œë²„ë¦¬ìŠ¤ ë¶„ì„**, S3 Selectë¡œ ìƒ˜í”Œë§

**Lifecycle ì˜ˆì‹œ**
```json
{
  "Rules": [
    {
      "ID": "Logs-Archive-Delete",
      "Status": "Enabled",
      "Filter": { "Prefix": "logs/" },
      "Transitions": [
        { "Days": 30, "StorageClass": "STANDARD_IA" },
        { "Days": 90, "StorageClass": "GLACIER" }
      ],
      "Expiration": { "Days": 730 }
    }
  ]
}
```

**íš¨ê³¼**: ì €ì¥ ë‹¨ê°€ ëŒ€í­ ì ˆê° + ìš”ì²­/ì „ì†¡ëŸ‰ë„ ë¶„ì„ íŒ¨í„´ ìµœì í™”ë¡œ ê°ì†Œ

---

### 8.2 ì‹œë‚˜ë¦¬ì˜¤ B: â€œë©€í‹°ë¯¸ë””ì–´ ìì‚°â€
- ìš”ê±´: í•«/ì›œ/ì½œë“œ ê³„ì¸µ, ì˜ˆì¸¡ ì–´ë ¤ì›€
- ì „ëµ: **Intelligent-Tiering** + ê¸´ ë³´ì¡´ ì£¼ê¸°, ì¸ë„¤ì¼/ë©”íƒ€ë§Œ í•« ë³´ê´€, ì›ë³¸ì€ í‹°ì–´ ì´ë™

**ì—…ë¡œë“œ**
```bash
aws s3 cp movie.mov s3://media-bkt/ --storage-class INTELLIGENT_TIERING
```

**ì£¼ì˜**: ì†Œí˜• ê°ì²´ ëŒ€ëŸ‰ì´ë©´ IT ëª¨ë‹ˆí„°ë§ ë¹„ìš© ë¹„íš¨ìœ¨ ê°€ëŠ¥ â†’ **ì„ê³„ í¬ê¸°** ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬

---

### 8.3 ì‹œë‚˜ë¦¬ì˜¤ C: â€œë°°í¬ ì‚°ì¶œë¬¼(ì›¹ ì •ì  ìì‚°)â€
- ìš”ê±´: ìµœì‹ ë³¸ë§Œ ì‚¬ìš©, ê³¼ê±°ë³¸ì€ ê±°ì˜ ë¶ˆí•„ìš”
- ì „ëµ: ë²„ì „ ê´€ë¦¬ **í™œì„±í™”**í•˜ë˜, ë¹„ìµœì‹  ë²„ì „ **ì¦‰ì‹œ Glacier ì „í™˜** ë˜ëŠ” **ì§§ì€ ë§Œë£Œ**

**Lifecycle(ë¹„ìµœì‹  ì¦‰ì‹œ Glacier + 90ì¼ ë§Œë£Œ)**
```json
{
  "Rules": [
    {
      "ID": "Artifacts-Noncurrent-Glacier",
      "Status": "Enabled",
      "NoncurrentVersionTransitions": [
        { "NoncurrentDays": 1, "StorageClass": "GLACIER" }
      ],
      "NoncurrentVersionExpiration": { "NoncurrentDays": 90 }
    }
  ]
}
```

---

## 9) ê±°ë²„ë„ŒìŠ¤ & íƒœê·¸ & ìë™ë³´ê³ 

### 9.1 **ë¹„ìš© í• ë‹¹ íƒœê·¸(Cost Allocation Tags)**
- `Project`, `Owner`, `Env`, `CostCenter` ë“± **í‘œì¤€ íƒœê·¸ ê°•ì œ**
- **Organizations â†’ SCP** ë˜ëŠ” **AWS Config** ê·œì¹™ìœ¼ë¡œ ë¹„íƒœê¹… ë¦¬ì†ŒìŠ¤ ì°¨ë‹¨/ê²½ê³ 

**ì˜ˆ) S3 íƒœê·¸ ì¼ê´„ ì ìš©**
```bash
aws s3api put-bucket-tagging \
  --bucket my-bucket \
  --tagging '{
    "TagSet":[
      {"Key":"Project","Value":"analytics"},
      {"Key":"Owner","Value":"data-team"},
      {"Key":"Env","Value":"prod"}
    ]
  }'
```

### 9.2 **S3 Inventory**ë¡œ ë²„ì „/í´ë˜ìŠ¤ ì „ìˆ˜ì¡°ì‚¬
```json
{
  "Destination": {
    "S3BucketDestination": {
      "AccountId": "<ACCOUNT_ID>",
      "Bucket": "arn:aws:s3:::inventory-bucket",
      "Format": "CSV",
      "Prefix": "inv"
    }
  },
  "IsEnabled": true,
  "Id": "daily-all",
  "IncludedObjectVersions": "All",
  "Schedule": { "Frequency": "Daily" }
}
```

ì ìš©:
```bash
aws s3api put-bucket-inventory-configuration \
  --bucket my-bucket \
  --id daily-all \
  --inventory-configuration file://inventory.json
```

### 9.3 ìë™ ë¦¬í¬íŠ¸(ì˜ˆ: Lambda + Athena + SNS)
- ë§¤ì¼ CUR/Athena ì¿¼ë¦¬ â†’ ìƒìœ„ 10 ë²„í‚· ë¹„ìš©/ì¦ê° â†’ SNS ë©”ì¼/Slack

---

## 10) ìš”ì²­/ì „ì†¡ ìµœì í™” ê³ ê¸‰ íŒ

- **ë¦¬ìŠ¤íŠ¸ í­ë°œ** ë°©ì§€: **í‚¤ ì ‘ë‘ì‚¬ íŒ¨í„´**(ì—°/ì›”/ì¼/í•´ì‹œ)ë¡œ ë¶„í•  â†’ LIST ë²”ìœ„ ê°ì†Œ  
- **Batch Operations**: ë©”íƒ€ë°ì´í„°/í´ë˜ìŠ¤ ì¼ê´„ ë³€ê²½(ìš”ì²­ ìˆ˜ë¥¼ ì œì–´)  
- **ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ**: í° íŒŒì¼ì—ì„œ ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ ê·¹ëŒ€í™”  
- **CloudFront**: GET ìš”ì²­ì„ ìºì‹œì— í¡ìˆ˜í•˜ì—¬ S3 GET/LIST ë¹„ìš© ì ˆê° + ì „ì†¡ë£Œ ìµœì í™”

**CloudFront ë¬´íš¨í™”(ë°°í¬ ì—…ë°ì´íŠ¸)**
```bash
aws cloudfront create-invalidation \
  --distribution-id E123ABC456 \
  --paths "/*"
```

---

## 11) ë³µì œ(Replication) ë¹„ìš© ê´€ë¦¬

- **CRR/SRR**ì€ **ìŠ¤í† ë¦¬ì§€ + ìš”ì²­ + ì „ì†¡** ë¹„ìš©ì„ ìœ ë°œ  
- ëŒ€ìƒ ë²„í‚· ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ëŠ” **IA/Glacier** ë“± ì„ íƒ ê°€ëŠ¥  
- **Delete Marker ë³µì œ** ì—¬ë¶€/í•„í„°(ì ‘ë‘ì‚¬/íƒœê·¸)ë¡œ ë¹„ìš© ì œì–´

**Replication ìŠ¤ë‹ˆí«**
```json
{
  "Role": "arn:aws:iam::<ACCOUNT_ID>:role/s3-replication-role",
  "Rules": [
    {
      "ID": "Replicate-Logs",
      "Status": "Enabled",
      "Priority": 1,
      "Filter": { "Prefix": "logs/" },
      "Destination": {
        "Bucket": "arn:aws:s3:::dr-bucket",
        "StorageClass": "STANDARD_IA"
      },
      "DeleteMarkerReplication": { "Status": "Disabled" }
    }
  ]
}
```

---

## 12) ë³´ì•ˆê³¼ ì ˆê°ì˜ ë™ì‹œ ë‹¬ì„±

| ê¸°ëŠ¥ | ì ˆê° ê´€ì  | ë¹„ê³  |
|---|---|---|
| **SSE-S3** | ì¶”ê°€ ìš”ê¸ˆ ì—†ìŒ | ê¸°ë³¸ ì„œë²„ì¸¡ ì•”í˜¸í™” |
| **SSE-KMS** | **KMS ìš”ì²­/í‚¤ ê´€ë¦¬ ë¹„ìš©** | ë³´ì•ˆ/ê°ì‚¬ ìš”êµ¬ì™€ ê· í˜• |
| **Object Lock** | ë¶ˆë³€ì„± + ì¥ê¸° ì•„ì¹´ì´ë¸Œ(Class í˜¼í•©) | Glacierì™€ ë³‘í–‰ |
| **VPC Endpoint** | ì‚¬ì„¤ ê²½ë¡œ, ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë¹„ìš© | ë³´ì•ˆ + ì „ì†¡ë¹„ ì „ëµ |

> **CloudTrail**/Storage Lens/Configë¡œ **ì„¤ì • ë“œë¦¬í”„íŠ¸**ë¥¼ ì¦‰ì‹œ ê°ì§€í•´ **ë¶ˆí•„ìš” ë¹„ìš© ë£¨í”„**ë¥¼ ì°¨ë‹¨.

---

## 13) ê°„ë‹¨ ë¹„ìš© ì‹œë®¬ë ˆì´ì…˜ (ë³€ìˆ˜ ê¸°ë°˜)

ì˜ˆ) ì›” ê¸°ì¤€:
- Standard 10 TB, IA 50 TB, Glacier 100 TB  
- GET 50M, PUT 1M, LIST 100K  
- ì¸í„°ë„· ì „ì†¡ 5 TB

ì´ ë¹„ìš© ê·¼ì‚¬:
$$
\begin{aligned}
\text{Cost} \approx & \; 10{,}240 \cdot c_{\text{STD}}
+ 51{,}200 \cdot c_{\text{IA}}
+ 102{,}400 \cdot c_{\text{GLA}} \\
& + \frac{50{,}000{,}000}{1000} \cdot k_{\text{GET}}
+ \frac{1{,}000{,}000}{1000} \cdot k_{\text{PUT}}
+ \frac{100{,}000}{1000} \cdot k_{\text{LIST}} \\
& + 5{,}120 \cdot d_{\text{internet}}
\end{aligned}
$$

- ë‹¨ê°€ \(c, k, d\)ëŠ” **ì§€ì—­/ì‹œì /ê³µì‹ ê°€ê²©í‘œ**ë¡œ ì¹˜í™˜  
- **ë¯¼ê° íŒŒë¼ë¯¸í„°(ìƒìœ„ ë¹„ìš© í•­ëª©)**ë¥¼ ì°¾ì•„ **ê³„ì¸µ/ì •ì±…/ìºì‹œ**ë¡œ ì§‘ì¤‘ ëŒ€ì‘

---

## 14) ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] **Cost Explorer/Storage Lens** ëŒ€ì‹œë³´ë“œ í™œì„±  
- [x] **Cost Allocation Tags** ìŠ¹ì¸ + í‘œì¤€ íƒœê·¸ í•„ìˆ˜í™”  
- [x] **Lifecycle**: Noncurrent/Transition/Expiration ì„¤ê³„  
- [x] **Intelligent-Tiering**: ì í•© ì§‘í•©ì—ë§Œ ì ìš©(ì‘ì€ ê°ì²´ ì£¼ì˜)  
- [x] **CloudFront**ë¡œ GET/ì „ì†¡ ìµœì í™”  
- [x] **Replication**: ë²”ìœ„/í´ë˜ìŠ¤/ì‚­ì œë§ˆì»¤ ì •ì±…ìœ¼ë¡œ ë¹„ìš© í†µì œ  
- [x] **Athena + CUR**ë¡œ ì›”ê°„ ë¦¬í¬íŠ¸ ìë™í™”  
- [x] **Budgets/Anomaly Detection** ì•Œë¦¼

---

## 15) ìë™í™” ìŠ¤ë‹ˆí« ëª¨ìŒ

### 15.1 íŠ¹ì • ì ‘ë‘ì‚¬ ì¼ê´„ í´ë˜ìŠ¤ ì „í™˜(Batch Operations ì—†ì´ ê°„ë‹¨ ë£¨í”„)
```bash
PREFIX=archive/
BUCKET=my-bucket
aws s3api list-objects-v2 --bucket $BUCKET --prefix $PREFIX --query 'Contents[].Key' --output text |
tr '\t' '\n' | while read K; do
  aws s3api copy-object \
    --bucket $BUCKET \
    --copy-source ${BUCKET}/${K} \
    --key "$K" \
    --storage-class GLACIER \
    --metadata-directive REPLACE
done
```

### 15.2 Athena ë¦¬í¬íŠ¸ â†’ SNS ë°œì†¡(Lambda ì˜ì‚¬ì½”ë“œ)
```python
import boto3, json, time

athena = boto3.client('athena')
sns = boto3.client('sns')

def run_query(sql):
    r = athena.start_query_execution(
        QueryString=sql,
        QueryExecutionContext={'Database':'cur'},
        ResultConfiguration={'OutputLocation':'s3://athena-results/'}
    )
    qid = r['QueryExecutionId']
    # ... wait/poll ...
    # ... fetch results ...
    return results

def handler(event, context):
    sql = """
    SELECT product_storage_class, SUM(line_item_unblended_cost) cost
    FROM aws_billing_cur.cur_parquet
    WHERE usage_start_date >= date_add('day', -7, current_date)
      AND line_item_product_code='AmazonS3'
    GROUP BY 1 ORDER BY cost DESC
    """
    res = run_query(sql)
    msg = json.dumps(res, indent=2)
    sns.publish(TopicArn='arn:aws:sns:ap-northeast-2:123:cost', Message=msg, Subject='Weekly S3 Cost')
```

---

## 16) íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

| ì¦ìƒ | ì›ì¸ | í•´ê²° |
|---|---|---|
| ë¹„ìš© ê¸‰ì¦(ì €ì¥) | ë¹„ìµœì‹  ë²„ì „/ì„ì‹œ ë°ì´í„° ëˆ„ì  | Lifecycleë¡œ Noncurrent/Prefix ë§Œë£Œ |
| ë¹„ìš© ê¸‰ì¦(ìš”ì²­) | í­ì¦í•˜ëŠ” LIST/GET | CloudFront ìºì‹œ, ì ‘ë‘ì‚¬ ì„¤ê³„, Inventory/Index |
| ë³µì› ë¹„ìš© ê³¼ë‹¤ | Glacier ë³µêµ¬ ëŸ¬ì‹œ | ë³µêµ¬ ë“±ê¸‰/ë°°ì¹˜/ì¼ì • ì¡°ì •(ë¶„ì‚°) |
| ì „ì†¡ë¹„ ê³¼ë‹¤ | ì¸í„°ë„· ëŒ€ì—­í­ ì†Œë¹„ | CloudFront, ë™ì¼ ë¦¬ì „ ì²˜ë¦¬, ì‚¬ì„¤ ì—”ë“œí¬ì¸íŠ¸ |
| IT ì ìš©í–ˆëŠ”ë° ì ˆê° ë¯¸ì•½ | ì‘ì€ ê°ì²´ ëŒ€ëŸ‰ | í¬ê¸° ì„ê³„ì¹˜/ëŒ€ìƒ í•„í„° ì¬ì„¤ê³„ |

---

## 17) ìš”ì•½(ì´ˆì•ˆ ì¬ì •ë¦¬ + ë³´ê°•)

| ì „ëµ | í•µì‹¬ |
|---|---|
| ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ | **ì ‘ê·¼ íŒ¨í„´ ë””ìì¸**: Standard â†” IA â†” Glacier(Instant/Deep) |
| ìˆ˜ëª… ì£¼ê¸° | **ì˜¤ë˜ëœ/ë¹„ìµœì‹  ë²„ì „ ìë™ ì´ë™/ì‚­ì œ** |
| ìš”ì²­/ì „ì†¡ | **Batch/ë©€í‹°íŒŒíŠ¸/ìºì‹œ/ì‚¬ì„¤ê²½ë¡œ** |
| ê±°ë²„ë„ŒìŠ¤ | **íƒœê·¸/Inventory/Storage Lens/Config/CloudTrail** |
| ë¶„ì„ | **Cost Explorer + CUR + Athena**(ìë™ ë¦¬í¬íŠ¸/ì•Œë¦¼) |
| ìë™í™” | **Lambda/Batch Operations**ë¡œ ë°˜ë³µ ì œê±° |

---

## 18) ì¹˜íŠ¸ì‹œíŠ¸

```bash
# 1) Lifecycle ì ìš©
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-bucket \
  --lifecycle-configuration file://lifecycle.json

# 2) Intelligent-Tiering ì—…ë¡œë“œ
aws s3 cp file.bin s3://my-bucket/ --storage-class INTELLIGENT_TIERING

# 3) Inventory êµ¬ì„±
aws s3api put-bucket-inventory-configuration \
  --bucket my-bucket --id daily-all \
  --inventory-configuration file://inventory.json

# 4) CloudFront ìºì‹œ ë¬´íš¨í™”
aws cloudfront create-invalidation --distribution-id E123ABC456 --paths "/*"

# 5) Budgets ìƒì„±(50USD)
aws budgets create-budget --account-id $ACCOUNT_ID \
  --budget '{"BudgetName":"s3-50usd","BudgetLimit":{"Amount":"50","Unit":"USD"},"TimeUnit":"MONTHLY","BudgetType":"COST"}'
```

---

ì´ë¡œì¨ **S3 ë¹„ìš© êµ¬ì¡° â†’ ë¶„ì„ ë„êµ¬ â†’ í´ë˜ìŠ¤/ì •ì±…/ìš”ì²­/ì „ì†¡ ìµœì í™” â†’ ê±°ë²„ë„ŒìŠ¤/ìë™í™” â†’ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…**ê¹Œì§€,  
ì´ˆì•ˆì˜ ë‚´ìš©ì„ **ì˜ˆì œÂ·ì½”ë“œÂ·ìˆ˜ì‹** ê¸°ë°˜ìœ¼ë¡œ í™•ì¥í•´ **ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ ì‹¤ì „ ê°€ì´ë“œ**ë¡œ ì •ë¦¬í–ˆë‹¤.  
ë‹¤ìŒ ë‹¨ê³„ëŠ” **ë‹¹ì‹ ì˜ ì‹¤ì œ ë²„í‚·/íƒœê·¸ ì²´ê³„**ì— ìœ„ ì „ëµì„ ë§¤í•‘í•´ **ì£¼ê°„ ë¦¬í¬íŠ¸ & ì˜ˆì‚° ê²½ë³´**ë¥¼ ëŒë¦¬ëŠ” ê²ƒì´ë‹¤.