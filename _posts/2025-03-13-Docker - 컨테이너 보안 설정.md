---
layout: post
title: Docker - ì»¨í…Œì´ë„ˆ ë³´ì•ˆ ì„¤ì •
date: 2025-03-13 19:20:23 +0900
category: Docker
---
# ğŸ” ì»¨í…Œì´ë„ˆ ë³´ì•ˆ ì„¤ì •
> root ê¶Œí•œ ì œê±°, ì½ê¸° ì „ìš© íŒŒì¼ ì‹œìŠ¤í…œ, ì»¤ë„ ì œì–´ ì œí•œ ë“±

---

## 1ï¸âƒ£ ê¸°ë³¸ ë¬¸ì œ: Docker ì»¨í…Œì´ë„ˆëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `root` ê¶Œí•œ

- ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ root ê³„ì •ì€ ì‹¤ì œë¡œ **í˜¸ìŠ¤íŠ¸ì˜ rootì™€ ê±°ì˜ ë™ì¼í•œ ê¶Œí•œ**
- í•´í‚¹, ì´ë¯¸ì§€ ì·¨ì•½ì , ë‚´ë¶€ ì•…ì˜ì  ì½”ë“œ ë“±ì´ ìˆìœ¼ë©´ **í˜¸ìŠ¤íŠ¸ê¹Œì§€ ì¹¨íˆ¬ ê°€ëŠ¥**

---

## 2ï¸âƒ£ ğŸ§° ê¶Œí•œ ìµœì†Œí™”ë¥¼ ìœ„í•œ ë³´ì•ˆ ì„¤ì • ëª©ë¡

| ë³´ì•ˆ ì „ëµ | ì„¤ëª… |
|-----------|------|
| **ë¹„ë£¨íŠ¸ ì‚¬ìš©ì ì‹¤í–‰** | Dockerfile ë˜ëŠ” ì‹¤í–‰ ì‹œ ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰ |
| **ì½ê¸° ì „ìš© íŒŒì¼ ì‹œìŠ¤í…œ** | íŒŒì¼ ì‹œìŠ¤í…œì„ read-onlyë¡œ ì œí•œ |
| **capabilities ì œí•œ** | í•„ìš”í•œ ì»¤ë„ ê¶Œí•œë§Œ ìµœì†Œ ì œê³µ |
| **seccomp profile** | ì‹œìŠ¤í…œ ì½œ ì œí•œ |
| **AppArmor / SELinux** | OS ë³´ì•ˆ ëª¨ë“ˆ ì ìš© |
| **í˜¸ìŠ¤íŠ¸ ê²½ë¡œ ë§ˆìš´íŠ¸ ê¸ˆì§€** | ìœ„í—˜í•œ `/var/run`, `/proc` ë“±ì˜ ë§ˆìš´íŠ¸ í”¼í•˜ê¸° |

---

## ğŸ§ª 1. Dockerfileì—ì„œ ë¹„ë£¨íŠ¸ ì‚¬ìš©ì ìƒì„±

```dockerfile
FROM python:3.11-slim

# ì¼ë°˜ ì‚¬ìš©ì ìƒì„±
RUN useradd -m appuser

WORKDIR /app
COPY . .

# ê¶Œí•œ ë¶€ì—¬
RUN chown -R appuser /app

# ì‚¬ìš©ì ë³€ê²½
USER appuser

CMD ["python", "app.py"]
```

âœ… ê²°ê³¼: ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ `id` â†’ UID 1000 ì´í•˜ ì¼ë°˜ ì‚¬ìš©ì

---

## ğŸ§ª 2. docker run ì‹œ `--user` ì§€ì •

```bash
docker run --user 1001:1001 myapp
```

- UID: 1001, GID: 1001 ì‚¬ìš©ìë¡œ ì‹¤í–‰
- Dockerfile ìˆ˜ì • ì—†ì´ë„ ì ìš© ê°€ëŠ¥

---

## ğŸ”’ 3. ì½ê¸° ì „ìš© íŒŒì¼ ì‹œìŠ¤í…œ (`--read-only`)

```bash
docker run --read-only myapp
```

- `/` ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì´ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§ˆìš´íŠ¸ë¨
- ë¡œê·¸, ìºì‹œ ë“±ì€ ë”°ë¡œ `tmpfs` ë˜ëŠ” `volume`ìœ¼ë¡œ ì²˜ë¦¬ í•„ìš”

### ì˜ˆì‹œ (ì“°ê¸° ê°€ëŠ¥í•œ ê²½ë¡œ ì§€ì •)

```bash
docker run \
  --read-only \
  --tmpfs /tmp \
  -v app-data:/app/data \
  myapp
```

---

## ğŸ§± 4. Capabilities ìµœì†Œí™” (`--cap-drop`)

Linux ì»¤ë„ ê¶Œí•œì„ ì„¸ë¶„í™”í•´ ì œí•œ ê°€ëŠ¥

```bash
docker run \
  --cap-drop ALL \
  --cap-add NET_BIND_SERVICE \
  myapp
```

- ëª¨ë“  ê¶Œí•œ ì œê±° í›„ íŠ¹ì • ê¶Œí•œë§Œ ì¶”ê°€
- `NET_BIND_SERVICE`: 1024 ì´í•˜ í¬íŠ¸ ë°”ì¸ë”© í—ˆìš©

---

## ğŸ›¡ï¸ 5. Seccomp í”„ë¡œíŒŒì¼ ì ìš©

ì‹œìŠ¤í…œ ì½œ ì œí•œì„ ìœ„í•œ JSON íŒŒì¼ ì„¤ì •

```bash
docker run --security-opt seccomp=default.json myapp
```

- Docker ê¸°ë³¸ seccompëŠ” 300ì—¬ ê°œ syscall ì°¨ë‹¨
- ì‚¬ìš©ì ì •ì˜ seccomp.json íŒŒì¼ë„ ì ìš© ê°€ëŠ¥

ğŸ‘‰ [ê¸°ë³¸ seccomp JSON](https://github.com/moby/moby/blob/master/profiles/seccomp/default.json)

---

## ğŸ§± 6. AppArmor or SELinux í”„ë¡œíŒŒì¼

### AppArmor ì˜ˆì‹œ (Ubuntu ê³„ì—´)

```bash
docker run --security-opt apparmor=docker-default myapp
```

- ì»¤ë„ ìˆ˜ì¤€ ë³´ì•ˆ ì œì–´
- `/etc/apparmor.d/`ì—ì„œ ì‚¬ìš©ì ì •ì˜ ê°€ëŠ¥

---

## ğŸ§¨ 7. Privileged ëª¨ë“œ ë¹„í™œì„±í™”

âš ï¸ ì ˆëŒ€ë¡œ `--privileged`ëŠ” ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ

```bash
docker run --privileged myapp  # âŒ ìœ„í—˜í•œ ì „ì²´ ê¶Œí•œ ë¶€ì—¬
```

- ëª¨ë“  ë””ë°”ì´ìŠ¤, ì‹œìŠ¤í…œì½œ, ì»¤ë„ ì¸í„°í˜ì´ìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥
- í…ŒìŠ¤íŠ¸ í™˜ê²½ ì™¸ì—ëŠ” ì ˆëŒ€ ê¸ˆì§€

---

## ğŸ“¦ ì¢…í•© ì˜ˆì‹œ

```bash
docker run \
  --user 1001:1001 \
  --read-only \
  --tmpfs /tmp \
  --cap-drop ALL \
  --cap-add NET_BIND_SERVICE \
  --security-opt seccomp=default.json \
  --security-opt apparmor=docker-default \
  myapp
```

---

## âœ… ë³´ì•ˆ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

| í•­ëª© | ì²´í¬ |
|------|------|
| ë¹„ë£¨íŠ¸ ì‚¬ìš©ìë¡œ ì‹¤í–‰í–ˆëŠ”ê°€? | âœ… |
| ì½ê¸° ì „ìš© íŒŒì¼ì‹œìŠ¤í…œì¸ê°€? | âœ… |
| í•„ìš”í•œ ì»¤ë„ Capabilitiesë§Œ í—ˆìš©í–ˆëŠ”ê°€? | âœ… |
| ë¶ˆí•„ìš”í•œ ë³¼ë¥¨/ë””ë°”ì´ìŠ¤ ê³µìœ ë¥¼ ì œê±°í–ˆëŠ”ê°€? | âœ… |
| ë³´ì•ˆ í”„ë¡œíŒŒì¼ (Seccomp/AppArmor) ì ìš©í–ˆëŠ”ê°€? | âœ… |
| `--privileged` ì‚¬ìš©ì„ í”¼í–ˆëŠ”ê°€? | âœ… |

---

## ğŸ§ª ì¶”ê°€ ë„êµ¬

| ë„êµ¬ | ì—­í•  |
|------|------|
| Trivy | ì´ë¯¸ì§€ ì·¨ì•½ì  ìŠ¤ìº” |
| Dockle | Dockerfile ë³´ì•ˆ ë¦°íŠ¸ |
| OPA/Gatekeeper | ë°°í¬ ì •ì±… ê²€ì‚¬ |
| Falco | ëŸ°íƒ€ì„ ë³´ì•ˆ ê°ì‹œ ë„êµ¬ |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Docker Security ê³µì‹ ë¬¸ì„œ](https://docs.docker.com/engine/security/)
- [OWASP Docker Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)
- [Docker Capabilities ëª©ë¡](https://man7.org/linux/man-pages/man7/capabilities.7.html)
- [Seccomp ê¸°ë³¸ í”„ë¡œíŒŒì¼](https://github.com/moby/moby/blob/master/profiles/seccomp/default.json)
