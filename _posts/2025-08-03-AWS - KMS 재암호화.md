---
layout: post
title: AWS - KMS ì¬ì•”í˜¸í™”
date: 2025-08-03 23:20:23 +0900
category: AWS
---
# ğŸ” KMS ì¬ì•”í˜¸í™”(ReEncrypt)ë¡œ í‚¤ êµì²´í•˜ëŠ” **ë‹¨ê³„ë³„** ìŠ¤í¬ë¦½íŠ¸ & ìš´ì˜ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” AWS KMSì˜ **ReEncrypt** ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ "ê¸°ì¡´ ë°ì´í„°(ë˜ëŠ” ë°ì´í„° í‚¤ì— ëŒ€í•œ ì•”í˜¸ë¬¸)ë¥¼ ìƒˆ CMK(ë˜ëŠ” ë‹¤ë¥¸ CMK)ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ êµì²´(í‚¤ ì „í™˜/í‚¤ êµì²´)"í•˜ëŠ” **ì‹¤ë¬´ìš© ë‹¨ê³„ë³„ ìŠ¤í¬ë¦½íŠ¸**ì™€ ìš´ì˜Â·ë³´ì•ˆÂ·ëŒ€ê·œëª¨ ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­ì„ í¬í•¨í•©ë‹ˆë‹¤.

## ìš”ì•½(í•œì¤„)
- **ëª©í‘œ**: í‰ë¬¸ ë…¸ì¶œ ì—†ì´(ê°€ëŠ¥í•œ ê²½ìš°) ê¸°ì¡´ ì•”í˜¸ë¬¸ì„ ìƒˆ í‚¤ë¡œ ì˜®ê¸°ëŠ” ê²ƒ.  
- **í•µì‹¬ ë„êµ¬**: `KMS.ReEncrypt` API (CLI: `aws kms re-encrypt` / boto3: `re_encrypt`) â€” KMS ë‚´ë¶€ì—ì„œ ë³µí˜¸í™” í›„ ì¬ì•”í˜¸í™” ìˆ˜í–‰.  
- **ì ìš© ëŒ€ìƒ**: KMSë¡œ ì•”í˜¸í™”ëœ "ì•”í˜¸ë¬¸(ì˜ˆ: encrypted data key)" ë˜ëŠ” KMSê°€ ì•”í˜¸í™”í•œ ë‹¨ì¼ ë°”ì´íŠ¸ ë¸”ë¡(ì˜ˆ: íŒŒì¼ì˜ CiphertextBlob).  
- **ëŒ€ì²´/ë³´ì™„**: S3ì˜ SSE-KMS ê°ì²´ëŠ” S3 Copy(ë˜ëŠ” S3 Batch Operations)ë¡œ í‚¤ë¥¼ ë°”ê¾¸ëŠ” ê²ƒì´ ì¼ë°˜ì .

---

## ëª©ì°¨
1. ì‚¬ì „ ê°œë… ì •ë¦¬ â€” ì–¸ì œ ReEncryptë¥¼ ì“°ë‚˜  
2. ì „ëµ(ë°©ë²•) ìš”ì•½ â€” 3ê°€ì§€ íŒ¨í„´  
3. ì‚¬ì „ ì¤€ë¹„ (ê¶Œí•œÂ·ì •ì±…Â·í…ŒìŠ¤íŠ¸)  
4. ë°©ë²• A â€” **KMS ReEncrypt**ë¡œ ì•”í˜¸ë¬¸(ë°ì´í„°í‚¤ ë“±) ì§ì ‘ êµì²´ (ê¶Œì¥, í‰ë¬¸ ë¹„ë…¸ì¶œ)  
   - CLI ì˜ˆì œ  
   - boto3(íŒŒì´ì¬) ì˜ˆì œ  
5. ë°©ë²• B â€” S3 SSE-KMS ê°ì²´ì˜ í‚¤ ë³€ê²½ (Copy / Batch)  
   - CLI / boto3 ì˜ˆì œ  
6. ë°©ë²• C â€” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ(í‰ë¬¸ ë³µí˜¸í™” â†’ ì¬ì•”í˜¸í™”) (ë¶ˆê°€í”¼í•œ ê²½ìš°)  
7. ëŒ€ê·œëª¨ ë§ˆì´ê·¸ë ˆì´ì…˜ ìš´ì˜ íŒ (ë°°ì¹˜, ëª¨ë‹ˆí„°ë§, ì˜¤ë¥˜Â·ì¬ì‹œë„, ë¡¤ë°±)  
8. ë³´ì•ˆÂ·ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸  
9. FAQ(ìì£¼ ë¬»ëŠ” ì§ˆë¬¸)

---

## 1) ì‚¬ì „ ê°œë… â€” ì–¸ì œ ReEncryptë¥¼ ì“°ë‚˜
- **ReEncrypt**ëŠ” KMSê°€ ê´€ë¦¬í•˜ëŠ” ì•”í˜¸ë¬¸(ì˜ˆ: `GenerateDataKey`ì—ì„œ ë‚˜ì˜¨ `CiphertextBlob`, í˜¹ì€ `Encrypt`ë¡œ ë§Œë“  ì•”í˜¸ë¬¸)ì„ **KMS ë‚´ë¶€ì—ì„œ** ë³µí˜¸í™”í•œ ë’¤ *ë‹¤ë¥¸* CMKë¡œ ì¬ì•”í˜¸í™”í•´ ìƒˆ ì•”í˜¸ë¬¸ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- ì¥ì : ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **í‰ë¬¸(Plaintext)** ì„ ì§ì ‘ ë‹¤ë£¨ì§€ ì•Šì•„ë„ ë¨ â†’ **ì•ˆì „ì„± ìš°ìˆ˜**.
- ì£¼ì˜: ReEncryptëŠ” **ì›ë³¸ ì•”í˜¸ë¬¸ì´ KMSì—ì„œ ìƒì„±ëœ í˜•íƒœ**(ì¦‰ KMSê°€ ê´€ë¦¬í•˜ëŠ” ì•”í˜¸ë¬¸)ì—¬ì•¼ ì œëŒ€ë¡œ ë™ì‘. ì¼ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìì²´ ìƒì„±Â·ê´€ë¦¬í•œ ì•”í˜¸ë¬¸(ì˜ˆ: ìì²´ RSA ì•”í˜¸í™” ê²°ê³¼)ì€ ë¨¼ì € ë³µí˜¸í™” í›„ ì¬ì•”í˜¸í™”í•´ì•¼ í•¨.

---

## 2) ì „ëµ(ë°©ë²•) ìš”ì•½ â€” ì„¸ ê°€ì§€ íŒ¨í„´

A. **ReEncrypt ë°ì´í„° í‚¤(ê¶Œì¥)**  
   - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ envelope encryption íŒ¨í„´: `CiphertextDataKey`(KMS ì•”í˜¸ë¬¸) + ì‹¤ì œ ë°ì´í„°(ëŒ€ì¹­í‚¤ë¡œ ì•”í˜¸í™”)ë¡œ ì €ì¥í•´ ë‘” ê²½ìš°, **CiphertextDataKeyë§Œ ReEncrypt**í•˜ë©´ ë¨. ë°ì´í„° ìì²´ëŠ” ê±´ë“œë¦´ í•„ìš” ì—†ìŒ. (í‰ë¬¸ ë°ì´í„° í‚¤ê°€ ë…¸ì¶œë˜ì§€ ì•ŠìŒ.)

B. **S3 SSE-KMS ê°ì²´ í‚¤ êµì²´**  
   - S3ì—ì„œ SSE-KMSë¡œ ë³´í˜¸ëœ ê°ì²´ëŠ” **S3 CopyObject** (ë˜ëŠ” S3 Batch Operations)ë¥¼ í†µí•´ ìƒˆ KMS í‚¤ë¡œ ì¬ì•”í˜¸í™”(ë³µì‚¬) ê°€ëŠ¥. ë‚´ë¶€ì ìœ¼ë¡œ S3ê°€ ê°ì²´ë¥¼ ì½ì–´ ìƒˆ í‚¤ë¡œ ì“°ë¯€ë¡œ ì‚¬ìš©ìê°€ í‰ë¬¸ì„ ë‹¤ë£¨ì§€ ì•Šì•„ë„ ë¨.

C. **í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì•”í˜¸í™”(ì§ì ‘ ë³µí˜¸í™” â†’ ì¬ì•”í˜¸í™”)**  
   - ëŒ€ìƒ ì•”í˜¸ë¬¸ì´ KMSì™€ ë¬´ê´€í•˜ê±°ë‚˜ ReEncryptë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ. ì´ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°ì´í„°ë¥¼ ë³µí˜¸í™”(í‰ë¬¸ ì·¨ë“) í›„ ìƒˆ í‚¤ë¡œ ì¬ì•”í˜¸í™”í•¨. **í‰ë¬¸ ë…¸ì¶œ ë¦¬ìŠ¤í¬**ì™€ KMS í˜¸ì¶œ ì¦ê°€ì— ì£¼ì˜.

---

## 3) ì‚¬ì „ ì¤€ë¹„ (ê¶Œí•œÂ·ì •ì±…Â·í…ŒìŠ¤íŠ¸)
- **ê¶Œí•œ(ìµœì†Œ ê¶Œí•œ ì›ì¹™)**  
  - ReEncryptë¥¼ ìˆ˜í–‰í•  ì£¼ì²´(ì˜ˆ: `DataMigratorRole`)ì— ë‹¤ìŒ ê¶Œí•œì´ í•„ìš”:
    - `kms:ReEncryptFrom` (ë˜ëŠ” `kms:ReEncrypt*`) on **ì†ŒìŠ¤ í‚¤**
    - `kms:ReEncryptTo` (ë˜ëŠ” `kms:ReEncrypt*`) on **ëŒ€ìƒ í‚¤**
    - `kms:DescribeKey` (ê¶Œì¥)
    - (S3 ê°ì²´ ìˆ˜ì • ì‹œ) `s3:GetObject`, `s3:PutObject`, `s3:CopyObject`, `s3:ListBucket` ë“±
  - ì½˜ì†”/ë¬¸ì„œ í¸ì˜ìƒ `kms:ReEncrypt*`ë¡œ ì–‘ìª½ í‚¤ì— í—ˆìš©í•˜ë©´ ê°„ë‹¨(í•˜ì§€ë§Œ ë” ì„¸ë¶„í™”ëœ ì •ì±… ê¶Œì¥).

- **í‚¤ ì •ì±…**  
  - ì†ŒìŠ¤/ëŒ€ìƒ CMKì˜ í‚¤ ì •ì±…(Key policy)ì— `ReEncryptFrom`/`ReEncryptTo` ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤. (KMS ë¬¸ì„œ ê¶Œì¥)

- **í…ŒìŠ¤íŠ¸ í™˜ê²½**  
  - í”„ë¡œë•ì…˜ ì „ **ì‘ì€ ìƒ˜í”Œ ë°ì´í„°ì…‹**(S3 ë²„í‚· ë³µì œë³¸ ë˜ëŠ” í…ŒìŠ¤íŠ¸ ê°ì²´)ì„ ì¤€ë¹„í•´ ë¨¼ì € í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.
  - **ë²„ì „ê´€ë¦¬(ì˜ˆ: S3 ë²„ì „)**, ë°±ì—…ì„ ì¼œë‘ê³  ì‹œë„í•˜ì„¸ìš”.

---

## 4) ë°©ë²• A â€” KMS `ReEncrypt`ë¡œ **ì•”í˜¸ë¬¸(ë°ì´í„°í‚¤ ë“±)** ì§ì ‘ êµì²´ (ê¶Œì¥)

### íë¦„ (envelope encryption ì‹œ)
1. ê°ì²´(ë˜ëŠ” DB ë ˆì½”ë“œ)ì— ì €ì¥ëœ `EncryptedDataKey`(=old_ciphertext_blob)ì™€ encryption context(metadata)ë¥¼ ì½ì–´ì˜¨ë‹¤.  
2. KMS `ReEncrypt` í˜¸ì¶œ: `CiphertextBlob=old_blob`, `DestinationKeyId=new_cmk_arn`, `SourceEncryptionContext=...` (í•„ìš” ì‹œ), `DestinationEncryptionContext=...` (í•„ìš” ì‹œ).  
3. KMSê°€ ìƒˆë¡œìš´ `CiphertextBlob`(new_blob)ì„ ë°˜í™˜. ì´ê±¸ ê°ì²´ì˜ ë©”íƒ€ë°ì´í„°(DB ì»¬ëŸ¼)ì— ì €ì¥(êµì²´).  
   - **ì¤‘ìš”**: ìƒˆ blobì„ ì €ì¥í•˜ê¸° ì „ê¹Œì§€ ì›ë³¸ì„ ë³´ì¡´(atomic êµì²´/ë²„ì „) â€” ì‹¤íŒ¨ ëŒ€ë¹„.

### CLI ì˜ˆì œ (ë¡œì»¬ íŒŒì¼: old_ciphertext.bin â†’ new_ciphertext.bin)

```bash
# 1) re-encrypt: old ciphertext file -> new ciphertext (base64 binary in JSON; we write raw bytes)
aws kms re-encrypt \
  --ciphertext-blob fileb://old_ciphertext.bin \
  --destination-key-id arn:aws:kms:ap-northeast-2:123456789012:key/NEW-KEY-ID \
  --source-encryption-context '{"purpose":"file-backup"}' \
  --destination-encryption-context '{"purpose":"file-backup","rotated":"2025-08-10"}' \
  --query CiphertextBlob --output text | base64 --decode > new_ciphertext.bin
```

> `--source-encryption-context`/`--destination-encryption-context` ëŠ” í•„ìš”í•˜ë©´ JSON ë¬¸ìì—´ë¡œ ì „ë‹¬. (CLIì˜ quoting ì£¼ì˜)

### boto3 (Python) ì˜ˆì œ â€” S3 ê°ì²´ì˜ encrypted-data-keyë¥¼ ì¬ì•”í˜¸í™”í•˜ê³  ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸

ì•„ë˜ ì˜ˆì‹œëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ì´ envelope ë°©ì‹**ìœ¼ë¡œ S3 ê°ì²´ë¥¼ ì €ì¥í–ˆê³ , ë©”íƒ€ë°ì´í„°ì— `x-amz-meta-encrypted-key`(hex/base64)ë¡œ ì•”í˜¸ë¬¸ì„ ë³´ê´€í•´ ë‘” ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤.

```python
import boto3
import base64
import botocore

s3 = boto3.client('s3')
kms = boto3.client('kms', region_name='ap-northeast-2')

SRC_BUCKET = 'my-encrypted-bucket'
OBJ_KEY = 'path/to/object.enc'
NEW_KEY_ARN = 'arn:aws:kms:ap-northeast-2:123456789012:key/NEW-KEY-ID'

def reencrypt_object_data_key(bucket, key):
    # 1) Get object metadata (assume encrypted data key stored in metadata 'x-amz-meta-edk' base64)
    head = s3.head_object(Bucket=bucket, Key=key)
    meta = head.get('Metadata', {})
    edk_b64 = meta.get('edk')  # e.g., base64-encoded ciphertext blob
    if not edk_b64:
        raise Exception("No encrypted data key found in metadata")

    old_blob = base64.b64decode(edk_b64)

    # 2) ReEncrypt using KMS
    # If encryption context was used originally, provide it via SourceEncryptionContext
    resp = kms.re_encrypt(
        CiphertextBlob=old_blob,
        DestinationKeyId=NEW_KEY_ARN,
        SourceEncryptionContext={'purpose': 's3-object'},
        DestinationEncryptionContext={'purpose': 's3-object', 'rotated': '2025-08-10'}
    )

    new_blob = resp['CiphertextBlob']  # bytes

    # 3) Update object metadata atomically by copying over itself (S3 metadata replacement)
    # Note: CopyObject requires full replacement of metadata if MetadataDirective='REPLACE'
    new_metadata = meta.copy()
    new_metadata['edk'] = base64.b64encode(new_blob).decode('utf-8')

    # CopyObject: same key -> replace metadata (this will create a new object version if versioning enabled)
    s3.copy_object(
        Bucket=bucket,
        CopySource={'Bucket': bucket, 'Key': key},
        Key=key,
        Metadata=new_metadata,
        MetadataDirective='REPLACE'
    )
    print(f"Re-encrypted EDK for {key} and updated metadata")

if __name__ == '__main__':
    reencrypt_object_data_key(SRC_BUCKET, OBJ_KEY)
```

**ì£¼ì˜ì‚¬í•­**
- `re_encrypt` í˜¸ì¶œì€ **í‰ë¬¸ì„ ë°˜í™˜í•˜ì§€ ì•ŠìŒ** â€” ì•ˆì „.
- ë§Œì•½ ì›ë³¸ ì•”í˜¸ë¬¸ì´ encryption contextì— ì˜ì¡´í•˜ë©´ `SourceEncryptionContext`ë¥¼ ë°˜ë“œì‹œ ì „ë‹¬.
- S3 `copy_object`ëŠ” ê°ì²´ í¬ê¸°ì— ë”°ë¼ ë¹„ìš©/ìš”ê¸ˆ ë°œìƒ. ëŒ€ëŸ‰ì´ë¼ë©´ S3 Batch ì‚¬ìš© ê¶Œì¥.

---

## 5) ë°©ë²• B â€” S3 SSE-KMS ê°ì²´ì˜ í‚¤ ë³€ê²½ (Copy / Batch)

S3ì—ì„œ `ServerSideEncryption=aws:kms`ë¡œ ë³´í˜¸ëœ ê°ì²´ëŠ” **S3 Copy**(copy-object)ë¥¼ ì‚¬ìš©í•´ ëŒ€ìƒ `--sse aws:kms --sse-kms-key-id <newKey>`ë¥¼ ì§€ì •í•˜ë©´ S3ê°€ ê°ì²´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì¬ì•”í˜¸í™”í•©ë‹ˆë‹¤.

### ë‹¨ì¼ ê°ì²´ â€” AWS CLI

```bash
aws s3api copy-object \
  --bucket my-bucket \
  --copy-source my-bucket/path/to/object.txt \
  --key path/to/object.txt \
  --server-side-encryption aws:kms \
  --ssekms-key-id arn:aws:kms:ap-northeast-2:123456789012:key/NEW-KEY-ID
```

### ëŒ€ëŸ‰ ê°ì²´ â€” S3 Batch Operations ê¶Œì¥
- ëŒ€ê·œëª¨(ìˆ˜ì‹­ë§Œ~ìˆ˜ë°±ë§Œ) ê°ì²´ë¼ë©´ **S3 Inventory + S3 Batch Operations**ë¥¼ ì´ìš©í•˜ì—¬ í‚¤ êµì²´ ì‘ì—…(ë³µì‚¬)ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- S3 Batchì˜ ì‘ì—… ìœ í˜• `PUT` ë˜ëŠ” `COPY`ë¡œ `sseAwsKmsKeyId`ë¥¼ ì§€ì •í•˜ë©´ S3ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì¬ì•”í˜¸í™” ìˆ˜í–‰.
- ì¥ì : ìŠ¤ì¼€ì¤„ë§, ì‘ì—… ìƒíƒœ ì¶”ì , ì‹¤íŒ¨ í•­ëª© ë¦¬í¬íŠ¸ ì œê³µ.

---

## 6) ë°©ë²• C â€” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ(í‰ë¬¸ ë³µí˜¸í™” â†’ ì¬ì•”í˜¸í™”)
- ë¶ˆê°€í”¼í•˜ê²Œ ëŒ€ìƒ ì•”í˜¸ë¬¸ì´ KMS ê´€ë ¨ì´ ì•„ë‹ˆê±°ë‚˜ ReEncryptë¥¼ ì“¸ ìˆ˜ ì—†ëŠ” í˜•ì‹ì´ë©´ ë‹¤ìŒ ì ˆì°¨:
  1. ì•ˆì „í•œ í™˜ê²½(ê· í˜•: VPC, ì„ì‹œ ì¸ìŠ¤í„´ìŠ¤, ë©”ëª¨ë¦¬ ë³´í˜¸)ì—ì„œ ëŒ€ìƒ ë°ì´í„° ë³µí˜¸í™”(í‰ë¬¸ íšë“).
  2. ìƒˆ CMKë¡œ ìƒˆ ë°ì´í„°í‚¤ ìƒì„±/ì•”í˜¸í™” ë˜ëŠ” ë°”ë¡œ KMS `Encrypt` í˜¸ì¶œ.
  3. ìƒˆ ì•”í˜¸ë¬¸/ìƒˆ ë°ì´í„°í‚¤ë¡œ ì €ì¥.
  4. í‰ë¬¸ì€ ì¦‰ì‹œ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°í•˜ê³  ë¡œê·¸ì— ë‚¨ê¸°ì§€ ë§ ê²ƒ.
- ì´ ë°©ë²•ì€ **ë°ì´í„°ê°€ ì ì‹œë¼ë„ í‰ë¬¸ ìƒíƒœê°€ ë¨** â†’ ê·œì œ/ì»´í”Œë¼ì´ì–¸ìŠ¤ì— ë¯¼ê°í•œ ê²½ìš° í”¼í•´ì•¼ í•¨.

---

## 7) ëŒ€ê·œëª¨ ë§ˆì´ê·¸ë ˆì´ì…˜ ìš´ì˜ íŒ

### ë°°ì¹˜ ì „ëµ
- **Inventory â†’ ì‘ì€ ì²­í¬ â†’ ë³‘ë ¬ ì²˜ë¦¬(ì œí•œ)**:
  - S3 Inventory(ë˜ëŠ” DB ì¿¼ë¦¬)ë¡œ ëŒ€ìƒ ë¦¬ìŠ¤íŠ¸ ìƒì„±.
  - ë³‘ë ¬ ì‘ì—… ìˆ˜(ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤)ë¥¼ ì œí•œí•˜ì—¬ KMS throttling ë°©ì§€(ì˜ˆ: ë™ì‹œì— 50~200ê°œ).
  - ê° ì‘ì—… ë‹¨ìœ„ì— ëŒ€í•´ ì§€ìˆ˜ì  ë°±ì˜¤í”„ ë° ì¬ì‹œë„ ë¡œì§ êµ¬í˜„.

### ëª¨ë‹ˆí„°ë§ & ë¡œê¹…
- CloudWatch ë©”íŠ¸ë¦­: KMS `Throttles`, `Encrypt`, `ReEncrypt` í˜¸ì¶œ ì§€í‘œ ëª¨ë‹ˆí„°ë§.
- CloudTrail: ReEncrypt ì´ë²¤íŠ¸ ê°ì‚¬(ëˆ„ê°€ ì–¸ì œ ìˆ˜í–‰í–ˆëŠ”ì§€).
- ì‘ì—… ë¡œê·¸ëŠ” ì‹¤íŒ¨ í•­ëª©ì˜ ì›ë³¸(í‚¤, ì—ëŸ¬ ì½”ë“œ, ì¬ì‹œë„ íšŸìˆ˜)ì„ ë‚¨ê²¨ ë³µêµ¬ì— í™œìš©.

### íŠ¸ëœì­ì…˜/ì›ìì„±
- S3 ë©”íƒ€ë°ì´í„° êµì²´ëŠ” **CopyObject**ë¡œ atomicí•˜ê²Œ ëŒ€ì²´í•˜ë˜, ì‹¤íŒ¨ ê°€ëŠ¥ì„± ê³ ë ¤:
  - ì „ëµ: ìƒˆ ë©”íƒ€ë°ì´í„°ë¡œ ë³µì‚¬ â†’ ì„±ê³µ ì‹œ ì›ë˜ ë°±ì—…(ë²„ì „) ìœ ì§€ ë˜ëŠ” ì‚­ì œ(ê²€í†  í›„).
- DBì˜ ê²½ìš° ìƒˆ ì»¬ëŸ¼(ë˜ëŠ” ë²„ì „ ì»¬ëŸ¼)ì„ ë¨¼ì € ì±„ìš°ê³  í™•ì¸ í›„ ê¸°ì¡´ ì»¬ëŸ¼ì„ êµì²´í•˜ëŠ” ì•ˆì „ íŒ¨í„´ ê¶Œì¥.

### í…ŒìŠ¤íŠ¸ â†’ ë‹¨ê³„ì  ë¡¤ì•„ì›ƒ
1. ìƒ˜í”Œ(1% ë°ì´í„°)ìœ¼ë¡œ ì „í™˜ í…ŒìŠ¤íŠ¸.  
2. ë¹„í•µì‹¬ ë°ì´í„°ë¡œ 1ì°¨ ë°°ì¹˜.  
3. ëª¨ë‹ˆí„°ë§ ì´ìƒ ì—†ìœ¼ë©´ ì „ì²´ í™•ì¥.

### ë¡¤ë°± ê³„íš
- ReEncrypt ì‘ì—…ì—ì„œ ì›ë³¸ ì•”í˜¸ë¬¸ì„ ë³„ë„ ì•ˆì „ ìŠ¤í† ì–´(ì˜ˆ: ë‹¤ë¥¸ S3 ë²„ì „, ë°ì´í„°ë² ì´ìŠ¤ì— ì•”í˜¸í™”ëœ í˜•íƒœ)ë¡œ ì„ì‹œ ë³´ê´€í•˜ë©´ ë¡¤ë°± ê°€ëŠ¥.
- S3 ë²„ì „ í™œì„±í™” ì‹œ ë³µì› ì‰¬ì›€(ì›ë˜ ë²„ì „ìœ¼ë¡œ ë³µì‚¬/ë˜ëŒë¦¼).

---

## 8) ë³´ì•ˆÂ·ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í•„ìˆ˜)
- [ ] **ìƒ˜í”Œ í…ŒìŠ¤íŠ¸** ì™„ë£Œ  
- [ ] **KMS í‚¤ ì •ì±…**ì— `ReEncryptFrom`/`ReEncryptTo` ê¶Œí•œ ê²€í†   
- [ ] **IAM ì—­í• **(ë§ˆì´ê·¸ë ˆì´í„°)ì— ìµœì†Œ ê¶Œí•œ ë¶€ì—¬ (`kms:ReEncrypt*`, `s3:GetObject`, `s3:PutObject` ë“±)  
- [ ] **CloudTrail** KMS ì´ë²¤íŠ¸ ë¡œê¹… í™œì„±í™”  
- [ ] **S3 ë²„ì „ing** ì¼œê¸°(ê°ì²´ ë®ì–´ì“°ê¸° ì‹œ ë³µêµ¬ ê°€ëŠ¥)  
- [ ] **Encryption Context** ê°€ ì‚¬ìš©ëë‹¤ë©´ ì •í™•íˆ ë³´ì¡´Â·ì „ë‹¬  
- [ ] **ì—ëŸ¬/ì¬ì‹œë„ ì •ì±…**, **ì†ë„ ì œí•œ**, **ë°±ì—… ì •ì±…** ì¤€ë¹„

---

## 9) FAQ / ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

**Q. ReEncryptë¡œ ëª¨ë“  ì¼€ì´ìŠ¤ë¥¼ í‰ë¬¸ ì—†ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆë‚˜?**  
A. ëŒ€ë¶€ë¶„ì€ ê°€ëŠ¥(íŠ¹íˆ KMSì—ì„œ ìƒì„±ëœ ì•”í˜¸ë¬¸/EDK). í•˜ì§€ë§Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìì²´ì ìœ¼ë¡œ ì•”í˜¸í™”í•œ ë°ì´í„°(ì˜ˆ: ê³ ê°ì´ ë¡œì»¬ì—ì„œ AESë¡œ ì•”í˜¸í™”í•˜ê³  EDK ì—†ì´ ì €ì¥í•œ ê²½ìš°)ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë³µí˜¸í™”â†’ì¬ì•”í˜¸í™”í•´ì•¼ í•¨.

**Q. ReEncrypt ì‹œ encryption contextëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜?**  
A. ì›ë˜ ì•”í˜¸ë¬¸ì´ íŠ¹ì • encryption contextë¡œ ë³´í˜¸ë˜ì—ˆë‹¤ë©´ `SourceEncryptionContext`ë¥¼ ì œê³µí•´ì•¼ í•˜ê³ , ìƒˆ encryption contextë¡œ ë°”ê¾¸ë ¤ë©´ `DestinationEncryptionContext`ë¥¼ ì§€ì •í•˜ì„¸ìš”.

**Q. ReEncrypt API í˜¸ì¶œ ë¹„ìš©/ì œí•œì€?**  
A. KMS API í˜¸ì¶œ ë¹„ìš©ê³¼ KMS ìŠ¤ë¡œí‹€ ì œí•œì´ ì ìš©ë©ë‹ˆë‹¤. ëŒ€ëŸ‰ ì‘ì—… ì‹œ ìŠ¤ë¡œí‹€ ë°©ì§€ì™€ ë¹„ìš© ê´€ë¦¬ í•„ìš”.

---

## ë¶€ë¡ â€” ìƒ˜í”Œ IAM í‚¤ ì •ì±…(ê°„ë‹¨ ì˜ˆ)

**ì†ŒìŠ¤ CMK(key-policy)** ì—ì„œ `DataMigratorRole`ì´ ReEncryptFrom í—ˆìš©:

```json
{
  "Sid": "AllowReEncryptFrom",
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::123456789012:role/DataMigratorRole"
  },
  "Action": [
    "kms:ReEncryptFrom",
    "kms:DescribeKey"
  ],
  "Resource": "*"
}
```

**ëŒ€ìƒ CMK(key-policy)** ì—ì„œ `DataMigratorRole`ì´ ReEncryptTo í—ˆìš©:

```json
{
  "Sid": "AllowReEncryptTo",
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::123456789012:role/DataMigratorRole"
  },
  "Action": [
    "kms:ReEncryptTo",
    "kms:DescribeKey"
  ],
  "Resource": "*"
}
```

> ìš´ì˜ í¸ì˜ìƒ ì½˜ì†”ì—ì„œëŠ” `kms:ReEncrypt*`ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë³´ì•ˆìƒ `ReEncryptFrom`/`ReEncryptTo`ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ë” ì„¸ë°€í•¨.

---

## ë§ºìŒë§ â€” ê¶Œì¥ ìˆœì„œ (ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸)
1. í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì „ì²´ í”Œë¡œìš°(ë‹¨ì¼ íŒŒì¼ â†’ ReEncrypt â†’ ë©”íƒ€ë°ì´í„° êµì²´) ê²€ì¦.  
2. í‚¤ ì •ì±…/ì—­í• /ê¶Œí•œ ìµœì†Œí™” êµ¬ì„±.  
3. S3 ë²„ì „Â·ë°±ì—… í™œì„±í™”.  
4. ì‘ì€ ì²­í¬ë¡œ ì ì§„ ë°°í¬(ìŠ¤ë£¨í’‹ ì œí•œÂ·ëª¨ë‹ˆí„°ë§ ì ìš©).  
5. ëª¨ë“  ReEncrypt í˜¸ì¶œ/ê²°ê³¼ë¥¼ CloudWatch/CloudTrailë¡œ ëª¨ë‹ˆí„°ë§.  
6. ì„±ê³µ í™•ì¸ í›„ ì›ë³¸ ì•ˆì „ ì‚­ì œ ì •ì±… ì ìš©(ë³´ì¡´ ê¸°ê°„ ê³ ë ¤).
