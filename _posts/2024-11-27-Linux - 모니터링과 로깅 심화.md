---
layout: post
title: Linux - SELinux & AppArmor ë³´ì•ˆ ëª¨ë“ˆ
date: 2024-11-27 19:20:23 +0900
category: Linux
---
# ë¦¬ëˆ…ìŠ¤ 25í¸: SELinux & AppArmor ë³´ì•ˆ ëª¨ë“ˆ
> ì‹œìŠ¤í…œì„ ë” ê°•ë ¥í•˜ê²Œ ë³´í˜¸í•˜ëŠ” MAC(Mandatory Access Control) ê¸°ë²•

---

## ğŸ” 1. SELinuxë€?

**SELinux(Security-Enhanced Linux)**ëŠ” ë¯¸êµ­ NSAì—ì„œ ê°œë°œí•œ **ê°•ì œ ì ‘ê·¼ ì œì–´(MAC)** ì‹œìŠ¤í…œì…ë‹ˆë‹¤.  
ì‚¬ìš©ìì™€ í”„ë¡œì„¸ìŠ¤ì— **ì„¸ë°€í•œ ì •ì±… ê¸°ë°˜ ê¶Œí•œ**ì„ ë¶€ì—¬í•˜ì—¬ ë£¨íŠ¸ ì‚¬ìš©ìì¡°ì°¨ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ” SELinux ìƒíƒœ ëª¨ë“œ

| ëª¨ë“œ | ì„¤ëª… |
|------|------|
| `enforcing` | ì •ì±…ì„ **ê°•ì œ ì ìš©**í•¨ (ì°¨ë‹¨) |
| `permissive` | ì •ì±… ìœ„ë°˜ì„ **ë¡œê·¸ë¡œ ê¸°ë¡**í•˜ì§€ë§Œ ì°¨ë‹¨ X |
| `disabled` | ë¹„í™œì„±í™” |

```bash
getenforce        # í˜„ì¬ ëª¨ë“œ ì¶œë ¥
setenforce 0      # permissiveë¡œ ì „í™˜
setenforce 1      # enforcingìœ¼ë¡œ ì „í™˜
```

> `/etc/selinux/config` íŒŒì¼ì—ì„œ ë¶€íŒ… ì‹œ ì ìš© ëª¨ë“œ ì„¤ì • ê°€ëŠ¥

---

## ğŸ§  SELinux í•µì‹¬ ê°œë…

### âœ… ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ (Security Context)

```bash
ls -Z /var/www/html/index.html
```

ì¶œë ¥ ì˜ˆì‹œ:
```
-rw-r--r--. root root **unconfined_u:object_r:httpd_sys_content_t:s0**
```

- `user:role:type:level` êµ¬ì¡°
- í•µì‹¬ì€ `type` (ì˜ˆ: `httpd_sys_content_t`)

### âœ… ì •ì±… íƒ€ì…

| ì •ì±… | ì„¤ëª… |
|------|------|
| Targeted | ì¼ë°˜ ì‚¬ìš©ìì— ì´ˆì  (ëŒ€ë¶€ë¶„ ì‚¬ìš©) |
| Strict   | ëª¨ë“  í•­ëª©ì— ì ìš© (ì‹¤í—˜ì ) |
| MLS      | ë³´ì•ˆ ë“±ê¸‰ ê¸°ë°˜ ì •ì±… |

---

## ğŸ› ï¸ SELinux ê´€ë¦¬ ë„êµ¬

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `sestatus` | ì „ì²´ SELinux ìƒíƒœ í™•ì¸ |
| `semanage` | í¬íŠ¸/íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ |
| `restorecon` | ê¸°ë³¸ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ ë³µêµ¬ |
| `chcon` | ì¼ì‹œì  ì»¨í…ìŠ¤íŠ¸ ë³€ê²½ |
| `audit2why` | ì ‘ê·¼ ê±°ë¶€ ì›ì¸ ë¶„ì„ |
| `audit2allow` | ì ‘ê·¼ í—ˆìš© ì •ì±… ìƒì„± ì œì•ˆ |

```bash
# Apacheê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ ì¶”ê°€í•˜ë ¤ë©´
sudo semanage port -a -t http_port_t -p tcp 8081
```

```bash
# íŒŒì¼ì— httpdìš© ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ ì§€ì •
sudo chcon -t httpd_sys_content_t /srv/www/index.html
sudo restorecon -Rv /srv/www/
```

---

## ğŸ§ª SELinux ì‹¤ì „ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: SELinux ì°¨ë‹¨ ë¡œê·¸ ë¶„ì„

```bash
sudo ausearch -m avc -ts recent
```

ë˜ëŠ”

```bash
sudo journalctl -t setroubleshoot
```

ì¶œë ¥ëœ ë¡œê·¸ë¥¼ `audit2why`ë¡œ ë¶„ì„:

```bash
sudo cat /var/log/audit/audit.log | audit2why
```

---

### ì˜ˆì‹œ 2: ì‚¬ìš©ì í¬íŠ¸ í—ˆìš© ë° ì ìš©

```bash
sudo semanage port -a -t ssh_port_t -p tcp 2222
sudo semanage port -l | grep ssh
```

---

## ğŸ§° AppArmorë€?

**AppArmor(Application Armor)**ëŠ” **í”„ë¡œì„¸ìŠ¤ë³„ í—ˆìš©ëœ íŒŒì¼/ê¸°ëŠ¥ì„ ì •ì˜í•œ í”„ë¡œíŒŒì¼**ì„ ì‚¬ìš©í•˜ëŠ” **MAC ë°©ì‹ ë³´ì•ˆ ëª¨ë“ˆ**ì…ë‹ˆë‹¤.

- Ubuntu ê³„ì—´ì—ì„œ ê¸°ë³¸ í™œì„±í™”ë¨
- SELinuxë³´ë‹¤ ì„¤ì •ì´ ê°„ë‹¨í•˜ì§€ë§Œ ìœ ì—°ì„±ì€ ë–¨ì–´ì§

---

## ğŸ“‚ AppArmor í”„ë¡œí•„ êµ¬ì¡°

- í”„ë¡œí•„ ìœ„ì¹˜: `/etc/apparmor.d/`
- ê° ì‹¤í–‰ íŒŒì¼ë§ˆë‹¤ í•˜ë‚˜ì˜ í”„ë¡œí•„ ì‘ì„±

```bash
/etc/apparmor.d/usr.sbin.mysqld
/etc/apparmor.d/usr.bin.curl
```

### í”„ë¡œí•„ ì˜ˆì‹œ
```bash
/usr/bin/curl {
  # ì½ê¸° ê°€ëŠ¥
  /etc/resolv.conf r,
  /usr/share/ca-certificates/** r,

  # ì‹¤í–‰ ê°€ëŠ¥
  /bin/ping Pix,

  # ë„¤íŠ¸ì›Œí¬ í—ˆìš©
  network inet stream,

  # ë¡œê·¸ ê¸°ë¡
  deny /etc/shadow r,
}
```

---

## ğŸ› ï¸ AppArmor ê´€ë¦¬ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `aa-status` | ì „ì²´ AppArmor ìƒíƒœ í™•ì¸ |
| `aa-enable`, `aa-disable` | í”„ë¡œí•„ í™œì„±í™”/ë¹„í™œì„±í™” |
| `aa-complain`, `aa-enforce` | í—ˆìš© ëª¨ë“œ/ê°•ì œ ëª¨ë“œ ì „í™˜ |
| `aa-logprof` | ë¡œê·¸ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œí•„ ë³´ì • |
| `apparmor_parser` | ìˆ˜ë™ìœ¼ë¡œ í”„ë¡œí•„ ë¡œë“œ |

```bash
sudo aa-status
sudo aa-enforce /etc/apparmor.d/usr.sbin.nginx
```

---

## ğŸ” SELinux vs AppArmor ë¹„êµ

| í•­ëª© | SELinux | AppArmor |
|------|---------|----------|
| ì •ì±… êµ¬ì¡° | íƒœê·¸ ê¸°ë°˜(Type Enforcement) | í”„ë¡œí•„ ê¸°ë°˜ (ê²½ë¡œ ê¸°ë°˜) |
| ë³µì¡ë„ | ë†’ìŒ | ë‚®ìŒ |
| ì ìš© ë²”ìœ„ | ì‹œìŠ¤í…œ ì „ì²´, í”„ë¡œì„¸ìŠ¤, í¬íŠ¸ ë“± | í”„ë¡œì„¸ìŠ¤ ì¤‘ì‹¬ |
| ì‚¬ìš©ì í¸ì˜ì„± | ë‚®ìŒ (ì •ì±… ì´í•´ í•„ìš”) | ë†’ìŒ |
| ë°°í¬íŒ | RHEL, CentOS, Fedora | Ubuntu, Debian ë“± |

---

## âœ¨ ë§ˆë¬´ë¦¬

SELinuxì™€ AppArmorëŠ” ëª¨ë‘ **ë£¨íŠ¸ ê¶Œí•œì„ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ë„ ì œì–´ ê°€ëŠ¥í•œ ê°•ë ¥í•œ ë³´ì•ˆ ëª¨ë“ˆ**ì…ë‹ˆë‹¤.  
- SELinuxëŠ” **ì •êµí•œ ì •ì±…ê³¼ ë†’ì€ ë³´ì•ˆì„±**,  
- AppArmorëŠ” **ê°„ë‹¨í•œ ì„¤ì •ê³¼ ê²½ëŸ‰í™”**ê°€ ê°•ì ì…ë‹ˆë‹¤.

ì‹¤ë¬´ì—ì„œëŠ” ì‹œìŠ¤í…œì˜ ë°°í¬íŒê³¼ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì„ íƒí•´ ì‚¬ìš©í•˜ë©°,  
**ë¡œê·¸ ë¶„ì„ â†’ ì •ì±… ë³´ì™„ â†’ ì¬ì ìš©**ì˜ ìˆœí™˜ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.