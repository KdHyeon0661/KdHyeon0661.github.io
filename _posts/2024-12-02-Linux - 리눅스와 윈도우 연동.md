---
layout: post
title: Linux - ë¦¬ëˆ…ìŠ¤ì™€ ìœˆë„ìš° ì—°ë™
date: 2024-12-02 19:20:23 +0900
category: Linux
---
# ë¦¬ëˆ…ìŠ¤ì™€ ìœˆë„ìš° ì—°ë™

## ğŸ§© Samba â€” ë¦¬ëˆ…ìŠ¤ì—ì„œ Windowsë¡œ SMB/CIFS íŒŒì¼ ê³µìœ 

### ì„¤ì¹˜

```bash
# Debian/Ubuntu

sudo apt update
sudo apt install samba samba-common-bin

# RHEL/CentOS/Fedora

sudo dnf install samba samba-common samba-client
```

### ê¸°ë³¸ í† í´ë¡œì§€ì™€ í¬íŠ¸

- **í”„ë¡œí† ì½œ**: SMB 2.x/3.x(ê¶Œì¥), SMB1ì€ ë³´ì•ˆìƒ ì‚¬ìš© ê¸ˆì§€
- **ë°ëª¬**: `smbd`(íŒŒì¼/ì¸ì¦), `nmbd`(NetBIOS ë¸Œë¡œë“œìºìŠ¤íŠ¸, ëŒ€ë¶€ë¶„ í˜„ëŒ€ í™˜ê²½ì€ mDNS/ADë¡œ ëŒ€ì²´), `winbind`(AD/Kerberos í†µí•© ì‹œ)
- **í¬íŠ¸**: TCP 445(í•„ìˆ˜), UDP 137/138, TCP 139(ë ˆê±°ì‹œ). ë°©í™”ë²½ í—ˆìš© í•„ìš”

```bash
# UFW ì˜ˆì‹œ

sudo ufw allow 445/tcp
sudo ufw allow 139/tcp
sudo ufw allow 137,138/udp
```

### smb.conf êµ¬ì¡° ì¸ì§€

- ì „ì—­(Global) ì„¹ì…˜: ì¸ì¦/ë¡œê·¸/ê¸°ë³¸ ì •ì±…
- ê³µìœ  ì„¹ì…˜: ì‹¤ì œ export ë³¼ë¥¨ë³„ ì„¤ì •

```ini
# /etc/samba/smb.conf (ê¸°ë³¸ ê³¨ê²©)

[global]
   workgroup = WORKGROUP
   server string = %h Samba Server
   disable netbios = yes
   smb ports = 445
   map to guest = Bad User
   security = user
   # í˜„ëŒ€ Windows í˜¸í™˜
   server min protocol = SMB2_10
   server max protocol = SMB3
   # ACL in xattrë¡œ Windowsí˜• ìƒì†/ê¶Œí•œ ë°˜ì˜
   vfs objects = acl_xattr
   map acl inherit = yes
   store dos attributes = yes

[share]
   path = /srv/samba/share
   browsable = yes
   read only = no
   guest ok = yes
   force create mode = 0644
   force directory mode = 0755
   # Linux ACL ë°˜ì˜ì„ ì›í•˜ë©´ ì•„ë˜ ì˜µì…˜ ë³‘í–‰(íŒŒì¼ì‹œìŠ¤í…œì—ë„ ACL/mnt ì˜µì…˜)
   inherit acls = yes
```

> íŒ: `socket options`ëŠ” ìµœì‹  Sambaì—ì„œ ê±°ì˜ ë¬´ì˜ë¯¸/ë¹„ê¶Œì¥. ëŒ€ì‹  **SMB Multichannel**(ì„œë²„/í´ë¼ NIC ë‹¤ì¤‘í™”)ê³¼ **aio**(ë¹„ë™ê¸° I/O), **sendfile** ë“± í˜„ëŒ€ ì˜µì…˜ ì‚¬ìš©.

### ë””ë ‰í† ë¦¬/ê¶Œí•œ ì¤€ë¹„

```bash
sudo mkdir -p /srv/samba/share
sudo chown -R nobody:nogroup /srv/samba/share    # ê²ŒìŠ¤íŠ¸ ì—´ëŒ ì‹œ
# ë˜ëŠ” íŠ¹ì • ì‚¬ìš©ì/ê·¸ë£¹ì„ ownerë¡œ ë§ì¶”ëŠ” ê²ƒì´ ìš´ì˜ì— ìœ ë¦¬

sudo chown -R filesvc:filesvc /srv/samba/share
sudo chmod -R 0755 /srv/samba/share
```

### ì‚¬ìš©ì ì¶”ê°€(ê²ŒìŠ¤íŠ¸ ê¸ˆì§€ í™˜ê²½)

```bash
# Linux ê³„ì • ìƒì„±

sudo useradd -m filesvc
sudo passwd filesvc

# Samba ê³„ì • ìƒì„±(ë³„ë„ DB)

sudo smbpasswd -a filesvc
sudo pdbedit -L

# ê³µìœ  ì„¹ì…˜ ê¶Œí•œ ì œí•œ
# [share]ì— guest ok = no, valid users = filesvc

```

### ì„œë¹„ìŠ¤ ì‹¤í–‰/ê²€ì¦

```bash
sudo testparm               # smb.conf ë¬¸ë²• ê²€ì¦
sudo systemctl enable --now smbd
sudo systemctl status smbd

# ë¡œì»¬ì—ì„œ ì„œë²„ ëª©ë¡ í™•ì¸

smbclient -L localhost -U filesvc
# ê³µìœ ì— ì ‘ì†(í´ë¼ì´ì–¸íŠ¸ ê´€ì )

smbclient //127.0.0.1/share -U filesvc
```

### ìœˆë„ìš°ì—ì„œ ì ‘ê·¼

- íƒìƒ‰ê¸°: `\\ë¦¬ëˆ…ìŠ¤-ì„œë²„-IP\share`
- ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë¸Œ ì—°ê²°: `net use Z: \\server\share /user:filesvc`

---

## ğŸ” ê¶Œí•œÂ·ACLÂ·ì†Œìœ ê¶Œ ë§¤í•‘ (Windows â†” POSIX)

SMBëŠ” Windowsì˜ ACL/ì†Œìœ ê¶Œ ëª¨ë¸ì„ POSIXë¡œ ë§¤í•‘í•´ì•¼ í•œë‹¤. ìš´ì˜ í¬ì¸íŠ¸:

1. **íŒŒì¼ì‹œìŠ¤í…œ ë ˆë²¨**
   - ext4/xfsì—ì„œ POSIX ACL í™œì„±í™”: ë§ˆìš´íŠ¸ì— `acl` ì˜µì…˜(ëŒ€ë¶€ë¶„ ê¸°ë³¸)
   - `setfacl/getfacl`ë¡œ ì„¸ë°€ ê¶Œí•œ ì œì–´
2. **Samba ë ˆë²¨**
   - `vfs objects = acl_xattr` + `store dos attributes = yes` â†’ Windowsì˜ ì½ê¸°ì „ìš©/ìˆ¨ê¹€/ìƒì†ì„ xattrì— ì €ì¥
   - `inherit acls = yes`, `map acl inherit = yes` â†’ ìƒìœ„ í´ë”ì˜ ê¶Œí•œ ìƒì†
3. **ë§ˆìŠ¤í‚¹**
   - `create mask`, `directory mask`, `force create mode`, `force directory mode`ë¡œ ê¸°ë³¸ê¶Œí•œ ê°•ì œ

ì˜ˆì‹œ(íŒ€ ê³µìœ , ì“°ê¸° ê°€ëŠ¥, Windows ìŠ¤íƒ€ì¼ ìƒì†):
```ini
[team]
   path = /srv/samba/team
   read only = no
   browsable = yes
   vfs objects = acl_xattr recycle
   map acl inherit = yes
   inherit acls = yes
   recycle:repository = /.recycle/%U
   recycle:versions = yes
   recycle:keeptree = yes
```

> â€œê¶Œí•œ ì•ˆ ë§ëŠ”ë‹¤â€ ì´ìŠˆ ëŒ€ë¶€ë¶„ì€ **íŒŒì¼ì‹œìŠ¤í…œ ACL/ìœ ì €/ê·¸ë£¹/umask**ì™€ **Sambaì˜ ACL/xattr** ì„¤ì •ì´ ì„œë¡œ ì—‡ê°ˆë ¤ì„œ ë°œìƒ.
> ë””ë ‰í† ë¦¬ ìƒìœ„ë¶€í„° **ì†Œìœ ì/ê·¸ë£¹/ACL**ì„ ì •ë¦¬í•˜ê³  `testparm`, `smbstatus`ë¡œ ì ê²€.

---

## ğŸ¢ AD/Kerberos í†µí•©(SSO)

ë„ë©”ì¸ í™˜ê²½ì—ì„œ **ë„ë©”ì¸ ì‚¬ìš©ì**ê°€ Samba ê³µìœ ì— SSOë¡œ ë“¤ì–´ì˜¤ê²Œ í•˜ë ¤ë©´:

1. **íŒ¨í‚¤ì§€**
```bash
sudo apt install krb5-user winbind libnss-winbind libpam-winbind samba
```

2. **krb5.conf** (ë„ë©”ì¸/Realmì— ë§ê²Œ)
```ini
[libdefaults]
  default_realm = EXAMPLE.COM
  dns_lookup_realm = true
  dns_lookup_kdc = true
```

3. **smb.conf ìš”ì§€**
```ini
[global]
  workgroup = EXAMPLE
  security = ADS
  realm = EXAMPLE.COM
  winbind use default domain = yes
  idmap config * : backend = tdb
  idmap config * : range = 10000-19999
  idmap config EXAMPLE : backend = rid
  idmap config EXAMPLE : range = 20000-999999
  template shell = /bin/bash
  vfs objects = acl_xattr
  map acl inherit = yes
  store dos attributes = yes
```

4. **ë„ë©”ì¸ ì¡°ì¸**
```bash
sudo kinit Administrator
sudo net ads join -U Administrator
sudo systemctl restart smbd nmbd winbind
wbinfo -u   # ë„ë©”ì¸ ì‚¬ìš©ì ë³´ì„?
getent passwd "EXAMPLE\\alice"
```

> í•µì‹¬: `security = ADS` + winbind ID ë§¤í•‘ + DNS/Kerberos ì •ìƒ. ë°©í™”ë²½ì—ì„œ 88(Kerberos), 389/636(LDAP), 445/135/139/1024-65535 RPC ë‹¤ë¦¬ ì—´ì–´ì•¼ í•¨(ì¡°ì¸ ì ˆì°¨ ì¤‘ í•„ìš”).

---

## ğŸ”— ë¦¬ëˆ…ìŠ¤ì—ì„œ Windows ê³µìœ  ë§ˆìš´íŠ¸(CIFS)

### ìˆ˜ë™ ë§ˆìš´íŠ¸

```bash
sudo mkdir -p /mnt/wshare
sudo mount -t cifs //192.168.0.10/projects /mnt/wshare \
  -o username=winuser,password='winpass',uid=$(id -u),gid=$(id -g),vers=3.0,iocharset=utf8,sec=ntlmssp
```

**ì£¼ìš” ì˜µì…˜**
| ì˜µì…˜ | ì˜ë¯¸ |
|---|---|
| `vers=3.0` | SMB3 ê°•ì œ(ë³´ì•ˆ/ì„±ëŠ¥ í˜¸í™˜). í•„ìš” ì‹œ 3.1.1/2.1 ë“± ì¡°ì • |
| `sec=ntlmssp` | í˜„ëŒ€ ì¸ì¦(ê¸°ë³¸). AD í™˜ê²½ì€ `sec=krb5`(í‹°ì¼“ ê¸°ë°˜)ë„ ê°€ëŠ¥ |
| `uid/gid` | ë§ˆìš´íŠ¸ëœ íŒŒì¼ ì†Œìœ ì ë³´ì •(ë¦¬ëˆ…ìŠ¤ ì‘ì—… ê³„ì •ì— ë§ì¶¤) |
| `file_mode/dir_mode` | ì„œë²„ê°€ ê¶Œí•œ ì œê³µ ëª»í•  ë•Œ ë¡œì»¬ ê°•ì œ |
| `credentials=` | ì¸ì¦ì •ë³´ íŒŒì¼ ì‚¬ìš©(ê¶Œì¥) |

### ì¸ì¦ì •ë³´ íŒŒì¼ë¡œ ë³´ì•ˆ í–¥ìƒ

```ini
# /etc/samba/creds-wshare (0600 ê¶Œì¥)

username=winuser
password=winpass
domain=EXAMPLE
```

```bash
sudo mount -t cifs //192.168.0.10/projects /mnt/wshare \
  -o credentials=/etc/samba/creds-wshare,uid=1000,gid=1000,vers=3.0,iocharset=utf8
```

### fstab ìë™ ë§ˆìš´íŠ¸

```fstab
# /etc/fstab

//192.168.0.10/projects  /mnt/wshare  cifs  credentials=/etc/samba/creds-wshare,uid=1000,gid=1000,vers=3.0,iocharset=utf8,_netdev  0  0
```
- `_netdev`: ë„¤íŠ¸ì›Œí¬ ì¤€ë¹„ í›„ ë§ˆìš´íŠ¸(ë¶€íŒ… ìˆœì„œ ì´ìŠˆ ë°©ì§€)

### systemd ìœ ë‹›ìœ¼ë¡œ ë§ˆìš´íŠ¸(ì˜ì¡´ì„±/íƒ€ì´ë° ì •êµ ì œì–´)

```ini
# /etc/systemd/system/mnt-wshare.mount

[Unit]
Description=Mount Windows Share
After=network-online.target
Wants=network-online.target

[Mount]
What=//192.168.0.10/projects
Where=/mnt/wshare
Type=cifs
Options=credentials=/etc/samba/creds-wshare,uid=1000,gid=1000,vers=3.0,iocharset=utf8

[Install]
WantedBy=multi-user.target
```
```bash
sudo systemctl daemon-reload
sudo systemctl enable --now mnt-wshare.mount
```

---

## â†” Windows ê³µìœ  ìµœì í™”

### WSLì—ì„œ Windows ë“œë¼ì´ë¸Œ ì ‘ê·¼

- ìë™ ë§ˆìš´íŠ¸: `/mnt/c`, `/mnt/d`, â€¦
- ì„±ëŠ¥/ê¶Œí•œ/ëŒ€ì†Œë¬¸ì/ë©”íƒ€ë°ì´í„°ë¥¼ `wsl.conf`ë¡œ ìµœì í™”

```ini
# /etc/wsl.conf

[automount]
enabled = true
options = "metadata,uid=1000,gid=1000,umask=022,fmask=0111,case=off"
mountFsTab = true

[interop]
appendWindowsPath = false
```

**í•µì‹¬ ì˜µì…˜**
- `metadata`: NTFSì˜ê³¼ëŠ” ë³„ê°œë¡œ **POSIX ê¶Œí•œ/ì†Œìœ ê¶Œ ë©”íƒ€ë°ì´í„°ë¥¼ NTFS ADSì— ì €ì¥**í•˜ì—¬ chmod/chown ê°€ëŠ¥
- `case=off/on`: ëŒ€ì†Œë¬¸ì êµ¬ë¶„. **Windows ì•±ê³¼ í•¨ê»˜ ì“°ë©´ offê°€ ì•ˆì „**(onì€ ì¶©ëŒ ê°€ëŠ¥)
- `fmask/umask`: ìƒì„± íŒŒì¼/ë””ë ‰í† ë¦¬ ê¶Œí•œ ë§ˆìŠ¤í¬
- `appendWindowsPath=false`: PATH ì˜¤ì—¼ ë°©ì§€

ì ìš©:
```powershell
wsl --shutdown
wsl
```

### Windowsì—ì„œ WSL ë£¨íŠ¸ ì ‘ê·¼

- íƒìƒ‰ê¸°: `\\wsl.localhost\Ubuntu\home\username`
- ëŒ€ìš©ëŸ‰/ëŒ€ëŸ‰ I/O ì‹œ **WSL->Linux ë£¨íŠ¸** ìª½ì´ ë¹ ë¥´ê³ , **Windows ì•±ì´ ì§ì ‘ ì—´ì–´ ì‘ì—…**í•˜ë©´ ê²½ë¡œê°€ `\\wsl$` ë˜ëŠ” `/mnt/c`ì¼ ë•Œ ì„±ëŠ¥Â·ë½ ê²½í•© ì´ìŠˆ ë°œìƒ ê°€ëŠ¥ â†’ **ë¹Œë“œ/íŒ¨í‚¤ì§•ì€ WSL ë£¨íŠ¸ ì•ˆì—ì„œ**ê°€ ì •ì„

---

## âš™ï¸ ì„±ëŠ¥Â·ì•ˆì •ì„±Â·ë³´ì•ˆ íŠœë‹ í¬ì¸íŠ¸

### Samba ì„œë²„ ì„±ëŠ¥

```ini
[global]
  # SMB Multichannel(ë‹¤ì¤‘ NIC/í ê¸°ë°˜, í´ë¼/ì„œë²„ ëª¨ë‘ ì§€ì› í•„ìš”)
  server multi channel support = yes

  # ëŒ€ìš©ëŸ‰ IOì— ìœ ë¦¬
  aio read size = 1
  aio write size = 1
  # sendfileì€ íŠ¹ì • ì›Œí¬ë¡œë“œì—ì„œ ìœ ë¦¬(ì •ì  íŒŒì¼)
  use sendfile = yes
```
- íŒŒì¼ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸ ì˜µì…˜(ì˜ˆ: `noatime`, RAID ìºì‹œ/ìŠ¤ì¼€ì¤„ëŸ¬), NIC ì˜¤í”„ë¡œë“œ, MTU(ì ì§„ì  ê²€ì¦), CPU ê³ ì •/IRQ ë°¸ëŸ°ì‹±ë„ ìœ ì˜

### ë³´ì•ˆ

- `server min protocol = SMB2_10` ì´ìƒ
- **SMB1 ë¹„í™œì„±í™”**(Windows ê¸°ëŠ¥ì—ì„œë„ êº¼ë‘ê¸° ê¶Œì¥)
- `guest ok = no` (í•„ìš” ì‹œ ì œí•œì ìœ¼ë¡œë§Œ)
- AD í™˜ê²½ì—ì„œëŠ” **Kerberos/NTLMv2**ë§Œ í—ˆìš©(ê¸°ë³¸)
- SELinux(AppArmor) ì‚¬ìš© ì‹œ **ì»¨í…ìŠ¤íŠ¸/í”„ë¡œí•„ ì˜ˆì™¸** í™•ì¸

SELinux ì˜ˆì‹œ(HTTP ê°€ìƒ í˜¸ìŠ¤íŠ¸ì—ì„œ Samba ê³µìœ  ì ‘ê·¼ ì‹œ):
```bash
# samba_export_t ë¼ë²¨, or ì ì ˆí•œ booleans

sudo semanage fcontext -a -t samba_share_t "/srv/samba(/.*)?"
sudo restorecon -Rv /srv/samba
# í•„ìš”í•œ boolean(ì˜ˆ): httpdê°€ ë„¤íŠ¸ì›Œí¬ë¡œ samba ì ‘ì†ì´ ì•„ë‹ˆë¼ ë¡œì»¬ FS ì ‘ê·¼ì´ë©´ ë¼ë²¨/ê¶Œí•œ ì •í•©ì´ ì¤‘ìš”

```

### ê°€ìš©ì„±/íšŒìˆ˜

- `vfs recycle`ë¡œ íœ´ì§€í†µ êµ¬ì„±(ì‹¤ìˆ˜ ì‚­ì œ íšŒí”¼)
- ìŠ¤ëƒ…ìƒ· íŒŒì¼ì‹œìŠ¤í…œ(Btrfs/ZFS/LVM snapshot)ê³¼ ê²°í•©í•˜ì—¬ **ìœˆë„ìš° ì„€ë„ìš°ì¹´í”¼ ìœ ì‚¬ ì›Œí¬í”Œë¡œ** êµ¬í˜„ ê°€ëŠ¥(ë³„ë„ ìŠ¤í¬ë¦½íŒ…)

---

## ğŸ” ëª¨ë‹ˆí„°ë§Â·ìš´ì˜ ëª…ë ¹ ëª¨ìŒ

| ëª©ì  | ì»¤ë§¨ë“œ |
|---|---|
| ì„¤ì • ë¬¸ë²• ê²€ì‚¬ | `testparm` |
| ì ‘ì†/ì„¸ì…˜ ë³´ê¸° | `smbstatus` |
| ì„œë²„ ëª©ë¡ | `smbclient -L server -U user` |
| íŠ¹ì • ê³µìœ  ì ‘ì† | `smbclient //server/share -U user` |
| ë¡œê·¸ | `/var/log/samba/`, `journalctl -u smbd` |
| CIFS ë§ˆìš´íŠ¸ ë””ë²„ê·¸ | `dmesg | grep CIFS` |
| ìœˆë„ìš° í´ë¼ ìƒíƒœ | `net use`, ì´ë²¤íŠ¸ ë·°ì–´(System/SMBClient) |

---

## ğŸ§ª ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1 â€” **ì½ê¸° ì „ìš© ë°°í¬ ê³µìœ **

- ìš”êµ¬: ëˆ„êµ¬ë‚˜ ì½ê¸°, íŠ¹ì • ê·¸ë£¹ë§Œ ì“°ê¸° ê¸ˆì§€ ìœ ì§€

```bash
sudo groupadd readers
sudo chgrp -R readers /srv/samba/repo
sudo chmod -R 0755 /srv/samba/repo
```

```ini
[repo]
  path = /srv/samba/repo
  read only = yes
  browsable = yes
  guest ok = no
  valid users = @readers
```

### ì‹œë‚˜ë¦¬ì˜¤ 2 â€” **íŒ€ í´ë”: ìƒì†í˜• ê¶Œí•œ**

```bash
sudo mkdir -p /srv/samba/team
sudo chgrp -R devteam /srv/samba/team
sudo chmod -R 2770 /srv/samba/team    # setgidë¡œ ê·¸ë£¹ ìƒì†
setfacl -R -m d:g:devteam:rwx /srv/samba/team
```

```ini
[team]
   path = /srv/samba/team
   read only = no
   browsable = yes
   vfs objects = acl_xattr
   map acl inherit = yes
   inherit acls = yes
   valid users = @devteam
   force group = devteam
```

### ì‹œë‚˜ë¦¬ì˜¤ 3 â€” **ë¦¬ëˆ…ìŠ¤ì—ì„œ ìœˆë„ìš° ë°±ì—… ê³µìœ  ìë™ ë§ˆìš´íŠ¸**

```fstab
//backup-svr/archives  /mnt/archives  cifs  credentials=/etc/samba/creds-archives,uid=1000,gid=1000,vers=3.0,iocharset=utf8,nofail,_netdev  0  0
```

---

## ğŸš‘ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…(ì¦ìƒ â†’ ì›ì¸ â†’ í•´ê²°)

| ì¦ìƒ | ê°€ëŠ¥ ì›ì¸ | í•´ê²° ê°€ì´ë“œ |
|---|---|---|
| ì ‘ê·¼ ê±°ë¶€(Windowsì—ì„œ) | ê³„ì • ë¯¸ë“±ë¡/ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼/ìœ íš¨ ì‚¬ìš©ì ë¯¸ì§€ì • | `smbpasswd -a`, `valid users`, `testparm`, ë¡œê·¸ í™•ì¸ |
| ëŠë¦¼/ëŠê¹€ | SMB1 ê°•ì œ/ë„¤íŠ¸ì›Œí¬ MTU/ë©€í‹°ì±„ë„ ë¯¸ì§€ì›/AV | `vers=3.0`, AV ì œì™¸, `server multi channel support = yes`, NIC ë“œë¼ì´ë²„ ì ê²€ |
| ê¶Œí•œ ì´ìƒ | xattr/ACL ë¶ˆì¼ì¹˜/umask | `vfs acl_xattr`, `map acl inherit`, ìƒìœ„ ë””ë ‰í† ë¦¬ ACL ì •ë¦¬ |
| ë§ˆìš´íŠ¸ ì‹¤íŒ¨ | ì¸ì¦/ë²„ì „/ì•”í˜¸í™” ì •ì±… | `sec=ntlmssp`, `vers=3.0/3.1.1`, `dmesg|grep CIFS` |
| AD ì¡°ì¸ ì‹¤íŒ¨ | DNS/Kerberos ì‹œê°„ë¶ˆì¼ì¹˜/ë°©í™”ë²½ | NTP ë™ê¸°í™”, 88/389/445 ë“± ê°œë°©, `kinit`, `/etc/krb5.conf` ì¬ê²€ |

---

## ì„±ëŠ¥ ì§ê´€ ìˆ˜ì‹ â€” ì™•ë³µì‹œê°„ê³¼ ëŒ€ì—­í­

SMB ì „ì†¡ëŸ‰(ëŒ€ëµ)ì€ ë‹¤ìŒ ë‘ ìš”ì†Œì— ì¢Œìš°ëœë‹¤.
- ëŒ€ì—­í­ \(B\) (bytes/s), ì™•ë³µ ì§€ì—° \(RTT\) (s), íŒŒì´í”„ë¼ì¸/ìœˆë„ í¬ê¸° \(W\) (bytes)
- **ëŒ€ëµì  ì²˜ë¦¬ëŸ‰ ìƒí•œ:**
  $$ \text{Throughput} \approx \min\left(B,\ \frac{W}{RTT}\right) $$
- Multichannel/NIC bonding, ëŒ€í˜• I/O, AIOëŠ” ì‚¬ì‹¤ìƒ \(W\)ë¥¼ í‚¤ìš°ê±°ë‚˜ \(RTT\) ì˜í–¥ ê°ì†Œì— ê¸°ì—¬ â†’ ê³ ì† ë§í¬/ì €ì§€ì—° í™˜ê²½ì—ì„œ ìœ ë¦¬.

---

## ğŸ§¾ ìš”ì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] **Samba**: SMB2/3ë§Œ, `vfs acl_xattr`, `map acl inherit`, `store dos attributes`
- [ ] **ê¶Œí•œ**: íŒŒì¼ì‹œìŠ¤í…œ ACLê³¼ Samba ACL ì˜µì…˜ ì •í•©, setgidÂ·ê¸°ë³¸ ACLë¡œ ìƒì†
- [ ] **ë³´ì•ˆ**: SMB1 ë¹„í™œì„±, ê²ŒìŠ¤íŠ¸ ìµœì†Œí™”, Kerberos/NTLMv2, ë°©í™”ë²½ í¬íŠ¸ í—ˆìš©
- [ ] **CIFS ë§ˆìš´íŠ¸**: `vers=3.0`, `credentials=` íŒŒì¼, `_netdev` ë˜ëŠ” systemd mount
- [ ] **WSL**: `/etc/wsl.conf`ì˜ `metadata`, `fmask/umask`, `case` ì£¼ì˜, `wsl --shutdown` í›„ ë°˜ì˜
- [ ] **ì„±ëŠ¥**: Multichannel, AIO, sendfile(ì •ì  íŒŒì¼), íŒŒì¼ì‹œìŠ¤í…œÂ·NIC íŠœë‹
- [ ] **ìš´ì˜**: `testparm`, `smbstatus`, `journalctl -u smbd`, `dmesg|grep CIFS`ë¡œ ë¹ ë¥¸ ì§„ë‹¨

---

## ë¶€ë¡: ìœ ìš©í•œ ì„¤ì • ìŠ¤ë‹ˆí« ëª¨ìŒ

### ê²ŒìŠ¤íŠ¸ ì—†ì´ ì¸ì¦ë§Œ

```ini
[global]
  map to guest = Never
```

### ë§¥OS í˜¸í™˜ì„±(vfs_fruit)

```ini
[macshare]
  path = /srv/macshare
  vfs objects = catia fruit streams_xattr
  fruit:metadata = stream
  fruit:resource = file
  fruit:locking = netatalk
```

### ì½ê¸°ì „ìš© ìŠ¤ëƒ…ìƒ· ê³µê°œ(ì˜ˆ: Btrfs/ZFS ìŠ¤ëƒ…ìƒ·)

```ini
[snapshots]
  path = /srv/samba/.snapshots
  read only = yes
  browseable = yes
```

### systemd automountë¡œ ì§€ì—° ë§ˆìš´íŠ¸(í´ë¼ ì ‘ê·¼ ì‹œ)

```ini
# /etc/systemd/system/mnt-wshare.automount

[Unit]
Description=Automount Windows Share

[Automount]
Where=/mnt/wshare

[Install]
WantedBy=multi-user.target
```
```bash
sudo systemctl enable --now mnt-wshare.automount
```

---

## ë§ˆë¬´ë¦¬

ì´ ê¸€ì˜ í•µì‹¬ì€ â€œ**ê¶Œí•œ/ì„±ëŠ¥/ë³´ì•ˆ/ìš´ì˜**â€ 4ìš”ì†Œë¥¼ **ê° ê³„ì¸µ(íŒŒì¼ì‹œìŠ¤í…œâ€”Sambaâ€”ë„¤íŠ¸ì›Œí¬â€”í´ë¼/WSL)**ì—ì„œ ë§ë¬¼ë¦¬ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.
- Windows â†” Linux íŒŒì¼ê³µìœ ë¥¼ **Samba ì„œë²„**ë¡œ ì•ˆì •ì ìœ¼ë¡œ ì œê³µ
- Linux â†” Windows ê³µìœ ë¥¼ **CIFS í´ë¼ì´ì–¸íŠ¸**ë¡œ ì•ˆì „í•˜ê²Œ ë§ˆìš´íŠ¸(ì¸ì¦Â·ìë™í™”)
- **WSL** í™˜ê²½ì—ì„  `wsl.conf`ë¡œ ê¶Œí•œ/ëŒ€ì†Œë¬¸ì/ë©”íƒ€ë°ì´í„°ë¥¼ ì •êµí•˜ê²Œ
- AD/Kerberos, ACL/xattr, Multichannelê³¼ ê°™ì€ **ìš´ì˜í™˜ê²½ê¸‰ ì˜µì…˜**ìœ¼ë¡œ í’ˆì§ˆì„ í•œ ë‹¨ê³„ ëŒì–´ì˜¬ë¦¬ì.

í˜„ì¥ì—ì„œ ë§‰í˜ì´ ìƒê¸°ë©´: **`testparm` â†’ `smbstatus` â†’ ì„œë²„/í´ë¼ ë¡œê·¸ â†’ `dmesg|CIFS`** ìˆœìœ¼ë¡œ ì¶”ì í•˜ë¼.
ì—¬ê¸°ê¹Œì§€ ìµí˜”ë‹¤ë©´, ì´ì   ì´ ì„¤ì •ë“¤ì„ **IaC(Ansible/Salt)**ë¡œ í…œí”Œë¦¿í™”í•˜ì—¬ ì—¬ëŸ¬ ì„œë²„ì— **ì¼ê´€ë˜ê²Œ ë°°í¬**í•˜ëŠ” ë‹¨ê³„ë¡œ ë‚˜ì•„ê°€ë©´ ëœë‹¤.
