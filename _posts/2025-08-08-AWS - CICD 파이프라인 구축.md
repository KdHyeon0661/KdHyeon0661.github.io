---
layout: post
title: AWS - CI/CD 파이프라인 구축
date: 2025-08-08 17:20:23 +0900
category: AWS
---
# CI/CD 파이프라인 구축 (CodePipeline, CodeBuild, CodeDeploy)

AWS에서 CI/CD(Continuous Integration / Continuous Delivery) 파이프라인을 구축하면 애플리케이션의 빌드, 테스트, 배포 과정을 자동화하여 개발 속도와 품질을 동시에 향상시킬 수 있습니다.  
AWS는 이를 위해 **CodePipeline**, **CodeBuild**, **CodeDeploy** 등의 서비스를 제공하며, 이들 서비스는 독립적으로 사용하거나 조합하여 완전한 배포 프로세스를 구성할 수 있습니다.

---

## 1. CI/CD 기본 개념

- **CI (지속적 통합)**  
  개발자가 코드를 변경할 때마다 중앙 저장소에 병합하고 자동 빌드 및 테스트를 수행해 코드 품질을 유지하는 방법론.
  
- **CD (지속적 배포/전달)**  
  테스트를 통과한 코드를 자동으로 스테이징 또는 프로덕션 환경에 배포하는 과정.
  
- **목표**
  - 배포 오류 감소
  - 개발 주기 단축
  - 코드 품질 보장

---

## 2. AWS CI/CD 주요 서비스

### 2.1 AWS CodePipeline
- AWS의 **워크플로우 오케스트레이션 서비스**
- 빌드, 테스트, 배포 단계를 정의하고 연결
- GitHub, CodeCommit, S3 등과 연동 가능
- 이벤트 기반(예: 코드 변경 시)으로 실행 가능

**특징**
- 완전관리형
- 병렬 단계 지원
- 승인 단계(Manual Approval) 추가 가능

---

### 2.2 AWS CodeBuild
- AWS의 **빌드 서비스**
- 소스 코드 컴파일, 테스트 실행, 아티팩트 생성
- 완전관리형이며 빌드 서버를 직접 관리할 필요 없음

**특징**
- Docker 기반 커스텀 빌드 환경 지원
- 빌드 사양(`buildspec.yml`) 파일로 동작 정의
- Pay-as-you-go 과금(빌드 시간만 과금)

---

### 2.3 AWS CodeDeploy
- AWS의 **자동 배포 서비스**
- EC2, Lambda, ECS 등 다양한 환경에 배포 지원
- Blue/Green, Rolling, In-place 배포 전략 제공

**특징**
- 롤백 지원
- 배포 상태 모니터링
- 트래픽 전환 전략 설정 가능

---

## 3. CI/CD 파이프라인 구성 흐름

1. **소스 단계(Source Stage)**  
   - CodeCommit, GitHub, S3 등에서 변경 감지
   - 변경 사항을 CodePipeline에 전달

2. **빌드 단계(Build Stage)**  
   - CodeBuild가 `buildspec.yml`에 따라 코드 빌드 및 테스트
   - 빌드 결과물(아티팩트) 생성

3. **배포 단계(Deploy Stage)**  
   - CodeDeploy가 빌드 아티팩트를 지정된 환경에 배포
   - 배포 전략에 따라 점진적 배포 또는 Blue/Green 배포 수행

---

## 4. 예시 구성

아래 예시는 **GitHub → CodeBuild → CodeDeploy → EC2** 파이프라인 예시입니다.

**폴더 구조 예시**
```
.
├── appspec.yml
├── buildspec.yml
├── scripts/
│   ├── install_dependencies.sh
│   ├── start_server.sh
│   └── stop_server.sh
└── src/
```

**`buildspec.yml` 예시**
```yaml
version: 0.2

phases:
  install:
    commands:
      - echo "Installing dependencies"
      - npm install
  build:
    commands:
      - echo "Building application"
      - npm run build
artifacts:
  files:
    - '**/*'
  discard-paths: no
```

**`appspec.yml` 예시 (EC2 배포용)**
```yaml
version: 0.0
os: linux
files:
  - source: /
    destination: /var/www/myapp
hooks:
  BeforeInstall:
    - location: scripts/stop_server.sh
      timeout: 300
  AfterInstall:
    - location: scripts/install_dependencies.sh
      timeout: 300
  ApplicationStart:
    - location: scripts/start_server.sh
      timeout: 300
```

---

## 5. CodePipeline 설정 단계

1. **Source 단계**
   - GitHub 연결(OAuth 토큰 또는 AWS 연결)
   - 브랜치 지정(예: `main`)

2. **Build 단계**
   - CodeBuild 프로젝트 생성
   - 빌드 환경(런타임, OS, 빌드 사양) 설정
   - 아티팩트 출력 경로 지정

3. **Deploy 단계**
   - CodeDeploy 애플리케이션 & 배포 그룹 생성
   - 대상 EC2 인스턴스 태그 기반 연결
   - 배포 전략 선택(In-place 또는 Blue/Green)

---

## 6. CI/CD 모범 사례

- **환경 분리**
  - dev → staging → production 단계별 파이프라인
- **테스트 자동화**
  - 유닛 테스트, 통합 테스트를 빌드 단계에 포함
- **롤백 전략**
  - CodeDeploy 롤백 기능 활성화
- **비밀 관리**
  - AWS Secrets Manager 또는 Parameter Store 활용
- **모니터링**
  - CloudWatch Logs, X-Ray, CodePipeline Execution History 활용

---

## 7. 장점

- 완전관리형으로 인프라 관리 부담 최소화
- AWS 네이티브 서비스와 자연스러운 통합
- 확장성과 유연성 높음
- IAM 기반 세밀한 권한 제어 가능

---

## 8. 요약

AWS CI/CD 파이프라인을 구성하면 배포 속도를 크게 높이고, 휴먼 에러를 줄이며, 안정성을 확보할 수 있습니다.  
CodePipeline이 전체 워크플로우를 관리하고, CodeBuild가 빌드를 담당하며, CodeDeploy가 자동 배포를 처리하는 **3단 구조**를 이해하는 것이 핵심입니다.