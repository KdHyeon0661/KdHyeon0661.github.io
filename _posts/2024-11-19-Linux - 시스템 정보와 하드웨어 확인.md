---
layout: post
title: Linux - 시스템 정보와 하드웨어 확인
date: 2024-11-19 19:20:23 +0900
category: Linux
---
# 시스템 정보와 하드웨어 확인

## 시스템 모니터링의 세 가지 접근 방식

시스템 정보 확인과 성능 모니터링은 세 가지 수준으로 접근할 수 있습니다:

1. **실시간 모니터링**: `top/htop`, `vmstat`, `iostat`, `ip -s`, `nload`, `dstat` 등을 사용하여 현재 시스템 상태를 즉시 확인합니다.
2. **정적/상세 정보 수집**: `lscpu`, `lsblk -f`, `lspci -nnk`, `lsusb`, `dmidecode`, `lshw`, `/proc`, `/sys` 등을 통해 시스템의 상세 하드웨어 정보를 확인합니다.
3. **특화된 진단 및 부하 재현**: `smartctl/nvme-cli`, `fio/ioping`, `ethtool/iperf3`, `perf/turbostat`, `sensors/powertop` 등을 사용하여 특정 문제를 진단하거나 성능을 테스트합니다.

---

## 실시간 자원 사용 모니터링

시스템 운영의 시작점은 현재 자원 사용 상황을 파악하는 것입니다:

### `top` — 기본 실시간 모니터링 도구

```bash
top
```
**유용한 단축키**:
- `P`: CPU 사용률 기준 정렬
- `M`: 메모리 사용량 기준 정렬
- `T`: 실행 시간 기준 정렬
- `k`: 특정 프로세스 종료 (PID 입력 필요)
- `1`: 개별 CPU 코어별 사용률 표시 전환
- `f`: 표시할 필드 선택/변경
- `q`: top 종료

### `htop` — 향상된 상호작용형 모니터링

```bash
sudo apt install -y htop
htop
```
**주요 기능**:
- F2: 설정 메뉴
- F4: 프로세스 필터링
- F6: 정렬 기준 변경
- F9: 프로세스 종료
- F10: 프로그램 종료
- 우측 상단에 CPU 코어별 사용률, 메모리/스왑 사용량, 부하 평균 등 직관적인 표시

### `free` — 메모리 사용량 요약

```bash
free -h
```
`available` 컬럼은 캐시와 버퍼를 고려한 실제 가용 메모리량을 추정하여 보여줍니다.

### `vmstat` — 전체 시스템 성능 스냅샷

```bash
vmstat 2 5     # 2초 간격으로 5회 표시
```
주요 지표 해석:
- `r`: 실행 대기 중인 프로세스 수 (run queue)
- `si/so`: 스왑 인/아웃 (swap in/out)
- `wa`: I/O 대기 시간 비율
- 이러한 지표들을 통해 시스템 병목 현상을 추정할 수 있습니다.

### `uptime` — 시스템 가동 시간 및 부하 평균

```bash
uptime
```

### `iostat` — 디스크 I/O 성능 모니터링

```bash
sudo apt install -y sysstat
iostat -xz 1 3
```
중요한 메트릭:
- `r/s`, `w/s`: 초당 읽기/쓰기 작업 수
- `rkB/s`, `wkB/s`: 초당 읽기/쓰기 데이터량 (KB)
- `await`: 평균 I/O 요청 대기 시간
- `svctm`: 평균 서비스 시간
- `%util`: 디스크 사용률 (100%에 가까울수록 포화 상태)

### `dstat` — 종합 실시간 모니터링

```bash
sudo apt install -y dstat
dstat -cdngym --top-io --top-bio
```
`dstat`은 CPU, 디스크, 네트워크, 메모리 등을 한 화면에서 통합적으로 모니터링할 수 있는 도구입니다.

---

## CPU, 메모리, 메인보드 상세 정보 확인

### `lscpu` — CPU 마이크로아키텍처 및 토폴로지 정보

```bash
lscpu
lscpu -e=CPU,CORE,SOCKET,NODE,ONLINE
numactl -H                 # NUMA 노드 및 메모리 접근성 정보
```
이 명령어들을 통해 CPU 플래그, 스레딩 구성, 캐시 정보, NUMA(Non-Uniform Memory Access) 지원 여부 등을 확인할 수 있습니다.

### 메모리 및 메인보드/BIOS 정보 — `dmidecode` 및 `lshw`

```bash
sudo dmidecode -t memory | less
sudo dmidecode -t bios
sudo lshw -short | less
```
이 도구들을 통해 메모리 채널 및 슬롯 정보, DIMM 용량과 속도, 제조사 정보, BIOS 버전 등 상세한 하드웨어 정보를 확인할 수 있습니다.

### 온도, 전력, 주파수 모니터링 — `sensors`, `turbostat`, `powertop`

```bash
sudo apt install -y lm-sensors powertop
sudo sensors-detect               # 하드웨어 센서 감지 (처음 한 번만 실행)
sensors                           # 온도, 전압, 팬 속도 정보 표시
sudo powertop                     # 전력 소비 문제 진단 및 튜닝 힌트 제공

# Intel 플랫폼에서 C-state 및 주파수 정보 확인
sudo apt install -y linux-tools-common
which turbostat && sudo turbostat --Summary --interval 5
```

### 커널 및 하드웨어 ID 확인 — `/proc`, `lspci`, `lsusb`

```bash
cat /proc/cpuinfo | grep -E 'model name|flags' | head
lspci -nnk | less       # PCI 장치 정보와 사용 중인 커널 드라이버
lsusb -v | less         # USB 장치 상세 정보
```

---

## 스토리지 시스템 정보 확인

### 블록 장치 구성 정보 — `lsblk`, `blkid`, `parted`, `fdisk`

```bash
lsblk -o NAME,SIZE,ROTA,TYPE,MOUNTPOINT,FSTYPE,MODEL
sudo blkid
sudo parted -l
sudo fdisk -l
```
`ROTA=0`은 SSD나 NVMe 드라이브를, `ROTA=1`은 HDD를 나타냅니다.

### 파일시스템 상태 확인

```bash
df -hT
mount | column -t | grep -v snap
```
파일시스템 타입(ext4/xfs/btrfs 등)과 마운트 옵션(noatime, discard 등)을 확인할 수 있습니다.

### RAID, LVM, ZFS, Btrfs 정보 확인

```bash
# RAID(md) 정보
sudo mdadm --detail /dev/md0

# LVM 정보
sudo pvs; sudo vgs; sudo lvs -a -o +devices

# ZFS 정보
sudo zpool status; sudo zpool list; sudo zfs list

# Btrfs 정보
sudo btrfs filesystem df /mountpoint
sudo btrfs scrub status /mountpoint
```

### 디스크 건강 상태 확인 — `smartctl` 및 `nvme-cli`

```bash
sudo apt install -y smartmontools nvme-cli

# SATA/SAS 드라이브 확인
sudo smartctl -a /dev/sda
sudo smartctl -H /dev/sda             # 건강 상태 요약
sudo smartctl -t short /dev/sda       # 단기 자가 테스트 실행

# NVMe 드라이브 확인
sudo nvme list
sudo nvme smart-log /dev/nvme0
sudo nvme error-log /dev/nvme0
```
이 도구들을 통해 재할당된 섹터 수, 미보정 오류, 드라이브 온도, 웨어 레벨링 상태 등의 중요 정보를 확인할 수 있습니다.

### 디스크 성능 테스트 — `fio` 및 `ioping`

```bash
sudo apt install -y fio ioping

# 랜덤 읽기/쓰기 성능 테스트 (4KB 블록, 1분간, 큐 깊이 32)
fio --name=randrw --rw=randrw --bs=4k --size=2G --iodepth=32 \
    --runtime=60 --time_based --directory=/data --numjobs=4 --group_reporting

# 디스크 지연 시간 측정
ioping -c 10 /data
```
**주의**: 운영 중인 파일시스템에 부하를 가할 수 있으므로 신중하게 사용해야 합니다.

---

## 네트워크 정보 확인 및 성능 테스트

### 네트워크 인터페이스 및 통계 — `ip` 및 `ss`

```bash
ip -s link                    # 패킷 드롭, 에러, 오버런 통계
ss -tuln                      # 리스닝 중인 포트 확인
ss -s                         # 소켓 통계 요약
```

### 네트워크 드라이버 및 오프로드 설정 — `ethtool`

```bash
sudo apt install -y ethtool
sudo ethtool -i eth0                 # 드라이버 정보 및 버전 확인
sudo ethtool eth0                    # 링크 상태, 속도, 듀플렉스 정보
sudo ethtool -k eth0                 # 오프로드 기능 확인 (TCO, GRO, RXCSUM 등)
sudo ethtool -S eth0 | less          # 하드웨어 통계 (드롭, 에러, 큐별 카운터)
sudo ethtool -g eth0                 # RX/TX 링 버퍼 크기 확인
```

### 네트워크 대역폭 및 지연 시간 측정 — `iperf3`, `mtr`, `traceroute`

```bash
sudo apt install -y iperf3 mtr traceroute

# 서버 측 실행
iperf3 -s

# 클라이언트 측 실행 (서버 IP 주소로 변경)
iperf3 -c 192.0.2.10 -P 4 -t 30

# 네트워크 경로 및 품질 확인
mtr -rwzbc 100 8.8.8.8
traceroute -n 8.8.8.8
```

### 장기 네트워크 통계 수집 — `sar`

```bash
sudo systemctl enable --now sysstat
sar -n DEV 1 5      # 네트워크 인터페이스 통계
sar -n TCP,ETCP 1 5 # TCP 연결 통계
```

---

## 프로세스 및 커널 수준 분석

### 프로세스별 및 CPU별 성능 분석 — `pidstat`, `mpstat`

```bash
pidstat 1 5              # 프로세스별 CPU, 메모리, I/O 통계
mpstat -P ALL 1 5        # 개별 CPU 코어별 사용률
```

### 성능 프로파일링 — `perf`

```bash
sudo apt install -y linux-tools-$(uname -r)
sudo perf top            # 시스템 전체의 핫스팟 확인
sudo perf record -g -- your_cmd   # 특정 명령어 실행 프로파일링
sudo perf report         # 기록된 프로파일 분석
```
프로파일링 도구는 심볼 정보와 보안 설정에 따라 추가 권한이 필요할 수 있습니다.

### 커널 메모리 및 인터럽트 정보 확인

```bash
slabtop                      # 커널 슬랩 할당자 정보
vmstat -s | head             # 가상 메모리 통계 요약
cat /proc/interrupts | column -t  # 시스템 인터럽트 분포
```
특정 네트워크 인터페이스 큐에 인터럽트가 편중되어 있는 경우 IRQ affinity나 RPS(Receive Packet Steering) 조정을 고려할 수 있습니다.

---

## GPU 및 가속 하드웨어 정보 확인

### NVIDIA GPU 정보 확인

```bash
nvidia-smi
nvidia-smi dmon -s pucm  # GPU 사용률, 전력, 온도, 메모리 실시간 모니터링
```

### AMD ROCm 정보 확인

```bash
rocm-smi
```

---

## 고급 주제: 컨테이너, 가상화, NUMA, IRQ 최적화

### 가상화 지원 및 하이퍼바이저 감지

```bash
lscpu | grep -E 'Virtualization|Hypervisor'
systemd-detect-virt
```

### NUMA 바인딩 및 메모리 정책 설정

```bash
numactl -H
numactl --cpunodebind=0 --membind=0 your_cmd  # 특정 NUMA 노드에서 명령 실행
```

### IRQ Affinity 튜닝 (네트워크 성능 최적화)

```bash
# 특정 네트워크 인터페이스의 IRQ 확인
grep eth0 /proc/interrupts

# 특정 IRQ를 특정 CPU 코어에 바인딩 (예시: IRQ 90을 CPU 2에 할당)
echo 0x4 | sudo tee /proc/irq/90/smp_affinity
```
**주의**: 운영 서버에서는 변경을 작은 범위에서 단계적으로 테스트해야 합니다.

---

## 전원 관리 및 배터리 정보 (노트북/엣지 디바이스)

```bash
upower -i $(upower -e | grep BAT) | less  # 배터리 정보
acpi -V                                    # ACPI 정보
powertop                                   # 전력 소비 분석
```

---

## 자동화된 하드웨어 인벤토리 보고서 생성

### 통합 시스템 정보 수집 스크립트

```bash
#!/usr/bin/env bash
# sysreport.sh — 시스템, 하드웨어, 성능 정보 종합 보고서 생성

set -euo pipefail
OUT="sysreport_$(hostname)_$(date +%F_%H%M%S).txt"

exec > >(tee "$OUT") 2>&1

echo "== 호스트/운영체제 정보 =="
hostnamectl || true
echo

echo "== 커널 정보 =="
uname -a
lsb_release -a 2>/dev/null || true
echo

echo "== CPU/NUMA 정보 =="
lscpu
numactl -H 2>/dev/null || true
echo

echo "== 메모리 정보 =="
free -h
vmstat -s | head -n 30
echo

echo "== 센서 정보 =="
sensors 2>/dev/null || true
echo

echo "== 블록 장치/LVM/파일시스템 정보 =="
lsblk -o NAME,SIZE,ROTA,TYPE,MOUNTPOINT,FSTYPE,MODEL
df -hT
pvs 2>/dev/null || true; vgs 2>/dev/null || true; lvs -a -o +devices 2>/dev/null || true
mdadm --detail /dev/md0 2>/dev/null || true
echo

echo "== 디스크 건강 상태 (SMART/NVMe) =="
for d in /dev/sd[a-z] /dev/nvme[0-9]n1; do
  [ -e "$d" ] || continue
  if [[ "$d" == /dev/nvme* ]]; then
    echo "-- $d --"
    nvme smart-log "$d" 2>/dev/null || true
  else
    echo "-- $d --"
    smartctl -H -A "$d" 2>/dev/null || true
  fi
done
echo

echo "== PCI/USB 장치 정보 =="
lspci -nnk | sed -n '1,120p'
lsusb 2>/dev/null || true
echo

echo "== 네트워크 정보 =="
ip -s link
ss -tuln
for nic in $(ls /sys/class/net | grep -v lo); do
  echo "-- ETHTOOL $nic --"
  ethtool $nic 2>/dev/null || true
  ethtool -k $nic 2>/dev/null || true
done
echo

echo "== 프로세스 제한 정보 =="
ulimit -a
echo

echo "== 보고서 생성 완료: $OUT =="
```

### 스크립트 실행 방법

```bash
chmod +x sysreport.sh
./sysreport.sh
```
생성된 파일명 형식: `sysreport_HOST_YYYY-MM-DD_HHMMSS.txt`

이 보고서는 장애 접수 시 1차 자료로 사용하면 진단 속도를 크게 향상시킬 수 있습니다.

---

## 장애 시나리오별 점검 절차

### 시나리오: "시스템 부하가 높은데 서비스 응답이 느리다"

1. **CPU 및 스케줄링 상태 확인**:
```bash
uptime
top -H -p $(pgrep -d, -f your_service)
pidstat -t 1 5 -p $(pgrep -d, -f your_service)
```

2. **메모리 및 스왑 상태 확인**:
```bash
free -h
vmstat 1 5
cat /proc/meminfo | egrep 'Dirty|Writeback|Anon|PageTables'
```

3. **I/O 상태 확인**:
```bash
iostat -xz 1 5
pidstat -d 1 5 -p $(pgrep -d, -f your_service)
```

4. **네트워크 상태 확인**:
```bash
ip -s link
ss -s
ethtool -S eth0 | egrep 'drop|err|miss|fail' -i
```

### 시나리오: "디스크 성능이 갑자기 저하되었거나 오류가 의심된다"

```bash
dmesg | egrep -i 'error|reset|timeout|link'
iostat -xz 1 5
smartctl -H -A /dev/sda
nvme smart-log /dev/nvme0
```
`await` 값의 상승과 `dmesg`의 오류 메시지가 함께 나타나는 경우 케이블/포트 문제, 펌웨어/컨트롤러 문제, 디스크 건강 상태 저하 등을 의심해야 합니다.

### 시나리오: "네트워크에서 간헐적으로 패킷 드롭이 발생한다"

```bash
ip -s link
ethtool -S eth0 | egrep -i 'drop|error'
dmesg | egrep -i 'net|eth|mlx|ixgbe|bnx'   # 네트워크 드라이버 관련 메시지
mtr -rwzbc 200 8.8.8.8
iperf3 -c GATEWAY -P 4 -t 20
```
오프로드 기능 충돌이 의심되는 경우 `ethtool -K eth0 gro off gso off tso off rx off tx off` 명령으로 테스트하여 비교할 수 있습니다.

### 시나리오: "NUMA 또는 IRQ 편중으로 인한 지연 발생"

```bash
numactl -H
cat /proc/interrupts | column -t | egrep 'eth0|nvme'

# IRQ-코어 매핑 재조정 (테스트 환경에서 시도)
echo 0x4 | sudo tee /proc/irq/<IRQ>/smp_affinity
```

---

## 핵심 시스템 정보 확인: /proc 및 /sys 파일시스템

```bash
cat /proc/uptime          # 시스템 가동 시간
cat /proc/loadavg         # 부하 평균
cat /proc/<PID>/status    # 특정 프로세스 상태
cat /proc/meminfo         # 메모리 정보
cat /proc/zoneinfo | less # 메모리 존 정보
cat /proc/slabinfo | head # 커널 슬랩 할당자 정보
```

`/sys` 파일시스템을 통해 하드웨어 및 드라이버 파라미터를 확인하고 조정할 수 있습니다:
```bash
# CPU 성능 정책 확인 및 변경 (경로는 배포판/커널 버전에 따라 다를 수 있음)
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
```
**중요**: 운영 환경에서는 변경 전후 상태를 반드시 기록하고, 롤백 계획을 마련해야 합니다.

---

## 정기적인 성능 모니터링 자동화

### 간단한 성능 스냅샷 수집 스크립트

```bash
#!/usr/bin/env bash
# /usr/local/bin/quick-snap.sh

D="/var/log/snap"
mkdir -p "$D"
date '+%F %T' >> "$D/cpu.mem.log"
uptime >> "$D/cpu.mem.log"
vmstat 1 3 >> "$D/cpu.mem.log"
iostat -xz 1 3 >> "$D/io.log"
sar -n DEV 1 3 >> "$D/net.log"
```

### 크론을 통한 정기 실행 설정

```bash
# /etc/cron.d/quick-snap
*/30 * * * * root /usr/local/bin/quick-snap.sh
```

---

## 핵심 명령어 요약

| 범주 | 주요 명령어 |
|---|---|
| 실시간 전체 모니터링 | `top`, `htop`, `vmstat`, `dstat`, `iostat -xz` |
| CPU 및 NUMA 정보 | `lscpu`, `numactl -H`, `mpstat`, `turbostat` |
| 메모리 정보 | `free -h`, `vmstat -s`, `slabtop`, `cat /proc/meminfo` |
| 디스크 구조 정보 | `lsblk -f`, `blkid`, `fdisk -l`, `parted -l`, `df -hT` |
| 디스크 건강 상태 | `smartctl -a`, `nvme smart-log`, `mdadm --detail`, `lvs/vgs/pvs` |
| 디스크 성능 테스트 | `fio`, `ioping` |
| 네트워크 링크 정보 | `ip -s link`, `ss -tuln/-s`, `ethtool/-S/-k/-g` |
| 네트워크 성능 테스트 | `iperf3`, `mtr`, `traceroute`, `sar -n` |
| 하드웨어 종합 정보 | `dmidecode`, `lshw`, `lspci -nnk`, `lsusb` |
| 전력 및 온도 정보 | `sensors`, `powertop`, `turbostat` |
| 프로파일링 도구 | `pidstat`, `perf top/record` |

---

## 결론

효과적인 시스템 정보 확인과 하드웨어 모니터링은 리눅스 시스템 관리의 핵심 역량입니다. 체계적인 접근 방식을 통해 시스템의 건강 상태를 파악하고, 문제 발생 시 신속하게 원인을 진단할 수 있습니다.

시스템 모니터링은 세 단계로 접근하는 것이 효과적입니다:

**첫 번째 단계(실시간 모니터링)**: `top/htop`, `vmstat`, `iostat`, `ip -s`, `ss` 등의 도구를 사용하여 현재 시스템 상태를 즉시 파악합니다. 이 단계에서 시스템의 전반적인 건강 상태와 즉각적인 문제점을 식별할 수 있습니다.

**두 번째 단계(상세 정보 수집)**: `lscpu`, `lsblk`, `lspci`, `dmidecode`, `lshw` 등을 통해 시스템의 상세 하드웨어 정보를 확인하고, `smartctl`, `nvme-cli` 등을 사용하여 저장 장치의 건강 상태와 펌웨어 정보, 드라이버 상태를 점검합니다.

**세 번째 단계(진단 및 튜닝)**: `fio`, `ioping`으로 I/O 특성을 분석하고, `ethtool`, `iperf3`로 네트워크 링크 상태와 오프로드 기능을 검증하며, `perf`, `turbostat`, `sensors`로 시스템 병목 현상을 정밀하게 분석합니다.

자동화된 모니터링 시스템을 구축하는 것도 중요합니다. 수집 스크립트, 크론 작업, `sysstat(sar)` 도구를 활용하여 시간 경과에 따른 시스템 데이터를 축적하면, 장애 발생 시 상관관계 분석을 통해 원인을 더 쉽게 찾을 수 있습니다.

가장 중요한 것은 이러한 도구들과 기술들을 실제 상황에 적용해보는 경험입니다. 정기적으로 시스템 상태를 점검하고, 문제 발생 시 체계적으로 접근하는 습관을 들이면, 더 안정적이고 효율적인 시스템 운영이 가능해질 것입니다. 시스템 정보 확인과 모니터링은 단순한 기술이 아니라, 시스템을 이해하고 예측 가능하게 만드는 필수적인 운영 철학입니다.