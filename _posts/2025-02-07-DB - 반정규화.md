---
layout: post
title: DB - 성능 데이터 모델링
date: 2025-02-02 19:20:23 +0900
category: DB
---
# 📦 반정규화(Denormalization) 완전 정리

## ✅ 1. 반정규화란?

> **정규화된 데이터 모델을 성능이나 실용성 등을 고려해 의도적으로 일부 규칙을 완화하는 과정**

- 정규화를 통해 **데이터 무결성**과 **중복 최소화**를 얻을 수 있지만,
- 지나치게 분리된 테이블 구조는 **조회 성능 저하**나 **복잡한 쿼리**를 유발할 수 있습니다.
- 이때 성능 향상이나 단순화를 위해 **정규화를 일부 되돌리는 것**이 반정규화입니다.

---

## 🎯 2. 반정규화의 목적

- **조회 성능 개선**: 자주 사용되는 조인을 제거해 응답속도 향상
- **쿼리 단순화**: 복잡한 다중 조인을 피하고 유지보수성 향상
- **데이터 집계/분석 최적화**: 보고서나 통계용으로 빠른 조회 가능
- **중복 허용으로 처리 속도 확보**: 쓰기보다는 **읽기 중심의 시스템**에서 유리

---

## 🕒 3. 반정규화 적용 시점

| 적용 시점                   | 설명 |
|----------------------------|------|
| 모델 설계 후기             | 정규화 모델 완료 후 성능/쿼리 검토 단계 |
| 성능 병목 식별 후           | 운영 중 조회 속도 저하 등 발생 시 |
| 트랜잭션 패턴 분석 후       | 읽기/쓰기 비율이 편향된 경우 (읽기多) |
| 시스템 요구사항 반영 시     | SLA 기준 응답시간 충족 필요 시 |

---

## 🛠️ 4. 주요 반정규화 기법

| 기법                      | 설명 |
|---------------------------|------|
| 1:1 테이블 통합             | 자주 조인되는 1:1 관계 테이블을 합침 |
| 1:N 테이블 통합             | 선택적으로 종속 테이블을 부모에 합침 |
| 속성 추가                   | 조회용 파생 속성(예: 총금액, 집계값) 추가 |
| 중복 컬럼 저장              | 다른 테이블 값을 중복 저장해 조인 제거 |
| 집계 테이블 생성            | 자주 사용하는 집계 데이터를 별도 저장 |
| 이력 테이블 제거 또는 단순화 | 변경 이력 관리 생략 또는 최소화 |
| 코드성 데이터 하드코딩       | 조회 속도 위해 코드 테이블 제거 또는 축소 |

---

## ⚖️ 5. 반정규화의 장단점

### ✅ 장점
- 조회 속도 향상 (조인 감소)
- 쿼리 복잡성 감소 → 유지보수성 향상
- 리포트/분석 처리 속도 개선

### ❌ 단점
- **데이터 중복 증가**
- **무결성 제약 약화** (PK/FK 제약 제한)
- **수정 비용 증가** (동일 데이터 다중 수정 필요)
- **쓰기 성능 저하 가능성** (입력/수정 복잡성 증가)

---

## ⚠️ 6. 반정규화 시 주의사항

- 항상 **다른 대안(인덱스, 파티셔닝, 쿼리 튜닝 등)**을 먼저 검토해야 함
- 무분별한 반정규화는 **데이터 정합성**에 치명적
- 비정규화 대상은 반드시 **객관적 성능 지표나 쿼리 분석에 기반**해야 함
- **수정이 자주 발생하는 속성은 반정규화에 부적절**

---

## 💼 7. 실무 적용 예시

| 사례 | 설명 |
|------|------|
| 쇼핑몰 상품 테이블에 '카테고리명' 직접 저장 | 카테고리 테이블 조인 생략 |
| 게시판 글 테이블에 '댓글 수' 컬럼 추가 | 매번 COUNT 쿼리 없이 바로 조회 |
| 거래 테이블에 '거래 고객명' 저장 | 고객 테이블 조회 생략 (단, 이름 변경 시 동기화 필요) |
| 통계용 집계 테이블 별도 구축 | 월별/일별 요약 데이터를 사전 저장 |

---

## 🧩 8. 정규화 vs 반정규화

| 항목           | 정규화                            | 반정규화                          |
|----------------|-------------------------------------|-----------------------------------|
| 목적           | 데이터 무결성, 중복 제거             | 성능 향상, 조회 단순화           |
| 중심           | 쓰기/수정/삭제 최적화              | 읽기 최적화                      |
| 무결성         | 강함 (PK/FK 제약 등)                | 약해짐 (제약 조건 완화됨)         |
| 유지보수       | 구조 변경 시 유리                   | 중복으로 인해 수정 영향 범위 증가  |
| 사용 시기       | 모델 설계 초반                     | 성능 병목 시, 후반 최적화 단계     |

---

## 📝 마무리 정리

- 반정규화는 **정규화를 완전히 되돌리는 것이 아닌, 선택적/부분적 적용을 의미**합니다.
- 모든 시스템에 필요한 것이 아니라, **트래픽/쿼리 특성에 따라 다르게 적용되어야 합니다**.
- 반정규화는 ‘필요 악’이 될 수도 있으므로, **성능과 무결성의 균형**이 핵심입니다.
원하시면 이후 이어서 👉 반정규화 대상 판단 기준 체크리스트나 실전 ERD 반정규화 전후 비교도 만들어 드릴 수 있습니다.







나의 말:
반정규화가 데이터 무결성에 미치는 영향에 대해 구체적인 사례(예: 동기화 문제 또는 트랜잭션 관리 방안)를 간략히 추가하면 더 현실감 있는 경고가 될 수 있습니다.에 대해 다뤄줘


ChatGPT의 말:
물론입니다. 반정규화는 조회 성능 향상에 큰 이점이 있지만, 그 대가로 데이터 무결성(integrity) 측면에서 여러 가지 위험을 내포합니다. 이 부분을 실무 관점에서 구체적인 사례와 트랜잭션 관리 방안을 중심으로 보강해드릴게요.

markdown
복사
편집
## 🛑 반정규화가 데이터 무결성에 미치는 영향

반정규화를 적용하면 데이터의 중복이 생기므로, 하나의 변경이 여러 곳에 영향을 미칩니다. 이로 인해 **데이터 정합성 손상**, **업데이트 누락**, **동기화 실패** 등이 발생할 수 있습니다.

---

### 📌 대표 사례: 고객명 중복 저장

**설명**: `주문 테이블`에 고객명을 중복 저장해 조인 없이 조회 성능을 높이는 반정규화를 적용했다고 가정합니다.

| 고객 테이블 | 주문 테이블 |
|-------------|-------------|
| 고객ID: 101 | 주문ID: 9001, 고객ID: 101, 고객명: "홍길동" |
| 이름: 홍길동 | 주문ID: 9002, 고객ID: 101, 고객명: "홍길동" |

➡ 이후 **홍길동 → 홍길순**으로 이름이 변경되면?

- 고객 테이블만 수정하면 안 되고,
- 주문 테이블의 모든 고객명도 **동시에 수정**해야 합니다.
- 하나라도 누락되면 **데이터 불일치 발생**

---

### ⚠️ 동기화 실패 시 문제점

| 문제 유형 | 설명 |
|-----------|------|
| **데이터 정합성 오류** | 동일 고객인데 주문마다 이름이 다를 수 있음 |
| **업데이트 누락** | 주문 내역에 이전 이름이 남아 잘못된 보고서 생성 |
| **신뢰도 하락** | 사용자 혼란, 감사 또는 규제 위반 위험 증가 |

---

### 🛠️ 트랜잭션 관리 방안

반정규화 구조에서 무결성을 유지하려면 다음과 같은 **보완 조치**가 필요합니다:

| 방법 | 설명 |
|------|------|
| ✅ **트리거(Trigger)** | 고객 테이블의 이름 변경 시, 주문 테이블의 고객명도 자동 갱신 |
| ✅ **스토어드 프로시저** | 고객정보 수정 시 반드시 관련 테이블 모두를 갱신하는 저장 프로시저 사용 |
| ✅ **단일 트랜잭션 처리** | 여러 테이블을 함께 갱신해야 하므로, 하나의 트랜잭션으로 묶어 원자성 보장 (`BEGIN ~ COMMIT`) |
| ✅ **동기화 도구/배치** | 비실시간 갱신의 경우, 배치 작업이나 CDC(Change Data Capture)로 동기화 유지 |

---

### 🎯 결론

> 반정규화는 **읽기 성능을 위한 타협**이며, 데이터 정합성 관리 책임은 오롯이 개발자·DBA에게 넘어옵니다.

- 성능 개선 효과가 명확할 때만 사용
- 반드시 **무결성 유지를 위한 기술적 보완**이 동반되어야 함
- 비즈니스적으로 중요한 정보일수록 **반정규화는 더 신중히 적용**
