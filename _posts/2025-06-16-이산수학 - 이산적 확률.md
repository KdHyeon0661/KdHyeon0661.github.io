---
layout: post
title: 이산수학 - 이산적 확률
date: 2025-06-16 19:20:23 +0900
category: 이산수학
---
# 이산적 확률(Discrete Probability)

## 0. 큰 그림(로드맵)

- **무대**: 표본공간 \(S\), 사건 \(\mathcal{F}\subseteq 2^S\), 확률 \(P\). (이산에선 보통 \( \mathcal{F}=2^S \))
- **방법**: 등확률 공간이면 “경우의 수”로 풀기. 등확률이 아니면 “가중치(가능도)” 반영.
- **핵심 도구**: 조건부 확률, 전확률, 베이즈, 독립성, 포함배제, 지시변수, 생성함수(PGF), 컨볼루션.
- **대표 분포**: 베르누이/이항/초기하/기하/음이항/포아송(+근사 관계).
- **품질 보증**: 불평등(마르코프/체비셰프/체르노프), LLN/CLT 직관, 시뮬레이션으로 검증.

---

## 1. 기본 용어와 공리

### 1.1 표본공간·사건·확률
- **시행(Trial)**: 확률 실험 1회.
- **표본공간 \(S\)**: 가능한 모든 결과의 집합.
- **사건(Event)**: \(S\)의 부분집합.
- **확률 \(P\)**(Kolmogorov 공리, 이산 환경):
  $$
  0\le P(A)\le 1,\quad P(S)=1,\quad A_i\text{가 서로 배반이면 }P\Big(\bigcup_i A_i\Big)=\sum_i P(A_i).
  $$

### 1.2 등확률 공간의 기본 공식
- 등확률 결과가 \(|S|\)개, 사건 \(A\)의 원소가 \(|A|\)개면
  $$
  P(A)=\frac{|A|}{|S|}.
  $$

---

## 2. 사건의 연산과 포함배제

### 2.1 여사건·합·교
- 여사건:
  $$
  P(\overline{A})=1-P(A).
  $$
- 합사건:
  $$
  P(A\cup B)=P(A)+P(B)-P(A\cap B).
  $$
- 포함배제(세 사건):
  $$
  P(A\cup B\cup C)=\sum P - \sum P(\text{교 2개})+P(A\cap B\cap C).
  $$

### 2.2 드모르간
$$
\overline{A\cup B}=\overline{A}\cap \overline{B},\qquad
\overline{A\cap B}=\overline{A}\cup \overline{B}.
$$

---

## 3. 조건부 확률·전확률·베이즈

### 3.1 조건부 확률
$$
P(A\mid B)=\frac{P(A\cap B)}{P(B)},\quad P(B)>0.
$$

### 3.2 전확률의 법칙(분할 \( \{B_i\} \))
$$
P(A)=\sum_i P(A\mid B_i)P(B_i).
$$

### 3.3 베이즈 정리(이산)
$$
P(B_j\mid A)=\frac{P(A\mid B_j)P(B_j)}{\sum_i P(A\mid B_i)P(B_i)}.
$$

**상황 예시(품질 검사)**
공장에서 3개 라인 \(L_1,L_2,L_3\)의 생산 비율이 \(0.2, 0.5, 0.3\), 불량률이 각각 \(3\%, 1\%, 2\%\). 불량품이 나왔을 때 \(L_1\)일 확률?
$$
P(L_1\mid D)=\frac{0.03\cdot 0.2}{0.03\cdot 0.2+0.01\cdot 0.5+0.02\cdot 0.3}.
$$

---

## 4. 독립성: 쌍/상호 독립

### 4.1 정의
- 두 사건 \(A,B\) 독립:
  $$
  P(A\cap B)=P(A)P(B).
  $$
- **쌍 독립(pairwise)** vs **상호 독립(mutual)** 구분 주의. 쌍 독립이더라도 세 개 동시에 독립이 아닐 수 있음.

**상황 예시(세 동전과 패리티)**
\(A\)=첫 toss=H, \(B\)=둘째=H, \(C\)=헤드 개수가 짝수. \(A,B,C\)는 쌍별 독립이지만 상호 독립 아님.

---

## 5. 확률변수, PMF, CDF

### 5.1 확률변수·PMF
이산 확률변수 \(X\)의 **확률질량함수(PMF)**:
$$
p_X(x)=P(X=x),\quad \sum_x p_X(x)=1.
$$

### 5.2 분포함수(CDF)
$$
F_X(t)=P(X\le t)=\sum_{x\le t}p_X(x).
$$

### 5.3 기대값·분산·공분산
$$
E[X]=\sum_x x\,p_X(x),\qquad
\mathrm{Var}(X)=E[(X-E[X])^2]=E[X^2]-(E[X])^2.
$$
두 변수 \(X,Y\):
$$
\mathrm{Cov}(X,Y)=E[XY]-E[X]E[Y].
$$

### 5.4 선형성·지시변수 테크닉
- 선형성(독립 불필요):
  $$
  E\Big[\sum_i X_i\Big]=\sum_i E[X_i].
  $$
- 지시변수 \(I_A=\mathbf{1}\{A\}\): \(E[I_A]=P(A)\).
  **응용**: 기대 개수 계산을 “합의 기대값”으로 바꾸면 쉬워짐.

---

## 6. 대표 이산 분포 — 시나리오·공식·코드

### 6.1 베르누이 \( \mathrm{Bern}(p) \)
- 시행 1회 성공/실패.
- PMF:
  $$
  P(X=1)=p,\quad P(X=0)=1-p.
  $$
- 평균·분산:
  $$
  E[X]=p,\quad \mathrm{Var}(X)=p(1-p).
  $$

### 6.2 이항 \( \mathrm{Bin}(n,p) \)
- 독립 베르누이 \(n\)회 성공 횟수.
- PMF:
  $$
  P(X=k)=\binom{n}{k}p^k(1-p)^{n-k}.
  $$
- 평균·분산:
  $$
  E[X]=np,\quad \mathrm{Var}(X)=np(1-p).
  $$

**상황 예시(이메일 클릭)**
발송 \(n=1000\), 클릭확률 \(p=0.05\). 60회 이상 클릭될 확률? 누적합 또는 정규근사 사용.

```python
import math
def binom_pmf(n,p,k):
    from math import comb
    return comb(n,k)*(p**k)*((1-p)**(n-k))

def binom_cdf_ge(n,p,threshold):
    return sum(binom_pmf(n,p,k) for k in range(threshold, n+1))

print(binom_cdf_ge(1000,0.05,60))
```

### 6.3 초기하 \( \mathrm{Hypergeo}(N,K,n) \)
- 모집단 \(N\), 성공 \(K\)개, 복원없이 \(n\)개 추출 성공수 \(X\).
- PMF:
  $$
  P(X=k)=\frac{\binom{K}{k}\binom{N-K}{n-k}}{\binom{N}{n}}.
  $$
- 평균·분산:
  $$
  E[X]=n\frac{K}{N},\quad \mathrm{Var}(X)=n\frac{K}{N}\Big(1-\frac{K}{N}\Big)\frac{N-n}{N-1}.
  $$

**상황 예시(QC 샘플링)**
로트 \(N=1000\) 중 불량 \(K=50\), 샘플 \(n=20\)에서 불량이 2개 이상일 확률?

### 6.4 기하 \( \mathrm{Geom}(p) \) (성공까지 시도 횟수)
- PMF(성공까지 걸린 시도 수):
  $$
  P(X=k)=(1-p)^{k-1}p,\quad k=1,2,\dots
  $$
- 평균·분산:
  $$
  E[X]=\frac{1}{p},\quad \mathrm{Var}(X)=\frac{1-p}{p^2}.
  $$
- **무기억성**:
  $$
  P(X>s+t\mid X>s)=P(X>t).
  $$

**상황 예시(콜센터 연결)**
연결 확률 \(p=0.2\). 첫 연결까지 기대 통화 시도수 \(=1/p=5\).

### 6.5 음이항 \( \mathrm{NegBin}(r,p) \) (r번째 성공까지 실패 포함 시도 횟수)
- PMF(시도 \(k\)에 \(r\)번째 성공):
  $$
  P(X=k)=\binom{k-1}{r-1}p^r(1-p)^{k-r},\quad k=r,r+1,\dots
  $$
- 평균·분산:
  $$
  E[X]=\frac{r}{p},\quad \mathrm{Var}(X)=\frac{r(1-p)}{p^2}.
  $$

### 6.6 포아송 \( \mathrm{Pois}(\lambda) \)
- 간헐적 이벤트의 카운트.
- PMF:
  $$
  P(X=k)=e^{-\lambda}\frac{\lambda^k}{k!},\quad k=0,1,2,\dots
  $$
- 평균·분산:
  $$
  E[X]=\lambda,\quad \mathrm{Var}(X)=\lambda.
  $$
- **근사**: \(n\)이 크고 \(p\)가 작을 때 \(\mathrm{Bin}(n,p)\approx \mathrm{Pois}(\lambda=np)\).

**상황 예시(분당 도착 콜 수)**
평균 3콜/분이면 5콜 이상일 확률?

```python
import math
def pois_cdf_ge(lam, k):
    return 1 - sum(math.exp(-lam)*lam**i/math.factorial(i) for i in range(k))
print(pois_cdf_ge(3,5))
```

---

## 7. 합의 분포: 컨볼루션 & 독립 합의 성질

### 7.1 컨볼루션(PMF 합성)
독립 이산 \(X,Y\), 합 \(Z=X+Y\):
$$
p_Z(z)=\sum_x p_X(x)p_Y(z-x).
$$

```python
import numpy as np

def convolve_pmf(p, q):
    # p,q: 리스트 형태 PMF (index가 값)
    return np.convolve(p, q)

# 예: Bin(3,0.5) + Bin(2,0.5) = Bin(5,0.5)
```

### 7.2 확률생성함수(PGF)
$$
G_X(s)=E[s^X]=\sum_{k\ge 0} p_X(k)s^k.
$$
독립합:
$$
G_{X+Y}(s)=G_X(s)\cdot G_Y(s).
$$

- \(\mathrm{Pois}(\lambda)\): \(G(s)=\exp(\lambda(s-1))\) → 합의 포아송성(매개변수 합).

---

## 8. 기대값 테크닉 — 지시변수로 “세기”

### 8.1 고정점(더랑주 문제, 간단형)
길이 \(n\) 퍼뮤테이션의 **고정점** 기대 개수? 각 자리 \(i\)에 대해 지시변수 \(I_i=\mathbf{1}\{\pi(i)=i\}\).
$$
E[I_i]=P(\pi(i)=i)=\frac{1}{n} \Rightarrow E\Big[\sum_{i=1}^n I_i\Big]=\sum \frac{1}{n}=1.
$$
→ **항상 1**.

### 8.2 점유 문제(공을 상자에): 비어있지 않은 상자 기대 수
상자 \(m\)개, 공 \(n\)개를 독립 균등 던지기. 상자 \(j\)가 비어있지 않을 지시변수 \(I_j\).
$$
E[I_j]=1-(1-\frac{1}{m})^n \Rightarrow E[\#\text{nonempty}]=m\Big(1-(1-\frac{1}{m})^n\Big).
$$

---

## 9. 고전 문제

### 9.1 생일 문제(충돌 확률)
서로 다른 생일을 가질 확률:
$$
P(\text{no collision})=\frac{365}{365}\cdot\frac{364}{365}\cdots\frac{365-n+1}{365}
\approx \exp\Big(-\frac{n(n-1)}{2\cdot 365}\Big).
$$
\(n=23\)이면 충돌 확률 \(\approx 0.507\).

```python
import math
def birthday_collision_prob(n, d=365):
    p_no = 1.0
    for k in range(n):
        p_no *= (d-k)/d
    return 1 - p_no

print(birthday_collision_prob(23))
```

### 9.2 쿠폰 수집(Coupon Collector)
종류 \(m\). 모든 종류 모을 때까지 걸리는 시도 횟수 \(T\)의 기대값:
$$
E[T]=m\cdot H_m\simeq m(\ln m+\gamma) \quad (\gamma\approx 0.5772).
$$
증명 스케치: 새 쿠폰 나올 때까지의 기하분포 기대값을 단계별로 합.

```python
import random
def coupon_trials(m, reps=2000):
    tot=0
    for _ in range(reps):
        seen=set(); t=0
        while len(seen)<m:
            seen.add(random.randrange(m))
            t+=1
        tot+=t
    return tot/reps

for m in [10,50,100]:
    sim=coupon_trials(m,1000)
    theo=m*(sum(1/i for i in range(1,m+1)))
    print(m, sim, theo)
```

### 9.3 공을 상자에(최대 점유 직관)
\(n=m\)일 때 최대 점유는 대략 \(\frac{\ln m}{\ln\ln m}\) 근방(정확한 분포는 고급 주제). 실무에선 체르노프/유니온 바운드로 과포화 확률을 제한.

---

## 10. 불평등과 농도: 안전한 상계

### 10.1 마르코프 부등식
비음수 \(X\), \(a>0\):
$$
P(X\ge a)\le \frac{E[X]}{a}.
$$

### 10.2 체비셰프
평균 \(\mu\), 분산 \(\sigma^2\):
$$
P(|X-\mu|\ge t)\le \frac{\sigma^2}{t^2}.
$$

### 10.3 체르노프(이항 합 \(S_n\sim\sum \mathrm{Bern}(p)\))
$$
P(S_n\ge (1+\delta)np)\le \Big(\frac{e^\delta}{(1+\delta)^{1+\delta}}\Big)^{np}.
$$
→ 대수적으로 빠르게 감소. A/B 테스트에서 **거짓 양성 제어**에 유용.

---

## 11. 대수의 법칙(LLN)·중심극한정리(CLT) — 이산 맥락

- **약한 LLN**: 독립 동분포 \(X_i\), 평균 \(\mu\). 표본평균 \(\bar{X}_n\)은 확률수렴 \(\mu\).
  $$
  \bar{X}_n=\frac{1}{n}\sum_{i=1}^n X_i \xrightarrow{P} \mu.
  $$
- **CLT**: 분산 \(\sigma^2<\infty\). 정규화 합이 표준정규로 수렴.
  $$
  \frac{\sum(X_i-\mu)}{\sigma\sqrt{n}}\Rightarrow \mathcal{N}(0,1).
  $$
→ \(\mathrm{Bin}(n,p)\)의 정규근사 정당화.

---

## 12. 실전 시뮬레이션 — 파이썬

> **주의**: 아래 코드는 교육용. 큰 \(n\)은 정확도·성능을 고려해 SciPy 등을 권장.

### 12.1 분포 샘플링 유틸

```python
import random, math
from collections import Counter

def sample_bernoulli(p, trials=10000):
    return [1 if random.random()<p else 0 for _ in range(trials)]

def sample_binomial(n,p,trials=10000):
    out=[]
    for _ in range(trials):
        s=0
        for _ in range(n):
            s+= 1 if random.random()<p else 0
        out.append(s)
    return out

def pmf_from_samples(samples):
    c=Counter(samples)
    total=len(samples)
    return {k:v/total for k,v in sorted(c.items())}
```

### 12.2 이항 vs 포아송 근사 검증(\(n=1000,p=0.004,\lambda=4\))

```python
def pois_pmf(lam, k):
    return math.exp(-lam)*(lam**k)/math.factorial(k)

samps = sample_binomial(1000,0.004, trials=200000)
emp = pmf_from_samples(samps)

lam = 1000*0.004
ks = range(0,15)
print("k  Empirical   Poisson")
for k in ks:
    print(k, round(emp.get(k,0.0),4), round(pois_pmf(lam,k),4))
```

### 12.3 기하 분포 무기억성 체크(시뮬)

```python
def geom_sample(p):
    k=1
    while random.random()>=p:
        k+=1
    return k

def prob_ge_given_ge(p, s, t, trials=200000):
    # P(X >= s+t | X >= s) ≈ ?
    cntA=cntB=0
    for _ in range(trials):
        x=geom_sample(p)
        if x>=s:
            cntB+=1
            if x>=s+t:
                cntA+=1
    return cntA/cntB

print(prob_ge_given_ge(0.3, 5, 7))
print(prob_ge_given_ge(0.3, 5, 7), "vs", (1-0.3)**7)
```

### 12.4 쿠폰 수집 기대값 비교

```python
def harmonic(n):
    return sum(1/i for i in range(1,n+1))

for m in [10,30,100]:
    sim=coupon_trials(m, reps=400)
    theo=m*harmonic(m)
    print(f"m={m}: sim={sim:.2f}, theory={theo:.2f}")
```

### 12.5 A/B 클릭 이항검정(베이즈 아닌 빈도 관점도 참고)
> 여기선 **이산 확률** 맥락에 맞춰 **이항 누적** 비교(정규근사)도 함께 보여줍니다.

```python
def binom_p_ge(n,p, k):
    # P(X >= k) by normal approximation with continuity correction
    mu, sigma = n*p, math.sqrt(n*p*(1-p))
    z = (k-0.5 - mu)/sigma
    # Phi tail
    def Phi(x):
        # Abramowitz-Stegun approx
        t=1/(1+0.2316419*abs(x))
        d=0.3989423*math.exp(-x*x/2)
        p=d*(1.330274*t - 1.821256*t**2 + 1.781478*t**3 - 0.356538*t**4 + 0.3193815*t**5)
        return 1-p if x>0 else p
    return Phi(-z)

print(binom_p_ge(2000,0.05, 120))
```

---

## 13. 실전 팁·체크리스트(문제 해결 루틴)

1) **모형화**: 등확률인가? 복원/비복원? 독립인가?
2) **사건 정의**: 세고 싶은 사건을 명확히 집합으로 정의.
3) **조합법**: 합/곱/순열/조합/중복조합/초기하 중 무엇?
4) **조건부 분해**: 전확률·베이즈로 분할해 단순화.
5) **지시변수**: “개수의 기대값”은 \(\sum E[I_i]\)로.
6) **근사**: 큰 \(n\)엔 정규, 작은 \(p\cdot n\)엔 포아송.
7) **상계**: 마르코프/체베셰프/체르노프로 안정적 결론.
8) **검증**: 간단한 코딩으로 몬테카를로 확인.
9) **엣지**: 쌍 독립 vs 상호 독립, 표본공간 오해(무등확률) 주의.
10) **단위 해석**: 기대값·분산 단위, 사건 확률의 직관 점검.

---

## 14. 연습 문제(해설 스케치 포함)

1) **초기하**: 카드 52장(조커 없음)에서 5장. **하트**가 정확히 2장일 확률?
   $$
   \frac{\binom{13}{2}\binom{39}{3}}{\binom{52}{5}}.
   $$

2) **기하**: 성공확률 \(p\) 게임에서 1등 할 때까지의 시도 수 \(X\). **무기억성**을 식으로 증명.
   $$
   P(X>s+t\mid X>s)=\frac{(1-p)^{s+t-1}}{(1-p)^{s-1}}=(1-p)^t=P(X>t).
   $$

3) **이항**: \(X\sim \mathrm{Bin}(n,p)\). **체르노프**로 \(P(X\ge (1+\delta)np)\) 상계를 쓰고, \(n=1000,p=0.02,\delta=1\) 대입 평가.

4) **포아송 근사**: \(\mathrm{Bin}(n,p)\)에서 \(np=\lambda\) 고정, \(n\to\infty, p\to 0\). \(k\) 고정 시 PMF가 포아송으로 수렴함을 대수 전개로 보이라.

5) **지시변수**: 6면체 주사위를 \(n\)번. “최소 한 번 6이 나올 사건”의 확률과 **기대 6의 개수**를 각각 계산하고 관계를 비교.
   - \(P(\text{at least one 6})=1-(5/6)^n\).
   - \(E[\#6]=n\cdot (1/6)\).

---

## 15. 요약(한 장)

- **등확률**: \(P(A)=|A|/|S|\).
- **조건부/전확률/베이즈**: 분해와 업데이트.
- **독립**: 곱공식, 쌍 vs 상호.
- **이산 변수**: PMF/CDF, \(E[X]\), \(\mathrm{Var}(X)\), 지시변수.
- **주요 분포**: Bern, Bin, Hypergeo, Geom, NegBin, Pois (+근사 관계).
- **합**: 컨볼루션, PGF 곱.
- **기법**: 포함배제, 지시변수, 생성함수.
- **고전 문제**: 생일·쿠폰·점유.
- **농도 부등식 & LLN/CLT**: 품질보증·근사 정당화.
- **시뮬레이션**: 모델 점검과 직관 강화.

---

## 부록) 간단 유틸: PMF → 기대값/분산

```python
def moments_from_pmf(pmf_dict):
    # pmf_dict: {x: p}
    ex = sum(x*p for x,p in pmf_dict.items())
    ex2 = sum((x**2)*p for x,p in pmf_dict.items())
    var = ex2 - ex**2
    return ex, var

print(moments_from_pmf({0:0.5, 1:0.5}))  # Bern(0.5) 예시
```

---

## 마무리

이산적 확률은 **경우의 수**와 **확률 법칙**을 연결하는 언어입니다.
문제를 보면 표본공간·사건을 먼저 세팅하고, **조건부 분해**와 **지시변수**로 단순화하세요.
필요하면 **포아송/정규 근사**로 빠르게 추정하고, 마지막은 **시뮬레이션**으로 감각을 다지면 실전에서도 강해집니다.
