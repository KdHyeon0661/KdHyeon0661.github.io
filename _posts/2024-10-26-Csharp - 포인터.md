---
layout: post
title: C# - ν¬μΈν„°
date: 2024-10-26 19:20:23 +0900
category: Csharp
---
# C# ν¬μΈν„° μ™„μ „ μ •λ¦¬ (unsafe, fixed, *, &, ->, IntPtr, Span<T> λ“±)

C#μ€ λ©”λ¨λ¦¬ μ•μ •μ„±κ³Ό μ•μ „μ„±μ„ μ§€ν–¥ν•λ” μ–Έμ–΄μ΄μ§€λ§, `unsafe` ν‚¤μ›λ“λ¥Ό μ‚¬μ©ν•λ©΄ C/C++μ²λΌ **ν¬μΈν„°(pointer)**λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤.  
μ΄ κΈ€μ—μ„λ” C# ν¬μΈν„°μ κ°λ…λ¶€ν„° λ¬Έλ²•, μ£Όμμ‚¬ν•­, λ€μ²΄ κΈ°μ λ“¤κΉμ§€ **μ΄λ§λΌ**ν•©λ‹λ‹¤.

---

## π”· 1. ν¬μΈν„°λ€?

**ν¬μΈν„°(pointer)**λ” **λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό μ €μ¥ν•λ” λ³€μ**μ…λ‹λ‹¤.  
λ‹¤λ¥Έ λ³€μμ μ£Όμ†λ¥Ό μ €μ¥ν•κ³ , κ·Έ μ£Όμ†λ¥Ό ν†µν•΄ ν•΄λ‹Ή λ³€μμ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤.

---

## π”· 2. C#μ—μ„ ν¬μΈν„° μ‚¬μ© μ΅°κ±΄

C#μ—μ„λ” ν¬μΈν„° μ‚¬μ©μ΄ κΈ°λ³Έμ μΌλ΅ μ ν•λλ©°, λ‹¤μκ³Ό κ°™μ€ μ΅°κ±΄μ΄ ν•„μ”ν•©λ‹λ‹¤:

| μ΅°κ±΄ | μ„¤λ… |
|------|------|
| `unsafe` | ν¬μΈν„°λ¥Ό μ‚¬μ©ν•λ” λΈ”λ΅μ„ κ°μ |
| `/unsafe` | μ»΄νμΌλ¬μ—μ„ unsafe μ½”λ“ ν—μ© μ„¤μ • |
| κ°’ ν•μ‹λ§ ν—μ© | `int`, `float`, `char`, `struct` λ“±λ§ κ°€λ¥ |
| μ°Έμ΅°ν•μ—λ” μ‚¬μ© μ ν• | `class`, `string` λ“±μ€ μ§μ ‘ ν¬μΈν„° μ ‘κ·Ό λ¶κ°€ |

---

## π”· 3. κΈ°λ³Έ ν¬μΈν„° μ‚¬μ© μμ 

```csharp
using System;

class Program
{
    unsafe static void Main()
    {
        int a = 10;
        int* ptr = &a;

        Console.WriteLine($"κ°’: {*ptr}");       // μ—­μ°Έμ΅°
        Console.WriteLine($"μ£Όμ†: {(long)ptr}"); // ν¬μΈν„° μ£Όμ† μ¶λ ¥
    }
}
```

### μ„¤λ…:
- `int* ptr`: `int`ν• ν¬μΈν„° μ„ μ–Έ
- `&a`: λ³€μ aμ μ£Όμ†
- `*ptr`: ptrμ΄ κ°€λ¦¬ν‚¤λ” μ£Όμ†μ κ°’ (μ—­μ°Έμ΅°)

> β οΈ μ΄ μ½”λ“λ¥Ό μ‹¤ν–‰ν•λ ¤λ©΄ μ»΄νμΌ μ‹ `/unsafe` μµμ…μ΄ ν•„μ”ν•©λ‹λ‹¤.

---

## π”· 4. fixed ν‚¤μ›λ“ - μ°Έμ΅°ν• κ³ μ •

C#μ—μ„λ” λ°°μ—΄, λ¬Έμμ—΄ λ“± **μ°Έμ΅°ν• λ³€μμ μ£Όμ†λ¥Ό μ–»μΌλ ¤λ©΄ λ©”λ¨λ¦¬λ¥Ό κ³ μ •**ν•΄μ•Ό ν•©λ‹λ‹¤.  
GC(Garbage Collector)κ°€ λ©”λ¨λ¦¬λ¥Ό μ΄λ™μ‹ν‚¤μ§€ λ»ν•λ„λ΅ λ§‰κΈ° μ„ν•΄ `fixed` ν‚¤μ›λ“λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

```csharp
unsafe static void Main()
{
    int[] arr = { 10, 20, 30 };

    fixed (int* p = arr)
    {
        for (int i = 0; i < arr.Length; i++)
            Console.WriteLine(p[i]);
    }
}
```

- `fixed`λ” GCκ°€ arrλ¥Ό μ®κΈ°μ§€ μ•λ„λ΅ κ³ μ •
- ν¬μΈν„° `p`λ¥Ό ν†µν•΄ λ°°μ—΄ μ”μ† μ§μ ‘ μ ‘κ·Ό κ°€λ¥

---

## π”· 5. ν¬μΈν„° μ—°μ‚°

| μ—°μ‚° | μ„¤λ… | μμ‹ |
|------|------|------|
| `*ptr` | μ—­μ°Έμ΅° (ν¬μΈν„°κ°€ κ°€λ¦¬ν‚¤λ” κ°’) | `*ptr = 5;` |
| `&var` | μ£Όμ† | `int* p = &a;` |
| `ptr + n` | μ£Όμ† μ΄λ™ (nλ²μ§Έ μ”μ†) | `*(ptr + 2)` |
| `->` | κµ¬μ΅°μ²΄ λ©¤λ²„ μ ‘κ·Ό | `point->X` |

---

## π”· 6. κµ¬μ΅°μ²΄μ™€ ν¬μΈν„°

ν¬μΈν„°λ” **κµ¬μ΅°μ²΄(struct)**μ— μ£Όλ΅ μ‚¬μ©λ©λ‹λ‹¤.

```csharp
struct Point
{
    public int X;
    public int Y;
}

unsafe static void StructExample()
{
    Point p = new Point { X = 1, Y = 2 };
    Point* ptr = &p;

    Console.WriteLine(ptr->X); // 1
    Console.WriteLine(ptr->Y); // 2
}
```

---

## π”· 7. ν¬μΈν„° λ°°μ—΄

```csharp
unsafe static void PointerArray()
{
    int a = 1, b = 2;
    int*[] pointers = new int*[2];

    fixed (int* p1 = &a, p2 = &b)
    {
        pointers[0] = p1;
        pointers[1] = p2;

        Console.WriteLine(*pointers[0]); // 1
        Console.WriteLine(*pointers[1]); // 2
    }
}
```

- ν¬μΈν„°λ„ λ°°μ—΄λ΅ κ΄€λ¦¬ κ°€λ¥
- μ—¬λ¬ μ£Όμ†λ¥Ό μνν•κ±°λ‚ κ΄€λ¦¬ν•  λ• μ μ©

---

## π”· 8. IntPtr: ν¬μΈν„°λ¥Ό λ€μ²΄ν•λ” κµ¬μ΅°μ²΄

`IntPtr`μ€ ν¬μΈν„°λ¥Ό **ν¬μ¥ν• μ•μ „ν• κµ¬μ΅°μ²΄**λ΅, .NETμ—μ„ ν¬μΈν„° μ—°μ‚°μ„ ν•μ§€ μ•κ³  μ£Όμ†λ¥Ό μ €μ¥ν•κ±°λ‚ μ²λ¦¬ν•  λ• μ‚¬μ©λ©λ‹λ‹¤.

```csharp
IntPtr ptr = (IntPtr)123456;
Console.WriteLine(ptr.ToInt64()); // μ£Όμ† κ°’ μ¶λ ¥
```

> C#μ `Marshal` APIλ‚ Win32 API μ—°λ™ μ‹ μμ£Ό μ‚¬μ©

---

## π”· 9. Span<T> / Memory<T>: μ•μ „ν• ν¬μΈν„° λ€μ•

.NET Core μ΄ν›„μ—λ” `Span<T>`μ™€ `Memory<T>`λ¥Ό μ‚¬μ©ν•΄ ν¬μΈν„°μ²λΌ λ©”λ¨λ¦¬λ¥Ό **κ³ μ„±λ¥, μ•μ „ν•κ² λ‹¤λ£° μ μμµλ‹λ‹¤.**

```csharp
Span<byte> buffer = stackalloc byte[10];
buffer[0] = 42;
```

- `stackalloc`μΌλ΅ μ¤νƒμ— μ§μ ‘ λ©”λ¨λ¦¬ ν• λ‹Ή
- `Span<T>`λ” GC κ΄€λ¦¬ μ• λλ” λ©”λ¨λ¦¬ μ‚¬μ©μ„ μ•μ „ν•κ² κ°μ‹Έμ¤

| νƒ€μ… | μ„¤λ… |
|------|------|
| `Span<T>` | μ¤νƒ λ©”λ¨λ¦¬ μ°Έμ΅° (λΉ λ¦„) |
| `Memory<T>` | ν™ λ©”λ¨λ¦¬ μ°Έμ΅° (λΉ„λ™κΈ°, λ²„νΌ μ©λ„) |

---

## π”· 10. ν¬μΈν„° μ‚¬μ©ν•  λ• μ£Όμν•  μ 

- `unsafe` μ½”λ“λ” λ³΄μ• λ° μ•μ •μ„±μ— μ·¨μ•½
- κ°€λΉ„μ§€ μ»¬λ ‰ν„°κ°€ κ°μ…ν•  μ μ—†μΌλ―€λ΅ **λ©”λ¨λ¦¬ μ†μƒ κ°€λ¥**
- μΌλ°μ μΈ C# μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„λ” μ¶”μ²λμ§€ μ•μ
- ν¬μΈν„°λ” μ£Όλ΅:
  - λ„¤μ΄ν‹°λΈ APIμ™€μ μƒνΈμ‘μ©
  - μ΄λ―Έμ§€, λ²„νΌ, λΉ„νΈ μ—°μ‚° λ“± μ„±λ¥μ΄ μ¤‘μ”ν• κ²½μ°
  - `stackalloc`, `Span<T>`λ¥Ό ν†µν• λ€μ²΄ κ°€λ¥

---

## β… μ”μ•½ μ •λ¦¬

| ν•­λ© | μ„¤λ… |
|------|------|
| `unsafe` | ν¬μΈν„° μ‚¬μ© κ°€λ¥ μ½”λ“ λΈ”λ΅ |
| `*`, `&`, `->` | ν¬μΈν„° μ„ μ–Έ, μ£Όμ† μ—°μ‚°, λ©¤λ²„ μ ‘κ·Ό |
| `fixed` | μ°Έμ΅°ν• λ°μ΄ν„°μ μ£Όμ†λ¥Ό GCλ΅λ¶€ν„° κ³ μ • |
| `IntPtr` | ν¬μΈν„°λ¥Ό λ€μ²΄ν•λ” κµ¬μ΅°μ²΄ν• |
| `Span<T>` / `Memory<T>` | μ•μ „ν• ν¬μΈν„° λ€μ•, κ³ μ„±λ¥ λ©”λ¨λ¦¬ μ΅°μ‘ |
| ν¬μΈν„° μ‚¬μ© μ©λ„ | μ„±λ¥ μµμ ν™”, λ„¤μ΄ν‹°λΈ μ—°λ™, λ²„νΌ μ ‘κ·Ό λ“± |