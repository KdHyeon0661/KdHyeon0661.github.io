---
layout: post
title: 논리회로설계 - 클럭형 순서회로의 분석
date: 2025-09-08 17:25:23 +0900
category: 논리회로설계
---
# 클럭형 순서회로의 분석 — **순서 패리티 검사기**, **타이밍도·신호 추적**, **상태표·상태그래프**, **순서회로의 일반화 모델**

> 표기: \(x\)=입력, \(y\)=출력, \(q\)=상태(또는 상태벡터), \(q^+\)=다음 상태, \(\overline{X}\)=NOT \(X\), \(\oplus\)=XOR.  
> 기준: **동기식(클럭형) 순서회로**를 다룹니다. (플립플롭은 ↑에지 트리거 가정)

---

## 1) 순서 패리티 검사기(Sequence Parity Checker)

### 1.1 개념
- **목표**: 시퀀스 \(x[0],x[1],\dots\)의 누적 패리티(짝수/홀수)를 추적하여,  
  - **Moore형**: “지금까지의 데이터” 패리티를 항상 출력.  
  - **Mealy형**: “이번 입력을 반영한 즉시 결과”를 출력.
- 활용: 직렬 통신(짝수/홀수 패리티), 스트림 오류 검출, 러닝 XOR 체크.

### 1.2 최소 상태(2상태 FSM)
- 상태 \(E\): **짝수** 패리티, 상태 \(O\): **홀수** 패리티.
- 전이 규칙: 입력이 1이면 **토글**, 0이면 **유지**.
- **상태도(라벨은 `입력/출력`)**

Moore (출력=상태):
```
   x=1       x=1
E ───▶ O ───▶ E
│ x=0 ▲ x=0 │
▼     │     ▼
E     O     O

출력: y=0 at E, y=1 at O
```

Mealy (출력=입력/상태로 즉시):
```
E ──0/0──▶ E   E ──1/1──▶ O
O ──0/1──▶ O   O ──1/0──▶ E
```

### 1.3 수식/플립플롭 구현
- 상태 1비트 \(q\)가 현재 **홀수(1)/짝수(0)**를 표현하면:
  \[
  q^+ = q \oplus x
  \]
- **Moore 출력**: \(y=q\) (현재까지 누적).  
- **Mealy 출력**: \(y = q \oplus x\) (이번 입력 포함 즉시 결과).
- **T-FF** 구현: \(T=x\) (에지마다 \(x=1\)이면 토글).  
- **D-FF** 구현: \(D = q \oplus x\).

### 1.4 패킷 패리티 검사(끝에 패리티 비트 \(p\) 첨가)
- “짝수 패리티” 가정: 데이터 \(N\)비트 후 \(p\)가 붙음. **오류 조건**:
  \[
  \text{에러} = q_N \oplus p \quad(\text{Moore)} \qquad \text{또는}\qquad \text{에러} = (q \oplus p)\ \text{at }(p\text{ 사이클, Mealy})
  \]
- 구현 팁: **데이터 구간**엔 \(q^+=q\oplus x\), **패리티 구간**엔 에러 비교만 수행.

### 1.5 VHDL 스니펫(합성 가능)
```vhdl
-- Moore형 러닝 패리티(짝수=0, 홀수=1)
library ieee; use ieee.std_logic_1164.all;
entity parity_moore is
  port (clk, rst, x : in std_logic; y : out std_logic);
end;
architecture rtl of parity_moore is
  signal q : std_logic := '0'; -- 0: even, 1: odd
begin
  process(clk) begin
    if rising_edge(clk) then
      if rst='1' then q <= '0';
      else            q <= q xor x;
      end if;
    end if;
  end process;
  y <= q;
end;
```

---

## 2) **타이밍도와 신호 추적**을 통한 분석

### 2.1 절차(핵심 6단계)
1) **샘플 시점 지정**: 클럭의 유효 에지(예: 상승)에만 상태 변화.  
2) **초기 상태** \(q[0]\) 확정(문제에서 주어지지 않으면 0 또는 don’t-care→분기 분석).  
3) 각 에지 \(k\)에서 **다음 상태식** \(q^+=f(q,x)\) 평가.  
4) 동시에 **출력식** \(y=g(q)\) 또는 \(g(q,x)\) 평가.  
5) 결과를 **시퀀스 표**로 누적: \(k \mid x[k] \; q[k]\to q[k+1] \; y[k]\).  
6) 파형에 반영(ASCII 도식 또는 파형 뷰어).

### 2.2 예시 A — 패리티(Moore)
- 식: \(q^+=q\oplus x\), \(y=q\). 입력: `1 0 1 1 0`, 초기 \(q[0]=0\).
- 추적표:

| k | x | q → q^+ | y |
|:-:|:-:|:--:|:-:|
| 0 | 1 | 0→1 | 0 |
| 1 | 0 | 1→1 | 1 |
| 2 | 1 | 1→0 | 1 |
| 3 | 1 | 0→1 | 0 |
| 4 | 0 | 1→1 | 1 |

ASCII 타이밍(↑에지에서 샘플):
```
CLK: _/‾\_/‾\_/‾\_/‾\_/‾\_
x  : 1___0___1___1___0____
q  : 0---1---1---0---1-----
y  : 0---1---1---0---1-----  (Moore: y=q)
```

### 2.3 예시 B — 2비트 FSM 신호 추적
- 회로: 두 D-FF \(q_1,q_0\),
  \[
  \begin{aligned}
  q_1^+ &= \overline{q_1}\,x + q_0\\
  q_0^+ &= \overline{q_0}\,\overline{x} + q_1\,x\\
  y &= q_1
  \end{aligned}
  \]
- 입력열 `x`: `1 0 1 1 …`, 초기 \(q_1q_0=00\).  
- 에지마다 위 식으로 계산 → 상태/출력 시퀀스를 얻고, **상태표/그래프**로도 동일 결과를 확인(§3).

> 팁: 파형에서 **샘플 직전**의 \(x,q\)로 \(q^+\)를 계산하여 **샘플 직후**의 \(q\)로 기록.

---

## 3) **상태표와 상태그래프**

### 3.1 정의
- **상태표(State Table)**: 각 **현재 상태**와 **입력** 조합에 대해 **다음 상태**와 **출력**을 표로 나열.  
- **상태그래프(State Diagram)**: 상태=노드, 전이=간선.  
  - **Mealy**: 간선 라벨 `입력/출력`.  
  - **Moore**: 노드 라벨 `상태(출력)`.

### 3.2 도출법(회로→상태표)
1) 플립플롭 수 \(n\) 확인 → 상태 공간 \(2^n\).  
2) 다음 상태식 \(q^+=f(q,x)\) 평가하여 모든 조합의 **\(q^+\)** 채움.  
3) 출력식 \(y=g(q,x)\) 또는 \(g(q)\) 채움.  
4) (필요시) **불법 상태**에 대한 다음 상태 정의(락아웃 방지/self-start).

### 3.3 예시(패리티 FSM, Mealy)
- 상태 \(q\in\{E(0),O(1)\}\), 입력 \(x\in\{0,1\}\)

| 현재 | 입력 | 다음 | 출력 |
|:--:|:--:|:--:|:--:|
| E | 0 | E | 0 |
| E | 1 | O | 1 |
| O | 0 | O | 1 |
| O | 1 | E | 0 |

상태그래프(간선 라벨 `x/y`):
```
E --0/0--> E,  E --1/1--> O
O --0/1--> O,  O --1/0--> E
```

### 3.4 상태 최소화·부호화(개요)
- **상태 최소화**: **동치 상태** 병합(모든 입력에 대해 같은 출력/동작).  
- **부호화**: 이진/그레이/원-핫/존슨 등.  
  - 순서회로의 **해저드/속도/면적**에 영향 → 인코딩 선택이 중요.

---

## 4) 순서회로의 **일반화 모델**

### 4.1 수학적 FSM (클럭형)
- 집합 \(X\): 입력, \(S\): 상태, \(Z\): 출력.  
- **Mealy**: \(\delta: S\times X \to S,\; \lambda: S\times X \to Z\)  
- **Moore**: \(\delta: S\times X \to S,\; \lambda: S \to Z\)
- 이산시간 \(k=0,1,2,\dots\):  
  \[
  s[k+1]=\delta(s[k],x[k]),\quad
  \begin{cases}
  y[k]=\lambda(s[k],x[k]) & (\text{Mealy})\\
  y[k]=\lambda(s[k])      & (\text{Moore})
  \end{cases}
  \]

### 4.2 레지스터-로직 분해(하드웨어 관점)
- 상태벡터 \(q\in\{0,1\}^n\) (플립플롭 묶음).  
- **상태방정식**:
  \[
  q[k+1]=F(q[k],x[k]),\quad y[k]=G(q[k],x[k])\ \text{or}\ G(q[k])
  \]
- 구성:
  1) **상태 레지스터**(FF)  
  2) **다음상태 조합 로직** \(F\)  
  3) **출력 조합 로직** \(G\)  
- **동기 설계 규칙**: 모든 피드백은 **레지스터를 통해서만**, 조합 루프 금지.

### 4.3 초기화/리셋과 안정성
- 초기 상태 \(q[0]\)는 **리셋 회로**로 설정.  
- **Self-start**: 불법 상태에서도 합법 루프로 **수렴**하도록 \(F\)를 설계.

---

## 5) **완전 예제** — 회로→상태표→그래프→타이밍 추적

### 5.1 문제(2 D-FF, 입력 1개)
\[
\begin{aligned}
q_1^+ &= \overline{q_1}\,x + q_0\\
q_0^+ &= \overline{q_0}\,\overline{x} + q_1\,x\\
y &= q_1 \oplus q_0
\end{aligned}
\]

### 5.2 상태표(현재 \(q_1q_0\), 입력 \(x\))
| \(q_1q_0\) | x | \(q_1^+q_0^+\) | y |
|:--:|:--:|:--:|:--:|
| 00 | 0 | 00 | 0 |
| 00 | 1 | 01 | 0 |
| 01 | 0 | 00 | 1 |
| 01 | 1 | 11 | 1 |
| 10 | 0 | 10 | 1 |
| 10 | 1 | 01 | 1 |
| 11 | 0 | 10 | 0 |
| 11 | 1 | 11 | 0 |

### 5.3 상태그래프(간선 `x/y`)
```
00 --0/0--> 00, 00 --1/0--> 01
01 --0/1--> 00, 01 --1/1--> 11
10 --0/1--> 10, 10 --1/1--> 01
11 --0/0--> 10, 11 --1/0--> 11
```

### 5.4 신호 추적(입력열 1,0,1,1…, 초기 00)
| k | x | q → q^+ | y |
|:-:|:-:|:--:|:-:|
| 0 | 1 | 00→01 | 0 |
| 1 | 0 | 01→00 | 1 |
| 2 | 1 | 00→01 | 0 |
| 3 | 1 | 01→11 | 1 |
| 4 | 0 | 11→10 | 0 |
| … | … | … | … |

---

## 6) 분석·설계 **체크리스트**

- [ ] **클럭 에지**에서만 상태가 변한다는 전제를 지켰는가?  
- [ ] **다음상태식**과 **출력식**을 명확히 분리했는가(특히 Mealy/Moore 구분)?  
- [ ] **상태표**를 입력 전체 도메인에 대해 완전하게 채웠는가(불법 상태 포함)?  
- [ ] **Self-start/lockout**: 모든 상태에서 합법 루프로 수렴하는가?  
- [ ] **인코딩 선택**(이진/그레이/원-핫)이 로직 복잡도/해저드에 적합한가?  
- [ ] 타이밍도 추적 시 **샘플 직전 값**으로 \(q^+\)를 계산했는가?  
- [ ] (실무) 비동기 리셋은 **해제**를 클럭에 **동기화**했는가?

---

## 7) 연습문제(원하면 해설 제공)

1) 길이-제한 스트림에서 마지막 비트가 들어오면 **짝수 패리티 OK면 1을 1클럭 동안만 출력**하는 Mealy FSM을 설계하고 상태표/그래프/식 도출.  
2) §5의 FSM에 대해 **상태 최소화**가 가능한지 판단하고, 그레이 인코딩 적용 시 다음상태/출력식을 다시 써라.  
3) 입력이 `1011` 패턴이 끝날 때마다 `1`을 1클럭 출력하는 검출기(Mealy)를 상태표→그래프→타이밍도로 분석.  
4) 불법 상태에서 **가장 가까운 합법 상태**로 귀결되도록 self-start 규칙을 설계하고 K-map으로 최소화.

---

### 포켓 요약
- **패리티 FSM**: \(q^+=q\oplus x\). Moore \(y=q\), Mealy \(y=q\oplus x\).  
- **타이밍 추적**: 에지마다 \(f(q,x)\)로 \(q^+\) 계산→표와 파형으로 검증.  
- **상태표/그래프**: Mealy(간선 `x/y`), Moore(노드 `상태/출력`).  
- **일반화 모델**: \(q^+=F(q,x),\; y=G(q,x)\) 또는 \(G(q)\). 레지스터 + 조합 로직 분해로 바라보면 분석이 단순해진다.
