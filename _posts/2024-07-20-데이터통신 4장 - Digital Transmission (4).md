---
layout: post
title: 데이터 통신 4장 - Digital Transmission (4)
date: 2024-07-20 19:20:23 +0900
category: DataCommunication
---
# 4.2 Analog-to-Digital Conversion

## 4.2.1 Pulse Code Modulation (PCM, 펄스 부호 변조) 개요

PCM은 **아날로그 파형을 디지털 비트열로 바꾸는 정석 파이프라인**입니다. 단계는 다음 3가지입니다.

1) **Sampling(샘플링)** — 연속시간 신호 \(x(t)\)를 일정 간격 \(T_s\)로 찍어 \(x[n]=x(nT_s)\).
2) **Quantization(양자화)** — 연속 진폭을 유한 개 **레벨** 중 하나로 근사.
3) **Encoding(부호화)** — 각 레벨을 **이진 코드**로 표현해 비트스트림 생성.

이후 전송계층에서는 **라인 코딩(예: NRZ-I, Manchester, 4B/5B+NRZ-I, 8b/10b 등)** 및(또는) **스크램블링**과 결합됩니다.

---

## 4.2.1.1 Sampling (샘플링)

### 정의와 표기
- **샘플링 주기**: \(T_s\)
- **샘플링 주파수**: \(f_s=\dfrac{1}{T_s}\)

### 나이퀴스트 샘플링 정리
**대역제한 아날로그 신호** \(x(t)\)가 **최대 유효 주파수** \(f_\text{high}\) (또는 대역폭 \(B\))를 가질 때,
\[
f_s \ge 2\,f_\text{high}\quad(\text{또는 } f_s \ge 2B)
\]
이면 **이론적으로 완전 복원**이 가능합니다(이상적 **sinc 저역통과 필터** 가정). 이를 **나이퀴스트율**이라 부릅니다.

- **설계 팁**
  - 샘플링 전 **안티-앨리어싱(anti-aliasing) 아날로그 저역통과 필터**로 \(f_\text{high}\) 이상을 감쇠.
  - 실무는 여유를 두고 \(f_s = k\cdot 2B\) (\(k>1\), 예: 44.1 kHz/48 kHz/96 kHz 오디오).
  - 통신 수신기에서는 **채널 등가 저역필터** + **동기 샘플링**으로 ISI/잡음 영향을 최소화.

### 예시
- **POTS 음성**(전화): 대역 약 \(B \approx 3.4\ \text{kHz}\) → \(f_s = 8\ \text{kHz}\)가 전통적 표준.
- **오디오**: 인간가청 20 kHz → CD는 44.1 kHz(여유·필터 설계 절충).

---

## 4.2.1.2 Quantization (양자화)

### 균일 양자화(Uniform Quantization)
아날로그 입력이 \([V_\min,V_\max]\) 범위를 가진다고 가정하고, **레벨 수** \(L=2^n\) (n=샘플당 비트수)로 균등 분할:
\[
\Delta=\frac{V_\max - V_\min}{L}
\]
각 샘플을 가장 가까운 **대표값**으로 반올림합니다(중간-트레드/중간-라이즈 등 구현 차이 존재).

- **양자화 잡음(오차)** \(e_q\): 이상적 가정에서 \((-{\Delta}/{2},{\Delta}/{2})\) **균일 분포**
  \[
  \mathbb{E}[e_q]=0,\qquad \mathbb{E}[e_q^2]=\frac{\Delta^2}{12}
  \]
- **정규화/클리핑**: 입력이 \([V_\min,V_\max]\) 바깥이면 **클리핑** → 큰 왜곡. AGC/노멀라이즈로 방지.

### 비균일 양자화(Non-uniform)와 컴팬딩(Companding)
음성처럼 **작은 진폭 구간에서 SNR이 더 중요**할 때, **레벨 간격을 비균일**하게 주어 **작은 신호 정밀도 향상**. 실무는 **컴팬더(압신) + 균일 양자화** 조합을 씁니다.

- **\(\mu\)-law (미국/일본)**:
  \[
  F(x) = \operatorname{sgn}(x)\cdot\frac{\ln\!\big(1+\mu\,|x|\big)}{\ln(1+\mu)},\quad \mu=255
  \]
- **A-law (유럽)**:
  \[
  F(x)=
  \begin{cases}
  \operatorname{sgn}(x)\cdot\frac{A|x|}{1+\ln A}, & 0\le |x|<\frac{1}{A}\\[4pt]
  \operatorname{sgn}(x)\cdot\frac{1+\ln (A|x|)}{1+\ln A}, & \frac{1}{A}\le |x|\le 1
  \end{cases}
  \]
  (일반적으로 \(A=87.6\))
  전송 전 **압신(Compress)**, 수신 후 **신신(Expand)** 하여 전체 SNR 체감 개선.

---

## 4.2.1.3 Encoding (부호화)

- **샘플당 \(n\)비트** → **레벨 수** \(L=2^n\)
- 한 샘플을 나타내는 \(n\)비트를 **PCM word**라 합니다(전통 음성 PCM은 \(n=8\) 비트).
- **비트율**:
\[
\text{bit rate}\ N = f_s \times n
\]
- 예: **POTS**: \(f_s=8\ \text{kHz},\ n=8\) → \(N=64\ \text{kbps}\) (**DS0**).

---

## 4.2.1.4 PCM의 대역폭, 비트율, 성능

### 최소 필요 대역폭(저역통과 채널에 \(L\)레벨 신호 요소 사용 시)
\[
B_{\min} = \frac{N}{2\log_2 L}\ \text{(Hz)}
\]
- \(N\): 비트율(bps)
- \(L\): 라인 심볼 레벨 수(예: NRZ는 \(L=2\), PAM-4는 \(L=4\))

> 라인 코딩/펄스 모양/필터에 따라 상수 계수가 붙습니다. 위 식은 **이론적 저하한계**로 이해하세요.

### 샤논 용량(잡음 채널)
채널 대역폭 \(B\), 평균 **SNR**이면 **이론적 용량**:
\[
C = B\log_2(1+\text{SNR})\ \text{(bps)}
\]
→ 실무 비트율 \(N\)은 항상 \(C\) 이하로 잡아야 안정 전송 가능.

### 양자화 SNR (SQNR)
입력 정현파 \(x(t)=A\sin(\cdot)\)의 평균 전력 \(P_s=\dfrac{A^2}{2}\), 균일 양자화 잡음 전력 \(P_q=\dfrac{\Delta^2}{12}\)일 때,
\[
\mathrm{SQNR} = 10\log_{10}\!\frac{P_s}{P_q} \approx 6.02\,n + 1.76\ \text{dB}
\]
- \(n\)이 1비트 늘 때마다 약 **6 dB** 개선.
- 컴팬딩 적용 시 **소신호 영역 체감 SNR**이 더 좋아짐.

---

## 4.2.1.5 PCM 복원(디코딩)과 필터링

- 수신부는 비트열 → **레벨값** 재구성 → **DAC** → **저역통과 복원필터**(이상적이면 sinc)로 **연속파형**을 얻습니다.
- 실무는 **펄스 셰이핑/매칭필터**(예: **root-raised-cosine**)로 ISI와 대역을 제어.

---

## 4.2.1.6 예제 계산

### 예제 1 — 음성 PCM(8 kHz, 8 bit)
- \(f_s = 8\ \text{kHz},\ n=8 \Rightarrow N=64\ \text{kbps}\)
- 라인 코딩을 **BPSK/NRZ(2레벨)** 가정 시:
  \[
  B_{\min} = \frac{N}{2\log_2 2} = \frac{64\ \text{kbps}}{2} = 32\ \text{kHz}
  \]
  (실제 대역은 필터/코딩 상수로 더 커짐)

### 예제 2 — 측정 시스템 설계
- 측정 신호 대역 \(B=20\ \text{kHz}\), 목표 **SQNR ≥ 72 dB**.
- 샘플링: \(f_s \ge 40\ \text{kHz}\), 여유로 \(f_s=100\ \text{kHz}\).
- \(6.02n+1.76 \ge 72 \Rightarrow n \ge 12\) → **12비트 ADC** 채택.
- 비트율 \(N=f_s n = 1.2\ \text{Mbps}\).
- PAM-4(4레벨, \(\log_2 L=2\)) 라인이라면 \(B_\min \approx N/(2\cdot 2)=300\ \text{kHz}\) (근사).

---

## 4.2.1.7 파이썬 예제 — PCM 인코딩/디코딩·SQNR 측정

> 교육 목적으로 단순화된 예제입니다(안티-앨리어싱/복원필터 이상화).

```python
import numpy as np

def pcm_encode(x, bits=8, vmin=-1.0, vmax=+1.0):
    # 클리핑
    x = np.clip(x, vmin, vmax)
    L = 2**bits
    # 균일 양자화
    q = np.round((x - vmin) / (vmax - vmin) * (L-1))  # [0, L-1]
    q = q.astype(int)
    return q  # 정수 레벨(부호화 전)

def pcm_decode(q, bits=8, vmin=-1.0, vmax=+1.0):
    L = 2**bits
    # 역정규화: 대표값(센터)을 쓰려면 약간의 보정 가능
    xhat = q / (L-1) * (vmax - vmin) + vmin
    return xhat

def sqnr_db(x, xhat):
    Ps = np.mean(x**2)
    Pq = np.mean((x - xhat)**2)
    return 10*np.log10(Ps / Pq)

# 테스트: 1 kHz 사인, fs=48 kHz, 8/12/16비트 비교
fs = 48000
t = np.arange(0, 0.1, 1/fs)
x = 0.95*np.sin(2*np.pi*1000*t)  # 약간 여유

for bits in [8, 12, 16]:
    q  = pcm_encode(x, bits=bits)
    xr = pcm_decode(q, bits=bits)
    print(bits, "bits SQNR(dB) ~", round(sqnr_db(x, xr), 2))
```

---

## 4.2.1.8 설계 체크리스트 (현업 관점)

1) **대역(B)** 파악 → **안티-앨리어싱** 필터 차수/컷오프 설계.
2) **샘플링율** \(f_s \ge 2B\) + 여유; **PLL/클럭 품질**(지터) 고려.
3) **분해능 \(n\)**: 목표 **SQNR** 및 **양자화 잡음** 요구로 산정(대략 6 dB/bit).
4) **입력 다이내믹레인지/AGC/클리핑 마진** 설정.
5) **컴팬딩(\(\mu\)-law/A-law)** 필요 여부(음성 등).
6) **부호화 비트율 \(N=f_s n\)** → **라인 코딩/블록코딩/스크램블** 선택:
   - 동기화(CDR), DC 균형, 제어 심볼 필요, EMI/대역 규제, 구현 복잡도.
7) **채널 용량/잡음**: 샤논 \(C=B\log_2(1+\mathrm{SNR})\) 대비 여유 확보.
8) **복원**: DAC/재구성 필터(충분한 스톱밴드 감쇠, 그룹지연 평탄성).
9) **프레이밍/TDM**(예: T1/E1) 및 상위 프로토콜 인터페이스.
10) **시험**: 톤/멀티톤/PN 시퀀스, EVM/SNDR/THD+N, BER, 지터/위상잡음.

---

## 4.2.1.9 추가 주제 (요약)

- **오버샘플링/노이즈 셰이핑(ΣΔ ADC)**: 낮은 아날로그 정확도 + 높은 디지털 필터링으로 고유효비트수 달성.
- **펄스 셰이핑**: RRC 필터 등으로 **대역 제한**과 **ISI 최소화** 동시 달성.
- **프레임/동기**: PCM 스트림(TDM)에서는 **프레임 동기 비트**/멀티프레임 구조가 필수.

---

## 4.2.1.10 공식 정리와 상호작용

### 샘플링/비트율
\[
N = f_s \cdot n,\qquad f_s \ge 2B
\]

### 균일 양자화
\[
L=2^n,\quad \Delta=\frac{V_\max-V_\min}{L},\quad \mathbb{E}[e_q^2]=\frac{\Delta^2}{12}
\]

### SQNR(정현파 근사)
\[
\mathrm{SQNR}\ \approx\ 6.02n + 1.76\ \text{dB}
\]

### 샤논 용량
\[
C = B\log_2(1+\mathrm{SNR})
\]

### 나이퀴스트(레벨 \(L\) 사용 저역통과 채널의 이론 최대 비트율)
\[
N_{\max} = 2B \log_2 L
\]

### 최소 필요 대역폭(역정리)
\[
B_{\min} = \frac{N}{2\log_2 L}\ (\text{Hz})
\]

> 실무 대역은 **라인코딩 상수 \(c\)**, **심볼당 비트수 \(r=\log_2 L\)**, **필터 롤오프**에 따라
> \(B \approx c\cdot \dfrac{N}{r}\) 형태로 설계됩니다(예: 4B/5B+NRZ-I, MLT-3, 8b/10b 등).

---

## 4.2.1.11 미니 시나리오

### 시나리오 A — 20 kHz 센서 신호 원격 전송
- 목표: **복원 가능한 PCM**, **SQNR ≥ 60 dB**, 대역 최소화.
- 선택: \(f_s=48\ \text{kHz}\), \(n=10\) (약 61.96 dB).
- \(N=480\ \text{kbps}\). PAM-4 라인(\(L=4\))이면 \(B_{\min}\approx 480\text{k}/(2\cdot 2)=120\ \text{kHz}\).
- 여기에 필터/롤오프/오버헤드(프레이밍/블록코딩) 고려.

### 시나리오 B — 음성 TDM(24채널, DS1/T1 스타일)
- 채널당 64 kbps, 24채널 → 1.536 Mbps(+ 프레이밍 오버헤드 → 1.544 Mbps).
- 라인 코딩은 **AMI+B8ZS**로 긴 0 런 해소, DC 균형/동기확보.

---

## 4.2.1.12 체크 문제

1) 나이퀴스트 정리가 요구하는 **최소 샘플링율**과 **안티-앨리어싱**의 역할을 설명하라.
2) 균일 양자화에서 **스텝 \(\Delta\)** 를 절반으로 줄이면 **SQNR**은 몇 dB 개선되는가?
3) **\(\mu\)-law/A-law 컴팬딩**의 목적과 효과를 요약하라.
4) **샤논 용량**과 **나이퀴스트 한계**를 함께 사용해, 잡음 있는 채널에서 가능한 **비트율/레벨**을 정하는 절차를 설명하라.
5) **POTS(8 kHz, 8 bit)**의 **비트율**과 이상적 **최소 대역폭**을 계산하라.

---

## 4.2.1.13 핵심 요약

- **PCM=샘플링→양자화→부호화**. \(f_s\ge 2B\), \(L=2^n\), \(N=f_s n\).
- **균일 양자화**의 잡음전력 \(\Delta^2/12\), **SQNR \(\approx 6.02n+1.76\) dB**.
- **컴팬딩**(\(\mu\)-law/A-law)으로 **소신호 SNR 체감 개선**(음성).
- **라인 대역**은 **라인코딩/펄스/필터**에 좌우되며, 이론 하한은 \(B_{\min}=N/(2\log_2 L)\).
- **샤논 \(C = B\log_2(1+\mathrm{SNR})\)**로 **잡음 채널의 절대 한계** 확인.
- 실무는 **AGC/필터/프레이밍/라인코딩/스크램블**을 **통합 최적화**한다.
