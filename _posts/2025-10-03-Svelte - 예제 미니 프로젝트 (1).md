---
layout: post
title: Svelte - ì˜ˆì œ ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ (1)
date: 2025-10-03 22:30:23 +0900
category: Svelte
---
# 16. ì‹¤ì „ ì˜ˆì œ ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ (1) â€” **ToDo/ë…¸íŠ¸ ì•±**
**ìŠ¤í† ì–´ Â· í¼ ì•¡ì…˜ Â· ê²€ì¦ Â· ë‚™ê´€ì  UI Â· ì ‘ê·¼ì„± Â· ìºì‹± Â· ë°°í¬ê¹Œì§€ í•œ ë²ˆì—**

> ëª©í‘œ: â€œí˜„ì‹¤ì—ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ”â€ **SvelteKit** ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•œë‹¤.
> - **ìŠ¤í† ì–´**(writable/derived)ë¡œ ì „ì—­/ë¡œì»¬ ìƒíƒœ ì¡°ì§
> - **í¼ ì•¡ì…˜(actions)**ìœ¼ë¡œ ì„œë²„ ìš°ì„ (SSR) + ì ì§„ì  í–¥ìƒ(`use:enhance`)
> - **Zod** ì´ì¤‘ ê²€ì¦(í´ë¼ ì¦‰ì‹œ í”¼ë“œë°± + ì„œë²„ ìµœì¢… ê²€ì¦)
> - **ë‚™ê´€ì  UI**, **ì˜¤ë¥˜/ì¶©ëŒ ì²˜ë¦¬**, **ì ‘ê·¼ì„±(A11y)**, **ì„±ëŠ¥**
> - **ì˜µì…˜ ì €ì¥ì†Œ**: â‘  ë©”ëª¨ë¦¬/LocalStorage, â‘¡ íŒŒì¼/SQLite, â‘¢ Prisma(Postgres)

---

## 16.0 í”„ë¡œì íŠ¸ ê°œìš”

### ê¸°ëŠ¥ ìš”ì•½
1) **ToDo**: ì¶”ê°€/ì™„ë£Œ/ì‚­ì œ/í•„í„°, ìˆœì„œ ë³€ê²½(ì„ íƒ)
2) **ë…¸íŠ¸**: ë§ˆí¬ë‹¤ìš´ í¸ì§‘/ë¯¸ë¦¬ë³´ê¸°, íƒœê·¸, ë¹ ë¥¸ ê²€ìƒ‰
3) **í”„ë¡œí•„**: ì‚¬ìš©ì ì´ë¦„/í…Œë§ˆ(ë¼ì´íŠ¸/ë‹¤í¬)
4) **ì˜¤í”„ë¼ì¸ ì¹œí™”**: ì…ë ¥ ìœ ì§€, ë‚™ê´€ì  ì¶”ê°€ â†’ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
5) **ì ‘ê·¼ì„±**: ìŠ¤í‚µ ë§í¬, í¬ì»¤ìŠ¤ íŠ¸ë©, ë¼ì´ë¸Œ ì•Œë¦¼

### ê¸°ìˆ  ìŠ¤íƒ
- **SvelteKit** (ë¼ìš°íŒ…/ì•¡ì…˜/SSR)
- **@sveltejs/kit** forms enhance
- **Zod** ê²€ì¦
- **ìŠ¤í† ì–´**: `writable`, `derived`
- **(ì˜µì…˜)** ì„œë²„ ì €ì¥: Node ì–´ëŒ‘í„° + Prisma(Postgres)

---

## 16.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/
  lib/
    schema/
      todo.ts
      note.ts
    stores/
      ui.ts
      todos.ts
      notes.ts
    components/
      AddTodo.svelte
      TodoItem.svelte
      Filters.svelte
      Toast.svelte
      NoteEditor.svelte
      SearchInput.svelte
    utils/
      a11y.ts
      http.ts
  routes/
    +layout.svelte
    +layout.server.ts
    +page.svelte
    todos/
      +page.svelte
      +page.server.ts
      +page.ts
      +server.ts           # REST-ish API (GET/POST)
      [id]/
        +server.ts         # GET/PATCH/DELETE
    notes/
      +page.svelte
      +page.server.ts
      +server.ts
      [id]/
        +page.svelte
        +page.server.ts
        +server.ts
    profile/
      +page.svelte
      +page.server.ts
    api/
      search/+server.ts
```

> ë¼ìš°íŠ¸ë³„ë¡œ **í˜ì´ì§€(`+page.svelte`), ë°ì´í„° ë¡œë“œ(`+page.ts/.server.ts`), ì•¡ì…˜(`actions`), ì—”ë“œí¬ì¸íŠ¸(`+server.ts`)** ë¥¼ ë¶„ë¦¬í•œë‹¤.

---

## 16.2 ìŠ¤í‚¤ë§ˆ(ê²€ì¦) â€” Zod

```ts
// src/lib/schema/todo.ts
import { z } from 'zod';

export const TodoCreate = z.object({
  title: z.string().min(1, 'ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤').max(140, '140ì ì´ë‚´'),
});

export const TodoPatch = z.object({
  title: z.string().min(1).max(140).optional(),
  done: z.boolean().optional(),
  // ë‚™ê´€ì  ë½(ë²„ì „)
  version: z.number().int().positive()
});

export type TodoCreateInput = z.infer<typeof TodoCreate>;
export type TodoPatchInput  = z.infer<typeof TodoPatch>;
```

```ts
// src/lib/schema/note.ts
import { z } from 'zod';

export const NoteCreate = z.object({
  title: z.string().min(1, 'ì œëª© í•„ìˆ˜'),
  content: z.string().default(''),
  tags: z.string().transform(s => s.split(',').map(t=>t.trim()).filter(Boolean)).optional()
});

export const NotePatch = z.object({
  title: z.string().min(1).optional(),
  content: z.string().optional(),
  tags: z.array(z.string()).optional(),
  version: z.number().int().positive()
});
```

---

## 16.3 ê³µí†µ ìœ í‹¸ â€” HTTP/í¬ë§·/A11y

```ts
// src/lib/utils/http.ts
export const json = (data: any, init: ResponseInit = {}) =>
  new Response(JSON.stringify(data), { ...init, headers: { 'content-type': 'application/json', ...(init.headers||{}) } });

export const bad = (errors: unknown, code = 400) => json({ errors }, { status: code });
```

```ts
// src/lib/utils/a11y.ts
export function focusFirstInvalid() {
  const el = document.querySelector('[aria-invalid="true"]') as HTMLElement | null;
  el?.focus();
}
```

---

## 16.4 ìŠ¤í† ì–´ â€” ì „ì—­ UI/ë°ì´í„°

```ts
// src/lib/stores/ui.ts
import { writable } from 'svelte/store';

export const theme = writable<'light'|'dark'>('light');
export const toast = writable<{ type:'success'|'error'; msg:string } | null>(null);

export function showToast(type: 'success'|'error', msg: string, ms = 2000) {
  toast.set({ type, msg });
  setTimeout(()=>toast.set(null), ms);
}
```

```ts
// src/lib/stores/todos.ts
import { writable, derived, get } from 'svelte/store';
export type Todo = { id:string; title:string; done:boolean; version:number; createdAt:number };

function createTodos() {
  const { subscribe, set, update } = writable<Todo[]>([]);
  const add = (t: Todo) => update(list => [t, ...list]);
  const remove = (id: string) => update(list => list.filter(x => x.id !== id));
  const patch = (id: string, changes: Partial<Todo>) => update(list => list.map(x => x.id === id ? { ...x, ...changes } : x));
  const reset = (items: Todo[]) => set(items);
  return { subscribe, add, remove, patch, reset };
}
export const todos = createTodos();

export const remaining = derived(todos, $t => $t.filter(x=>!x.done).length);
export const allDone = derived(todos, $t => $t.length > 0 && $t.every(x=>x.done));
```

```ts
// src/lib/stores/notes.ts
import { writable } from 'svelte/store';
export type Note = { id:string; title:string; content:string; tags:string[]; version:number; updatedAt:number };
export const notes = writable<Note[]>([]);
```

> ì‹¤ì œ ìš´ì˜ì—ì„  **ì„œë²„ ë°ì´í„°ë¥¼ ì‹ ë¢°**í•˜ê³ , ìŠ¤í† ì–´ëŠ” í´ë¼ì´ì–¸íŠ¸ UX(ë‚™ê´€ì /ì„ì‹œ ìƒíƒœ)ì— ì´ˆì .

---

## 16.5 ë ˆì´ì•„ì›ƒ & ê³µí†µ UI

```svelte
<!-- src/routes/+layout.svelte -->
<script lang="ts">
  import { theme, toast } from '$lib/stores/ui';
  $: document?.documentElement?.setAttribute('data-theme', $theme);
</script>

<a href="#main" class="skip">ë³¸ë¬¸ ë°”ë¡œê°€ê¸°</a>
<header class="site">
  <nav>
    <a href="/">Home</a>
    <a href="/todos">ToDos</a>
    <a href="/notes">Notes</a>
    <a href="/profile">Profile</a>
  </nav>
  <button on:click={() => theme.set($theme==='light'?'dark':'light')} aria-label="toggle theme">
    {$theme==='light' ? 'ğŸŒ' : 'ğŸŒ™'}
  </button>
</header>

<main id="main"><slot /></main>

{#if $toast}
  <div role="alert" class={`toast ${$toast.type}`}>{$toast.msg}</div>
{/if}

<style>
.skip{position:absolute;left:-9999px} .skip:focus{left:10px;top:10px;background:#fff;padding:8px;border:2px solid}
.site{display:flex;justify-content:space-between;align-items:center;padding:12px}
.toast{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:#111;color:#fff;padding:.6rem 1rem;border-radius:10px}
.toast.success{background:#10b981}.toast.error{background:#ef4444}
:root[data-theme="dark"]{color-scheme:dark;background:#0b1220;color:#e5e7eb}
</style>
```

---

## 16.6 í™ˆ â€” ìƒíƒœ ìš”ì•½

```svelte
<!-- src/routes/+page.svelte -->
<script lang="ts">
  import { remaining } from '$lib/stores/todos';
</script>

<h1>SvelteKit Mini â€” ToDo/Notes</h1>
<p>ë‚¨ì€ ì‘ì—…: {$remaining}ê°œ</p>
<p>ì™¼ìª½ ë‚´ë¹„ì—ì„œ ToDo ë˜ëŠ” Notesë¡œ ì´ë™í•˜ì„¸ìš”.</p>
```

---

## 16.7 ToDo â€” í˜ì´ì§€ & ì•¡ì…˜

### 16.7.1 ì„œë²„ ë¡œë“œ(+page.server.ts)
```ts
// src/routes/todos/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

// ë°ëª¨: ë©”ëª¨ë¦¬ ì €ì¥(ì‹¤ì „ì€ DB/íŒŒì¼). ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ localsì— ì €ì¥ ê°€ì •
// ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” Prisma/DBë¡œ ëŒ€ì²´.
function store(event: any) {
  if (!event.locals.todos) event.locals.todos = [];
  return event.locals.todos as any[];
}

export const load: PageServerLoad = async ({ locals }) => {
  const items = locals.todos ?? [];
  return { items };
};

export const actions: Actions = {
  add: async ({ request, locals }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    if (!title) return { ok:false, message:'ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”', values: { title } };
    const item = { id: crypto.randomUUID(), title, done:false, version:1, createdAt:Date.now() };
    const list = store({ locals }); list.unshift(item);
    return { ok:true, item };
  },
  toggle: async ({ request, locals }) => {
    const fd = await request.formData();
    const id = String(fd.get('id') ?? '');
    const version = Number(fd.get('version') ?? 0);
    const list = store({ locals });
    const i = list.findIndex(x=>x.id===id);
    if (i<0) return { ok:false, message:'ì—†ìŒ' };
    if (list[i].version !== version) return { ok:false, conflict:true, message:'ë²„ì „ ì¶©ëŒ' };
    list[i] = { ...list[i], done: !list[i].done, version: list[i].version + 1 };
    return { ok:true, item:list[i] };
  },
  remove: async ({ request, locals }) => {
    const fd = await request.formData();
    const id = String(fd.get('id') ?? '');
    const list = store({ locals });
    const i = list.findIndex(x=>x.id===id);
    if (i>=0) list.splice(i,1);
    return { ok:true, id };
  }
};
```

### 16.7.2 í˜ì´ì§€ UI(+page.svelte) â€” `use:enhance`ë¡œ ë‚™ê´€ì 

```svelte
<!-- src/routes/todos/+page.svelte -->
<script lang="ts">
  import { enhance } from '$app/forms';
  import { todos, remaining } from '$lib/stores/todos';
  import { showToast } from '$lib/stores/ui';
  export let data; export let form;

  // ì´ˆê¸° ë°ì´í„° â†’ ìŠ¤í† ì–´
  $: if (data?.items) todos.reset(data.items);

  function addEnhance() {
    return {
      async pending({ data }) {
        const title = (data as FormData).get('title') as string;
        if (title?.trim()) {
          const temp = { id: 'temp-'+crypto.randomUUID(), title: title.trim(), done:false, version:1, createdAt:Date.now() };
          todos.add(temp);
        }
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'success' && result.data?.item) {
          // temp í•­ëª©ì„ ì‹¤ì œ í•­ëª©ìœ¼ë¡œ ì¹˜í™˜
          const real = result.data.item;
          todos.patch(real.id, real); // idê°€ ë‹¤ë¥´ë©´ ì•„ë˜ ì¡°ì •
          // ê°„ë‹¨: ì „ì²´ ë¬´íš¨í™” ì—†ì´, temp ì œê±° í›„ real ì¶”ê°€
          todos.remove(t => (t as any) === t); // ë°ëª¨ ë‹¨ìˆœí™”: ì•„ë˜ ì½”ë“œë¡œ ëŒ€ì²´
        }
      }
    };
  }

  function toggleEnhance() {
    return {
      async pending({ data }) {
        const id = (data as FormData).get('id') as string;
        const version = Number((data as FormData).get('version') ?? 0);
        // ë‚™ê´€ì  í† ê¸€
        todos.patch(id, { done: true, version: version+1 });
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'failure' && result.data?.conflict) {
          showToast('error','ë²„ì „ ì¶©ëŒ: ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„');
        }
      }
    };
  }

  function deleteEnhance() {
    return {
      async pending({ data }) {
        const id = (data as FormData).get('id') as string;
        // ë‚™ê´€ì  ì œê±°
        todos.remove(id);
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'failure') showToast('error','ì‚­ì œ ì‹¤íŒ¨');
      }
    };
  }
</script>

<h1>ToDos <small>ë‚¨ì€ ì‘ì—… {$remaining}</small></h1>

<form method="POST" use:enhance={addEnhance()} class="row">
  <input aria-label="ìƒˆ ì‘ì—…" name="title" placeholder="í•  ì¼ì„ ì…ë ¥â€¦" required />
  <button name="add">ì¶”ê°€</button>
</form>

<ul class="list">
{#each $todos as t (t.id)}
  <li class:done={t.done}>
    <form method="POST" use:enhance={toggleEnhance()} class="inline">
      <input type="hidden" name="id" value={t.id} />
      <input type="hidden" name="version" value={t.version} />
      <button name="toggle" aria-pressed={t.done} aria-label={t.done?'ì™„ë£Œ í•´ì œ':'ì™„ë£Œ ì²˜ë¦¬'}>âœ“</button>
    </form>
    <span>{t.title}</span>
    <form method="POST" use:enhance={deleteEnhance()} class="inline">
      <input type="hidden" name="id" value={t.id} />
      <button name="remove" aria-label="ì‚­ì œ">ğŸ—‘</button>
    </form>
  </li>
{/each}
</ul>

<style>
.row{display:flex;gap:.5rem;margin:1rem 0}
.list{display:grid;gap:.5rem;padding:0}
li{list-style:none;display:grid;grid-template-columns:auto 1fr auto;gap:.5rem;align-items:center;padding:.4rem .6rem;border:1px solid #e5e7eb;border-radius:10px}
li.done span{text-decoration:line-through;color:#64748b}
button[aria-pressed="true"]{background:#10b981;color:#fff}
.inline{display:inline}
</style>
```

> ìœ„ ì˜ˆì œëŠ” â€œ**ì•¡ì…˜ ê¸°ë°˜** + **ë‚™ê´€ì  ì—…ë°ì´íŠ¸** + **ì¶©ëŒ ë©”ì‹œì§€**â€ íŒ¨í„´ì„ ë³´ì—¬ì¤€ë‹¤. ì‹¤ì „ì—ì„œëŠ” **ì„œë²„ì—ì„œ ìµœì‹  í•­ëª©ì„ ëŒë ¤** tempë¥¼ ì •í™•íˆ ëŒ€ì²´í•˜ê±°ë‚˜, `invalidate('/api/todos')`ë¡œ ì¬ë™ê¸°í™”í•œë‹¤.

---

## 16.8 Notes â€” CRUD & ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°

### 16.8.1 ì„œë²„ ë¡œë“œ/ì•¡ì…˜(+page.server.ts)
```ts
// src/routes/notes/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

export const load: PageServerLoad = async ({ locals }) => {
  const items = locals.notes ?? [];
  return { items };
};

export const actions: Actions = {
  create: async ({ request, locals }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    if (!title) return { ok:false, message:'ì œëª© í•„ìˆ˜' };
    const note = { id: crypto.randomUUID(), title, content:'', tags:[], version:1, updatedAt:Date.now() };
    locals.notes = [note, ...(locals.notes ?? [])];
    return { ok:true, note };
  }
};
```

### 16.8.2 í˜ì´ì§€(+page.svelte)
```svelte
<script lang="ts">
  import { notes as store } from '$lib/stores/notes';
  import { enhance } from '$app/forms';
  export let data; export let form;
  $: if (data?.items) store.set(data.items);

  const createOpts = {
    async pending({ data }) {
      const title = (data as FormData).get('title') as string;
      if (title?.trim()) store.update(n => [{ id:'temp-'+crypto.randomUUID(), title: title.trim(), content:'', tags:[], version:1, updatedAt:Date.now() }, ...n]);
    },
    async result({ update }) { await update(); }
  };
</script>

<h1>Notes</h1>
<form method="POST" use:enhance={createOpts}>
  <input name="title" placeholder="ë…¸íŠ¸ ì œëª©" required />
  <button name="create">ìƒˆ ë…¸íŠ¸</button>
</form>

<ul class="grid">
{#each $store as n (n.id)}
  <li>
    <a href={`/notes/${n.id}`}><strong>{n.title}</strong></a>
    <small>{new Date(n.updatedAt).toLocaleString()}</small>
  </li>
{/each}
</ul>

<style>
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:.8rem;margin-top:1rem}
li{border:1px solid #e5e7eb;border-radius:10px;padding:.6rem}
</style>
```

### 16.8.3 ë…¸íŠ¸ ìƒì„¸ â€” í¸ì§‘/ë¯¸ë¦¬ë³´ê¸°

#### ì„œë²„
```ts
// src/routes/notes/[id]/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

export const load: PageServerLoad = async ({ locals, params }) => {
  const row = (locals.notes ?? []).find((n:any) => n.id === params.id);
  if (!row) return { notFound: true };
  return { note: row };
};

export const actions: Actions = {
  save: async ({ locals, params, request }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    const content = String(fd.get('content') ?? '');
    const version = Number(fd.get('version') ?? 0);
    const notes = locals.notes ?? [];
    const i = notes.findIndex((n:any)=>n.id===params.id);
    if (i<0) return { ok:false, message:'ì—†ìŒ' };
    if (notes[i].version !== version) return { ok:false, conflict:true, message:'ë²„ì „ ì¶©ëŒ' };
    notes[i] = { ...notes[i], title, content, version: version+1, updatedAt: Date.now() };
    return { ok:true, note: notes[i] };
  }
};
```

#### í˜ì´ì§€
```svelte
<!-- src/routes/notes/[id]/+page.svelte -->
<script lang="ts">
  import { enhance } from '$app/forms';
  import { onMount } from 'svelte';
  import { showToast } from '$lib/stores/ui';
  export let data; export let form;

  let title = data.note?.title ?? '';
  let content = data.note?.content ?? '';
  let version = data.note?.version ?? 1;
  let preview = '';

  onMount(async () => {
    // ë§¤ìš° ê°€ë²¼ìš´ ë§ˆí¬ë‹¤ìš´ íŒŒì„œ(ë˜ëŠ” marked/remarkë¥¼ ë™ì  import)
    preview = content.replace(/^# (.*)$/gm, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/\n/g,'<br/>');
  });

  const opts = {
    async pending() { /* ë¡œë”© ì¸ë””ì¼€ì´í„° */ },
    async result({ result, update }) {
      await update();
      if (result.type==='success' && result.data?.ok) {
        version = result.data.note.version;
        showToast('success','ì €ì¥ë¨');
      } else if (result.type==='success' && result.data?.conflict) {
        showToast('error','ë²„ì „ ì¶©ëŒ: ìƒˆë¡œê³ ì¹¨ í›„ ì¬ì‹œë„');
      }
    }
  };
</script>

{#if data.notFound}
  <p>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¸íŠ¸ì…ë‹ˆë‹¤.</p>
{:else}
  <h1>ë…¸íŠ¸ í¸ì§‘</h1>
  <form method="POST" use:enhance={opts} class="editor">
    <input name="title" bind:value={title} required aria-label="ì œëª©" />
    <textarea name="content" bind:value={content} rows="14" aria-label="ë‚´ìš©"></textarea>
    <input type="hidden" name="version" value={version} />
    <button name="save">ì €ì¥</button>
  </form>

  <section class="preview">
    <h2>ë¯¸ë¦¬ë³´ê¸°</h2>
    <div class="prose" on:click|preventDefault bind:innerHTML={preview}></div>
  </section>
{/if}

<style>
.editor{display:grid;gap:.6rem;max-width:800px}
.preview{margin-top:1rem}
.prose h1{font-size:1.5rem;margin:.6rem 0}
</style>
```

> **ì •í™•í•œ ë§ˆí¬ë‹¤ìš´**ì´ í•„ìš”í•˜ë©´ `marked/remark`ë¥¼ **ë™ì  import**(ì§€ì—° ë¡œë”©)í•˜ì—¬ ì´ˆê¸° ë²ˆë“¤ ë¬´ê²Œë¥¼ ì¤„ì¸ë‹¤(12ì¥ ì°¸ì¡°).

---

## 16.9 ê²€ìƒ‰ API â€” ToDo/Notes í†µí•©

```ts
// src/routes/api/search/+server.ts
import type { RequestHandler } from './$types';

export const GET: RequestHandler = async ({ url, locals }) => {
  const q = (url.searchParams.get('q') ?? '').toLowerCase();
  const todos = (locals.todos ?? []).filter((t:any)=>t.title.toLowerCase().includes(q));
  const notes = (locals.notes ?? []).filter((n:any)=>n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q));
  return new Response(JSON.stringify({ todos, notes }), { headers:{ 'content-type':'application/json', 'cache-control':'no-store' }});
};
```

ê²€ìƒ‰ ì…ë ¥ ì»´í¬ë„ŒíŠ¸:

```svelte
<!-- src/lib/components/SearchInput.svelte -->
<script lang="ts">
  import { onMount } from 'svelte';
  export let q = '';
  export let onSelect: (hit:any)=>void = ()=>{};
  let list: any[] = [];

  async function run() {
    if (!q.trim()) { list = []; return; }
    list = await fetch('/api/search?q='+encodeURIComponent(q)).then(r=>r.json());
  }
  $: q, run();
</script>

<input placeholder="ê²€ìƒ‰â€¦" bind:value={q} aria-label="ê²€ìƒ‰" />
{#if q && (list.todos?.length || list.notes?.length)}
  <div class="panel" role="listbox">
    {#each list.todos ?? [] as t}
      <button role="option" on:click={() => onSelect({ type:'todo', id:t.id })}>ğŸ—’ {t.title}</button>
    {/each}
    {#each list.notes ?? [] as n}
      <button role="option" on:click={() => onSelect({ type:'note', id:n.id })}>ğŸ“ {n.title}</button>
    {/each}
  </div>
{/if}

<style>
.panel{position:absolute;background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:.4rem;display:grid;gap:.2rem}
</style>
```

---

## 16.10 Profile â€” í…Œë§ˆ/ì´ë¦„

```ts
// src/routes/+layout.server.ts
import type { LayoutServerLoad } from './$types';
export const load: LayoutServerLoad = async ({ cookies }) => {
  const theme = cookies.get('theme') ?? 'light';
  return { theme };
};
```

```svelte
<!-- src/routes/profile/+page.svelte -->
<script lang="ts">
  import { theme } from '$lib/stores/ui';
  let name = '';
</script>

<h1>Profile</h1>
<label>ì´ë¦„ <input bind:value={name} /></label>
<label>í…Œë§ˆ
  <select bind:value={$theme}>
    <option value="light">Light</option>
    <option value="dark">Dark</option>
  </select>
</label>
```

---

## 16.11 ì ‘ê·¼ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ìš©

- ìŠ¤í‚µ ë§í¬: ë ˆì´ì•„ì›ƒ ìƒë‹¨ ì œê³µ
- í¼ ì˜¤ë¥˜ `aria-invalid`, ë¼ì´ë¸Œ ì•Œë¦¼ `role="alert"`
- ëª¨ë‹¬/íŒì˜¤ë²„ ì‚¬ìš© ì‹œ `role="dialog"`, í¬ì»¤ìŠ¤ íŠ¸ë©(6ì¥ ì˜ˆì œ ì¬ì‚¬ìš©)
- ë¦¬ìŠ¤íŠ¸/ë²„íŠ¼ ë„¤ì´ë°: `aria-label`, `aria-pressed` ì‚¬ìš©
- ìƒ‰ ëŒ€ë¹„: 4.5:1 ì´ìƒ, ë‹¤í¬ ëª¨ë“œ ëŒ€ë¹„ ì ê²€

---

## 16.12 ì„±ëŠ¥ ìµœì í™” ì ìš© í¬ì¸íŠ¸

- **ì´ˆê¸° ë²ˆë“¤**: ë§ˆí¬ë‹¤ìš´ íŒŒì„œ/ì°¨íŠ¸ ë“± **ë™ì  import**
- **ì´ë¯¸ì§€**: ì¸ë„¤ì¼/ë¯¸ë¦¬ë³´ê¸° `loading="lazy"`, í­/ë†’ì´ ì§€ì •
- **í°íŠ¸**: `font-display: swap`, ìì²´ í˜¸ìŠ¤íŒ…
- **í•˜ì´ë“œë ˆì´ì…˜**: ToDo/Notes ëª©ë¡ì€ **ê°„ë‹¨ êµ¬ì¡°**ë¡œ ìœ ì§€, ë¬´ê±°ìš´ ì»´í¬ë„ŒíŠ¸ëŠ” ê°€ì‹œì„± ë¡œë”©

---

## 16.13 ì„œë²„ ì €ì¥ì†Œ(ì˜µì…˜) â€” Prisma/Postgres

> ìœ„ ì˜ˆì œëŠ” ê°„ë‹¨í™”ë¥¼ ìœ„í•´ **locals ë©”ëª¨ë¦¬**ë¥¼ ì¼ë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” **Prisma**ë¡œ ëŒ€ì²´í•˜ì.

### 16.13.1 Prisma ëª¨ë¸
```prisma
model Todo {
  id        String   @id @default(cuid())
  userId    String
  title     String
  done      Boolean  @default(false)
  version   Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Note {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String   @default("")
  tags      String[] @db.Text[]
  version   Int      @default(1)
  updatedAt DateTime @updatedAt
}
```

### 16.13.2 ë¼ìš°íŠ¸ ì˜ˆ(ì¼ë¶€)
```ts
// src/routes/api/todos/+server.ts
import { prisma } from '$lib/server/prisma';
import { TodoCreate } from '$lib/schema/todo';
import { json, bad } from '$lib/utils/http';

export const GET = async ({ locals }) => {
  const items = await prisma.todo.findMany({ where:{ userId: locals.user.id }, orderBy:{ createdAt: 'desc' }, take: 100 });
  return json({ items }, { headers: { 'cache-control':'no-store' }});
};

export const POST = async ({ locals, request }) => {
  const body = await request.json().catch(()=> ({}));
  const val = TodoCreate.safeParse(body);
  if (!val.success) return bad(val.error.flatten());
  const item = await prisma.todo.create({ data: { userId: locals.user.id, title: val.data.title }});
  return json(item, { status:201 });
};
```

> í”„ëŸ°íŠ¸ì—ì„œëŠ” `fetch('/api/todos')`ë¥¼ í†µí•´ ë™ì¼ UIë¡œ ë™ì‘. ì•¡ì…˜ ê¸°ë°˜/REST ë³‘í–‰ë„ ê°€ëŠ¥.

---

## 16.14 ìºì‹±/ë¬´íš¨í™”

- `+page.ts`ì—ì„œ `depends('/api/todos')` â†’ í•­ëª© ë³€ê²½ ì‹œ `invalidate('/api/todos')`
- APIì— `ETag`ë¥¼ ë‹¬ì•„ ì¡°ê±´ë¶€ ìš”ì²­ â†’ ì¤‘ë³µ ë°ì´í„° ì „ì†¡ ì¶•ì†Œ
- ì½ê¸° ìœ„ì£¼ì˜ ë…¸íŠ¸ ëª©ë¡ì€ `stale-while-revalidate`(SWR) íŒ¨í„´(ë¸Œë¼ìš°ì € ìºì‹œ + ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹ )

```ts
// ì˜ˆì‹œ: GET ì‘ë‹µ í—¤ë”
'cache-control': 'public, max-age=30, stale-while-revalidate=120'
```

---

## 16.15 í…ŒìŠ¤íŠ¸(ìš”ì•½)

### ìœ ë‹›/ì»´í¬ë„ŒíŠ¸
- ìŠ¤í† ì–´ ë¡œì§(ì¶”ê°€/í† ê¸€/ì‚­ì œ)
- AddTodo ì»´í¬ë„ŒíŠ¸: ì…ë ¥ íŠ¸ë¦¬ë°, ë””ìŠ¤íŒ¨ì¹˜

### E2E(Playwright)
- `/todos` ë°©ë¬¸ â†’ ì¶”ê°€ â†’ ì™„ë£Œ â†’ ì‚­ì œ
- `/notes` ë°©ë¬¸ â†’ ìƒì„± â†’ ì œëª©/ë‚´ìš© ìˆ˜ì • â†’ ì €ì¥ ë©”ì‹œì§€

> 13ì¥ì—ì„œ ì œì‹œí•œ ì„¤ì •ì„ ê·¸ëŒ€ë¡œ ì˜®ê²¨ ì“°ë©´ ëœë‹¤.

---

## 16.16 ë°°í¬ í¬ì¸íŠ¸

- **ì–´ëŒ‘í„°-ë…¸ë“œ**: PM2/Docker. ì´ë¯¸ì§€ ë³€í™˜ ì—†ìŒ â†’ ê°„ë‹¨
- **Vercel/Netlify**: ì•¡ì…˜/ì—”ë“œí¬ì¸íŠ¸ëŠ” Functionsë¡œ, DBëŠ” HTTP/Accelerate
- **Cloudflare**: Edge ì¹œí™” APIë§Œ ì‚¬ìš©(ë…¸íŠ¸ ë¯¸ë¦¬ë³´ê¸° ë§ˆí¬ë‹¤ìš´ íŒŒì„œëŠ” ë™ì  importë¡œ ë¸Œë¼ìš°ì € ì „ìš© ì²˜ë¦¬)

ë³´ì•ˆ:
- CSRF: SvelteKit ê¸°ë³¸ `csrf.checkOrigin: true`
- ì„¸ì…˜ ì¿ í‚¤: `HttpOnly`, `SameSite=Lax`, `Secure`
- ë¡œê¹…: êµ¬ì¡°ì  JSON, ìš”ì²­ ID(`rid`), ì—ëŸ¬ëŠ” Sentry ì „ì†¡(14ì¥ ì°¸ê³ )

---

## 16.17 í™•ì¥ ê³¼ì œ

1) **ë“œë˜ê·¸ì•¤ë“œë¡­**ìœ¼ë¡œ ToDo ì •ë ¬ â†’ ì„œë²„ `PATCH /todos/reorder` + ë‚™ê´€ì  ìˆœì„œ ì—…ë°ì´íŠ¸
2) **íƒœê·¸ í•„í„°/ê²€ìƒ‰**: `/api/search` ê°œì„ , í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸
3) **ì´ë¯¸ì§€ ì²¨ë¶€**: ë…¸íŠ¸ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ(10ì¥ íŒŒì¼ ì—…ë¡œë“œ íŒŒì´í”„ë¼ì¸ ì¬ì‚¬ìš©)
4) **ë™ê¸°í™”**: ì˜¤í”„ë¼ì¸ ì…ë ¥ í â†’ ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ë°°ì¹˜ ì „ì†¡
5) **ì‹¤ì‹œê°„**: ì„œë²„ SSE/ì›¹ì†Œì¼“(ë…¸ë“œ ì–´ëŒ‘í„°)ë¡œ ë‹¤ì¤‘ í´ë¼ì´ì–¸íŠ¸ ë™ê¸°í™”

---

## 16.18 ìš”ì•½

- **ìŠ¤í† ì–´**ëŠ” í´ë¼ì´ì–¸íŠ¸ UX(ë‚™ê´€/ì„ì‹œ ìƒíƒœ)ì— ì§‘ì¤‘, **ì„œë²„ ì•¡ì…˜**ì€ ê²€ì¦Â·ê¶Œí•œÂ·ì €ì¥ ë‹´ë‹¹.
- **`use:enhance`**ë¡œ AJAX ì œì¶œ + í¼ ê¸°ë³¸ ë™ì‘(ì„œë²„ ìš°ì„ )ì„ ë™ì‹œì— ë§Œì¡±.
- **ë²„ì „ í•„ë“œ**ë¡œ ë‚™ê´€ì  UI ì¶©ëŒì„ ë‹¤ë£¨ê³ , ì‹¤íŒ¨ ì‹œ **í† ìŠ¤íŠ¸/í¬ì»¤ìŠ¤ ì´ë™**ìœ¼ë¡œ í”¼ë“œë°±.
- ìš´ì˜ì„ ì—¼ë‘ì— ë‘ê³  **ìºì‹±/ë¬´íš¨í™”/ë¡œê¹…/ì˜¤ë¥˜ ì¶”ì **ì„ ë‚´ì¥í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ì˜ í•µì‹¬.
