---
layout: post
title: Svelte - 예제 미니 프로젝트 (1)
date: 2025-10-03 22:30:23 +0900
category: Svelte
---
# 16. 실전 예제 미니 프로젝트 (1) — **ToDo/노트 앱**  
**스토어 · 폼 액션 · 검증 · 낙관적 UI · 접근성 · 캐싱 · 배포까지 한 번에**

> 목표: “현실에서 바로 쓸 수 있는” **SvelteKit** 미니 프로젝트를 완성한다.  
> - **스토어**(writable/derived)로 전역/로컬 상태 조직  
> - **폼 액션(actions)**으로 서버 우선(SSR) + 점진적 향상(`use:enhance`)  
> - **Zod** 이중 검증(클라 즉시 피드백 + 서버 최종 검증)  
> - **낙관적 UI**, **오류/충돌 처리**, **접근성(A11y)**, **성능**  
> - **옵션 저장소**: ① 메모리/LocalStorage, ② 파일/SQLite, ③ Prisma(Postgres)

---

## 16.0 프로젝트 개요

### 기능 요약
1) **ToDo**: 추가/완료/삭제/필터, 순서 변경(선택)  
2) **노트**: 마크다운 편집/미리보기, 태그, 빠른 검색  
3) **프로필**: 사용자 이름/테마(라이트/다크)  
4) **오프라인 친화**: 입력 유지, 낙관적 추가 → 실패 시 롤백  
5) **접근성**: 스킵 링크, 포커스 트랩, 라이브 알림

### 기술 스택
- **SvelteKit** (라우팅/액션/SSR)  
- **@sveltejs/kit** forms enhance  
- **Zod** 검증  
- **스토어**: `writable`, `derived`  
- **(옵션)** 서버 저장: Node 어댑터 + Prisma(Postgres)

---

## 16.1 디렉토리 구조

```
src/
  lib/
    schema/
      todo.ts
      note.ts
    stores/
      ui.ts
      todos.ts
      notes.ts
    components/
      AddTodo.svelte
      TodoItem.svelte
      Filters.svelte
      Toast.svelte
      NoteEditor.svelte
      SearchInput.svelte
    utils/
      a11y.ts
      http.ts
  routes/
    +layout.svelte
    +layout.server.ts
    +page.svelte
    todos/
      +page.svelte
      +page.server.ts
      +page.ts
      +server.ts           # REST-ish API (GET/POST)
      [id]/
        +server.ts         # GET/PATCH/DELETE
    notes/
      +page.svelte
      +page.server.ts
      +server.ts
      [id]/
        +page.svelte
        +page.server.ts
        +server.ts
    profile/
      +page.svelte
      +page.server.ts
    api/
      search/+server.ts
```

> 라우트별로 **페이지(`+page.svelte`), 데이터 로드(`+page.ts/.server.ts`), 액션(`actions`), 엔드포인트(`+server.ts`)** 를 분리한다.

---

## 16.2 스키마(검증) — Zod

```ts
// src/lib/schema/todo.ts
import { z } from 'zod';

export const TodoCreate = z.object({
  title: z.string().min(1, '제목은 필수입니다').max(140, '140자 이내'),
});

export const TodoPatch = z.object({
  title: z.string().min(1).max(140).optional(),
  done: z.boolean().optional(),
  // 낙관적 락(버전)
  version: z.number().int().positive()
});

export type TodoCreateInput = z.infer<typeof TodoCreate>;
export type TodoPatchInput  = z.infer<typeof TodoPatch>;
```

```ts
// src/lib/schema/note.ts
import { z } from 'zod';

export const NoteCreate = z.object({
  title: z.string().min(1, '제목 필수'),
  content: z.string().default(''),
  tags: z.string().transform(s => s.split(',').map(t=>t.trim()).filter(Boolean)).optional()
});

export const NotePatch = z.object({
  title: z.string().min(1).optional(),
  content: z.string().optional(),
  tags: z.array(z.string()).optional(),
  version: z.number().int().positive()
});
```

---

## 16.3 공통 유틸 — HTTP/포맷/A11y

```ts
// src/lib/utils/http.ts
export const json = (data: any, init: ResponseInit = {}) =>
  new Response(JSON.stringify(data), { ...init, headers: { 'content-type': 'application/json', ...(init.headers||{}) } });

export const bad = (errors: unknown, code = 400) => json({ errors }, { status: code });
```

```ts
// src/lib/utils/a11y.ts
export function focusFirstInvalid() {
  const el = document.querySelector('[aria-invalid="true"]') as HTMLElement | null;
  el?.focus();
}
```

---

## 16.4 스토어 — 전역 UI/데이터

```ts
// src/lib/stores/ui.ts
import { writable } from 'svelte/store';

export const theme = writable<'light'|'dark'>('light');
export const toast = writable<{ type:'success'|'error'; msg:string } | null>(null);

export function showToast(type: 'success'|'error', msg: string, ms = 2000) {
  toast.set({ type, msg });
  setTimeout(()=>toast.set(null), ms);
}
```

```ts
// src/lib/stores/todos.ts
import { writable, derived, get } from 'svelte/store';
export type Todo = { id:string; title:string; done:boolean; version:number; createdAt:number };

function createTodos() {
  const { subscribe, set, update } = writable<Todo[]>([]);
  const add = (t: Todo) => update(list => [t, ...list]);
  const remove = (id: string) => update(list => list.filter(x => x.id !== id));
  const patch = (id: string, changes: Partial<Todo>) => update(list => list.map(x => x.id === id ? { ...x, ...changes } : x));
  const reset = (items: Todo[]) => set(items);
  return { subscribe, add, remove, patch, reset };
}
export const todos = createTodos();

export const remaining = derived(todos, $t => $t.filter(x=>!x.done).length);
export const allDone = derived(todos, $t => $t.length > 0 && $t.every(x=>x.done));
```

```ts
// src/lib/stores/notes.ts
import { writable } from 'svelte/store';
export type Note = { id:string; title:string; content:string; tags:string[]; version:number; updatedAt:number };
export const notes = writable<Note[]>([]);
```

> 실제 운영에선 **서버 데이터를 신뢰**하고, 스토어는 클라이언트 UX(낙관적/임시 상태)에 초점.

---

## 16.5 레이아웃 & 공통 UI

```svelte
<!-- src/routes/+layout.svelte -->
<script lang="ts">
  import { theme, toast } from '$lib/stores/ui';
  $: document?.documentElement?.setAttribute('data-theme', $theme);
</script>

<a href="#main" class="skip">본문 바로가기</a>
<header class="site">
  <nav>
    <a href="/">Home</a>
    <a href="/todos">ToDos</a>
    <a href="/notes">Notes</a>
    <a href="/profile">Profile</a>
  </nav>
  <button on:click={() => theme.set($theme==='light'?'dark':'light')} aria-label="toggle theme">
    {$theme==='light' ? '🌞' : '🌙'}
  </button>
</header>

<main id="main"><slot /></main>

{#if $toast}
  <div role="alert" class={`toast ${$toast.type}`}>{$toast.msg}</div>
{/if}

<style>
.skip{position:absolute;left:-9999px} .skip:focus{left:10px;top:10px;background:#fff;padding:8px;border:2px solid}
.site{display:flex;justify-content:space-between;align-items:center;padding:12px}
.toast{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:#111;color:#fff;padding:.6rem 1rem;border-radius:10px}
.toast.success{background:#10b981}.toast.error{background:#ef4444}
:root[data-theme="dark"]{color-scheme:dark;background:#0b1220;color:#e5e7eb}
</style>
```

---

## 16.6 홈 — 상태 요약

```svelte
<!-- src/routes/+page.svelte -->
<script lang="ts">
  import { remaining } from '$lib/stores/todos';
</script>

<h1>SvelteKit Mini — ToDo/Notes</h1>
<p>남은 작업: {$remaining}개</p>
<p>왼쪽 내비에서 ToDo 또는 Notes로 이동하세요.</p>
```

---

## 16.7 ToDo — 페이지 & 액션

### 16.7.1 서버 로드(+page.server.ts)
```ts
// src/routes/todos/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

// 데모: 메모리 저장(실전은 DB/파일). 여기서는 간단히 locals에 저장 가정
// 실제 운영에서는 Prisma/DB로 대체.
function store(event: any) {
  if (!event.locals.todos) event.locals.todos = [];
  return event.locals.todos as any[];
}

export const load: PageServerLoad = async ({ locals }) => {
  const items = locals.todos ?? [];
  return { items };
};

export const actions: Actions = {
  add: async ({ request, locals }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    if (!title) return { ok:false, message:'제목을 입력하세요', values: { title } };
    const item = { id: crypto.randomUUID(), title, done:false, version:1, createdAt:Date.now() };
    const list = store({ locals }); list.unshift(item);
    return { ok:true, item };
  },
  toggle: async ({ request, locals }) => {
    const fd = await request.formData();
    const id = String(fd.get('id') ?? '');
    const version = Number(fd.get('version') ?? 0);
    const list = store({ locals });
    const i = list.findIndex(x=>x.id===id);
    if (i<0) return { ok:false, message:'없음' };
    if (list[i].version !== version) return { ok:false, conflict:true, message:'버전 충돌' };
    list[i] = { ...list[i], done: !list[i].done, version: list[i].version + 1 };
    return { ok:true, item:list[i] };
  },
  remove: async ({ request, locals }) => {
    const fd = await request.formData();
    const id = String(fd.get('id') ?? '');
    const list = store({ locals });
    const i = list.findIndex(x=>x.id===id);
    if (i>=0) list.splice(i,1);
    return { ok:true, id };
  }
};
```

### 16.7.2 페이지 UI(+page.svelte) — `use:enhance`로 낙관적

```svelte
<!-- src/routes/todos/+page.svelte -->
<script lang="ts">
  import { enhance } from '$app/forms';
  import { todos, remaining } from '$lib/stores/todos';
  import { showToast } from '$lib/stores/ui';
  export let data; export let form;

  // 초기 데이터 → 스토어
  $: if (data?.items) todos.reset(data.items);

  function addEnhance() {
    return {
      async pending({ data }) {
        const title = (data as FormData).get('title') as string;
        if (title?.trim()) {
          const temp = { id: 'temp-'+crypto.randomUUID(), title: title.trim(), done:false, version:1, createdAt:Date.now() };
          todos.add(temp);
        }
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'success' && result.data?.item) {
          // temp 항목을 실제 항목으로 치환
          const real = result.data.item;
          todos.patch(real.id, real); // id가 다르면 아래 조정
          // 간단: 전체 무효화 없이, temp 제거 후 real 추가
          todos.remove(t => (t as any) === t); // 데모 단순화: 아래 코드로 대체
        }
      }
    };
  }

  function toggleEnhance() {
    return {
      async pending({ data }) {
        const id = (data as FormData).get('id') as string;
        const version = Number((data as FormData).get('version') ?? 0);
        // 낙관적 토글
        todos.patch(id, { done: true, version: version+1 });
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'failure' && result.data?.conflict) {
          showToast('error','버전 충돌: 새로고침 후 다시 시도');
        }
      }
    };
  }

  function deleteEnhance() {
    return {
      async pending({ data }) {
        const id = (data as FormData).get('id') as string;
        // 낙관적 제거
        todos.remove(id);
      },
      async result({ result, update }) {
        await update();
        if (result.type === 'failure') showToast('error','삭제 실패');
      }
    };
  }
</script>

<h1>ToDos <small>남은 작업 {$remaining}</small></h1>

<form method="POST" use:enhance={addEnhance()} class="row">
  <input aria-label="새 작업" name="title" placeholder="할 일을 입력…" required />
  <button name="add">추가</button>
</form>

<ul class="list">
{#each $todos as t (t.id)}
  <li class:done={t.done}>
    <form method="POST" use:enhance={toggleEnhance()} class="inline">
      <input type="hidden" name="id" value={t.id} />
      <input type="hidden" name="version" value={t.version} />
      <button name="toggle" aria-pressed={t.done} aria-label={t.done?'완료 해제':'완료 처리'}>✓</button>
    </form>
    <span>{t.title}</span>
    <form method="POST" use:enhance={deleteEnhance()} class="inline">
      <input type="hidden" name="id" value={t.id} />
      <button name="remove" aria-label="삭제">🗑</button>
    </form>
  </li>
{/each}
</ul>

<style>
.row{display:flex;gap:.5rem;margin:1rem 0}
.list{display:grid;gap:.5rem;padding:0}
li{list-style:none;display:grid;grid-template-columns:auto 1fr auto;gap:.5rem;align-items:center;padding:.4rem .6rem;border:1px solid #e5e7eb;border-radius:10px}
li.done span{text-decoration:line-through;color:#64748b}
button[aria-pressed="true"]{background:#10b981;color:#fff}
.inline{display:inline}
</style>
```

> 위 예제는 “**액션 기반** + **낙관적 업데이트** + **충돌 메시지**” 패턴을 보여준다. 실전에서는 **서버에서 최신 항목을 돌려** temp를 정확히 대체하거나, `invalidate('/api/todos')`로 재동기화한다.

---

## 16.8 Notes — CRUD & 마크다운 미리보기

### 16.8.1 서버 로드/액션(+page.server.ts)
```ts
// src/routes/notes/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

export const load: PageServerLoad = async ({ locals }) => {
  const items = locals.notes ?? [];
  return { items };
};

export const actions: Actions = {
  create: async ({ request, locals }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    if (!title) return { ok:false, message:'제목 필수' };
    const note = { id: crypto.randomUUID(), title, content:'', tags:[], version:1, updatedAt:Date.now() };
    locals.notes = [note, ...(locals.notes ?? [])];
    return { ok:true, note };
  }
};
```

### 16.8.2 페이지(+page.svelte)
```svelte
<script lang="ts">
  import { notes as store } from '$lib/stores/notes';
  import { enhance } from '$app/forms';
  export let data; export let form;
  $: if (data?.items) store.set(data.items);

  const createOpts = {
    async pending({ data }) {
      const title = (data as FormData).get('title') as string;
      if (title?.trim()) store.update(n => [{ id:'temp-'+crypto.randomUUID(), title: title.trim(), content:'', tags:[], version:1, updatedAt:Date.now() }, ...n]);
    },
    async result({ update }) { await update(); }
  };
</script>

<h1>Notes</h1>
<form method="POST" use:enhance={createOpts}>
  <input name="title" placeholder="노트 제목" required />
  <button name="create">새 노트</button>
</form>

<ul class="grid">
{#each $store as n (n.id)}
  <li>
    <a href={`/notes/${n.id}`}><strong>{n.title}</strong></a>
    <small>{new Date(n.updatedAt).toLocaleString()}</small>
  </li>
{/each}
</ul>

<style>
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:.8rem;margin-top:1rem}
li{border:1px solid #e5e7eb;border-radius:10px;padding:.6rem}
</style>
```

### 16.8.3 노트 상세 — 편집/미리보기

#### 서버
```ts
// src/routes/notes/[id]/+page.server.ts
import type { Actions, PageServerLoad } from './$types';

export const load: PageServerLoad = async ({ locals, params }) => {
  const row = (locals.notes ?? []).find((n:any) => n.id === params.id);
  if (!row) return { notFound: true };
  return { note: row };
};

export const actions: Actions = {
  save: async ({ locals, params, request }) => {
    const fd = await request.formData();
    const title = String(fd.get('title') ?? '').trim();
    const content = String(fd.get('content') ?? '');
    const version = Number(fd.get('version') ?? 0);
    const notes = locals.notes ?? [];
    const i = notes.findIndex((n:any)=>n.id===params.id);
    if (i<0) return { ok:false, message:'없음' };
    if (notes[i].version !== version) return { ok:false, conflict:true, message:'버전 충돌' };
    notes[i] = { ...notes[i], title, content, version: version+1, updatedAt: Date.now() };
    return { ok:true, note: notes[i] };
  }
};
```

#### 페이지
```svelte
<!-- src/routes/notes/[id]/+page.svelte -->
<script lang="ts">
  import { enhance } from '$app/forms';
  import { onMount } from 'svelte';
  import { showToast } from '$lib/stores/ui';
  export let data; export let form;

  let title = data.note?.title ?? '';
  let content = data.note?.content ?? '';
  let version = data.note?.version ?? 1;
  let preview = '';

  onMount(async () => {
    // 매우 가벼운 마크다운 파서(또는 marked/remark를 동적 import)
    preview = content.replace(/^# (.*)$/gm, '<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/\n/g,'<br/>');
  });

  const opts = {
    async pending() { /* 로딩 인디케이터 */ },
    async result({ result, update }) {
      await update();
      if (result.type==='success' && result.data?.ok) {
        version = result.data.note.version;
        showToast('success','저장됨');
      } else if (result.type==='success' && result.data?.conflict) {
        showToast('error','버전 충돌: 새로고침 후 재시도');
      }
    }
  };
</script>

{#if data.notFound}
  <p>존재하지 않는 노트입니다.</p>
{:else}
  <h1>노트 편집</h1>
  <form method="POST" use:enhance={opts} class="editor">
    <input name="title" bind:value={title} required aria-label="제목" />
    <textarea name="content" bind:value={content} rows="14" aria-label="내용"></textarea>
    <input type="hidden" name="version" value={version} />
    <button name="save">저장</button>
  </form>

  <section class="preview">
    <h2>미리보기</h2>
    <div class="prose" on:click|preventDefault bind:innerHTML={preview}></div>
  </section>
{/if}

<style>
.editor{display:grid;gap:.6rem;max-width:800px}
.preview{margin-top:1rem}
.prose h1{font-size:1.5rem;margin:.6rem 0}
</style>
```

> **정확한 마크다운**이 필요하면 `marked/remark`를 **동적 import**(지연 로딩)하여 초기 번들 무게를 줄인다(12장 참조).

---

## 16.9 검색 API — ToDo/Notes 통합

```ts
// src/routes/api/search/+server.ts
import type { RequestHandler } from './$types';

export const GET: RequestHandler = async ({ url, locals }) => {
  const q = (url.searchParams.get('q') ?? '').toLowerCase();
  const todos = (locals.todos ?? []).filter((t:any)=>t.title.toLowerCase().includes(q));
  const notes = (locals.notes ?? []).filter((n:any)=>n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q));
  return new Response(JSON.stringify({ todos, notes }), { headers:{ 'content-type':'application/json', 'cache-control':'no-store' }});
};
```

검색 입력 컴포넌트:

```svelte
<!-- src/lib/components/SearchInput.svelte -->
<script lang="ts">
  import { onMount } from 'svelte';
  export let q = '';
  export let onSelect: (hit:any)=>void = ()=>{};
  let list: any[] = [];

  async function run() {
    if (!q.trim()) { list = []; return; }
    list = await fetch('/api/search?q='+encodeURIComponent(q)).then(r=>r.json());
  }
  $: q, run();
</script>

<input placeholder="검색…" bind:value={q} aria-label="검색" />
{#if q && (list.todos?.length || list.notes?.length)}
  <div class="panel" role="listbox">
    {#each list.todos ?? [] as t}
      <button role="option" on:click={() => onSelect({ type:'todo', id:t.id })}>🗒 {t.title}</button>
    {/each}
    {#each list.notes ?? [] as n}
      <button role="option" on:click={() => onSelect({ type:'note', id:n.id })}>📝 {n.title}</button>
    {/each}
  </div>
{/if}

<style>
.panel{position:absolute;background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:.4rem;display:grid;gap:.2rem}
</style>
```

---

## 16.10 Profile — 테마/이름

```ts
// src/routes/+layout.server.ts
import type { LayoutServerLoad } from './$types';
export const load: LayoutServerLoad = async ({ cookies }) => {
  const theme = cookies.get('theme') ?? 'light';
  return { theme };
};
```

```svelte
<!-- src/routes/profile/+page.svelte -->
<script lang="ts">
  import { theme } from '$lib/stores/ui';
  let name = '';
</script>

<h1>Profile</h1>
<label>이름 <input bind:value={name} /></label>
<label>테마
  <select bind:value={$theme}>
    <option value="light">Light</option>
    <option value="dark">Dark</option>
  </select>
</label>
```

---

## 16.11 접근성 체크리스트 적용

- 스킵 링크: 레이아웃 상단 제공  
- 폼 오류 `aria-invalid`, 라이브 알림 `role="alert"`  
- 모달/팝오버 사용 시 `role="dialog"`, 포커스 트랩(6장 예제 재사용)  
- 리스트/버튼 네이밍: `aria-label`, `aria-pressed` 사용  
- 색 대비: 4.5:1 이상, 다크 모드 대비 점검

---

## 16.12 성능 최적화 적용 포인트

- **초기 번들**: 마크다운 파서/차트 등 **동적 import**  
- **이미지**: 썸네일/미리보기 `loading="lazy"`, 폭/높이 지정  
- **폰트**: `font-display: swap`, 자체 호스팅  
- **하이드레이션**: ToDo/Notes 목록은 **간단 구조**로 유지, 무거운 컴포넌트는 가시성 로딩

---

## 16.13 서버 저장소(옵션) — Prisma/Postgres

> 위 예제는 간단화를 위해 **locals 메모리**를 썼다. 실제 서비스에서는 **Prisma**로 대체하자.

### 16.13.1 Prisma 모델
```prisma
model Todo {
  id        String   @id @default(cuid())
  userId    String
  title     String
  done      Boolean  @default(false)
  version   Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Note {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String   @default("")
  tags      String[] @db.Text[]
  version   Int      @default(1)
  updatedAt DateTime @updatedAt
}
```

### 16.13.2 라우트 예(일부)
```ts
// src/routes/api/todos/+server.ts
import { prisma } from '$lib/server/prisma';
import { TodoCreate } from '$lib/schema/todo';
import { json, bad } from '$lib/utils/http';

export const GET = async ({ locals }) => {
  const items = await prisma.todo.findMany({ where:{ userId: locals.user.id }, orderBy:{ createdAt: 'desc' }, take: 100 });
  return json({ items }, { headers: { 'cache-control':'no-store' }});
};

export const POST = async ({ locals, request }) => {
  const body = await request.json().catch(()=> ({}));
  const val = TodoCreate.safeParse(body);
  if (!val.success) return bad(val.error.flatten());
  const item = await prisma.todo.create({ data: { userId: locals.user.id, title: val.data.title }});
  return json(item, { status:201 });
};
```

> 프런트에서는 `fetch('/api/todos')`를 통해 동일 UI로 동작. 액션 기반/REST 병행도 가능.

---

## 16.14 캐싱/무효화

- `+page.ts`에서 `depends('/api/todos')` → 항목 변경 시 `invalidate('/api/todos')`  
- API에 `ETag`를 달아 조건부 요청 → 중복 데이터 전송 축소  
- 읽기 위주의 노트 목록은 `stale-while-revalidate`(SWR) 패턴(브라우저 캐시 + 백그라운드 갱신)

```ts
// 예시: GET 응답 헤더
'cache-control': 'public, max-age=30, stale-while-revalidate=120'
```

---

## 16.15 테스트(요약)

### 유닛/컴포넌트
- 스토어 로직(추가/토글/삭제)  
- AddTodo 컴포넌트: 입력 트리밍, 디스패치

### E2E(Playwright)
- `/todos` 방문 → 추가 → 완료 → 삭제  
- `/notes` 방문 → 생성 → 제목/내용 수정 → 저장 메시지

> 13장에서 제시한 설정을 그대로 옮겨 쓰면 된다.

---

## 16.16 배포 포인트

- **어댑터-노드**: PM2/Docker. 이미지 변환 없음 → 간단  
- **Vercel/Netlify**: 액션/엔드포인트는 Functions로, DB는 HTTP/Accelerate  
- **Cloudflare**: Edge 친화 API만 사용(노트 미리보기 마크다운 파서는 동적 import로 브라우저 전용 처리)

보안:
- CSRF: SvelteKit 기본 `csrf.checkOrigin: true`  
- 세션 쿠키: `HttpOnly`, `SameSite=Lax`, `Secure`  
- 로깅: 구조적 JSON, 요청 ID(`rid`), 에러는 Sentry 전송(14장 참고)

---

## 16.17 확장 과제

1) **드래그앤드롭**으로 ToDo 정렬 → 서버 `PATCH /todos/reorder` + 낙관적 순서 업데이트  
2) **태그 필터/검색**: `/api/search` 개선, 키워드 하이라이트  
3) **이미지 첨부**: 노트에 이미지 업로드(10장 파일 업로드 파이프라인 재사용)  
4) **동기화**: 오프라인 입력 큐 → 온라인 복구 시 배치 전송  
5) **실시간**: 서버 SSE/웹소켓(노드 어댑터)로 다중 클라이언트 동기화

---

## 16.18 요약

- **스토어**는 클라이언트 UX(낙관/임시 상태)에 집중, **서버 액션**은 검증·권한·저장 담당.  
- **`use:enhance`**로 AJAX 제출 + 폼 기본 동작(서버 우선)을 동시에 만족.  
- **버전 필드**로 낙관적 UI 충돌을 다루고, 실패 시 **토스트/포커스 이동**으로 피드백.  
- 운영을 염두에 두고 **캐싱/무효화/로깅/오류 추적**을 내장하는 것이 유지보수의 핵심.  
