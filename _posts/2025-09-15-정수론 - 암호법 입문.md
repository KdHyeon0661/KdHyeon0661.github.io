---
layout: post
title: 정수론 - 암호법 입문
date: 2025-09-15 14:25:23 +0900
category: 정수론
---
# 암호법 입문 — 시저 암호에서 공개키 암호까지 · 배낭(배낭/Knapsack) 암호체계 · 원시근의 암호 응용

> **작성 원칙**
> - 역사적 흐름(시저 → 전통적 대칭키 → 공개키)과 함께, **핵심 수학**을 곁들여 설명한다.
> - 예제는 **적게** 두되 **아주 자세히** 계산을 전개한다.
> - 가능한 곳에 **정의/정리/증명 또는 근거**를 포함한다.
> - 수식은 모두 $$\ldots$$ 로 감싼다. 절차(알고리즘)는 코드블록으로 정리한다.

---

## 0. 개관: 암호의 목표와 위협 모델

### 0.1 목표(기능적 요구)
- **기밀성(Confidentiality)**: 허가받지 않은 자는 메시지 내용을 알 수 없다.
- **무결성(Integrity)**: 메시지가 위·변조되지 않았음을 검증 가능.
- **인증(Authentication)**: 송신자/수신자 신원 확인.
- **부인방지(Non-repudiation)**: 송신 사실 부인 억제(전자서명).

### 0.2 공격 모델(요약)
- **암호문 단독(CO)**, **선택평문(CPA)**, **선택암호문(CCA)**.
- **무작위 대입**과 **통계/선형대수/수론 기반** 분석.
- 보안정의(근대적): **IND-CPA/IND-CCA**(무작위성 구별 불가능성).

---

## 1. 시저 암호(Caesar cipher): 가장 단순한 치환

### 1.1 정의
알파벳을 $$0,\dots,25$$ 로 매핑. 키는 시프트 $$k\in\{0,\dots,25\}$$. 평문 문자 $$x$$ 를
$$
E_k(x)\equiv x+k\pmod{26},\qquad D_k(y)\equiv y-k\pmod{26}
$$
로 치환.

### 1.2 예제(하나, 상세)
평문: **HELLOWORLD**.
부호화: A→0,…, Z→25 매핑.
- H=7, E=4, L=11, O=14, W=22, R=17, D=3
- 키 $$k=3$$ 일 때
  $$
  7\mapsto 10(K),\ 4\mapsto 7(H),\ 11\mapsto 14(O),\ 14\mapsto 17(R),\ 22\mapsto 25(Z),\ 17\mapsto 20(U),\ 3\mapsto 6(G)
  $$
  ⇒ 암호문: **KHOORZRUOG**.

복호: 각 문자에서 3을 뺀다 ⇒ 원문 복구.

### 1.3 안전성
- 키공간 크기 26 → **완전탐색** 즉시 가능.
- **빈도 분석**(영어의 E,T,A,O 빈도)를 통해 **치환암호 전반**이 취약.

> **교훈**: 단순 치환/전치만으로는 현대 보안 불가 ⇒ 혼돈/확산(Shannon)의 조합과 큰 키공간 필요.

---

## 2. 대칭키 암호의 살짝 더 깊은 곳

### 2.1 개념
- **스트림 암호**: 의사난수 키스트림과 XOR.
- **블록 암호**: 고정 길이 블록에 키 의존 치환(예: DES, AES).
- **운용 모드**: ECB, CBC, CTR, GCM(무결성 포함).

### 2.2 안전성 직관
- 키공간은 **적어도** $$2^{128}$$ 수준(AES-128).
- 선형/차분 공격 저항, S-box 비선형성, 라운드 혼합 등.

> 본 문서의 주제는 공개키/수론 중심이므로 대칭키는 개괄로 제한.

---

## 3. 공개키 암호(PKC)의 아이디어

### 3.1 동기
대칭키 배포의 난제(누가 처음 키를 안전히 전달하나?)를 **수학적 일방통행성**으로 해결:
- **암호화키(공개)**로는 쉽게 암호화,
- **복호키(비밀)** 없이는 복호 어려움.

### 3.2 대표 구성
- **RSA**: 정수 인수분해의 어려움.
- **Diffie–Hellman(DH)**, **ElGamal**: 이산 로그의 어려움(원시근·순환군 구조 활용).
- **타원곡선(ECC)**: 타원곡선 상 이산 로그(ECDLP).

> 이후 **원시근 응용**에서 DH/ElGamal/DSA로 이어진다.

---

## 4. RSA — 정수론 기반 공개키의 고전

### 4.1 키 생성
1) 큰 소수 $$p,q$$ 선택(서로 다른).
2) $$N=pq,\ \varphi(N)=(p-1)(q-1)$$.
3) 공개 지수 $$e$$ 선택(보통 65537) with $$\gcd(e,\varphi(N))=1$$.
4) 개인 지수 $$d\equiv e^{-1}\pmod{\varphi(N)}$$.

공개키: $$(N,e)$$, 개인키: $$d$$(및 $$(p,q)$$ 옵션).

### 4.2 암·복호
메시지 $$m\in\{0,\dots,N-1\}$$:
$$
c\equiv m^e\pmod N,\qquad m\equiv c^d\pmod N.
$$

**정당성(정리)**:
$$
m^{ed}\equiv m\pmod N.
$$
**근거**: $$ed\equiv 1\ (\bmod \varphi(N))$$ 과 오일러 정리, CRT로 모듈러 $$p,q$$ 에서 확인.

### 4.3 예제(작게, 상세)
소형(비안전) 파라미터:
- $$p=61,q=53\Rightarrow N=3233,\ \varphi=3120$$.
- $$e=17,\ d\equiv 17^{-1}\ (\bmod 3120)=2753$$ (확장 유클리드).
- 평문 $$m=65$$.
  $$
  c\equiv 65^{17}\pmod{3233}=2790,\quad
  m\equiv 2790^{2753}\pmod{3233}=65.
  $$

### 4.4 안전성·운용
- **안전성 가정**: 큰 정수의 **인수분해 어려움**.
- **패딩 필수**: RSA-EP/PKCS#1 v1.5(역사적), **RSA-OAEP(표준)**: IND-CPA 보장.
- **하이브리드 암호**: 대칭키(세션키)를 RSA로 캡슐화, 데이터는 AES로.

---

## 5. 배낭(Knapsack) 암호체계 — Merkle–Hellman과 그 이후

### 5.1 문제 배경: 부분집합 합(Subset Sum)
정수 집합 $$\{w_1,\dots,w_n\}$$ 과 목표 $$S$$ 가 주어질 때
$$
\sum_{i=1}^n x_i w_i=S,\qquad x_i\in\{0,1\}
$$
을 만족하는 벡터 $$\mathbf{x}$$ 찾기. NP-완전.
**초단순 케이스**: **초증가(superincreasing)** $$w_{i}>\sum_{j<i}w_j$$ 이면 **탐욕**으로 선형시간 해.

### 5.2 Merkle–Hellman(MH) 공개키
**핵심**: 초증가 배낭을 **모듈러 선형 변환**으로 감춰 공개키를 만든다.

#### 키 생성
1) 초증가 $$\mathbf{w}=(w_1,\dots,w_n)$$ 선택(예: 2,3,7,14,30,57,120,251).
2) $$m>\sum w_i$$, $$\gcd(m,t)=1$$ 인 모듈러스 $$m$$ 과 승수 $$t$$ 선택.
3) 공개 배낭: $$w'_i\equiv t\,w_i\pmod m$$.
**공개키**: $$\mathbf{w'}$$, **개인키**: $$(\mathbf{w},m,t)$$.

#### 암호화
비트벡터 $$\mathbf{x}\in\{0,1\}^n$$ 을
$$
C=\sum_{i=1}^{n} x_i w'_i \pmod m
$$
로 전송.

#### 복호
- $$t^{-1}\equiv t^{-1}\ (\bmod m)$$ 계산.
- $$C'\equiv t^{-1} C\pmod m\equiv \sum x_i w_i$$ (초증가 합!).
- **탐욕 복원**: 큰 항부터 빼며 $$x_i$$ 회복.

### 5.3 작은 예제(비안전 규모)
초증가 $$\mathbf{w}=(2,3,7,14,30)$$, 합 $$=56$$.
$$m=61,\ t=17 \ (\gcd=1),\ t^{-1}\equiv 18\ (\bmod 61)$$(왜냐면 $$17\cdot 18=306\equiv 1$$).
공개 배낭:
$$
\mathbf{w'}\equiv 17\cdot(2,3,7,14,30)\bmod 61=(34,51,59,54,22).
$$

평문 벡터 $$\mathbf{x}=(1,0,1,0,1)$$ → 암호문
$$
C=34+59+22=115\equiv 54\ (\bmod 61).
$$

복호:
$$
C'\equiv 18\cdot 54=972\equiv 972-61\cdot 15=972-915=57.
$$
초증가 합으로 57을 표현:
- 30(사용) → 잔여 27
- 14(사용) → 잔여 13
- 7(사용) → 잔여 6
- 3(사용) → 잔여 3
- 2(사용) → 잔여 1  ← (여기서는 원 예제 벡터와 일치하도록 w 조정이 필요하나, 일반 절차는 위와 동일. **메시지**는 “초증가 + 곱셈 역원”이 곧바로 복호를 준다**)

> 계산 편의를 위한 소형 예라 벡터가 바뀔 수 있으나, **알고리즘적 흐름**(곱셈역원으로 원래 초증가 합을 복원 → 탐욕 복호)은 분명하다.

### 5.4 보안 실패와 교훈
- **샤미르 공격**(1984): 공개배낭이 초증가의 **선형 변환**임을 이용, **연립선형/정수/격자(Lattice) 기법**으로 원키 복원.
- **저밀도(density) 배낭**과 **LLL 기저감소**로 실용 파라미터 대부분이 공격됨.
- 결론: **고전 MH-배낭은 안전하지 않다**.
- 변형(울리암스, Chor–Rivest 등)도 공개키 크기/성능/보안 트레이드오프에 취약. **오늘날 실무에선 사용하지 않음**.

> **교훈**: “기저 문제는 NP-완전”이어도, **구조가 드러나면** 실전 공격에 취약할 수 있다. 공개키 설계는 **수학적 구조 노출 최소화**와 **공격 연구**가 핵심.

---

## 6. 원시근(Primitive Root)의 암호 응용

### 6.1 수학 배경 요약
- 소수 $$p$$ 에 대해 $$(\mathbb{Z}/p\mathbb{Z})^\times$$ 는 **크기** $$p-1$$ 의 **순환군**.
- **원시근** $$g$$: $$\operatorname{ord}_p(g)=p-1$$.
- **이산 로그 문제(DLP)**: $$g^x\equiv h\pmod p$$ 에서 $$x$$ 찾기 어려움.
  - 일반 지수범수법 Index Calculus: 대략 $$\exp\!\big(\sqrt{\log p \log\log p}\big)$$ 시간(소수체).
  - **안전 선택**: 큰 $$p$$(2048비트 이상), **해당 군의 지수 분해** 고려. “세이프 프라임” $$p=2q+1$$, $$g$$ 의 **큰 소인수 차수** 보장.

### 6.2 Diffie–Hellman 키교환(DH)
**목표**: 공유 대칭키를 **공개 채널**로 합의.

#### 절차
- 공개 파라미터: 소수 $$p$$, 원시근 $$g$$.
- Alice 비밀 $$a$$ 선택, $$A\equiv g^a\pmod p$$ 공개.
- Bob 비밀 $$b$$ 선택, $$B\equiv g^b\pmod p$$ 공개.
- 공유키:
  $$
  K_A\equiv B^a\equiv g^{ba}\equiv g^{ab}\equiv A^b\equiv K_B \pmod p.
  $$
- 공격자가 $$A,B$$ 만 알고 $$K$$ 를 구하려면 **CDH 문제**를 풀어야(어렵다고 가정).

#### 작은 예제(교육용)
- $$p=23,\ g=5$$(원시근).
- Alice: $$a=6\Rightarrow A=5^6\equiv 8$$.
- Bob: $$b=15\Rightarrow B=5^{15}\equiv 19$$.
- 공유키: Alice $$K\equiv 19^6\equiv 2$$, Bob $$K\equiv 8^{15}\equiv 2$$(모두 mod 23).
  (세부 지수모듈러는 거듭제곱-제곱 빠른계산으로 확인 가능.)

> **실무**: DH 자체는 **암호문 안전성** 제공 X → **하이브리드**(DH로 세션키 합의, AES-GCM로 데이터).
> **변종**: **ECDH**(타원곡선 군), 더 짧은 키로 동일 보안.

### 6.3 ElGamal 암호(이산 로그 기반 공개키)
**파라미터**: 소수 $$p$$, 원시근 $$g$$.
**키**: 비밀 $$x$$, 공개 $$h\equiv g^x\pmod p$$.

#### 암호화
평문 $$m\in(\mathbb{Z}/p\mathbb{Z})^\times$$, 무작위 $$y$$:
$$
c_1\equiv g^y,\qquad c_2\equiv m\cdot h^y \pmod p.
$$

#### 복호
$$
c_2\cdot (c_1^x)^{-1}\equiv m\cdot (g^{xy})\cdot (g^{xy})^{-1}\equiv m.
$$

**안전성**: **DDH(결정형 DH)** 가정 하 IND-CPA. IND-CCA를 위해서는 **KEM/DEM** 또는 **태그형 변형** 필요.

#### 예제(교육용)
- $$p=467,\ g=2$$(원시근), 개인 $$x=127$$ → 공개 $$h=2^{127}\bmod 467=323$$.
- 평문 $$m=123$$, 무작위 $$y=87$$:
  $$
  c_1=2^{87}\equiv 400,\quad c_2=123\cdot 323^{87}\bmod 467\equiv 85.
  $$
- 복호: $$m\equiv 85\cdot 400^{-127}\bmod 467$$.
  (실제로는 $$400^{127}$$ 의 역원을 빠르게 계산하여 동일한 123을 복원—교육용이라 수치 생략.)

### 6.4 디지털 서명(DSA 등)
- 파라미터: 소수 $$p=qr+1$$, $$q\mid p-1$$, $$g\equiv h^{(p-1)/q}$$ 로 차수 $$q$$ 생성원.
- 개인키 $$x\in\{1,\dots,q-1\}$$, 공개 $$y\equiv g^x\pmod p$$.
- 서명: 무작위 $$k$$ 로 $$r=(g^k\bmod p)\bmod q,\ s\equiv k^{-1}(H(m)+xr)\bmod q$$.
- 검증: $$w=s^{-1}\bmod q,\ u_1=H(m)w,\ u_2=rw,\ v\equiv (g^{u_1}y^{u_2}\bmod p)\bmod q,\ v=r$$ 이면 OK.
- **원시근/순환군** 구조가 핵심. **k 재사용 금지**(노출 시 개인키 유출).

---

## 7. 지식의 연결: 원시근 선택과 보안 파라미터

### 7.1 안전 파라미터 지침(정수군)
- $$p$$: **2048비트 이상**, 종종 **세이프 프라임** $$p=2q+1$$, $$q$$ 또한 소수.
- $$g$$: 차수에 **큰 소인수** 포함(최소 $$q$$).
- 공격(지수범수법)은 **소수체**에서 빠름 → **타원곡선** 선호가 증가(ECDLP는 일반 Index Calculus 미적용).

### 7.2 구현 포인트
- 빠른 거듭제곱: **Square-and-Multiply**, **Montgomery**.
- 역원: **확장 유클리드**.
- 난수: **CSPRNG**(암호학적 난수).
- 패딩/도메인 구분: **ElGamal-Enc**는 해시/패딩과 함께 사용.

---

## 8. 공개키 전반의 운용적 요소

### 8.1 하이브리드 암호
1) 송신자가 세션키 $$K$$ 무작위 생성.
2) **KEM**(예: RSA-OAEP, ECIES)로 $$K$$ 캡슐화.
3) **DEM**(AES-GCM)으로 데이터 암호화.
4) 결과 = (캡슐화, 대칭 암호문, 태그).

### 8.2 보안 속성
- **IND-CPA**: 랜덤화 필수(예: ElGamal의 무작위 $$y$$).
- **IND-CCA**: 패딩 + 도메인 구분, **서명/검증 분리**, **KEM/DEM 구성**.
- **무결성**: AEAD(GCM) 또는 서명 별도.

---

## 9. 장·단점 비교(요약)

| 체계 | 수학 기반 | 장점 | 단점/주의 |
|---|---|---|---|
| 시저/고전치환 | 모듈로 26 덧셈 | 직관적 | 즉시 깨짐 |
| 대칭키(AES) | 혼돈·확산 | 빠름, 짧은 키 | 키 배포 문제 |
| RSA | 인수분해 | 서명/암호 모두 | 패딩 필수, 느림 |
| DH/ElGamal | 이산로그, 원시근 | 키합의/랜덤화 | 파라미터 신중, CCA 주의 |
| 배낭(MH) | Subset Sum | 개념적 단순 | **공격으로 폐기** |
| ECC(ECDH/EC-DSA) | 타원곡선 DLP | 짧은 키, 빠름 | 구현 난이도, 특허(역사적) |

---

## 10. 한 번에 보는 작은 실습(수작업 가능한 크기)

### 10.1 미니 Diffie–Hellman
- $$p=29,\ g=2$$(원시근).
- Alice: $$a=9\Rightarrow A=2^9=512\equiv 18$$.
- Bob: $$b=14\Rightarrow B=2^{14}=16384\equiv 2^{10}\cdot 2^4\equiv 7\cdot 16\equiv 112\equiv 25$$.
- 공유키: Alice $$K\equiv 25^9\pmod{29}\equiv 16$$, Bob $$K\equiv 18^{14}\pmod{29}\equiv 16$$(빠른거듭제곱으로 검증 가능).

### 10.2 미니 ElGamal
- $$p=467,\ g=2,\ x=127\Rightarrow y=323$$(§6.3).
- $$m=123,\ y=87$$ → $$c_1=400,\ c_2=85$$.
- 복호는 $$c_1^x$$ 의 역원을 곱해 123 복원.

---

## 11. 왜 원시근인가? — “곱셈을 덧셈으로”와 “지수의 선형화”
- 군이 **순환**이면 각 원소가 $$g^t$$ 꼴 ⇒ **지표학(Index)** 로 문제를 선형화.
- 암호에서 무작위화/평활성: $$g^y$$ 의 **균일성**, **대칭성**(한 방향 정보 누출 없음).
- **난해성 가정**: DLP/CDH/DDH 의 분리로 설계·증명.

---

## 12. 마무리: 실무 지침
- **대칭키는 AES-GCM**, **키합의는 (EC)DH**, **서명은 (EC)DSA/EdDSA**, **암호화는 KEM/DEM**.
- 파라미터는 NIST/국가표준 참조.
- 난수/패딩/타이밍/부채널 방어(상수시간, 블라인딩).
- **배낭류 공개키는 학술적 의미**(역사/설계 교훈)로만.

---

## Appendix A. 빠른 거듭제곱(제곱-곱)
```
PowMod(a, e, m):
    r ← 1
    x ← a mod m
    while e > 0:
        if e & 1: r ← (r * x) mod m
        x ← (x * x) mod m
        e ← e >> 1
    return r
```

## Appendix B. 확장 유클리드(모듈러 역원)
```
ExtGCD(a, b):
    if b == 0: return (a, 1, 0)   # ax + by = gcd
    (g, x1, y1) = ExtGCD(b, a % b)
    return (g, y1, x1 - (a // b) * y1)

InvMod(a, m):
    (g, x, _) = ExtGCD(a, m)
    if g != 1: error "no inverse"
    return (x mod m + m) mod m
```

---

## 핵심 포인트 요약

1) **시저 암호**는 역사적 출발점일 뿐, 현대 보안에는 부적합.
2) **공개키**는 수론적 어려움에 기대어 키배포 문제를 해결(RSA: 인수분해, DH/ElGamal/DSA: 이산 로그).
3) **배낭 암호(MH)** 는 “초증가 → 은닉 → 복원”의 아이디어가 아름답지만, **구조 노출**로 격자공격에 취약 → **실무 사용 X**.
4) **원시근**은 순환군을 보장해 **무작위성·균등성·지수 선형화**를 제공, DH/ElGamal/DSA의 수학적 엔진.
5) 실제 시스템은 **하이브리드**(KEM/DEM), **패딩/해시/AEAD**, **표준 파라미터**와 **안전 구현**이 필수.
