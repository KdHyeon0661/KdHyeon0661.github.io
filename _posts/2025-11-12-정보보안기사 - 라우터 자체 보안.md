---
layout: post
title: 정보보안기사 - 라우터 자체 보안
date: 2025-11-12 10:25:23 +0900
category: 정보보안기사
---
# SECTION 06 라우터 보안 — 01. 라우터 자체 보안(관리/제어/데이터 플레인 하드닝, AAA·접근제어·로그/NTP·SNMPv3, CoPP/라우팅 프로토콜 보안, iACL/VRF, 펌웨어·구성 무결성, 벤더별 예제: Cisco IOS/XE·JunOS·Linux Router/FRR)

> 목적: 실무에서 즉시 적용 가능한 **라우터 자체 하드닝 표준**을 제시한다.
> 범위: **관리플레인/제어플레인/데이터플레인** 분리 → **AAA·접근제어·암호키·로그/NTP/SNMPv3** → **CoPP/라우팅 프로토콜 보안(BGP/OSPF)** → **iACL/관리 VRF** → **펌웨어/부팅보안/백업** → **검증·운영·트러블슈팅**.
> 원칙: 공격/침투가 아닌 **방어/구성/점검**에 한정. 예제는 랩 환경(사설 IP) 기준.

---

## 위협모델과 “3 플레인” 프레임
### 위협모델(예시)

- **원격관리면** 탈취(약한 암호/평문 관리 프로토콜), 인증 우회, 브루트포싱
- **제어플레인** 남용: 라우팅 프로토콜 위조/세션 reset, CPU 고갈(DoS)
- **데이터플레인** 악용: 인프라 주소로의 불필요한 트래픽 유입, 리플렉션/증폭, 피어 간 스푸핑

### 관리/제어/데이터 플레인

| 플레인 | 대상 | 대표 리스크 | 대표 통제 |
|---|---|---|---|
| **관리(Management)** | SSH/NETCONF/RESTCONF/SNMP·Syslog·NTP | 평문/Telnet·무차별 로그인·부정 관리경로 | AAA, mgmt VRF, VTY ACL, 키/인증서, SNMPv3 |
| **제어(Control)** | BGP/OSPF/IS-IS, ICMP redirect, ARP, ND | 라우팅 조작·CPU DoS | CoPP/CPPr, 프로토콜 인증, TTL-S, iACL |
| **데이터(Data/Forwarding)** | 일반 포워딩 트래픽 | 인프라 대상 스캔/DoS | iACL(인프라 ACL), 분산 필터, NetFlow로 가시성 |

---

## 베이스라인 하드닝 체크리스트(요약)

- [ ] **SSHv2 전용**(키 인증/강한 암호군), **Telnet·HTTP 비활성화**(HTTPS만)
- [ ] **AAA(TACACS+/RADIUS) + 로컬 fallback**, 권한 분리(역할 기반/privilege level)
- [ ] **VTY ACL/Management Plane Protection**, **관리 VRF/OOB** 사용
- [ ] **SNMPv3(authPriv)**, 뷰 제한, 구 SNMP community 제거
- [ ] **Syslog(원격) + 타임스탬프 + NTP(인증)**, config 자동 백업/아카이브
- [ ] **CoPP/CPPr**: 제어 트래픽 클래스화/폴리싱
- [ ] **라우팅 프로토콜 인증/TS/TTL-S/Max-Prefix**, 수신 경로 필터/ROA 활용
- [ ] **iACL**: 라우터 자체 주소군으로 향하는 트래픽 최소 허용
- [ ] **펌웨어/부팅 보안(서명·Secure Boot)**, 불필요 서비스 비활성화, 콘솔/ROMMON 보호
- [ ] **암호/비밀**: salt/강한 해시(type 9/sha512), 키 롤테이션, 구성 내 평문 제거

---

## 공통 구성 원칙(벤더 불문)

1) **기본 거부(deny-all) + 명시적 허용**
2) **관리 경로 분리**: mgmt 전용 VRF/VLAN/OOB 링크
3) **최소 권한**: 운영/관제/외주 계정 분리, 짧은 세션 타임아웃, 실패 차단
4) **시간/로그 신뢰**: NTP 인증 + millisecond 타임스탬프 + 중앙 Syslog
5) **구성·이미지 무결성**: 이미지 서명 검증, golden config/firmware 유지

---

## Cisco IOS/XE 하드닝 예제

### 관리 접근(SSHv2·VTY ACL·로그인 보호)

```cisco
! 도메인/호스트명/암호정책
service password-encryption                 ! (주의) 레거시 type 7; 'secret'를 우선 사용
hostname R1
ip domain-name corp.example

! 로컬 사용자 (type 9 = scrypt 권장, IOS-XE 최신)
username netop privilege 15 algorithm-type scrypt secret <STRONG_SECRET>

! SSH만 허용, Telnet/HTTP 비활성
ip ssh version 2
ip ssh server algorithm encryption aes256-ctr aes256-gcm
ip ssh server algorithm mac hmac-sha2-256
ip http server           ! 비활성화 권장: 'no ip http server'
no ip http server
ip http secure-server    ! HTTPS만 필요 시 활성
ip http authentication local

! VTY 라인 보호 (관리망만 허용)
ip access-list standard ACL-MGMT-VTY
  permit 10.100.0.0 0.0.0.255
  deny   any
line vty 0 4
 access-class ACL-MGMT-VTY in
 transport input ssh
 exec-timeout 5 0
 login local
 login block-for 60 attempts 5 within 60
!
banner login ^CUnauthorized access prohibited.^C
service tcp-keepalives-in
```

### + 로컬 fallback

```cisco
aaa new-model
aaa authentication login default group radius local
aaa authorization exec default group radius local if-authenticated
aaa accounting exec default start-stop group radius

radius server RADIUS1
 address ipv4 10.100.10.10 auth-port 1812 acct-port 1813
 key <RADIUS_KEY>
! 또는 TACACS+:
! tacacs server TAC1
!  address ipv4 10.100.10.20
!  key <TACACS_KEY>
```

### 시간/로그: NTP 인증 + Syslog

```cisco
ntp authenticate
ntp authentication-key 10 md5 <NTP_KEY> 7
ntp trusted-key 10
ntp server 10.100.20.20 key 10 prefer

service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
logging buffered 32000 warnings
logging trap informational
logging host 10.100.30.30 transport udp port 514
```

### + View 제한

```cisco
snmp-server view SYSVIEW iso included
snmp-server group NMS v3 priv read SYSVIEW write SYSVIEW
snmp-server user nms NMS v3 auth sha <AUTHKEY> priv aes 256 <PRIVKEY> access SYSVIEW
no snmp-server community public
no snmp-server community private
```

### — 라우터 자신으로 향하는 트래픽 최소화

```cisco
ip access-list extended ACL-INFRA-IN
 remark Allow mgmt from NMS
 permit tcp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 22
 permit udp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 161
 remark Allow BGP from peers
 permit tcp 198.51.100.2 0.0.0.0 host 203.0.113.1 eq 179
 remark Permit necessary ICMP (PMTUD)
 permit icmp any host 203.0.113.1 echo-reply
 deny   ip any host 203.0.113.1 log
interface GigabitEthernet0/0
 ip access-group ACL-INFRA-IN in
```

### CoPP(Control Plane Policing)

```cisco
class-map match-any CM-ROUTING
 match protocol bgp
 match protocol ospf
class-map match-any CM-SSH
 match access-group name ACL-SSH
ip access-list extended ACL-SSH
 permit tcp 10.100.0.0 0.0.0.255 any eq 22

policy-map PM-COPP
 class CM-ROUTING
  police 64000 8000 conform-action transmit exceed-action drop
 class CM-SSH
  police 32000 4000 conform-action transmit exceed-action drop
 class class-default
  police 8000 1000 conform-action transmit exceed-action drop

control-plane
 service-policy input PM-COPP
```

### 라우팅 보안(BGP/OSPF)

```cisco
! BGP - TTL Security / Max-Prefix / MD5(auth)
router bgp 65001
 neighbor 198.51.100.2 remote-as 65002
 neighbor 198.51.100.2 ttl-security hops 2
 neighbor 198.51.100.2 password <MD5_KEY>
 neighbor 198.51.100.2 timers 30 90
 neighbor 198.51.100.2 maximum-prefix 20000 80 restart 5

! OSPFv2 - SHA 인증
interface GigabitEthernet0/1
 ip ospf message-digest-key 1 md5 <KEY>     ! (최신은 hmac-sha)
 ip ospf authentication message-digest
```

### 관리 VRF/OOB

```cisco
vrf definition MGMT
 address-family ipv4
 exit-address-family
interface GigabitEthernet0
 vrf forwarding MGMT
 ip address 10.100.0.2 255.255.255.0
ip route vrf MGMT 0.0.0.0 0.0.0.0 10.100.0.1
line vty 0 4
 transport input ssh
 access-class ACL-MGMT-VTY in vrf-also
```

---

## Juniper JunOS 하드닝 예제

### 시스템/서비스/SSH 정책

```junos
set system host-name R1
set system domain-name corp.example
set system login user netop class super-user authentication encrypted-password "$6$sha512hash"
set system authentication-order radius password

set system services ssh protocol-version v2
set system services ssh ciphers aes128-ctr aes256-ctr chacha20-poly1305@openssh.com
set system services netconf ssh
delete system services telnet
delete system services web-management http
set system services web-management https system-generated-certificate
```

### Syslog/NTP/SNMPv3

```junos
set system ntp authentication-key 10 type md5 value "NTP_KEY"
set system ntp trusted-key 10
set system ntp server 10.100.20.20 key 10 prefer

set system syslog host 10.100.30.30 any info
set system syslog file messages any any

set snmp view SYSVIEW oid .1 include
set snmp v3 usm local-engine user nms authentication-sha password AUTHKEY privacy-aes128 password PRIVKEY
set snmp v3 vacm security-to-group security-model usm security-name nms group NMS
set snmp v3 vacm access group NMS default-context-prefix security-model usm security-level privacy read-view SYSVIEW
```

### 루프백/lo0 제어(Receive Protect = iACL 개념)

```junos
set firewall family inet filter PROTECT-LO0 term ALLOW-MGMT from source-address 10.100.0.0/24
set firewall family inet filter PROTECT-LO0 term ALLOW-MGMT from protocol tcp destination-port [22 161 830]
set firewall family inet filter PROTECT-LO0 term ALLOW-MGMT then accept
set firewall family inet filter PROTECT-LO0 term ALLOW-BGP from source-address 198.51.100.2/32
set firewall family inet filter PROTECT-LO0 term ALLOW-BGP from protocol tcp destination-port 179
set firewall family inet filter PROTECT-LO0 term ALLOW-BGP then accept
set firewall family inet filter PROTECT-LO0 term PMTUD from protocol icmp icmp-type [echo-reply time-exceeded destination-unreachable]
set firewall family inet filter PROTECT-LO0 term PMTUD then accept
set firewall family inet filter PROTECT-LO0 term DEFAULT then discard

set interfaces lo0 unit 0 family inet filter input PROTECT-LO0
```

### 예시

```junos
set firewall policer PL-SSH if-exceeding bandwidth-limit 64k burst-size-limit 8k
set firewall family inet filter PROTECT-LO0 term SSH from protocol tcp destination-port 22
set firewall family inet filter PROTECT-LO0 term SSH then policer PL-SSH
set firewall family inet filter PROTECT-LO0 term SSH then accept
```

### BGP/OSPF 보안

```junos
set protocols bgp group EDGE type external
set protocols bgp group EDGE peer-as 65002
set protocols bgp group EDGE neighbor 198.51.100.2 authentication-key "$9$md5hash"
set protocols bgp group EDGE neighbor 198.51.100.2 ttl 2
set protocols bgp group EDGE neighbor 198.51.100.2 family inet unicast
set protocols bgp group EDGE neighbor 198.51.100.2 keep all
set protocols bgp group EDGE export OUT-FILTER
set policy-options policy-statement OUT-FILTER then next policy

set protocols ospf area 0 interface ge-0/0/1.0 authentication md5 1 key <KEY>
```

---

## Linux Router/FRR 하드닝 예제

### OS 커널 보안/라우팅 관련 sysctl

```bash
cat >/etc/sysctl.d/99-router.conf <<'EOF'
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.rp_filter = 1          # 엄격 모드: 필요시 2(루즈) 고려
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.tcp_syncookies = 1
net.ipv6.conf.all.accept_ra = 0
EOF
sysctl --system
```

### nftables로 관리면 보호 + iACL

```bash
# nftables 예시 (관리망 10.100.0.0/24만 SSH)

nft add table inet filter
nft add chain inet filter input { type filter hook input priority 0; policy drop; }
nft add rule inet filter input ct state established,related accept
nft add rule inet filter input iif "lo" accept
nft add rule inet filter input ip saddr 10.100.0.0/24 tcp dport 22 accept
nft add rule inet filter input ip saddr 198.51.100.2 tcp dport 179 accept  # BGP
nft add rule inet filter input icmp type { echo-reply, time-exceeded, destination-unreachable } accept
```

### — 인증/TTL-S

```bash
# /etc/frr/bgpd.conf

router bgp 65001
 bgp router-id 203.0.113.1
 neighbor 198.51.100.2 remote-as 65002
 neighbor 198.51.100.2 password <MD5>
 neighbor 198.51.100.2 ttl-security hops 2
 !
 address-family ipv4 unicast
  network 203.0.113.0/24
 exit-address-family

# /etc/frr/ospfd.conf

router ospf
 network 10.10.0.0/16 area 0
 area 0 authentication message-digest
 ip ospf message-digest-key 1 md5 <KEY>
```

---

## 라우팅 프로토콜 보안 — 실무 포인트

- **BGP**:
  - **TTL Security(EBGP multi-hop 회피)**, **MD5/TCP-AO 인증**, **max-prefix**로 루트 폭주 방지
  - **In/Out 정책**: 프리픽스 리스트·ROUTE-MAP으로 광고/수신 필터
  - **RPKI/ROA 검증**(가능한 장비/OS에서)
- **OSPF**:
  - OSPFv2 HMAC-SHA 인증, OSPFv3는 **IPsec(ESP) 기반** 인증·암호화
  - Passive interface 적극 활용(불필요 링크에서 hello 차단)
- **BFD 인증**: 세션 하이재킹·CPU DoS 예방(지원 시)

---

## 제어평면 보호 — CoPP/CPPr 설계 팁

1) **클래스 분리**: 라우팅/BFD·관리(SSH/SNMP)·ICMP·나머지
2) **폴리싱**: kpps/pps 기준으로 CPU queue 포화 방지
3) **“관측 후 강화”**: 초기에는 느슨한 값 → NetFlow/CPU 그래프 보고 미세조정
4) **로깅 주의**: 과도한 log는 되레 CPU를 잡아먹음

---

## — 데이터플레인에서 라우터 보호

- 엣지 인터페이스 inbound에 **iACL** 적용: 라우터 자신(루프백/인터페이스 IP)으로 향하는 트래픽을 최소 허용
- 허용: 관리망→SSH/SNMP, 피어→BGP/IGP, PMTUD에 필요한 ICMP
- 차단: 그 외 any→라우터IP

---

## 관리 경로 분리 — OOB/VRF/프로토콜

- **OOB 포트**(예: Cisco `GigabitEthernet0`)를 mgmt VRF에 바인딩
- 관리 트래픽(SSH/SNMP/NETCONF/HTTPS)을 mgmt VRF로만 허용
- 장비 간 **관리 라우팅**은 별도(인터넷과 분리)

---

## 펌웨어·부팅 보안·구성 백업

- **서명된 이미지/패키지**만 설치, 신뢰 CA/체인 확인
- Secure Boot(플랫폼 지원 시) 활성화, ROMMON/bootloader 비밀번호
- **Configuration Archive**: 변경 시 자동 백업(버전/주석)
  - Cisco: `archive path scp://user@10.100.40.40//backups/$h-$t`
  - JunOS: `set system archival configuration transfer-on-commit`

---

## 가시성/모니터링 — Syslog·NetFlow/IPFIX

- **Syslog**: 인증 실패/CoPP drop/프로토콜 상태변화(BGP up/down) 알림
- **NetFlow/IPFIX**: 플로우 기반 가시성으로 스캔·DoS 징후 탐지
```cisco
! Cisco IOS-XE NetFlow
ip flow-export destination 10.100.50.50 2055
ip flow-export version 9
ip flow-cache timeout active 1
interface Gig0/1
 ip flow ingress
 ip flow egress
```

---

## 운영 절차(예시)

1) **자산 식별**: 관리면/제어면/데이터면 요구 파악
2) **기본 하드닝 적용**: SSH·AAA·VTY ACL·SNMPv3·Syslog/NTP
3) **iACL/MPP/VRF**로 관리 경로 분리
4) **CoPP**로 제어면 보호(관측→튜닝)
5) **라우팅 프로토콜 보안**: 인증/TTL-S/Max-Prefix/정책
6) **백업/버전관리**: config/이미지 아카이브
7) **지속 점검**: 스캐너(SSH/TLS/SNMP), NetFlow 대시보드, 변경감사

---

## 트러블슈팅(상황별)

- **SSH 접속 불가**: VTY ACL/VRF 경로/CoPP 폴리싱 초과 여부 확인, 관리망에서만 접속 테스트
- **BGP 세션 flap**: CoPP 과도 제한, TTL-S 불일치, MD5 키 미스매치, MTU·PMTUD 문제
- **CPU 스파이크**: 제어평면에 과다 트래픽 유입 → CoPP 조정·iACL 강화, 로깅 축소
- **SNMP 안 됨**: SNMPv3 view/액세스/ACL·CoPP 확인, 시간 동기 확인(NTP 불일치 시 auth 실패)

---

## 실습: “엣지 라우터 하드닝” 단계별 가이드(랩)

1) **SSH/Telnet/HTTP 정리**: SSHv2만 허용, VTY ACL 작성
2) **AAA 연결**: RADIUS/TACACS+ 구성, 로컬 fallback 검증
3) **Syslog/NTP 인증**: 원격 Syslog 수신 확인, 로그 타임스탬프 일치 검증
4) **SNMPv3 전환**: 커뮤니티 제거, authPriv 계정/뷰 적용
5) **iACL 배치**: 루프백으로의 불필요 트래픽 차단, 관리/피어만 허용
6) **CoPP 적용**: 클래스별 폴리싱, BGP/OSPF/SSH/ICMP 분리
7) **BGP 보안 강화**: TTL-S·MD5·max-prefix·정책 필터
8) **백업/아카이브**: 커밋 시 자동 전송, golden config 보관

---

## 표 — 대표 설정 항목과 권장값(요약)

| 영역 | 항목 | 권장 |
|---|---|---|
| 관리면 | SSH | v2 only, 강한 cipher/mac, 키 인증 우선 |
| 〃 | VTY/관리 경로 | 관리망 ACL, mgmt VRF/OOB |
| 〃 | AAA | RADIUS/TACACS+ + 로컬 fallback, accounting on |
| 가시성 | Syslog/NTP | 원격 Syslog, msec timestamp, NTP 인증 |
| 모니터링 | SNMP | v3 authPriv, view 제한, community 제거 |
| 제어면 | CoPP | 라우팅/관리/ICMP/기타 클래스 분리·폴리싱 |
| 라우팅 | BGP | TTL-S, MD5/TCP-AO, max-prefix, 정책 필터 |
| 데이터면 | iACL | 라우터 IP 대상 트래픽 최소 허용, 나머지 drop |
| 무결성 | 펌웨어/설정 | 서명 이미지, Secure Boot, config archive |
| 인증정보 | 비밀번호/키 | type 9/sha512, 주기적 롤테이션, 평문 제거 |

---

## 점검 스크립트(운영팀 도우미; Cisco IOS-XE 예시)

```cisco
! 간이 점검: 관리면/제어면/로그 상태
show ip ssh
show run | inc "^line vty|transport input|access-class"
show access-lists ACL-MGMT-VTY
show control-plane host open-ports
show policy-map control-plane input
show logging | inc %SEC|%SYS|%BGP
show ntp status
show snmp user
show tcp brief all | inc 22|179
```

---

## 아키텍처 스케치(텍스트)

```
                 [OOB Mgmt]
                     │
        ┌────────────┴────────────┐
        │        MGMT VRF         │  ← SSH/NETCONF/SNMPv3/Syslog/NTP
        └────────────┬────────────┘
                     │
          ┌──────────┴──────────┐
          │      ROUTER R1      │
          │  (CoPP, iACL, AAA)  │
          └──────────┬──────────┘
                     │
       ┌─────────────┴─────────────┐
       │          Uplink            │  ← BGP (TTL-S/MD5), iACL
       └────────────────────────────┘
```

---

## 결론

- 라우터 자체 보안은 **관리면 보호(AAA/VTY ACL/VRF)** + **제어면 보호(CoPP/프로토콜 인증)** + **데이터면 보호(iACL)** 의 삼박자다.
- 여기에 **시간·로그 신뢰, SNMPv3, 백업/무결성, 운영 가시성**을 더하면 장기적으로 안정적이다.
- 본 문서의 템플릿을 “조심스럽게 적용 → 관측 → 점진적 강화” 루프로 운영해라. 초기 과도 제한은 가용성 이슈를 야기할 수 있으니 **관측 기반 튜닝**이 핵심이다.
