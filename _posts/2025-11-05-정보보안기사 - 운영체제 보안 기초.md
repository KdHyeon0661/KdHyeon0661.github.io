---
layout: post
title: 정보보안기사 - 운영체제 보안 기초
date: 2025-11-05 20:25:23 +0900
category: 정보보안기사
---
# 0. 큰그림(One-Page)

- **계정/권한**: 최소권한(Least Privilege), 계정 수명주기(프로비저닝→권한 검토→퇴사/전환), 관리자 계정 분리, 서비스 계정 분리
- **파일시스템**: 권한/소유권/ACL/속성(SUID/SGID/Sticky/Capability), 암호화(At-Rest), 마운트 옵션(`noexec,nodev,nosuid`)
- **서비스 하드닝**: 불필요 서비스 비활성화, 바인드 인터페이스/포트 제한, 샌드박스(systemd, WDAC/AppLocker), 방화벽 기본 거부
- **감사/로깅**: 변경·특권·인증 이벤트 로깅, 중앙집중 수집(WEF/Rsyslog), 감사 정책 표준화, 정기 점검 및 알림
- **패치/컴플라이언스**: 자동/반자동 패치 전략, 베이스라인(CIS 등) 적용, 주기적 재점검

---

# 1. 계정 & 권한(Identity & Access)

## 1.1 원칙 요약
- **최소권한**: 작업에 필요한 권한만 임시 부여(Just-In-Time·Just-Enough Admin).
- **관리자 분리**: 개인 업무 계정 ≠ 관리자 계정(이중계정).
- **서비스 계정 분리**: 앱별·서비스별 전용 계정(로그온 권한 최소화).
- **암호/인증**: 강력한 비밀번호·잠금 정책, 가능하면 MFA/키 기반 인증.
- **권한 검토**: 정기적(분기/반기) 권한 재검토, 비활성 계정 제거.

---

## 1.2 Linux: 계정·인증·권한

### (A) 사용자/그룹/쉘 기본
```bash
# 사용자 생성(홈 디렉터리 포함), 기본 쉘 지정
sudo useradd -m -s /bin/bash devuser
sudo passwd devuser

# 그룹 생성 및 부여
sudo groupadd webgrp
sudo usermod -aG webgrp devuser

# 비활성/잠금/삭제
sudo usermod -L devuser     # 잠금
sudo usermod -U devuser     # 잠금 해제
sudo userdel -r olduser     # 홈 포함 삭제
```

### (B) 만료·잠금·암호 정책
```bash
# /etc/login.defs 주요 항목 확인/설정
sudo sed -i 's/^PASS_MAX_DAYS.*/PASS_MAX_DAYS 90/' /etc/login.defs
sudo sed -i 's/^PASS_MIN_DAYS.*/PASS_MIN_DAYS 1/'  /etc/login.defs
sudo sed -i 's/^PASS_WARN_AGE.*/PASS_WARN_AGE 14/' /etc/login.defs

# 개별 사용자 만료일·비밀번호 수명
sudo chage -E 2025-12-31 devuser
sudo chage -M 90 -m 1 -W 14 devuser
```

### (C) sudo 최소화 & 로깅
```bash
# wheel 그룹만 sudo 허용, 비밀번호 로그 타임스탬프 강화
sudo visudo
# %wheel ALL=(ALL) ALL
# Defaults logfile="/var/log/sudo.log", timestamp_timeout=5, insults

# 사용자에게 최소 명령만 허용(예: systemctl 재시작만)
# /etc/sudoers.d/deploy
deploy ALL=(root) NOPASSWD: /bin/systemctl restart myapp.service
```

### (D) SSH 하드닝
```bash
sudo cp /etc/ssh/sshd_config{,.bak}
sudo nano /etc/ssh/sshd_config
# PermitRootLogin no
# PasswordAuthentication no    # 키 기반만 허용 시
# PubkeyAuthentication yes
# AllowUsers devuser deploy
# KexAlgorithms, Ciphers, MACs 적정화(배포판 권장값 사용)

sudo systemctl reload sshd
# 권한 체크
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

> **검증**: 다른 터미널에서 키로만 접속 시도 → 비밀번호 로그인 거부되는지 확인.  
> **롤백**: `sshd_config.bak` 복원 또는 `PasswordAuthentication yes` 임시 허용.

---

## 1.3 Windows: 계정·권한·정책

### (A) 로컬/도메인 계정 관리(기본)
```powershell
# 로컬 사용자 생성(비활성 + 만료일, 다음 로그온 시 암호 변경)
New-LocalUser -Name "devuser" -Description "Dev User" -NoPassword
Enable-LocalUser -Name "devuser"
# 로컬 그룹 추가
Add-LocalGroupMember -Group "Users" -Member "devuser"
```

### (B) 관리자 분리 & LAPS(개념)
- **관리자 분리**: `kimd`(일반) / `kimd-admin`(관리) 계정 분리, 관리자 계정은 평소 사용 금지.
- **LAPS(로컬 관리자 암호 관리)**: 로컬 Administrator 암호를 주기적으로 랜덤화·중앙 저장. (도메인/엔터프라이즈 환경 권장)

### (C) 비밀번호·잠금 정책(로컬 보안 정책 ↔ GPO)
- 암호 길이/복잡성/최대 사용기간 설정.
```powershell
# 예시: 고급 감사 정책 + 암호 정책 확인/설정(요약)
# 로컬 보안 정책 GUI: secpol.msc → 계정 정책
```

### (D) 권한(Privilege) 최소화 & UAC
- “로그온 유형” 제한(서비스 계정은 ‘서비스로 로그온’만, 대화형/원격 데스크톱 금지).
- UAC 기본 유지, 관리자 승인 모드 활성.

### (E) SSH/WinRM 원격 관리 최소화
```powershell
# WinRM 기본 비활성 권장. 필요한 시스템만 제한 개방
Enable-PSRemoting -SkipNetworkProfileCheck -Force
# 방화벽 스코프 제한 (특정 서브넷)
Set-NetFirewallRule -Name WINRM-HTTP-In-TCP -RemoteAddress 10.10.0.0/16
```

---

# 2. 파일시스템 보안(File System Security)

## 2.1 Linux: 권한/소유권/ACL/속성

### (A) 기본 권한과 소유권
```bash
# 웹 루트 예시: 소유자=www-data, 그룹=webgrp, 750
sudo chown -R www-data:webgrp /var/www/myapp
sudo find /var/www/myapp -type d -exec chmod 750 {} \;
sudo find /var/www/myapp -type f -exec chmod 640 {} \;

# 민감파일는 600, 로그는 640~600
sudo chmod 600 /etc/myapp/secret.key
```

### (B) ACL(Default ACL 포함)
```bash
# 특정 디렉터리의 신규 하위 항목에 기본 ACL 부여
sudo setfacl -m d:g:webgrp:rx /var/www/myapp
sudo getfacl /var/www/myapp
```

### (C) 특수 비트 & Capability
```bash
# SUID/SGID/Sticky 점검
sudo find / -perm /6000 -type f -exec ls -l {} \; 2>/dev/null

# 불필요 SUID 제거(사전 영향 분석 필수)
sudo chmod u-s /usr/bin/nmap

# Capability로 최소권한 실행(예: 특정 바이너리에 NET_BIND_SERVICE만)
sudo setcap 'cap_net_bind_service=+ep' /usr/local/bin/myapp
getcap /usr/local/bin/myapp
```

### (D) 마운트 옵션 및 분리
- `/tmp`·`/var/tmp`: `noexec,nosuid,nodev` (스크립트/바이너리 실행 차단)
- `/home`·`/var` 분리 마운트로 손상 격리 강화
```bash
# /etc/fstab 예시
tmpfs /tmp tmpfs defaults,noexec,nosuid,nodev,mode=1777 0 0
```

### (E) 디스크 암호화 & 키 관리
- 서버/노트북: 전체디스크(LUKS) 또는 파티션 단위 암호화.
- 키는 파일권한 + 키보관 정책(권장: HSM/비밀관리시스템) 연계.

---

## 2.2 Windows: NTFS ACL, EFS/BitLocker

### (A) NTFS 권한(상속·고급권한)
```powershell
# 웹 루트 권한: 소유자=IIS_IUSRS, 개발그룹에 읽기, 상속 제한
$path = "C:\inetpub\wwwroot\myapp"
icacls $path /inheritance:r
icacls $path /grant "IIS_IUSRS:(OI)(CI)RX" "WEBDEV:(OI)(CI)R"
icacls $path /setowner "Administrators"
```

### (B) 민감 파일 보호(EFS는 선택적으로, 권장: BitLocker로 드라이브 암호화)
```powershell
# BitLocker 예시(데이터 드라이브)
Enable-BitLocker -MountPoint "D:" -EncryptionMethod XtsAes256 -UsedSpaceOnly
```

### (C) 감사(Auditing) & 무결성
- 고급 감사 정책으로 **개체 액세스**(파일/폴더) 감사 활성화.
- 무결성 보호: WDAC/AppLocker로 **허용 목록** 기반 실행 통제(서비스/배치 서버 권장).

---

# 3. 서비스 하드닝(Service Hardening)

## 3.1 Linux(systemd 샌드박스) — **강력 추천**

### (A) 샘플: myapp.service 강화
```ini
# /etc/systemd/system/myapp.service
[Unit]
Description=My App Service
After=network.target

[Service]
User=myapp      # 루트 불가
Group=myapp
ExecStart=/usr/local/bin/myapp --port 8080
Restart=on-failure
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
RestrictAddressFamilies=AF_INET AF_INET6
RestrictNamespaces=true
LockPersonality=true
MemoryDenyWriteExecute=true
ReadWritePaths=/var/lib/myapp
ReadOnlyPaths=/usr /etc
WorkingDirectory=/var/lib/myapp

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now myapp
systemd-analyze security myapp.service   # 점수로 하드닝 수준 확인(지원되는 배포판)
```

### (B) 네트워크 바인딩 최소화
- `--listen 127.0.0.1`로 로컬만 바인딩하고, **리버스 프록시(Nginx)**만 외부 개방.

---

## 3.2 Windows: 서비스·역할 최소화

### (A) 불필요 역할/기능 제거
```powershell
# 사용하지 않는 기능 제거 예시
Get-WindowsFeature | ? {$_.InstallState -eq "Installed"} | ft Name,DisplayName
Uninstall-WindowsFeature -Name "FS-DFS-Namespace"
```

### (B) 서비스 계정 권한 최소화
- 서비스의 **로그온 계정**을 전용 **gMSA(그룹 관리 서비스 계정)** 또는 최소 권한 로컬 계정으로 지정.
- 해당 계정에 **대화형 로그온** 금지, **서비스로 로그온**만 허용.

### (C) 실행 제어(허용 목록)
- **WDAC/AppLocker** 정책으로 허용된 서명/경로/해시만 실행 허용.
```powershell
# AppLocker 기본 정책 생성(감사 모드)
New-AppLockerPolicy -DefaultRule -XMLPolicy C:\Temp\applocker.xml
Set-AppLockerPolicy -XMLPolicy C:\Temp\applocker.xml -Merge
```

### (D) 포트/방화벽 최소화
```powershell
# 기본 거부 후 필요한 인바운드만 개방(예: 443)
New-NetFirewallRule -DisplayName "HTTPS Inbound" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow
# 특정 서브넷만
Set-NetFirewallRule -DisplayName "HTTPS Inbound" -RemoteAddress 10.10.0.0/16
```

---

# 4. 로깅·감사(Auditing & Logging)

## 4.1 Linux: auditd + (rsyslog/journald)

### (A) 핵심 추적 규칙 예시(auditd)
```bash
# /etc/audit/rules.d/hardening.rules
-w /etc/passwd -p wa -k identity
-w /etc/group  -p wa -k identity
-w /etc/sudoers -p wa -k priv_esc
-w /etc/ssh/sshd_config -p wa -k sshd
-a always,exit -F arch=b64 -S execve -C auid!=unset -F euid=0 -k exec_as_root
-a always,exit -F arch=b64 -S sethostname,setdomainname -k sysconfig
```
```bash
sudo augenrules --load
sudo systemctl restart auditd
ausearch -k identity --start recent
```

### (B) 중앙집중 로그
- `rsyslog`/`journal-remote`로 중앙 수집, 중요한 항목은 SIEM 연동.

---

## 4.2 Windows: 고급 감사 + PowerShell 로깅 + WEF

### (A) 고급 감사 정책(요지)
- **계정 로그온/로그온**, **개체 액세스**, **권한 사용**, **프로세스 생성(4688)** 활성화.
```powershell
# PowerShell 스크립트 블록/모듈 로깅
Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name EnableScriptBlockLogging -Value 1 -Type DWord
Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging" -Name EnableModuleLogging -Value 1 -Type DWord
```

### (B) Windows Event Forwarding(WEF)
- 서버 → 수집기(Event Collector)로 특정 채널(보안, PowerShell, Sysmon 등) 구독.

---

# 5. 패치·업데이트(Updating & Patching)

## 5.1 Linux
```bash
# Debian/Ubuntu
sudo apt update && sudo apt upgrade -y
# 자동 보안 패치(예: unattended-upgrades)
sudo apt install unattended-upgrades
sudo dpkg-reconfigure --priority=low unattended-upgrades

# RHEL/CentOS/Alma
sudo dnf check-update
sudo dnf update -y
```
- **커널/라이브러리** 패치 창 계획(가용성 고려), 서비스 재시작 스케줄링, 롤백 절차 문서화.

## 5.2 Windows
- WSUS/Windows Update for Business로 **승인-배포 파이프라인** 운영.
- 재시작 시간대 예약, 패치 전 스냅샷/백업, 패치 예외 문서화.

---

# 6. 실습 시나리오(Scenarios)

## 시나리오 1 — “새 웹서버 기본 하드닝(Linux)”
**목표**: SSH 키 기반, 최소 포트, 서비스 샌드박스, 로그/감사 설정.

1) **계정/SSH**
```bash
sudo adduser deploy
sudo usermod -aG sudo deploy
# SSH 키 업로드 후
sudo sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config
sudo systemctl reload sshd
```
2) **방화벽**
```bash
sudo ufw default deny incoming
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```
3) **서비스 하드닝(systemd)**
- 위 `myapp.service` 예시 적용, `systemd-analyze security`로 점검.
4) **로그/감사**
- auditd 규칙 로드, rsyslog 원격 전송 설정.
5) **검증**
```bash
# 외부에서 포트 스캔(원격 호스트)
nmap -p 1-1024,8080,8443 <server-ip>
# 22(SSH), 80/443만 보이는지 확인
```
6) **롤백**
- `sshd_config.bak`, `myapp.service` 원본, audit 규칙 백업 유지.

---

## 시나리오 2 — “IIS 서버 최소 권한(Windows)”
**목표**: 웹루트 NTFS 제한, 서비스 계정 최소화, 포트/방화벽 스코프 제한.

1) **폴더 권한 정리**
```powershell
$path = "C:\inetpub\wwwroot\myapp"
icacls $path /inheritance:r
icacls $path /grant "IIS_IUSRS:(OI)(CI)RX" "WEBOPS:(OI)(CI)M"
icacls $path /remove "Users"
```
2) **서비스 계정**
- 앱 풀(App Pool) 전용 계정 지정, 로컬 정책에서 “서비스로 로그온”만 허용.
3) **방화벽**
```powershell
New-NetFirewallRule -DisplayName "HTTPS In" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow -RemoteAddress 10.20.0.0/16
```
4) **검증**
- 일반 사용자로 웹 루트에 쓰기 실패 확인.
- 외부망 IP에서는 443 접속 불가(허용된 서브넷만 가능) 확인.
5) **롤백**
- `icacls`로 백업·복원(`/save`, `/restore`) 사용.

---

## 시나리오 3 — “SUID 남용 점검(Linux)”
**목표**: 불필요 SUID 제거, Capability로 대체.

1) **탐색**
```bash
sudo find / -perm -4000 -type f -exec ls -l {} \; 2>/dev/null | tee suid_list.txt
```
2) **평가/격리**
- **필수 아님** 판단된 바이너리의 SUID 제거:
```bash
sudo chmod u-s /usr/bin/newgrp
```
3) **대체**
- 포트 바인드에만 권한 필요한 경우 Capability 부여(위 예시 참조).
4) **검증**
- 기능 정상 동작(필요 권한만) 확인, 보안 도구(Lynis 등)로 재스캔.
5) **롤백**
```bash
sudo chmod u+s /usr/bin/newgrp
```

---

## 시나리오 4 — “/tmp 악용 차단(Linux)”
**목표**: `/tmp` 실행 차단.

1) **마운트 옵션 적용**
```bash
# /etc/fstab
tmpfs /tmp tmpfs defaults,noexec,nosuid,nodev,mode=1777 0 0
sudo mount -o remount /tmp
```
2) **검증**
```bash
echo -e '#!/bin/sh\necho FAIL' > /tmp/test.sh
chmod +x /tmp/test.sh
/tmp/test.sh     # 실행 거부되어야 정상
```
3) **롤백**
```bash
sudo mount -o remount,exec /tmp
```

---

# 7. 구성관리(자동화 스니펫)

## 7.1 Ansible(리눅스 하드닝 예시)
```yaml
# plays/hardening.yml
- hosts: web
  become: true
  tasks:
    - name: Disable root SSH & password auth
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^#?\s*{{ item.key }}'
        line: '{{ item.key }} {{ item.value }}'
      loop:
        - { key: 'PermitRootLogin', value: 'no' }
        - { key: 'PasswordAuthentication', value: 'no' }
    - name: Reload sshd
      service: { name: sshd, state: reloaded }

    - name: UFW default deny & allow only 80/443
      ufw:
        state: enabled
        policy: deny
    - name: Allow HTTP/HTTPS
      ufw: { rule: allow, port: "{{ item }}", proto: tcp }
      loop: [80,443]

    - name: Place systemd unit
      copy:
        src: files/myapp.service
        dest: /etc/systemd/system/myapp.service
        owner: root
        group: root
        mode: '0644'
    - name: Enable myapp
      systemd: { name: myapp, daemon_reload: yes, enabled: yes, state: started }
```

## 7.2 PowerShell DSC(윈도우 기본 정책 예시)
```powershell
Configuration WebServerHardening {
  Import-DscResource -ModuleName PSDesiredStateConfiguration
  Node "IIS01" {
    WindowsFeature IIS {
      Name   = "Web-Server"
      Ensure = "Present"
    }
    Script DisableSMB1 {
      GetScript  = { @{ Result = (Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol).State } }
      TestScript = { (Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol).State -eq "Disabled" }
      SetScript  = { Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart }
    }
    Script Firewall443 {
      GetScript  = { @{ } }
      TestScript = { (Get-NetFirewallRule -DisplayName "HTTPS In" -ErrorAction SilentlyContinue) -ne $null }
      SetScript  = { New-NetFirewallRule -DisplayName "HTTPS In" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow }
    }
  }
}
WebServerHardening
Start-DscConfiguration -Path .\WebServerHardening -Wait -Force -Verbose
```

---

# 8. 체크리스트(운영 점검표)

## 8.1 공통
- [ ] **계정**: 비활성/휴면/퇴사 계정 제거, 관리자/업무 계정 분리
- [ ] **암호/인증**: 길이/복잡성/회전/잠금, MFA/키 기반 적용
- [ ] **권한**: 로컬 관리자 최소화, 서비스 계정 최소 권한
- [ ] **서비스**: 불필요 서비스 제거, 포트 최소화, 내부 바인딩 우선
- [ ] **파일시스템**: 민감경로 권한 최소화, `/tmp` noexec, SUID 점검
- [ ] **로깅/감사**: 특권/변경/실행 감사 활성, 중앙 수집/알림
- [ ] **패치**: 월간/분기 패치 윈도우 설정, 사전 백업/스냅샷
- [ ] **백업/복구**: 정기 백업, 복구 절차 점검(복구 시간/목표)
- [ ] **문서화**: 변경 이력, 표준 운영절차(SOP), 롤백 절차

## 8.2 Linux
- [ ] `PermitRootLogin no`, `PasswordAuthentication no(선택)`
- [ ] `sudo` 최소 명령 위임, 로그 파일 별도 저장
- [ ] `systemd` 샌드박싱 옵션 사용(`ProtectSystem`, `CapabilityBoundingSet` 등)
- [ ] `/etc`, `/var/lib`, 앱 디렉터리 권한 정합성
- [ ] `auditd` 핵심 규칙 로드, 정기 점검

## 8.3 Windows
- [ ] 로컬 관리자 암호 관리(LAPS 등)
- [ ] 고급 감사 정책 + PowerShell 스크립트 로깅
- [ ] WDAC/AppLocker 허용목록 기반 실행 통제(서버/VDI)
- [ ] WinRM/SMB 최소화, 방화벽 스코프 제한
- [ ] NTFS 권한 상속 점검, 중요한 경로는 상속 해제 후 최소 권한

---

# 9. 자주 겪는 함정 & 대응

- **운영 편의 vs 보안**: 긴급 장애 시 임시 완화(예: `PasswordAuthentication yes`) 후 **즉시 원복**. 작업창구 표준화(점검표/체크아웃).
- **SUID 무분별 제거**: OS 기능에 영향. 제거 전 **대상/의존성** 검토 + 롤백 계획.
- **로그는 있지만 “못 찾음”**: 표준 키(이벤트 ID, `-k` 태그) 설계, 중앙집중 필수.
- **서비스 계정 재사용**: 애플리케이션마다 **전용 계정**. 암호/권한 격리.
- **방화벽 예외 범위 과다**: CIDR 범위 구체화, 주기적 예외 검토.

---

# 10. 실전 Q&A 미니 튜닝

**Q1. 배스천(점프) 서버에서만 SSH 허용?**  
A. 서버의 `sshd`를 `AllowUsers deploy@10.10.0.10`처럼 제한하고, 보안그룹/방화벽에서 배스천 IP만 허용.

**Q2. 웹이 1024 미만 포트를 쓰면 루트 필요?**  
A. `CAP_NET_BIND_SERVICE`를 바이너리에 부여해 **루트 없이** 바인드하도록 하세요(위 setcap 예시).

**Q3. PowerShell 스크립트 실행 통제?**  
A. WDAC/AppLocker + ScriptBlockLogging 활성화, 사인된 스크립트만 허용.

**Q4. `/tmp` noexec로 배치 깨짐?**  
A. 실행이 필요한 임시 경로를 **별도 디렉터리**로 두고 `exec` 허용(서비스별 전용 작업 디렉터리).

---

# 11. 요약(암기 포인트)

- **계정**: 관리자/업무 분리, 서비스 계정 전용화, SSH 키 기반, WinRM 최소
- **권한**: 최소 권한(ACL·Capability), 마운트 옵션, SUID 점검
- **서비스**: 불필요 제거, 로컬 바인드, 샌드박스(systemd/WDAC)
- **로그/감사**: 특권/변경/실행 이벤트, 중앙 수집·상시 모니터링
- **패치**: 정기/예행연습, 롤백 플랜, 문서화