---
layout: post
title: C# - 열거형, 구조체, 튜플
date: 2024-10-27 19:20:23 +0900
category: Csharp
---
# C# 메모리 구조 완전 정리 (값 타입 vs 참조 타입, 스택, 힙, GC)

C#은 .NET 런타임 위에서 동작하며, **스택(stack)**과 **힙(heap)** 메모리를 자동으로 관리합니다.  
이 글에서는 메모리 구조와 **값/참조 타입의 차이**, 그리고 **가비지 컬렉션(Garbage Collection)** 동작 원리까지 정리합니다.

---

## 🔷 1. 메모리 구조: 스택 vs 힙

| 메모리 구역 | 설명 | 특징 |
|--------------|------|------|
| 스택 (Stack) | 지역 변수 저장 | 빠름, 자동 해제 |
| 힙 (Heap) | 객체/참조 타입 저장 | 느림, GC가 관리 |

- **스택**은 함수 호출 시 생성되는 **임시 저장 공간**입니다.
- **힙**은 객체(클래스 인스턴스 등)를 **동적으로 저장**하는 공간입니다.

---

## 🔷 2. 값 타입 vs 참조 타입

| 항목 | 값 타입 (Value Type) | 참조 타입 (Reference Type) |
|------|-----------------------|------------------------------|
| 저장 위치 | 스택 또는 구조체 내부 | 힙 |
| 예시 | `int`, `float`, `bool`, `struct`, `enum` | `class`, `string`, `object`, `array` |
| 데이터 복사 | 값을 복사함 (깊은 복사) | 참조(주소)를 복사 (얕은 복사) |
| GC 대상 여부 | ❌ (스택이 자동 해제) | ⭕ (힙이 GC에 의해 관리됨) |

### ✅ 예시

```csharp
int a = 10;
int b = a;
b = 20;
Console.WriteLine(a); // 10 (a는 영향을 받지 않음)

class Person { public string Name; }

Person p1 = new Person { Name = "Alice" };
Person p2 = p1;
p2.Name = "Bob";
Console.WriteLine(p1.Name); // "Bob" (같은 객체 참조)
```

---

## 🔷 3. 박싱(Boxing)과 언박싱(Unboxing)

- **박싱(Boxing)**: 값 타입 → 참조 타입 변환 (힙으로 이동)
- **언박싱(Unboxing)**: 참조 타입 → 값 타입으로 변환

```csharp
int num = 42;
object obj = num;        // 박싱 (값이 힙에 복사됨)
int result = (int)obj;   // 언박싱 (다시 값 타입으로 복원)
```

> 박싱은 성능에 영향을 줄 수 있으므로 주의해서 사용해야 합니다.

---

## 🔷 4. 가비지 컬렉션 (Garbage Collection, GC)

.NET은 개발자가 메모리를 직접 해제하지 않아도 **GC가 자동으로 힙 메모리를 정리**합니다.

### ✅ GC의 특징

- 참조되지 않는 객체를 **자동 탐지하여 해제**
- 힙이 꽉 찼을 때나 유휴 시간에 **비동기적으로 수행**
- 메모리 해제는 **즉시 발생하지 않음** (GC가 스케줄링에 따라 처리)

### ✅ GC의 세대(Generation)

| 세대 | 설명 | 대상 |
|------|------|------|
| Gen 0 | 새로 생성된 객체 | 자주 GC됨 |
| Gen 1 | 오래된 객체 | |
| Gen 2 | 장기 생존 객체 | GC 대상에서 비교적 제외됨 |

> GC는 성능을 위해 세대별로 다르게 동작합니다.

---

## 🔷 5. Dispose와 using: 명시적 자원 해제

GC는 **메모리만** 회수합니다. 파일 핸들, DB 연결 등은 직접 해제해야 합니다.

### ✅ IDisposable 인터페이스

```csharp
class FileManager : IDisposable
{
    public void Dispose()
    {
        Console.WriteLine("자원 해제");
    }
}
```

### ✅ using 블록

```csharp
using (var f = new FileManager())
{
    // 자원 사용
}
// 여기서 Dispose 자동 호출
```

> using 문은 try-finally를 대체하여 **안전한 자원 해제**를 보장합니다.

---

## ✅ 요약

| 개념 | 설명 |
|------|------|
| 스택 | 함수 내 지역 변수 저장, 빠르고 자동 해제 |
| 힙 | 참조형 객체 저장, GC에 의해 관리 |
| 값 타입 | 스택에 저장, 복사 시 값 복제 |
| 참조 타입 | 힙에 저장, 복사 시 참조 공유 |
| 박싱 | 값 타입을 참조 타입으로 변환 (힙 이동) |
| 가비지 컬렉션 | 사용하지 않는 힙 메모리를 자동으로 회수 |
| Dispose | 힙 외 자원 해제용 인터페이스 (`IDisposable`) |