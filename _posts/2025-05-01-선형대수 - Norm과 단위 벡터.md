---
layout: post
title: 선형대수 - Norm과 단위 벡터
date: 2025-05-01 21:20:23 +0900
category: 선형대수
---
# 벡터의 크기(Norm)와 단위 벡터(Unit Vector) — 전면 개정

본 글은 벡터의 크기(노름)를 **직관 → 정의 → 종류 → 성질 → 단위 벡터 → 수치 이슈 → 실전 코드 → 연습문제** 순서로 정리합니다.  

---

## 0. 표기 규약(Notation)

- 스칼라: $$a,b,\alpha,\varepsilon \in \mathbb{R}$$  
- 벡터: $$\mathbf{v},\mathbf{u},\mathbf{x} \in \mathbb{R}^n$$ (열벡터가 기본)  
- 전치: $$\mathbf{v}^\top$$  
- 노름: $$\lVert \cdot \rVert_p, \ \lVert \cdot \rVert$$ (기본은 2-노름)  
- 단위벡터: $$\hat{\mathbf{v}} = \dfrac{\mathbf{v}}{\lVert \mathbf{v}\rVert} \ \ (\mathbf{v}\neq \mathbf{0})$$

---

## 1. 벡터의 크기(노름) — 직관과 정의

### 1.1 직관
벡터를 원점에서 뻗은 화살표로 보면, **노름**은 그 화살표의 **길이**를 수치화한 것입니다.  
가장 흔한 길이는 유클리드 거리이며, 다음과 같이 정의합니다.

### 1.2 2-노름(유클리드 노름)의 정의
$$
\lVert \mathbf{v} \rVert \equiv \lVert \mathbf{v} \rVert_2
\,=\, \sqrt{v_1^2 + v_2^2 + \cdots + v_n^2}
\,=\, \sqrt{\mathbf{v}^\top \mathbf{v}}.
$$

예시: $$\mathbf{v} = [3,4]^\top$$ 이면
$$
\lVert \mathbf{v} \rVert = \sqrt{3^2 + 4^2} = 5.
$$

---

## 2. 다양한 노름과 단위공

노름은 2-노름만 있는 것이 아닙니다. 아래는 널리 쓰이는 세 가지입니다.

| 이름 | 정의 | 특징 |
|---|---|---|
| 1-노름 | $$\lVert \mathbf{v} \rVert_1 = \sum_{i=1}^n \lvert v_i \rvert$$ | 맨해튼 거리, 희소성 촉진(정규화/규제에서 자주 사용) |
| 2-노름 | $$\lVert \mathbf{v} \rVert_2 = \big(\sum_i v_i^2\big)^{1/2}$$ | 가장 일반적, 회전불변성 보유 |
| 무한대-노름 | $$\lVert \mathbf{v} \rVert_{\infty} = \max_i \lvert v_i \rvert$$ | 최대 성분의 절댓값, 임계값 제약에 유용 |

보다 일반적으로, $$p\ge 1$$ 에 대해 **p-노름**:
$$
\lVert \mathbf{v} \rVert_p = \Big(\sum_{i=1}^n \lvert v_i \rvert^p\Big)^{1/p}.
$$

단위공(단위볼)의 모양:
- $$\lVert \cdot \rVert_2$$: 원(2D)·구(3D)
- $$\lVert \cdot \rVert_1$$: 마름모(2D)·옥타헤드론(3D)
- $$\lVert \cdot \rVert_{\infty}$$: 정사각형(2D)·정육면체(3D)

참고: $$\lVert \cdot \rVert_0$$ 는 실제 노름이 아니며(삼각부등식 불만족), 0이 아닌 성분 개수를 세는 준척도입니다.

---

## 3. 노름의 공리와 기본 성질

노름은 다음 세 성질을 만족합니다(모든 $$\mathbf{u},\mathbf{v} \in \mathbb{R}^n, \ \alpha\in\mathbb{R}$$):
1. 양의 정부호: $$\lVert \mathbf{v} \rVert \ge 0,\ \ \lVert \mathbf{v} \rVert=0 \iff \mathbf{v}=\mathbf{0}$$
2. 절대 균등 동차성: $$\lVert \alpha \mathbf{v} \rVert = \lvert \alpha \rvert \, \lVert \mathbf{v} \rVert$$
3. 삼각부등식: $$\lVert \mathbf{u} + \mathbf{v} \rVert \le \lVert \mathbf{u} \rVert + \lVert \mathbf{v} \rVert$$

2-노름의 경우, 코시–슈바르츠 부등식
$$
\lvert \mathbf{u}^\top \mathbf{v} \rvert \le \lVert \mathbf{u} \rVert \, \lVert \mathbf{v} \rVert
$$
이 삼각부등식의 핵심 도구로 쓰입니다.  
또한 유한 차원에서 모든 노름은 **상당**합니다(동치): 한 노름에서의 수렴은 다른 노름에서도 수렴합니다.

---

## 4. 단위 벡터(Unit Vector)

### 4.1 정의
벡터 $$\mathbf{v}\neq \mathbf{0}$$ 에 대해
$$
\hat{\mathbf{v}} \;=\; \frac{\mathbf{v}}{\lVert \mathbf{v} \rVert}
\quad\Rightarrow\quad
\lVert \hat{\mathbf{v}} \rVert = 1.
$$
즉, 방향은 유지하고 **크기만 1로 정규화**한 벡터입니다.

### 4.2 기하적 의미
- $$\mathbf{v}$$ 는 크기와 방향을 모두 가진 화살표, $$\hat{\mathbf{v}}$$ 는 **방향만 보존**하는 화살표입니다.
- 모든 단위벡터의 집합은 **단위구**(또는 단위원) 위의 점들입니다.

### 4.3 성질
- 스칼라 배에 불변: $$\widehat{\alpha \mathbf{v}} = \operatorname{sign}(\alpha)\, \hat{\mathbf{v}}$$ (크기 정보 제거)
- 정규화는 각도 계산, 코사인 유사도, 방향 비교에 유용

주의: $$\mathbf{v}=\mathbf{0}$$ 인 경우 정규화가 정의되지 않습니다.

---

## 5. 각도, 코사인 유사도, 투영과의 연결

두 벡터가 영이 아니면
$$
\cos\theta = \frac{\mathbf{u}^\top \mathbf{v}}{\lVert \mathbf{u} \rVert\, \lVert \mathbf{v} \rVert}
= \hat{\mathbf{u}}^\top \hat{\mathbf{v}}.
$$
즉, **정규화 후 내적**은 곧 각도의 코사인입니다.

한편, $$\mathbf{u}\neq \mathbf{0}$$ 에 대한 $$\mathbf{v}$$ 의 **정사영**:
$$
\operatorname{proj}_{\mathbf{u}}(\mathbf{v})
= \frac{\mathbf{v}^\top \mathbf{u}}{\mathbf{u}^\top \mathbf{u}}\, \mathbf{u}
= (\mathbf{v}^\top \hat{\mathbf{u}})\, \hat{\mathbf{u}}.
$$

---

## 6. 미분과 최적화 관점(필요할 때만)

- 2-노름(미분 가능점, 즉 $$\mathbf{v}\neq \mathbf{0}$$)의 기울기:
$$
\nabla_{\mathbf{v}} \lVert \mathbf{v} \rVert_2 = \frac{\mathbf{v}}{\lVert \mathbf{v} \rVert_2}.
$$

- 제곱 2-노름은 매끈하고 더 자주 쓰임:
$$
f(\mathbf{v})=\lVert \mathbf{v} \rVert_2^2 \Rightarrow \nabla f(\mathbf{v}) = 2\mathbf{v}.
$$

- 1-노름의 부기울기: 각 좌표에서 부호 함수(원점에서는 구간)  
- 정규화 변환 $$\hat{\mathbf{v}}=\dfrac{\mathbf{v}}{\lVert \mathbf{v} \rVert}$$ 의 야코비안은 $$\mathbf{v}=\mathbf{0}$$ 에서 정의되지 않습니다.

---

## 7. 수치 계산에서의 주의사항

1. 영벡터 처리: $$\lVert \mathbf{v} \rVert=0$$ 이면 정규화 불가 → 작은 $$\varepsilon$$ 로 방어하거나 조건 분기  
2. 언더/오버플로 방지: 매우 큰/작은 성분일 때 스케일링 기법(예: 최대성분으로 나눔) 고려  
3. 데이터타입: 필요 시 float64 사용으로 정밀도 확보  
4. 배치 정규화: 행 또는 열 단위로 안전하게 정규화(축 차원 주의)  
5. 코사인 유사도 계산 시 분모에 작은 상수 $$\varepsilon$$ 추가

---

## 8. PyTorch 예제 모음

모든 블록은 독립 실행 가능합니다.

### 8.1 기본: 노름과 단위 벡터

```python
import torch
torch.set_printoptions(precision=4, sci_mode=False)

v = torch.tensor([3.0, 4.0])          # R^2
norm_v = torch.linalg.norm(v)          # 2-노름
u = v / norm_v                         # 단위벡터
print("||v|| =", float(norm_v))        # 5.0
print("v_hat =", u)                    # tensor([0.6000, 0.8000])
print("||v_hat|| =", float(torch.linalg.norm(u)))  # 1.0
```

### 8.2 영벡터 안전 정규화 함수

```python
import torch

def safe_unit(v: torch.Tensor, eps: float = 1e-12):
    # v: (..., n)
    nrm = torch.linalg.norm(v, dim=-1, keepdim=True)  # (..., 1)
    return v / (nrm + eps)

z = torch.zeros(3)
print("safe_unit(0) =", safe_unit(z))   # 0으로 유지(분모 eps)
```

### 8.3 배치(행) 단위 정규화와 코사인 유사도

```python
import torch

X = torch.tensor([[1., 2., 2.],
                  [2., 0., 1.],
                  [0., 3., 0.]])  # 3 x 3, 각 행을 하나의 벡터로

def row_normalize(M, eps=1e-12):
    nrm = torch.linalg.norm(M, dim=1, keepdim=True)
    return M / (nrm + eps)

X_hat = row_normalize(X)
# 임의 두 행의 코사인 유사도 = 정규화된 행벡터 내적
cos_01 = float((X_hat[0] * X_hat[1]).sum())
cos_02 = float((X_hat[0] * X_hat[2]).sum())
print("cos(row0,row1) =", cos_01)
print("cos(row0,row2) =", cos_02)
print("||row0_hat|| =", float(torch.linalg.norm(X_hat[0])))
```

### 8.4 다양한 p-노름 계산

```python
import torch

v = torch.tensor([3.0, -4.0, 1.0])
l1 = torch.linalg.norm(v, ord=1)
l2 = torch.linalg.norm(v, ord=2)
linf = torch.linalg.norm(v, ord=float('inf'))
l3 = torch.linalg.norm(v, ord=3)

print("||v||_1 =", float(l1))
print("||v||_2 =", float(l2))
print("||v||_inf =", float(linf))
print("||v||_3 =", float(l3))
```

### 8.5 각도 계산과 투영

```python
import torch

u = torch.tensor([1.0, 2.0])
v = torch.tensor([3.0, 1.0])
cos_th = torch.dot(u, v) / (torch.linalg.norm(u) * torch.linalg.norm(v))
cos_th = torch.clamp(cos_th, -1+1e-12, 1-1e-12)
theta = torch.arccos(cos_th)
print("cos(theta) =", float(cos_th), "  theta(rad) =", float(theta))

proj_v_on_u = (torch.dot(v, u) / torch.dot(u, u)) * u
print("proj_u(v) =", proj_v_on_u)
```

### 8.6 오버플로 방지 스케일링 기법(개념 시연)

```python
import torch

x = torch.tensor([1e20, -2e20, 3e20])
# 직접 제곱 합은 float32에서 오버플로 위험. 다음과 같이 최대성분으로 스케일링:
m = torch.max(torch.abs(x))
scaled = x / m
norm_x = m * torch.linalg.norm(scaled)  # 안전해진 2-노름
print("scaled trick norm:", float(norm_x))
```

### 8.7 자동미분으로 확인하는 기울기

```python
import torch

v = torch.tensor([3.0, 4.0, 12.0], requires_grad=True)
norm_v = torch.linalg.norm(v)        # sqrt(sum v_i^2)
norm_v.backward()                    # d||v||/dv = v/||v||
print("grad:", v.grad)               # v / ||v||
```

---

## 9. 기하학적 해석 요약

- 2-노름 단위공: 원(2D), 구(3D)  
- 1-노름 단위공: 다이아몬드(2D), 옥타헤드론(3D)  
- 무한대-노름 단위공: 정사각형(2D), 정육면체(3D)  
정규화는 점을 해당 노름의 단위공 표면으로 **사영**하는 것과 같습니다(방향 유지, 크기 제거).

---

## 10. 실전 시나리오

1) 머신러닝 임베딩 비교: 코사인 유사도는 정규화 후 내적과 동일하므로, 미리 정규화하면 **빠르고 안정적**입니다.  
2) 정규화 전처리: 특성의 크기 스케일이 다르면 거리/각도 의미가 왜곡됩니다. 표준화 또는 단위노름 정규화를 고려합니다.  
3) 정규화와 규제: 모델 파라미터에 2-노름 제곱 규제를 주면 매끄럽고 안정적인 수축, 1-노름 규제는 희소해짐을 유도합니다.  
4) 그래픽스/로보틱스: 방향만 필요한 경우(법선 벡터, 진행 방향) 단위벡터가 필수입니다.

---

## 11. 자주 하는 실수와 방어 전략

- 영벡터 정규화: 정의되지 않음 → 조건 분기 또는 작은 상수 더하기  
- 데이터 타입: 큰 값이 섞이면 float64 고려  
- 축 차원: 배치 정규화 시 `dim` 지정 오류 주의  
- 역행렬 남용: 노름/정규화 계산과 무관하더라도, 선형시스템은 `solve/lstsq` 사용 습관을 들입니다.

---

## 12. 연습문제(힌트 포함)

1) 벡터 $$\mathbf{v}=[-1,2,-2]^\top$$ 에 대해 $$\lVert \mathbf{v}\rVert_2$$, $$\lVert \mathbf{v}\rVert_1$$, $$\lVert \mathbf{v}\rVert_\infty$$ 를 계산하시오.  
힌트: 정의에 그대로 대입.

2) $$\mathbf{u}=[1,1]^\top,\ \mathbf{v}=[2,-1]^\top$$ 에 대해 각도 $$\theta$$ 를 구하시오.  
힌트: $$\cos\theta = \dfrac{\mathbf{u}^\top\mathbf{v}}{\lVert \mathbf{u}\rVert \lVert \mathbf{v}\rVert}$$.

3) $$\mathbf{u}\neq \mathbf{0}$$ 에 대해 $$\operatorname{proj}_{\mathbf{u}}(\mathbf{v})=\dfrac{\mathbf{v}^\top\mathbf{u}}{\mathbf{u}^\top\mathbf{u}}\mathbf{u}$$ 임을 증명하시오.  
힌트: 오차 $$\mathbf{v}-\alpha \mathbf{u}$$ 가 $$\mathbf{u}$$ 에 직교가 되도록 $$\alpha$$ 를 선택.

4) 모든 $$p\ge 1$$ 에 대해 1-노름과 무한대-노름의 경계 사이에 2-노름이 낀다는 의미의 상수 경계를 서술하시오(노름 동치).  
힌트: 상수 $$c_1,c_2>0$$ 가 존재하여 $$c_1 \lVert\cdot\rVert_1 \le \lVert\cdot\rVert_2 \le c_2 \lVert\cdot\rVert_\infty$$.

5) 함수 $$f(\mathbf{v})=\lVert \mathbf{v}\rVert_2$$ 의 기울기가 $$\dfrac{\mathbf{v}}{\lVert \mathbf{v}\rVert_2}$$ 임을 직접 미분으로 보이시오(단, $$\mathbf{v}\neq \mathbf{0}$$).  
힌트: 먼저 $$g(\mathbf{v})=\lVert \mathbf{v}\rVert_2^2$$ 의 미분을 구하고 사슬법칙 적용.

---

## 13. 요약

- 2-노름은 가장 보편적인 길이의 정의이며, 1·무한대-노름 등 다른 노름도 상황에 따라 유용합니다.  
- 단위벡터는 **방향만 보존**하는 정규화로, 각도/코사인 유사도/투영 계산의 기반입니다.  
- 실전에서는 영벡터, 수치 범위, 데이터 타입, 축 차원 등 **수치적 안정성**을 항상 점검해야 합니다.