---
layout: post
title: 디지털신호처리 - 연습문제 세트 5
date: 2025-11-16 20:25:23 +0900
category: 디지털신호처리
---
# FIR 필터 설계 연습 문제 모음

## 0. 공통 준비: 정규화, 헬퍼 함수

### 0.1 주파수 정규화 복습

샘플링 주파수가 $$F_s$$ 일 때, 아날로그 주파수 $$F$$ 를 **정규화 주파수** $$f_n$$ 로 표현하면

$$
f_n = \frac{F}{F_s/2} \in [0, 1]
$$

디지털 주파수 $$\omega$$ 와의 관계는

$$
\omega = 2\pi \frac{F}{F_s} = \pi f_n
$$

이 글의 Octave 코드에서는 대부분

- `f` 벡터: $$0 \le f \le 1$$ 정규화 주파수
- `w` 혹은 `wgrid`: `freqz` 의 디지털 각주파수(라디안)

---

### 0.2 공통 헬퍼: 주파수 응답 및 리플 측정 함수

여러 문제에서 반복해서 쓸 수 있는 간단한 헬퍼를 정의해 두자.

```octave
function [rp, rs] = measure_ripple(b, fp, fs)
  % b : FIR 계수 (1 x (N+1))
  % fp: 통과대역 끝 (정규화, 0~1)
  % fs: 저지대역 시작 (정규화, 0~1)
  [H, w] = freqz(b, 1, 4096);
  f = w / pi;  % 0~1

  pass_idx = find(f <= fp);
  stop_idx = find(f >= fs);

  Hpass = abs(H(pass_idx));
  Hstop = abs(H(stop_idx));

  rp = max(Hpass) - min(Hpass);        % 통과대역 진폭 리플
  rs = max(Hstop);                     % 저지대역 최대 진폭

  printf("Passband ripple ≈ %.3e, Stopband max |H| ≈ %.3e\n", rp, rs);
end
```

---

## 1. 예비사항 연습 문제

### 1.1 이산시간 신호/시스템 기본

#### 문제 1-1. 주기/비주기 신호 판별

다음 이산시간 신호의 주기성을 판별하라.

1. $$x_1[n] = \sin\left(\frac{\pi}{4} n \right)$$  
2. $$x_2[n] = \cos\left(\frac{\pi}{5} n \right) + \cos\left(\frac{\pi}{2} n \right)$$  
3. $$x_3[n] = \sin\left(2\pi \cdot 0.3 n\right)$$  

각 신호에 대해

- 기본 주기 $$N_0$$ (존재한다면)
- 디지털 각주파수 $$\omega_0$$ 와의 관계

를 정리하라.

##### 풀이 스케치

- 이산시간 정현파 $$x[n] = \sin(\omega_0 n)$$ 이 **주기적**이려면,  
  어떤 양의 정수 $$N_0$$ 에 대해

  $$
  \omega_0 N_0 = 2\pi k,\quad k \in \mathbb{Z}
  $$

  이 성립해야 한다.

- 1번:

  $$
  \omega_0 = \frac{\pi}{4} \Rightarrow \omega_0 N_0 = 2\pi k
  $$

  $$N_0 = 8k$$, 최소 양의 정수는 $$N_0 = 8$$ → 주기 신호.

- 2번:  
  각 성분의 각주파수는 $$\pi/5, \pi/2$$

  - 첫 번째 성분의 주기:  
    $$\frac{\pi}{5} N_1 = 2\pi k_1 \Rightarrow N_1 = 10k_1 \Rightarrow N_1 = 10$$  
  - 두 번째 성분의 주기:  
    $$\frac{\pi}{2} N_2 = 2\pi k_2 \Rightarrow N_2 = 4k_2 \Rightarrow N_2 = 4$$  

  전체 신호의 주기는 두 성분 주기의 **최소공배수**  
  $$N_0 = \mathrm{lcm}(10, 4) = 20$$

- 3번:  
  $$\omega_0 = 2\pi \cdot 0.3 = 0.6\pi$$  
  주기 조건:

  $$
  0.6\pi N_0 = 2\pi k \Rightarrow 0.6 N_0 = 2k \Rightarrow N_0 = \frac{2k}{0.6} = \frac{10k}{3}
  $$

  $$N_0$$ 가 정수가 되려면 $$k$$ 가 3의 배수여야 한다. 예를 들어 $$k=3$$ 이면 $$N_0=10$$.  
  따라서 이 신호도 주기적이고, 기본 주기는 $$N_0=10$$.

---

#### 문제 1-2. 이상 저역통과 필터의 임펄스 응답

샘플링 주파수 $$F_s = 48\,\mathrm{kHz}$$,  
하나의 이상 저역통과 필터를 가정한다.

- 통과대역: $$|F| \le F_c = 4.8\,\mathrm{kHz}$$  
- 즉, 정규화 컷오프 $$f_c = F_c / (F_s/2) = 0.2$$

1. 이상 주파수 응답 $$H_d(e^{j\omega})$$ 를 수식으로 쓰고,  
2. 그에 대응하는 임펄스 응답 $$h_d[n]$$ 을 유도하라.

##### 풀이 스케치

이상 저역통과:

$$
H_d(e^{j\omega}) =
\begin{cases}
1, & |\omega| \le \omega_c \\
0, & \text{그 외}
\end{cases}
$$

여기서

$$
\omega_c = 2\pi \frac{F_c}{F_s} = 0.4\pi
$$

임펄스 응답은 역 DTFT:

$$
h_d[n]
=
\frac{1}{2\pi}\int_{-\omega_c}^{\omega_c} e^{j\omega n} d\omega
=
\frac{1}{\pi} \frac{\sin(\omega_c n)}{n}, \quad n \neq 0
$$

$$
h_d[0] = \frac{\omega_c}{\pi}
$$

즉,

$$
h_d[n] =
\begin{cases}
\frac{\omega_c}{\pi}, & n=0 \\
\frac{\sin(\omega_c n)}{\pi n}, & n \neq 0
\end{cases}
$$

이는 **이상적인 시inc 형식** 임펄스 응답이다.

---

### 1.2 정규화 스펙 변환 연습

#### 문제 1-3. 아날로그 스펙 → 정규화 스펙

표 1과 같은 아날로그 스펙을 정규화하라.

| 항목              | 값                      |
|-------------------|-------------------------|
| 샘플링 주파수     | $$F_s = 44.1\,\text{kHz}$$ |
| 통과대역 끝       | $$F_p = 6\,\text{kHz}$$     |
| 저지대역 시작     | $$F_s' = 8\,\text{kHz}$$    |

1. 정규화 통과대역 끝 $$f_p$$ 와 저지대역 시작 $$f_s$$ 를 구하라.  
2. 이를 이용해 `remez` 나 `fir1`에서 사용할 `f` 벡터를 작성하라.

##### 풀이

정규화:

$$
f_p = \frac{F_p}{F_s/2}
= \frac{6000}{22050}
\approx 0.272
$$

$$
f_s = \frac{F_s'}{F_s/2}
= \frac{8000}{22050}
\approx 0.363
$$

Octave에서:

```octave
Fs = 44100;
Fp = 6000;
Fs1 = 8000;

fp = Fp / (Fs/2);
fs = Fs1 / (Fs/2);

f = [0, fp, fs, 1];
a = [1, 1, 0, 0];   % LPF 스펙
```

---

## 2. 선형 위상 FIR 필터 특성 연습 문제

### 2.1 타입 구분(Type I~IV) 연습

#### 문제 2-1. FIR 계수 대칭성에서 타입 판별

다음 FIR 계수 벡터들에 대해 **선형 위상 타입(Type I~IV)** 을 판별하라.  
(길이 $$L$$, 중심 인덱스, 대칭/반대칭 여부 기준)

1. $$h_1[n] = [0.1, 0.4, 0.5, 0.4, 0.1]$$  
2. $$h_2[n] = [-0.2, 0.3, 0.0, -0.3, 0.2]$$  
3. $$h_3[n] = [0.1, 0.4, 0.6, 0.4, 0.1, 0]$$  

각각

- 길이 $$L$$
- 대칭성 $$h[n] = h[L-1-n]$$ 또는 반대칭 $$h[n] = -h[L-1-n]$$
- 타입 분류

를 적어라.

##### 풀이 스케치

1. $$h_1$$:
   - 길이 $$L = 5 = 2N+1 \Rightarrow N=2$$
   - $$h_1[0]=0.1, h_1[4]=0.1$$  
     $$h_1[1]=0.4, h_1[3]=0.4$$  
     $$h_1[2]=0.5$$ 중심
   - **대칭** → **Type I** (홀수 길이, 대칭)

2. $$h_2$$:
   - 길이 $$L=5$$
   - $$h_2[0]=-0.2, h_2[4]=0.2 \Rightarrow h_2[0] = -h_2[4]$$  
     $$h_2[1]=0.3, h_2[3]=-0.3 \Rightarrow h_2[1] = -h_2[3]$$  
     $$h_2[2]=0$$
   - **반대칭** → 홀수 길이, 반대칭 → **Type III**

3. $$h_3$$:
   - 길이 $$L=6 = 2N \Rightarrow N=3$$
   - $$h_3[0]=0.1, h_3[5]=0$$ → 대칭/반대칭 성립 X  
   - 이 계수는 **엄밀한 선형 위상 구조가 아님**.  
     (선형 위상 FIR 로 설계된 계수가 아니라는 뜻.)

---

#### 문제 2-2. 그룹 지연 계산

Type I FIR 필터의 계수가 길이 $$L=2N+1$$ 대칭 $$h[n] = h[L-1-n]$$ 라고 하자.

1. 이 필터의 주파수 응답이

   $$
   H(e^{j\omega}) = e^{-j\omega N} A(\omega)
   $$

   꼴로 쓸 수 있음을 보이고, 그룹 지연이 $$\tau_g = N$$ 임을 설명하라.

##### 풀이 스케치

대칭 FIR 에서

$$
H(e^{j\omega})
=
\sum_{n=0}^{2N} h[n] e^{-j\omega n}
=
e^{-j\omega N}
\sum_{n=0}^{2N} h[n] e^{-j\omega (n-N)}
$$

인덱스 치환 $$k = n-N$$ 를 하면

$$
H(e^{j\omega})
=
e^{-j\omega N}
\sum_{k=-N}^{N} h[N+k] e^{-j\omega k}
$$

대칭성 $$h[N+k]=h[N-k]$$ 를 활용하면  
내부 합이 **짝함수**가 되어 **실수**가 된다:

$$
A(\omega) = \sum_{k=-N}^{N} h[N+k] e^{-j\omega k} \in \mathbb{R}
$$

따라서

$$
H(e^{j\omega}) = A(\omega) e^{-j\omega N}
$$

위상은

$$
\angle H(e^{j\omega}) = \angle A(\omega) - \omega N
$$

선형 위상을 위해 $$A(\omega) \ge 0$$ 인 영역에서는  
$$\angle A(\omega) \approx 0$$ 로 보고

$$
\angle H(e^{j\omega}) \approx -\omega N
$$

그룹 지연은

$$
\tau_g(\omega) = -\frac{d}{d\omega} \angle H(e^{j\omega}) \approx N
$$

즉, **전 대역에서 거의 일정한 N 샘플 지연**을 가진다.

---

### 2.2 Octave로 선형 위상 확인

#### 문제 2-3. 설계된 FIR의 위상/그룹지연 확인

창함수 설계로 얻은 Hamming 창 저역통과 필터에 대해

1. 위상 응답이 거의 선형임을 확인하고,  
2. 그룹 지연이 거의 일정함을 확인하라.

샘플링 $$F_s=48\,\mathrm{kHz}$$,  
Hamming 창, 차수 $$N=60$$, 컷오프 $$f_c=0.2$$ 로 한다.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
fc = 0.2;      % 정규화 컷오프 (0~1)
N  = 60;

b = fir1(N, fc, "low", hamming(N+1));  % Type I FIR

[H, w] = freqz(b, 1, 1024);
f = w / pi;

mag = abs(H);
pha = unwrap(angle(H));
grp = -diff(pha) ./ diff(w);   % 그룹지연 근사

figure;
subplot(3,1,1);
plot(f, mag); grid on;
xlabel('Normalized Frequency'); ylabel('|H|');
title('Magnitude Response');

subplot(3,1,2);
plot(f, pha); grid on;
xlabel('Normalized Frequency'); ylabel('Phase (rad)');
title('Phase Response');

subplot(3,1,3);
plot(f(1:end-1), grp);
grid on;
xlabel('Normalized Frequency'); ylabel('Group Delay (samples)');
title('Group Delay');
```

- 위상 플롯이 대략 직선.
- 그룹 지연이 거의 상수 (약 $$N/2 = 30$$ 근처) 인지 확인한다.

---

## 3. 창함수 설계 기법 연습 문제

### 3.1 창 종류에 따른 스펙 비교

#### 문제 3-1. Rectangular vs Hamming vs Blackman

샘플링 $$F_s = 48\,\mathrm{kHz}$$ 에서,  
다음 공통 사양을 가진 저역통과 필터를 창함수로 설계하라.

- 컷오프 정규화 주파수 $$f_c = 0.2$$
- 필터 차수 $$N = 60$$

1. Rectangular, Hamming, Blackman 창을 각각 사용하여 FIR 필터를 설계하라.  
2. 각 필터의
   - 통과대역 리플
   - 저지대역 감쇠  
   를 측정하라.  
3. 결과를 표로 정리하라.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
fc = 0.2;
N  = 60;
fp = 0.18;      % 통과대역 평가 범위
fs = 0.22;      % 저지대역 평가 시작

% 1) Rectangular
b_rect = fir1(N, fc, "low", rectwin(N+1));
% 2) Hamming
b_ham  = fir1(N, fc, "low", hamming(N+1));
% 3) Blackman
b_blk  = fir1(N, fc, "low", blackman(N+1));

printf("Rectangular window:\n");
[rp_rect, rs_rect] = measure_ripple(b_rect, fp, fs);
printf("Hamming window:\n");
[rp_ham,  rs_ham]  = measure_ripple(b_ham,  fp, fs);
printf("Blackman window:\n");
[rp_blk,  rs_blk]  = measure_ripple(b_blk,  fp, fs);

% 스펙트럼 비교
[Hrect, w] = freqz(b_rect, 1, 4096);
[Hham,  ~] = freqz(b_ham,  1, 4096);
[Hblk,  ~] = freqz(b_blk,  1, 4096);
f = w / pi;

figure;
plot(f, 20*log10(abs(Hrect)+eps), ...
     f, 20*log10(abs(Hham)+eps), ...
     f, 20*log10(abs(Hblk)+eps));
grid on;
xlabel('Normalized Frequency');
ylabel('Magnitude (dB)');
legend('Rect', 'Hamming', 'Blackman');
title('Window-based LPF Comparison');
ylim([-120 5]);
```

실제로 출력되는 통과대역 리플과 저지대역 감쇠를 보고,  
아래와 같은 표를 채운다(숫자는 예시):

| 창 종류      | 통과대역 리플 (대략) | 저지대역 감쇠(dB, 대략) |
|--------------|----------------------|--------------------------|
| Rectangular  | 비교적 큼            | 약 -21 dB 수준           |
| Hamming      | 작음                  | 약 -53 dB 수준           |
| Blackman     | 더 작음               | 약 -74 dB 수준           |

---

### 3.2 전이대역 vs 차수 관계 실기

#### 문제 3-2. Hamming 창에서 차수 변화에 따른 전이대역

Hamming 창 기반 저역통과 필터에서

- $$f_c = 0.2$$ (정규화) 고정
- 차수 $$N = 30, 60, 120$$

일 때, 각 필터의

1. 전이대역 폭 (예: 통과대역 0~0.2, 저지대역 시작을 `-60 dB` 지점으로 잡고 측정)  
2. 저지대역 최대 감쇠

를 측정하고, 차수 증가가 어떤 효과를 가지는지 분석하라.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
fc = 0.2;
orders = [30, 60, 120];

for N = orders
  b = fir1(N, fc, "low", hamming(N+1));
  [H, w] = freqz(b, 1, 4096);
  f = w / pi;
  HdB = 20*log10(abs(H)+eps);

  % 전이대역 시작/끝 찾기: 통과대역 끝 0.2, 
  % -60 dB 이하가 되는 첫 주파수 지점을 저지대역 시작으로 본다.
  idx_pass = find(f <= fc);
  idx_stop = find(f >= fc);

  % -1 dB 지점 정도를 passband edge로 삼을 수도 있으나, 
  % 여기서는 간단히 fc 근방에서 확인
  idx_60 = idx_stop(find(HdB(idx_stop) <= -60, 1, "first"));
  if isempty(idx_60)
    f60 = NaN;
  else
    f60 = f(idx_60);
  end

  if ~isnan(f60)
    trans_bw = f60 - fc;
  else
    trans_bw = NaN;
  end

  rs = max(abs(H(idx_stop)));

  printf("N=%d: transition ≈ %g, stopband max |H| ≈ %.3e\n", ...
          N, trans_bw, rs);
end
```

- 차수가 늘어나면 전이대역이 좁아지고, 저지대역 감쇠도 더 좋아지는 경향을 확인한다.

---

## 4. 주파수 샘플링 설계 기법 연습 문제

### 4.1 기본 주파수 샘플링 설계

#### 문제 4-1. 균등 주파수 격자의 저역통과 설계

길이 $$L = 21$$ 인 FIR 필터를 **주파수 샘플링법**으로 설계하려 한다.  
디지털 각주파수 격자를

$$
\omega_k = \frac{2\pi k}{L}, \quad k = 0, 1, \dots, L-1
$$

로 잡고, 이상 저역통과 스펙을

- $$|\omega| \le 0.5\pi$$ → $$H_d(e^{j\omega}) = 1$$  
- 그 외 → $$H_d(e^{j\omega}) = 0$$

로 가정한다.

1. 각 격자점 $$\omega_k$$ 에서 원하는 값 $$H_d(\omega_k)$$ 를 정의하라.  
2. 이 값을 IDFT로 변환해서 임펄스 응답 $$h[n]$$ 을 구하는 식을 적어라.  
3. GNU Octave 코드로 이를 구현하라.

##### 풀이 스케치

1. 격자점에서

   $$
   H_k =
   \begin{cases}
   1, & |\omega_k| \le 0.5\pi \\
   0, & \text{그 외}
   \end{cases}
   $$

   디지털 각주파수는 0~2π 범위에서

   $$
   \omega_k = \frac{2\pi k}{L}
   $$

   Nyquist (π) 기준으로 생각하면,  
   $$\omega_k \le 0.5\pi$$ 에 대응하는 인덱스를 찾으면 된다.

2. IDFT:

   $$
   h[n] = \frac{1}{L} \sum_{k=0}^{L-1} H_k e^{j\omega_k n}
   $$

3. Octave 코드

```octave
clear; close all; clc;

L = 21;
k = 0:L-1;
omega_k = 2*pi*k/L;

Hk = zeros(1,L);
for idx = 1:L
  if omega_k(idx) <= 0.5*pi
    Hk(idx) = 1;
  else
    Hk(idx) = 0;
  end
end

% IDFT (시간영역 계수)
n = 0:L-1;
h = zeros(1,L);
for nn = 1:L
  h(nn) = (1/L) * sum(Hk .* exp(1j * omega_k * (nn-1)));
end

% 실수부 사용
h = real(h);

% 주파수 응답 확인
[H, w] = freqz(h, 1, 1024);
f = w / pi;

figure;
subplot(2,1,1);
stem(n, h, 'filled');
grid on; xlabel('n'); ylabel('h[n]');
title('Impulse Response (Frequency Sampling)');

subplot(2,1,2);
plot(f, abs(H));
grid on; xlabel('Normalized Frequency');
ylabel('|H(e^{j\omega})|');
title('Magnitude Response');
```

- 이상적인 저역통과와 비교하면 리플이 존재하고,  
  전이대역도 매끄럽지 않다는 것을 확인해 볼 수 있다.

---

### 4.2 임의 스펙의 주파수 샘플링

#### 문제 4-2. 비대칭 대역 스펙 설계

길이 $$L=33$$ 인 FIR 필터를 주파수 샘플링법으로 설계하려 한다.  
주파수 샘플 링 격자는

$$
\omega_k = \frac{2\pi k}{L},\quad k=0,\dots,L-1
$$

이고, 다음과 같은 “계단형” 스펙을 갖는 필터를 만들고자 한다.

- 0~0.2π: 진폭 1  
- 0.2π~0.4π: 진폭 0.5  
- 0.4π~π: 진폭 0  

1. 각 격자점에서의 샘플 값 $$H_k$$ 를 설정하라.  
2. IDFT를 통해 $$h[n]$$ 을 구하고, 실제 주파수 응답이 이상 스펙과 얼마나 다른지 시각적으로 비교하라.

##### 풀이/코드 예

```octave
clear; close all; clc;

L = 33;
k = 0:L-1;
omega_k = 2*pi*k/L;

Hk = zeros(1,L);
for idx = 1:L
  w = omega_k(idx);
  if w <= 0.2*pi
    Hk(idx) = 1;
  elseif w <= 0.4*pi
    Hk(idx) = 0.5;
  else
    Hk(idx) = 0;
  end
end

n = 0:L-1;
h = zeros(1,L);
for nn = 1:L
  h(nn) = (1/L) * sum(Hk .* exp(1j * omega_k * (nn-1)));
end
h = real(h);

[H, w] = freqz(h, 1, 2048);
f = w / pi;

figure;
subplot(2,1,1);
stem(n, h, 'filled');
grid on; xlabel('n'); ylabel('h[n]');
title('Impulse Response (Freq Sampling, 3-level spec)');

subplot(2,1,2);
plot(f, abs(H)); grid on;
xlabel('Normalized Frequency'); ylabel('|H|');
title('Magnitude Response');
```

- 특히 계단형 스펙의 **전이 부근**에서 리플이 어떻게 나타나는지 관찰한다.

---

## 5. 최적 등리플 설계 기법 연습 문제

### 5.1 창함수 vs 등리플 비교

#### 문제 5-1. Hamming vs Equiripple (동일 스펙 비교)

샘플링 $$F_s=48\,\text{kHz}$$,  
저역통과 필터 사양:

- 통과대역 끝: $$F_p = 4.8\,\text{kHz} \Rightarrow f_p=0.2$$  
- 저지대역 시작: $$F_s' = 7.2\,\text{kHz} \Rightarrow f_s=0.3$$  
- 차수 $$N=60$$

1. Hamming 창 기반 FIR (`fir1`) 설계와,  
   최적 등리플(`remez`) 설계를 각각 수행하라.  
2. 두 필터의
   - 통과대역 리플
   - 저지대역 최대 진폭(감쇠)  
   를 측정하고, 어떤 것이 더 “효율적인지” 비교하라.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
Fp = 4800;
Fs1 = 7200;

fp = Fp / (Fs/2);   % 0.2
fs = Fs1 / (Fs/2);  % 0.3

N = 60;

% 1) Hamming window design
b_ham = fir1(N, fp, "low", hamming(N+1));

% 2) Equiripple design (remez)
f = [0, fp, fs, 1];
a = [1, 1, 0, 0];
w = [1, 10];  % 저지대역에 더 큰 가중

b_eq = remez(N, f, a, w);

printf("Hamming window design:\n");
[rp_ham, rs_ham] = measure_ripple(b_ham, fp, fs);

printf("Equiripple design:\n");
[rp_eq, rs_eq] = measure_ripple(b_eq, fp, fs);

[Hh, wgrid] = freqz(b_ham, 1, 4096);
[He, ~]     = freqz(b_eq, 1, 4096);
fgrid = wgrid / pi;

figure;
subplot(2,1,1);
plot(fgrid, abs(Hh), fgrid, abs(He));
grid on; xlabel('Normalized Frequency'); ylabel('|H|');
legend('Hamming', 'Equiripple');
title('Magnitude (Linear)');

subplot(2,1,2);
plot(fgrid, 20*log10(abs(Hh)+eps), ...
     fgrid, 20*log10(abs(He)+eps));
grid on; xlabel('Normalized Frequency'); ylabel('dB');
legend('Hamming', 'Equiripple');
title('Magnitude (dB)');
ylim([-120 5]);
```

- 결과를 표로 정리:

| 필터 종류  | 통과대역 리플 | 저지대역 감쇠(dB) | 특징 설명                         |
|------------|----------------|--------------------|------------------------------------|
| Hamming    | 중간           | 특정 dB (예: -50)  | 전이대역 비교적 넓음             |
| Equiripple | 유사 혹은 작음 | 더 큰 감쇠 (예: -60 이상) | 같은 차수에서 더 날카로운 스펙 |

---

### 5.2 가중치 효과 실험

#### 문제 5-2. 가중치 비에 따른 리플 분배

동일한 사양의 저역통과 필터(문제 5-1과 동일)를 두고,  
가중치 벡터를

1. `w = [1, 1]`  
2. `w = [1, 10]`  
3. `w = [1, 50]`  

로 바꿔가며 `remez` 설계를 수행하라.

각 경우에 대해

- 통과대역 리플
- 저지대역 리플(= 저지대역 최대 진폭)

을 측정하고, **가중치 비**와 **리플 비**의 관계를 관찰하라.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
Fp = 4800; Fs1 = 7200;
fp = Fp / (Fs/2);  % 0.2
fs = Fs1 / (Fs/2); % 0.3
N  = 60;
f = [0, fp, fs, 1];
a = [1, 1, 0, 0];

weights = [ 1,  1;
            1, 10;
            1, 50 ];

for idx = 1:size(weights,1)
  Wpass = weights(idx, 1);
  Wstop = weights(idx, 2);
  w = [Wpass, Wstop];

  b = remez(N, f, a, w);
  [rp, rs] = measure_ripple(b, fp, fs);

  printf("Wpass=%.1f, Wstop=%.1f: rp≈%.3e, rs≈%.3e\n", ...
          Wpass, Wstop, rp, rs);
end
```

- 이론적으로 가중 오차를 기준으로 등리플이므로,  
  진폭 리플 크기는

  $$
  \text{passband ripple} \approx \frac{\delta}{W_{\text{pass}}}, \quad
  \text{stopband ripple} \approx \frac{\delta}{W_{\text{stop}}}
  $$

  관계를 가진다.

---

### 5.3 멀티밴드 Equi-ripple 설계

#### 문제 5-3. 2대역 필터 설계

샘플링 $$F_s = 48\,\text{kHz}$$ 에서,  
다음과 같은 스펙을 갖는 필터를 Equi-ripple로 설계하라.

- 대역1(저역통과 성분): 0~4.8 kHz → 진폭 1  
- 저지대역: 6~8.4 kHz → 진폭 0  
- 대역2(대역통과 성분): 9.6~12 kHz → 진폭 0.7  
- 그 외: 0

정규화 후, 주파수 벡터와 진폭 벡터, 가중치를 설정하고,  
`remez` 로 설계한 필터의 주파수 응답을 시각화하라.

##### 풀이/코드 예

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
F1p = 4800;  % passband1 end
F1s = 6000;  % stopband start1
F2s = 8400;  % stopband end1
F2p1 = 9600; % passband2 start
F2p2 = 12000;% passband2 end

f1p = F1p / (Fs/2);   % ~0.2
f1s = F1s / (Fs/2);   % ~0.25
f2s = F2s / (Fs/2);   % ~0.35
f2p1= F2p1/ (Fs/2);   % ~0.4
f2p2= F2p2/ (Fs/2);   % ~0.5

% 대역 정의: [0,f1p] (pass1), [f1s,f2s] (stop),
% [f2p1,f2p2] (pass2), [f2p2,1] (stop)
f = [0, f1p,  f1s, f2s,  f2p1, f2p2,  f2p2, 1];

% 각 구간 진폭
a = [1, 1,  0, 0,  0.7, 0.7,  0, 0];

% 대역 수 = 4
w = [1, 10, 1, 10];   % 예: 두 passband 중요도 유사, 두 stopband 감쇠 강조

N = 100;
b = remez(N, f, a, w);

[H, wgrid] = freqz(b, 1, 4096);
fgrid = wgrid / pi;

figure;
subplot(2,1,1);
plot(fgrid, abs(H));
grid on;
xlabel('Normalized Frequency'); ylabel('|H|');
title('2-band Equiripple FIR');

subplot(2,1,2);
plot(fgrid, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized Frequency'); ylabel('dB');
title('Magnitude (dB)');
ylim([-120 10]);
```

이 문제는 **주파수 샘플링 설계**로도 구현해 볼 수 있으며,  
두 방법의 결과를 비교해 보는 것도 좋은 연습이다.

---

## 6. 종합 연습: 세 설계 기법 비교 프로젝트

### 문제 6-1. 공통 스펙에 대해 세 가지 설계 방법 비교

샘플링 $$F_s=48\,\text{kHz}$$,  
저역통과 필터 스펙:

- 통과대역 끝: 4.8 kHz (정규화 0.2)  
- 저지대역 시작: 7.2 kHz (정규화 0.3)  
- 목표:  
  - 통과대역 리플 ≈ 0.01 이내  
  - 저지대역 감쇠 ≈ 60 dB 이상

1. **창함수 설계**  
   - Hamming, Blackman 창으로 여러 차수(N=40, 60, 80)를 시도해 보고  
     위 목표를 만족시키는 최소 차수를 찾는다.
2. **주파수 샘플링 설계**  
   - 길이 $$L = N+1$$ 로 두고,  
     주파수 격자에서 이상 저역통과 스펙을 샘플링하여 IDFT로 계수를 구한다.  
   - 이 때, **선형 위상**이 되도록 격자와 샘플을 설정하는 방법을 고민해 본다.
3. **최적 등리플 설계 (`remez`)**  
   - 같은 목표를 만족하는 최소 차수를 찾아본다.  
   - 창함수 설계에서 얻은 최소 차수보다 작은 차수로도 목표를 만족시킬 수 있는지 실험한다.
4. 세 방법의 필터 계수, 주파수 응답, 차수, 연산량 관점에서 차이를 정리하라.

##### 종합 코드 예 (뼈대)

```octave
pkg load signal
clear; close all; clc;

Fs = 48000;
Fp = 4800; Fs1 = 7200;
fp = Fp / (Fs/2);   % 0.2
fs = Fs1 / (Fs/2);  % 0.3

% 1) 창함수 설계 - Hamming/Blackman 여러 차수 테스트
orders = [40, 60, 80];
for N = orders
  b_ham = fir1(N, fp, "low", hamming(N+1));
  b_blk = fir1(N, fp, "low", blackman(N+1));

  printf("[Hamming] N=%d:\n", N);
  [rp_ham, rs_ham] = measure_ripple(b_ham, fp, fs);

  printf("[Blackman] N=%d:\n", N);
  [rp_blk, rs_blk] = measure_ripple(b_blk, fp, fs);
end

% 2) 주파수 샘플링 설계 - 예: L=61 (N=60)
L = 61;    % 원하는 길이
k = 0:L-1;
omega_k = 2*pi*k/L;

Hk = zeros(1,L);
for idx = 1:L
  w = omega_k(idx);
  if w <= fp*pi
    Hk(idx) = 1;
  else
    Hk(idx) = 0;
  end
end

n = 0:L-1;
h_fs = zeros(1,L);
for nn = 1:L
  h_fs(nn) = (1/L) * sum(Hk .* exp(1j*omega_k*(nn-1)));
end
h_fs = real(h_fs);
printf("[FreqSampling] L=%d:\n", L);
[rp_fs, rs_fs] = measure_ripple(h_fs, fp, fs);

% 3) 최적 등리플 설계 - 다양한 N 검사
for N = [40, 50, 60]
  f = [0, fp, fs, 1];
  a = [1, 1, 0, 0];
  w = [1, 10];
  b_eq = remez(N, f, a, w);
  printf("[Equiripple] N=%d:\n", N);
  [rp_eq, rs_eq] = measure_ripple(b_eq, fp, fs);
end
```

실제 실행 결과를 정리하면서

- 창함수 설계 대비, equiripple 설계가 같은 스펙을 만족하기 위해 필요한 **최소 차수**가 어떻게 다른지  
- 주파수 샘플링 설계가 스펙을 만족시키기 위해 어느 정도의 길이가 필요한지  

를 수치로 비교해 보면, 각 설계 기법의 **장단점과 적용 시나리오**를 명확히 정리할 수 있다.

---

## 7. 마무리

이 연습 문제 세트는 다음 다섯 가지 축을 모두 커버하도록 구성했다.

1. **예비사항**  
   - 이산시간 신호/주파수, 이상 필터, 정규화 스펙 변환.
2. **선형 위상 FIR 특성**  
   - 계수 대칭성(Type I~IV), 그룹 지연, 위상 응답.
3. **창함수 설계 기법**  
   - 창 종류에 따른 리플/감쇠/전이대역 차이, 차수 변화 효과.
4. **주파수 샘플링 설계 기법**  
   - 주파수 격자 샘플링 → IDFT → 임펄스 응답, 계단형 스펙 등.
5. **최적 등리플 설계 기법**  
   - `remez`를 이용한 최소 최대 오차 설계, 가중치 효과, 멀티밴드 설계, 창함수/주파수샘플링과의 비교.