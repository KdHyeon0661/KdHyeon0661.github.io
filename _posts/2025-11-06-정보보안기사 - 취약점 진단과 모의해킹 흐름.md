---
layout: post
title: 정보보안기사 - 취약점 진단과 모의해킹 흐름
date: 2025-11-06 17:25:23 +0900
category: 정보보안기사
---
# 취약점 진단과 모의해킹 흐름(스캐닝→분석→보고서)

## 0) 한 페이지 개요(Flow)

```
[사전준비/승인] → [자산정의/스코프/ROE] → [정보수집(OSINT/패시브)] 
→ [스캐닝(포트/서비스/웹/클라우드)] → [검증/분석(거짓양성 제거, POC는 비파괴 우선)]
→ [심각도 산정(CVSS/KEV/노출도)] → [권고/처치·재검증] → [보고서/리뷰/재발방지]
```

핵심 원칙
- **법적·윤리 준수**: *서면* 스코프/ROE, 타사·타네임스페이스 금지.
- **세이프티 퍼스트**: `--rate`, `--max-retries`, `risk=1`(도구별 저위험), 업무시간 외, 백업/모니터링 동시.
- **재현가능성**: 모든 명령/버전/해시/스크린샷 기록 → 결과 재현.
- **비파괴 우선**: 침해 대신 **구성 취약/약점 확인** 중심. 익스플로잇은 랩 한정, 운영은 고객 승인·감시하에 시뮬레이션.

---

# 1) 사전 준비(스코프·ROE·데이터보호)

### 1.1 스코프/ROE 템플릿(요약)
- **대상**: CIDR, FQDN, API 경로, 테스트 계정, 샌드박스.
- **허용행위**: 포트스캔, 배너그랩, 디렉터리 브루트, **저위험** 인젝션 체크 등.
- **금지행위**: 데이터 파괴/유출, 대량메일/DoS, 인증우회 후 데이터 열람, 클라우드 비용 유발 테스트.
- **운영시간**: 22:00–06:00(로컬), 변경 승인 프로세스 명시.
- **연락**: 실시간 채널(보안관제/시스템 담당), 가드레일(오류시 즉시 중단).

---

# 2) 자산 식별과 태깅

### 2.1 자산 인벤토리(라벨링)
- 태그: `Owner=DevOps`, `Criticality=High`, `Data=Pii`, `Internet=Yes/No`.
- 결과물: CSV(호스트, OS, 서비스, 노출, 소유자, 변경창구).

**nmap + httpx + 서비스 배너 수집(랩용)**
```bash
# 10.10.0.0/24 대역 포트 기본 스캔(침해 최소 옵션)
nmap -sS -Pn -T3 --max-retries 2 --min-rate 50 -p 1-1000 -oX out/10_10_0_0_24.xml 10.10.0.0/24

# 열린 80/443 호스트 추출 후 Alive 체크 및 title/tech 탐지
grep "portid=\"80\" state=\"open\"" -n out/10_10_0_0_24.xml; grep "portid=\"443\" state=\"open\"" -n out/10_10_0_0_24.xml

# HTTP 자산 확인(도구 예시: projectdiscovery/httpx)
cat hosts.txt | httpx -silent -status-code -title -tech-detect -json -o out/http_assets.json
```

**간단 파서(Python, 보고용 CSV)**
```python
# parse_nmap.py (랩에서만 사용)
import xml.etree.ElementTree as ET, csv, sys
tree=ET.parse(sys.argv[1]); root=tree.getroot()
rows=[]
for host in root.findall('host'):
    addr = host.find('address').attrib.get('addr','')
    os = (host.find('./os/osmatch') or {}).attrib.get('name','')
    for p in host.findall('ports/port'):
        if p.find('state').attrib.get('state')=='open':
            svc = p.find('service')
            rows.append([addr, p.attrib['portid'], svc.attrib.get('name',''), svc.attrib.get('product','')])
with open('out/assets.csv','w',newline='') as f:
    csv.writer(f).writerows([["host","port","service","product"], *rows])
```

---

# 3) 스캐닝 단계(패시브 → 액티브 저위험)

## 3.1 패시브(소유 검증된 자산 한정)
- **DNS/Certificates**: subdomain, SAN, 만료일, CDN/프록시 여부.
- **코드·이미지 메타**: 노출된 버전/경로 패턴.
- **클라우드 메타**: 공개 버킷/퍼블릭 엔드포인트 여부(*조직 계정 한정*).

예시(Whois/DNS):
```bash
dig +short lab.example.com
dig -t NS example.com
```

## 3.2 네트워크/서비스 스캔(저위험)

**빠른 포트스캔 → 정밀 서비스 식별**
```bash
# 1) 빠른 열림 감지
masscan 10.10.0.0/16 -p1-65535 --rate 2000 -oG out/masscan.gnmap  # 랩 네트워크 한정
# 2) nmap 정밀
nmap -sV -sC -Pn -oA out/svscan -iL out/open_hosts.txt
```

**TLS/암호군 점검(비파괴)**
```bash
nmap --script ssl-enum-ciphers -p 443 lab.example.com -oN out/ssl_enum.txt
```

## 3.3 웹 스캔(구성/약점 중심)

**디렉터리/파일 브루트(저속)**
```bash
# ffuf: rate 제한/리다이렉트 추적 금지로 서버 부하 최소
ffuf -w /usr/share/seclists/Discovery/Web-Content/common.txt -u https://lab.example.com/FUZZ \
     -t 10 -rate 50 -mc 200,204,301,302,307,401,403 -o out/ffuf.json
```

**공통 취약구성 탐지(OWASP CRS 기반 규칙/Nuclei 저위험)**
```bash
# Nuclei - 저위험 템플릿만, 심각도 filter
nuclei -rl 20 -l http_targets.txt -severity low,medium -o out/nuclei_lowmed.txt
```

> ⚠️ **운영 대상**: `-severity critical,high`라도 **익스플로잇 페이로드**를 발생시키는 템플릿은 제외하세요(`-etags exploit,payload`).  
> **랩**에서만 고위험 템플릿 평가.

## 3.4 인증/권한 관련(비파괴 확인)

- 기본/약한 인증구성 확인(잠금/응답차이/에러메시지 노출).  
- 계정잠금 정책 검증은 **테스트 계정**으로, 시도 횟수/쿨다운을 ROE에 명시.

---

# 4) 분석 단계(거짓양성 제거·재현·증거화)

## 4.1 재현·증거 수집 절차
1) **원인 가설** 수립(버전/설정/노출 포인트).  
2) **재현 조건** 단순화(요청 1–2개로 축소).  
3) **증거**: 요청/응답 원문, 스크린샷, 서버 로그 타임스탬프, 설정 스니펫.  
4) **영향 범위**: 권한·데이터 등급·인터넷 노출 여부.  
5) **보정통제**: WAF/EDR/Rate Limit 존재 시 효과 확인.  

## 4.2 흔한 항목의 안전한 검증 예

### (A) TLS 취약한 암호군/프로토콜
- 도구: `nmap --script ssl-enum-ciphers`, `openssl s_client -tls1_0`  
- 증거: 취약 스위트 목록, 서버 헬로.

```bash
# TLS1.0/1.1 시도(실패하면 안전)
echo | openssl s_client -connect lab.example.com:443 -tls1
```

**권고**: 서버/프록시에 **TLS1.2/1.3만**, `HIGH:!aNULL:!MD5:!RC4`, HSTS 적용.

---

### (B) 보안 헤더 미적용
```bash
curl -sI https://lab.example.com | egrep -i 'strict-transport|content-security|x-frame-options|referrer-policy|permissions-policy'
```
**권고**:
- `Strict-Transport-Security: max-age=31536000; includeSubDomains`
- `Content-Security-Policy: default-src 'self'`
- `X-Frame-Options: DENY`, `X-Content-Type-Options: nosniff`, `Referrer-Policy: strict-origin-when-cross-origin`

---

### (C) 디렉터리 인덱싱/민감 파일 노출
```bash
# 인덱싱 페이지 패턴
curl -s https://lab.example.com/backup/ | grep -i "Index of"
```
**권고**: 인덱싱 비활성, 민감경로 인증/차단, 백업파일 배포제외.

---

### (D) 취약 버전 노출(배너/정적파일)
- 증거: `Server:`, `X-Powered-By`, `/static/js/app-1.2.3.js`.
- **권고**: 배너 제거, 버전 가리기, 주기적 패치 파이프라인.

---

### (E) SQL 인젝션 **의심** 지점(안전한 정적 진단)
> 운영 환경에서는 **데이터 변경/추출을 유발하는 행위 금지**.  
> 안전 확인: **에러기반 메시지/응답 시간 차이** 없이 입력 검증? 준비문 사용?

```bash
# 정상/의심 파라미터 응답 길이·코드 비교(읽기 전용 엔드포인트)
curl -s "https://lab.example.com/items?id=10" -o /tmp/n && stat -c%s /tmp/n
curl -s "https://lab.example.com/items?id=10'" -o /tmp/e && stat -c%s /tmp/e
```

**권고**: ORM/Prepared Statement 강제, 입력검증/인코딩, 에러메시지 일반화, DB 계정 최소권한.  
*(실제 익스플로잇 단계 명령은 운영 자산 대상 제공·사용 금지)*

---

### (F) 인증오류 핸들링(브루트포스 지표)
- **지표**: 실패 시 응답코드·문구 통일, 잠금 임계/쿨다운 존재, 2FA 적용 여부.
- **권고**: `/login`에 Rate Limit(예: IP/계정 기준), CAPTCHA(지속 공격 시), MFA.

---

## 4.3 거짓양성(오탐) 판정 체크
- WAF가 차단했지만 **서버까지 유효하지 않음** → 오탐.  
- 취약으로 보이나 **버전 백포트 패치** 적용 → 오탐.  
- 내부망만 노출/권한 없는 사용자 접근 불가능 → 위험도 하향.

---

# 5) 심각도 산정(리스크)

### 5.1 CVSS v3.1 개요
- 기본점수(BS) = 함수(공격벡터 AV, 복잡도 AC, 권한 PR, 사용자상호작용 UI, 영향 CIA).  
- 환경/임시 점수로 조정(패치 가능성, 노출도, 보정통제).

**예시: CVSS 수식 표현(개념)**
$$
\text{BaseScore} = \text{round\_up}\Big(\min(10,(\text{Impact} + \text{Exploitability}))\Big)
$$

**샘플 벡터**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N` → 고위험(9.1)

### 5.2 보조 요소
- **KEV(실제 악용)** 존재/없음.  
- **인터넷 노출** 여부.  
- **데이터 등급**(PII/재무).  
- **대체 통제**(WAF/2FA/Segmentation).

---

# 6) 권고·처치(픽스)와 재검증

## 6.1 권고 원칙
- **구체적**(설정 키·버전·예시), **검증가능**(재현 테스트케이스), **영향/리스크 교환**(성능/가용성).
- **우선순위**: (1) 인터넷 고위험 → (2) 인증·권한 → (3) 구성 약점.

## 6.2 샘플 권고 3종

### (1) TLS 약한 스위트/프로토콜 허용
- **증거**: `ssl-enum-ciphers` 결과에 `TLS_RSA_WITH_3DES_EDE_CBC_SHA` 발견.  
- **권고**: 웹서버에서 TLS1.0/1.1 비활성, 스위트 `HIGH:!aNULL:!MD5:!RC4`.  
- **검증**: `openssl s_client -tls1` 실패, SSL Labs A 이상.

**Nginx 설정 예**
```nginx
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers 'HIGH:!aNULL:!MD5:!RC4';
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
```

---

### (2) 보안 헤더 미적용
- **권고**: HSTS, CSP, XFO, XCTO, RP, PP 추가.  
- **검증**: `curl -I`로 헤더 확인, 브라우저 개발자도구 정책 위반 없음.

---

### (3) 디렉터리 인덱싱 허용
- **권고**: `autoindex off;` 또는 Apache `Options -Indexes`.  
- **검증**: `Index of` 페이지 접근 시 403/404.

---

# 7) 자동화 파이프라인(결과 병합·리포트 뼈대)

## 7.1 스캐닝 오케스트레이션(랩 스크립트)

```bash
#!/usr/bin/env bash
set -euo pipefail
TARGETS="targets.txt"
OUT="out/$(date +%F_%H%M)"
mkdir -p "$OUT"

echo "[+] Fast ports..."
masscan -iL "$TARGETS" -p1-65535 --rate 2000 -oG "$OUT/masscan.gnmap"

echo "[+] Open hosts parse..."
grep "/open/" "$OUT/masscan.gnmap" | awk '{print $2}' | sort -u > "$OUT/open_hosts.txt"

echo "[+] nmap service..."
nmap -sV -sC -Pn -oX "$OUT/nmap.xml" -iL "$OUT/open_hosts.txt"

echo "[+] httpx..."
cat "$OUT/open_hosts.txt" | httpx -silent -status-code -title -tech-detect -json -o "$OUT/http.json"

echo "[+] nuclei low/med..."
jq -r 'select(.port==80 or .port==443) | .url' "$OUT/http.json" | \
nuclei -severity low,medium -etags exploit,payload -rl 20 -o "$OUT/nuclei.txt"

echo "[+] merge to CSV..."
python3 tools/parse_nmap.py "$OUT/nmap.xml"  # 위 파서 재사용
```

> 운영 환경에서 `masscan`/`ffuf` 등 속도·스레드는 반드시 **ROE**의 제한값 사용.

## 7.2 리포트 뼈대(마크다운 → PDF 변환 가능)

```markdown
# [프로젝트명] 취약점 진단/모의해킹 결과보고서
- 일자: 2025-11-04
- 범위: lab.example.com, 10.10.0.0/24
- 수행자: SecTeam

## 1. 요약(경영진)
- 고위험: 1, 중: 3, 저: 6
- 핵심 리스크: TLS 구버전 허용(인터넷 노출), 보안헤더 미적용
- 개선 목표: 2주 내 고위험 100% 처리

## 2. 방법론
- 스캐닝: nmap(sV,sC), httpx, nuclei(low/med)
- 제한: DoS/데이터 추출 금지, 업무시간 외 수행

## 3. 상세 결과(상위 3개)
### 3.1 TLS 약한 스위트 허용 (High)
- 자산: lab.example.com:443
- 증거: 첨부 A(ssl-enum-ciphers)
- 영향: 중간자 공격 난이도 감소, 규제 미준수
- 권고: TLS1.2/1.3만 허용, 스위트 교체
- 재현: 첨부 A의 커맨드/응답

### 3.2 보안 헤더 미적용 (Medium)
...

## 4. 처리현황/재검증
- 2025-11-07: Nginx 재설정, 재검증 통과(SSL Labs A)

## 부록 A. 명령/로그/스크린샷
...
```

---

# 8) 케이스 스터디(엔드투엔드, 랩)

## 케이스 1: “인터넷 노출 웹프록시 구성 약점”
- **상황**: `lab.example.com`가 Nginx 기본 설정, HSTS/CSP 없음.
- **흐름**: `httpx`로 식별 → `curl -I` 확인 → 권고/패치 → 재검증.
- **결과**: 보안 헤더 적용, SSL Labs A, Content-Security-Policy 위반 없음.

## 케이스 2: “내부 호스트 TLS1.0 허용”
- **상황**: 내부만 노출이지만 클라이언트 다양, 규제 상 TLS1.0 금지 필요.  
- **흐름**: `ssl-enum-ciphers` → 재현 `openssl -tls1` 성공 → 위험 중간(내부) → 표준이미지 업데이트 → 롤아웃.  
- **재발방지**: CI에서 nginx.conf 정책 검사(OPA/Conftest 등).

## 케이스 3: “로그인 페이지 브루트포스 억제 미흡”
- **상황**: 실패 응답 동일, 잠금 없음, Rate Limit 없음.
- **검증**: *테스트 계정* 단 3회 시도 후 응답 동일 확인(브루트 시도는 금지).  
- **권고**: `/login`에 IP/계정당 RateLimit, 잠금·쿨다운 15분, MFA.  
- **지표**: 실패 로그인 급증 알림(5분/50회).

---

# 9) 체크리스트(운영)

**스코프/ROE**
- [ ] 서면승인, 금지행위, 시간창구, 핸드오버 연락처  
**스캐닝**
- [ ] 속도/재시도 제한, 비파괴 스크립트, 로그 남김  
**분석**
- [ ] 재현 단순화, 서버로그 타임스탬프 매칭, 오탐 체크  
**심각도**
- [ ] CVSS + KEV + 노출도 + 데이터등급  
**권고/재검증**
- [ ] 설정 예시 포함, 재현테스트·완료일, 리스크잔여치  
**보고**
- [ ] 경영요약/기술상세/부록 증거/처리현황 표

---

# 10) 트러블슈팅

- **스캔으로 서비스 지연**: 즉시 중단, 속도 1/10로, 야간 재개.  
- **오탐 빈발(특히 WAF 환경)**: 내부 로그로 실제 도달 여부 확인, WAF 룰 ID 기록.  
- **SSL/TLS 스캔 실패**: SNI/프록시/MTLS 확인.  
- **보고서 가독성 저하**: “증거→영향→권고→재현” 순으로 정리, 기술용어는 부록.

---

# 11) 부록: 도구별 안전 옵션 요약

| 도구 | 안전 스위치 예 | 메모 |
|---|---|---|
| `nmap` | `-T3 --max-retries 2 --defeat-rst-ratelimit` | 속도·재시도 제한 |
| `masscan` | `--rate 1000~5000` | 내부 랩 전용 / 운영 금지 |
| `ffuf` | `-rate 50 -t 10` | 저속 브루트 |
| `nuclei` | `-severity low,medium -etags exploit` | 익스플로잇 제외 |
| `httpx` | `-status-code -title -tech-detect` | 정보수집 |
| `curl` | `-I --http2` | 헤더/프로토콜 확인 |

---

# 12) 요약(암기 포인트)

- **스캐닝**은 비파괴/저속/로깅이 기본, **분석**은 재현가능성·오탐제거, **보고**는 실행가능한 권고와 재검증까지.
- **TLS/헤더/노출경로**는 빠르게 개선 가능한 **구성 취약**의 3대장.
- **CVSS + KEV + 노출도**로 현실적 위험 산정 → 우선순위화.
- 모든 단계는 **법적·윤리** 준수 하에, **랩**과 **운영**을 엄격히 구분.
