---
layout: post
title: 정보보안기사 - 네트워크와 보안 위협 · OSI 7계층
date: 2025-11-06 20:25:23 +0900
category: 정보보안기사
---
# · 02. OSI 7계층(OSI 7 Layer) 모델

## 학습 목표와 구성

- **목표 1**: 네트워크 공격을 **OSI 계층**과 **공격 단계(정보수집→침투→C2→유출)**로 구조화해 기억한다.
- **목표 2**: 계층별 **핵심 방어 통제**(예: L2는 DAI/Port Security, L3는 uRPF, L4는 SYN Cookies, L7는 WAF 등)를 장비별로 연결한다.
- **목표 3**: **가시성(로그/플로우)** 확보, 간단한 **실습 명령**으로 상태를 점검하고 증적을 남긴다.

---

## 네트워크와 보안 위협(공격)

### 위협 지형(객체·성과·행위 기준)

| 구분 | 예 | 방어 핵심 |
|---|---|---|
| 수동(도청/수집) | 스니핑, 패시브 DNS | 암호화(TLS), 세그멘테이션, 포트 미러링 통제 |
| 능동(교란/침투) | ARP 스푸핑, 세션 하이재킹, 스캔 | L2 보호(DAI/IPS), ACL, IDS 탐지 |
| 증폭/자원고갈 | DNS/NTP/SSDP 리플렉션, SYN Flood | RRL/BCP38/uRPF, SYN Cookies, 레이트 리밋 |
| 위장/우회 | IP/MAC 스푸핑, 도메인 섀도잉 | 소스 검증, DNS 보안, 제로트러스트 |
| 내부자/구성오류 | 오픈 리졸버, 넓은 ACL, 우발적 포워딩 | 최소 권한, 변경관리, 정기 점검 |

**공격 단계(킬체인)와 로그 매핑(요약)**
- **정찰**: 포트 스캔(방화벽/IPS 로그, NetFlow 스파이크)
- **침투/확대**: 스푸핑/세션탈취(ARP/ND, 802.1X 실패), 취약서비스 악용(IDS)
- **지속/내부이동**: 비정상 SMB/RDP, 내부 DNS 질의 이상(Zeek/EDR)
- **유출**: 대용량 외부 전송(NetFlow/IPFIX), 이상 도메인/DoH 탐지(DNS 로그)

### 계층별 대표 공격 ↔ 방어 개관

| OSI | 공격(예) | 방어(핵심) |
|---|---|---|
| L1/2 | MAC 플러딩, **ARP 스푸핑**, VLAN 호핑, STP 오남용 | Port Security, **DHCP Snooping + DAI**, IP Source Guard, BPDU Guard |
| L3 | **IP 스푸핑**, 라우팅 오염, ICMP 악용 | **uRPF**, BCP38, 라우팅 인증, ICMP 레이트 리밋 |
| L4 | **SYN Flood**, UDP Flood, Slowloris(경계) | **SYN Cookies**, conntrack/레이트 리밋, LB 보호 |
| L5/6 | TLS 다운그레이드/중간자, 세션 하이재킹 | TLS1.2+/HSTS/ALPN 고정, 재인증, 키 관리 |
| L7 | **DNS 캐시포이즈닝/증폭**, HTTP 인젝션/XSS/CSRF/SSRF, 파일 업로드 악용 | DNSSEC/RRL/권한 분리, **WAF**, 입력검증, CSP, 제한적 아웃바운드 |

---

## 보안: 스위칭·ARP·DHCP·STP

### ARP 스푸핑 & DAI(Dynamic ARP Inspection)

- **문제**: ARP는 인증이 없어 **게이트웨이 MAC**을 공격자가 가로채 스니핑/중간자 가능.
- **방어**: **DHCP Snooping**으로 IP↔MAC 바인딩 학습 → **DAI**가 ARP Reply 검증.

스위치(벤더 유사 개념 예시):
```
# DHCP Snooping

ip dhcp snooping
ip dhcp snooping vlan 10
interface Gi1/0/1
  ip dhcp snooping trust        # 업링크/서버측만 신뢰
!
# DAI

ip arp inspection vlan 10
interface Gi1/0/2
  ip arp inspection limit rate 30
```

### Port Security & VLAN 호핑 차단

- **Port Security**: 포트별 MAC 수 제한, 위반 시 Shutdown/Restrict.
- **VLAN 호핑**: 트렁크 네이티브 VLAN 오남용 → **사용자 포트는 Access로 고정**, **DTP 비활성**.

```
interface Gi1/0/10
  switchport mode access
  switchport access vlan 20
  switchport nonegotiate
  switchport port-security
  switchport port-security maximum 2
  switchport port-security violation restrict
```

### STP 보호

- **BPDU Guard**: 에지 포트에서 BPDU 수신 시 차단(루트 쟁탈 방지).
- **Root Guard**: 하위 장비가 루트 주장 금지.

```
spanning-tree portfast default
spanning-tree bpduguard default
interface Gi1/0/10
  spanning-tree guard root
```

---

## 보안: IP 스푸핑, 라우팅·ICMP

### & BCP38

- **원리**: 입력 패킷의 소스가 **라우팅 테이블 역방향 경로**로 되돌아갈 수 없으면 드롭.
- **목적**: **소스 스푸핑 차단**, 리플렉션 DDoS 억제(엣지에서).

```
# Router example (Loose mode)

interface Gi0/0
  ip verify unicast source reachable-via rx allow-default
```

### ICMP 제어

- **완전 차단 금물**: PMTUD·진단 필요.
- **권장**: 레이트 리밋, 특정 타입 허용(3, 11, 0/8 등).

리눅스 호스트:
```bash
# 과도한 ICMP 에코 요청 제한(예: nftables)

nft add rule inet filter input icmp type echo-request limit rate 10/second accept
nft add rule inet filter input icmp drop
```

---

## 보안: TCP/UDP, SYN Flood 대응

### SYN Flood 관점

- 대기열 고갈 → 합법 연결 불가.
- 방어: **SYN Cookies**, 백로그 증설, **레이트 리밋/connlimit**, L4 LB/프록시 보호.

리눅스 커널 튜닝:
```bash
# SYN cookies 활성

sysctl -w net.ipv4.tcp_syncookies=1
# 백로그 큐 확장

sysctl -w net.ipv4.tcp_max_syn_backlog=4096
# TIME_WAIT 재활용(신중)

sysctl -w net.ipv4.tcp_tw_reuse=1
```

nftables(간이 레이트 리밋):
```bash
nft add rule inet filter input tcp flags syn limit rate 50/second accept
nft add rule inet filter input tcp flags syn drop
```

**탐지(서버 측)**
```bash
# 백로그/큐 상태

ss -s
# 특정 포트 ESTAB/SYN-RECV 카운트

ss -ant state syn-recv '( sport = :80 )'
```

---

## L5–L7 보안: 세션·표현·응용 계층

### DNS 보안(증폭·캐시 변조)

- **증폭/리플렉션**: 작은 쿼리→큰 응답, 스푸핑 소스 악용.
- **방어**: **권한 분리(권한/재귀 서버 분리)**, **RRL(Response Rate Limiting)**, **DNSSEC**, Anycast, **재귀 제한(ACL)**.

BIND 예(개념):
```
options {
    recursion yes;
    allow-recursion { 10.0.0.0/8; 192.168.0.0/16; };
    rate-limit { responses-per-second 10; };
};
```

**탐지 쿼리(Windows)**
```powershell
# 최근 1시간 DNS 서버 이벤트(경고/오류)

Get-WinEvent -LogName 'DNS Server' -MaxEvents 1000 |
  Where-Object TimeCreated -gt (Get-Date).AddHours(-1) |
  Select TimeCreated, Id, Message
```

### 보안(요약)

- 위협: 인젝션/XSS/CSRF/SSRF/RCE, 파일 업로드 악용, 헤더 우회.
- 방어: **TLS 1.2+**, HSTS, 안전한 쿠키, **WAF 규칙**, 입력검증, 업로드 확장자·MIME·사이즈 제한, 서버측 요청 제한(아웃바운드 ACL), 로깅.

Nginx(기본 하드닝 예시):
```nginx
server {
  listen 443 ssl http2;
  ssl_protocols TLSv1.2 TLSv1.3;
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
  add_header X-Content-Type-Options nosniff;
  add_header X-Frame-Options DENY;
  client_max_body_size 10m;   # 업로드 제한
}
```

### 메일/파일/원격접속(힌트)

- SMTP: SPF/DKIM/DMARC, 아웃바운드 스팸 릴레이 차단(스마트호스트·인증).
- 원격: SSH 키 기반/MFA, RDP NLA/RCG, **세그멘테이션**.

---

## 관측성(가시성): 패킷·플로우·이벤트

### tcpdump / Wireshark

```bash
# 서버: 80/TCP SYN만 관측

sudo tcpdump -nni eth0 'tcp dst port 80 and tcp[tcpflags] & tcp-syn != 0 and tcp[tcpflags] & tcp-ack = 0'

# 탐지

sudo tcpdump -nni eth0 'udp port 53 and greater 1000'
```

Wireshark 필터:
```
# SYN Flood 징후

tcp.flags.syn==1 && tcp.flags.ack==0
# ARP 스푸핑 의심(단일 IP에 복수 MAC)

arp.opcode==2
```

### NetFlow/IPFIX(개념)

- **탐지**: 스캔(짧은 플로우 다량), DDoS(단일/소수 dst로 고EPS), C2(이상 포트/도메인).
- **활용**: 임계치 경보 + 샘플링 기반 백홀(BGP RTBH).

---

## 수학 메모: 지연·대역폭·MTU

### BDP(대역폭-지연 곱)

$$
\text{BDP} = \text{Bandwidth} \times \text{RTT}
$$
예: 1Gbps, RTT 40ms → BDP = 1e9 × 0.04 = 40e6 bit ≈ **5MB**.
→ **TCP 윈도우**가 5MB 미만이면 링크 활용이 떨어진다.

### MTU/MSS와 단편화

- 이더넷 MTU 1500 → TCP MSS ≈ 1460(IPv4) / 1440(IPv6).
- PMTUD 필요, ICMP “Fragmentation needed” 차단 시 성능 저하.

---

## OSI 7계층 모델 — 정의·PDU·TCP/IP 매핑

### 계층과 PDU

| OSI | 기능 | PDU |
|---|---|---|
| 7 응용 | 애플리케이션 프로토콜(HTTP/DNS/SMTP 등) | Data |
| 6 표현 | 인코딩/암호화(TLS의 레코드) | Data |
| 5 세션 | 세션 수립/종료(현대 TCP가 대부분 담당) | Data |
| 4 전송 | TCP/UDP(신뢰·흐름·혼잡제어) | **Segment/Datagram** |
| 3 네트워크 | IP 라우팅/논리주소 | **Packet** |
| 2 데이터링크 | 프레이밍/MAC/스위칭/VLAN | **Frame** |
| 1 물리 | 비트 전송/매체 | Bit |

**TCP/IP 매핑(요약)**: OSI 5–7 → TCP/IP 응용 / OSI 4 → TCP/UDP / OSI 3 → IP / OSI 1–2 → 링크/물리.

### 캡슐화/역캡슐화 흐름(HTTP 예)

1) App: `GET /index.html`
2) TCP: 세그먼트화, 포트 80/443
3) IP: 소스/목적 IP 지정
4) L2: 목적 MAC(게이트웨이)로 프레임
5) L1: 전송

### 계층별 주소/식별자

- L2: **MAC**
- L3: **IP**(IPv4/IPv6), TTL/Hop Limit
- L4: **Port**(TCP/UDP)
- L7: **FQDN/URI/쿠키**

---

## 계층별 취약점·로그·방어 매트릭스(핵심 암기)

| 계층 | 취약점/공격 | 탐지 로그/지표 | 방어 |
|---|---|---|---|
| L2 | ARP 스푸핑, VLAN 호핑, STP 악용 | 스위치 ARP 검증 실패, 포트 보안 위반 | DHCP Snooping+**DAI**, Port Security, BPDU/Root Guard |
| L3 | 소스 스푸핑, 라우팅 오염 | uRPF 드롭 카운터, 라우팅 인증 실패 | **uRPF**, BGP/OSPF 인증, BCP38 |
| L4 | SYN/UDP Flood | SYN-RECV 급증, conntrack 스파이크 | **SYN Cookies**, 레이트 리밋, 프록시/LB |
| L5/6 | TLS 다운그레이드/중간자 | TLS 버전/시퍼 미스매치 | TLS1.2+, HSTS, 강한 스위트, 키 관리 |
| L7 | DNS 증폭/포이즈닝, HTTP 인젝션 | DNS 응답 크기/초당 응답 수, WAF 로그 | DNSSEC/RRL, 권한 분리, **WAF**, 입력검증 |

---

## 실습: 안전한 진단·모니터링 명령(방어/가시성 중심)

> 모든 실습은 **테스트 환경**에서만 수행한다. 공격성 행위를 자동화하거나 3자 네트워크에 전송하지 않는다.

### 리눅스/유닉스

```bash
# 인터페이스·라우팅·ARP

ip -br addr; ip route
ip neigh show

# 포트/연결 상태(서버·클라이언트)

ss -lntp   # 리스닝 TCP
ss -ant state syn-recv

# 패킷 캡처(권장: root, 짧은 시간)

sudo tcpdump -nni any 'tcp[tcpflags] & (tcp-syn|tcp-ack) = tcp-syn' -c 100

# 방화벽 카운터

sudo nft list ruleset
sudo iptables -L -v -n
```

### 윈도우

```powershell
# IP/라우팅/ARP

Get-NetIPConfiguration
Get-NetRoute -AddressFamily IPv4 | sort DestinationPrefix
arp -a

# 포트/연결

Get-NetTCPConnection | Group-Object State | Select Count,Name

# 방화벽 로그 활성(드롭 기록)

netsh advfirewall set allprofiles logging droppedconnections enable

# 이벤트: 네트워크 관련

Get-WinEvent -LogName 'Microsoft-Windows-Windows Firewall With Advanced Security/Firewall' -MaxEvents 20
```

### DNS 상태 점검

```bash
# 클라이언트: 질의/응답 시간

dig +stats www.example.com
# 서버: 오픈 리졸버 확인 금지(내부 IP만 허용)

```

---

## 운영 체크리스트(요약)

- [ ] **계층별 통제**: L2(DAI/DHCP Snooping/Port Security), L3(uRPF), L4(SYN Cookies), L7(WAF/DNSSEC/RRL).
- [ ] **세그멘테이션**: 사용자/서버/관리/DMZ/백업 분리, 라우팅·ACL 최소화.
- [ ] **방화벽 정책**: Inbound 화이트리스트, Outbound 최소화(특히 서버→인터넷).
- [ ] **가시성**: 패킷(샘플), NetFlow/IPFIX, DNS/프록시/방화벽/IDS 로그 **중앙 수집**.
- [ ] **익스포저 관리**: 오픈 리졸버/관리 인터페이스 인터넷 노출 금지.
- [ ] **성능·안정성**: MTU/MSS/큐·버퍼·RTT를 기반으로 윈도우·LB·타임아웃 튜닝.
- [ ] **변경관리**: 네트워크 설정/ACL/WAF 룰 변경은 승인·로그·롤백 플랜.
- [ ] **정기 진단**: 스캔은 승인된 범위/시간/대상에서만, 보고서 증적 남김.

---

## 미니 랩(자가 점검)

### 랩 A — “SYN Flood 의심 징후 식별”

1) 서버에서 `ss -ant state syn-recv`를 10초 간격 6회 수집 → 추세 비교.
2) `tcpdump`로 SYN만 캡처 5초 → pps 계산.
3) 방화벽에서 SYN 레이트 리밋 규칙 추가 후 재관측.

```bash
for i in {1..6}; do date; ss -ant state syn-recv | wc -l; sleep 10; done
sudo tcpdump -nni eth0 'tcp[tcpflags] & tcp-syn != 0 and tcp[tcpflags] & tcp-ack = 0' -w syn.pcap -G 5 -W 1
```

### 랩 B — “ARP 보호 검증(스위치)”

1) DHCP Snooping/DAI 활성 후, 클라이언트에서 정적 ARP 삽입 시도 → 스위치 로그 확인.
2) 포트 보안 위반을 유발(두 번째 NIC) → 포트 상태/알람 확인.

---

## 예상문제(필기/실무)

1) **DAI**가 동작하려면 사전 요구사항과 검사 항목은 무엇인가?
2) **uRPF**의 Loose/Strict 모드 차이와, 비대칭 라우팅 환경에서의 주의점은?
3) **SYN Cookies**의 개념과, 커널 파라미터/백로그가 미치는 영향은?
4) **DNS 증폭/리플렉션**을 억제하기 위한 네트워크/서버 측 조치 3가지를 쓰라.
5) **OSI 7계층**을 TCP/IP 스택과 매핑하고, 각 계층 대표 보안 통제 1개씩을 제시하라.
6) **BDP**를 계산하여 10Gbps, RTT 20ms 링크에서 필요한 TCP 윈도우를 추정하라.
7) **MTU/MSS/PMTUD**의 관계를 설명하고, ICMP 차단이 애플리케이션에 미칠 수 있는 영향을 기술하라.

---

## 마무리

- **공격은 계층을 타고 올라오고**, **방어는 계층마다 끊는다**.
- L2의 DAI/Port Security, L3의 uRPF, L4의 SYN Cookies, L7의 WAF/DNS 보안이 **연동**될 때 방어력이 생긴다.
- 가시성이 없으면 방어도 없다. **패킷·플로우·이벤트**를 중앙화하고, 기준선을 만들어 **이상 탐지**를 돌려라.
- 본 문서의 명령·설정은 **참고 템플릿**이다. 실제 반영은 **파일럿→모니터링→점진 배포**로 운영 안정성을 확보한다.
