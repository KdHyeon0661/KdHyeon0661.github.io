---
layout: post
title: Linux - ν•λ“μ›¨μ–΄ μΈν„°νμ΄μ¤ μ μ–΄
date: 2024-12-06 19:20:23 +0900
category: Linux
---
# λ¦¬λ…μ¤ 35νΈ: USB, λΈ”λ£¨ν¬μ¤, μ „μ›κ΄€λ¦¬ - λ¦¬λ…μ¤ ν•λ“μ›¨μ–΄ μΈν„°νμ΄μ¤ μ μ–΄

λ¦¬λ…μ¤ μ‹μ¤ν…μ—μ„ **μ¥μΉ μ—°κ²°, μ „μ› μ΄λ²¤νΈ, ν•λ“μ›¨μ–΄ μƒνƒ**λ¥Ό μλ™ κ°μ§€ν•κ±°λ‚ μ μ–΄ν•λ ¤λ©΄ λ‹¤μκ³Ό κ°™μ€ λ„κµ¬λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤:

- `udev`: μ¥μΉ μ—°κ²° μ‹ λ™μ‘ μλ™ν™”
- `upower`: μ „μ› μ •λ³΄, λ°°ν„°λ¦¬ μƒνƒ ν™•μΈ
- `acpid`: μ „μ› λ²„νΌ, μ¬λ¦½, μ μ „ μ΄λ²¤νΈ μ²λ¦¬

---

## 1. π§© `udev` - μ¥μΉ μ΄λ²¤νΈ κ°μ§€ λ° μ μ–΄

`udev`λ” λ¦¬λ…μ¤ μ»¤λ„μ **μ¥μΉ κ΄€λ¦¬ μ‹μ¤ν…**μΌλ΅, USB/λΈ”λ£¨ν¬μ¤ λ“± μƒλ΅μ΄ μ¥μΉκ°€ μ—°κ²°λ  λ• **μλ™μΌλ΅ κ·μΉ™μ„ μ μ©ν•κ³  μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰**ν•  μ μκ² ν•©λ‹λ‹¤.

### β… μ£Όμ” κΈ°λ¥
- μ¥μΉκ°€ μ—°κ²°λκ±°λ‚ μ κ±°λ  λ• μλ™ μ²λ¦¬
- `/dev` κ²½λ΅μ μ¥μΉ μ΄λ¦„ μƒμ„±
- μ¥μΉλ³„ μ‚¬μ©μ κ¶ν• λ° μ†μ κ¶ μ„¤μ •

### β… ν™•μΈ λ…λ Ήμ–΄

```bash
udevadm info /dev/sdb
udevadm monitor --environment --udev
```

### β… κ·μΉ™ μ‘μ„± μμ‹ (`/etc/udev/rules.d/99-custom.rules`)

```bash
# νΉμ • USB μ¥μΉκ°€ μ—°κ²°λλ©΄ μ¤ν¬λ¦½νΈ μ‹¤ν–‰
ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="1a86", ATTR{idProduct}=="7523", RUN+="/usr/local/bin/on_usb_insert.sh"
```

| ν•„λ“ | μλ―Έ |
|------|------|
| `ACTION` | `add`, `remove`, `change` λ“± |
| `SUBSYSTEM` | `usb`, `block`, `net` λ“± μ»¤λ„ μ„λΈμ‹μ¤ν… |
| `ATTR` | μ¥μΉ μ†μ„±κ°’ |
| `RUN` | μ‹¤ν–‰ν•  λ…λ Ή λλ” μ¤ν¬λ¦½νΈ κ²½λ΅ |

### β… κ·μΉ™ μ μ©

```bash
sudo udevadm control --reload-rules
sudo udevadm trigger
```

---

## 2. π”‹ `upower` - μ „μ›/λ°°ν„°λ¦¬ μƒνƒ ν™•μΈ

`upower`λ” λ¦¬λ…μ¤ λ°μ¤ν¬νƒ‘ ν™κ²½μ—μ„ **μ „μ› μƒνƒ, λ°°ν„°λ¦¬ μλ…, μ¶©μ „ μƒνƒ** λ“±μ„ μ•λ ¤μ£Όλ” ν‘μ¤€ APIμ΄λ©° CLI λ„κµ¬λ„ μ κ³µλ©λ‹λ‹¤.

### β… μ„¤μΉ

```bash
# λ€λ¶€λ¶„ κΈ°λ³Έ ν¬ν•¨λ¨. μ—†μΌλ©΄:
sudo apt install upower
```

### β… μ£Όμ” λ…λ Ήμ–΄

| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `upower -e` | κ°μ§€λ μ „μ› μ¥μΉ λ©λ΅ |
| `upower -i [λ””λ°”μ΄μ¤ κ²½λ΅]` | ν•΄λ‹Ή μ¥μΉμ μ„Έλ¶€ μ •λ³΄ ν™•μΈ |
| `upower -d` | μ „μ²΄ μ „μ› μ •λ³΄ λ¤ν”„ |
| `upower --monitor` | μ‹¤μ‹κ°„ μ „μ› μƒνƒ λ³€ν™” κ°μ§€ |

### β… μμ‹

```bash
# μ¥μΉ λ©λ΅ ν™•μΈ
upower -e

# λ°°ν„°λ¦¬ μƒνƒ λ³΄κΈ° (μ: /org/freedesktop/UPower/devices/battery_BAT0)
upower -i /org/freedesktop/UPower/devices/battery_BAT0
```

μ¶λ ¥ μμ‹:
```
state:               discharging
percentage:          74%
time to empty:       1.2 hours
```

---

## 3. π” `acpid` - μ „μ› λ²„νΌ λ° μ μ „ μ΄λ²¤νΈ κ°μ§€

`acpid`λ” **μ „μ› λ²„νΌ, λ…ΈνΈλ¶ λ®κ°, μ¬λ¦½/μ μ „ μ΄λ²¤νΈ** λ“±μ„ μ²λ¦¬ν•  μ μλ” λ°λ¬μ…λ‹λ‹¤.

### β… μ„¤μΉ λ° ν™μ„±ν™”

```bash
# λ€λ¶€λ¶„ κΈ°λ³Έ μ„¤μΉλ¨. μ—†μΌλ©΄:
sudo apt install acpid
sudo systemctl enable --now acpid
```

### β… μ£Όμ” μ΄λ²¤νΈ μμ‹

- μ „μ› λ²„νΌ λλ¦Ό
- λ…ΈνΈλ¶ λκ»‘ μ—΄κΈ°/λ‹«κΈ°
- λ°°ν„°λ¦¬ κ²½κ³ 
- AC μ „μ› μ—°κ²°/ν•΄μ 

### β… μ»¤μ¤ν…€ μ¤ν¬λ¦½νΈ λ“±λ΅

κΈ°λ³Έ κ²½λ΅: `/etc/acpi/events/`

μμ‹ (`/etc/acpi/events/powerbtn`):

```ini
event=button/power
action=/etc/acpi/powerbtn.sh
```

ν•΄λ‹Ή μ¤ν¬λ¦½νΈλ” `/etc/acpi/powerbtn.sh`μ— μ‘μ„±ν•©λ‹λ‹¤:

```bash
#!/bin/bash
logger "μ „μ› λ²„νΌ λλ¦Ό: μ‹μ¤ν… μΆ…λ£"
shutdown -h now
```

μ μ© ν›„:

```bash
sudo systemctl restart acpid
```

---

## π§ μ‹¤μ „ μμ‹ λ¨μ

### π” USB μ‚½μ… μ‹ μλ™ λ°±μ—… μ‹μ‘

`udev`λ¥Ό ν™μ©ν•΄ νΉμ • USBκ°€ μ‚½μ…λλ©΄ μλ™μΌλ΅ `/mnt/usb`λ΅ λ§μ΄νΈν•κ³  `rsync`λ΅ λ°±μ—…μ„ μ‹μ‘:

```udev
# /etc/udev/rules.d/99-usb-backup.rules
ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="abcd", ATTR{idProduct}=="1234", RUN+="/usr/local/bin/backup.sh"
```

---

### π”‹ λ°°ν„°λ¦¬ μƒνƒκ°€ 20% μ΄ν•μ΄λ©΄ κ²½κ³  μ•λ¦Ό

```bash
#!/bin/bash
battery=$(upower -i $(upower -e | grep BAT) | grep percentage | awk '{print $2}' | sed 's/%//')

if [ "$battery" -lt 20 ]; then
    notify-send "λ°°ν„°λ¦¬ κ²½κ³ " "20% μ΄ν•μ…λ‹λ‹¤. μ¶©μ „ν•μ„Έμ”!"
fi
```

---

### π” μ „μ› λ²„νΌ λλ €μ„ λ• λ΅κ·Έ λ‚¨κΈ°κ³  μ¬λ¶€ν…

```bash
# /etc/acpi/events/reboot_button
event=button/power
action=/etc/acpi/power_reboot.sh
```

```bash
#!/bin/bash
logger "μ „μ› λ²„νΌ λλ¦Ό β†’ μ¬λ¶€ν…"
reboot
```

---

## β… μ”μ•½

| λ„κµ¬ | μ—­ν•  | μ¶”μ² ν™κ²½ |
|------|------|------------|
| `udev` | μ¥μΉ μλ™ μ²λ¦¬ | μ„λ²„/λ°μ¤ν¬νƒ‘ λ¨λ‘ |
| `upower` | μ „μ›/λ°°ν„°λ¦¬ μƒνƒ ν™•μΈ | λ°μ¤ν¬νƒ‘/λ…ΈνΈλ¶ |
| `acpid` | ν•λ“μ›¨μ–΄ μ΄λ²¤νΈ μ²λ¦¬ | λ…ΈνΈλ¶/μ„λ²„ μ „μ› κ΄€λ¦¬ |

---

## β¨ λ§λ¬΄λ¦¬

λ¦¬λ…μ¤ μ‹μ¤ν…μ—μ„λ” ν•λ“μ›¨μ–΄μ™€ μ†ν”„νΈμ›¨μ–΄ κ°„μ λ°μ‘μ„ μλ™ν™”ν•¨μΌλ΅μ¨,  
**μ‹μ¤ν… κ΄€λ¦¬ ν¨μ¨**μ„ ν¬κ² λ†’μΌ μ μμµλ‹λ‹¤.

- `udev`λ΅ μ¥μΉ μ΄λ²¤νΈ μλ™ν™”
- `upower`λ΅ λ°°ν„°λ¦¬ μƒνƒ μ¶”μ 
- `acpid`λ΅ μ „μ› μ΄λ²¤νΈ λ€μ‘

μ΄λ¬ν• λ„κµ¬λ“¤μ„ μ΅°ν•©ν•λ©΄ λ” κ°•λ ¥ν• **ν•λ“μ›¨μ–΄ κΈ°λ° μλ™ν™” μ‹μ¤ν…**μ„ λ§λ“¤ μ μμµλ‹λ‹¤.