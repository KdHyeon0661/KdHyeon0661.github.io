---
layout: post
title: 정보보안기사 - 디렉터리 리스팅 취약점
date: 2025-11-13 13:25:23 +0900
category: 정보보안기사
---
# SECTION 09 웹 서버 취약점 — 01. 디렉터리 리스팅(Directory Listing) 취약점

## 1. 개요 — 왜 “디렉터리 리스팅”이 위험한가
**디렉터리 리스팅(Directory Listing)** 은 웹 서버가 특정 경로(`/backup/`, `/static/`, `/uploads/` 등)에 **인덱스 파일(index.html, index.php 등)이 없을 때** 해당 디렉터리 내 파일 목록을 **브라우저로 그대로 열람**하도록 허용하는 기능이다. 개발·운영 편의를 위해 켜두는 경우가 많고, 다음과 같은 실전 위험으로 이어진다.

- **정보수집(Information Disclosure)**: 소스맵(`.map`), 백업(`.bak`, `.old`, `~`), 설정(`.env`, `web.config`), 민감 로그, DB 덤프 파일 등 노출
- **권한 오남용/수평 이동**: 업로드 디렉터리 목록화 → **웹쉘/악성 스크립트 탐지 우회** 또는 **파일명 브루트포스 없이 직접 조회**
- **체인 공격의 앵커**: 노출 파일에서 **크리덴셜/토큰**을 찾아 **관리자·CI/CD**로 확장 → RCE/데이터 유출

> **중요**: 본 문서의 공격·재현 절차는 **본인 또는 명시적 허가를 받은 환경**에서만 수행한다.

---

## 2. 공격 표면 정리(서버·프레임워크별 기본 동작)

| 스택/서버 | 취약 기본값/원인 | 비활성화/완화 핵심 |
|---|---|---|
| **Apache httpd** | `Options Indexes` 또는 `mod_autoindex` 활성 | `Options -Indexes`, `DirectoryIndex` 지정, 민감 패턴 `<FilesMatch>` 차단 |
| **Nginx** | `autoindex on;` 또는 `try_files`/`index` 누락 | `autoindex off;`, `index index.html;`/`try_files $uri =404` |
| **IIS** | “Directory Browsing” 기능 On | 기능 Off, 기본 문서(WELCOME) 지정 |
| **Tomcat/Servlet** | `default` 서블릿 list 허용 설정(버전/설정 따라 상이) | `listings="false"`, `welcome-file-list` 지정 |
| **Node.js(Express)** | `serve-index`/`express.static` 오용(숨김파일 노출) | `serve-index` 제거, `dotfiles: "deny"`, 화이트리스트 라우팅 |
| **Python(내장)** | `python -m http.server` 기본 리스트 제공 | 운영 사용 금지, 전용 서버 사용 |
| **Spring Boot** | 정적 리소스 핸들링에서 index 미배치 시 특정 상황(프록시 조합) | “index 존재 보장” + 프록시에서 디렉터리 접근 금지 |
| **Django** | runserver는 404이나 앞단 프록시 오구성 시 노출 | 운영은 Nginx/Apache에서 **강제 403/404** |

---

## 3. 재현(실습) — “취약 → 악용 → 패치” 한 번에 보기

### 3.1 Docker로 빠르게 취약 환경 띄우기 (Nginx + autoindex)
```yaml
# docker-compose.yml (연습용)
services:
  vuln-nginx:
    image: nginx:1.27-alpine
    volumes:
      - ./site:/usr/share/nginx/html:ro
      - ./nginx.vuln.conf:/etc/nginx/conf.d/default.conf:ro
    ports: [ "8080:80" ]
```

```nginx
# nginx.vuln.conf (취약: autoindex on)
server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;

  location / {
    autoindex on;            # ❌ 목록화 허용
  }
}
```

```bash
mkdir -p site/backup site/static
echo 'secret=db_password=passw0rd!' > site/backup/.env      # 민감 파일 (예시)
echo 'console.log("hello")' > site/static/app.js
```

실행:
```bash
docker compose up -d
curl -s http://127.0.0.1:8080/ | head
# → 디렉터리 파일 목록이 보임. /backup/.env 접근도 가능
```

### 3.2 간단 스캐닝(합법 환경)
```bash
# "Index of /" 또는 autoindex 시그니처 탐지
curl -s http://127.0.0.1:8080/ | grep -Ei "Index of|autoindex"
curl -s http://127.0.0.1:8080/backup/ | grep -i '\.env'
```

### 3.3 즉시 패치(안전 설정으로 교체)
```nginx
# nginx.safe.conf
server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;

  index index.html;          # ✅ 인덱스 문서 강제
  location / {
    autoindex off;           # ✅ 리스트 비활성
    try_files $uri $uri/ =404;  # ✅ 파일 없으면 404
  }

  # 민감 패턴 차단(추가 보호)
  location ~* (\.git|\.svn|\.hg|\.bak|~|\.swp|\.env|\.DS_Store) {
    deny all;                 # ✅
  }
}
```
```bash
docker cp nginx.safe.conf CONTAINER_ID:/etc/nginx/conf.d/default.conf
docker exec -it CONTAINER_ID nginx -s reload
# 다시 확인
curl -i http://127.0.0.1:8080/backup/
# → 404/403
```

---

## 4. 서버별 취약 설정과 안전 설정

### 4.1 Apache httpd

**취약 예**
```apache
<Directory "/var/www/html">
  Options Indexes FollowSymLinks   # ❌ Indexes 허용
  AllowOverride All
  Require all granted
</Directory>
```

**안전 예**
```apache
<Directory "/var/www/html">
  Options -Indexes +FollowSymLinks  # ✅ 목록 금지
  DirectoryIndex index.html         # ✅ 인덱스 문서
  Require all granted
</Directory>

# 민감 파일 차단
<FilesMatch "^(\.git|\.svn|\.hg|\.env|.*\.(bak|old|swp))$">
  Require all denied
</FilesMatch>
```

**.htaccess(운영에서는 가급적 서버 설정 선호)**
```apache
Options -Indexes
DirectoryIndex index.html
<FilesMatch "^(\.env|.*\.(bak|log|sql))$">
  Require all denied
</FilesMatch>
```

### 4.2 Nginx

**취약 예**
```nginx
location / {
  autoindex on;    # ❌
}
```

**안전 예**
```nginx
location / {
  autoindex off;            # ✅
  index index.html;
  try_files $uri $uri/ =404;
}
location ~* (\.git|\.env|\.bak|\.swp|~)$ { deny all; }
```

### 4.3 IIS

**Directory Browsing 기능 Off**
- `IIS Manager` → 사이트 선택 → **Directory Browsing** → **Disable**
- **Default Document**(index.html 등) 활성화

**`web.config` 일부 예**
```xml
<configuration>
  <system.webServer>
    <directoryBrowse enabled="false" /> <!-- ✅ -->
    <defaultDocument>
      <files>
        <add value="index.html" />
      </files>
    </defaultDocument>
  </system.webServer>
</configuration>
```

### 4.4 Tomcat/Servlet

**안전 설정 (web.xml)**
```xml
<servlet>
  <servlet-name>default</servlet-name>
  <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
  <init-param>
    <param-name>listings</param-name>
    <param-value>false</param-value> <!-- ✅ 목록 금지 -->
  </init-param>
  <load-on-startup>1</load-on-startup>
</servlet>

<welcome-file-list>
  <welcome-file>index.html</welcome-file>  <!-- ✅ -->
</welcome-file-list>
```

### 4.5 Node.js (Express)

**취약(학습용)**
```js
import express from 'express';
import serveIndex from 'serve-index';
const app = express();
app.use('/public', express.static('public'), serveIndex('public')); // ❌
app.listen(3000);
```

**안전**
```js
import express from 'express';
const app = express();

// 정적 파일 서빙: 숨김 파일 금지
app.use('/public', express.static('public', {
  dotfiles: 'deny',          // ✅ .env, .git 등
  index: ['index.html']      // ✅ 인덱스 강제
}));

// 디렉터리 직접 접근 시 404
app.use('/public/*/', (_req, res) => res.sendStatus(404));

// 민감 패턴 차단(방어선 추가)
app.get(/^.*(\.env|\.git|\.bak|~|\.swp)$/i, (_req, res) => res.sendStatus(403));

app.listen(3000);
```

### 4.6 Python 내장 서버(개발용) 주의
```bash
python -m http.server 8000
# → 기본적으로 디렉터리 목록 노출 (운영 금지)
```

---

## 5. 악용(공격) 시나리오와 연결 고리

### 5.1 인덱스 없는 업로드 폴더
- `/uploads/` 열람 → **사용자 업로드 파일명/토큰** 파악 → 파일 직링크로 **접근통제 우회**
- 서버사이드 검증이 약하면 **스크립트 업로드·실행 경로 확인**으로 이어짐

### 5.2 소스맵(`.map`)과 빌드 아티팩트
- React/Vue 빌드 산출 시 `.map` 노출 → **원본 JS/주석/숨은 API 경로** 파악 → GraphQL/어드민 엔드포인트 노출

### 5.3 백업/임시 파일
- `config.php.bak`, `db.sql`, `~`, `.swp` → **크리덴셜/스키마** 유출 → DB 직접 접근/ORM 쿼리 구조 파악

### 5.4 리포지터리/메타
- `/.git/` 디렉터리 목록화 → `.git/HEAD`, `objects/` 통해 **소스코드 재구성**(툴 존재) → 키/토큰 유출

### 5.5 로그/덤프
- `error.log`, `access.log`, `heapdump.hprof` 등은 **세션/토큰/요청 내용** 노출 → 세션 하이재킹/재현 가능한 PoC 획득

> **실전 교훈**: 디렉터리 리스팅 그 자체의 CVSS가 낮아 보일 수 있으나, **연쇄(Chaining)** 로 취약점의 기대 피해가 기하급수적으로 상승한다.

---

## 6. 탐지·검증 절차(수동/자동/로그 관점)

### 6.1 수동 확인
```bash
curl -s -I https://target/dir/ | egrep -i 'server|nginx|apache'
curl -s https://target/dir/ | head -n 20    # "Index of /dir", "Parent Directory" 등
```

### 6.2 반자동 크롤러(허가 환경)
```bash
# 간단 키워드 기반 검사
for p in / /img/ /static/ /uploads/ /backup/ /.git/; do
  r=$(curl -s "https://target$p")
  echo "$p $(echo "$r" | egrep -ci 'Index of|Parent Directory|autoindex')"
done
```

### 6.3 사전 정의 민감 패턴
- 파일: `(\.git|\.env|\.bak|~|\.swp|\.old|\.sql|\.log|\.map)$`
- 디렉터리: `/backup/`, `/uploads/`, `/private/`, `/admin/`, `/config/`

### 6.4 로그 관점(운영)
- **단시간에 디렉터리 슬래시로 끝나는 요청 급증**, `/.git/` 접근, `.map`/`.env` 조회
- `200`(성공)로 응답된 디렉터리 경로 존재 여부 점검

샘플(Nginx):
```
192.0.2.10 - - [11/Nov/2025:02:00:01 +0900] "GET /backup/ HTTP/1.1" 200 ...
192.0.2.10 - - [11/Nov/2025:02:00:02 +0900] "GET /.git/ HTTP/1.1" 200 ...
```

---

## 7. 안전 설계·설정(정리)

### 7.1 공통 원칙
1. **목록 비활성**: Apache `-Indexes`, Nginx `autoindex off`, IIS Directory Browsing Off
2. **인덱스 파일 강제**: `index.html`/`index.php`
3. **존재하지 않는 경로는 404**: `try_files $uri $uri/ =404`
4. **민감 패턴 일괄 차단**: Git/Env/Backup/Temp/Log/DB 덤프/소스맵
5. **업로드 디렉터리 분리**: 실행 금지(예: PHP `php_admin_value engine off`, Nginx `types {}`), 다운로드만 허용
6. **빌드 파이프라인에서 제거**: 소스맵/백업/숨김파일 **배포 제외**
7. **CDN/오브젝트 스토리지**: 목록화(리스트) 자체를 막고 **서명 URL** 사용

### 7.2 업로드 디렉터리 실행 금지 예

**Apache (PHP)**
```apache
<Directory "/var/www/html/uploads">
  php_admin_value engine Off      # ✅ 스크립트 실행 금지
  Options -ExecCGI -Indexes
  AllowOverride None
</Directory>
```

**Nginx (정적만)**
```nginx
location /uploads/ {
  default_type application/octet-stream;
  add_header Content-Disposition "attachment";
  autoindex off;
  try_files $uri =404;
}
```

---

## 8. 테스트 자동화(파이프라인 품질 게이트)

### 8.1 간단 E2E(Playwright/Puppeteer 예시)
```js
import { test, expect } from '@playwright/test';

const suspects = ['/', '/static/', '/uploads/', '/backup/', '/.git/'];

test('디렉터리 목록 금지', async ({ page }) => {
  for (const p of suspects) {
    const res = await page.request.get(process.env.BASE_URL + p);
    const body = await res.text();
    expect(body).not.toMatch(/Index of|Parent Directory|autoindex/i);
    expect(res.status()).not.toBe(200); // 인덱스 없는 디렉터리는 404/403 기대
  }
});
```

### 8.2 Nginx 설정 유닛 테스트(Testcontainers 예시, 개념)
- 컨테이너 띄워 `GET /backup/` → **403/404** 이어야 통과
- `/uploads/aaa.php` 업로드 후 `text/plain` 응답인지 확인(**실행 금지**)

---

## 9. 운영 가이드(발견→완화→재발 방지)

### 9.1 발견 시 즉시 조치
1) **프록시/웹서버 레벨에서 임시 차단**: `autoindex off`, `deny all`
2) **민감 파일 긴급 점검**: 접근 로그 기준 노출 파일 식별
3) **비밀 교체**: `.env`/키/토큰 노출 시 즉시 회수·교체
4) **영향 범위 보고**: 노출 데이터 범주·기간·접근 IP 요약

### 9.2 재발 방지
- **서버 표준 템플릿화**(hardening conf)
- **CI 배포 전 파일 목록 정적 분석**: `.map`, `.git`, `.env` 미포함 확인
- **취약점 스캔**(DAST)와 **로그 룰**(디렉터리로 끝나는 200 응답) 상시화

---

## 10. 체크리스트(실무/시험 대비)

- [ ] Apache `Options -Indexes` / Nginx `autoindex off;` / IIS Directory Browsing Off
- [ ] `DirectoryIndex` 또는 `index` 지정, `try_files`로 404 처리
- [ ] `(\.git|\.env|\.bak|\.old|\.swp|~|\.log|\.sql|\.map)$` **차단 룰** 적용
- [ ] **업로드 경로 실행 금지** + `Content-Disposition: attachment`
- [ ] 빌드 파이프라인에서 `.map`/백업/숨김 파일 **배포 제외**
- [ ] CDN/스토리지 **리스트 차단** + **서명 URL** 정책
- [ ] 로그 모니터링: 슬래시로 끝나는 경로 200 응답, `/.git/` 접근 탐지
- [ ] 정기 점검: DAST/리그레션 테스트로 “Index of /” 키워드 탐지

---

## 11. 실기형 예상문제(서술·설정 수정형)

**문1)** 다음 Nginx 설정의 문제점을 지적하고 수정하라.
```nginx
location / {
  autoindex on;
}
```
**모범답안 요지**: 디렉터리 목록 노출 위험.
**수정**:
```nginx
location / {
  autoindex off;
  index index.html;
  try_files $uri $uri/ =404;
}
```

**문2)** Apache에서 디렉터리 리스팅을 전역 차단하는 지시어는?
**답**: `Options -Indexes`

**문3)** 업로드 디렉터리에서 PHP 실행을 막는 Apache 설정 한 줄?
**답**: `php_admin_value engine Off` (해당 `<Directory>` 블록 내)

**문4)** 배포 산출물에 `.map` 파일이 포함되었을 때의 위험과 대응은?
**답**: 원본 소스·주석·민감 경로 노출 → **배포 제외** 또는 내부 전용 시스템으로만 접근 허용.

**문5)** 디렉터리 리스팅과 **연쇄 공격**의 관계를 한 문장으로 설명하라.
**답**: 리스트 노출은 **민감 파일 탐색 비용을 0에 수렴**시켜, 인증우회·RCE 등 더 큰 취약점으로 이어지는 **공격 그래프의 초기 노드**가 된다.

---

## 12. 위험 기대값(간단 모델)
디렉터리 리스팅으로 인한 월간 기대 손실 \(E[L]\)을 단순 근사하면:
$$
E[L] \approx P(\text{Listing}) \cdot \sum_{f \in \mathcal{F}} P(f \ \text{exposed}) \cdot I(f)
$$
- \(\mathcal{F}\): 노출 가능한 파일 집합(예: `.env`, `db.sql`, `.map`, 로그)
- 제어 목표: **\(P(\text{Listing}) \downarrow\)**(서버 설정), **\(P(f \ \text{exposed}) \downarrow\)**(빌드·배포 제외), **\(I(f) \downarrow\)**(암호화·단기 키·권한 최소화)

---

## 13. 부록 — 민감 파일/디렉터리 패턴 모음(화이트리스트 차단에 활용)

```
# 디렉터리
^/(\.git|\.svn|\.hg|backup|private|config|admin|WEB-INF)/

# 파일 패턴 (대소문자 무시)
(\.env|\.bak|\.old|\.swp|~|\.log|\.sql|\.db|\.sqlite|\.gz|\.zip|\.7z|\.rar|\.map|\.DS_Store)$
```

**Nginx 예시**
```nginx
location ~* (\.git|\.svn|\.hg|\.env|\.bak|\.old|\.swp|~|\.log|\.sql|\.db|\.sqlite|\.map|\.DS_Store)$ {
  deny all;
}
```

---

## 14. 요약
- 디렉터리 리스팅은 단순해 보여도 **공격 체인의 핵심 연결고리**다.
- 서버 레벨에서 **목록 비활성 + 인덱스 강제 + 404 처리 + 민감 패턴 차단**을 기본값으로 고정하라.
- 빌드/배포 파이프라인에서 **소스맵·백업·숨김 파일 제외**를 자동화하고, **로그 룰**과 **E2E 테스트**로 지속 검증하라.
- “보안은 기본값에서 결정된다” — **기본 템플릿**을 안전하게 만들면, 동일 문제가 재발하지 않는다.
