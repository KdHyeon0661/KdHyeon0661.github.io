---
layout: post
title: TCPIP - TCP
date: 2025-09-04 16:25:23 +0900
category: TCPIP
---
# TCP/IP 전송 제어 프로토콜 (TCP)

TCP는 인터넷의 신뢰성 있는 데이터 전송을 담당하는 핵심 프로토콜로, 연결 지향적이고 신뢰성 있는 바이트 스트림 서비스를 제공합니다. 이는 웹 브라우징, 이메일, 파일 전송 등 대부분의 인터넷 응용 프로그램이 의존하는 기반입니다.

## TCP 개요, 기능 및 특성

### TCP 역사와 표준 발전

TCP의 역사는 인터넷 자체의 역사와 깊이 연결되어 있습니다:

**진화 과정:**
- **1974년**: 빈트 서프(Vint Cerf)와 밥 칸(Bob Kahn)이 TCP 초기 개념 제안
- **1981년**: RFC 793으로 TCP 공식 표준화
- **1980년대 후반**: TCP/IP 스위트의 분리 (TCP와 IP가 별도 프로토콜로)
- **1990년대**: 다양한 확장 도입 (타임스탬프, 선택적 ACK, 윈도우 스케일링 등)
- **2000년대 이후**: 고속 네트워크 환경에 맞춘 알고리즘 개선 (CUBIC, BBR 등)

**표준 문서:**
- **기본 표준**: RFC 793 (1981년)
- **중요 확장**: 
  - RFC 1323: 고성능 확장 (타임스탬프, 윈도우 스케일링)
  - RFC 2018: 선택적 확인응답 (SACK)
  - RFC 2581: 혼잡 제어 알고리즘
  - RFC 5681: TCP 혼잡 제어

### TCP의 핵심 기능

TCP는 다음과 같은 4가지 주요 기능을 제공합니다:

1. **연결 지향 통신**
   - 가상 회선(virtual circuit) 개념
   - 3-way 핸드셰이크를 통한 연결 수립
   - 4-way 핸드셰이크를 통한 정상적 연결 종료

2. **신뢰성 있는 데이터 전달**
   - 순서 번호(Sequence Number)를 통한 데이터 순서 보장
   - 확인응답(Acknowledgment) 시스템
   - 타임아웃과 재전송 메커니즘
   - 체크섬을 통한 데이터 무결성 검증

3. **흐름 제어(Flow Control)**
   - 슬라이딩 윈도우 메커니즘
   - 수신자의 처리 능력에 맞춘 데이터 전송 속도 조절
   - 수신 윈도우 크기 통보

4. **혼잡 제어(Congestion Control)**
   - 네트워크 혼잡 상황 감지 및 대응
   - 혼잡 윈도우(CWND) 조절 알고리즘
   - 느린 시작(Slow Start), 혼잡 회피(Congestion Avoidance), 빠른 재전송(Fast Retransmit) 등

### TCP의 설계 특성

**기본 특성:**
- **전이중 통신**: 동시에 양방향 데이터 전송 가능
- **바이트 스트림 서비스**: 메시지 경계가 없는 연속된 바이트 흐름
- **버퍼링**: 송신 및 수신 버퍼를 통한 비동기 처리
- **포트 시스템**: 다중 응용 프로그램 지원 (16비트 포트 번호)

**신뢰성 보장 메커니즘:**
- **확인응답과 재전송**: 긍정 확인응답, 부정 확인응답, 선택적 확인응답
- **자동 재전송 요청**: RTO(Retransmission Timeout) 기반 자동 재전송
- **중복 데이터 검출**: 순서 번호를 통한 중복 세그먼트 식별

## TCP 기본 원리와 일반 동작

### TCP 데이터 처리: 스트림, 세그먼트 및 순서 번호

**바이트 스트림 모델:**
```
응용 프로그램 → TCP 송신 버퍼 → 세그먼트 분할 → 네트워크 전송
네트워크 수신 → 세그먼트 재조립 → TCP 수신 버퍼 → 응용 프로그램
```

**세그먼트 구조:**
TCP는 연속된 바이트 스트림을 **세그먼트**라는 단위로 분할하여 전송합니다. 각 세그먼트는 다음과 같은 정보를 포함합니다:

```
TCP 세그먼트 헤더 (20-60바이트) + 데이터 (0-1460바이트 일반적)
```

**순서 번호 시스템:**
TCP는 각 바이트에 고유한 순서 번호를 할당합니다:
- **초기 순서 번호(ISN)**: 무작위 값으로 시작 (보안 및 연결 구분)
- **순서 번호 증가**: 전송한 데이터 바이트 수만큼 증가
- **확인응답 번호**: 다음에 기대하는 순서 번호 표시

**실제 예시:**
```
송신자                            수신자
ISN = 1000
데이터 500바이트 전송
순서 번호: 1000-1499
                               확인응답 번호: 1500
                               (다음에 1500번 바이트 기대)
```

### TCP 슬라이딩 윈도우 확인응답 시스템

슬라이딩 윈도우는 흐름 제어와 신뢰성 전달을 동시에 처리하는 핵심 메커니즘입니다.

**기본 개념:**
```
송신 윈도우 구조:
[이미 확인응답 받은 데이터] [전송 중인 데이터] [전송 가능한 데이터]
        |               |               |
      윈도우 시작     현재 순서 번호   윈도우 끝
```

**동작 예시:**
```
윈도우 크기 = 4000바이트
송신자가 1000바이트씩 4개 세그먼트 전송:
[1000-1999][2000-2999][3000-3999][4000-4999]

수신자가 2000 확인응답:
윈도우가 2000-5999로 슬라이딩
새로운 5000-5999 데이터 전송 가능
```

**확인응답 유형:**
1. **누적 확인응답**: 특정 순서 번호까지 모든 데이터 수신 확인
2. **선택적 확인응답(SACK)**: 특정 데이터 블록 수신 확인 (RFC 2018)
3. **지연 확인응답**: 여러 확인응답을 하나로 결합 (일반적으로 200ms 이내)

**흐름 제어 메커니즘:**
- **수신 윈도우(rwnd)**: 수신자의 버퍼 공간에 기반한 윈도우 크기
- **혼잡 윈도우(cwnd)**: 네트워크 혼잡 상태에 기반한 윈도우 크기
- **실제 윈도우**: min(rwnd, cwnd)

### TCP 포트, 연결 및 연결 식별

**포트 시스템:**
- **16비트 숫자**: 0-65535 범위
- **분류**:
  - 0-1023: 잘 알려진 포트 (시스템 서비스)
  - 1024-49151: 등록된 포트 (응용 프로그램)
  - 49152-65535: 동적/사설 포트 (클라이언트 임시 사용)

**TCP 연결 식별:**
TCP 연결은 4가지 요소로 고유하게 식별됩니다:
```
1. 송신자 IP 주소
2. 송신자 포트 번호
3. 수신자 IP 주소
4. 수신자 포트 번호
```

이 4개의 조합을 **소켓 쌍(socket pair)** 이라고 하며, 운영체제는 이를 통해 다중 연결을 관리합니다.

**연결 수립 (3-way 핸드셰이크):**
```
클라이언트(C)                  서버(S)
      | ---- SYN (seq=x) ----> |
      |                        | (수신 대기 상태에서 SYN 수신)
      | <-- SYN+ACK (seq=y, ack=x+1) -- |
      | ---- ACK (seq=x+1, ack=y+1) --> |
      |                        | (연결 수립 완료)
```

**연결 종료 (4-way 핸드셰이크):**
```
참고: 양방향 독립적 종료
C ---- FIN (seq=u) ----> S
C <-- ACK (ack=u+1) ---- S
C <-- FIN (seq=v) ------ S
C ---- ACK (ack=v+1) --> S
```

### TCP 상태 전이

TCP 연결은 다양한 상태를 거치며 진행됩니다:

**연결 수립 시:**
```
CLOSED → SYN_SENT → ESTABLISHED
LISTEN → SYN_RCVD → ESTABLISHED
```

**연결 종료 시 (액티브 종료):**
```
ESTABLISHED → FIN_WAIT_1 → FIN_WAIT_2 → TIME_WAIT → CLOSED
```

**연결 종료 시 (패시브 종료):**
```
ESTABLISHED → CLOSE_WAIT → LAST_ACK → CLOSED
```

**TIME_WAIT 상태의 중요성:**
- **지속 시간**: 2MSL (Maximum Segment Lifetime), 일반적으로 60초
- **목적**:
  1. 지연된 세그먼트가 새 연결에 영향을 주지 않도록 보장
  2. 마지막 ACK 손실 시 재전송 대비
- **문제점**: 서버 과부하 시 많은 TIME_WAIT 연결로 인한 자원 소모

## TCP 일반 응용 프로그램과 서버 포트 할당

### 주요 TCP 기반 응용 프로토콜

**웹 서비스:**
- **HTTP**: 포트 80
- **HTTPS**: 포트 443
- **작동 방식**: 요청-응답 모델, 지속 연결, 파이프라이닝

**이메일:**
- **SMTP**: 포트 25 (전송), 587 (제출)
- **작동 특성**: 텍스트 기반 명령, 큐 관리, 재시도 메커니즘

**파일 전송:**
- **FTP**: 포트 21 (제어), 20 (데이터)
- **특징**: 별도 데이터 연결, ACTIVE/PASSIVE 모드

**원격 접속:**
- **SSH**: 포트 22
- **특징**: 암호화, 포트 포워딩, X11 포워딩

**데이터베이스:**
- **MySQL**: 포트 3306
- **PostgreSQL**: 포트 5432
- **특성**: 연결 풀링, 트랜잭션 관리

### 서버 포트 할당 원칙

**잘 알려진 포트 할당 프로세스:**
1. **IANA 관리**: 인터넷 할당 번호 관리기관이 공식 할당
2. **RFC 문서화**: 대부분의 표준 포트는 RFC 문서에 정의
3. **시스템 등록**: /etc/services 파일 또는 윈도우 레지스트리에 등록

**포트 충돌 방지:**
- **표준 준수**: 잘 알려진 포트는 표준 서비스에만 사용
- **동적 포트**: 클라이언트는 49152-65535 범위 사용
- **포트 스캐닝 방지**: 불필요한 포트 노출 최소화

### TCP 성능 최적화 기법

**지연 확인응답:**
- 목적: 네트워크 트래픽 감소
- 구현: 최대 500ms 지연, 응용 데이터가 있으면 함께 전송

**Nagle 알고리즘:**
- 목적: 작은 패킷 통합으로 네트워크 효율 향상
- 작동: 확인응답 받기 전까지 작은 데이터 모아서 전송
- 문제점: 대화형 응용 프로그램에서 지연 발생 가능

**TCP Fast Open (TFO):**
- 목적: 3-way 핸드셰이크 중 데이터 전송으로 지연 감소
- 요구사항: 클라이언트와 서버 모두 지원 필요
- 보안: 암호화된 쿠키 사용

---

## 결론

TCP는 인터넷 아키텍처의 중심에 위치한 프로토콜로서, 단순한 데이터 전송을 넘어 **신뢰성, 효율성, 공정성**이라는 상충되는 목표들 사이에서 현명한 균형을 찾은 공학적 걸작입니다. 40년이 넘는 발전 역사 동안, 그 기본 설계 철학은 변함없이 유지되면서도, 고속 네트워크와 무선 환경, 보안 위협 등 새로운 도전에 지속적으로 적응해 왔습니다.

TCP의 가장 뛰어난 특징은 **종합적 문제 해결 접근법**에 있습니다. 슬라이딩 윈도우 메커니즘은 흐름 제어와 신뢰성 전달이라는 두 가지 문제를 하나의 우아한 솔루션으로 통합했으며, 혼잡 제어 알고리즘은 개별 연결의 이기심과 전체 네트워크의 공공선 사이에서 공정한 균형을 찾습니다. 이러한 설계는 분산 시스템의 전형적인 딜레마를 해결하는 데 있어 지속적으로 참고되는 모범 사례입니다.

3-way 핸드셰이크와 4-way 핸드셰이크는 신뢰성 있는 연결 수립과 정상적 종료를 보장하는 동시에, 네트워크의 비동기적 특성과 패킷 손실 가능성을 정교하게 처리합니다. 특히 TIME_WAIT 상태의 설계는 단순함 속에 깊은 통찰이 담긴 예시로, 잠재적인 문제를 사전에 방지하기 위한 예방적 메커니즘을 구현합니다.

오늘날 TCP는 여전히 진화하고 있습니다. QUIC 프로토콜의 등장과 HTTP/3로의 전환은 TCP의 근본적 한계를 넘어서려는 시도이지만, 이러한 새로운 기술들조차 TCP가 정립한 기본 개념들(신뢰성 있는 전달, 흐름 제어, 혼잡 제어)을 재해석하고 재구성하는 형태를 취하고 있습니다. 이는 TCP의 설계 원칙이 얼마나 근본적이고 지속적인 가치를 지니는지를 증명합니다.

네트워크 성능 문제 해결, 분산 시스템 설계, 클라우드 네이티브 아키텍처 구현 등 다양한 분야에서 TCP에 대한 깊은 이해는 필수적입니다. 단순한 프로토콜 스펙을 넘어, TCP가 제시하는 시스템 설계 철학과 트레이드오프의 미학을 이해하는 것은 현대 소프트웨어 엔지니어에게 귀중한 통찰력을 제공할 것입니다.