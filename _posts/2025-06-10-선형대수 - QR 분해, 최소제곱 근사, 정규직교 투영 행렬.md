---
layout: post
title: 선형대수 - QR 분해, 최소제곱 근사, 정규직교 투영 행렬
date: 2025-06-10 19:20:23 +0900
category: 선형대수
---
# 📊 QR 분해, 최소제곱 근사, 정규직교 투영 행렬

선형 시스템이나 데이터 해석에서 중요한 도구인 **QR 분해**,  
이를 기반으로 한 **최소제곱 근사**,  
그리고 **정규직교 투영 행렬**에 대해 자세히 다뤄보겠습니다.

---

## 📐 1. QR 분해 (QR Decomposition)

### ✅ 정의

임의의 실수 행렬 \( A \in \mathbb{R}^{m \times n} \)에 대해  
다음과 같이 분해할 수 있다면 이를 **QR 분해**라고 합니다:

\[
\boxed{
A = QR
}
\]

- \( Q \in \mathbb{R}^{m \times n} \): 열벡터들이 **정규 직교**인 행렬
- \( R \in \mathbb{R}^{n \times n} \): **상삼각 행렬 (upper triangular)**

> 직관적으로 보면, A의 열벡터들을 정규 직교화하고,  
> 그 계수를 R에 담아 표현하는 과정입니다.

---

### 📌 특징

- \( Q^T Q = I \): Q는 열벡터가 정규직교인 행렬
- A의 열공간 = Q의 열공간
- 계산 안정성이 높아 수치해석에서 자주 사용됨

---

### 🧠 QR 분해 방법: Gram-Schmidt 사용

\[
\text{주어진 } A = [\vec{v}_1, \vec{v}_2, \ldots, \vec{v}_n] \\
\Rightarrow \text{정규 직교화: } Q = [\vec{u}_1, \vec{u}_2, \ldots, \vec{u}_n] \\
\text{각 열: } \vec{v}_i = \sum_{j=1}^{i} r_{ji} \vec{u}_j
\]

이때  
\[
R = Q^T A
\]

---

## 📉 2. 최소제곱 근사 (Least Squares Approximation)

### 🎯 문제

방정식 \( A\vec{x} = \vec{b} \)에서 해가 **존재하지 않을 때**,  
즉 \( \vec{b} \)가 A의 열공간에 없을 때,  
**가장 근사적인 해** \( \vec{x} \)를 구하고자 합니다.

---

### 📐 목표

\[
\boxed{
\min_{\vec{x}} \|A\vec{x} - \vec{b}\|^2
}
\]

- \( A\vec{x} \): 열공간 내 벡터
- \( \vec{b} \): 일반 벡터
- 차이(오차)를 최소화하는 \( \vec{x} \)를 찾는 것이 목적

---

### 📌 해 공식 (정규방정식)

\[
\boxed{
A^T A \vec{x} = A^T \vec{b}
}
\]

→ 이 선형 시스템을 풀면 최소제곱 해를 얻을 수 있습니다.

---

### 💡 QR 분해를 활용한 해법

\[
\text{만약 } A = QR \text{ 라면,} \\
A^T A = R^T Q^T Q R = R^T R \\
A^T \vec{b} = R^T Q^T \vec{b}
\Rightarrow
R \vec{x} = Q^T \vec{b}
\]

→ \( R \vec{x} = Q^T \vec{b} \)를 푸는 것이 더 안정적!

---

## 🎯 3. 정규직교 투영 행렬 (Orthogonal Projection Matrix)

### ✅ 정의

벡터 \( \vec{b} \in \mathbb{R}^m \)를 A의 열공간에 투영한 벡터 \( \vec{p} \)는 다음과 같이 계산됩니다:

\[
\boxed{
\vec{p} = P \vec{b}, \quad \text{where } P = A(A^T A)^{-1} A^T
}
\]

여기서 \( P \in \mathbb{R}^{m \times m} \)은 **정사영 행렬**입니다.

---

### 📌 성질

- \( P^2 = P \) (멱등 행렬)
- \( P^T = P \) (대칭 행렬)
- \( P \vec{b} \): \( \vec{b} \)를 A의 열공간으로 정사영한 벡터
- 오차 벡터 \( \vec{e} = \vec{b} - P\vec{b} \)는 열공간에 수직

---

### 🔁 QR 분해와 연결

A = QR 이면,  
\[
P = Q Q^T
\]

→ 훨씬 간단하게 투영 행렬을 계산할 수 있음!

---

## 🧮 Python 예제 (NumPy)

```python
import numpy as np

# A: 3x2 행렬, b: 3차원 벡터
A = np.array([[1, 1], [0, 1], [1, 0]])
b = np.array([2, 1, 3])

# QR 분해
Q, R = np.linalg.qr(A)

# 최소제곱 해
x_ls = np.linalg.solve(R, Q.T @ b)

# 정사영 벡터
p = A @ x_ls

print("최소제곱 해:", x_ls)
print("정사영 벡터:", p)
```

---

## ✅ 요약

| 항목 | 정의 | 수식 |
|------|------|------|
| QR 분해 | A를 정규직교 행렬과 상삼각 행렬로 분해 | \( A = QR \) |
| 최소제곱 근사 | \( A\vec{x} = \vec{b} \)의 오차 최소화 해 | \( A^T A \vec{x} = A^T \vec{b} \) |
| 정사영 행렬 | \( \vec{b} \)를 A의 열공간으로 투영 | \( P = A(A^T A)^{-1}A^T \) |
| QR 활용 | \( R \vec{x} = Q^T \vec{b} \)로 빠르게 해 구함 |  |