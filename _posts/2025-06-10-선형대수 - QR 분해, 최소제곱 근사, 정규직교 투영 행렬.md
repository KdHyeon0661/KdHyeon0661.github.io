---
layout: post
title: ì„ í˜•ëŒ€ìˆ˜ - QR ë¶„í•´, ìµœì†Œì œê³± ê·¼ì‚¬, ì •ê·œì§êµ íˆ¬ì˜ í–‰ë ¬
date: 2025-06-10 19:20:23 +0900
category: ì„ í˜•ëŒ€ìˆ˜
---
# ğŸ“Š QR ë¶„í•´, ìµœì†Œì œê³± ê·¼ì‚¬, ì •ê·œì§êµ íˆ¬ì˜ í–‰ë ¬

> **ìš”ì•½ (TL;DR)**  
> - **QR ë¶„í•´**: \(A=QR\) (ì—´ ì§êµ \(Q\), ìƒì‚¼ê° \(R\))ë¡œ ë¶„í•´í•˜ë©´ **ìˆ˜ì¹˜ì ìœ¼ë¡œ ì•ˆì •**í•˜ê²Œ ì„ í˜•ë¬¸ì œë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.  
> - **ìµœì†Œì œê³±(LS)**: \(\min_x\|Ax-b\|_2\)ëŠ” **ì •ê·œë°©ì •ì‹** \(A^\top A x=A^\top b\)ë¡œ í’€ ìˆ˜ ìˆì§€ë§Œ, ë³´í†µ **QR**ë¡œ \(Rx=Q^\top b\)ë¥¼ í‘¸ëŠ” ê²ƒì´ í›¨ì”¬ ì•ˆì •ì ì´ë‹¤.  
> - **ì •ê·œì§êµ íˆ¬ì˜í–‰ë ¬**: \(P=A(A^\top A)^{-1}A^\top\) (full column rank)ì´ë©°, QRì´ë©´ \(P=QQ^\top\). \(P\)ëŠ” **ëŒ€ì¹­Â·ë©±ë“±**ì´ê³ , ì”ì°¨ \(r=b-Pb\)ëŠ” **ì—´ê³µê°„ì— ì§êµ**í•œë‹¤.

---

## 1) í‘œê¸°ì™€ ì „ì œ

- \(A\in\mathbb{R}^{m\times n}\) (ë³´í†µ \(m\ge n\)), ì—´ë²¡í„°ê°€ íŠ¹ì§•ëŸ‰, í–‰ì´ í‘œë³¸ì¸ **ë°ì´í„° í–‰ë ¬**ë¡œ ìƒê°í•´ë„ ëœë‹¤.  
- **Reduced(=economy) QR**: \(A=Q R\), \(Q\in\mathbb{R}^{m\times n}\) (ì—´ ì§êµ), \(R\in\mathbb{R}^{n\times n}\) (ìƒì‚¼ê°).  
- **Full QR**: \(A=\tilde Q \tilde R\), \(\tilde Q\in\mathbb{R}^{m\times m}\) ì§êµ, \(\tilde R=\begin{bmatrix}R\\0\end{bmatrix}\).  
- **Full column rank**(ì—´ë…ë¦½, \(\operatorname{rank}(A)=n\))ì´ë©´ \(R\)ì€ **ëŒ€ê° ì›ì†Œ ëª¨ë‘ \(\neq 0\)** ì´ê³  ë³´í†µ \(r_{ii}>0\)ë¡œ ë§ì¶˜ë‹¤(ë¶€í˜¸ í†µì¼).

---

## 2) QR ë¶„í•´ (QR Decomposition)

### 2.1 ì •ì˜ì™€ ì„±ì§ˆ
\[
\boxed{A=QR}
\]
- \(Q^\top Q=I_n\) (ì—´ ì§êµ), \(R\) ìƒì‚¼ê°.  
- \(\operatorname{col}(A)=\operatorname{col}(Q)\).  
- **ìœ ì¼ì„±(ëŒ€ê° ì–‘ìˆ˜)**: full column rankë¼ë©´ ëŒ€ê°ë¶€í˜¸ë¥¼ ê³ ì •í•˜ë©´ \(Q,R\)ê°€ ìœ ì¼.

### 2.2 ê³„ì‚°ë²• ê°œìš”
- **(ìˆ˜ì •í˜•) Gramâ€“Schmidt**: ë¹ ë¥´ê³  ê°œë…ì . í´ë˜ì‹ GSëŠ” ìˆ˜ì¹˜ë¶ˆì•ˆì • â†’ **MGS** ê¶Œì¥.  
- **Householder ë°˜ì‚¬**: ì‹¤ë¬´ í‘œì¤€. ì•ˆì •ì ì´ë©° Dense í–‰ë ¬ì— ì í•©.  
- **Givens íšŒì „**: í•œ ë²ˆì— ë‘ ì„±ë¶„ë§Œ ì†Œê±° â†’ **í¬ì†Œ/ì˜¨ë¼ì¸**ì— ì í•©.

### 2.3 ì—´ í”¼ë²— QR (Rank-Revealing)
ë­í¬ ë¶ˆí™•ì‹¤/íŠ¹ì§•ëŸ‰ ìƒê´€ì´ í° ê²½ìš°
\[
AP = Q R
\]
(ì—´ ìˆœì—´ \(P\))ë¡œ **ì¤‘ìš” ì—´ë¶€í„° ì•ìœ¼ë¡œ** ì¬ë°°ì¹˜. \(R\)ì˜ ëŒ€ê° ê°ì‡ ë¡œ **ìœ íš¨ ë­í¬**ë¥¼ ì½ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

### 2.4 ë³µì¡ë„(ëŒ€ëµ)
- Dense \(m\times n\) ( \(m\ge n\) ): Householder \( \approx 2mn^2 - \tfrac{2}{3}n^3\).

---

## 3) ìµœì†Œì œê³± ê·¼ì‚¬ (Least Squares)

### 3.1 ë¬¸ì œì •ì˜
\[
\boxed{\min_x \;\|Ax-b\|_2^2}
\]
- \(b\notin\operatorname{col}(A)\) ì—¬ë„, **ê°€ì¥ ê°€ê¹Œìš´** \(Ax\)ë¥¼ ì°¾ëŠ”ë‹¤.

### 3.2 ì •ìƒì¡°ê±´ â†” ì •ê·œë°©ì •ì‹
\[
A^\top(Ax-b)=0 \;\;\Rightarrow\;\; \boxed{A^\top A x \;=\; A^\top b}
\]
- ë‹¨, \(\kappa(A^\top A)=\kappa(A)^2\) â†’ **ì¡°ê±´ìˆ˜ ì œê³± ì•…í™”**. ìˆ˜ì¹˜ì ìœ¼ë¡œ ì·¨ì•½.

### 3.3 QRì„ ì´ìš©í•œ ì•ˆì •í•´ë²•
\(A=QR\Rightarrow A^\top A=R^\top R,\; A^\top b=R^\top(Q^\top b)\)
\[
\boxed{R x \;=\; Q^\top b}
\]
- \(R\) ìƒì‚¼ê°ì´ë¯€ë¡œ **í›„ì§„ëŒ€ì…**ìœ¼ë¡œ ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ êµ¬í•œë‹¤.

### 3.4 ê°€ì¤‘/ì •ê·œí™” ë³€í˜•
- **ê°€ì¤‘ìµœì†Œì œê³±**: \(\min_x\|W^{1/2}(Ax-b)\|_2^2\). \(A_w=W^{1/2}A,\; b_w=W^{1/2}b\)ì— QR ì ìš©.  
- **ë¦¿ì§€(í‹°í˜¸ë…¸í”„)**: \(\min_x\|Ax-b\|_2^2+\lambda\|x\|_2^2\).  
  - ì •ê·œë°©ì •ì‹ì€ \((A^\top A+\lambda I)x=A^\top b\).  
  - QR ê¸°ë°˜ ëŒ€ì•ˆ: \(\begin{bmatrix}A\\ \sqrt{\lambda}I\end{bmatrix}x\approx \begin{bmatrix}b\\ 0\end{bmatrix}\)ì— QR.

### 3.5 ë­í¬ê²°í•(ì„ í˜•ì¢…ì†)ì¼ ë•Œ
- **í”¼ë²— QR** ë˜ëŠ” **SVD**ë¡œ **ìµœì†Œë…¸ë¦„ LS í•´** \(x^\* = A^+ b\) (ë¬´ì–´â€“íœë¡œì¦ˆ ìœ ì‚¬ì—­) ì‚¬ìš©.  
- QRë§Œìœ¼ë¡œë„ ì„ê³„ì¹˜ë¡œ ëŒ€ê°ì„ ìë¥´ë©° ì•ˆì •ì ìœ¼ë¡œ ë­í¬ë¥¼ ì¶”ì •í•˜ê³  í•´ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤.

---

## 4) ì •ê·œì§êµ íˆ¬ì˜í–‰ë ¬ (Orthogonal Projection Matrix)

### 4.1 ì •ì˜ì™€ í˜•íƒœ
- \(b\)ë¥¼ \(\operatorname{col}(A)\)ì— **ì§êµíˆ¬ì˜**í•œ ë²¡í„°
\[
\boxed{p = P b,\quad P = A(A^\top A)^{-1}A^\top}\quad(\text{full column rank})
\]
- QRì´ë©´ ë” ê°„ë‹¨:
\[
A=QR\ \Rightarrow\ \boxed{P = QQ^\top}
\]

### 4.2 í•µì‹¬ ì„±ì§ˆ
- **ëŒ€ì¹­**: \(P^\top=P\)  
- **ë©±ë“±**: \(P^2=P\)  
- **ê³ ìœ³ê°’**: 0 ë˜ëŠ” 1ë§Œ. \(\operatorname{rank}(P)=\operatorname{trace}(P)=\dim\operatorname{col}(A)\).  
- **ì”ì°¨ ì§êµ**: \(r=b-Pb\ \perp\ \operatorname{col}(A)\).  
- **íšŒê·€ Hat í–‰ë ¬**: \(H=X(X^\top X)^{-1}X^\top\), ëŒ€ê° \(h_{ii}\)ëŠ” **ë ˆë²„ë¦¬ì§€**.

### 4.3 ì¼ë°˜ ë­í¬ì˜ í‘œì¤€í˜•
- í•­ìƒ \(P = A A^+\) (ìœ ì‚¬ì—­). full column rankë©´ \(A^+=(A^\top A)^{-1}A^\top\)ë¼ì„œ ìœ„ ì‹ê³¼ ì¼ì¹˜.

---

## 5) ê¸°í•˜í•™ì  í•´ì„

- \(x^\*=\arg\min_x\|Ax-b\|_2\)ì€ \(Ax^\*=Pb\) (**ìµœë‹¨ê±°ë¦¬ ì **).  
- \(r=b-Pb\)ëŠ” ì—´ê³µê°„ì˜ **ì§êµì—¬ê³µê°„**ì— ë†“ì¸ë‹¤.  
- QRì—ì„œ \(Q=[Q_1\ Q_2]\) (full \(m\times m\))ë¼ë©´ \(P=Q_1Q_1^\top\), ë³´ì™„ íˆ¬ì˜ì€ \(I-P=Q_2Q_2^\top\).

---

## 6) ì‹¤ì „ ì½”ë“œ (NumPy / SciPy) â€” ì˜ˆì œì™€ ê²€ì¦

> **ì£¼ì˜**: ìˆ˜ì¹˜ì˜¤ì°¨ ë•Œë¬¸ì— í•­ë“± ë¹„êµëŠ” `np.allclose(..., atol=1e-12)`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

### 6.1 ê¸°ë³¸ LS: QR vs ì •ê·œë°©ì •ì‹
```python
import numpy as np

rng = np.random.default_rng(0)
m, n = 6, 3
A = rng.normal(size=(m, n))
x_true = np.array([2.0, -1.0, 0.5])
b = A @ x_true + 0.01 * rng.normal(size=m)  # ì•½ê°„ì˜ ë…¸ì´ì¦ˆ

# (1) QR ê¸°ë°˜
Q, R = np.linalg.qr(A)              # economy QR: Q (mÃ—n), R (nÃ—n)
x_qr = np.linalg.solve(R, Q.T @ b)  # Rx = Q^T b

# (2) ì •ê·œë°©ì •ì‹(ê¶Œì¥X)
x_ne = np.linalg.solve(A.T @ A, A.T @ b)

print("||x_qr - x_true||:", np.linalg.norm(x_qr - x_true))
print("||x_ne - x_true||:", np.linalg.norm(x_ne - x_true))

# íˆ¬ì˜ ë²¡í„°ì™€ ì”ì°¨ ì§êµì„±
p = A @ x_qr
r = b - p
orth = np.allclose(A.T @ r, np.zeros(n), atol=1e-12)
print("ì”ì°¨ê°€ ì—´ê³µê°„ì— ì§êµ? ", orth)
```

### 6.2 íˆ¬ì˜í–‰ë ¬: \(P=QQ^\top\) ê²€ì¦
```python
# QRì—ì„œì˜ ì •ê·œì§êµ íˆ¬ì˜
P_qr = Q @ Q.T   # mÃ—m
# ë©±ë“±/ëŒ€ì¹­ í™•ì¸
print("ëŒ€ì¹­? ", np.allclose(P_qr, P_qr.T, atol=1e-12))
print("ë©±ë“±? ", np.allclose(P_qr @ P_qr, P_qr, atol=1e-12))
# íˆ¬ì˜ê°’ ì¼ì¹˜
print("íˆ¬ì˜ ì¼ì¹˜? ", np.allclose(P_qr @ b, p, atol=1e-12))
```

### 6.3 ë­í¬ê²°í•: í”¼ë²— QRê³¼ ìœ ì‚¬ì—­
```python
import scipy.linalg as la

# ì„ í˜•ì¢…ì† ì—´ ì¶”ê°€
A_dep = np.column_stack([A, A[:, [0]] + A[:, [1]]])  # ë§ˆì§€ë§‰ ì—´ = ì²«ë‘˜ í•© â†’ rank-deficient
b2 = b.copy()

# í”¼ë²— QR (rank-revealing)
Qp, Rp, Pcols = la.qr(A_dep, pivoting=True)
diag = np.abs(np.diag(Rp))
tol = 1e-10
rank = np.sum(diag > tol)

R11 = Rp[:rank, :rank]
Q1 = Qp[:, :rank]
A_reduced = Q1 @ R11 @ np.eye(rank)  # í‘œê¸°ìš©

# ìµœì†Œë…¸ë¦„ LS í•´ëŠ” ìœ ì‚¬ì—­ìœ¼ë¡œ
x_pinv = la.pinv(A_dep) @ b2
r_pinv = b2 - A_dep @ x_pinv
print("rank(A_dep)â‰ˆ", rank)
print("ì”ì°¨ ì§êµ? ", np.allclose(A_dep.T @ r_pinv, 0, atol=1e-10))

# íˆ¬ì˜í–‰ë ¬ì€ P = A A^+
P_pinv = A_dep @ la.pinv(A_dep)
print("ëŒ€ì¹­? ", np.allclose(P_pinv, P_pinv.T, atol=1e-12))
print("ë©±ë“±? ", np.allclose(P_pinv @ P_pinv, P_pinv, atol=1e-12))
```

### 6.4 ê°€ì¤‘ìµœì†Œì œê³± & ë¦¿ì§€
```python
# ê°€ì¤‘ìµœì†Œì œê³±: W = diag(w)
w = np.array([3,1,2,1,4,2], dtype=float)
W12 = np.sqrt(w)
Aw = (W12[:, None]) * A
bw = W12 * b
Qw, Rw = np.linalg.qr(Aw)
x_wls = np.linalg.solve(Rw, Qw.T @ bw)

# ë¦¿ì§€(í‹°í˜¸ë…¸í”„): [A; sqrt(Î»)I]ë¡œ QR
lam = 1e-1
A_aug = np.vstack([A, np.sqrt(lam)*np.eye(n)])
b_aug = np.hstack([b, np.zeros(n)])
Q_aug, R_aug = np.linalg.qr(A_aug)
x_ridge = np.linalg.solve(R_aug, Q_aug.T @ b_aug)
print("â€–x_wlsâ€–, â€–x_ridgeâ€– = ", np.linalg.norm(x_wls), np.linalg.norm(x_ridge))
```

---

## 7) í˜„ì—… íŒ & í•¨ì •

1. **ì •ê·œë°©ì •ì‹ ì§€ì–‘**: \(\kappa(A^\top A)=\kappa(A)^2\) â†’ ë¯¼ê°ë„ ê¸‰ì¦. ê°€ëŠ¥í•˜ë©´ **QR/SVD**.  
2. **í•´ì˜ ì¢…ë¥˜ íŒŒì•…**: ë­í¬ê²°í•/ë‹¤ì¤‘ê³µì„ ì„± ì˜ì‹¬ ì‹œ **í”¼ë²— QR** ë˜ëŠ” **SVD**ë¡œ ë­í¬-ì»·.  
3. **ìŠ¤ì¼€ì¼ë§**: ì—´ ìŠ¤ì¼€ì¼ì´ í¬ê²Œ ë‹¤ë¥´ë©´ ì§êµí™”ê°€ í”ë“¤ë¦°ë‹¤ â†’ **í‘œì¤€í™”/ì •ê·œí™”**í•˜ê³  QR.  
4. **ëŒ€í˜•Â·í¬ì†Œ**: **Givens**(ìˆœì°¨ ê°±ì‹ ), **Cholesky ì—…ë°ì´í„°**(ì˜ ì¤€ë¹„ëœ ê²½ìš°), ë˜ëŠ” **LSQR/CG**(ì´í„°ë ˆì´í‹°ë¸Œ).  
5. **íˆ¬ì˜ê²€ì¦**: \(P\)ëŠ” ëŒ€ì¹­Â·ë©±ë“±ì´ì–´ì•¼ í•˜ê³  \(\operatorname{trace}(P)=\text{ë­í¬}\). íšŒê·€ì—ì„œëŠ” \(\operatorname{diag}(P)\)ê°€ ë ˆë²„ë¦¬ì§€.  
6. **ë¶€í˜¸ ê´€ë¡€**: \(R\) ëŒ€ê°ì„ ì–‘ìˆ˜ë¡œ ë‘ë©´ \(Q,R\)ì˜ ë¶€í˜¸ê°€ ì¼ê´€, í•´ì„ì´ ì‰¬ì›Œì§„ë‹¤.

---

## 8) ê°œë… ì—°ê²° ê·¸ë¦¼

- **LS í•´**: \(x^\*\)  
  â†³ \(Ax^\* = P b\) (**íˆ¬ì˜**)  
  â†³ \(r=b-Ax^\*\perp \operatorname{col}(A)\) (**ì§êµ**)  
  â†³ \(x^\*\)ëŠ” QRì´ë©´ \(R x^\* = Q^\top b\) (**ì•ˆì •í•´ë²•**)  
  â†³ ë­í¬ê²°í•ì´ë©´ \(x^\* = A^+ b\) (**ìµœì†Œë…¸ë¦„**)

---

## 9) ë¯¸ë‹ˆ ì†ê³„ì‚° ì˜ˆ

\(A=\begin{bmatrix}1&1\\0&1\\1&0\end{bmatrix}\), \(b=\begin{bmatrix}2\\1\\3\end{bmatrix}\).  
- QR (economy): \(Q=[q_1\ q_2], R=\begin{bmatrix} \|v_1\| & * \\ 0 & *\end{bmatrix}\).  
- \(x\)ëŠ” \(Rx=Q^\top b\)ë¡œ êµ¬í•¨.  
- \(p=Ax\), \(P=QQ^\top\), \(r=b-p\).  
- \(A^\top r=0\)ê³¼ \(P^2=P\) í™•ì¸.

(ìœ„ 6.1 ì½”ë“œê°€ ë™ì¼ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹¤í–‰í•œë‹¤.)

---

## 10) ìš”ì•½ ì¹´ë“œ

| ì£¼ì œ | í•µì‹¬ ê³µì‹ | ì½”ë©˜íŠ¸ |
|---|---|---|
| QR ë¶„í•´ | \(A=QR\), \(Q^\top Q=I\), \(R\) ìƒì‚¼ê° | Householder/MGS ê¶Œì¥ |
| ìµœì†Œì œê³±(LS) | \(A^\top A x=A^\top b\) | ìˆ˜ì¹˜ì ìœ¼ë¡  \(Rx=Q^\top b\) ì¶”ì²œ |
| íˆ¬ì˜í–‰ë ¬ | \(P=A(A^\top A)^{-1}A^\top\) | QRì´ë©´ \(P=QQ^\top\) |
| ì”ì°¨ ì§êµ | \(A^\top(b-Ax^\*)=0\) | ìµœë‹¨ê±°ë¦¬ ì¡°ê±´ |
| ë­í¬ê²°í• | \(x^\*=A^+ b\), \(P=AA^+\) | í”¼ë²—QR/SVD |

---

## 11) ì¶”ê°€ ì—°ìŠµ ì•„ì´ë””ì–´

- ì„œë¡œ ë‹¤ë¥¸ \(m,n\)Â·ì¡°ê±´ìˆ˜ì—ì„œ **NE vs QR vs SVD** ì„±ëŠ¥ ë¹„êµ.  
- **í”¼ë²— QR**ë¡œ ì¤‘ìš” ë³€ìˆ˜ ì„ íƒ(ì—´ ìˆœì—´)ê³¼ ë­í¬ ì¶”ì •.  
- ê°€ì¤‘Â·ë¦¿ì§€ì—ì„œ **í¸í–¥â€“ë¶„ì‚° íŠ¸ë ˆì´ë“œì˜¤í”„** ê´€ì°°.  
- Hat í–‰ë ¬ ëŒ€ê°ìœ¼ë¡œ **ë ˆë²„ë¦¬ì§€**ì™€ **ì´ìƒì¹˜ ì˜í–¥** ë¶„ì„.

---
```python
# ë³´ë„ˆìŠ¤: ìˆ˜ì •í˜• Gramâ€“Schmidt(MGS)ë¡œ QR êµ¬í˜„ (í•™ìŠµìš©)
import numpy as np

def qr_mgs(A):
    A = A.astype(float).copy()
    m, n = A.shape
    Q = np.zeros((m, n))
    R = np.zeros((n, n))
    for i in range(n):
        v = A[:, i]
        for j in range(i):
            R[j, i] = Q[:, j] @ v
            v = v - R[j, i] * Q[:, j]
        R[i, i] = np.linalg.norm(v)
        if R[i, i] < 1e-14:
            # ë­í¬ê²°í•: ì—´ì´ ê±°ì˜ 0
            Q[:, i] = 0
        else:
            Q[:, i] = v / R[i, i]
    return Q, R

# ê²€ì¦
rng = np.random.default_rng(7)
A = rng.normal(size=(5, 3))
Qm, Rm = qr_mgs(A)
print("MGS: ì¬êµ¬ì„± OK? ", np.allclose(Qm @ Rm, A))
print("MGS: ì—´ì§êµ? ", np.allclose(Qm.T @ Qm, np.eye(3), atol=1e-10))
```