---
layout: post
title: 미적분 - 벡터의 내적
date: 2025-07-27 14:20:23 +0900
category: 미적분
---
# 벡터의 내적(Dot Product)

본 글은 사용자가 제공한 초안의 **핵심(정의·성질·투영·방향미분·일(work))**을 유지하면서 다음을 **대폭 확장**한다:
- 내적의 **공리(선형성·대칭성·양의정부호)**와 **정규화(norm)·각도**의 연결
- **코시–슈바르츠 부등식**, **삼각부등식**, **평행사변형 법칙**, **편극화 공식**
- **정사영·부분공간 투영·그람–슈미트·정사영 행렬**과 **최소제곱/정규방정식**
- **방향미분=그래디언트와의 내적**, **일/전력**, **Lambert 조명**, **코사인 유사도**
- **가중 내적**(메트릭 행렬), **함수공간 내적**
- **수치 안정성**(각도 계산, 정규화, under/overflow)과 **검산 가능한 PyTorch 코드**
- 연습문제(풀이 스케치 포함)

수학식은 모두 $$\cdots$$, 코드는 ``` 로 감싼다.

---

## 내적의 정의(기하·대수)와 공리

### 기하학적 정의

두 벡터 $$\vec a,\ \vec b$$ 사이 각도 $$\theta\in[0,\pi]$$ 에 대해
$$
\vec a\cdot \vec b=\lVert \vec a\rVert\,\lVert \vec b\rVert\,\cos\theta.
$$
- 부호: $$\theta<\tfrac{\pi}{2}$$ 양수, $$=\tfrac{\pi}{2}$$ 직교(0), $$>\tfrac{\pi}{2}$$ 음수.

### 대수적 정의

$$
\vec a=(a_1,\dots,a_n),\ \vec b=(b_1,\dots,b_n)\ \Rightarrow\
\vec a\cdot \vec b=\sum_{i=1}^n a_i b_i.
$$

### 내적의 공리(Inner Product Axioms)

$$
\forall \vec x,\vec y,\vec z\in\mathbb{R}^n,\ \forall \alpha\in\mathbb{R}:
$$
1) **선형성**: $$(\alpha \vec x+\vec y)\cdot \vec z=\alpha(\vec x\cdot \vec z)+(\vec y\cdot \vec z).$$
2) **대칭성**: $$\vec x\cdot \vec y=\vec y\cdot \vec x.$$
3) **양의정부호**: $$\vec x\cdot \vec x\ge 0,\quad (\vec x\cdot \vec x=0\iff \vec x=\vec 0).$$

> 위 세 공리로부터 표준 노름과 각도가 유도된다:
> $$\lVert \vec x\rVert=\sqrt{\vec x\cdot \vec x},\quad
\cos\theta=\dfrac{\vec a\cdot \vec b}{\lVert \vec a\rVert\lVert \vec b\rVert}.$$

---

## 핵심 성질와 고전 정리

### 성질(초안 보강)

- **교환법칙** $$\vec a\cdot \vec b=\vec b\cdot \vec a$$
- **분배법칙** $$\vec a\cdot (\vec b+\vec c)=(\vec a\cdot \vec b)+(\vec a\cdot \vec c)$$
- **스칼라 결합** $$(k\vec a)\cdot \vec b=k(\vec a\cdot \vec b)$$
- **자기 내적** $$\vec a\cdot \vec a=\lVert \vec a\rVert^2$$

### 코시–슈바르츠(C–S) 부등식

$$
|\vec a\cdot \vec b|\le \lVert \vec a\rVert\,\lVert \vec b\rVert,
\quad(= \text{ iff } \vec a,\vec b\ \text{가 선형종속}).
$$

### 삼각 부등식(노름)

$$
\lVert \vec a+\vec b\rVert \le \lVert \vec a\rVert+\lVert \vec b\rVert.
$$

### 평행사변형 법칙

$$
\lVert \vec a+\vec b\rVert^2+\lVert \vec a-\vec b\rVert^2=2\lVert \vec a\rVert^2+2\lVert \vec b\rVert^2.
$$

### 편극화 공식(내적↔노름)

$$
\vec a\cdot \vec b=\tfrac{1}{4}\big(\lVert \vec a+\vec b\rVert^2-\lVert \vec a-\vec b\rVert^2\big).
$$

---

## 직교·투영·부분공간

### 직교(orthogonality)

$$
\vec a\perp \vec b \iff \vec a\cdot \vec b=0.
$$

### 선(1차원 부분공간) 위 정사영

$$
\operatorname{proj}_{\vec a}\vec b=\frac{\vec a\cdot \vec b}{\lVert \vec a\rVert^2}\,\vec a.
$$
- **오차(잔차)** $$\vec r=\vec b-\operatorname{proj}_{\vec a}\vec b \perp \vec a.$$

### 부분공간 투영(다차원)

정규직교기저 $$Q=[\vec q_1\ \cdots\ \vec q_k]$$ 에 대해
$$
\operatorname{proj}_{\mathcal{S}}\vec b=QQ^\top \vec b,\quad Q^\top Q=I_k.
$$
- 임의의 전열 행렬 $$A\in\mathbb{R}^{n\times k}$$ 에 대해 **정사영 행렬**:
  $$P=A(A^\top A)^{-1}A^\top\quad(\text{열 선형독립}).$$

### 그람–슈미트(Gram–Schmidt)와 직교화

선형독립 집합 $$\{\vec a_i\}$$ 를 직교 정규화 $$\{\vec q_i\}$$ 로 변환:
$$
\vec u_1=\vec a_1,\ \vec q_1=\frac{\vec u_1}{\lVert \vec u_1\rVert},\quad
\vec u_j=\vec a_j-\sum_{i=1}^{j-1}(\vec a_j\cdot \vec q_i)\vec q_i,\ \vec q_j=\frac{\vec u_j}{\lVert \vec u_j\rVert}.
$$

---

## 각도·코사인 유사도·통계 연결

### 각도

$$
\theta=\cos^{-1}\!\left(\frac{\vec a\cdot \vec b}{\lVert \vec a\rVert\lVert \vec b\rVert}\right).
$$

### 코사인 유사도(ML에서 자주 사용)

$$
\operatorname{cos\_sim}(\vec a,\vec b)=\frac{\vec a\cdot \vec b}{\lVert \vec a\rVert\lVert \vec b\rVert}.
$$
- 고차원 희소 벡터 비교, 정보검색, 임베딩 비교에 널리 쓰임.

### 공분산·상관계수와의 연관(중심화 기준)

평균을 0으로 중심화한 표본 열벡터 $$\tilde{\vec x},\tilde{\vec y}$$ 에 대해
$$
\operatorname{cov}(x,y)=\frac{1}{n-1}\tilde{\vec x}\cdot \tilde{\vec y},\quad
\rho(x,y)=\frac{\tilde{\vec x}\cdot \tilde{\vec y}}{\lVert \tilde{\vec x}\rVert\lVert \tilde{\vec y}\rVert}.
$$

---

## 미분적분학·물리 응용

### 방향미분과 그래디언트

단위 방향 $$\hat v$$ 에서
$$
D_{\hat v}f=\nabla f\cdot \hat v.
$$
- 그래디언트는 **최대 증가 방향**이며 그 크기는 **최대 증가율**.

### 일(Work)·전력(Power)

상수 힘: $$W=\vec F\cdot \vec d.$$
곡선 경로 $$\mathbf r(t)$$, 힘장 $$\vec F(\mathbf r)$$:
$$
W=\int_C \vec F\cdot d\mathbf r=\int_a^b \vec F(\mathbf r(t))\cdot \mathbf r'(t)\,dt.
$$
순간 전력: $$P=\vec F\cdot \vec v.$$

### 컴퓨터 그래픽스(Lambert 반사)

조명 $$\vec L$$, 표면 법선 $$\vec n$$ (단위):
$$
I\propto \max(0,\ \vec n\cdot \vec L).
$$
- back-face culling 역시 $$\vec n\cdot \vec v$$ 부호로 판단.

---

## 최소제곱과 정규방정식(내적의 선형대수적 위상)

데이터 행렬 $$X\in\mathbb{R}^{m\times n}$$, 목표 $$\vec y$$:
$$
\min_{\vec w}\ \lVert X\vec w-\vec y\rVert^2.
$$
정규방정식:
$$
X^\top X\vec w^\star=X^\top \vec y.
$$
- 각 성분은 **열벡터들의 내적**(상관)으로 구성.
- 해는 $$\vec w^\star=(X^\top X)^{-1}X^\top \vec y$$ (열이 독립일 때).

---

## 가중 내적·좌표불변성·함수공간

### 가중 내적(메트릭 행렬)

대칭 양의정부호 행렬 $$M\succ 0$$ 에 대해
$$
\langle \vec x,\vec y\rangle_M=\vec x^\top M \vec y,\quad
\lVert \vec x\rVert_M=\sqrt{\vec x^\top M \vec x}.
$$
- Mahalanobis 거리, 물리 단위 스케일 불균형 처리 등에 사용.

### 내적의 선형대수 표기

표준 내적: $$\vec x\cdot \vec y=\vec x^\top \vec y=\operatorname{tr}(\vec y\vec x^\top).$$

### 함수공간의 내적(간단 예)

$$
\langle f,g\rangle=\int_a^b f(x)g(x)\,w(x)\,dx.
$$
- 직교다항식(르장드르, 체비쇼프), 푸리에 급수의 기초.

---

## 수치 안정성·구현 팁

1) **정규화**: $$\widehat{\vec a}=\vec a/\max(\lVert \vec a\rVert,\varepsilon)$$.
2) **각도 계산 클리핑**: $$\cos\theta=\operatorname{clip}(\frac{\vec a\cdot \vec b}{\lVert \vec a\rVert\lVert \vec b\rVert},-1,1).$$
3) **거의 직교 판단**: $$|\vec a\cdot \vec b| \le \tau\,\lVert \vec a\rVert\lVert \vec b\rVert$$ 작은 $$\tau$$(예: $$10^{-8}$$).
4) **그람–슈미트**: 수정형(MGS)·QR 분해 사용이 수치적으로 안정.
5) **스케일링**: 매우 크거나 작은 성분은 스케일 정규화 후 내적.

---

## PyTorch 예제 — 내적·각도·투영·그람–슈미트·작업(일) 적분

> PyTorch만 사용한다(사용자 선호). CPU에서 바로 실행 가능.

```python
import torch

EPS = 1e-12

def dot(a: torch.Tensor, b: torch.Tensor) -> torch.Tensor:
    """<a,b> = sum_i a_i b_i (batch 가능: (..., d))"""
    return (a * b).sum(dim=-1)

def norm(a: torch.Tensor) -> torch.Tensor:
    return torch.clamp(dot(a, a), min=0.0).sqrt()

def unit(a: torch.Tensor) -> torch.Tensor:
    return a / (norm(a).unsqueeze(-1) + EPS)

def angle(a: torch.Tensor, b: torch.Tensor) -> torch.Tensor:
    """angle in radians with clipping"""
    na, nb = norm(a), norm(b)
    denom = (na * nb) + EPS
    c = (dot(a, b) / denom).clamp(-1.0, 1.0)
    return torch.acos(c)

def proj_onto(a: torch.Tensor, b: torch.Tensor) -> torch.Tensor:
    """proj_a(b): b의 a-방향 정사영"""
    coef = (dot(a, b) / (dot(a, a) + EPS)).unsqueeze(-1)
    return coef * a

def gram_schmidt(A: torch.Tensor):
    """
    입력: A shape (n, k) (열벡터가 기저 후보)
    출력: Q (n, k) 정규직교 기저, R (k, k)
    """
    n, k = A.shape
    Q = torch.zeros_like(A)
    R = torch.zeros(k, k, dtype=A.dtype)
    for j in range(k):
        v = A[:, j]
        for i in range(j):
            R[i, j] = dot(Q[:, i], v)
            v = v - R[i, j] * Q[:, i]
        R[j, j] = norm(v)
        Q[:, j] = v / (R[j, j] + EPS)
    return Q, R

def project_to_subspace(A: torch.Tensor, b: torch.Tensor) -> torch.Tensor:
    """
    부분공간 span(A)의 정사영: QQ^T b (QR 기반)
    A: (n, k), b: (n,)
    """
    Q, _ = torch.linalg.qr(A, mode='reduced')
    return Q @ (Q.T @ b)

# ----- 작은 검산 -----

a = torch.tensor([3.0, 4.0])     # |a|=5
b = torch.tensor([2.0, -1.0])
print("dot(a,b) =", dot(a,b).item())             # 6 - 4 = 2
print("angle(a,b) [deg] =", angle(a,b).item() * 180.0/torch.pi)
print("proj_a(b) =", proj_onto(a, b))

# ----- Lambert 조명 (n·L) -----

n = unit(torch.tensor([0.0, 0.0, 1.0]))
L = unit(torch.tensor([0.3, 0.4, 0.8660254]))    # 대략 30도 위
intensity = torch.clamp(dot(n, L), min=0.0)
print("Lambert intensity =", intensity.item())

# ----- 선적분으로 '일' 수치 근사: r(t) 원, F(x,y)=(y,-x) -----

def F(xy: torch.Tensor) -> torch.Tensor:
    x, y = xy[..., 0], xy[..., 1]
    return torch.stack([y, -x], dim=-1)

def r(t: torch.Tensor) -> torch.Tensor:
    return torch.stack([torch.cos(t), torch.sin(t)], dim=-1)

def rprime(t: torch.Tensor) -> torch.Tensor:
    return torch.stack([-torch.sin(t), torch.cos(t)], dim=-1)

def work_integral(n=20000):
    ts = torch.linspace(0, 2*torch.pi, n+1)
    tmid = 0.5*(ts[:-1] + ts[1:])
    integrand = dot(F(r(tmid)), rprime(tmid))
    # 사다리꼴 적분
    dt = ts[1:] - ts[:-1]
    return (integrand * dt).sum()

W = work_integral()
print("∮_C F·dr ≈", W.item(), " ; exact=2π =", (2*torch.pi).item())

# ----- 그람–슈미트 & 부분공간 정사영 -----

A = torch.tensor([[1.0, 1.0],
                  [0.0, 1.0],
                  [0.0, 0.0]])  # R^3에서 span{(1,0,0),(1,1,0)}
b3 = torch.tensor([2.0, 3.0, 5.0])
Q, R = gram_schmidt(A)
proj_b = project_to_subspace(A, b3)
print("Q^T Q ≈ I?\n", (Q.T @ Q))
print("proj_{span(A)}(b) =", proj_b)
print("residual ⟂ subspace dot =", (Q.T @ (b3 - proj_b)))
```

**출력 해석**
- `dot(a,b)=2` (초안 예제와 일치), 각도는 양수이며 약간 예각.
- `Lambert intensity` 는 법선과 광원 각도에 따른 밝기.
- 원 위 선적분은 약 `2π` 로 수렴(그린/스토크스 정리와 합치).
- `Q^T Q ≈ I`, `residual` 이 0에 가까움 → 정사영의 직교성 확인.

---

## 예제와 풀이 스케치

### 예제 1: 직교 판정과 투영

$$
\vec a=(1,2,2),\ \vec b=(2,-1,0).
$$
1) 직교? $$\vec a\cdot \vec b=1\cdot 2+2\cdot(-1)+2\cdot 0=0$$ → **직교**.
2) $$\operatorname{proj}_{\vec a}\vec b=\vec 0$$ (직교이면 투영 0).

### 예제 2: 방향미분

$$
f(x,y)=x^2y,\ \mathbf x_0=(1,2),\ \hat v=\frac{1}{\sqrt{5}}(1,2).
$$
$$
\nabla f=(2xy,\ x^2),\ \nabla f(1,2)=(4,1),\quad
D_{\hat v} f=\nabla f\cdot \hat v=\frac{4\cdot 1+1\cdot 2}{\sqrt{5}}=\frac{6}{\sqrt{5}}.
$$

### 예제 3: 최소제곱과 내적

$$
X=\begin{bmatrix}1\\2\\3\end{bmatrix},\ y=\begin{bmatrix}1\\1\\2\end{bmatrix}.
$$
정규방정식: $$(X^\top X)w=X^\top y\Rightarrow (1^2+2^2+3^2)w=(1+2+6)=9\Rightarrow w=\frac{9}{14}.$$
- 열벡터들의 내적만으로 계산 가능.

### 예제 4: Lambert 셰이딩

법선 $$\vec n=(0,0,1)$$, 광원 $$\vec L=(\tfrac{\sqrt{2}}{2},0,\tfrac{\sqrt{2}}{2})$$
$$
I\propto \max(0,\ \vec n\cdot \vec L)=\frac{\sqrt{2}}{2}.
$$

---

## 흔한 실수와 팁

- **영벡터 각도 미정의**: $$\lVert \vec a\rVert=0$$ 이면 각도 정의 불가. 방어코드(EPS) 필수.
- **정규화 잊음**: 코사인 유사도, Lambert 조명에서 단위벡터 필요.
- **정사영 행렬 오남용**: $$P=A(A^\top A)^{-1}A^\top$$ 은 열 독립 가정. 아니면 QR/SVD 사용.
- **수치적 직교성 착시**: `Q.T@Q≈I`의 허용 오차 확인(예: $$10^{-10}$$ 수준).
- **좌표 스케일 문제**: 내적 기반 거리/각도는 스케일에 민감 → 가중 내적/표준화 고려.

---

## 연습문제(풀이 스케치)

1) (**C–S 등호 조건**)
   선형종속일 때만 $$|\vec a\cdot \vec b|=\lVert a\rVert\lVert b\rVert$$ 임을 보여라.
   *스케치*: $$\lVert \vec a-\lambda \vec b\rVert^2\ge 0$$ 전개해 최소값 조건으로 증명.

2) (**부분공간 투영**)
   $$A=\begin{bmatrix}1&0\\1&1\\0&1\end{bmatrix},\ b=(2,0,1)^\top$$.
   (a) QR로 $$Q$$ 구해 $$QQ^\top b$$ 계산. (b) 잔차가 $$A$$ 열공간에 직교임을 보이라.

3) (**일의 부호**)
   $$\vec F=(1,0),\ C$$: 원점에서 $(1,0)$ 까지의 선분과 $(1,0)$에서 원점까지의 반대 방향 선분.
   각각의 $$\int_C \vec F\cdot d\vec r$$ 를 계산해 경로 방향이 일에 미치는 영향 확인.

4) (**최소제곱**)
   $$X=\begin{bmatrix}1&1\\1&2\\1&3\end{bmatrix},\ y=(1,2,2)^\top$$ 선형회귀 가중치 $$w$$ 계산.
   *스케치*: $$w=(X^\top X)^{-1}X^\top y.$$ 각 성분은 열벡터들 내적.

5) (**가중 내적**)
   $$M=\operatorname{diag}(1,4),\ \langle x,y\rangle_M=x^\top M y.$$
   (a) $$\lVert (1,1)\rVert_M$$ (b) $$\operatorname{proj}_a^M(b)=\dfrac{\langle b,a\rangle_M}{\langle a,a\rangle_M}a$$ 를 유도·계산.

---

## 요약

- 내적은 **길이·각도·투영**을 잇는 다리이며, **방향미분**, **일/전력**, **Lambert 조명**, **최소제곱** 등에서 핵심.
- **C–S**, **삼각 부등식**, **편극화 공식**은 내적–노름 관계의 기본 문법.
- 부분공간 투영과 정규방정식은 “내적=상관”의 관점으로 읽을 때 구조가 명확해진다.
- 실무에서는 **정규화/클리핑/QR(SVD)** 로 수치안정성을 확보한다.
