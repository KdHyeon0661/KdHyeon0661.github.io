---
layout: post
title: 정보보안기사 - 윈도우 보안
date: 2025-11-05 21:25:23 +0900
category: 정보보안기사
---
# 윈도우 보안(로컬/도메인 정책, UAC, Defender, 이벤트/로그, PowerShell 보안)

## 0) 큰 그림(한눈 요약)

- **정책**: 로컬 보안 정책(LGPO) ↔ 도메인 GPO(우선 적용). LSDOU 처리 순서, 보안 필터링/링크/상속.
- **UAC**: 관리자 승격 “승인 모드”, 보안 바탕화면, 파일/레지스트리 가상화(레거시 호환).
- **Defender**: 실시간 보호, 클라우드 차단, PUA/Network Protection, **Controlled Folder Access(랜섬웨어 차단)**, (선택) ASR 규칙.
- **로그**: 고급 감사 정책(프로세스 생성 4688 등), **명령줄 로깅**, WEF(집중 수집), (선택) Sysmon 상세 텔레메트리.
- **PowerShell**: 실행 정책, 스크립트 서명, **ScriptBlock/Module/Transcription 로깅**, **JEA(Just Enough Administration)**, WinRM HTTPS.

---

## 1) 로컬/도메인 정책(Local/Domain Policy)

### 1.1 개념 핵심
- **로컬 보안 정책(Local Security Policy, LGPO)**: 단일 호스트에 적용. 도메인 GPO가 존재하면 **GPO가 우선**.
- **도메인 GPO**: **L**ocal → **S**ite → **D**omain → **OU** 순서로 처리(LSDOU), **가장 나중**에 적용된 정책이 우선.
- **보안 필터링 / WMI 필터**: GPO 대상 범위 정밀 제어(예: OS 버전, 랩탑만).
- **링크 순서/상속 차단**: OU 단위 우선순위·상속 제어.
- **권장**: 가능한 한 **도메인 GPO에 표준화**(서버/워크스테이션 유형별 OU 구성).

---

### 1.2 로컬 보안 정책(LGPO) 일괄 적용 — `secedit`/INF 예제

**상황**: 독립 서버(워크그룹) 3대를 동일 하드닝.  
**목표**: 암호 정책/잠금, 감사 정책, 사용자 권한 할당을 한 번에 적용.

```ini
; C:\hardening\baseline.inf  (예시, 필요값은 환경에 맞게 조정)
[System Access]
MinimumPasswordLength = 12
PasswordComplexity = 1
MaximumPasswordAge = 90
MinimumPasswordAge = 1
LockoutBadCount = 5
ResetLockoutCount = 15
LockoutDuration = 15

[Event Audit]
AuditSystemEvents = 3
AuditLogonEvents = 3
AuditObjectAccess = 1
AuditPrivilegeUse = 1
AuditPolicyChange = 3
AuditAccountManage = 3
AuditProcessTracking = 3
AuditDSAccess = 0
AuditAccountLogon = 3

[Privilege Rights]
SeDenyRemoteInteractiveLogonRight = Guests
SeRemoteInteractiveLogonRight = Administrators
SeDenyNetworkLogonRight = Guests
SeInteractiveLogonRight = Administrators, Users
```

```cmd
:: 적용/검증/백업
secedit /configure /db C:\hardening\secpol.sdb /cfg C:\hardening\baseline.inf /overwrite
secedit /export /cfg C:\hardening\exported.inf
```

**검증**: `secpol.msc` → “로컬 정책/감사 정책”, “계정 정책/암호 정책” 확인.  
**롤백**: `secedit /configure /db ... /cfg C:\hardening\exported.inf` (백업 INF로 복원).

---

### 1.3 도메인 GPO 자동화 — GPMC PowerShell

**상황**: “WS-Baseline” GPO를 만들고 도메인 워크스테이션 OU에 링크, 일부 레지스트리 정책을 설정.

```powershell
Import-Module GroupPolicy

# 1) GPO 생성
$gpo = New-GPO -Name "WS-Baseline" -Comment "Workstation security baseline"

# 2) GPO 링크(OU DN은 환경에 맞게)
New-GPLink -Name $gpo.DisplayName -Target "OU=Workstations,DC=corp,DC=example,DC=com" -Enforced $false

# 3) 예시 정책(레지스트리 기반) 설정: UAC·명령줄 로깅 등
# UAC: Admin Approval Mode 유지(EnableLUA=1)
Set-GPRegistryValue -Name $gpo.DisplayName -Key "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" `
  -ValueName "EnableLUA" -Type Dword -Value 1

# 프로세스 생성 시 명령줄 로깅(4688에 명령줄 포함)
Set-GPRegistryValue -Name $gpo.DisplayName -Key "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit" `
  -ValueName "ProcessCreationIncludeCmdLine_Enabled" -Type Dword -Value 1

# 4) 고급 감사 정책(예: 프로세스 생성 성공/실패 로깅)
# AuditPol은 로컬에 직접 쓰므로 시작 스크립트/시큐리티 템플릿 병행 권장
```

**검증**: `gpresult /r /scope computer` 로 적용 GPO 확인, 대상 OU 컴퓨터 재부팅/강제 갱신(`gpupdate /force`).

---

### 1.4 LAPS(로컬 관리자 암호 관리) 개요

- **문제**: 모든 PC의 로컬 Administrator 암호가 동일하면 탈취 시 **수평 이동** 위험.
- **해결**: **Windows LAPS** 또는 레거시 LAPS로 각 장치의 로컬 Admin 암호를 **주기적 랜덤화/중앙 저장**.  
- **적용**: 도메인 GPO로 정책 배포 → 필요 시 헬프데스크가 만료/강제 회전.

*(도입 절차/스키마 확장은 운영 환경 버전에 따라 달라 상세 단계는 별도 문서화 권장)*

---

## 2) UAC(사용자 계정 컨트롤)

### 2.1 핵심 개념
- **표준 사용자로 실행** + 관리자 작업 시 **승격 프롬프트**.
- **보안 바탕화면(Secure Desktop)**: 승격 창을 다른 프로세스가 후킹 못 하게 **격리**.
- **UAC 가상화**: 레거시 앱의 `Program Files`/`HKLM` 쓰기를 **개인 가상 경로**로 리다이렉트.

### 2.2 권장 설정 & 스크립트

```powershell
# UAC 기본 활성(EnableLUA=1, 보안 바탕화면=1)
$sys = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System"
Set-ItemProperty $sys EnableLUA 1
Set-ItemProperty $sys PromptOnSecureDesktop 1

# 관리자 동작 시 동의 필요(ConsentPromptBehaviorAdmin=2)
# 0=승격 금지, 2=동의(기본 권장), 5=자격증명 입력 요구
Set-ItemProperty $sys ConsentPromptBehaviorAdmin 2

# 표준 사용자 동작 시 자격증명 필요(ConsentPromptBehaviorUser=1)
# 0=자동 거부, 1=자격증명 필요
Set-ItemProperty $sys ConsentPromptBehaviorUser 1
```

**검증**: 관리자 권한 필요한 앱 실행 시 **보안 바탕화면**에서 프롬프트 표시 확인.  
**주의**: `EnableLUA=0`은 많은 보안/앱 기능이 **비활성**되어 **권장하지 않음**.

---

## 3) Microsoft Defender (Windows 내장 AV/보호)

> **범위**: Microsoft Defender Antivirus(실시간 보호)와 주요 OS 내장 보호(네트워크 보호/PUA/Controlled Folder Access).  
> ASR(Attack Surface Reduction) 규칙은 **GUID 지정이 필요**하므로, 운영 시 **공식 규칙 ID**를 확인해 명시 적용하세요.

### 3.1 기본 가시성/상태 확인

```powershell
Get-MpComputerStatus | Select AMServiceEnabled,AntivirusEnabled,RealTimeProtectionEnabled,IoavProtectionEnabled,AntispywareEnabled,IsTamperProtected
Get-MpPreference | Select-Object * | Out-String -Width 300
```

### 3.2 실시간/클라우드/PUA/네트워크 보호

```powershell
# 실시간 보호 켜기
Set-MpPreference -DisableRealtimeMonitoring $false

# 클라우드 기반 보호 강화(차단 수준 높임)
# CloudBlockLevel: High/HighPlus 등(버전에 따라 지원 값 상이)
Set-MpPreference -MAPSReporting Advanced
Set-MpPreference -SubmitSamplesConsent SendSafeSamples
Set-MpPreference -CloudBlockLevel High

# PUA(원치 않는 앱) 차단
Set-MpPreference -PUAProtection Enabled

# 네트워크 보호(SmartScreen 기반 URL/IP 차단 향상)
Set-MpPreference -EnableNetworkProtection Enabled
```

### 3.3 Controlled Folder Access(랜섬웨어 보호)

```powershell
# 보호 모드 켜기: Enabled 또는 AuditMode
Set-MpPreference -EnableControlledFolderAccess Enabled

# 보호할 폴더 추가
Add-MpPreference -ControlledFolderAccessProtectedFolders "C:\Data","D:\Projects"

# 신뢰 앱(예외) 등록(공식 서명 앱/사내 앱에 한정 권장)
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Program Files\Vendor\App.exe"
```

### 3.4 서명 업데이트/온디맨드 검사

```powershell
Update-MpSignature
Start-MpScan -ScanType QuickScan
Start-MpScan -ScanType FullScan
```

### 3.5 (선택) ASR 규칙 개요 및 적용 패턴

> **주의**: ASR 규칙은 **GUID**로 식별됩니다. 아래 패턴처럼 **_IDs_**와 **_Actions_**를 **쌍으로** 지정하세요.  
> 실제 GUID/액션은 운영 환경 정책에 맞춰 공식 문서의 목록으로 대체/보완하세요.

```powershell
# 예시 패턴(IDs는 실제 규칙 GUID 배열로 교체)
$ids = @(
  # "D4F940AB-401B-4EFC-AADC-AD5F3C50688A", # 예: Office 하위 프로세스 차단 (예시, 실제 GUID 확인 필요)
  # ...
)
$actions = @("Enabled") * $ids.Count
Add-MpPreference -AttackSurfaceReductionRules_Ids $ids -AttackSurfaceReductionRules_Actions $actions
```

**검증**: `Get-MpPreference` 로 설정 반영 확인, 의도치 않은 업무 앱 차단 여부 UAT 수행.  
**롤백**: `Add-MpPreference -AttackSurfaceReductionRules_Ids ... -AttackSurfaceReductionRules_Actions Disabled`.

> **Tamper Protection**: OS UI/MDM에서 제어(일부 PowerShell로는 변경 제한). 운영 정책으로 **사용** 권장.

---

## 4) 이벤트/로그(Advanced Auditing, WEF, Sysmon)

### 4.1 고급 감사 정책 핵심 서브카테고리

- **로그온/계정 로그온**: `4624`(성공), `4625`(실패), `4648`(명시 자격증명), `4672`(특권 로그인)
- **프로세스 생성**: `4688`(명령줄 포함 설정 시 커맨드라인 기록), `4689`(종료)
- **객체 접근/정책 변경**: `4663`(파일 액세스), `4719`(감사 정책 변경)
- **계정 관리**: `4720`(유저 생성), `4722`(사용자 활성화), `4732`(보안 그룹에 추가)
- **로그 지움**: `1102`(감사 로그 삭제)

### 4.2 `AuditPol`로 표준 감사 묶음 적용

```cmd
:: 프로세스 생성/종료, 로그온, 정책 변경 등 성공/실패 로깅
auditpol /set /subcategory:"Process Creation" /success:enable /failure:enable
auditpol /set /subcategory:"Process Termination" /success:enable /failure:enable
auditpol /set /subcategory:"Logon" /success:enable /failure:enable
auditpol /set /subcategory:"Account Lockout" /success:enable /failure:enable
auditpol /set /subcategory:"Policy Change" /success:enable /failure:enable
```

**프로세스 명령줄 포함**:

```powershell
New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit" -Force | Out-Null
Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit" `
  -Name "ProcessCreationIncludeCmdLine_Enabled" -Type DWord -Value 1
```

### 4.3 빠른 헌팅 쿼리(Get-WinEvent)

```powershell
# 최근 1시간, 관리자 특권 로그인(4672)
$Start=(Get-Date).AddHours(-1)
Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4672; StartTime=$Start} |
  Select TimeCreated, @{n='Account';e={$_.Properties[1].Value}}

# 프로세스 생성 4688 + 명령줄 포함
Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4688; StartTime=$Start} |
  Select TimeCreated, @{n='NewProcessName';e={$_.Properties[6].Value}}, `
         @{n='CommandLine';e={$_.Properties[8].Value}} |
  Out-GridView
```

> **주의**: 인덱스는 OS 빌드/로깅 구성에 따라 달라질 수 있어, 운영 전 **필드 매핑** 확인 권장.

### 4.4 Windows Event Forwarding(WEF) 간단 구축

**수집기(Collector)**:
```cmd
wecutil qc         :: Event Collector 서비스 준비
winrm quickconfig  :: WinRM 서비스 준비(HTTPS 권장)
```

**구독(Subscription) 예시**: “보안 로그(4688/4624/4625)”를 도메인 워크스테이션에서 수집.
- GUI: 이벤트 뷰어 → “구독” → 소스 컴퓨터 선택(도메인/OU 기반) → 쿼리 지정 (XML/XPath)

**원격(클라이언트)**:  
- 그룹 정책으로 “Windows 원격 관리 서비스(WinRM)” 자동 시작/허용, “Event Forwarding” 대상 지정.

### 4.5 (선택) Sysmon 도입

- **장점**: 프로세스/네트워크/드라이버 로드/레지스트리 변경 등 상세 텔레메트리.
- **방법**: `Sysmon64.exe -i sysmon.xml` (구성 파일 필요)
- **권장**: 최소한 **Event ID 1(프로세스), 3(네트워크), 7(ImageLoad), 11(FileCreate)** 수집.

```xml
<!-- sysmon-min.xml (예시 일부) -->
<Sysmon schemaversion="4.50">
  <EventFiltering>
    <ProcessCreate onmatch="include">
      <CommandLine condition="contains">-enc</CommandLine>
    </ProcessCreate>
    <NetworkConnect onmatch="include">
      <DestinationPort condition="is">4444</DestinationPort>
    </NetworkConnect>
  </EventFiltering>
</Sysmon>
```

**검증**: 이벤트 뷰어 → “Applications and Services Logs/Microsoft/Windows/Sysmon/Operational”.

---

## 5) PowerShell 보안(실행 정책·로깅·JEA·원격)

### 5.1 실행 정책 & 스크립트 서명

```powershell
# 현재 정책 확인
Get-ExecutionPolicy -List

# 로컬 머신에 "AllSigned" 적용(모든 스크립트 서명 필요)
Set-ExecutionPolicy -Scope LocalMachine -ExecutionPolicy AllSigned -Force

# 자체 서명 인증서 생성(테스트 용도)
$cert = New-SelfSignedCertificate -DnsName "corp.example.com" -Type CodeSigningCert -CertStoreLocation "Cert:\CurrentUser\My"

# 스크립트 서명
Set-AuthenticodeSignature -FilePath .\Deploy-Safe.ps1 -Certificate $cert
```

> **팁**: 운영에서는 **사내 CA**를 통한 코드 서명 인증서 사용.

---

### 5.2 PowerShell 로깅(필수 3종)

- **Script Block Logging**: 런타임에 **해석된 스크립트 블록** 기록(난독화 완화).
- **Module Logging**: 로드되는 모듈/커맨드 기록.
- **Transcription**: 전체 콘솔 세션 **텍스트 기록**(누가/언제/어디서/무엇을).

```powershell
# 기본 경로
$base = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell"

# 1) Script Block Logging
New-Item -Path "$base\ScriptBlockLogging" -Force | Out-Null
Set-ItemProperty "$base\ScriptBlockLogging" -Name EnableScriptBlockLogging -Type DWord -Value 1

# 2) Module Logging(전체 모듈)
New-Item -Path "$base\ModuleLogging\ModuleNames" -Force | Out-Null
Set-ItemProperty "$base\ModuleLogging" -Name EnableModuleLogging -Type DWord -Value 1
New-ItemProperty "$base\ModuleLogging\ModuleNames" -Name "*" -PropertyType String -Value "*" -Force | Out-Null

# 3) Transcription
New-Item -Path "$base\Transcription" -Force | Out-Null
Set-ItemProperty "$base\Transcription" -Name EnableTranscripting -Type DWord -Value 1
Set-ItemProperty "$base\Transcription" -Name IncludeInvocationHeader -Type DWord -Value 1
Set-ItemProperty "$base\Transcription" -Name OutputDirectory -Type String -Value "C:\ProgramData\PS-Transcripts"
```

**검증**:  
- 이벤트 뷰어 → **Microsoft-Windows-PowerShell/Operational** 채널(스크립트 블록/모듈 이벤트).  
- `C:\ProgramData\PS-Transcripts`에 세션 로그 생성 확인.

---

### 5.3 JEA(Just Enough Administration) — “필요 최소 권한” 원격 작업

**상황**: 헬프데스크가 IIS 재시작만 할 수 있도록 제한.

1) **롤 능력(Role Capability) 파일** 작성:

```powershell
# C:\Program Files\WindowsPowerShell\Modules\HelpdeskJEA\RoleCapabilities\IISRestart.psrc
@{
    VisibleCmdlets = @(
        @{ Name = "Restart-Service"; Parameters = @{ Name = "Name"; ValidateSet = "W3SVC" } }
    )
}
```

2) **세션 설정(Session Configuration)**:

```powershell
# C:\ProgramData\JEA\Helpdesk.pssc
@{
    SessionType = "RestrictedRemoteServer"
    TranscriptDirectory = "C:\ProgramData\JEA-Transcripts"
    RunAsVirtualAccount = $true
    RoleDefinitions = @{
        "CORP\Helpdesk" = @{ RoleCapabilities = @("IISRestart") }
    }
}
```

3) **등록 & 사용**:

```powershell
Register-PSSessionConfiguration -Name "Helpdesk" -Path "C:\ProgramData\JEA\Helpdesk.pssc" -Force
# 원격에서:
Enter-PSSession -ComputerName Web01 -ConfigurationName Helpdesk -Credential CORP\help1
# 허용된 명령만 실행 가능: Restart-Service -Name W3SVC
```

---

### 5.4 WinRM/PowerShell Remoting 보안(HTTPS 권장)

```powershell
# 1) 자체 서명 서버 인증서(테스트)
$cert = New-SelfSignedCertificate -DnsName "web01.corp.example.com" -CertStoreLocation Cert:\LocalMachine\My

# 2) HTTPS 리스너 생성(5986)
winrm create winrm/config/Listener?Address=*+Transport=HTTPS "@{Hostname=`"web01.corp.example.com`"; CertificateThumbprint=`"$($cert.Thumbprint)`"}"

# 3) 약한 인증/암호화 비활성
Set-Item WSMan:\localhost\Service\AllowUnencrypted $false
Set-Item WSMan:\localhost\Service\Auth\Basic $false

# 4) 신뢰 호스트 최소화(필요 시)
Set-Item WSMan:\localhost\Client\TrustedHosts "bastion.corp.example.com"
```

**검증**: `Enter-PSSession -UseSSL -ComputerName web01.corp.example.com`.

---

### 5.5 AppLocker/WDAC로 스크립트/실행 통제

```powershell
# AppLocker 기본 규칙 생성(감사 → 점진 적용)
New-AppLockerPolicy -DefaultRule -XMLPolicy C:\Temp\applocker.xml
Set-AppLockerPolicy -XMLPolicy C:\Temp\applocker.xml -Merge

# 스크립트 규칙: 서명된 스크립트만 허용(경로/서명기반 규칙 구성은 GUI/GPO로 권장)
# 정책 적용 모드: 감사(AuditOnly)로 시작 → Enforced로 전환
```

> **WDAC**(Device Guard)는 **커널 수준** 허용 목록. 운영 전 파일 인벤토리/서명 체계 정비 필수.

---

## 6) 운영 시나리오

### 시나리오 A — “표준 워크스테이션 GPO” 롤아웃

1. OU 설계: `OU=Workstations\OU=HQ`, `OU=Workstations\OU=Remote`  
2. GPO: “WS-Baseline”  
   - UAC(EnableLUA=1, Secure Desktop=1)  
   - 고급 감사(프로세스/로그온/정책변경)  
   - PowerShell 3종 로깅  
   - Defender: PUA/Network Protection/Controlled Folder Access  
3. 파일럿 20대 → 오류/차단 앱 파악 → 예외 등록 → 전체 확산

**검증**:
```powershell
gpresult /r /scope computer
Get-MpComputerStatus | fl
Get-WinEvent -FilterHashtable @{LogName='Security';Id=4688} -MaxEvents 5
```

**롤백**: 링크 제거/보안 필터링 제외 → `gpupdate /force`.

---

### 시나리오 B — “서버(웹/IIS) 최소 권한 + 로깅”

1. 로컬 관리자에 운영팀만, 헬프데스크는 JEA로 `W3SVC` 재시작만.  
2. AppLocker: `C:\inetpub\wwwroot` 하위 스크립트 **서명/경로** 기반 허용.  
3. Defender: Controlled Folder Access로 `C:\inetpub\logs`, `C:\app\data` 보호.  
4. 감사: 4688 명령줄, 4663(로그 폴더 접근).

**핵심 스크립트 요약**: 위 섹션 3~5 참조.

---

### 시나리오 C — “이벤트 포워딩(WEF)로 집계 + 헌팅”

1. 수집기 서버에서 `wecutil qc / winrm quickconfig`.  
2. 구독: 보안 로그(4688/4624/4625/4672/1102), PowerShell Operational.  
3. 헌팅: 최근 24h에서 `-enc` 포함 프로세스, `rundll32` 네트워크 연결 등 탐지.

```powershell
$Start=(Get-Date).AddHours(-24)
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; StartTime=$Start} |
? { $_.Message -match "-enc" } | Select TimeCreated,Message

Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4688; StartTime=$Start} |
? { $_.Message -match "rundll32.exe" -and $_.Message -match " -url" } |
Select TimeCreated,Message
```

---

## 7) 체크리스트(점검표)

**정책/GPO**
- [ ] 로컬 정책 대신 **도메인 GPO**로 표준화  
- [ ] UAC **활성/보안 바탕화면**  
- [ ] 고급 감사(로그온/프로세스/정책/객체)  
- [ ] PowerShell 3종 로깅 + 중앙 수집(WEF)  
- [ ] Defender: 실시간/클라우드/PUA/네트워크 보호 **On**  
- [ ] Controlled Folder Access **운영 예외 포함**  
- [ ] (선택) ASR 규칙 **파일럿 → 확산**  
- [ ] AppLocker/WDAC **감사 → 강제** 단계적 전환  
- [ ] LAPS 도입(로컬 Admin 암호 순환)

**원격/운영**
- [ ] WinRM **HTTPS** + Basic/Unencrypted Off  
- [ ] Bastion 제어, `TrustedHosts` 최소화  
- [ ] JEA 적용(역할 기반 최소 권한)  
- [ ] 변경 전 백업/스냅샷 및 **롤백 절차 문서화**

---

## 8) 트러블슈팅 & 롤백

- **업무 앱 차단(Controlled Folder Access/ASR/AppLocker)**:  
  1) 이벤트 로그로 **차단 원인/경로** 확인 → 2) **서명/경로 예외** 추가 → 3) **감사 모드**로 재검증.  
  4) 일괄 예외 남발 금지(최소화).
- **로그 과다/디스크 압박**: 보존 기간/포워딩/압축/쿼리 최적화.  
- **UAC 프롬프트 과다**: 표준 사용자 워크플로 재설계, JEA/자동화로 관리자 작업 분리.
- **롤백 스니펫**:
```powershell
# Defender 기능 되돌리기(예)
Set-MpPreference -EnableControlledFolderAccess Disabled
Set-MpPreference -EnableNetworkProtection Disabled
Set-MpPreference -PUAProtection Disabled

# PowerShell 로깅 해제(테스트 환경에서만)
Remove-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Recurse -Force
Remove-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging" -Recurse -Force
Remove-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription" -Recurse -Force
```

---

## 9) 요약(암기 포인트)

- **도메인 GPO**로 표준화, **UAC On + Secure Desktop**, **Defender(클라우드/PUA/Network/CFA) On**  
- **고급 감사 + 명령줄**, **WEF 집계**, (선택) **Sysmon 보강**  
- **PowerShell**: AllSigned + 3종 로깅 + **JEA** + WinRM **HTTPS**  
- **AppLocker/WDAC**로 실행 제어, **LAPS**로 로컬 Admin 암호 순환

---

### 부록) 작은 템플릿 모음

**1) 고급 감사 일괄 적용(배치)**

```cmd
@echo off
for %%s in ("Process Creation","Process Termination","Logon","Policy Change","Account Lockout","Account Management","Object Access") do (
  auditpol /set /subcategory:%%s /success:enable /failure:enable
)
```

**2) Defender 신속 점검**

```powershell
Get-MpComputerStatus | Select AntivirusEnabled,RealTimeProtectionEnabled,IsTamperProtected,AMRunningMode,FullScanAge,QuickScanAge
Get-MpThreat | Sort-Object InitialDetectionTime -Descending | Select -First 5
```

**3) GPO 상태 리포트(요지)**

```powershell
gpresult /h C:\Temp\gp.html
Start-Process C:\Temp\gp.html
```