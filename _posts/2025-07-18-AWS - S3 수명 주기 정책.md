---
layout: post
title: AWS - S3 수명 주기 정책
date: 2025-07-18 18:20:23 +0900
category: AWS
---
# ⏳ S3 수명 주기 정책(Lifecycle Policy)으로 자동 스토리지 이동하기

---

## 🧭 개요

AWS S3의 수명 주기 정책(Lifecycle Policy)은 객체의 **나이(생성 후 경과 일수)에 따라 자동으로 스토리지 클래스를 변경**하거나  
**삭제(영구 삭제 또는 이전 버전 제거)**하는 기능입니다.

> 이를 통해 **스토리지 비용을 자동으로 최적화**할 수 있습니다.

---

## 📌 왜 필요한가요?

| 문제 | 수명 주기 정책으로 해결 |
|------|--------------------------|
| 오래된 로그가 계속 저장되어 비용 증가 | → 일정 기간 후 저렴한 Glacier로 이동 |
| 주기적으로 데이터를 수동 삭제해야 함 | → 자동 삭제 설정 |
| 수많은 S3 객체를 직접 관리해야 함 | → 자동화된 정책으로 관리 |

---

## 🔄 지원되는 동작

| 작업 | 설명 |
|------|------|
| **스토리지 클래스 이전** | 일정 경과 후 IA / Glacier로 자동 이동 |
| **객체 만료(삭제)** | 특정 일수가 지나면 자동 삭제 |
| **버전 관리 객체 만료** | 오래된 버전 객체만 제거 |
| **멀티파트 업로드 실패분 제거** | 완료되지 않은 업로드 파편 제거 |

---

## 🎯 예시 시나리오

| 경과일 | 작업 내용 |
|--------|-----------|
| 30일 경과 | Standard → Standard-IA로 이전 |
| 90일 경과 | Standard-IA → Glacier로 이전 |
| 365일 경과 | Glacier 객체 자동 삭제 |

---

## 🛠️ 설정 방법: AWS 콘솔

### 1. 버킷 선택 → **관리 → 수명 주기 규칙**

1. S3 콘솔 → 버킷 → **“관리” 탭 → “수명 주기 규칙 만들기”**
2. 규칙 이름 입력 (예: `MoveToGlacier`)
3. 적용 범위 설정
   - 전체 버킷 / 접두사(prefix) / 태그 기반 등 선택
4. 작업 구성

#### 예: 스토리지 이전 및 만료 설정

- ✅ 스토리지 클래스 이전
  - 30일 후: Standard → IA
  - 90일 후: IA → Glacier
- ✅ 객체 만료
  - 365일 후 삭제

5. 저장

---

## 🧾 설정 방법: JSON 수동 작성

### 예시 정책 (수명 주기 규칙 JSON)

```json
{
  "Rules": [
    {
      "ID": "ArchiveOldLogs",
      "Filter": {
        "Prefix": "logs/"
      },
      "Status": "Enabled",
      "Transitions": [
        {
          "Days": 30,
          "StorageClass": "STANDARD_IA"
        },
        {
          "Days": 90,
          "StorageClass": "GLACIER"
        }
      ],
      "Expiration": {
        "Days": 365
      }
    }
  ]
}
```

> `logs/` 폴더에 있는 객체들은 30일 후 IA, 90일 후 Glacier로 이전, 1년 후 삭제됩니다.

---

## 📂 기타 설정 옵션

### 🔹 다중 버전 관리 정책

버킷이 **버전 관리 활성화**된 경우:

- 최신 버전: 따로 보관
- 이전 버전: 자동 삭제 또는 이전

예시:

```json
"NoncurrentVersionTransitions": [
  {
    "NoncurrentDays": 30,
    "StorageClass": "GLACIER"
  }
],
"NoncurrentVersionExpiration": {
  "NoncurrentDays": 180
}
```

---

### 🔹 미완료 멀티파트 업로드 정리

```json
"AbortIncompleteMultipartUpload": {
  "DaysAfterInitiation": 7
}
```

> 7일 이상 업로드가 완료되지 않은 객체는 정리됩니다.

---

## 📊 실습 예시

### 1. 구조

```
my-logs-bucket/
├── logs/
│   ├── access_2024_01.log
│   ├── access_2024_02.log
```

### 2. 수명 주기 설정

- `logs/` 아래 객체
  - 30일 후 IA로
  - 90일 후 Glacier로
  - 365일 후 삭제

### 3. 설정 결과

| 날짜 | 상태 |
|------|------|
| 2025-01-01 | Standard |
| 2025-01-31 | IA |
| 2025-04-01 | Glacier |
| 2026-01-01 | 삭제 |

---

## ✅ 장점 요약

| 항목 | 설명 |
|------|------|
| 비용 절감 | 오래된 데이터 자동 이동/삭제로 요금 절감 |
| 자동화 | 관리 없이도 장기 보관 정책 적용 가능 |
| 설정 유연성 | 접두사, 태그 등 조건 기반 세분화 가능 |
| 버전 관리 호환 | 이전 버전 객체별 정책 설정 가능 |

---

## ⚠️ 주의사항

| 주의 | 설명 |
|------|------|
| 삭제된 객체는 복구 불가 | Glacier에 보관되기 전에 백업 고려 |
| 실수로 전체 삭제 가능 | 반드시 조건과 Prefix를 명확히 지정 |
| 버전 관리 시 정책 별도 설정 필요 | `NoncurrentVersion*` 필드 이용 |

---

## 📘 관련 서비스 연동

| 서비스 | 설명 |
|--------|------|
| **S3 Intelligent-Tiering** | 정책 없이도 자동 계층화 |
| **AWS Config + S3** | 객체 변경 이력 추적 |
| **S3 Lifecycle + CloudWatch** | 관리 알림과 함께 연동 가능 |

---

## 📎 요약

- 수명 주기 정책은 S3 객체를 조건에 따라 자동으로 **이전/삭제**하는 기능입니다.
- `Transition`, `Expiration`, `AbortMultipartUpload` 등을 조합하여 원하는 정책을 구성할 수 있습니다.
- 정기 백업, 로그 저장소, 문서 보관 등에서 매우 유용합니다.