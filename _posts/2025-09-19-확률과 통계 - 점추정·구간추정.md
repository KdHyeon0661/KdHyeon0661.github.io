---
layout: post
title: 확률과 통계 - 점추정·구간추정
date: 2025-09-19 21:25:23 +0900
category: 확률과 통계
---
# 7) 점추정·구간추정

> **목표**  
> - **점추정**의 3요소: **불편성(unbiasedness)** · **일치성(consistency)** · **효율성(efficiency)**을 직관과 함께 정리한다.  
> - **MLE(최대우도)** · **MME(적률법)**의 차이를 간단 예로 익힌다.  
> - **신뢰구간(CI)**을 안정적으로 잡는 법: **비율(전환율)**은 **Wilson**을 표준으로, **평균(DAU)**는 **t-구간**을 기본으로.  
> - **설계**: “전환율 오차 **±1pp**(±0.01)”를 달성하기 위한 **표본 크기 역산**을 케이스별로 제시한다(단일 비율, A/B 차이).

---

## 0) Hook — “숫자 하나로는 부족하다”
- CSV에서 뽑은 **CVR 추정치**가 3.1%라고 해서, **진짜 확률 p**가 정확히 3.1%라는 뜻은 아니다.  
- **점추정**은 “한 점”이고, **구간추정**은 “그 점이 얼마나 불확실한지”를 **확률**이 아닌 **반복실험 해석**으로 알려준다.  
- 실무에서 의사결정은 **(추정치 ± 오차)**로 내려진다. 이 장에서 오차의 **의미·계산·설계**를 끝낸다.

---

## 1) 점추정(Point Estimation): 개념과 성질

### 1.1 점추정의 정의
- 모수 $$\theta$$(예: 전환확률 p, 평균 DAU의 모평균 $$\mu$$)에 대해, 데이터 $$X$$에서 계산되는 **함수** $$\hat\theta(X)$$가 **점추정량**.

### 1.2 좋은 추정량의 3요소
1) **불편성**: $$E[\hat\theta]=\theta$$  
   - 예: 이항에서 $$\hat p=X/n$$ 는 불편. 정규모집단의 평균 $$\bar X$$도 불편.  
2) **일치성**: 표본 크기 $$n\to\infty$$일 때 $$\hat\theta \xrightarrow{p} \theta$$(확률수렴).  
   - 대부분의 “합리적인” 추정량은 약한 조건에서 일치함.  
3) **효율성**: 분산이 작다(정확하다). 보통 **MSE** $$=\mathrm{Var}(\hat\theta)+\mathrm{Bias}(\hat\theta)^2$$를 작게.

> **메모**: 불편이 아주 작고 분산이 크게 줄어들면, **약간의 편향을 허용**한 추정이 실무적으로 더 낫다(예: Agresti–Coull, 정규화된 베이지안 추정 등).

---

## 2) MLE vs MME(적률법) — 간단 비교

### 2.1 베르누이/이항에서의 전환율 p
- **모형**: $$X\sim \mathrm{Bin}(n,p)$$, 로그우도  
  $$
  \ell(p;X)=\log \binom{n}{X}+X\log p+(n-X)\log(1-p)
  $$
- **MLE**: 도함수 0 → $$\widehat p_{\mathrm{MLE}}=X/n$$(=표본비율).  
- **MME**: 1차 적률 $$E[X]=np\Rightarrow \hat p_{\mathrm{MME}}=X/n$$.  
→ 이 경우 **MLE=MME** 일치.

### 2.2 정규에서 평균과 분산
- $$X_i\stackrel{i.i.d.}{\sim}\mathcal{N}(\mu,\sigma^2)$$  
- **MLE**: $$\hat\mu=\bar X,\ \hat\sigma^2=\frac{1}{n}\sum (X_i-\bar X)^2$$(분모 n)  
- **불편 추정량**(MME/표준): $$S^2=\frac{1}{n-1}\sum (X_i-\bar X)^2$$  
→ **불편성**이 중요할 땐 $$S^2$$, **최우추정**은 분모 n. 대표본에서는 차이가 작다.

> **현실 조언**: 평균은 $$\bar X$$로, 분산은 **불편** $$S^2$$로 보고한다. 회귀·최우추정 내부 계산은 MLE 관례를 쓰되, 리포트는 불편/강건 추정으로 표준화.

---

## 3) 신뢰구간(CI) — “오차 막대”의 뜻

### 3.1 빈도주의 신뢰구간의 정의
- **95% CI**는 “**반복 표본추출**을 무한히 반복했을 때, **그 절차가 생성한 구간의 95%가** 진짜 모수 $$\theta$$를 포함한다”는 의미.  
- **주의**: 특정 데이터로 얻은 **이번 구간**이 $$\theta$$를 포함할 **확률 95%**라는 뜻이 아니다(베이즈가 아니라 빈도주의 해석).

### 3.2 표준 형태
- 평균(σ 미지): **t-구간**  
  $$
  \bar X \pm t_{1-\alpha/2,\ n-1}\cdot \frac{S}{\sqrt{n}}
  $$
- 비율(단일 p):  
  - **Wald(정규근사)**: $$\hat p \pm z\sqrt{\frac{\hat p(1-\hat p)}{n}}$$  
  - **Wilson**: (권장, 아래 4절)  
- 차이(두 비율): z-구간 또는 Newcombe/Wilson 차이 등.

---

## 4) 전환율(CVR) 신뢰구간 — **Wilson**을 표준으로

### 4.1 왜 Wilson인가?
- **Wald**는 ① 표본이 작거나 ② $$\hat p$$가 0/1 근처일 때 **빈번히 커버리지 실패**(너무 낙관).  
- **Wilson**(Score CI)은 **작은 표본·희귀 사건**에서 더 안정적으로 목표 커버리지를 달성.

### 4.2 Wilson 95% CI 공식
- $$z=z_{0.975}\approx 1.96$$, $$\hat p=X/n$$.  
- 중심과 반폭:
$$
\tilde p=\frac{\hat p+\frac{z^2}{2n}}{1+\frac{z^2}{n}},\qquad
\tilde m=\frac{z}{1+\frac{z^2}{n}}\sqrt{\frac{\hat p(1-\hat p)}{n}+\frac{z^2}{4n^2}}.
$$
- **구간**: $$[\tilde p-\tilde m,\ \tilde p+\tilde m]$$.

### 4.3 수치 예 (희귀·작은 표본)
- $$n=200,\ X=6\Rightarrow \hat p=0.03$$  
- **Wald**:  
  $$
  \hat p\pm z\sqrt{\hat p(1-\hat p)/n}=0.03\pm 1.96\sqrt{0.03\cdot 0.97/200}\approx 0.03\pm 0.0236
  $$
  → [0.0064, 0.0536]  
- **Wilson**:  
  $$
  \tilde p\approx \frac{0.03+1.96^2/(400)}{1+1.96^2/200}\approx 0.0397,\quad
  \tilde m\approx 0.0206
  $$
  → **[0.0191, 0.0603]**  
- **해석**: Wilson 구간이 **0/1 경계 근처에서 왜곡을 덜** 일으킨다(실제 커버리지 더 정확).

### 4.4 극단 케이스 (성공 0건)
- $$X=0$$일 때 **Wald**는 하한=0, 상한도 지나치게 낮음.  
- **Clopper–Pearson(정확)** 또는 **Wilson**이 안전.  
  - Clopper–Pearson은 **보수적**(구간이 넓은 경향). 실무 표준은 **Wilson**.

---

## 5) 평균(DAU, 세션시간 등)의 신뢰구간 — t-구간

### 5.1 DAU 평균의 CI
- 관측치 $$X_1,\dots,X_n$$, 표본평균 $$\bar X$$, 표준편차 $$S$$.  
- **95% CI**:
$$
\bar X \pm t_{0.975,\ n-1}\cdot \frac{S}{\sqrt{n}}
$$
- **n≥30**이면 $$t\approx z$$. 그러나 **heavy-tail**일수록 **부트스트랩 CI** 병행 권장.

### 5.2 수치 예
- 30일치 DAU(일별 사용자수)의 평균이 1,200,000, 표준편차 90,000이라면  
  $$
  \mathrm{SE}=90{,}000/\sqrt{30}\approx 16{,}432
  $$
  $$
  t_{0.975,29}\approx 2.045 \Rightarrow CI:\ 1{,}200{,}000\pm 33{,}600 \ \ (\text{대략 }[1.166M,\ 1.234M])
  $$

### 5.3 비정규/꼬리 대책
- **로그척도** $$Y=\log(1+X)$$에서 t-구간 후 **역변환 보정**(델타법)  
- **부트스트랩**: 퍼뮤테이션/블록부트스트랩으로 커버리지 보완.

---

## 6) 효율성(Efficiency)와 정보 — 한 페이지 요약

### 6.1 정보와 Cramér–Rao 하한(CRLB)
- 우도 $$L(\theta;X)$$, 로그우도 $$\ell(\theta)$$, 피셔 정보:
  $$
  \mathcal{I}(\theta)=E\!\left[-\frac{\partial^2}{\partial\theta^2}\ell(\theta)\right]
  $$
- **CRLB**: 어떤 불편 추정량도  
  $$
  \mathrm{Var}(\hat\theta)\ge \frac{1}{\mathcal{I}(\theta)}
  $$
- **MLE**는 대표본에서 **최소분산**(효율적) 달성(정규근사 하에서).

### 6.2 비율에서의 정보
- 이항 $$\mathrm{Bin}(n,p)$$의 정보: $$\mathcal{I}(p)=\frac{n}{p(1-p)}$$  
- **표준오차(SE)**: $$\sqrt{p(1-p)/n}$$. **n**이 커질수록 급격히 감소.

---

## 7) 설계: “전환율 오차 ±1pp”를 위한 **표본 크기 역산**

> 목표: **95% 신뢰구간 반경**(Half-width) **≤ 0.01**.  
> 설계에 쓸 **보수적** 접근과 **파일럿 기반** 접근을 구분한다.  

### 7.1 단일 비율(전환율 p)의 n (Wald 근사식)
- **공식**:  
  $$
  m=\text{허용 오차 반경}=\ 0.01,\quad z=1.96
  $$
  $$
  n \approx \frac{z^2\,p^*(1-p^*)}{m^2}
  $$
  - **보수적**: 최악은 $$p^*=0.5$$ → 분산 최댓값.  
  - **파일럿**: 기존/사전 실험에서 본 $$\hat p$$ 값을 $$p^*$$로.

- **보수적 계산(최악 케이스)**  
  $$
  n \approx \frac{1.96^2\times 0.25}{0.01^2}=\frac{3.8416\times 0.25}{0.0001}\approx 9604
  $$
  → **9,604 노출**이면 어떤 p에서도 ±1pp 달성이 **거의** 가능(단, Wilson 기준으로는 약간 더 여유 필요).

- **파일럿 기반(예: p*=0.03)**  
  $$
  n \approx \frac{1.96^2\times 0.03\times 0.97}{0.01^2}\approx \frac{3.8416\times 0.0291}{0.0001}\approx 1119
  $$
  → **약 1,120 노출**로 ±1pp 달성 가능(단일 집단, 대략치).  
  **Wilson 기준**으로 재평가하면 보통 **비슷하거나 약간 더 큼**.

> **주의**: p가 아주 작으면(예: 0.3%) “±1pp”는 **상대 오차**로 매우 큼. 목표 자체가 불합리할 수 있어 **상대 오차(상대 CI 폭)** 기준을 고려.

### 7.2 A/B에서 **차이(Δ=p_B − p_A)**의 n (대칭, 95%)
- 목표: **Half-width(오차 반경)** ≤ 0.01(=1pp), **각 팔 n 동일**.  
- **보수적**(p_A ≈ p_B ≈ 0.5):  
  $$
  \mathrm{SE}(\hat\Delta)=\sqrt{\frac{p(1-p)}{n}+\frac{p(1-p)}{n}}=\sqrt{\frac{2p(1-p)}{n}}
  $$
  $$
  1.96\cdot \sqrt{\frac{2\cdot 0.25}{n}} \le 0.01 \Rightarrow n \ge \frac{1.96^2\cdot 0.5}{0.0001}\approx 38{,}416
  $$
  → 한 팔 **약 38.4k**(매우 보수적).  
- **파일럿**(예: p≈0.03):  
  $$
  \mathrm{SE}(\hat\Delta)\approx \sqrt{\frac{0.03\cdot 0.97}{n}+\frac{0.03\cdot 0.97}{n}}=\sqrt{\frac{0.0582}{n}}
  $$
  $$
  1.96\sqrt{0.0582/n}\le 0.01 \Rightarrow n\ge \frac{(1.96)^2\cdot 0.0582}{0.0001}\approx 2230
  $$
  → 한 팔 **약 2,230**로 95% CI 반경 **1pp** 달성.

> **Power(검정력)**를 함께 고려할 때는  
> $$n_{\text{per arm}}\approx \frac{\big(z_{1-\alpha/2}\sqrt{2\bar p(1-\bar p)}+z_{1-\beta}\sqrt{p_A(1-p_A)+p_B(1-p_B)}\big)^2}{\Delta^2}$$  
> 를 사용(여기서는 **오차 반경** 설계가 주제라 간략화).

### 7.3 평균(DAU)의 오차 ±M을 위한 n
- **t-구간 근사**: $$\mathrm{SE}=S/\sqrt{n},\ \text{Half-width}=t_{0.975,n-1}\cdot S/\sqrt{n}\approx z\cdot S/\sqrt{n}$$  
  $$
  n \approx \left(\frac{z\,S}{M}\right)^2
  $$
- 예: **M=20,000 DAU**, 과거 표준편차 $$S\approx 100{,}000$$  
  $$
  n\approx (1.96\times 100{,}000/20{,}000)^2=(9.8)^2\approx 96
  $$
  → 약 **96일**이면 ±2만 DAU 오차 달성(변동성 가정에 따라 달라짐).

---

## 8) 실전 보고: CI 문장 패턴(비율·평균)

### 8.1 비율(CVR)
- “**B**의 전환율은 **3.1%**이고, **Wilson 95% CI: [2.5%, 3.8%]**.”  
- “A–B 차이는 **+0.30pp**, **95% CI: [+0.12pp, +0.48pp]** (비율의 비율 기반).”

### 8.2 평균(DAU/세션시간)
- “최근 30일 **평균 DAU 1.20M**, **t-95% CI: [1.166M, 1.234M]**.”  
- heavy-tail 지표: “세션시간 **중앙값 45s [IQR 18–120]**, **평균 68±34s**, 95p 260s.”

> **원칙**: “추정치 ± 오차(또는 구간)”을 **항상** KPI와 함께 표기. 비율은 **Wilson**을 선호, 평균은 **t-구간**+**강건 요약** 병기.

---

## 9) 구현 스니펫(개념용): Wilson, t-CI, 표본 크기 역산
```python
# 개념 확인용: 실무는 검증된 라이브러리 사용 권장

import math
from typing import Tuple

def ci_wilson(x: int, n: int, alpha: float = 0.05) -> Tuple[float, float]:
    # Wilson score interval for a binomial proportion
    if n <= 0:
        raise ValueError("n must be positive")
    z = 1.96 if abs(alpha - 0.05) < 1e-9 else abs(math.erfcinv(alpha)*math.sqrt(2))  # rough
    phat = x / n
    denom = 1 + (z**2)/n
    center = (phat + (z**2)/(2*n)) / denom
    radius = (z / denom) * math.sqrt((phat*(1-phat)/n) + (z**2)/(4*n**2))
    return max(0.0, center - radius), min(1.0, center + radius)

def ci_t(mean: float, s: float, n: int, alpha: float = 0.05) -> Tuple[float, float]:
    # t-interval; here we approximate t by z if n is large
    if n <= 1: raise ValueError("n must be > 1")
    z = 1.96 if n >= 60 else 2.045  # crude: 95% for df≈29
    se = s / math.sqrt(n)
    return mean - z*se, mean + z*se

def n_for_prop_moe(m: float, p_star: float = 0.5, alpha: float = 0.05) -> int:
    # Wald-based ballpark n for half-width m at (1-alpha) level
    z = 1.96 if abs(alpha - 0.05) < 1e-9 else abs(math.erfcinv(alpha)*math.sqrt(2))
    return math.ceil((z**2 * p_star*(1-p_star)) / (m**2))

def n_per_arm_for_diff_moe(m: float, p_star: float, alpha: float = 0.05) -> int:
    # Half-width m for difference of two equal-sized groups, ballpark
    z = 1.96 if abs(alpha - 0.05) < 1e-9 else abs(math.erfcinv(alpha)*math.sqrt(2))
    return math.ceil((z**2 * 2*p_star*(1-p_star)) / (m**2))

# 예시:
# 1) Wilson CI for x=6, n=200
print("Wilson 95% CI (x=6,n=200):", ci_wilson(6,200))
# 2) DAU mean CI (mean=1.2e6, s=9e4, n=30)
print("t 95% CI for mean:", ci_t(1_200_000, 90_000, 30))
# 3) n for ±1pp at p*=0.03
print("n (±1pp, p* = 0.03):", n_for_prop_moe(0.01, 0.03))
# 4) n per arm for difference ±1pp at p*≈0.03
print("n/arm (±1pp, p* = 0.03):", n_per_arm_for_diff_moe(0.01, 0.03))
```

---

## 10) 실무 함정과 처방

1) **Wald 남용**  
   - 표본 작음/희귀사건/극단 비율에서 **과도한 낙관**(커버리지↓).  
   - **대안**: **Wilson**(단일 비율), **Newcombe**(두 비율), **정확(Clopper–Pearson)**(아주 작은 n).

2) **분모 랜덤성 무시**(비율의 비율)  
   - 일별 CTR 평균의 단순 평균은 **가중치 무시** → 오차 추정 왜곡.  
   - **대안**: 총합 기반 비율 + **델타법**으로 SE.

3) **heavy-tail 평균에 정규근사 과신**  
   - 평균에 극단값 민감 → 구간 덜 신뢰.  
   - **대안**: **부트스트랩 CI** 병행, **중앙값·분위** 병기, **로그척도**.

4) **자기상관 무시**  
   - 일별/주별 연속 실험에서 독립 가정 깨짐 → SE 과소.  
   - **대안**: **블록 부트스트랩**, 블록(캠페인/주) 단위 추정.

5) **±1pp 목표의 상대성 문제**  
   - p가 1~3%면 ±1pp는 **상대오차 33~100%**.  
   - **대안**: **상대 오차**(±r%) 또는 **비율의 로그**로 목적 재정의.

---

## 11) 연습문제(정답 스케치 포함)

**[1] Wilson vs Wald**  
- $$n=400,\ X=8$$. Wilson과 Wald 95% CI를 구하고 폭을 비교하라.  
- *스케치*: Wilson이 보통 약간 더 넓고 경계 근처에서 안정.

**[2] DAU 평균 CI**  
- 21일 평균 1.05M, 표준편차 140k. t-95% CI를 계산하라.  
- *스케치*: SE=140k/√21 ≈ 30.6k, t≈2.086 → ±63.8k.

**[3] n 역산(단일 비율)**  
- p*=0.05, ±1pp, 95%에서 필요한 n은?  
- *스케치*: n≈ (1.96^2·0.05·0.95)/0.0001 ≈ 1825.

**[4] n 역산(두 비율 차이)**  
- p≈0.04, ±1pp(차이) 95% 반경에서 한 팔 n은?  
- *스케치*: n≈ (1.96^2·2·0.04·0.96)/0.0001 ≈ 1505.

---

## 12) 한 페이지 요약 (TL;DR)
- **점추정**: 불편·일치·효율. MLE는 대표본에서 **효율적**, MME는 단순하고 종종 동일(이항 p).  
- **비율 CI**는 **Wilson**을 표준으로(작은 n, 경계에서도 안정). **Wald**는 큰 n/중간 p에서만.  
- **평균 CI**는 **t-구간**, heavy-tail이면 **부트스트랩** 병행.  
- **±1pp 설계**: 단일 비율 $$n\approx z^2 p^*(1-p^*)/m^2$$, 두 비율 차이는 **2배 항** 포함.  
- **리포팅 규칙**: “추정치 ± 오차(또는 CI)”를 **항상** KPI와 함께, 비율은 **비율의 비율**, 평균은 **강건 요약** 병기.
