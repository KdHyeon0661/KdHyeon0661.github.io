---
layout: post
title: 정보보안기사 - 라우터와 접근제어
date: 2025-11-12 13:25:23 +0900
category: 정보보안기사
---
# SECTION 06 라우터 보안 — 02. 라우터와 접근제어(ACL) 완전 정리 (IPv4/IPv6 ACL, iACL/VACL/rACL, 시간·객체·시퀀스, 하드웨어/TCAM, 설계·배치·검증, Cisco/JunOS/Linux 예제)

## 개요 — 왜 ACL인가

ACL(Access Control List)은 라우터(또는 L3 스위치)가 **들어오고 나가는 패킷을 규칙 기반으로 허용/차단**하는 가장 기본적인 보안 메커니즘이다.
- **적용 위치**: 인터페이스(In/Out), 루프백(lo0), VTY(원격접속), 관리 플레인 보호(MPP의 근간), NAT·PBR의 트래픽 선택 조건.
- **동작 원리**: 규칙 순서대로 매칭 → **첫 매칭 규칙의 결과**(permit/deny) 적용 → **암묵적 `deny any`**.
- **보안 목표**: 관리 경로 보호(SSH/SNMP/NETCONF), 제어 평면 보호(BGP/OSPF 수신 제한), 데이터 평면에서 **인프라 대상(iACL)** 최소 허용.

> 핵심 원칙
> 1) **기본 거부(deny-all) + 명시적 허용**
> 2) **관리·제어·데이터 플레인 분리** 후 각각에 맞는 ACL
> 3) **가시성(카운터/로그)** 확보와 **점진적 적용(캔어리, 시퀀스)**

---

## ACL 분류와 개념
### Standard vs Extended(IPv4)

- **Standard ACL**: **출발지 IP**만 기준(예: `access-list 10 permit 10.10.0.0 0.0.255.255`).
- **Extended ACL**: **출발지/목적지 IP + L4 포트/프로토콜**(TCP/UDP/ICMP 등)까지 매칭.

### Named vs Numbered

- **Numbered**: 예전 방식(예: 1–99 standard, 100–199 extended).
- **Named**: 가독성/유지보수 용이(시퀀스 번호·주석·부분 수정 가능). **실무 권장**.

### IPv6 ACL

- 문법이 약간 다르며 **ICMPv6(Neighbor Discovery/PMTUD)** 필수 허용 항목 존재.
- 적용은 `ipv6 traffic-filter <ACL> in|out`.

### iACL / rACL / VACL 개념

- **iACL(Infra ACL)**: “라우터 자신” 또는 인프라 주소 대역을 향하는 트래픽만 최소 허용하고 나머지 차단(엣지 inbound).
- **rACL(Receive ACL)**: 제어/관리 트래픽이 **라우팅 엔진으로 올라가기 전**에 제한(플랫폼 종속).
- **VACL/VACL-CAP**: L2 도메인 내 특정 트래픽을 VLAN 레벨에서 필터링(주로 스위치 측).

---

## Wildcard(IPv4)와 Prefix(IPv6) — 정확히 매칭하기

**IPv4 Wildcard**는 네트마스크의 비트 반전 값이다. 네트마스크를 \(M\)이라 할 때 와일드카드 \(W\)는
$$
W = 255.255.255.255 - M.
$$

- 예: `/24 (255.255.255.0)` → `0.0.0.255`
- 예: 특정 호스트 10.10.10.5 → `10.10.10.5 0.0.0.0`
- 예: 짝수/홀수 호스트 매칭 등 고급 패턴(비트마스크 기반)도 가능

**IPv6**는 프리픽스 표기로 단순하게 표현한다(예: `2001:db8:10::/64`).

---

## 설계 원칙 — 올바른 배치와 튜닝
### 배치 가이드

- **Extended ACL은 가능한 “소스에 가깝게”**: 불필요 트래픽 초기에 차단(대역폭/CPU 절약).
- **관리/인프라 보호 ACL은 “엣지 inbound”**: 라우터 자신(루프백/인터페이스 IP)으로 향하는 트래픽을 최소 허용.
- **VTY/VTY ACL**: 원격 로그인은 관리망에서만 허용.
- **대칭성 고려**(Stateless): 세션 허용 시, **응답 트래픽도 허용**해야 함(TCP flag/포트 범위 명시 또는 상태 기반 솔루션 병행).

### 운영 테크닉

- **시퀀스 번호**로 부분 수정(`10,20,30...`) → **hitless 업데이트**.
- **time-range**로 시간대 ACL(야간 차단·점검 창구).
- **객체 그룹(벤더 의존)**: 다수의 IP/포트를 그룹화해 가독성 향상.
- **로그 제한**: `log`/`log-input`는 꼭 필요한 룰에만(과도 로깅은 CPU/메모리 부담).

---

## 자주 쓰는 “허용/차단” 패턴 표

| 목적 | 권장 규칙(의미) |
|---|---|
| PMTUD/진단 | `permit icmp ... unreachable`, `time-exceeded`, `echo-reply` |
| BGP 피어 | `permit tcp <peer-ip> host <router-ip> eq 179` |
| 관리면 | `permit tcp <mgmt-subnet> host <router-ip> eq 22/443/830` |
| 기본 차단 | `deny ip any host <router-ip> log` (iACL의 마지막) |
| IPv6 필수 | `permit icmpv6 any any nd-na/nd-ns/ra/rs/packet-too-big` 등 |

> 참고: **ICMP/ICMPv6를 과하게 막지 않는다.** PMTUD 실패, ND 실패로 “느리고 불안정한” 네트워크가 된다.

---

## 패킷 경로(단순화) — ACL은 어디서 작동하나

```
[Ingress Port]
   ↓ (iACL / Interface ACL - in)
[Route Lookup / CEF]
   ↓
[QoS/Policing (플랫폼 의존)]
   ↓
[Interface ACL - out]
   ↓
[Egress Port]
```
※ 실제 순서는 플랫폼·기능 조합(CoPP, ZBF, NAT 등)에 따라 달라질 수 있다. **벤더별 Order-of-Operations** 문서를 병행 확인.

---

## Cisco IOS/XE — IPv4 Extended iACL 실전
### 토폴로지

```
Internet ---[Gi0/0 R1]--- Corp
Loopback0(203.0.113.1) = 라우터 식별자(피어/관리 트래픽 대상)
Mgmt Subnet = 10.100.0.0/24
BGP Peer    = 198.51.100.2
```

### iACL 정의(주석/시퀀스/로그 활용)

```cisco
ip access-list extended EDGE-iACL
  remark === Allow management from MGMT ===
  10 permit tcp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 22
  20 permit tcp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 443
  30 permit udp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 161

  remark === Allow BGP peer ===
  40 permit tcp host 198.51.100.2 host 203.0.113.1 eq 179

  remark === PMTUD/Diagnostics (필요한 ICMP만) ===
  50 permit icmp any host 203.0.113.1 echo-reply
  60 permit icmp any host 203.0.113.1 time-exceeded
  70 permit icmp any host 203.0.113.1 unreachable

  remark === Default deny for router IP ===
  100 deny ip any host 203.0.113.1 log
```

### 인터페이스에 적용(inbound)

```cisco
interface GigabitEthernet0/0
 ip access-group EDGE-iACL in
```

### 운영 팁

```cisco
! 카운터/히트 확인
show access-lists EDGE-iACL
! 시퀀스 재정렬(추가가 잦을 때)
ip access-list resequence EDGE-iACL 10 10
```

---

## Cisco — VTY ACL & 관리면 제한

```cisco
ip access-list standard ACL-MGMT-VTY
  permit 10.100.0.0 0.0.0.255
  deny any

line vty 0 4
 access-class ACL-MGMT-VTY in
 transport input ssh
 exec-timeout 5 0
 login local
```
- **VTY ACL**: 원격 로그인은 **관리망에서만** 허용.
- `exec-timeout`/로그인 제한으로 브루트포스 방지.

---

## Cisco — NAT/PBR에서의 ACL 활용(선택자)
### NAT(오버로드) 트래픽 정의

```cisco
ip access-list extended NAT-INSIDE
  permit ip 10.10.0.0 0.0.255.255 any
!
ip nat inside source list NAT-INSIDE interface GigabitEthernet0/0 overload
```
- ACL은 NAT “대상 트래픽 선택”에 사용(보안 ACL과 목적 다름).

### PBR(Policy-Based Routing) 트래픽 정의

```cisco
ip access-list extended PBR-WEB
  permit tcp 10.10.10.0 0.0.0.255 any eq 80
!
route-map PBR-OUT permit 10
  match ip address PBR-WEB
  set ip next-hop 192.0.2.10
!
interface GigabitEthernet0/1
 ip policy route-map PBR-OUT
```
- ACL을 **route-map**의 match로 사용해 특정 트래픽만 다른 차선으로 보냄.

---

## Cisco — IPv6 ACL & ND/PMTUD 허용

```cisco
ipv6 access-list V6-iACL
  remark Allow management to router
  10 permit tcp 2001:db8:100:0::/64 host 2001:db8::1 eq 22
  20 permit tcp 2001:db8:100:0::/64 host 2001:db8::1 eq 443

  remark Allow BGP from peer
  30 permit tcp host 2001:db8:ffff::2 host 2001:db8::1 eq 179

  remark ICMPv6 필수 (ND/PMTUD)
  40 permit icmpv6 any any nd-na
  50 permit icmpv6 any any nd-ns
  60 permit icmpv6 any any router-advertisement
  70 permit icmpv6 any any router-solicitation
  80 permit icmpv6 any any packet-too-big
  90 permit icmpv6 any any time-exceeded

  100 deny ipv6 any host 2001:db8::1 log
!
interface GigabitEthernet0/0
 ipv6 traffic-filter V6-iACL in
```

---

## Juniper JunOS — Firewall Filter(=ACL) 기본
### 인프라 보호(루프백 lo0 수신 보호)

```junos
set firewall family inet filter PROTECT-LO0 term MGMT from source-address 10.100.0.0/24
set firewall family inet filter PROTECT-LO0 term MGMT from protocol tcp destination-port [22 443 830]
set firewall family inet filter PROTECT-LO0 term MGMT then accept

set firewall family inet filter PROTECT-LO0 term BGP from source-address 198.51.100.2/32
set firewall family inet filter PROTECT-LO0 term BGP from protocol tcp destination-port 179
set firewall family inet filter PROTECT-LO0 term BGP then accept

set firewall family inet filter PROTECT-LO0 term PMTUD from protocol icmp icmp-type [echo-reply time-exceeded destination-unreachable]
set firewall family inet filter PROTECT-LO0 term PMTUD then accept

set firewall family inet filter PROTECT-LO0 term DEFAULT then discard
set interfaces lo0 unit 0 family inet filter input PROTECT-LO0
```

### 인터페이스 인바운드 iACL(데이터 평면)

```junos
set firewall family inet filter EDGE-iACL term ALLOW-SPECIFIC from source-address 0.0.0.0/0
set firewall family inet filter EDGE-iACL term ALLOW-SPECIFIC from destination-address 203.0.113.1/32
set firewall family inet filter EDGE-iACL term ALLOW-SPECIFIC from protocol tcp destination-port 179
set firewall family inet filter EDGE-iACL term ALLOW-SPECIFIC then accept
set firewall family inet filter EDGE-iACL term DEFAULT then discard
set interfaces ge-0/0/0 unit 0 family inet filter input EDGE-iACL
```

> JunOS는 **term 순서**대로 매칭하고 `then accept/discard`를 적용한다. **`count`/`policer`/`syslog`** 동작을 term에 부여해 가시성·제어를 높일 수 있다.

---

## Linux Router — nftables로 iACL/관리면 보호

```bash
# 관리망(10.100.0.0/24)에서만 SSH 허용, BGP 피어만 179 허용, 기본 Drop

nft add table inet filter
nft add chain inet filter input { type filter hook input priority 0; policy drop; }
nft add rule inet filter input ct state established,related accept
nft add rule inet filter input iif "lo" accept

# mgmt

nft add rule inet filter input ip saddr 10.100.0.0/24 tcp dport {22,443} accept

# BGP to router IP(203.0.113.1)

nft add rule inet filter input ip saddr 198.51.100.2 tcp dport 179 ip daddr 203.0.113.1 accept

# PMTUD/진단

nft add rule inet filter input icmp type { echo-reply, time-exceeded, destination-unreachable } accept

# 나머지 drop(이미 policy drop)

```
- Linux는 **상태기반(conntrack)** 을 쉽게 활용 가능. 단, 라우터로서의 역할 시 **입력 체인(input)** 은 “**라우터 자신**”으로 향하는 트래픽만 처리한다는 점을 유념(전달 통제는 `forward` 체인).

---

## 시간/객체/시퀀스 — 운영 편의 기능
### time-range (Cisco 예)

```cisco
time-range NIGHT-BLOCK
 periodic daily 22:00 to 06:00

ip access-list extended SVC-WINDOW
  10 deny tcp any any eq 22 time-range NIGHT-BLOCK
  20 permit ip any any
```

### 객체 그룹(지원 플랫폼에서)

- 네트워크 묶음: `object-group network MGMT-NETS`
- 서비스 묶음: `object-group service MGMT-SVC tcp` → `port-object eq 22`, `eq 443`
- ACL에서 `permit tcp object-group MGMT-NETS host 203.0.113.1 object-group MGMT-SVC`

### 시퀀스/리시퀀스

```cisco
ip access-list extended EDGE-iACL
  15 permit tcp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 830
ip access-list resequence EDGE-iACL 10 10
```

---

## 검증·가시성 — 카운터·로그·패킷 캡처

- **히트 카운터**: `show access-lists <ACL>` / JunOS `show firewall` / nft `nft list ruleset`
- **선택 로그**: `log`/`log-input`(Cisco), `then syslog`(JunOS). 과도 로깅은 금지.
- **패킷 캡처**(Cisco IOS-XE EPC):
```cisco
monitor capture CAP interface Gig0/0 both access-list EDGE-iACL
monitor capture CAP start
! ... 테스트 ...
monitor capture CAP stop
monitor capture CAP export tftp://10.100.30.30/edge-iacl.pcap
```

---

## 트러블슈팅 — 전형적 원인과 대처

- **의도치 않은 차단**: 규칙 순서/암묵 deny 확인, PMTUD/ICMP 허용 누락 여부 점검.
- **관리면 접속 불가**: VTY ACL 또는 iACL이 과도 제한, 관리 VRF 경로 문제.
- **BGP 세션 flap**: iACL/CoPP가 179/TCP 핸드셰이크 차단, ICMP 불가로 PMTUD 실패.
- **카운터 증가 불가**: ACL 방향(in/out) 오적용, 다른 기능(ZBF, IPS, rACL)에 의해 먼저 차단.

---

## 변경 절차(무중단/롤백 고려)

1) **드라이런**: 새 ACL을 작성하되 인터페이스에 적용하지 않고 카운터/문법 확인.
2) **캔어리 룰**: 상단에 일시 `permit + log` 룰로 실제 트래픽 패턴 관찰 후 확정.
3) **적용 시퀀스**: ACL 완성 → 인터페이스에 **한 번에 적용**(시퀀스 번호로 사전 정렬).
4) **롤백 플랜**: `no ip access-group ...` 또는 직전 ACL로 즉시 복원.
5) **사후 검증**: 모니터링 지표(세션/에러/MTU/핸드셰이크)와 로그 확인.

---

## 실습 시나리오 — “엣지 iACL + 관리/제어 보호” 종합

1) **iACL 작성**: 라우터 IP로 향하는 불필요 트래픽 차단, 관리망/BGP/ICMP만 허용.
2) **VTY ACL**: 관리망만 SSH, `exec-timeout` 5분.
3) **IPv6 iACL**: ND/PMTUD 필수 허용 추가.
4) **적용**: 엣지 인터페이스 inbound, lo0 입력 필터(JunOS).
5) **검증**: BGP 안정/관리 접속/PMTUD 동작 확인, 카운터/로그 점검.
6) **정리**: 리시퀀스, 주석 보강, 변경 이력 저장.

---

## 자주 묻는 질문(실기 포인트)

- **Q. “ICMP을 막으면 안전한가?”**
  A. 아니오. PMTUD·오류 통지·진단에 필수. 필요한 타입만 **정밀 허용**이 정답.
- **Q. “in vs out 어디에 적용하나?”**
  A. 일반적으로 **inbound**가 유리(불필요 트래픽 초기에 drop). 단, 트래픽 흐름과 기능 조합을 고려.
- **Q. “Stateful이 아닌데 응답은?”**
  A. Stateless ACL은 응답 흐름을 별도로 허용해야 한다(예: TCP established 패턴/포트 범위).
- **Q. “NAT/PBR ACL과 보안 ACL 차이?”**
  A. NAT/PBR의 ACL은 **“트래픽 선택자”**일 뿐 보안 차단 목적이 아니다. 혼동 금지.

---

## 체크리스트(요약)

- [ ] **Named Extended ACL** 사용, 주석/시퀀스 관리
- [ ] **iACL**: 라우터 자신(루프백/인터페이스 IP) 대상 트래픽 최소 허용
- [ ] **VTY ACL**: 관리망만, 시간 제한/로그인 보호
- [ ] **ICMP/ICMPv6 필수 타입 허용**(PMTUD/ND)
- [ ] **BGP/OSPF**: 피어 IP·포트만 허용(179/TCP, OSPF, BFD 등)
- [ ] **IPv6**: `ipv6 traffic-filter` + ND/PMTUD 항목 점검
- [ ] **로그/가시성**: 필요 룰만 `log`, 과도 로깅 금지
- [ ] **변경 절차**: 드라이런 → 캔어리 → 적용 → 모니터링 → 리시퀀스

---

## 부록 — 예제 모음(스니펫)

### Cisco: “관리망 외엔 라우터로 SSH 금지”

```cisco
ip access-list extended SSH-RTR
  10 permit tcp 10.100.0.0 0.0.0.255 host 203.0.113.1 eq 22
  20 deny tcp any host 203.0.113.1 eq 22 log
interface Gig0/0
 ip access-group SSH-RTR in
```

### JunOS: firewall filter 카운트/폴리싱

```junos
set firewall policer POL-SSH if-exceeding bandwidth-limit 64k burst-size-limit 8k
set firewall family inet filter PROTECT-LO0 term SSH from protocol tcp destination-port 22
set firewall family inet filter PROTECT-LO0 term SSH then policer POL-SSH
set firewall family inet filter PROTECT-LO0 term SSH then count CNT-SSH
set firewall family inet filter PROTECT-LO0 term SSH then accept
```

### Linux(nft): 세트·로깅 예

```bash
nft add set inet filter mgmt_subnets { type ipv4_addr; flags interval; }
nft add element inet filter mgmt_subnets { 10.100.0.0/24, 10.100.10.0/24 }
nft add rule inet filter input ip saddr @mgmt_subnets tcp dport 22 counter accept
nft add rule inet filter input tcp dport 22 log prefix "DROP-SSH " counter drop
```

---

## 정리

- ACL은 라우터 보안의 **제1 방어선**이다.
- **iACL + VTY ACL + (필요한 ICMP/ICMPv6 허용)**만으로도 관리/제어/데이터 플레인의 위험을 큰 폭으로 줄인다.
- **가시성(카운터/로그)**을 확보하고 **시퀀스/객체/시간** 기능으로 **안전한 변경**을 수행하라.
- NAT/PBR/라우팅 보호(CoPP/프로토콜 인증)와 함께 **레이어드 보안**으로 완성도를 높여라.
