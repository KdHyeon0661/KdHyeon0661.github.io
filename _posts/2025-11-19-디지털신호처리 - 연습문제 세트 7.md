---
layout: post
title: 디지털신호처리 - 연습문제 세트 7
date: 2025-11-19 16:25:23 +0900
category: 디지털신호처리
---
# IIR 필터 설계 실전 연습문제

## 공통 준비: Octave 환경/유틸

모든 실험은 GNU Octave + signal 패키지를 기준으로 한다.

```octave
pkg load signal;
```

디지털 주파수 표기 통일:

- 샘플링 주파수 $$F_s$$ [Hz]
- 아날로그 각주파수 $$\Omega$$ [rad/s]
- 디지털 각주파수 $$\omega$$ [rad/sample]
- 주파수 변환( bilinear prewarp ):
  $$
  \omega = 2\pi\frac{f}{F_s},\quad
  \Omega = \frac{2}{T}\tan\left(\frac{\omega}{2}\right),\quad T=\frac{1}{F_s}
  $$

주파수 응답 확인:

```octave
function plot_resp(b, a, Fs, title_str)
  Nfft = 4096;
  [H, f] = freqz(b, a, Nfft, Fs);
  figure;
  plot(f, 20*log10(abs(H)+eps), "LineWidth", 1.2);
  grid on;
  xlabel("Frequency (Hz)"); ylabel("Magnitude (dB)");
  title(title_str);
end
```

---

## — 연습문제 + 풀이

### 문제 1-1. 디지털 스펙을 “정규화 주파수”로 변환하라

**상황**: 48 kHz 오디오 시스템에서 IIR 저역통과 필터를 설계하려고 한다.
**스펙**:

- $$F_s = 48000\ \mathrm{Hz}$$
- 통과대역 경계: $$F_p = 5000\ \mathrm{Hz}$$
- 저지대역 경계: $$F_s = 8000\ \mathrm{Hz}$$
- 통과대역 리플: $$A_p = 1\ \mathrm{dB}$$
- 저지대역 감쇠: $$A_s = 60\ \mathrm{dB}$$

**요구**:

1. 디지털 각주파수 $$\omega_p, \omega_s$$를 구하라.
2. “정규화 주파수” $$W_p, W_s$$ (Nyquist=1 기준)로 변환하라.

**풀이**:

1) 디지털 각주파수:

$$
\omega_p = 2\pi\frac{F_p}{F_s}
=2\pi\frac{5000}{48000}
$$

분수 계산:

- $$5000/48000 = 5/48 \approx 0.1041667$$
- $$\omega_p \approx 2\pi\cdot 0.1041667 \approx 0.6545\ \mathrm{rad/sample}$$

같은 방식으로

$$
\omega_s = 2\pi\frac{8000}{48000}
=2\pi\cdot\frac{1}{6}
= \frac{\pi}{3} \approx 1.0472
$$

2) 정규화 주파수 (Nyquist = $$F_s/2$$):

$$
W_p = \frac{F_p}{F_s/2}=\frac{5000}{24000}\approx 0.20833
$$

$$
W_s = \frac{F_s}{F_s/2}=\frac{8000}{24000}\approx 0.33333
$$

**Octave 검증**:

```octave
Fs = 48000; Fp=5000; Fs2=8000;
wp = 2*pi*Fp/Fs;
ws = 2*pi*Fs2/Fs;

Wp = Fp/(Fs/2);
Ws = Fs2/(Fs/2);

printf("wp=%.4f rad/sample, ws=%.4f rad/sample\n", wp, ws);
printf("Wp=%.5f, Ws=%.5f (normalized)\n", Wp, Ws);
```

---

### 문제 1-2. bilinear 변환에서 prewarp된 아날로그 경계를 구하라

문제 1-1의 $$F_p, F_s$$에 대해, bilinear 변환 사용 시 prewarp된 아날로그 각주파수 $$\Omega_p, \Omega_s$$를 구하라.

**풀이**:

bilinear 주파수 사상:

$$
\Omega = \frac{2}{T}\tan\left(\frac{\omega}{2}\right),\quad T=\frac{1}{F_s}
$$

즉

$$
\Omega = 2F_s\tan\left(\frac{\omega}{2}\right)
$$

- $$\omega_p \approx 0.6545$$ 이므로
  $$
  \Omega_p = 2F_s\tan(0.6545/2)
  = 96000\tan(0.32725)
  $$

- $$\tan(0.32725)\approx 0.3385$$ (계산기 수준 근사)

따라서

$$
\Omega_p \approx 96000\cdot 0.3385 \approx 32496\ \mathrm{rad/s}
$$

- $$\omega_s \approx 1.0472$$
  $$
  \Omega_s = 96000\tan(0.5236)
  $$

- $$\tan(0.5236)=\tan(\pi/6)=1/\sqrt{3}\approx 0.57735$$

따라서

$$
\Omega_s \approx 96000\cdot 0.57735\approx 55426\ \mathrm{rad/s}
$$

**Octave 검증**:

```octave
Fs=48000; T=1/Fs;
Fp=5000; Fs2=8000;
wp=2*pi*Fp/Fs; ws=2*pi*Fs2/Fs;

Op = (2/T)*tan(wp/2);
Os = (2/T)*tan(ws/2);

printf("Op=%.1f rad/s, Os=%.1f rad/s\n", Op, Os);
```

---

### 문제 1-3. 안정성(BIBO)과 극점 위치

**상황**: 다음 IIR 필터의 분모가

$$
A(z)=1-1.8z^{-1}+0.81z^{-2}
$$

일 때,

1. 극점을 구하고
2. 필터가 안정한지 판정하라.

**풀이**:

극점은 $$A(z)=0$$의 해.
$$z^{-1}$$ 형태를 제거하려면:

$$
z^2 -1.8z +0.81=0
$$

이는

$$
(z-0.9)^2=0
$$

따라서 극점은

$$
z_1=z_2=0.9
$$

극점의 크기:

$$
|z|=0.9<1
$$

모두 단위원 안 → **안정**.

**Octave 검증**:

```octave
a = [1 -1.8 0.81];
p = roots(a);
disp(p);
printf("max |p| = %.3f\n", max(abs(p)));
```

---

## — 연습문제 + 풀이

### 문제 2-1. 60 Hz 전원 잡음 제거용 Notch IIR 설계

**상황**: 생체 신호(ECG/EMG)에서 60 Hz 전원 잡음을 제거해야 한다.
**스펙**:

- $$F_s = 1000\ \mathrm{Hz}$$
- notch 중심: 60 Hz
- notch 폭: ±1 Hz 정도에서 −30 dB 이상
- 통과대역 왜곡은 최소

**요구**:

1. 2차 notch IIR을 pole-zero 방식으로 설계하라.
2. Octave로 응답을 확인하라.

**풀이 개념**:

디지털 노치 필터의 표준 pole-zero 배치:

- 영점: 단위원 위, $$\omega_0$$에 위치
  $$z = e^{\pm j\omega_0}$$
- 극점: 반지름 $$r<1$$로 안쪽에 동일 각도로 배치
  $$z = r e^{\pm j\omega_0}$$

이때 전송함수:

$$
H(z)=\frac{1-2\cos\omega_0 z^{-1}+z^{-2}}
          {1-2r\cos\omega_0 z^{-1}+r^2 z^{-2}}
$$

여기서

$$
\omega_0 = 2\pi\frac{60}{1000}=0.12\pi \approx 0.37699
$$

노치 폭을 약 ±1 Hz로 하려면 r을 0.98~0.995 정도로 선택(폭 좁을수록 r↑).

여기서는 $$r=0.99$$로 시작.

**Octave 설계/검증**:

```octave
pkg load signal; clear; close all; clc;

Fs = 1000;
f0 = 60;
w0 = 2*pi*f0/Fs;
r  = 0.99;

b = [1 -2*cos(w0) 1];
a = [1 -2*r*cos(w0) r^2];

plot_resp(b, a, Fs, "2nd-order Notch at 60 Hz (r=0.99)");
```

**해석**:

- 60 Hz 근처에서 깊은 노치(저지)가 생기며
- r이 1에 가까울수록 노치가 좁고 깊다.
- 통과대역은 거의 평탄(PEQ처럼 동작).

---

### 문제 2-2. All-pass로 위상만 바꾸는 필터 만들기

**상황**: 오디오에서 크기는 유지하면서 위상/군지연을 조절하려 한다.
**요구**:

1. 다음 형태의 1차 all-pass가 정말 all-pass인지 증명하라.
   $$
   H(z)=\frac{a + z^{-1}}{1 + a z^{-1}},\quad |a|<1
   $$
2. $$a=0.6$$일 때 군지연이 저주파에서 증가하는지 확인하라.

**풀이**:

1) all-pass 증명은
$$|H(e^{j\omega})|=1$$
임을 보이면 된다.

$$
H(e^{j\omega})=\frac{a+e^{-j\omega}}{1+a e^{-j\omega}}
$$

분자·분모에 $$e^{j\omega}$$를 곱해

$$
H(e^{j\omega})=\frac{ae^{j\omega}+1}{e^{j\omega}+a}
$$

여기서 분자의 켤레는 분모와 동일:

$$
ae^{j\omega}+1 = (e^{j\omega}+a)^\*
$$

따라서

$$
|H|^2=\frac{(ae^{j\omega}+1)(ae^{-j\omega}+1)}{(e^{j\omega}+a)(e^{-j\omega}+a)}=1
$$

2) 군지연:

군지연은
$$
\tau_g(\omega) = -\frac{d}{d\omega}\angle H(e^{j\omega})
$$

직접 미분은 번거롭지만, Octave로 확인 가능.

```octave
pkg load signal; clear; close all; clc;
a = 0.6;
b = [a 1];
A = [1 a];

[H, w] = freqz(b, A, 4096);
phi = unwrap(angle(H));
tg = -diff(phi)./diff(w);      % numerical group delay
w_mid = (w(1:end-1)+w(2:end))/2;

figure;
plot(w_mid/pi, tg, "LineWidth", 1.2);
grid on;
xlabel("Normalized frequency (×π rad/sample)");
ylabel("Group delay (samples)");
title("1st-order all-pass group delay (a=0.6)");
```

저주파에서 군지연이 더 크게 나타나는지를 그래프로 관찰하면 된다.

---

## 원형 아날로그 필터의 특성 — 연습문제 + 풀이

### 문제 3-1. Butterworth, Chebyshev I, Elliptic의 차수 비교

**상황**: 아날로그 저역통과 필터 스펙:

- 통과대역 경계: $$\Omega_p = 1\ \mathrm{rad/s}$$
- 저지대역 경계: $$\Omega_s = 2\ \mathrm{rad/s}$$
- $$A_p = 1\ \mathrm{dB}$$
- $$A_s = 60\ \mathrm{dB}$$

**요구**:

1. Butterworth, Chebyshev I, Elliptic 각각의 최소 차수 $$N$$을 Octave로 구하라.
2. 왜 Elliptic이 가장 낮은 차수가 되는지 설명하라.

**풀이**:

Octave에서

- Butterworth 차수: `buttord`
- Chebyshev I 차수: `cheb1ord`
- Elliptic 차수: `ellipord`

아날로그 모드(주파수는 rad/s 그대로):

```octave
pkg load signal; clear; clc;

Op = 1; Os = 2;
Ap = 1; As = 60;

[Nb, Wnb] = buttord(Op, Os, Ap, As, "s");
[Nc, Wnc] = cheb1ord(Op, Os, Ap, As, "s");
[Ne, Wne] = ellipord(Op, Os, Ap, As, "s");

printf("Butterworth N=%d\n", Nb);
printf("Chebyshev I  N=%d\n", Nc);
printf("Elliptic     N=%d\n", Ne);
```

**해석**:

- Butterworth: 통과대역 리플 없음, 저지대역 단조 감소 → 전이대역이 상대적으로 넓어 **차수가 커짐**
- Chebyshev I: 통과대역 등리플 허용 → 전이대역이 좁아져 **차수 감소**
- Elliptic: 통과/저지 모두 등리플 허용 → **가장 가파른 전이대역** → **최소 차수**

---

### 문제 3-2. 아날로그 프로토타입의 극점 배치 관찰

Butterworth 차수 $$N=5$$ 프로토타입의 극점이 어떻게 배치되는지 구하고,
체비셰프 I $$N=5, A_p=1$$의 극점과 비교해라.

```octave
pkg load signal; clear; close all; clc;

N=5; Ap=1;

[bb, ab] = buttap(N);
[bc, ac] = cheb1ap(N, Ap);

pb = roots(ab); pc = roots(ac);

figure;
plot(real(pb), imag(pb), "bx", "MarkerSize", 8); hold on;
plot(real(pc), imag(pc), "ro", "MarkerSize", 8);
grid on; axis equal;
xlabel("Re(s)"); ylabel("Im(s)");
title("Analog prototype poles: Butterworth vs Chebyshev I");
legend("Butterworth", "Chebyshev I");
```

**관찰 포인트**:

- Butterworth 극점은 **단위원(좌반평면)의 동일 반지름 원 위에 균일 분포**
- Chebyshev I은 통과대역 리플을 만들기 위해
  - 극점이 **x축 방향으로 더 안쪽/바깥쪽으로 찌그러진 타원 배치**
  - 일부 극점이 단위원보다 더 바깥(더 큰 Q)으로 가서 전이대역을 급격히 만든다.

---

## 아날로그-디지털 필터 변환 — 연습문제 + 풀이

### 문제 4-1. impulse invariance vs bilinear: 왜곡 비교

**상황**: 아날로그 2차 저역통과 필터

$$
H_a(s)=\frac{1}{s^2+\sqrt{2}s+1}
$$

를 $$F_s=8000\ \mathrm{Hz}$$로 디지털화한다.

**요구**:

1. impulse invariance로 얻은 디지털 필터 계수를 구하고 응답을 그려라.
2. bilinear 변환으로 얻은 디지털 필터와 비교하라.
3. 두 방식의 장단점을 설명하라.

**풀이**:

1) impulse invariance는

- 아날로그 임펄스 응답을 샘플링하여 Z화.
- Octave 함수 `impinvar` 사용.

2) bilinear는 `bilinear` 사용.

```octave
pkg load signal; clear; close all; clc;

Fs = 8000;
Ba = [1];
Aa = [1 sqrt(2) 1];

% 1) impulse invariance
[bi, ai] = impinvar(Ba, Aa, Fs);

% 2) bilinear
[bb, ab] = bilinear(Ba, Aa, Fs);

% 3) 비교
Nfft=4096;
[Hi, f] = freqz(bi, ai, Nfft, Fs);
[Hb, ~] = freqz(bb, ab, Nfft, Fs);

figure;
plot(f, 20*log10(abs(Hi)+eps), "b", "LineWidth", 1.2); hold on;
plot(f, 20*log10(abs(Hb)+eps), "r--", "LineWidth", 1.2);
grid on;
xlabel("Frequency (Hz)"); ylabel("Magnitude (dB)");
title("Impulse invariance vs Bilinear");
legend("impinvar", "bilinear");
ylim([-80 5]); xlim([0 Fs/2]);
```

**해석**:

- impulse invariance:
  - 고주파 성분이 Nyquist 밖에서 **aliasing**되어 접혀 들어옴 → 왜곡 가능
  - 저역통과에서 **아날로그 응답을 저주파 대역에서 잘 보존**
- bilinear:
  - aliasing 없음
  - 대신 주파수 축이 **워핑(warping)**됨 → prewarp로 해결
  - 대부분의 IIR 설계에서 **표준 선택**

---

### 문제 4-2. bilinear 주파수 워핑 수치 확인

**상황**: bilinear 변환의 주파수 사상

$$
\Omega = \frac{2}{T}\tan\left(\frac{\omega}{2}\right)
$$

을 이용해, $$F_s=48000\ \mathrm{Hz}$$에서

- $$f=1000\ \mathrm{Hz}$$
- $$f=15000\ \mathrm{Hz}$$

가 각각 어떤 아날로그 각주파수로 매핑되는지 구하고,
워핑 정도가 어디서 심한지 설명하라.

**풀이**:

- $$\omega=2\pi f/F_s$$로 계산 후 대입.

Octave:

```octave
Fs=48000; T=1/Fs;
f_list = [1000 15000];
for f = f_list
  w = 2*pi*f/Fs;
  O = (2/T)*tan(w/2);
  printf("f=%5d Hz -> Omega=%.1f rad/s\n", f, O);
end
```

**해석**:

- 저주파(1000 Hz)일수록 $$\tan(\omega/2)\approx \omega/2$$로 거의 선형 → 워핑 작음
- 고주파(15000 Hz)일수록 tan 비선형이 커짐 → 워핑 심함
- 그래서 **경계 주파수는 반드시 prewarp**해서 맞춰야 한다.

---

## GNU Octave로 IIR 저역통과 필터 설계 — 연습문제 + 풀이

### 문제 5-1. Butterworth 디지털 LPF 설계(차수 자동)

문제 1-1의 스펙으로 Butterworth IIR LPF를 설계하고,
차수/응답을 확인하라.

**풀이**:

```octave
pkg load signal; clear; close all; clc;

Fs = 48000;
Fp = 5000; Fs2 = 8000;
Ap = 1; As = 60;

Wp = Fp/(Fs/2);
Ws = Fs2/(Fs/2);

[N, Wn] = buttord(Wp, Ws, Ap, As);
[b, a] = butter(N, Wn);

printf("Butterworth order N=%d, Wn=%.4f\n", N, Wn);
plot_resp(b, a, Fs, "Butterworth IIR Lowpass");
```

**검증**:

- 통과대역 5 kHz까지 −1 dB 이내인지
- 저지대역 8 kHz 이상에서 −60 dB 이하인지 그래프로 확인.

---

### 문제 5-2. Chebyshev I과 Elliptic로 같은 스펙 구현

문제 5-1과 동일 스펙을

1. Chebyshev I
2. Elliptic

으로 설계하고, 차수/응답/전이대역을 비교하라.

```octave
pkg load signal; clear; close all; clc;

Fs=48000; Fp=5000; Fs2=8000; Ap=1; As=60;
Wp=Fp/(Fs/2); Ws=Fs2/(Fs/2);

[Nc, Wnc] = cheb1ord(Wp, Ws, Ap, As);
[bc, ac]  = cheby1(Nc, Ap, Wnc);

[Ne, Wne] = ellipord(Wp, Ws, Ap, As);
[be, ae]  = ellip(Ne, Ap, As, Wne);

printf("Cheb1 N=%d, Ellip N=%d\n", Nc, Ne);

plot_resp(bc, ac, Fs, "Chebyshev I Lowpass");
plot_resp(be, ae, Fs, "Elliptic Lowpass");
```

**해석 포인트**:

- Cheb1: 통과대역에 등리플
- Ellip: 통과/저지 모두 등리플 → 가장 낮은 차수, 가장 급격한 전이
- 실무에서 “최소 차수 or 급격 전이”가 필요하면 Ellip이 자주 최종 선택.

---

### 문제 5-3. SOS(2차 섹션)로 안정적인 구현

문제 5-2의 Elliptic 필터를 SOS로 변환하고,
Direct Form과 SOS의 수치 차이를 비교하라.

```octave
pkg load signal; clear; close all; clc;

Fs=48000; Fp=5000; Fs2=8000; Ap=1; As=60;
Wp=Fp/(Fs/2); Ws=Fs2/(Fs/2);

[Ne, Wne] = ellipord(Wp, Ws, Ap, As);
[be, ae]  = ellip(Ne, Ap, As, Wne);

[sos, g] = tf2sos(be, ae);

% Direct Form vs SOS 응답 비교
Nfft=4096;
[Hdf, f] = freqz(be, ae, Nfft, Fs);
[Hsos,~] = freqz(sos, g, Nfft, Fs);

figure;
plot(f, 20*log10(abs(Hdf)+eps), "b", "LineWidth", 1.2); hold on;
plot(f, 20*log10(abs(Hsos)+eps), "r--", "LineWidth", 1.2);
grid on;
xlabel("Frequency (Hz)"); ylabel("Magnitude (dB)");
title("Direct Form vs SOS");
legend("Direct Form", "SOS");
ylim([-80 5]); xlim([0 Fs/2]);
```

**해석**:

- 이상적인 부동소수점에서는 거의 동일.
- 고정소수점/양자화 환경에서 SOS가 훨씬 안정적.
- 따라서 “고차 IIR”은 실무에서 **SOS 캐스케이드 + 스케일링**이 표준이다.

---

## 주파수 대역 변환 — 연습문제 + 풀이

### 문제 6-1. 디지털 BP IIR을 “LP 프로토타입 + LP→BP + bilinear”로 직접 설계

**상황**: 디지털 대역통과 필터 스펙:

- $$F_s=48000\ \mathrm{Hz}$$
- 통과대역: 4 kHz ~ 8 kHz
- 저지대역: 3 kHz 이하, 9 kHz 이상
- $$A_p=1\ \mathrm{dB},\ A_s=60\ \mathrm{dB}$$
- 프로토타입: Butterworth

**요구**:

1. prewarp로 아날로그 경계 $$\Omega_{p1},\Omega_{p2}$$를 구하라.
2. 저역통과 원형 Butterworth 프로토타입을 만든 뒤
3. LP→BP 변환을 수행하고
4. bilinear로 디지털 BP를 얻어라.
5. Octave의 `butter(...,"bandpass")` 결과와 비교하라.

**풀이**:

1) prewarp:

$$
\Omega_{pi} = 2F_s\tan\left(\frac{\omega_{pi}}{2}\right),
\quad \omega_{pi} = 2\pi\frac{F_{pi}}{F_s}
$$

2) 대역통과 중심/대역폭:

$$
\Omega_0 = \sqrt{\Omega_{p1}\Omega_{p2}},\quad
B = \Omega_{p2}-\Omega_{p1}
$$

3) 원형 LP 프로토타입:

`buttap(N)`.

4) LP→BP:

`lp2bp`.

5) bilinear:

`bilinear`.

전체 Octave:

```octave
pkg load signal; clear; close all; clc;

Fs=48000; T=1/Fs;
Fp1=4000; Fp2=8000;
Fs1=3000; Fs2=9000;
Ap=1; As=60;

% (1) digital -> prewarped analog
wp1 = 2*pi*Fp1/Fs; wp2 = 2*pi*Fp2/Fs;
ws1 = 2*pi*Fs1/Fs; ws2 = 2*pi*Fs2/Fs;

Op1 = (2/T)*tan(wp1/2);
Op2 = (2/T)*tan(wp2/2);
Os1 = (2/T)*tan(ws1/2);
Os2 = (2/T)*tan(ws2/2);

O0 = sqrt(Op1*Op2);
B  = Op2 - Op1;

% (2) analog LP prototype order estimate
% 통상은 analog LP로 스펙 변환 후 buttord를 쓰지만,
% 여기서는 예시로 N=4 가정
N=4;

[Ba, Aa] = buttap(N);

% (3) LP -> BP in analog
[Bbp, Abp] = lp2bp(Ba, Aa, O0, B);

% (4) bilinear -> digital BP
[bd, ad] = bilinear(Bbp, Abp, Fs);

% (5) direct digital butter bandpass
Wp = [Fp1 Fp2]/(Fs/2);
[bb, ab] = butter(N, Wp, "bandpass");

% compare responses
Nfft=4096;
[H1, f] = freqz(bd, ad, Nfft, Fs);
[H2,~]  = freqz(bb, ab, Nfft, Fs);

figure;
plot(f, 20*log10(abs(H1)+eps), "b", "LineWidth", 1.2); hold on;
plot(f, 20*log10(abs(H2)+eps), "r--", "LineWidth", 1.2);
grid on;
xlabel("Frequency (Hz)"); ylabel("Magnitude (dB)");
title("Explicit LP->BP->bilinear vs butter bandpass");
legend("Explicit", "butter");
ylim([-80 5]); xlim([0 Fs/2]);
```

**해석**:

- `butter(...,"bandpass")`는 내부적으로 거의 같은 절차를 수행한다.
- “직접 파이프라인 구현”은
  - prewarp에 대한 감각
  - LP→BP 변환의 차수 증가/대역폭 영향
  - bilinear 워핑 대응
  을 확실히 체득하게 해준다.

---

### 문제 6-2. LP→HP 변환으로 디지털 고역통과 IIR 설계

**상황**:

- $$F_s=16000\ \mathrm{Hz}$$
- 원하는 HPF:
  - 통과대역 시작: 3000 Hz (−1 dB 이내)
  - 저지대역 끝: 2000 Hz (−50 dB 이하)
- 프로토타입: Chebyshev I

**요구**:

1. prewarp로 아날로그 경계 $$\Omega_p,\Omega_s$$를 구하라.
2. Chebyshev I 저역통과 프로토타입을 만든 뒤
3. LP→HP 변환 후 bilinear로 디지털 HPF를 얻어라.
4. 응답 확인.

**풀이 Octave**:

```octave
pkg load signal; clear; close all; clc;

Fs=16000; T=1/Fs;
Fp=3000; Fs2=2000;
Ap=1; As=50;

wp = 2*pi*Fp/Fs;
ws = 2*pi*Fs2/Fs;

Op = (2/T)*tan(wp/2);
Os = (2/T)*tan(ws/2);

% analog LP prototype order
[N, Wn] = cheb1ord(Op, Os, Ap, As, "s");
[Ba, Aa] = cheb1ap(N, Ap);

% LP -> HP analog
[Bhp, Ahp] = lp2hp(Ba, Aa, Wn);

% bilinear to digital HP
[b, a] = bilinear(Bhp, Ahp, Fs);

printf("Cheb1 HP order N=%d\n", N);
plot_resp(b, a, Fs, "Chebyshev I Highpass via LP->HP->bilinear");
```

**포인트**:

- HPF는 LPF보다 워핑 영향을 더 크게 받기 쉬움
- prewarp가 없으면 컷오프가 눈에 띄게 어긋난다.

---

## 종합 실전 문제(한 번에 전체 연결)

### 문제 7-1. “원형 아날로그 → 대역 변환 → bilinear → SOS 구현” 전체 설계

**상황**: 서브우퍼/저역 음향을 제외한 **음성 대역(300~3400 Hz)**만 통과시키는 디지털 BPF가 필요하다.
**스펙**:

- $$F_s=16000\ \mathrm{Hz}$$ (전화/VoIP 표준)
- 통과대역: 300~3400 Hz
- 저지대역:
  - 0~200 Hz에서 −60 dB
  - 4000 Hz 이상에서 −60 dB
- 통과대역 리플 $$A_p=1\ \mathrm{dB}$$
- 저지대역 감쇠 $$A_s=60\ \mathrm{dB}$$
- 프로토타입: Elliptic (최소 차수)

**요구**:

1. digital 스펙을 각주파수로 변환
2. prewarp
3. 아날로그 LP 프로토타입 차수 추정
4. LP→BP 변환
5. bilinear로 디지털 BPF
6. SOS로 변환해 구현
7. 테스트 신호(음성대역 톤+저역/고역 잡음)에 적용해 통과/저지 확인

**풀이 Octave(완전 스크립트)**:

```octave
pkg load signal; clear; close all; clc;

Fs=16000; T=1/Fs;
Fp1=300; Fp2=3400;
Fs1=200; Fs2=4000;
Ap=1; As=60;

% 1) digital -> omega
wp1=2*pi*Fp1/Fs; wp2=2*pi*Fp2/Fs;
ws1=2*pi*Fs1/Fs; ws2=2*pi*Fs2/Fs;

% 2) prewarp
Op1=(2/T)*tan(wp1/2); Op2=(2/T)*tan(wp2/2);
Os1=(2/T)*tan(ws1/2); Os2=(2/T)*tan(ws2/2);

O0=sqrt(Op1*Op2); B=Op2-Op1;

% 3) LP prototype order by elliptic (analog domain)
% bandpass specs -> equivalent analog LP specs:
% For elliptic order, use ellipord on digital normalized first (simpler check)
Wp=[Fp1 Fp2]/(Fs/2);
Ws=[Fs1 Fs2]/(Fs/2);
[Nd, Wnd] = ellipord(Wp, Ws, Ap, As);

% analog LP prototype with cutoff=1
[Ba, Aa] = ellipap(Nd, Ap, As);

% 4) LP -> BP analog
[Bbp, Abp] = lp2bp(Ba, Aa, O0, B);

% 5) bilinear to digital
[b, a] = bilinear(Bbp, Abp, Fs);

% 6) SOS
[sos, g] = tf2sos(b, a);

% 7) response
plot_resp(b, a, Fs, "Voice-band Elliptic BPF (digital)");

% test signal
N=Fs*2; n=0:N-1; t=n/Fs;
x = 0.8*sin(2*pi*1000*t) ...     % in-band
  + 0.6*sin(2*pi*100*t) ...      % low freq
  + 0.6*sin(2*pi*6000*t);        % high freq

y = sosfilt(sos, x)*g;

% show spectra
X = fft(x.*hann(N)');
Y = fft(y.*hann(N)');
f = (0:N-1)*Fs/N;

figure;
plot(f(1:N/2), 20*log10(abs(X(1:N/2))+eps), "b"); hold on;
plot(f(1:N/2), 20*log10(abs(Y(1:N/2))+eps), "r");
grid on; xlabel("Hz"); ylabel("dB");
title("Input vs Output spectrum");
legend("Input", "Output");
xlim([0 8000]);
```

**해석 체크리스트**:

- 출력 스펙트럼에서
  - 1000 Hz 성분은 남고
  - 100 Hz, 6000 Hz 성분은 크게 줄어야 한다.
- SOS 필터(`sosfilt`)가 Direct Form보다 안전하다.

---

## 전체 요약

1. **예비 사항** 문제로
   - 디지털 스펙 → 정규화/각주파수
   - bilinear prewarp
   - 안정성(극점) 판정
   를 계산/코딩으로 체득했다.

2. **특수 필터 유형**으로
   - notch, all-pass처럼 실무에서 자주 끼워 넣는 IIR 구조를 pole-zero 관점에서 설계했다.

3. **원형 아날로그 필터** 문제로
   - Butterworth/ Chebyshev/ Elliptic의 차수-전이대역-리플 트레이드오프와
   - 프로토타입 극점 배치의 차이를 직접 봤다.

4. **아날로그-디지털 변환**에서
   - impulse invariance의 aliasing
   - bilinear의 warping/prewarp
   를 실제 응답 비교로 확인했다.

5. **GNU Octave 저역통과 설계**로
   - `buttord/butter`, `cheb1ord/cheby1`, `ellipord/ellip`
   - 고차 필터의 SOS 구현
   을 실전 루틴처럼 다뤘다.

6. **주파수 대역 변환** 문제로
   - LP 프로토타입을 기반으로 HP/BP/BS를 직접 구성하는 “전체 파이프라인”을 완성했다.

이제 남은 단계는,
각 문제의 스펙/상황을 본인이 다루는 실제 신호(센서, 음성, 통신, 제어)에 맞게 바꿔서
**스스로 스펙을 설정하고 → 차수를 고르고 → 구현/SOS/양자화까지 검증하는 루프**를 돌리는 것이다.
