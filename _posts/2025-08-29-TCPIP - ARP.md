---
layout: post
title: TCPIP - ARP
date: 2025-08-29 19:25:23 +0900
category: TCPIP
---
# TCP/IP 주소 변환 프로토콜 (ARP) 및 네트워크 인터페이스 계층 연결

## ARP 개요, 표준 및 역사

주소 결정 프로토콜(Address Resolution Protocol, ARP)은 TCP/IP 네트워크에서 **논리적 주소(IP 주소)를 물리적 주소(MAC 주소)로 변환**하는 핵심 프로토콜입니다. 1982년 RFC 826으로 표준화되었으며, 로컬 네트워크 세그먼트 내에서 통신이 가능하게 하는 기반 기술입니다.

ARP가 필요한 근본 이유는 네트워크 통신의 계층적 구조에 있습니다:
- **네트워크 계층(IP)**: 논리적 주소(IP)를 사용하여 목적지까지의 경로를 결정
- **데이터 링크 계층**: 물리적 주소(MAC)를 사용하여 실제로 다음 홉(같은 네트워크 내의 장치)에 프레임을 전달

따라서 라우터나 호스트가 특정 IP 주소로 패킷을 보내려면, 반드시 그 IP 주소에 해당하는 MAC 주소를 알아야 합니다.

## 주소 해석 개념과 문제점

### 주소 해석의 필요성

TCP/IP 네트워크에서 통신이 이루어지기 위해서는 두 가지 종류의 주소 체계가 협력해야 합니다. **IP 주소**(논리적 주소)는 네트워크 계층(3계층)에서 장치의 네트워크상 위치를 식별하는 반면, **MAC 주소**(물리적 주소)는 데이터 링크 계층(2계층)에서 네트워크 카드의 고유 하드웨어 식별자 역할을 합니다.

여기서 발생하는 근본적인 문제는 다음과 같습니다: 패킷이 목적지 IP 주소를 가지고 라우팅되어 최종 목적지 네트워크에 도착했을 때, 실제로 그 패킷을 최종 수신할 특정 장치를 찾기 위해서는 IP 주소를 해당 장치의 MAC 주소로 변환해야 합니다. 마치 편지가 아파트 건물(IP 네트워크)까지는 도착했지만, 특정 호수(MAC 주소)를 찾아 배달해야 하는 상황과 유사합니다.

```
주소 해석의 필요성 - 계층 간 주소 불일치 문제
+---------------------+       +---------------------+
| 네트워크 계층       |       | 데이터 링크 계층    |
| (IP 주소 사용)      |       | (MAC 주소 사용)     |
| 목적지: 192.168.1.5 | ----> | 목적지: ?           |
+---------------------+       +---------------------+
         ↓                            ↓
    "논리적 위치"              "물리적 장치"
    (라우팅 가능)             (로컬 전달 필요)
```

이 변환 과정이 없으면, 스위치는 패킷을 어느 포트로 전송해야 할지 알 수 없어 모든 포트로 플러딩을 하게 되며, 이는 네트워크 효율성을 심각하게 저하시킵니다.

### 직접 매핑을 통한 주소 해석

가장 단순한 주소 해석 방법은 **정적 매핑**입니다. 각 IP 주소에 대응하는 MAC 주소를 미리 테이블에 하드코딩하여 저장하는 방식으로, 작은 규모의 네트워크나 변경이 거의 없는 환경에서는 효과적일 수 있습니다.

그러나 직접 매핑 방식에는 심각한 한계가 있습니다:
1. **확장성 부족**: 대규모 네트워크에서는 모든 매핑을 수동으로 관리하기 불가능
2. **유연성 결여**: 장치의 MAC 주소 변경, 네트워크 카드 교체, IP 주소 재할당 시 매핑 갱신 필요
3. **관리 부담 증가**: 네트워크가 확장될수록 관리 오버헤드가 기하급수적으로 증가

이러한 이유로 현대 네트워크에서는 직접 매핑 방식이 거의 사용되지 않습니다.

## ARP 주소 지정 방식과 기본 동작

### ARP의 기본 원리

ARP는 **질의-응답 방식**으로 동작합니다. 같은 로컬 네트워크(브로드캐스트 도메인) 내에서 IP 주소를 알고 있지만 MAC 주소를 모를 때 사용됩니다.

### 동적 주소 해석

동적 주소 해석은 네트워크 장치들이 필요할 때 실시간으로 IP 주소와 MAC 주소의 매핑 관계를 자동으로 탐지하고 학습하는 방식을 말합니다. **ARP(Address Resolution Protocol)** 가 이 방식을 구현한 대표적인 프로토콜입니다.

**ARP 요청 과정:**
1. 호스트 A가 호스트 B의 IP 주소는 알지만 MAC 주소를 모를 경우
2. 호스트 A는 **ARP 요청** 패킷을 **브로드캐스트**(FF:FF:FF:FF:FF:FF)로 전송
   - "이 IP 주소(호스트 B의 IP)를 가진 장비는 당신의 MAC 주소를 알려주세요"
3. 네트워크의 모든 장치가 이 요청을 수신
4. 해당 IP 주소를 가진 호스트 B만 **ARP 응답**을 **유니캐스트**로 회신
5. 호스트 A는 응답을 받아 ARP 캐시에 저장하고 통신 시작

```
ARP 요청-응답 과정
[호스트 A]                                      [호스트 B]
IP: 192.168.1.10                         IP: 192.168.1.20
MAC: AA:BB:CC:DD:EE:01                   MAC: AA:BB:CC:DD:EE:02

1. ARP 요청 (브로드캐스트)
   "192.168.1.20의 MAC 주소가 무엇인가요?"
   ↓
2. ARP 응답 (유니캐스트)
   "저는 192.168.1.20이고, 제 MAC 주소는 AA:BB:CC:DD:EE:02입니다"
```

```
호스트 A (IP: 192.168.1.10, MAC: AA:AA:AA:AA:AA:AA)
      ↓ ARP 요청 (브로드캐스트)
      "192.168.1.20의 MAC 주소가 무엇인가요?"
      ↓
모든 호스트 수신 → 오직 호스트 B만 응답
      ↓ ARP 응답 (유니캐스트)
호스트 B (IP: 192.168.1.20, MAC: BB:BB:BB:BB:BB:BB)
      "저는 192.168.1.20이고, 제 MAC 주소는 BB:BB:BB:BB:BB:BB입니다"
```

## ARP 메시지 형식

ARP 패킷은 네트워크 유형에 독립적인 형식을 가지며, 이더넷에서의 일반적인 구조는 다음과 같습니다:

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          하드웨어 유형        |         프로토콜 유형         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| HW 주소 길이 | 프로토콜 주소 길이 |         연산 코드         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     발신자 하드웨어 주소                     |
|                         (첫 4바이트)                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  발신자 HW 주소 (나머지)     |   발신자 프로토콜 주소        |
|                         (2바이트)    |      (첫 2바이트)      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         발신자 프로토콜 주소 (나머지)        |   대상 하드웨어|
|                         (2바이트)            |   주소 (첫 2바이트)
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              대상 하드웨어 주소 (계속)                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 대상 하드웨어 주소 (나머지)  |    대상 프로토콜 주소         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              대상 프로토콜 주소 (계속)                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**ARP 패킷 구조:**
```
+----------------+----------------+
| 하드웨어 타입  | 프로토콜 타입  | (예: Ethernet, IPv4)
+----------------+----------------+
| HW 주소 길이   | 프로토콜 길이  | (예: 6바이트, 4바이트)
+----------------+----------------+
|    오퍼레이션 코드              | (1: 요청, 2: 응답)
+---------------------------------+
| 송신자 MAC 주소 (6바이트)       |
+---------------------------------+
| 송신자 IP 주소 (4바이트)        |
+---------------------------------+
| 대상 MAC 주소 (6바이트)         |
+---------------------------------+
| 대상 IP 주소 (4바이트)          |
+---------------------------------+
```

**각 필드 설명:**
- **하드웨어 유형**: 네트워크 유형 (이더넷=1)
- **프로토콜 유형**: 프로토콜 주소 유형 (IPv4=0x0800)
- **연산 코드**: 요청(1) 또는 응답(2)
- **주소 필드**: 발신자/대상의 MAC 주소와 IP 주소

## ARP 캐싱

모든 ARP 요청을 브로드캐스트하는 것은 네트워크 효율성을 저하시킵니다. 이를 해결하기 위해 ARP 캐시(ARP 테이블)를 사용합니다.

### 동적 주소 해석 캐싱과 효율성 문제

모든 IP-MAC 매핑을 매번 ARP 요청으로 해결한다면 네트워크는 ARP 브로드캐스트 트래픽으로 인해 심각한 성능 저하를 겪을 것입니다. 이를 해결하기 위해 ARP는 **ARP 캐시(ARP 테이블)** 라는 임시 저장소를 활용합니다.

**ARP 캐시 특징:**
1. **동적 엔트리**: ARP 요청/응답을 통해 자동으로 학습된 항목
   - 일반적으로 2-20분의 수명 (시스템마다 다름)
   - 일정 시간 내 재사용되지 않으면 삭제됨
2. **정적 엔트리**: 수동으로 설정된 항목
   - 영구적으로 캐시에 저장
   - 보안 목적이나 특수 환경에서 사용
3. **캐시 무효화**: IP 주소 변경, 네트워크 카드 교체 등 상황에서 항목 삭제 필요

**ARP 캐시의 작동 방식:**
1. **캐시 저장**: 한 번 조회된 IP-MAC 매핑을 일정 시간 동안 캐시에 저장
2. **캐시 조회**: 패킷 전송 전 먼저 캐시에서 매핑 정보 확인
3. **캐시 갱신**: 일정 시간(타임아웃)이 지나면 캐시 항목 삭제 및 재조회
4. **캐시 무효화**: 네트워크 구성 변경 시 관련 캐시 항목 삭제

```
ARP 캐시 테이블 예시
+-----------------+----------------------+----------+------------+
| IP 주소         | MAC 주소             | 인터페이스 | 타임아웃    |
+-----------------+----------------------+----------+------------+
| 192.168.1.1     | 00:1A:2B:3C:4D:5E   | eth0     | 120초 남음 |
| 192.168.1.20    | AA:BB:CC:DD:EE:02   | eth0     | 85초 남음  |
| 192.168.1.100   | 11:22:33:44:55:66   | eth0     | 10초 남음  |
+-----------------+----------------------+----------+------------+
```

**ARP 캐시 관리 명령어:**
```bash
# ARP 테이블 확인 (Windows)
arp -a

# ARP 테이블 확인 (Linux/Mac)
arp -n

# ARP 항목 수동 추가
arp -s 192.168.1.100 AA-BB-CC-DD-EE-FF
```

### ARP 캐싱의 효율성 문제와 해결 방안:

1. **캐시 일관성 문제**
   - 네트워크 카드 교체 시 이전 MAC 주소가 캐시에 남아 통신 실패 가능
   - **해결책**: ARP 캐시 항목에 수명(TTL) 설정, 정기적 갱신

2. **캐시 오염(Cache Poisoning) 공격**
   - 악의적 장치가 거짓 ARP 응답을 전송하여 캐시를 오염시키는 공격
   - **해결책**: 정적 ARP 항목 설정, ARP 검증 기능 활용

3. **ARP 스톰(Storm) 문제**
   - 많은 장치가 동시에 ARP 요청을 생성할 때 네트워크 정체 발생
   - **해결책**: ARP 요청 간 지연 시간 설정, 스위치의 스톰 제어 기능 활용

4. **크로스 서브넷 통신 문제**
   - 서로 다른 서브넷 간 통신 시 기본 게이트웨이의 MAC 주소만 필요
   - **해결책**: 로컬 서브넷 내에서만 ARP 사용, 라우터가 프록시 ARP 제공

**ARP 최적화 기법:**
- **그래티투이스 ARP(Gratuitous ARP)**: 장치가 자신의 IP-MAC 매핑을 자발적으로 알림(IP 충돌 감지용)
- **프록시 ARP(Proxy ARP)**: 라우터가 다른 서브넷의 장치를 대신해 ARP 응답
- **역 ARP(RARP)**: MAC 주소로 IP 주소 조회(현재는 DHCP로 대체됨)

## 프록시 ARP

프록시 ARP는 한 장치가 다른 장치를 대신하여 ARP 응답을 하는 메커니즘입니다. 서로 다른 서브넷에 있지만 같은 물리적 네트워크에 있는 호스트 간의 통신을 가능하게 합니다.

**프록시 ARP 사용 사례:**
1. **서브넷 분할 없이 네트워크 구분**: 물리적 네트워크는 하나지만 논리적으로 분할된 경우
2. **모바일 IP 지원**: 이동 중인 호스트를 위한 주소 변환
3. **네트워크 주소 변환(NAT) 환경**: 사설 IP와 공인 IP 간 변환

**동작 방식:**
- 라우터가 자신의 MAC 주소로 ARP 응답
- 라우터가 대상 호스트까지 패킷을 전달
- 대상 호스트에서의 응답도 라우터가 중계

```
서브넷 A의 호스트 → (ARP 요청: 서브넷 B의 IP) → 라우터가 대신 응답
라우터 → 패킷 전달 → 서브넷 B의 실제 호스트
```

## IP 멀티캐스트 주소를 위한 주소 변환

IP 멀티캐스트 주소(224.0.0.0 ~ 239.255.255.255)는 특정 그룹의 호스트들에게 패킷을 전송할 때 사용됩니다. 이 IP 주소를 이더넷 멀티캐스트 MAC 주소로 변환하는 방법이 표준화되어 있습니다.

**변환 규칙:**
1. IP 멀티캐스트 주소의 하위 23비트를 추출
2. 이를 이더넷 멀티캐스트 OUI(01:00:5E) 뒤에 매핑
3. 결과: `01:00:5E:0:xx:xx:xx` 형식의 MAC 주소

**예시:**
- IP 멀티캐스트 주소: 224.0.0.1 (모든 호스트)
- 이진: 11100000.00000000.00000000.00000001
- 하위 23비트: 0000000.00000000.00000001 (16진수: 00:00:01)
- MAC 주소: 01:00:5E:00:00:01

**주의사항:** 서로 다른 IP 멀티캐스트 주소 32개가 같은 MAC 주소로 매핑될 수 있어(충돌), 상위 계층에서 필터링이 필요합니다.

## IPv6를 위한 주소 변환

IPv6에서는 ARP 대신 **NDP(Neighbor Discovery Protocol)**가 사용됩니다. NDP는 ICMPv6 메시지를 활용하여 더욱 향상된 기능을 제공합니다.

**NDP의 주요 기능:**
1. **주소 해결**: ARP와 유사하게 IPv6 주소를 MAC 주소로 변환
2. **라우터 발견**: 자동으로 라우터 탐지 및 기본 게이트웨이 설정
3. **주소 자동 구성**: SLAAC을 통한 IPv6 주소 자동 생성
4. **중복 주소 검출**: 동일 네트워크 내 주소 충돌 방지
5. **접근성 확인**: 이웃 호스트의 활성 상태 모니터링

**NDP 메시지 유형:**
- **Neighbor Solicitation**: ARP 요청에 해당
- **Neighbor Advertisement**: ARP 응답에 해당
- **Router Solicitation/Advertisement**: 라우터 정보 교환

## 역주소 변환과 RARP

RARP(Reverse Address Resolution Protocol)는 ARP의 반대 기능으로, **MAC 주소를 IP 주소로 변환**하는 프로토콜입니다. 디스크 없는 워크스테이션이 자신의 IP 주소를 알아낼 때 사용되었습니다.

**RARP의 한계와 대체 기술:**
1. **BOOTP(Bootstrap Protocol)**: RARP의 단점을 보완하여 개발
   - 서브넷 마스크, 게이트웨이, DNS 서버 정보도 제공 가능
   - 라우터를 통한 전송 지원
2. **DHCP(Dynamic Host Configuration Protocol)**: BOOTP를 확장한 현대적 프로토콜
   - IP 주소 임대 개념 도입
   - 다양한 구성 옵션 지원
   - 현재 가장 널리 사용되는 동적 주소 할당 프로토콜

**RARP 동작 방식:**
1. 클라이언트가 자신의 MAC 주소로 RARP 요청 브로드캐스트
2. RARP 서버가 해당 MAC 주소에 할당된 IP 주소로 응답
3. 클라이언트는 응답받은 IP 주소를 자신의 주소로 사용

## 결론

ARP는 로컬 네트워크 통신의 불가결한 기반 프로토콜로, IP 주소와 MAC 주소 간의 간극을 메우는 중요한 역할을 합니다. 그 단순하고 효율적인 설계는 수십 년간 변함없이 동작하면서도 현대 네트워크의 복잡한 요구사항을 충족시키고 있습니다.

ARP의 진정한 가치는 네트워크의 투명성을 제공하는 데 있습니다. 사용자나 애플리케이션은 MAC 주소를 알 필요 없이 논리적인 IP 주소만으로 통신할 수 있으며, ARP가 자동으로 필요한 물리적 주소 변환을 처리합니다. 그러나 이러한 편리함 뒤에는 ARP 스푸핑과 같은 보안 위협도 존재하므로, 네트워크 관리자는 ARP 캐시 포이즈닝 방지 대책을 마련해야 합니다.

IPv6로의 전환이 진행됨에 따라 ARP는 NDP로 대체되고 있지만, 여전히 대부분의 IPv4 네트워크에서 핵심적인 역할을 수행하고 있습니다. 네트워크 문제 해결 시 ARP 캐시 확인은 가장 기본적이면서도 효과적인 진단 방법 중 하나이며, 프록시 ARP와 같은 고급 기능은 특수한 네트워크 설계에 유용하게 활용됩니다.

ARP의 발전 과정—RARP에서 BOOTP를 거쳐 DHCP로—는 네트워크 프로토콜이 단순한 주소 변환을 넘어 종합적인 구성 관리 솔루션으로 진화하는 양상을 잘 보여줍니다. 이러한 역사적 흐름을 이해하는 것은 네트워크 기술의 발전 방향을 통찰하는 데 도움이 될 것입니다.

ARP는 TCP/IP 네트워크의 무명의 영웅과 같은 프로토콜입니다. 사용자가 직접 의식하지는 못하지만, IP 주소와 MAC 주소 간의 중대한 간극을 메우는 역할을 수행하며 네트워크 통신의 실제 물리적 전달을 가능하게 합니다. 동적 주소 해석과 캐싱 메커니즘은 네트워크의 확장성과 유연성을 보장하는 동시에, 효율성을 극대화하는 지혜로운 설계입니다.

ARP의 중요성은 단순한 기술적 기능을 넘어 네트워크 계층 모델의 철학적 이해로 이어집니다. 계층화된 네트워크 모델에서 각 계층은 독립적으로 작동하지만, ARP는 이러한 계층들을 실제로 연결하는 교량 역할을 하며 추상화와 구현 사이의 간극을 해소합니다.

현대 네트워크에서 ARP는 IPv6의 NDP(Neighbor Discovery Protocol)로 진화하고 있으며, 클라우드 환경과 가상화 기술에서는 더욱 정교한 형태의 주소 해석 메커니즘이 요구되고 있습니다. 그러나 그 근본 원리와 해결하려는 문제—논리적 주소와 물리적 주소 간의 매핑—는 네트워킹의 영원한 핵심 과제로 남아있을 것입니다. ARP의 간단하지만 강력한 설계는 네트워크 프로토콜 디자인의 교과서적 사례로서 계속해서 연구되고 참조될 가치가 있습니다.