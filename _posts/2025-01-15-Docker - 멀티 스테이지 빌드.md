---
layout: post
title: Docker - exec vs attach
date: 2025-01-14 19:20:23 +0900
category: Docker
---
# ðŸ—ï¸ Docker ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ (Multi-stage Build)

---

## ðŸ§¾ ê°œë… ì •ë¦¬

ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œëŠ” Dockerfile ë‚´ì—ì„œ **ì—¬ëŸ¬ ê°œì˜ `FROM` ëª…ë ¹ì–´**ë¥¼ ì‚¬ìš©í•˜ì—¬  
**ë¹Œë“œ ë‹¨ê³„ì™€ ì‹¤í–‰ ë‹¨ê³„(ë°°í¬)ë¥¼ ë¶„ë¦¬**í•˜ëŠ” ë°©ì‹ìž…ë‹ˆë‹¤.

> ì¦‰, **ë¶ˆí•„ìš”í•œ íŒŒì¼/íˆ´/ë””íŽœë˜ì‹œë¥¼ ìµœì¢… ì´ë¯¸ì§€ì—ì„œ ì œì™¸**í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

## ðŸ“¦ ì™œ í•„ìš”í•œê°€?

- ì¼ë°˜ì ìœ¼ë¡œ Node.js, Java, Python ë“± ì•±ì€ ë¹Œë“œ/íŒ¨í‚¤ì§• ë‹¨ê³„ì™€ ì‹¤í–‰ ë‹¨ê³„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.
- ê¸°ì¡´ Dockerfileì€ ëª¨ë“  íŒŒì¼ì„ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ì— ë„£ê¸° ë•Œë¬¸ì— ì´ë¯¸ì§€ê°€ ì»¤ì§€ê³  ë³´ì•ˆ ìœ„í—˜ë„ ì¦ê°€í•©ë‹ˆë‹¤.

---

## ðŸ§± ë©€í‹° ìŠ¤í…Œì´ì§€ ê¸°ë³¸ êµ¬ì¡°

```Dockerfile
# 1ë‹¨ê³„: ë¹Œë“œ ìŠ¤í…Œì´ì§€
FROM node:20 AS builder
WORKDIR /app
COPY . .
RUN npm install && npm run build

# 2ë‹¨ê³„: ëŸ°íƒ€ìž„ ìŠ¤í…Œì´ì§€
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

- `AS builder`: ì´ë¦„ ì§€ì • (í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ ê°€ë…ì„± í–¥ìƒ)
- `--from=builder`: ì´ì „ ìŠ¤í…Œì´ì§€ì˜ ê²°ê³¼ë§Œ ê°€ì ¸ì˜´

---

## ðŸ’¡ ì‹¤ì „ ì˜ˆì œ 1: Node.js ì•± ë¹Œë“œ í›„ Nginxë¡œ ë°°í¬

```Dockerfile
# 1ë‹¨ê³„: Node ë¹Œë“œ í™˜ê²½
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# 2ë‹¨ê³„: Nginx ì´ë¯¸ì§€ì— ì •ì  íŒŒì¼ë§Œ ë³µì‚¬
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### ðŸ‘‰ ê²°ê³¼:
- ìµœì¢… ì´ë¯¸ì§€ì—ëŠ” `nginx`, `ì •ì  íŒŒì¼`ë§Œ í¬í•¨ë¨
- node, npm, ì†ŒìŠ¤ì½”ë“œëŠ” ì¡´ìž¬í•˜ì§€ ì•ŠìŒ
- ì´ë¯¸ì§€ í¬ê¸° â†“, ë³´ì•ˆ â†‘

---

## ðŸ’¡ ì‹¤ì „ ì˜ˆì œ 2: Go ì• í”Œë¦¬ì¼€ì´ì…˜ (ì»´íŒŒì¼ â†’ ì‹¤í–‰)

```Dockerfile
# 1ë‹¨ê³„: ë¹Œë“œ
FROM golang:1.21 AS builder
WORKDIR /go/src/app
COPY . .
RUN go build -o myapp main.go

# 2ë‹¨ê³„: ëŸ°íƒ€ìž„
FROM debian:bookworm-slim
COPY --from=builder /go/src/app/myapp /usr/local/bin/myapp
CMD ["myapp"]
```

### ðŸ‘‰ ê²°ê³¼:
- ìµœì¢… ì´ë¯¸ì§€ì—ëŠ” **ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬**ë§Œ ì¡´ìž¬
- Go íˆ´ì²´ì¸ ì—†ìŒ â†’ ë§¤ìš° ìž‘ìŒ (10~20MB ìˆ˜ì¤€)

---

## âš™ï¸ ìž‘ë™ ì›ë¦¬

1. ê° `FROM` ëª…ë ¹ì€ **ìƒˆë¡œìš´ ë¹Œë“œ ìŠ¤í…Œì´ì§€**ë¥¼ ë§Œë“­ë‹ˆë‹¤.
2. ì•ž ë‹¨ê³„ì˜ ê²°ê³¼ë¬¼ì„ `COPY --from=ì´ë¦„` í˜¹ì€ `--from=ë²ˆí˜¸`ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
3. ìµœì¢… `FROM` ìŠ¤í…Œì´ì§€ë§Œ **ì‹¤ì œë¡œ ì´ë¯¸ì§€ë¡œ ì‚¬ìš©ë¨**  
   (ì´ì „ ë‹¨ê³„ë“¤ì€ ë¹Œë“œì‹œ ìž„ì‹œë¡œë§Œ ì¡´ìž¬)

---

## âœ… ìž¥ì  ìš”ì•½

| í•­ëª© | íš¨ê³¼ |
|------|------|
| ðŸŽ¯ ì´ë¯¸ì§€ ê²½ëŸ‰í™” | ë¹Œë“œ ë„êµ¬, ìž„ì‹œ íŒŒì¼ ë¯¸í¬í•¨ |
| ðŸ” ë³´ì•ˆ ê°•í™” | ê°œë°œ ë„êµ¬/ë¹„ë°€ í‚¤ ìœ ì¶œ ë°©ì§€ |
| âš™ï¸ í™˜ê²½ ë¶„ë¦¬ | ë¹Œë“œì™€ ì‹¤í–‰ í™˜ê²½ ëª…í™•ížˆ êµ¬ë¶„ |
| ðŸ§¹ ê¹”ë”í•œ êµ¬ì¡° | ëª…ì‹œì ì´ê³  ìœ ì§€ë³´ìˆ˜ ì‰¬ì›€ |

---

## ðŸ“Œ ì‹¤ì „ íŒ

### âœ… ë¹Œë“œ ìŠ¤í…Œì´ì§€ì—ë§Œ í•„ìš”í•œ í•­ëª© ë¶„ë¦¬

ì˜ˆ:
```Dockerfile
COPY .env.production ./  # ì´ê±´ ëŸ°íƒ€ìž„ì—ë§Œ í•„ìš”
```

### âœ… ìºì‹±ì„ í™œìš©í•œ ë¹ ë¥¸ ë¹Œë“œ

- `COPY package*.json ./` â†’ `RUN npm install` â†’ ì´í›„ `COPY`  
  ë³€ê²½ì´ ì—†ìœ¼ë©´ npm ìºì‹œ ì‚¬ìš© ê°€ëŠ¥

### âœ… ì´ë¦„ ëŒ€ì‹  ë²ˆí˜¸ë„ ì‚¬ìš© ê°€ëŠ¥

```Dockerfile
COPY --from=0 /app/dist /usr/share/nginx/html
```

í•˜ì§€ë§Œ ì´ë¦„(`--from=builder`)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ìŠµë‹ˆë‹¤.

---

## ðŸš« ë‹¨ì¼ ìŠ¤í…Œì´ì§€ì¼ ë•Œì˜ ë‹¨ì 

```Dockerfile
FROM node:20
WORKDIR /app
COPY . .
RUN npm install
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

| ë¬¸ì œì  | ì„¤ëª… |
|--------|------|
| ìš©ëŸ‰ â†‘ | node_modules, .git, ë¡œê·¸íŒŒì¼ í¬í•¨ ê°€ëŠ¥ |
| ë³´ì•ˆ â†“ | ì†ŒìŠ¤ì½”ë“œ, í™˜ê²½ì„¤ì • í¬í•¨ |
| ë¹Œë“œ ë„êµ¬ í¬í•¨ | í•„ìš” ì—†ëŠ” íŒŒì¼/íˆ´ê¹Œì§€ ìœ ì§€ |

---

## ðŸ“‹ ê²°ë¡  ì •ë¦¬

- ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œëŠ” **ì´ë¯¸ì§€ ìµœì í™”ì˜ í•µì‹¬ ê¸°ë²•**
- ìµœì¢… ì´ë¯¸ì§€ì—ëŠ” **ì‹¤í–‰ì— ê¼­ í•„ìš”í•œ íŒŒì¼ë§Œ í¬í•¨**
- ì–´ë–¤ ì–¸ì–´ë‚˜ í”„ë ˆìž„ì›Œí¬ë“  ì ìš© ê°€ëŠ¥ (Go, Node.js, Java ë“±)
- CI/CD íŒŒì´í”„ë¼ì¸ì—ë„ ì í•© (GitHub Actions, GitLab ë“±)

---

## ðŸ”§ ì˜ˆì œ: Python ì•± ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ (ì¶”ê°€ ì°¸ê³ )

```Dockerfile
# 1ë‹¨ê³„: ë¹Œë“œìš© pipenv í¬í•¨
FROM python:3.11 AS builder
WORKDIR /app
COPY Pipfile Pipfile.lock ./
RUN pip install pipenv && pipenv lock --requirements > requirements.txt

# 2ë‹¨ê³„: ê²½ëŸ‰ ëŸ°íƒ€ìž„
FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "main.py"]
```
