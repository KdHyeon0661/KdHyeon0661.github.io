---
layout: post
title: Docker - Macvlan, Overlay, Compose
date: 2025-01-14 19:20:23 +0900
category: Docker
---
# ğŸ§  Docker ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ì •ë¦¬: Macvlan, Overlay, Compose ì„¤ì •

---

## ğŸ“Œ ëª©ì°¨

1. ğŸ”Œ macvlan: ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ì²˜ëŸ¼ ë™ì‘
2. ğŸŒ overlay: ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ ê°„ í†µì‹  (Swarm ê¸°ë°˜)
3. ğŸ§± docker-composeì—ì„œ ë„¤íŠ¸ì›Œí¬ ì§ì ‘ ì„¤ì •í•˜ê¸°

---

## 1ï¸âƒ£ macvlan ë„¤íŠ¸ì›Œí¬: ì»¨í…Œì´ë„ˆì— MAC ì£¼ì†Œë¥¼ ë¶€ì—¬í•œë‹¤?

> ì»¨í…Œì´ë„ˆê°€ **í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶„í• í•˜ì—¬**  
> ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ ìƒì˜ **ê³ ìœ í•œ MAC/IP ì£¼ì†Œ**ë¥¼ ê°€ì§„ ë…ë¦½ ì¥ë¹„ì²˜ëŸ¼ ë™ì‘

### âœ… íŠ¹ì§•

| í•­ëª© | ì„¤ëª… |
|------|------|
| IP / MAC | ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ì˜ ì§„ì§œ IPì²˜ëŸ¼ ë™ì‘ |
| ëª©ì  | IoT, í”„ë¦°í„°, ë¡œì»¬ ì¥ë¹„ì²˜ëŸ¼ ì¸ì‹ë˜ì–´ì•¼ í•  ë•Œ |
| ì œí•œ | í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì€ **ë¶ˆê°€ëŠ¥** (ê°™ì€ NICë¥¼ ì‚¬ìš©í•  ê²½ìš°) |
| ì™¸ë¶€ ì¥ë¹„ í†µì‹  | ê°€ëŠ¥ (ë¼ìš°í„°, ìŠ¤ìœ„ì¹˜ì™€ ì§ì ‘ í†µì‹ ) |

### âœ… êµ¬ì„± ì˜ˆì‹œ

```bash
docker network create -d macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  my-macvlan
```

- `parent=eth0`: ë¬¼ë¦¬ NICë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±
- `192.168.1.X` ëŒ€ì—­ì˜ **ê³ ìœ  IPë¥¼ ì»¨í…Œì´ë„ˆê°€ ì§ì ‘ ë¶€ì—¬ë°›ìŒ**

### âœ… ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì˜ˆ

```bash
docker run -d --name printer \
  --network my-macvlan \
  --ip 192.168.1.50 \
  nginx
```

â†’ ì™¸ë¶€ì—ì„œ `192.168.1.50:80`ìœ¼ë¡œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥ (í¬íŠ¸ í¬ì›Œë”© ë¶ˆí•„ìš”)

---

## â— macvlan ì£¼ì˜ ì‚¬í•­

- í˜¸ìŠ¤íŠ¸ì™€ ë™ì¼ NICë¥¼ ì‚¬ìš©í•˜ë©´, **ì»¨í…Œì´ë„ˆì™€ í˜¸ìŠ¤íŠ¸ ê°„ í†µì‹  ì•ˆ ë¨**
  - í•´ê²°: **bridge + veth pair** í˜¹ì€ **macvlan bridge ëª¨ë“œ** í•„ìš”
- ë¼ìš°í„° DHCP ì„¤ì •ê³¼ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ ì •ì  IP ì‚¬ìš© ê¶Œì¥
- Linuxì—ì„œë§Œ ì™„ì „ ì§€ì›ë¨ (Mac/WindowsëŠ” Docker Desktopì—ì„œ ì œí•œ)

---

## 2ï¸âƒ£ overlay ë„¤íŠ¸ì›Œí¬: ë‹¤ì¤‘ Docker í˜¸ìŠ¤íŠ¸ í†µì‹ 

> ì—¬ëŸ¬ Docker **ë…¸ë“œ(ì„œë²„)** ê°„ì— ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹  
> Docker Swarm ëª¨ë“œ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘

### âœ… íŠ¹ì§•

| í•­ëª© | ì„¤ëª… |
|------|------|
| ë„¤íŠ¸ì›Œí¬ ë²”ìœ„ | ì—¬ëŸ¬ ë¬¼ë¦¬ì  í˜¸ìŠ¤íŠ¸ (ë…¸ë“œ)ì— ê±¸ì³ ìˆìŒ |
| ì»¨í…Œì´ë„ˆ í†µì‹  | ê°™ì€ overlay ë„¤íŠ¸ì›Œí¬ì— ìˆìœ¼ë©´ ì„œë¡œ í†µì‹  ê°€ëŠ¥ |
| ì•”í˜¸í™” | VXLAN ê¸°ë°˜ìœ¼ë¡œ **ë°ì´í„° ì•”í˜¸í™” ê°€ëŠ¥** |
| í•„ìš” ì¡°ê±´ | Swarm ëª¨ë“œ í™œì„±í™” (`docker swarm init`) |

---

### âœ… êµ¬ì„± íë¦„

```bash
# 1. Swarm ì´ˆê¸°í™”
docker swarm init

# 2. Overlay ë„¤íŠ¸ì›Œí¬ ìƒì„±
docker network create \
  -d overlay \
  --attachable \
  my-overlay
```

- `--attachable`: ì¼ë°˜ ì»¨í…Œì´ë„ˆë„ ë„¤íŠ¸ì›Œí¬ì— ë¶™ì¼ ìˆ˜ ìˆìŒ

### âœ… ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker service create \
  --name web \
  --network my-overlay \
  nginx
```

ë˜ëŠ” Swarmì´ ì•„ë‹Œ ì¼ë°˜ ì»¨í…Œì´ë„ˆë„ ë¶™ì¼ ìˆ˜ ìˆìŒ:

```bash
docker run -d --network my-overlay nginx
```

> ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— ì„¤ì¹˜ëœ Dockerë“¤ì´ ì´ overlay ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•¨

---

## 3ï¸âƒ£ Docker Composeì˜ ë„¤íŠ¸ì›Œí¬ ì„¤ì •

### âœ… ê¸°ë³¸ ë™ì‘

ComposeëŠ” ìë™ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ì–´ ì„œë¹„ìŠ¤ë¼ë¦¬ í†µì‹  ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

```yaml
services:
  web:
    image: nginx
  db:
    image: mysql
```

â†’ `web`ì€ `db:3306`ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥  
â†’ ìë™ ìƒì„±ëœ ë„¤íŠ¸ì›Œí¬ ì´ë¦„ì€ `ë””ë ‰í† ë¦¬ëª…_default`

---

### âœ… ì‚¬ìš©ì ì •ì˜ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ì˜ˆ

```yaml
version: '3.9'
services:
  web:
    image: nginx
    networks:
      - frontend
  db:
    image: mysql
    networks:
      - backend

networks:
  frontend:
  backend:
```

- `web`ê³¼ `db`ëŠ” ì„œë¡œ **í†µì‹  ë¶ˆê°€** (ë„¤íŠ¸ì›Œí¬ê°€ ë‹¤ë¦„)
- ì¶”ê°€ë¡œ í†µì‹ í•˜ê²Œ í•˜ë ¤ë©´ ë‘ ë„¤íŠ¸ì›Œí¬ë¥¼ ëª¨ë‘ ì—°ê²°í•´ì•¼ í•¨

```yaml
  web:
    networks:
      - frontend
      - backend
```

---

### âœ… external ë„¤íŠ¸ì›Œí¬ (ì™¸ë¶€ì—ì„œ ë§Œë“  ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©)

```yaml
networks:
  mynet:
    external: true
```

> `docker network create mynet`ìœ¼ë¡œ ë¨¼ì € ìƒì„± í•„ìš”

---

### âœ… ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ ì§€ì •

```yaml
networks:
  frontend:
    driver: bridge
  overlaynet:
    driver: overlay
```

---

## ğŸ“‹ ì •ë¦¬ ìš”ì•½

| ë„¤íŠ¸ì›Œí¬ | ìš©ë„ | íŠ¹ì§• |
|----------|------|------|
| **bridge** | ê¸°ë³¸ê°’ | ê²©ë¦¬, í¬íŠ¸ ë§¤í•‘ í•„ìš” |
| **host** | ì„±ëŠ¥ ì¤‘ì‹œ | í˜¸ìŠ¤íŠ¸ IP ì§ì ‘ ì‚¬ìš©, ê²©ë¦¬ ì—†ìŒ |
| **macvlan** | ì™¸ë¶€ ì¥ë¹„ì²˜ëŸ¼ ë™ì‘ | ì»¨í…Œì´ë„ˆì— ì‹¤ì œ IP ë¶€ì—¬, í˜¸ìŠ¤íŠ¸ì™€ í†µì‹  ë¶ˆê°€ |
| **overlay** | ë‹¤ì¤‘ ë…¸ë“œ êµ¬ì„± | Swarm ê¸°ë°˜, ì•”í˜¸í™” ê°€ëŠ¥, í´ëŸ¬ìŠ¤í„° í™˜ê²½ í•„ìˆ˜ |
| **docker-compose** | ë©€í‹° ì»¨í…Œì´ë„ˆ êµ¬ì„± | ì´ë¦„ ê¸°ë°˜ í†µì‹ , ë„¤íŠ¸ì›Œí¬ ëª…ì‹œ ê°€ëŠ¥ |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Docker macvlan docs](https://docs.docker.com/network/macvlan/)
- [Docker overlay network docs](https://docs.docker.com/network/overlay/)
- [Docker Compose networks](https://docs.docker.com/compose/networking/)