---
layout: post
title: AspNet - ì¿ í‚¤ ì¸ì¦
date: 2025-04-02 21:20:23 +0900
category: AspNet
---
# ğŸª ASP.NET Core ì¿ í‚¤ ì¸ì¦ (Cookie Authentication) ì™„ì „ ì •ë¦¬

---

## âœ… 1. ì¿ í‚¤ ì¸ì¦ì´ë€?

- ì‚¬ìš©ìê°€ **ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´**, ì„œë²„ê°€ **ì¸ì¦ ì •ë³´ë¥¼ ì¿ í‚¤ì— ì €ì¥**í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•©ë‹ˆë‹¤.
- ì´í›„ ìš”ì²­ë§ˆë‹¤ ì¿ í‚¤ë¥¼ í†µí•´ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
- ì£¼ë¡œ **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜(MVC, Razor Pages)**ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

## ğŸ§  2. ì¿ í‚¤ ì¸ì¦ vs JWT ì¸ì¦

| í•­ëª© | ì¿ í‚¤ ì¸ì¦ | JWT ì¸ì¦ |
|------|-----------|-----------|
| ì €ì¥ ìœ„ì¹˜ | ë¸Œë¼ìš°ì € ì¿ í‚¤ | HTTP í—¤ë”(Authorization) |
| ìƒíƒœ ê´€ë¦¬ | ì„œë²„ì—ì„œ ê´€ë¦¬ (ì„¸ì…˜ or ì¿ í‚¤ ê²€ì¦) | ë¬´ìƒíƒœ (Stateless) |
| ì£¼ ìš©ë„ | ì›¹ ì•± (ë¡œê·¸ì¸/ì„¸ì…˜ ê¸°ë°˜) | SPA, ëª¨ë°”ì¼, Web API |
| ë³´ì•ˆ ìœ„í—˜ | XSS, CSRF | í† í° íƒˆì·¨, ì¬ì‚¬ìš© |
| ì¸ì¦ ë°©ì‹ | ì¿ í‚¤ ìë™ ì²¨ë¶€ | í´ë¼ì´ì–¸íŠ¸ê°€ ëª…ì‹œì ìœ¼ë¡œ í† í° ì „ì†¡ |

---

## ğŸ› ï¸ 3. ì¿ í‚¤ ì¸ì¦ ì„¤ì • (Program.cs)

### âœ… í•„ìˆ˜ ì„¤ì •

```csharp
builder.Services.AddAuthentication("MyCookieAuth")
    .AddCookie("MyCookieAuth", options =>
    {
        options.LoginPath = "/Account/Login";
        options.LogoutPath = "/Account/Logout";
        options.AccessDeniedPath = "/Account/AccessDenied";
        options.ExpireTimeSpan = TimeSpan.FromMinutes(30);
        options.SlidingExpiration = true;
    });

builder.Services.AddAuthorization();

var app = builder.Build();

app.UseAuthentication(); // ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
app.UseAuthorization();  // ê¶Œí•œ ë¯¸ë“¤ì›¨ì–´
```

---

## ğŸ“„ 4. ë¡œê·¸ì¸ ì²˜ë¦¬ íë¦„

### âœ… 1ë‹¨ê³„: ì‚¬ìš©ì ì¸ì¦ â†’ Claims ìƒì„±

```csharp
var claims = new List<Claim>
{
    new Claim(ClaimTypes.Name, "kimdohyun"),
    new Claim(ClaimTypes.Role, "Admin"),
};

var identity = new ClaimsIdentity(claims, "MyCookieAuth");
var principal = new ClaimsPrincipal(identity);
```

### âœ… 2ë‹¨ê³„: ë¡œê·¸ì¸ ì²˜ë¦¬ ë° ì¿ í‚¤ ë°œê¸‰

```csharp
await HttpContext.SignInAsync("MyCookieAuth", principal);
```

### âœ… 3ë‹¨ê³„: ì¸ì¦ ì¿ í‚¤ ìƒì„± â†’ ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡

> ì´í›„ ìš”ì²­ë¶€í„°ëŠ” ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ê³ , ì„œë²„ëŠ” í•´ë‹¹ ì¿ í‚¤ë¡œ ì‚¬ìš©ìë¥¼ ì‹ë³„í•¨

---

## âŒ 5. ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

```csharp
await HttpContext.SignOutAsync("MyCookieAuth");
```

---

## ğŸ“¦ 6. ì¿ í‚¤ ì˜µì…˜ ì£¼ìš” í•­ëª©

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `LoginPath` | ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ë¦¬ë””ë ‰ì…˜ë  ë¡œê·¸ì¸ ê²½ë¡œ |
| `AccessDeniedPath` | ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ìê°€ ì´ë™í•  ê²½ë¡œ |
| `ExpireTimeSpan` | ì¿ í‚¤ ìœ íš¨ ì‹œê°„ |
| `SlidingExpiration` | í™œë™ ì‹œ ë§Œë£Œ ì‹œê°„ ê°±ì‹  ì—¬ë¶€ |
| `Cookie.HttpOnly` | JSì—ì„œ ì ‘ê·¼ ë¶ˆê°€ (ê¸°ë³¸ê°’ true) |
| `Cookie.SecurePolicy` | HTTPSì—ì„œë§Œ ì¿ í‚¤ ì „ì†¡ ì—¬ë¶€ |

### âœ… ì˜ˆì‹œ

```csharp
options.Cookie.Name = "MyAuthCookie";
options.Cookie.HttpOnly = true;
options.Cookie.SecurePolicy = CookieSecurePolicy.Always;
```

---

## ğŸ” 7. ë³´ì•ˆ ì£¼ì˜ ì‚¬í•­

| í•­ëª© | ì„¤ëª… |
|------|------|
| **HTTPS í•„ìˆ˜** | ì¿ í‚¤ëŠ” ë°˜ë“œì‹œ HTTPS í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê¶Œì¥ |
| **XSS ë°©ì§€** | `HttpOnly`, `Secure` ì†ì„± í™œì„±í™” |
| **CSRF ë°©ì§€** | `SameSite` ì†ì„± ì„¤ì • + [AntiForgeryToken] ì‚¬ìš© |
| **Logout ì‹œ ì¿ í‚¤ ì‚­ì œ** | `SignOutAsync` í˜¸ì¶œ í•„ìˆ˜ |

---

## ğŸ“Œ 8. Razor Pages ë˜ëŠ” MVCì—ì„œ ì‚¬ìš© ì˜ˆì‹œ

### âœ… ë¡œê·¸ì¸ í¼ ì œì¶œ

```csharp
[HttpPost]
public async Task<IActionResult> Login(string username, string password)
{
    if (username == "admin" && password == "1234")
    {
        var claims = new List<Claim>
        {
            new Claim(ClaimTypes.Name, username),
            new Claim(ClaimTypes.Role, "Admin")
        };

        var identity = new ClaimsIdentity(claims, "MyCookieAuth");
        var principal = new ClaimsPrincipal(identity);

        await HttpContext.SignInAsync("MyCookieAuth", principal);
        return RedirectToPage("/Index");
    }

    return View("Login");
}
```

### âœ… ì¸ì¦ ë³´í˜¸

```csharp
[Authorize]
public IActionResult Dashboard()
{
    return View();
}

[Authorize(Roles = "Admin")]
public IActionResult AdminOnly()
{
    return View();
}
```

---

## ğŸ“Š 9. ì¿ í‚¤ ì¸ì¦ íë¦„ ìš”ì•½

```text
[ë¡œê·¸ì¸ ìš”ì²­]
    â†“
[ì‚¬ìš©ì ê²€ì¦] â†’ ClaimsPrincipal ìƒì„±
    â†“
[SignInAsync()] â†’ ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ ë°œê¸‰
    â†“
[ìš”ì²­ ì‹œ ì¿ í‚¤ ìë™ ì „ì†¡]
    â†“
[UseAuthentication()] â†’ ì‚¬ìš©ì ì¸ì¦ í™•ì¸
    â†“
[UseAuthorization()] â†’ ê¶Œí•œ í™•ì¸
```

---

## âœ… ìš”ì•½ ì •ë¦¬

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì¸ì¦ ë°©ì‹ | ì¿ í‚¤ ê¸°ë°˜, ì„œë²„ê°€ ì¿ í‚¤ë¥¼ ë°œê¸‰í•˜ê³  ì¸ì¦ ì¶”ì  |
| ì‚¬ìš© ëŒ€ìƒ | ASP.NET Core MVC, Razor Pages |
| ì¥ì  | ë¸Œë¼ìš°ì €ì— ìµœì í™”ëœ ì¸ì¦ ë°©ì‹ |
| ë‹¨ì  | JWTì— ë¹„í•´ ìœ ì—°ì„± ë–¨ì–´ì§, CSRF ì·¨ì•½ì„± ìˆìŒ |
| ì‚¬ìš© API | `SignInAsync`, `SignOutAsync`, `[Authorize]`, `ClaimsPrincipal` |