---
layout: post
title: AWS - S3 ë²„ì „ ê´€ë¦¬ì™€ ë³µì›
date: 2025-07-18 19:20:23 +0900
category: AWS
---
# ğŸ”„ AWS S3 ë²„ì „ ê´€ë¦¬ì™€ ë³µì› ì™„ë²½ ê°€ì´ë“œ (ì¬ì‘ì„± Â· ì‹¤ì „ í™•ì¥íŒ)

> ê·œì¹™: **ëª¨ë“  ì½”ë“œ ë¸”ë¡ì€ ``` ë¡œ, ìˆ˜ì‹ì€ ë°˜ë“œì‹œ $$...$$ ë¡œ ê°ì‹¼ë‹¤.**  
> ì´ ê¸€ì€ ë‹¹ì‹ ì˜ ì´ˆì•ˆì„ **í•µì‹¬ì„ ë³´ì¡´**í•˜ë©´ì„œ, **ì½˜ì†”/CLI/IaC ì‹¤ìŠµÂ·MFA DeleteÂ·ìˆ˜ëª…ì£¼ê¸°Â·ë ˆí”Œë¦¬ì¼€ì´ì…˜Â·ë¹„ìš©/ê°ì‚¬**ê¹Œì§€ ëŒ€í­ í™•ì¥í•œ ì¬ì‘ì„±ë³¸ì´ë‹¤.

---

## 0) ì™œ â€˜ë²„ì „ ê´€ë¦¬(Versioning)â€™ì¸ê°€?

- **ì‹¤ìˆ˜ ë°©ì§€**: ë®ì–´ì“°ê¸°/ì‚­ì œë¡œë¶€í„° ë°ì´í„° ë³´í˜¸  
- **ê°ì‚¬/ì¶”ì **: ë³€ê²½ ì´ë ¥ ìœ ì§€  
- **ë³µì›ë ¥**: íŠ¹ì • ì‹œì ìœ¼ë¡œ **ë¡¤ë°±** ê°€ëŠ¥  
- **ë³´ì•ˆ ì—°ê³„**: Object Lock, MFA Delete, S3 Access Logs/CloudTrailê³¼ ê²°í•©

> í•µì‹¬: ê°™ì€ í‚¤(Key)ì˜ ê°ì²´ë¥¼ ë‹¤ì‹œ ì—…ë¡œë“œí•´ë„ **ê¸°ì¡´ ê°ì²´ëŠ” ì§€ì›Œì§€ì§€ ì•Šê³ ** â€˜ê³¼ê±° ë²„ì „â€™ìœ¼ë¡œ ë³´ì¡´ëœë‹¤. ì‚­ì œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ì‚­ì œ ë§ˆì»¤(Delete Marker)** ì¶”ê°€ì¼ ë¿, ì‹¤ì œ ë°ì´í„°ëŠ” ë²„ì „ì— ë‚¨ëŠ”ë‹¤.

---

## 1) ê°œë… ì •ë¦¬ â€” ì‘ë™ ì›ë¦¬(ì´ˆì•ˆ ë³´ê°•)

| ì‘ì—… | ë‚´ë¶€ ë™ì‘ | ê²°ê³¼ |
|---|---|---|
| ë²„ì „ ê´€ë¦¬ ON | ìƒˆë¡œ ì—…ë¡œë“œë˜ëŠ” ëª¨ë“  ê°ì²´ì— **VersionId** í• ë‹¹ | ìµœì‹  ë²„ì „ì´ â€œí˜„ì¬â€ë¡œ í‘œì‹œ |
| ë®ì–´ì“°ê¸°(ê°™ì€ Key) | **ìƒˆ VersionId**ê°€ ìƒì„± | ê³¼ê±° ë²„ì „ì€ **ë³´ì¡´** |
| ì‚­ì œ | **Delete Marker**ë¼ëŠ” â€œê°€ë¦¼ë§‰â€ ë²„ì „ ì¶”ê°€ | ëª©ë¡ì—ì„œ ì‚¬ë¼ì ¸ ë³´ì´ë‚˜, ê³¼ê±° ë²„ì „ì€ ì¡´ì¬ |
| ë³µì›(ë˜ëŒë¦¬ê¸°) | íŠ¹ì • VersionIdë¥¼ ëŒ€ìƒìœ¼ë¡œ **ë³µì‚¬/ë§ˆì»¤ ì œê±°** | ì›í•˜ëŠ” ì‹œì ìœ¼ë¡œ ë¡¤ë°± |

> **ì¤‘ìš”**: ë²„ì „ ê´€ë¦¬ë¥¼ â€œí™œì„±í™”(Enabled)â€í–ˆë‹¤ê°€ â€œì¼ì‹œì¤‘ë‹¨(Suspended)â€í•´ë„ **ê¸°ì¡´ ë²„ì „ì€ ë‚¨ì•„ìˆë‹¤**. ì¼ì‹œì¤‘ë‹¨ ìƒíƒœì—ì„œ ì—…ë¡œë“œí•œ ê°ì²´ëŠ” **null VersionId**ë¥¼ ê°€ì§„ë‹¤.

---

## 2) ìˆ˜í•™ì ìœ¼ë¡œ ë³´ëŠ” ë¹„ìš© ê°ê°(ê°„ë‹¨ ê·¼ì‚¬)

ì›”ë³„ ì €ì¥ ë¹„ìš© ê·¼ì‚¬:
$$
\text{Cost}_{\text{storage}} \approx \sum_{v=1}^{V} (G_v \cdot c_{\text{class}(v)})
$$

- \(V\): ë³´ê´€ ì¤‘ì¸ **ì´ ë²„ì „ ìˆ˜**  
- \(G_v\): vë²ˆì§¸ ë²„ì „ì˜ **GiB**  
- \(c_{\text{class}(v)}\): í•´ë‹¹ ë²„ì „ì˜ **ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ë‹¨ê°€(ì›”/GiB)**

> ë²„ì „ì´ ëŠ˜ìˆ˜ë¡ ì €ì¥ë¹„ê°€ ì„ í˜• ì¦ê°€í•˜ë¯€ë¡œ, **ìˆ˜ëª…ì£¼ê¸°(Lifecycle)**ë¡œ **ë¹„ìµœì‹ (Noncurrent)** ë²„ì „ ìë™ ì •ë¦¬/ì•„ì¹´ì´ë¹™ì´ í•µì‹¬ì´ë‹¤.

---

## 3) ì‹¤ìŠµ A â€” ë²„í‚· ìƒì„± & ë²„ì „ ê´€ë¦¬ í™œì„±í™”

### 3.1 ì½˜ì†”(ìš”ì•½)
1) S3 â†’ **ë²„í‚· ìƒì„±** â†’ ì´ë¦„/ë¦¬ì „ ì§€ì •  
2) ìƒì„± í›„ ë²„í‚· â†’ **ì†ì„±(Properties) â†’ ë²„ì „ ê´€ë¦¬ â†’ í™œì„±í™”**

### 3.2 CLI

```bash
# ë²„í‚· ìƒì„±
aws s3api create-bucket \
  --bucket my-versioned-bucket \
  --create-bucket-configuration LocationConstraint=ap-northeast-2

# ë²„ì „ ê´€ë¦¬ í™œì„±í™”
aws s3api put-bucket-versioning \
  --bucket my-versioned-bucket \
  --versioning-configuration Status=Enabled

# ìƒíƒœ í™•ì¸
aws s3api get-bucket-versioning --bucket my-versioned-bucket
```

### 3.3 IaC (CloudFormation ìŠ¤ë‹ˆí«)

```yaml
Resources:
  VersionedBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: my-versioned-bucket
      VersioningConfiguration:
        Status: Enabled
```

### 3.4 IaC (Terraform ìŠ¤ë‹ˆí«)

```hcl
resource "aws_s3_bucket" "versioned" {
  bucket = "my-versioned-bucket"
}

resource "aws_s3_bucket_versioning" "versioned" {
  bucket = aws_s3_bucket.versioned.id
  versioning_configuration {
    status = "Enabled"
  }
}
```

---

## 4) ì‹¤ìŠµ B â€” ì—…ë¡œë“œ/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ

```bash
# ì—…ë¡œë“œ 1
echo "Hello Version 1" > test.txt
aws s3 cp test.txt s3://my-versioned-bucket/test.txt

# ì—…ë¡œë“œ 2 (ë®ì–´ì“°ê¸° â†’ ìƒˆ ë²„ì „ ìƒì„±)
echo "Hello Version 2" > test.txt
aws s3 cp test.txt s3://my-versioned-bucket/test.txt

# ì‚­ì œ(ì‹¤ì œ ì‚­ì œê°€ ì•„ë‹ˆë¼ Delete Marker ì¶”ê°€)
aws s3 rm s3://my-versioned-bucket/test.txt

# ë²„ì „/ì‚­ì œ ë§ˆì»¤ ì¡°íšŒ
aws s3api list-object-versions --bucket my-versioned-bucket --prefix test.txt
```

ì¶œë ¥ì˜ í•µì‹¬ í¬ì¸íŠ¸:
- `"Versions"` ë°°ì—´: ê°ì²´ì˜ ì‹¤ì œ ë²„ì „ë“¤(VersionId í¬í•¨)
- `"DeleteMarkers"` ë°°ì—´: ì‚­ì œ ë§ˆì»¤(VersionId í¬í•¨, IsLatest ì—¬ë¶€ í™•ì¸)

---

## 5) ë³µì›(ë¡¤ë°±) 2ê°€ì§€ ë°©ë²•

### ë°©ë²• 1) **íŠ¹ì • ë²„ì „ì„ í˜„ì¬ ë²„ì „ìœ¼ë¡œ ë³µì‚¬**
```bash
aws s3api copy-object \
  --bucket my-versioned-bucket \
  --copy-source my-versioned-bucket/test.txt?versionId=<VERSION_ID> \
  --key test.txt
```
- ì§€ì •í•œ `<VERSION_ID>`ë¥¼ **ìƒˆ ìµœì‹  ë²„ì „**ìœ¼ë¡œ ë³µì›(= copy-on-restore)

### ë°©ë²• 2) **ì‚­ì œ ë§ˆì»¤ ì œê±°(ì‚­ì œ ë³µêµ¬)**
```bash
aws s3api delete-object \
  --bucket my-versioned-bucket \
  --key test.txt \
  --version-id <DELETE_MARKER_VERSION_ID>
```
- ì‚­ì œ ë§ˆì»¤ë¥¼ ì§€ìš°ë©´, **ì´ì „ ìµœì‹  ê°ì²´ ë²„ì „**ì´ ë‹¤ì‹œ ë³´ì¸ë‹¤.

> ì–´ëŠ ë°©ë²•ì„ ì“°ë“  **ì›ë³¸ ê³¼ê±° ë²„ì „ ìì²´ëŠ” ìœ ì§€**ë˜ë©°, ë³µì› í–‰ìœ„ë„ ìƒˆ ë²„ì „ì„ ë§Œë“ ë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.

---

## 6) ì‹¤ë¬´ ì„¤ê³„ â€” ìˆ˜ëª…ì£¼ê¸°(Lifecycle)ë¡œ **ì˜¤ë˜ëœ ë²„ì „ ìë™ ì²˜ë¦¬**

### 6.1 ë¹„ìµœì‹  ë²„ì „ ìë™ ì‚­ì œ(180ì¼)

```json
{
  "Rules": [
    {
      "ID": "DeleteOldNoncurrentVersions",
      "Status": "Enabled",
      "Filter": { "Prefix": "" },
      "NoncurrentVersionExpiration": {
        "NoncurrentDays": 180
      }
    }
  ]
}
```

ì ìš©(ì˜ˆ: CLI):

```bash
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-versioned-bucket \
  --lifecycle-configuration file://lifecycle.json
```

### 6.2 ë¹„ìš© ìµœì í™”: ë¹„ìµœì‹  ë²„ì „ì„ Glacierë¡œ ì „í™˜

```json
{
  "Rules": [
    {
      "ID": "ArchiveNoncurrentToGlacier",
      "Status": "Enabled",
      "Filter": { "Prefix": "" },
      "NoncurrentVersionTransitions": [
        { "NoncurrentDays": 30, "StorageClass": "GLACIER" }
      ],
      "NoncurrentVersionExpiration": { "NoncurrentDays": 3650 }
    }
  ]
}
```

> 30ì¼ ì§€ë‚œ ë¹„ìµœì‹  ë²„ì „ì„ Glacierë¡œ ì•„ì¹´ì´ë¸Œ, 10ë…„ í›„ ì¼ê´„ ì‚­ì œ ì˜ˆì‹œ.

---

## 7) ë³´ì•ˆ ê°•í™” â€” **MFA Delete**ì™€ì˜ ê²°í•©

- **ê¸°ëŠ¥**: íŠ¹ì • ë¯¼ê° ì¡°ì‘(ë²„ì „ ì‚­ì œ/ë²„ì „ ê´€ë¦¬ ìƒíƒœ ë³€ê²½)ì— **MFA ì½”ë“œ** ìš”êµ¬
- **íŠ¹ì§•**:
  - **ë²„í‚· ì†Œìœ ì(ì¼ë°˜ì ìœ¼ë¡œ ë£¨íŠ¸)**ë§Œ í™œì„±í™”/ë¹„í™œì„±í™” ê°€ëŠ¥
  - **CLI/SDK**ë¡œë§Œ ì„¤ì •(ì½˜ì†”ì—ì„œ ì§ì ‘ í† ê¸€ ë¶ˆê°€í•œ ì ì´ ë§ìŒ)
  - ê³„ì •/ë¦¬ì „/ê±°ë²„ë„ŒìŠ¤ ì •ì±… ì¡°ê±´ì— ë”°ë¼ ì‚¬ìš©ì„± ì œì•½ì´ ìˆì„ ìˆ˜ ìˆìŒ

### 7.1 í™œì„±í™” ì˜ˆì‹œ(ê°€ëŠ¥í•œ í™˜ê²½ ê°€ì •)

```bash
# ë²„ì „ ê´€ë¦¬ 'Enabled' + 'MFA Delete Enabled' ë™ì‹œ ì ìš©
aws s3api put-bucket-versioning \
  --bucket my-versioned-bucket \
  --versioning-configuration Status=Enabled,MFADelete=Enabled \
  --mfa "arn:aws:iam::<ACCOUNT_ID>:mfa/root-account-mfa-device <CURRENT_OTP_CODE>"
```

> ì‹¤ì œ ìš´ì˜ì—ì„  **ë£¨íŠ¸ ê³„ì • MFA**ì™€ **ì •ì±…/í”„ë¡œì„¸ìŠ¤**ë¥¼ ì •êµíˆ ì„¤ê³„í•´ì•¼ í•œë‹¤.  
> MFA Deleteê°€ ì–´ë µë‹¤ë©´ ëŒ€ì•ˆìœ¼ë¡œ **Object Lock(Governance/Compliance)**ë¥¼ ê²€í† (ë¶ˆë³€ì„± ë³´ì¥).

---

## 8) ë ˆí”Œë¦¬ì¼€ì´ì…˜(Replication)ê³¼ ë²„ì „

- **ë²„ì „ ê´€ë¦¬ëœ ì›ë³¸** â†’ **ë²„ì „ ê´€ë¦¬ëœ ëŒ€ìƒ**ìœ¼ë¡œ **ë²„ì „ í¬í•¨ ë³µì œ** ê°€ëŠ¥  
- **CRR(Cross-Region Replication)** / **SRR(Same-Region Replication)** ì§€ì›  
- **ì‚­ì œ ë§ˆì»¤ ë³µì œ**, **í•„í„°(ì ‘ë‘ì‚¬/íƒœê·¸)**, **KMS ì•”í˜¸í™” í‚¤ ê¶Œí•œ** ì£¼ì˜

### 8.1 ê°„ë‹¨ ìŠ¤ë‹ˆí«(ì›ë³¸ ë²„í‚·ì— ê·œì¹™ ì„¤ì •)

```json
{
  "Role": "arn:aws:iam::<ACCOUNT_ID>:role/s3-replication-role",
  "Rules": [
    {
      "ID": "ReplicateAll",
      "Status": "Enabled",
      "Priority": 1,
      "DeleteMarkerReplication": { "Status": "Enabled" },
      "Filter": { "Prefix": "" },
      "Destination": {
        "Bucket": "arn:aws:s3:::my-versioned-bucket-dr",
        "StorageClass": "STANDARD_IA"
      }
    }
  ]
}
```

ì ìš©:

```bash
aws s3api put-bucket-replication \
  --bucket my-versioned-bucket \
  --replication-configuration file://replication.json
```

> ëŒ€ìƒ ë²„í‚·ë„ **ë²„ì „ ê´€ë¦¬ í™œì„±í™”** í•„ìˆ˜. KMS ì‚¬ìš© ì‹œ CMK ê¶Œí•œ(Encrypt/Decrypt/Replicate) êµì°¨ í—ˆìš© í•„ìš”.

---

## 9) ê´€ì¸¡ì„±/ê°ì‚¬ â€” ë³€ê²½ ì´ë ¥ ê°€ì‹œí™”

- **CloudTrail**: `PutObject`, `DeleteObject`, `PutBucketVersioning`, `DeleteMarkerCreated` ë“± ì´ë²¤íŠ¸ ê¸°ë¡  
- **S3 Access Logs / CloudTrail Lake / Athena**ë¡œ ë¶„ì„ ê°€ëŠ¥  
- **S3 Inventory**: ë²„í‚· ë‚´ ê°ì²´/ë²„ì „ ëª©ë¡ì„ ì •ê¸°ì ìœ¼ë¡œ CSV/ORC/Parquetë¡œ ì¶œë ¥

### 9.1 S3 ì¸ë²¤í† ë¦¬(ë²„ì „ í¬í•¨) êµ¬ì„± ì˜ˆì‹œ

```json
{
  "Destination": {
    "S3BucketDestination": {
      "AccountId": "<ACCOUNT_ID>",
      "Bucket": "arn:aws:s3:::my-inventory-bucket",
      "Format": "CSV",
      "Prefix": "inventory"
    }
  },
  "IsEnabled": true,
  "Id": "daily-inventory",
  "IncludedObjectVersions": "All",
  "Schedule": { "Frequency": "Daily" }
}
```

ì ìš©:

```bash
aws s3api put-bucket-inventory-configuration \
  --bucket my-versioned-bucket \
  --id daily-inventory \
  --inventory-configuration file://inventory.json
```

---

## 10) íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

| ì¦ìƒ | ì›ì¸ | í•´ê²° |
|---|---|---|
| ì‚­ì œí–ˆëŠ”ë°ë„ ê³¼ê±° ë²„ì „ ë‚¨ìŒ | ì •ìƒ ë™ì‘(ì‚­ì œ ë§ˆì»¤ ì¶”ê°€) | ë³µì›í•˜ë ¤ë©´ ë§ˆì»¤ ì œê±° or ê³¼ê±° ë²„ì „ ë³µì‚¬ |
| `AccessDenied` ë³µì› ì‹¤íŒ¨ | ê¶Œí•œ ë¶€ì¡±(`s3:GetObjectVersion`, `s3:CopyObject`) | IAM ì •ì±…/ë²„í‚· ì •ì±… ì ê²€ |
| ë¦¬ìŠ¤íŠ¸ì— null VersionId ë³´ì„ | ì¼ì‹œì¤‘ë‹¨ ìƒíƒœ ì—…ë¡œë“œ | ë²„ì „ ê´€ë¦¬ â€œí™œì„±í™”â€ í›„ ì¬ì—…ë¡œë“œ, í•„ìš” ì‹œ ìˆ˜ë™ ë³µì› |
| ë¹„ìš© ê¸‰ì¦ | ê³¼ê±°/ëŒ€ìš©ëŸ‰ ë²„ì „ ëˆ„ì  | Lifecycleë¡œ ë¹„ìµœì‹  ì „í™˜/ë§Œë£Œ, S3 Inventoryë¡œ ìƒì‹œ ëª¨ë‹ˆí„° |
| ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì•ˆ ë¨ | ëŒ€ìƒ ë²„í‚· ë²„ì „ ë¯¸í™œì„±, KMS ê¶Œí•œ, ì—­í•  ê¶Œí•œ | ëŒ€ìƒ ì„¤ì •/ê¶Œí•œ ì¬ì ê²€, ì‹¤íŒ¨ ì‚¬ìœ ëŠ” Replication status/metrics í™•ì¸ |

---

## 11) S3 ë²„ì „ ê´€ë¦¬ vs Object Lock (ìƒí˜¸ë³´ì™„)

| í•­ëª© | Versioning | Object Lock |
|---|---|---|
| ëª©ì  | ì´ë ¥/ë³µì› | **ì‚­ì œ/ìˆ˜ì • ë°©ì§€(ë¶ˆë³€ì„±)** |
| ì‚­ì œ ë°©ì§€ | ê¸°ë³¸ ë¶ˆê°€(ë²„ì „ ì‚­ì œ ê°€ëŠ¥) | **ê°€ëŠ¥**(Retention/Legal Hold) |
| ê·œì • ì¤€ìˆ˜ | ë³´ì¡°ì  | **ì¤€ìˆ˜ ì¤‘ì‹¬(Compliance ëª¨ë“œ)** |
| í•¨ê»˜ ì“°ê¸° | ê¶Œì¥(ì´ë ¥ + ë¶ˆë³€ì„±) | ê¶Œì¥(ë¶ˆë³€ì„ ê°€ì§€ëŠ” ê° ë²„ì „ì— ì´ë ¥ ìœ ì§€) |

---

## 12) ì‹¤ì „ íŒ(ì´ˆì•ˆ í™•ì¥)

- **ì •ì  ì›¹/ë°°í¬ ì‚°ì¶œë¬¼**: ìµœì‹ ë§Œ í•„ìš” â†’ ë¹„ìµœì‹  ë²„ì „ **ì¦‰ì‹œ Glacier ì „í™˜** ë˜ëŠ” **ì§§ì€ ë§Œë£Œ**  
- **ë°±ì—…/ë¡œê·¸**: ë¹„ìµœì‹  ë²„ì „ **ì¥ê¸° ë³´ì¡´** + **Object Lock(Governance/Compliance)**ë¡œ ë¶ˆë³€ì„±  
- **ëŒ€ìš©ëŸ‰ ë°”ì´ë„ˆë¦¬**: ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ ì‹œì—ë„ ë²„ì „ì€ ë™ì¼ ì›ì¹™. ì—…ë¡œë” ì¸¡ **ETag/ë¬´ê²°ì„±** ì ê²€  
- **íƒœê·¸/í´ older ì „ê°œ**: `env=prod`, `type=backup` ë“± íƒœê¹… â†’ Lifecycle/ë¹„ìš©/ê°ì‚¬ í•„í„°ë§ì— ìœ ë¦¬

---

## 13) ëª…ë ¹ ì¹˜íŠ¸ì‹œíŠ¸

```bash
# ë²„í‚· ë§Œë“¤ê¸° + ë²„ì „ ê´€ë¦¬ ì¼œê¸°
aws s3api create-bucket --bucket my-versioned-bucket \
  --create-bucket-configuration LocationConstraint=ap-northeast-2
aws s3api put-bucket-versioning --bucket my-versioned-bucket \
  --versioning-configuration Status=Enabled

# ì—…ë¡œë“œ 2íšŒ + ì‚­ì œ
aws s3 cp a.txt s3://my-versioned-bucket/a.txt
aws s3 cp a2.txt s3://my-versioned-bucket/a.txt
aws s3 rm s3://my-versioned-bucket/a.txt

# ë²„ì „/ì‚­ì œ ë§ˆì»¤ í™•ì¸
aws s3api list-object-versions --bucket my-versioned-bucket --prefix a.txt

# ë³µì›(íŠ¹ì • ë²„ì „ ë³µì‚¬)
aws s3api copy-object \
  --bucket my-versioned-bucket \
  --copy-source my-versioned-bucket/a.txt?versionId=<VER> \
  --key a.txt

# ì‚­ì œ ë³µêµ¬(ì‚­ì œ ë§ˆì»¤ ì œê±°)
aws s3api delete-object \
  --bucket my-versioned-bucket \
  --key a.txt \
  --version-id <DELETE_MARKER_ID>

# ìˆ˜ëª…ì£¼ê¸° ì ìš©
aws s3api put-bucket-lifecycle-configuration \
  --bucket my-versioned-bucket \
  --lifecycle-configuration file://lifecycle.json
```

---

## 14) ìš”ì•½(í•µì‹¬ë§Œ ì¬ì •ë¦¬)

| í•­ëª© | ë‚´ìš© |
|---|---|
| ë²„ì „ ê´€ë¦¬ í•µì‹¬ | **ë®ì–´ì“°ê¸°/ì‚­ì œì—ë„ ê³¼ê±° ë²„ì „ ë³´ì¡´** |
| ë³µì› | **íŠ¹ì • ë²„ì „ ë³µì‚¬** ë˜ëŠ” **ì‚­ì œ ë§ˆì»¤ ì œê±°** |
| ë¹„ìš© ê´€ë¦¬ | **Lifecycle**ë¡œ ë¹„ìµœì‹  ì „í™˜/ë§Œë£Œ, **Inventory**ë¡œ ê°€ì‹œí™” |
| ë³´ì•ˆ ê²°í•© | **MFA Delete**, **Object Lock**, **CloudTrail** |
| ìš´ì˜ ì›ì¹™ | í”„ë¡œë•ì…˜ì€ **ë²„ì „ ê´€ë¦¬+ì •ì±…** ê¸°ë³¸, ë³µì›/ì‚­ì œëŠ” **ìŠ¹ì¸ ì ˆì°¨**ë¡œ ê´€ë¦¬ |

---

## 15) ë³´ë„ˆìŠ¤ â€” ì•ˆì „í•œ â€œë¡¤ë°± ëŸ¬ë„ˆâ€ ìŠ¤í¬ë¦½íŠ¸(ì˜ˆì‹œ)

```bash
#!/usr/bin/env bash
# ì‚¬ìš©ë²•: ./rollback.sh <bucket> <key> <version-id>
set -euo pipefail

B=$1
K=$2
V=$3

echo "[*] ë³µì› ëŒ€ìƒ: s3://$B/$K (from version $V)"
aws s3api head-object --bucket "$B" --key "$K" --version-id "$V" >/dev/null

TMP="s3://$B/.restore-checkpoint/$(date +%s)-$K"
echo "[*] ì•ˆì „ì¥ì¹˜: í˜„ì¬ ìµœì‹ ì„ ë°±ì—… -> $TMP"
aws s3 cp "s3://$B/$K" "$TMP" || echo "[!] ìµœì‹  ë²„ì „ì´ ì—†ì„ ìˆ˜ë„ ìˆìŒ(ì‚­ì œ ìƒíƒœ)."

echo "[*] ì§€ì • ë²„ì „ ë³µì‚¬ -> ìµœì‹ ìœ¼ë¡œ ìŠ¹ê²©"
aws s3api copy-object \
  --bucket "$B" \
  --copy-source "$B/$K?versionId=$V" \
  --key "$K"

echo "[*] ì™„ë£Œ. list-object-versionsë¡œ ê²°ê³¼ í™•ì¸ ê¶Œì¥."
```

- **ë¡¤ë°± ì „ ìµœì‹ ë³¸ì„ ì•ˆì „ ìœ„ì¹˜ì— ë°±ì—…**(ì‹¤ìˆ˜ ëŒ€ì‘)  
- **ì§€ì • VersionIdë¥¼ ìƒˆ ìµœì‹ ìœ¼ë¡œ ìŠ¹ê²©** â†’ ì¦‰ì‹œ ë³µì›

---

ì´ë¡œì¨ **S3 ë²„ì „ ê´€ë¦¬ì™€ ë³µì›**ì˜ ì „ ê³¼ì •ì„ **ê°œë…â†’ì‹¤ìŠµâ†’ìš´ì˜â†’ë³´ì•ˆ/ë¹„ìš©** ê´€ì ì—ì„œ ì •ë¦¬í–ˆë‹¤.  
ë‹¹ì‹ ì˜ ì´ˆì•ˆì´ ê°•ì¡°í•œ **ì‹¤ìˆ˜ ë³µêµ¬/ì‚­ì œ ë³µì›**ì„ ìœ ì§€í•˜ë©´ì„œ, **MFA Delete, Lifecycle, Replication, Inventory, Object Lock ì—°ê³„**ê¹Œì§€ í™•ì¥í•˜ì—¬ **ìš´ì˜ ê°€ëŠ¥í•œ ê°€ì´ë“œ**ë¡œ ìŠ¹ê²©í–ˆë‹¤.