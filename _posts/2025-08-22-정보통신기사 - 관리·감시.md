---
layout: post
title: 정보통신기사 - 관리·감시
date: 2025-08-22 18:25:23 +0900
category: 정보통신기사
---
# 관리·감시: SNMP/NMS · 로그 · 이중화 총정리

## 0) 큰 그림: “관측성(Observability) = 메트릭 + 로그 + 트레이스 + 토폴로지 + 런북”

- **NMS**(Network Management System) = **수집(에이전트/폴러)** → **저장(TSDB/로그 저장소)** → **시각화** → **경보** → **자동/수동 대응**.  
- **데이터 원천**  
  - **메트릭**: **SNMP 폴링**, **스트리밍 텔레메트리(gNMI/MDT)**, **에이전트/노드익스포터**  
  - **이벤트/로그**: **Syslog(UDP/TCP/TLS)**, 장비 이벤트, 애플리케이션 로그  
  - **플로우**: **NetFlow/sFlow/IPFIX**(Top talker/대역폭/보안분석)  
  - **활성측정**: **IP SLA/TWAMP**(지연/지터/손실), synthetic probe  
- **HA/DR**: **관리 네트워크** 자체의 **이중화**(Out-of-Band 포함), **NMS/DB/Collector**의 다중화.

---

## 1) NMS 아키텍처(참조 모델)

### 1.1 구성요소
- **디스커버리**: L2/L3 스캔, CDP/LLDP/ARP/L3 라우팅 테이블 수집 → **토폴로지** 자동 생성.  
- **폴러/컬렉터**: SNMP/HTTP/텔레메트리 수집기 **샤딩**(수평 분산), 지역 PoP에 **에지 컬렉터** 배치.  
- **저장소**:  
  - **시계열(TSDB)**: RRD, InfluxDB, Prometheus TSDB, TimescaleDB  
  - **로그 스토어**: Elasticsearch/OpenSearch, Loki, ClickHouse  
- **시각화/경보**: Grafana, NMS 내장 대시보드, Alertmanager/Rule Engine  
- **구성관리/백업**: RANCID/Oxidized, Git 버전관리  
- **통합**: CMDB/ITSM(Jira/ServiceNow), Webhook/Slack/PagerDuty

### 1.2 토폴로지/의존성 모델
- **노드-링크 그래프** + **서비스 의존성 트리**(예: 코어 스위치 다운 → 하위 장비 N개 알람 **상관관계 억제**/루트코즈 1건).

---

## 2) SNMP 완전 가이드

### 2.1 버전/보안
- **v1**: 단순, 32-bit 카운터, **보안 취약**.  
- **v2c**: 64-bit 카운터, bulk 지원, **community string**(평문) → 내부망에서만 제한적 사용.  
- **v3(USM)**: **auth/priv** 보안.  
  - **레벨**: `noAuthNoPriv` / `authNoPriv` / **`authPriv`**(권장)  
  - **알고리즘**: auth=MD5/SHA/SHA-2(장비별), priv=DES/AES-128/256  
  - **VACM(View/Group/Access)**로 OID 접근 제어.

### 2.2 MIB/OID/트리
- **OID**: 점 표기(예 `1.3.6.1.2.1.1.3.0 = sysUpTime`)  
- **표준 MIB 예**  
  - **IF-MIB**: 인터페이스 상태/트래픽(IfOperStatus, ifHCInOctets/Out)  
  - **HOST-RESOURCES-MIB**: CPU/메모리/스토리지  
  - **ENTITY-SENSOR-MIB**: 온도/전압/팬 속도  
  - **RFC1213-MIB**: system/if/ip/tcp/udp(기초)  
- **벤더 MIB**: Cisco, Juniper, HPE 등 **엔터프라이즈 트리(1.3.6.1.4.1.9=시스코)**

### 2.3 PDU/동작
- **Get/GetNext/GetBulk**(폴링), **Set**(설정—운영망엔 최소화), **Trap/Inform**(푸시 이벤트).  
- **Trap vs Inform**: Trap=비보장 UDP, Inform=수신확인 필요(재전송) → **중요 이벤트**는 **Inform** 고려.

### 2.4 폴링 주기와 비용
- 코어/크리티컬: 30~60 s, 액세스/IoT: 1~5 min.  
- **대규모**: 인터페이스 수 × 주기 × 요청당 OID 수 → **폴러 샤딩**/스케줄 분산 필수.

### 2.5 명령 예시
```bash
# v2c 폴링
snmpget -v2c -c public 192.0.2.10 1.3.6.1.2.1.1.3.0          # sysUpTime
snmpwalk -v2c -c roString 192.0.2.10 IF-MIB::ifXTable        # 64-bit 카운터 일괄

# v3 폴링
snmpget -v3 -l authPriv -u nmsuser -a SHA -A 'AuthPass!' -x AES -X 'PrivPass!' \
  192.0.2.10 SNMPv2-MIB::sysName.0

# v3 트랩 수신기 테스트
snmptrap -v 2c -c pub 192.0.2.100 '' .1.3.6.1.6.3.1.1.5.3  \
  ifIndex i 5 ifDescr s "Gi0/1" ifAdminStatus i 1 ifOperStatus i 2
```

### 2.6 장비 설정 예

#### (A) Cisco IOS-XE: v3 + Trap/Inform
```bash
snmp-server view MONITOR iso included
snmp-server group NMS v3 priv read MONITOR
snmp-server user nmsuser NMS v3 auth sha AuthPass! priv aes 128 PrivPass!
snmp-server host 192.0.2.100 version 3 priv nmsuser udp-port 162
snmp-server enable traps snmp linkdown linkup coldstart warmstart
snmp-server ifindex persist
```

#### (B) Junos
```bash
set snmp name R1-CORE
set snmp location DC1
set snmp v3 usm local-engine user nmsuser authentication-sha AuthPass! privacy-aes128 PrivPass!
set snmp v3 vacm security-to-group security-model usm security-name nmsuser group nmsgrp
set snmp v3 vacm access group nmsgrp default-context-prefix security-model usm security-level privacy read-view all
set snmp trap-group NMS targets 192.0.2.100
set snmp trap-group NMS categories link
```

#### (C) Linux(net-snmpd)
```bash
# /etc/snmp/snmpd.conf
sysLocation DC1
sysContact netops@example.com
rouser nmsuser authPriv
# 제한 뷰
view all included .1
```

### 2.7 SNMP 베스트프랙티스
- 외부/게스트와 **L3 분리**, **관리 VLAN/VRF**에서만 허용.  
- v2c는 **ACL로 IP 고정** + “`public/private` 금지”.  
- v3 **authPriv** 기본, **키 주기적 롤테이션**.  
- **ifIndex persist**(재부팅 후 인덱스 변경 방지), **엔진 타임/부츠** 불일치 시 `snmp-engine` 재동기화.

---

## 3) 로그 관리(시스로그/이벤트)

### 3.1 레벨/형식
- **Severity 0–7**: 0=Emergency, 1=Alert, 2=Critical, 3=Error, 4=Warning, 5=Notice, 6=Informational, 7=Debug.  
- **프로토콜**: UDP 514(기본), **TCP 514**, **TLS 6514**(RFC 5425).  
- **서식**: 전통(BSD), **RFC 5424**(구조화 데이터 포함).

### 3.2 장비 설정
```bash
# Cisco
service timestamps log datetime msec localtime
logging trap warnings
logging host 192.0.2.200 transport tcp port 6514
logging origin-id hostname
# TLS는 플랫폼별 trustpoint/ssl profile 필요

# Junos
set system syslog host 192.0.2.200 any any
set system syslog host 192.0.2.200 source-address 10.0.0.1
set system syslog file messages any warning
```

### 3.3 수집 파이프라인(예: rsyslog → Logstash → OpenSearch/Grafana)
```bash
# /etc/rsyslog.d/10-inputs.conf
module(load="imudp")  input(type="imudp" port="514")
module(load="imtcp")  input(type="imtcp" port="514")
# RELP로 중앙 허브 전송
action(type="omrelp" target="rsyslog-hub.local" port="2514" tls="on")

# Logstash grok 예
filter {
  grok { match => { "message" => "%{CISCOTIMESTAMP:ts}:%{HOSTNAME:dev}: %%{DATA:fac}-%{INT:sev}-%{DATA:mnemonic}: %{GREEDYDATA:msg}" } }
}
```

### 3.4 운영 팁
- **시간 동기(NTP/PTP)** 필수(로그/메트릭 상관분석의 기준).  
- **과잉로그 억제**: Debug/Informational은 **필드** 또는 **임시**.  
- **이벤트 규칙**: “**IF sev≤3 AND 문자열 매치** → **P1 경보**”.

---

## 4) 플로우/텔레메트리

### 4.1 NetFlow/sFlow/IPFIX
- **NetFlow v5/v9**, **IPFIX**(표준), **sFlow**(샘플링 기반, L2~L7 헤더 일부).  
- **용도**: Top talker, DDoS/이상 트래픽, 회선 용량/청구.

**Cisco 예**
```bash
ip flow-export destination 192.0.2.220 2055
ip flow-export version 9
interface Gig0/1
 ip flow ingress
 ip flow egress
```

**sFlow 예(HPE/Arista 풍)**
```bash
sflow enable
sflow agent-ip 10.0.0.10
sflow collector 192.0.2.220 6343
sflow sampling-rate 1000
sflow polling-interval 30
```

### 4.2 스트리밍 텔레메트리(모델 주도)
- **gNMI/OpenConfig**, **Cisco MDT**: 상태/카운터를 **주기/이벤트 기반**으로 스트리밍 → **폴링 부하↓**, **저지연**.  
- 수신기: Telegraf gNMI 입력 → Influx/Prometheus, gNMIc → NATS/Kafka 등.

### 4.3 Prometheus + SNMP Exporter
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'snmp'
    scrape_interval: 60s
    static_configs:
      - targets: ['192.0.2.10','192.0.2.11']
    metrics_path: /snmp
    params:
      module: [if_mib]
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - target_label: instance
        source_labels: [__address__]
      - target_label: __address__
        replacement: snmp-exporter.local:9116
```

---

## 5) 지표/경보/SLO·SLI

### 5.1 계층별 핵심 지표
- **장비**: CPU, 메모리, 온도/팬, 전원, **sysUpTime**.  
- **인터페이스**: **ifHCIn/OutOctets**, 에러/드롭, duplex/speed, admin/oper 상태.  
- **무선/AP**: 연결 수, 채널 이용률, 재시도율.  
- **WAN 성능**: RTT/지터/손실(IP SLA/TWAMP).  
- **플로우**: 상위 10 호스트/애플리케이션, 95퍼센타일.

### 5.2 임계/지속시간(예)
- CPU **>85% 5분 지속** → 경보(P2).  
- 인터페이스 **down**(서버 NIC/업링크) → 즉시(P1).  
- 에러율 `inErrors+outErrors > 0.1%` 10분 → P2.  
- 온도 센서 **경고 임계치** 초과.

### 5.3 SLA/가용성 수식
- **가용성** $A$ → **허용 다운타임** $D$  
$$
D = (1-A)\times T
$$
- **예)** 월간 기준 $T=30\text{일}=43{,}200\text{분}$  
  - 99.9% → **43.2분**, 99.99% → **4.32분**, 99.999% → **0.432분(26초)**

### 5.4 95퍼센타일(청구/용량)
- 수집값 N개 정렬 후 **상위 5%** 버리고 **최대**가 95th.  
- 버스트를 배제한 현실 사용량 지표.

---

## 6) 이중화/HA 설계

### 6.1 관리 평면
- **관리 전용 VLAN/VRF** + **ACL/방화벽** + **Jump Host**.  
- **Out-of-Band**: **콘솔 서버**(모뎀/LTE 백업), 관리망 장애 시 접근 경로.  
- **NTP**: **이중**(내부/외부) + 하위에 심리스 제공.

### 6.2 장비/링크
- **이중 전원(PSU A/B)**, **UPS A/B 피드**, **PoE 스위치** 이중.  
- **링크 이중화**: LACP 포트채널, L3 ECMP, 링은 **RSTP/ERPS** 보호.  
- **게이트웨이 HA**: **VRRP/HSRP**  
```bash
interface Vlan10
 ip address 10.10.10.2 255.255.255.0
 standby 10 ip 10.10.10.1
 standby 10 priority 120 preempt
 standby 10 authentication md5 key-string H@Key
```

### 6.3 NMS/저장소 HA
- **수평 확장 컬렉터**(샤딩), **로드밸런서 VIP**(VRRP/Keepalived).  
- **DB**:  
  - TSDB(멀티 노드/리플리카), RRD는 분산 어려움 → **폴더 레이드+주기 백업**.  
  - ES/OpenSearch/Loki **클러스터**, 3노드 이상 쿼럼.  
- **경보**: 이중화(Primary/Secondary Alertmanager), **WebHook 이중**.

### 6.4 DR/백업
- **구성 백업**(Oxidized/RANCID) + **원격 Git 레포지토리**.  
- **스냅샷/스키마 백업**(DB), **오브젝트 스토리지**로 오프사이트 보관.  
- **복구 훈련**: 분기마다 **리스토어 리허설**.

---

## 7) 보안/접근제어

- **최소 권한**: SNMP **읽기전용** View, v3 authPriv.  
- **전송보안**: Syslog **TCP/TLS**, API/웹 **TLS**, 대시보드 **SSO**(OIDC/SAML).  
- **네트워크 제어**: 관리망은 **방화벽 기본 거부**, NMS↔장비 **포트 화이트리스트**(161/162, 514/6514, 2055/6343, gNMI 등).  
- **자격증명 관리**: Vault/Ansible Vault, **로테이션/오프보딩** 절차.  
- **감사**: 설정 변경 **감사 로그**(who/when/what), WORM/불변 스토리지.

---

## 8) 운영 절차와 런북

### 8.1 경보 수신 → 대응 플로우
1) **경보 수신**(심각도/서비스 영향 식별)  
2) **상관관계**: 상위 링크/코어 다운? 동일 서브넷 동시?  
3) **런북 실행**: 접속 명령/체크리스트(아래 예).  
4) **완화/우회**: 포트채널 리밸런싱, 백업 링크 가동, QoS 임시 정책.  
5) **원인분석(RCA)**, **사후보고(PIR)**, **지표 업데이트**.

### 8.2 표준 런북(샘플)
```yaml
runbook: "Interface Down – Uplink"
steps:
  - check_nms: "Confirm multiple child-down events → suspect parent"
  - cli:
      - "show interface status err-disabled"
      - "show lacp neighbor"
      - "show logging last 100 | include Gi0/1|Port-Channel1"
  - actions:
      - if "member down but Po up": "shut/no shut member; reseat optic"
      - if "all members down": "failover to backup Po via route-map"
  - escalate: "After 10 min no recovery → P1 war room"
```

---

## 9) 예제: 소규모 캠퍼스 NMS 구축 청사진

### 9.1 요구
- 코어 2대, 분배 4대, 액세스 30대, AP 120, 방화벽/라우터 4대.  
- 모니터링: 1분 폴링, 로그 7일 핫/90일 웜, 플로우 95th 청구.

### 9.2 제안
- **Prometheus + snmp_exporter**, **Loki(syslog)**, **Grafana**, **Alertmanager**.  
- **Collectors 2대(활/대기)**, **Prometheus 2대(페더레이션)**, **Loki 3노드**, **VRRP VIP**.  
- **NetFlow/IPFIX** → nProbe/ElastiFlow.

### 9.3 구성 스니펫
```bash
# Keepalived
vrrp_instance NMS {
  interface bond0
  virtual_router_id 51
  priority 120
  advert_int 1
  authentication { auth_type PASS auth_pass vrrpKey }
  virtual_ipaddress { 10.0.50.10/24 }
}
```

---

## 10) 계량/계산기(교육용)

### 10.1 다운타임 예산(월 기준)
$$
D = (1-A)\times 30\text{일} \times 24 \times 60\ \text{분}
$$

### 10.2 지연/지터/손실(활성측정)
- 평균 지연 $\bar{d}=\frac1N\sum d_i$  
- **지터(절대차 평균)** $J=\frac{1}{N-1}\sum |d_i-d_{i-1}|$  
- 손실률 $L=\frac{\text{손실 패킷}}{\text{총 송신}}\times100\%$

### 10.3 95퍼센타일
- 표본 $x_1..x_N$ 정렬, 인덱스 $k=\lceil 0.95N\rceil$, 값 $x_k$.

**파이썬 미니 도구**
```python
def downtime_minutes(availability):
    return (1-availability)*30*24*60
for a in [0.999, 0.9999, 0.99999]:
    print(a, round(downtime_minutes(a),2),"min/mo")

def p95(values):
    s=sorted(values); 
    from math import ceil
    return s[ceil(0.95*len(s))-1]
print("p95:", p95([1,2,3,4,100]))
```

---

## 11) 트러블슈팅 가이드

### 11.1 SNMP 타임아웃/인증실패
- v3 **engineID/time 불일치** → `authFail` 증가, 재등록/엔진 리셋.  
- ACL/방화벽 차단(UDP 161/162), MTU/프래그먼트 문제(특히 bulk).  
- **ifIndex 변동** → 그래프 깨짐 → `ifindex persist` 적용/재매핑.

### 11.2 Syslog 유실
- UDP 드랍 → **TCP/TLS/RELP** 전환, 수집기 **큐/디스크 스풀** 설정.  
- **타임스탬프 오차** → NTP 점검, 타임존/서머타임 확인.

### 11.3 플로우 수집량 과다
- 샘플링율 조정(sFlow 1/1000→1/2000), 템플릿/옵션 레코드 주기 튜닝.  
- 스토리지 핫스팟 → 인덱스/파티션 롤오버, 쿼리 캐시.

### 11.4 경보 폭주
- **경보 억제/딜레이**(예: 90초 지속 시 발화), **상관규칙**(상위 다운 시 하위 억제), **중복 제거**.

---

## 12) 보증·컴플라이언스

- **보존주기**: 운영 90일, 감사 1년(규정 준수에 맞춤).  
- **개인정보/민감정보**: 로그 **마스킹/토큰화**.  
- **불변성**: WORM 스토리지/오브젝트 락(규정 사건 대응).  
- **백업 테스트**: 샘플 복구 보고서와 캡처 저장.

---

## 13) 자주 묻는 Q&A

- **Q. v2c만 지원 장비가 많다. 보안은?**  
  **A.** 관리망 **격리+ACL 고정**+VPN 내부 전용. 가능 시 **텔레메트리(TLS)** 병행, **SNMP 키 난수**와 **IP 제한** 필수.

- **Q. Trap vs Polling, 무엇이 핵심?**  
  **A.** **둘 다**. **Trap은 즉시성**, **Polling은 베이스라인/가용성**. Trap 누락 대비 **폴링으로 검증**.

- **Q. 로그/메트릭/플로우 중 우선순위?**  
  **A.** **메트릭(가용성) → 로그(원인) → 플로우(영향/용량)** 순으로 단계적 도입.

---

## 14) 체크리스트(현장용)

- [ ] **관리망 분리**(VLAN/VRF), 방화벽 포트 화이트리스트  
- [ ] **SNMP v3 authPriv**, v2c는 ACL/IP 고정  
- [ ] **폴링 간격/샤딩** 설계, ifIndex persist  
- [ ] **Syslog TCP/TLS**, 디스크 스풀/백프레셔 설정  
- [ ] **NetFlow/sFlow/IPFIX** 수집기 이중화, 샘플링율 적정  
- [ ] **NTP 이중화**, 타임스탬프 표준화(RFC5424)  
- [ ] **경보 규칙**: 임계 + 지속시간 + 억제/상관  
- [ ] **HA**: VRRP VIP, Collector/DB 클러스터, 백업·DR 테스트  
- [ ] **보안**: 자격증명 금고/로테이션, 감사로그, SSO  
- [ ] **런북/연습**: 분기별 장애 모의훈련

---

## 15) 연습문제(풀이 포함)

**Q1.** SNMP v3 보안 레벨 3단계를 이름과 의미로 쓰시오.  
**A.** `noAuthNoPriv`(인증/암호화 없음), `authNoPriv`(인증만), **`authPriv`(인증+암호화)**.

**Q2.** 99.99% 월 가용성의 허용 다운타임(분)?  
**A.** $ (1-0.9999)\times 30\times 24\times 60 = \mathbf{4.32}\ \text{분} $.

**Q3.** 인터페이스 ifHCInOctets/OutOctets로 대역폭 사용률을 계산하는 기본식은?  
**A.** $\displaystyle \text{Util}=\frac{(C_{t}-C_{t-1})\times 8}{\text{Interval}\times \text{LinkSpeed}}\times 100\%$.

**Q4.** Trap과 Inform의 차이와 사용처?  
**A.** Trap은 **비보장**, Inform은 **수신확인/재전송**. **중요 이벤트**(전원 장애/환경 경보)는 **Inform** 고려.

**Q5.** syslog 레벨에서 Critical 이하만 수집하려면 임계값은?  
**A.** **sev ≤ 2** 수집(0~2).

**Q6.** VRRP에서 프리엠션과 우선순위의 역할?  
**A.** 우선순위 높은 라우터가 **Master**, **Preempt** 설정 시 회복 후 **마스터 재탈환**.

**Q7.** 경보 폭주를 줄이는 세 가지 방법은?  
**A.** **지속시간 조건**, **상관관계 억제**, **중복/플랩 억제(데드밴드)**.

---

## 16) 콤팩트 암기표(시험 직전 16줄)

1) **SNMP v3 authPriv + VACM** 기본, v2c는 ACL 고정  
2) **IF-MIB 64비트 카운터** 사용(10G↑)  
3) **Trap=비보장 / Inform=수신확인**  
4) syslog **0~7 레벨**, **TCP/TLS** 권장  
5) **NetFlow/sFlow/IPFIX** → Top talker/보안  
6) 텔레메트리 **gNMI/MDT**로 저지연 스트리밍  
7) **폴링 간격**: 코어 30–60s, 액세스 1–5m  
8) **가용성→다운타임** $D=(1-A)T$  
9) **95th** = 상위 5% 버리고 최대  
10) **관리망 분리**(VLAN/VRF) + **OOB**  
11) **VRRP/HSRP** 게이트웨이 이중화  
12) **Collector/DB 클러스터** + VIP/Keepalived  
13) **구성 백업** Oxidized/RANCID + Git  
14) **NTP 이중화**, 타임스탬프 표준화  
15) **경보 규칙**: 임계 + 지속 + 억제  
16) **런북/모의훈련**으로 MTTR↓  

---

## 17) 마무리

**관측성**은 “보여야 고친다”의 다른 말입니다. **SNMP/로그/플로우/텔레메트리**를 **표준 보안**으로 모으고,  
**경보·런북**을 **HA NMS** 위에 올리면, 트래픽 폭주든 전원 이슈든 **사전 경보 → 신속 복구** 사이클이 굴러갑니다.  
설계의 핵심은 **분리(관리망)**, **표준화(NTP/포맷)**, **이중화(Collector/DB/VIP)**, **운영(경보/런북/훈련)**입니다.
