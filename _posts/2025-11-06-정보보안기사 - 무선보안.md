---
layout: post
title: 정보보안기사 - 무선보안
date: 2025-11-06 23:25:23 +0900
category: 정보보안기사
---
# 무선보안(WPA3 / 802.1X / EAP, 무선 침입·차단)

## 0) 한눈 개요(Architecture)

```
[IdP/PKI/CA]───┐                      ┌──[SIEM/로그]
                └─[RADIUS(FreeRADIUS/NPS/ISE)]──┬──(syslog/eap logs)
[MDM/EDR/자산]─────┐                            │
                    └──[WLC/무선 컨트롤러/AP群]─┴─[WIDS/WIPS 센서]
                           │      │
                     (WPA3-Ent)  (WPA3-SAE/OWE)
                           │      │
                 [Corp/MDM 단말] [게스트/IoT/프린터]
                 (EAP-TLS/PEAP)   (PPSK/OWE/MAB)
```

- **권장 원칙**:  
  1) **WPA3-Enterprise + EAP-TLS + PMF=Required** (업무 SSID)  
  2) **WPA3-SAE + PMF** (소규모/가정/소규모 랩)  
  3) **OWE(Enhanced Open)** 또는 **게스트 전용 포털 + 격리** (게스트 SSID)  
  4) IoT/프린터 등 헤드리스는 **PPSK(개별 PSK)/MAB + 전용 VLAN**  
  5) **WIDS/WIPS**로 악성 AP/프레임 탐지, 로그 중앙화  

---

# 1) WPA3 핵심 — SAE / PMF / 192-bit Suite

## 1.1 WPA3-Personal (SAE: Simultaneous Authentication of Equals)
- **Dragonfly** 키 교환 기반의 **오프라인 사전대입 공격** 저항.  
- PSK가 아닌 **암호 기반 PAKE** → 캡처만으로 대량 크래킹 **난도↑**.  
- **PMF(Protected Management Frames, 802.11w)** **필수**: 디어소시에이션/디어소스로 인한 세션 끊기 **차단**.

### 보안성 직관(비밀번호 엔트로피)
$$
H \approx \log_2( |\Sigma|^{L} ) = L \cdot \log_2|\Sigma|
$$
- 예: 대소문자+숫자(62종), 길이 14 → $H \approx 14 \cdot \log_2 62 \approx 83$ bits 수준  
- **SAE라도 약한 패스**는 위험. **길이/사전 제외/무작위** 권장.

## 1.2 WPA3-Enterprise
- **802.1X/EAP**로 사용자/디바이스 인증 → **MSK→PMK 파생→4-way Handshake**  
- **PMF 필수**, **GCMP-256 / BIP-GMAC-256 / SHA-384** 등의 **“192-bit 보안 모드”** 지원(고보안).

## 1.3 Enhanced Open (OWE: Opportunistic Wireless Encryption)
- **오픈 SSID이지만, 각 STA에 1:1 암호화**(개별 PTK) → 스니핑 저감.  
- 포털이 필요한 게스트 환경에서 **“Open+Captive” 대신 OWE** 고려 (서로 배타적 구성 선택).

---

# 2) 802.1X / EAP 작동 원리

## 2.1 구성 요소
- **Supplicant**: 단말(Windows/Android/iOS/macOS, wpa_supplicant)  
- **Authenticator**: AP/WLC(포워더, EAPOL 처리)  
- **Authentication Server**: **RADIUS**(FreeRADIUS/NPS/ISE/ClearPass)

## 2.2 키 파생(요지)
- EAP(TLS/PEAP/TTLS…) 성공 → 서버가 **MSK(64B)** 발급 → PMK 파생 →  
- 4-way handshake로 **ANonce/SNonce + PMK**에서 **PTK** 생성 → 데이터 암호화.

> 용어: PMK=Pairwise Master Key, PTK=Pairwise Transient Key, GTK=Group Temporal Key.

## 2.3 EAP 방식 비교
| 방식 | 인증 강도 | 필요사항 | 장점 | 주의 |
|---|---|---|---|---|
| **EAP-TLS** | 최고 | 클라·서버 증명서 | 비밀번호 無, MITM 강 | **PKI 운용 필요** |
| **PEAP-MSCHAPv2** | 중 | 서버 증명서, 사용자 PW | 배포 쉬움 | MSCHAPv2 한계(암호 품질/내부 정책 필수) |
| **EAP-TTLS(PAP/CHAP)** | 중 | 서버 증명서 | 레거시 디렉터리 연동 | 내부 자격 증명 노출 위험 주의 |
| **EAP-FAST** | 중 | PAC 관리 | 빠른 핸드셰이크 | 운영 복잡성 |
> 실무 권장: **업무망=EAP-TLS**, 이행기엔 **PEAP** 혼용 후 단계적 전환.

---

# 3) 실습 1 — **WPA3-SAE(AP: hostapd / STA: wpa_supplicant)**

## 3.1 AP(hostapd) 설정
```conf
# /etc/hostapd/hostapd.conf (WPA3-SAE + PMF)
interface=wlan0
driver=nl80211
ssid=LAB-WPA3
hw_mode=a
channel=36
ieee80211d=1
ieee80211h=1

# WPA3-Personal
wpa=2
wpa_key_mgmt=SAE
sae_require_mfp=1                # PMF 필수
ieee80211w=2                      # PMF Required
rsn_pairwise=CCMP
sae_password=U7!mHGd6Yq4cR2tK    # 예시(무작위/길이 충분)
```

### 서비스
```bash
sudo systemctl enable --now hostapd
journalctl -u hostapd -f
```

## 3.2 클라이언트(wpa_supplicant)
```conf
# /etc/wpa_supplicant/wpa_supplicant.conf
ctrl_interface=/run/wpa_supplicant
update_config=1

network={
    ssid="LAB-WPA3"
    key_mgmt=SAE
    psk="U7!mHGd6Yq4cR2tK"
    ieee80211w=2
}
```
```bash
sudo wpa_cli reconfigure
wpa_cli status
```

> **검증 포인트**: 연결된 RSN IE에 **PMF=Required**, **AKM=SAE** 표기.

---

# 4) 실습 2 — **WPA3-Enterprise(EAP-TLS) with FreeRADIUS**

## 4.1 FreeRADIUS 설치(예: Ubuntu)
```bash
sudo apt-get update
sudo apt-get install -y freeradius freeradius-utils openssl
```

## 4.2 CA/서버/클라이언트 인증서(테스트용) 생성 스크립트(요지)
```bash
# /root/radius-pki.sh (요약)
set -e
mkdir -p pki/{ca,server,client}
# CA
openssl genrsa -out pki/ca/ca.key 4096
openssl req -x509 -new -nodes -key pki/ca/ca.key -sha256 -days 3650 \
  -subj "/CN=LAB RADIUS CA" -out pki/ca/ca.crt

# Server cert
openssl genrsa -out pki/server/server.key 3072
openssl req -new -key pki/server/server.key -subj "/CN=radius.lab.local" \
  -out pki/server/server.csr
openssl x509 -req -in pki/server/server.csr -CA pki/ca/ca.crt -CAkey pki/ca/ca.key \
  -CAcreateserial -out pki/server/server.crt -days 1825 -sha256 -extfile <(printf "subjectAltName=DNS:radius.lab.local")

# Client cert (단말)
openssl genrsa -out pki/client/user1.key 3072
openssl req -new -key pki/client/user1.key -subj "/CN=user1" -out pki/client/user1.csr
openssl x509 -req -in pki/client/user1.csr -CA pki/ca/ca.crt -CAkey pki/ca/ca.key \
  -CAcreateserial -out pki/client/user1.crt -days 730 -sha256
```

## 4.3 FreeRADIUS EAP-TLS 설정(발췌)
```conf
# /etc/freeradius/3.0/mods-enabled/eap
eap {
  tls-config tls-common {
    private_key_file = /root/pki/server/server.key
    certificate_file = /root/pki/server/server.crt
    ca_file = /root/pki/ca/ca.crt
    cipher_list = "DEFAULT:@SECLEVEL=2"
  }
  tls { tls = tls-common }     # EAP-TLS
  peap { tls = tls-common }    # (혼용 시)
}
```

### 클라이언트(AP/WLC) RADIUS 등록
```conf
# /etc/freeradius/3.0/clients.conf
client ap01 {
  ipaddr = 192.168.50.10
  secret = SuperRADIUSSecret!
  nas_type = other
}
```

### 사용자(인증서 기반이므로 users 파일은 선택)
```conf
# /etc/freeradius/3.0/users
user1 Cleartext-Password := "dummy"   # EAP-TLS는 패스워드 사용 안함(참고용)
```

### 디버그로 기동 및 테스트
```bash
sudo systemctl stop freeradius
sudo freeradius -X     # 포그라운드 디버그
# AP/WLC에서 RADIUS pointing 후 실제 EAP 시도
```

## 4.4 AP(hostapd) — WPA3-Enterprise(EAP-TLS)
```conf
# /etc/hostapd/hostapd.conf (WPA3-Ent + PMF)
interface=wlan0
ssid=CORP-WPA3ENT
wpa=2
wpa_key_mgmt=WPA-EAP
ieee80211w=2                 # PMF Required
rsn_pairwise=CCMP
auth_server_addr=192.168.50.20
auth_server_port=1812
auth_server_shared_secret=SuperRADIUSSecret!
```

## 4.5 동적 VLAN 할당(FreeRADIUS)
```conf
# /etc/freeradius/3.0/sites-enabled/default (post-auth 섹션 등)
update reply {
  Tunnel-Type := VLAN
  Tunnel-Medium-Type := IEEE-802
  Tunnel-Private-Group-Id := "20"   # 예: Sales=VLAN20
}
```

> **운영 팁**  
> - **EAP-TLS 우선**(머신/사용자 이중 인증도 가능)  
> - CRL/OCSP, **짧은 수명 인증서**(예: 90~365일) 권장  
> - MDM(인튠/Workspace ONE 등)으로 **프로파일·인증서 자동 배포**

---

# 5) 실습 3 — **PEAP-MSCHAPv2(이행기)**

## 5.1 FreeRADIUS에서 PEAP 허용(이미 설정됨)
```conf
# /etc/freeradius/3.0/mods-enabled/eap
eap {
  peap {  # 내부는 MSCHAPv2
    default_eap_type = mschapv2
  }
}
```

## 5.2 users 파일에 ID/PW
```conf
user2 Cleartext-Password := "S0m3Str0ngP@ss"
```

> **경고**: MSCHAPv2는 **약점**이 알려져 있음 → **강력 PW 정책 + TLS 서버 인증 검증** 필수,  
> 조속히 **EAP-TLS**로 전환하세요.

---

# 6) PMF(Protected Management Frames, 802.11w)

- 관리 프레임(Disassoc/Deauth, Action)의 **무결성 보호**  
- WPA3에서 **필수(Required)** → **Deauth Flood/미끼 끊기**에 강  
- **설정 키워드**: `ieee80211w=2`(hostapd), **WLC UI**에서는 “MFP/PMF Required”

---

# 7) 게스트/IoT 전략

- **게스트 SSID**:  
  - 최상: **OWE** (암호화 + 포털 별도)  
  - 또는 **Open + Captive Portal + Client Isolation** (L2 격리/VLAN 별도)  
- **IoT/프린터**:  
  - **PPSK(개별 PSK)** 또는 **MAB(RADIUS + MAC 인증)**  
  - **전용 VLAN/서브넷**, **북/남향 방화벽 정책** 최소화  
  - 관리용 프로토콜(Telnet/FTP) 금지, OTA/업데이트 전용 경로만 허용

---

# 8) 무선 침입 탐지/차단(WIDS/WIPS)

## 8.1 위협 목록
- **Rogue AP**(내부망 연결된 비인가 AP)  
- **Evil Twin**(정상 SSID/암호 흉내, Captive 포털/피싱)  
- **Deauth/Disassoc Flood**(서비스 저하)  
- **KARMA/Lure**(Probe Response 조작, 임의 AP로 유인)  
- **WPS PIN 공격**, **TKIP/레거시 취약성** 악용  
- **KRACK/프레임 재전송** 유사 행위(현대 스택은 대부분 패치)

## 8.2 오픈소스 도구
- **Kismet**: 스펙트럼/802.11/블루투스 등 센싱 & 지도화  
- **aircrack-ng**: airmon/airodump/aireplay(테스트; 합법 범위)  
- **Scapy**: 관리 프레임 모니터링/알림 스크립트 작성

### 예: **과도한 Deauth 탐지(Scapy)** — 알림 스크립트
```python
# deauth_watch.py — 모니터 인터페이스 필요(예: wlan0mon)
from scapy.all import *
import time
THRESH=20      # 초당 임계
WINDOW=1.0
cnt=0; last=time.time()

def cb(pkt):
    global cnt, last
    if pkt.haslayer(Dot11Deauth) or pkt.haslayer(Dot11Disas):
        cnt += 1
        now=time.time()
        if now - last >= WINDOW:
            if cnt >= THRESH:
                print(f"[ALERT] Deauth bursts: {cnt}/s at {time.strftime('%X')}")
            cnt=0; last=now

sniff(iface="wlan0mon", prn=cb, store=0)
```
> **주의**: 주파수 사용·패킷 주입은 법령·면허 이슈. **수동 수신/탐지**만 합법적 범위에서.

## 8.3 WIPS 정책(개념)
- **Authorized AP/SSID/BSSID 목록 화이트리스트**  
- SSID/BSSID/채널/암호군(RSN IE) **불일치** → **경보**  
- 유선에 연결된 Rogue(AP MAC↔스위치 포트 매핑) → **자동 차단(스위치 포트 shutdown)**  
- **Evil Twin** 의심: 같은 SSID+개방 암호+근접 RSSI+다른 OUI → 경보/차단

---

# 9) 컨트롤러/WLC·벤더 예시(개요)

## 9.1 Cisco WLC/NX-OS/IOS-XE(개념 CLI)
```cisco
wlan CORP-WPA3ENT 10 CORP-WPA3ENT
 security wpa wpa2 ciphers aes
 security pmf required
 security dot1x authentication-list RADIUS1
 no security wpa wpa1
 no security wpa akm psk
 security wpa akm dot1x
!
aaa group server radius RADIUS1
 server name RAD1
!
radius server RAD1
 address ipv4 192.168.50.20 auth-port 1812 acct-port 1813
 key SuperRADIUSSecret!
```

## 9.2 Aruba/Extreme/Ruckus
- 모두 **WPA3-Enterprise + PMF Required**, **EAP-TLS** 템플릿 제공  
- **Dynamic VLAN**, **DPSK/PPSK**, **WIPS** 기능 내장/모듈 제공

---

# 10) 로그/모니터링/포렌식

- **RADIUS(EAP)**: 인증 성공/실패, 이유 코드(불일치 CA/만료/CRL)  
- **AP/WLC**: Assoc/Reassoc/Deauth/PMF 위반, 802.11 상태 코드  
- **WIDS/WIPS**: Rogue/EvilTwin/Deauth 수치, 채널/프레임 통계  
- **대시보드**:  
  - 실패 Top-N(이유별), 인증서 만료 30일 내 목록, SSID별 실패율  
  - PMF 미지원 단말 목록(교체/정책)

예: FreeRADIUS syslog 레벨 상향 & SIEM 연동
```bash
# /etc/freeradius/3.0/radiusd.conf
log {
  destination = files
  colourise = no
  file = ${logdir}/radius.log
  syslog_facility = daemon
  stripped_names = yes
}
```

---

# 11) 운영 체크리스트

- [ ] **WPA3-Enterprise(EAP-TLS) + PMF Required**(업무 SSID)  
- [ ] **SAE**(소규모/임시) / **OWE**(게스트) / **Open+Portal+Isolation**(대안)  
- [ ] **TKIP/WEP/WPA/WPA2-PSK** → **전면 금지**  
- [ ] **WPS** 비활성  
- [ ] **2.4 GHz 최소화**, **5/6 GHz 우선**(채널 계획 포함)  
- [ ] **동적 VLAN/세분화**(영업/개발/관리 분리)  
- [ ] **MDM/EDR 연계**(비정상 단말 차단)  
- [ ] **PKI/CRL/OCSP** 운용(만료/폐기 자동화)  
- [ ] **WIDS/WIPS** 룰/화이트리스트 최신화, **스위치 포트 자동차단** 연계  
- [ ] **로그 중앙화**(RADIUS/AP/WIPS) & 월간 리뷰

---

# 12) 트러블슈팅

- **EAP-TLS 실패**:  
  - 서버/클라 **시간오차(NTP)**? CA 신뢰 사슬? SAN/FQDN 불일치?  
  - `freeradius -X`로 레코드 확인.  
- **PMF Required 연결 불가**: 레거시 단말(802.11w 미지원) → **교체** 또는 **전용 SSID**로 격리.  
- **SAE 연결 지연**: 일부 칩셋 드라이버/펌웨어 → **업데이트** 및 **채널 폭/암호군** 점검.  
- **Deauth 경보 빈발**: 실제 PMF 미적용 SSID? 이웃 AP? **RF 조정/채널 변경**.

---

# 13) Zero Trust 무선으로 확장

- **네트워크 신뢰 X** → **아이덴티티 + 디바이스 상태**로 접근  
- **RADIUS + SSO(IdP) 연계**: EAP-TLS에 **기기 Posture** 반영(조건부 접근)  
- **단말 인증서 짧은 수명** + **자동 갱신(MDM/SCEP/ACME)**  
- 무선 연결 후에도 **ZTNA 프록시(mTLS/JWT)** 로 **앱 단위 정책** 추가

---

# 14) 실전 과제(채점 관점 포함)

### A) WPA3-SAE AP/STA 구축 (15점)
- (5) hostapd SAE + PMF Required  
- (5) STA 연결/RSN IE 검증 캡처  
- (5) 약한 암호/강한 암호 시도 비교(로그 스니펫)

### B) WPA3-Enterprise(EAP-TLS) + 동적 VLAN (25점)
- (10) FreeRADIUS EAP-TLS 정상 동작(`freeradius -X` 캡처)  
- (8) 동적 VLAN 부여(사용자 그룹별 VLAN)  
- (7) 인증서 만료/폐기 테스트(거부 로그 증거)

### C) WIDS Deauth 알리미 (10점)
- (6) Scapy 스크립트 트리거 스크린샷  
- (4) 임계치·오탐 고려 설명

---

# 15) 부록 — 추가 스니펫 모음

## 15.1 wpa_cli 빠른 디버그
```bash
wpa_cli -i wlan0 log_level DEBUG
wpa_cli -i wlan0 status
wpa_cli -i wlan0 list_networks
```

## 15.2 hostapd 192-bit 보안(가능 장비 한정)
```conf
wpa_key_mgmt=WPA-EAP-SUITE-B-192
rsn_pairwise=GCMP-256
ieee80211w=2
```

## 15.3 NPS(Windows RADIUS) 개요(요지)
- 템플릿: **무선 802.1X(EAP-TLS)** 정책 생성 → 보안 그룹 매핑 → 인증서(컴퓨터용) 배포(GPO/MDM)  
- 이벤트 뷰어: **NPS 로그**(성공/실패 Reason Code) → SIEM 전송

---

## 마무리

- **업무 SSID는 WPA3-Enterprise(EAP-TLS) + PMF Required**가 표준.  
- **게스트는 OWE** 또는 **격리된 Open+Portal**, **IoT는 PPSK/MAB + 전용 VLAN**.  
- **WIDS/WIPS**로 **Rogue/Evil Twin/Deauth**를 지속 감시하고, **RADIUS/AP 로그**를 중앙화해  
  실패 원인/만료/취약 단말을 **월단위로 정리**하세요.  
- 마지막으로, **PKI/MDM/IdP**를 축으로 **Zero Trust**의 인증·인가를 무선에 이식하면,  
  **“네트워크=신뢰”**라는 과거 전제를 버리고 **사용자·기기·컨텍스트** 중심의 방어를 완성할 수 있습니다.
