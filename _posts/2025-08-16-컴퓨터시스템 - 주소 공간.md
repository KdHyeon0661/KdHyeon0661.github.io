---
layout: post
title: 컴퓨터시스템 - 주소 공간
date: 2025-08-16 20:20:23 +0900
category: 컴퓨터시스템
---
# 주소 공간(Address Space) — 메모리 관리의 논리적 지도

> **정의**  
> 주소 공간은 프로세스나 시스템이 사용할 수 있도록 **논리적으로 할당된 메모리 주소들의 집합**입니다.  
> 운영체제와 하드웨어는 이 주소 공간을 기반으로 **메모리 접근을 관리하고 보호**합니다.

---

## 1. 주소 공간의 개념

- **논리적 메모리 맵**: 프로세스가 바라보는 메모리 배치.
- 실제 물리 메모리(Physical Memory)와는 독립적이며, 가상 메모리 기법을 통해 매핑.
- 각 프로세스는 **자신만의 독립적인 주소 공간**을 가진다고 “착각”하도록 설계 → 다른 프로세스 간 메모리 침범 방지.

---

## 2. 주소 공간의 분류

### 2.1 사용자(User) 주소 공간
- **응용 프로그램 코드, 데이터, 스택, 힙** 등이 위치.
- 예시 (리눅스 x86-64):
  ```
  낮은 주소 → [코드] [데이터] [힙] ... [공유 라이브러리] ... [스택] ← 높은 주소
  ```

### 2.2 커널(Kernel) 주소 공간
- 운영체제 코드, 장치 드라이버, 커널 데이터 구조, I/O 매핑 등.
- 모든 프로세스에서 **공유**되지만, 사용자 모드에서는 접근 불가(U/S 비트).

---

## 3. 주소 공간의 구성 요소

| 영역          | 특징 |
|---------------|------|
| **코드 영역(Text Segment)** | 실행할 기계어 코드 저장, 일반적으로 읽기/실행만 가능(W^X 정책). |
| **데이터 영역(Data Segment)** | 전역 변수, static 변수 등, 프로그램 시작 시 초기화된 데이터. |
| **BSS 영역** | 초기화되지 않은 전역/정적 변수, 프로그램 시작 시 0으로 초기화. |
| **힙(Heap)** | 동적 메모리 할당(`malloc`/`new`), 런타임 중 크기 변동 가능. |
| **스택(Stack)** | 함수 호출 시 지역 변수, 매개변수, 복귀 주소 저장, 보통 높은 주소에서 낮은 주소로 성장. |
| **메모리 매핑 영역(MMAP Region)** | 공유 라이브러리, 메모리 매핑된 파일, 익명 매핑 영역 등. |

---

## 4. 가상 주소 공간과 물리 주소 공간의 관계

- **가상 주소 공간**: 프로세스가 인식하는 주소 체계.
- **물리 주소 공간**: DRAM 칩의 실제 주소 체계.
- **MMU**와 **페이지 테이블**이 가상→물리 변환 수행.
- 변환 단위: 페이지(Page) — 보통 4KB.

---

## 5. 주소 공간의 특징

1. **격리(Isolation)**  
   - 각 프로세스는 독립된 주소 공간 → 다른 프로세스 메모리에 접근 불가.
2. **보호(Protection)**  
   - 페이지 단위 권한(R/W/X) 제어.
3. **유연성(Flexibility)**  
   - 물리 메모리 위치와 무관하게 프로그램을 배치 가능.
4. **확장성(Extensibility)**  
   - 필요 시 스택/힙 확장, 메모리 매핑 추가 가능.

---

## 6. 주소 공간 배치 예시 (리눅스 x86-64, 단순화)

```
0x0000000000400000 [코드 섹션]
0x0000000000600000 [데이터 섹션]
0x0000000000800000 [힙 시작]  ↑
...
0x00007ffff7ff0000 [공유 라이브러리, mmap 영역]
0x00007ffffffde000 [스택 시작] ↓
0xffff800000000000 [커널 주소 공간 시작]
```

- **ASLR**(Address Space Layout Randomization) 적용 시 영역 시작 주소 무작위화.

---

## 7. 주소 공간 관리와 성능

- **TLB(Translation Lookaside Buffer)**: 가상→물리 변환 결과 캐싱.
- **페이지 크기 선택**: 4KB(기본) / 2MB(huge page) / 1GB.
- **지역성(Locality)**를 활용한 캐시 친화적 메모리 배치.
- **NUMA 환경**에서는 주소 공간 내 메모리 배치를 노드별로 최적화.

---

## 8. 보안과 주소 공간

- **NX 비트**: 데이터 영역 실행 금지.
- **W^X 정책**: 동일 페이지에서 쓰기·실행 권한을 동시에 주지 않음.
- **ASLR**: 코드/스택/힙/라이브러리 위치 무작위화.
- **SMEP/SMAP**: 커널 모드에서 사용자 메모리 실행·접근 제한.

---

## 9. 확인 및 실습

리눅스에서 현재 프로세스의 주소 공간을 확인:
```bash
cat /proc/$$/maps
```
출력 예:
```
00400000-00452000 r-xp  /usr/bin/bash
00651000-00652000 r--p  /usr/bin/bash
00652000-00653000 rw-p  /usr/bin/bash
...
7fff5c000000-7fff5c021000 rw-p  [stack]
```

---

## 10. 요약

- **주소 공간**은 프로그램의 논리적 메모리 구조로,  
  가상 메모리 기술과 MMU가 이를 물리 메모리로 매핑.
- 프로세스마다 독립적인 주소 공간을 갖기 때문에,  
  **보호, 유연성, 효율성**을 모두 달성할 수 있음.