---
layout: post
title: TCPIP - OSPF
date: 2025-08-30 22:25:23 +0900
category: TCPIP
---
# Open Shortest Path First (OSPF)

OSPF(Open Shortest Path First)는 대규모 엔터프라이즈 네트워크에서 가장 널리 사용되는 링크 상태 라우팅 프로토콜입니다. IETF에서 개발된 개방형 표준으로, RIP의 한계를 극복하고 확장성 있는 인터네트워킹을 제공합니다.

## OSPF 개요, 역사, 표준 및 버전

### 역사적 발전
OSPF는 1980년대 후반 인터넷의 급격한 성장에 대응하여 개발되었습니다:

**진화 과정:**
- **1989년**: OSPF 버전 1 (RFC 1131) - 실험적 버전
- **1991년**: OSPF 버전 2 (RFC 1247) - 상용화 기반
- **1998년**: OSPF 버전 2 개정 (RFC 2328) - 현재의 표준
- **1999년**: OSPF 버전 3 (RFC 2740) - IPv6 지원 추가
- **2008년**: OSPFv3 개정 (RFC 5340) - 확장성 향상

**개발 동기:**
- RIP의 15홉 제한과 느린 수렴 시간 문제 해결
- 대규모 네트워크에서의 확장성 요구
- 벤더 중립적 개방형 표준 필요
- 클래스풀 라우팅의 한계 극복

### OSPF의 핵심 특징

**주요 장점:**
1. **빠른 수렴**: 링크 상태 변화를 즉시 전체 네트워크에 전파
2. **확장성**: 계층적 영역 구조로 대규모 네트워크 지원
3. **루프 방지**: SPF 알고리즘이 루프 없는 경로 계산 보장
4. **VLSM/CIDR 지원**: 클래스리스 라우팅 완전 지원
5. **메트릭 다양성**: 대역폭 기반 비용 계산
6. **인증 지원**: 다양한 보안 인증 메커니즘 제공

**표준화 상태:**
- **표준 트랙**: IETF 표준 (RFC 2328)
- **IP 프로토콜 번호**: 89
- **멀티캐스트 주소**: 224.0.0.5 (AllSPFRouters), 224.0.0.6 (AllDRRouters)

## OSPF 기본 토폴로지와 링크 상태 데이터베이스 (LSDB)

### 링크 상태 개념
OSPF는 거리 벡터 프로토콜과 달리 **링크 상태 알고리즘**을 사용합니다:

```
각 OSPF 라우터:
1. 직접 연결된 네트워크(링크) 상태 파악
2. 링크 상태 광고(LSA) 생성
3. 모든 라우터로 LSA 플러딩
4. 모든 라우터가 동일한 LSDB 구축
5. 각 라우터가 독립적으로 SPF 알고리즘 실행
6. 최단 경로 트리 계산
```

### 링크 상태 데이터베이스 (LSDB)
LSDB는 네트워크의 전체 토폴로지 맵을 나타내는 데이터베이스입니다:

**LSDB 구성 요소:**
```
LSDB = [모든 라우터의 LSA 집합]
LSA = 네트워크 토폴로지 정보 단위
```

**LSDB 동기화:**
- 모든 라우터는 동일한 영역 내에서 **정확히 동일한 LSDB** 유지
- LSDB 동기화는 OSPF 인접 관계 수립의 핵심
- 데이터베이스 설명자(Database Descriptor) 패킷으로 LSDB 비교

**LSA 유형별 정보:**
1. **타입 1 (Router LSA)**: 라우터 자체의 링크 정보
2. **타입 2 (Network LSA)**: 다중 접속 네트워크 정보
3. **타입 3 (Summary LSA)**: 영역 간 경로 요약
4. **타입 4 (ASBR Summary LSA)**: ASBR 위치 정보
5. **타입 5 (AS External LSA)**: 외부 자율 시스템 경로
6. **타입 7 (NSSA External LSA)**: NSSA 영역의 외부 경로

### SPF 알고리즘 실행
```
다익스트라 알고리즘(Dijkstra's Algorithm) 적용:
1. 루트(자신)를 트리에 추가
2. 루트에서 직접 연결된 모든 링크 검사
3. 가장 낮은 비용의 링크 선택하여 트리 확장
4. 새로 추가된 노드에서 모든 링크 재검사
5. 모든 노드가 트리에 포함될 때까지 반복
```

**비용 계산:**
```
기본 비용 = 10^8 / 대역폭(bps)
예시:
- 100Mbps 이더넷: 10^8 / 100,000,000 = 1
- 10Mbps 이더넷: 10^8 / 10,000,000 = 10
- T1(1.544Mbps): 10^8 / 1,544,000 ≈ 64
```

## OSPF 계층적 토폴로지, 영역 및 라우터 역할

### 영역(Area) 개념
대규모 네트워크의 확장성을 위해 OSPF는 영역 기반 계층 구조를 도입했습니다:

**영역의 이점:**
1. **라우팅 테이블 크기 감소**: 영역 내부 라우팅만 상세, 외부는 요약
2. **LSDB 크기 제한**: 영역 경계에서 LSA 전파 제한
3. **SPF 계산 부하 감소**: 영역 내 변화만 재계산
4. **라우팅 업데이트 트래픽 감소**: 영역 경계에서 요약

### 영역 구조
```
                +-------------------+
                |   백본 영역       |
                |   (Area 0)        |
                +-------------------+
                 /                \
                /                  \
+-------------------+       +-------------------+
|   일반 영역       |       |   일반 영역       |
|   (Area 1)        |       |   (Area 2)        |
+-------------------+       +-------------------+
```

**영역 유형:**
- **백본 영역(Area 0)**: 모든 영역이 연결되어야 하는 필수 영역
- **일반 영역**: 백본에 직접 연결된 영역
- **스텁 영역(Stub Area)**: 외부 경로 수신 안 함 (타입 5 LSA 차단)
- **완전 스텁 영역(Totally Stubby Area)**: 외부 및 영역 간 경로 수신 안 함
- **NSSA(Not-So-Stubby Area)**: 외부 경로를 타입 7 LSA로 수신 가능

### 라우터 역할 분류
**영역 기반 분류:**
1. **내부 라우터**: 모든 인터페이스가 동일 영역에 속함
2. **영역 경계 라우터(ABR)**: 두 개 이상의 영역에 연결됨
   - 영역 간 LSA 요약(타입 3) 생성
   - 각 영역별 별도 LSDB 유지
3. **자율 시스템 경계 라우터(ASBR)**: OSPF와 다른 라우팅 프로토콜 간 재분배
   - 외부 경로를 타입 5 LSA로 광고

**네트워크 유형 기반 분류:**
1. **지정 라우터(DR)**: 다중 접속 네트워크에서 LSA 교환 조정
2. **백업 지정 라우터(BDR)**: DR의 장애 대비
3. **DROther**: DR/BDR이 아닌 일반 라우터

**DR/BDR 선출 과정:**
```
1. Hello 패킷 교환으로 우선순위 확인 (기본값: 1)
2. 우선순위 높은 라우터가 DR (0이면 DR 불참)
3. 우선순위 동일하면 라우터 ID 높은 라우터 선택
4. DR 선출 후 BDR 선출
5. 일단 선출되면 변경되지 않음 (선출 조건 변경 시 제외)
```

## OSPF 경로 결정과 SPF 트리

### 최단 경로 트리 계산
각 OSPF 라우터는 LSDB를 기반으로 **최단 경로 트리(SPF Tree)** 를 계산합니다:

**계산 단계:**
```
초기화:
1. 자신을 트리 루트로 설정, 비용 0
2. 인접한 모든 노드와 비용 기록

반복 과정:
1. 아직 트리에 없는 노드 중 가장 낮은 비용 노드 선택
2. 선택된 노드를 트리에 추가
3. 새 노드의 인접 노드 비용 재계산
   새 비용 = 현재 노드 비용 + 링크 비용
4. 더 낮은 비용 발견 시 업데이트

종료: 모든 노드가 트리에 포함되면 종료
```

**경로 결정 예시:**
```
네트워크 토폴로지:
    A --10-- B --5-- C
     \               /
      \--15-- D --8-/
      
라우터 A의 SPF 트리:
A(0) → B(10) → C(15 via B)
        → D(15) → C(23 via D)
        
최적 경로: A→B→C (비용 15)
```

### 라우팅 테이블 생성
SPF 트리 계산 후 각 목적지에 대한 최적 경로를 라우팅 테이블에 추가:

```
라우팅 테이블 항목:
- 목적지 네트워크
- 다음 홉 주소
- 출력 인터페이스
- 경로 비용
- 경로 유형 (영역 내/영역 간/외부)
```

## OSPF 일반 동작과 메시지 유형

### OSPF 인접 관계 수립 과정
```
상태 전이 과정:
Down → Init → 2-Way → ExStart → Exchange → Loading → Full

1. Down: 인접 관계 없음
2. Init: 상대방의 Hello 패킷 수신
3. 2-Way: 양방향 통신 확립 (DR/BDR 선출)
4. ExStart: 데이터베이스 동기화 시작, 시퀀스 번호 협상
5. Exchange: 데이터베이스 설명자(DBD) 교환
6. Loading: LSR/LSU/LSAck 교환으로 누락 LSA 요청
7. Full: 완전한 인접 관계, LSDB 동기화 완료
```

### OSPF 메시지 유형

**1. Hello 메시지 (타입 1)**
- 인접 관계 수립 및 유지
- 네트워크에서 라우터 발견
- DR/BDR 선출
- 매 10초(이더넷) 또는 30초(NBMA) 간격 전송

**2. 데이터베이스 설명자 (DBD, 타입 2)**
- LSDB 요약 정보 교환
- LSA 헤더만 포함 (실제 데이터 제외)
- 마스터/슬레이브 역할 결정

**3. 링크 상태 요청 (LSR, 타입 3)**
- 특정 LSA 요청
- DBD 비교 후 누락된 LSA 식별 시 전송

**4. 링크 상태 업데이트 (LSU, 타입 4)**
- 실제 LSA 데이터 전송
- 새로운 LSA 또는 업데이트된 LSA 포함
- 멀티캐스트 또는 유니캐스트로 전송

**5. 링크 상태 확인응답 (LSAck, 타입 5)**
- LSA 수신 확인
- 단일 LSA 또는 여러 LSA에 대한 일괄 응답

### OSPF 네트워크 유형별 동작

1. **브로드캐스트 (이더넷)**
   - DR/BDR 선출
   - 멀티캐스트 사용 (224.0.0.5, 224.0.0.6)
   - Hello 간격: 10초

2. **점대점 (PPP, HDLC)**
   - DR/BDR 없음
   - 직접 유니캐스트 통신
   - Hello 간격: 10초

3. **NBMA (프레임 릴레이, ATM)**
   - DR/BDR 선출
   - 유니캐스트 통신
   - Hello 간격: 30초
   - 추가 구성 필요 (neighbor 명령어)

4. **점대다점**
   - NBMA를 점대점처럼 동작
   - 서브인터페이스 사용
   - DR/BDR 없음

## OSPF 메시지 형식

### OSPF 패킷 일반 헤더
모든 OSPF 패킷은 24바이트 공통 헤더를 공유합니다:

```
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   버전 (2)   |     타입      |         패킷 길이             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       라우터 ID                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        영역 ID                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          체크섬              |             인증 타입         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       인증 데이터                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       인증 데이터 (계속)                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**헤더 필드 설명:**
- **버전**: OSPFv2는 2, OSPFv3는 3
- **타입**: 메시지 유형 (1-5)
- **패킷 길이**: OSPF 패킷 전체 길이 (바이트)
- **라우터 ID**: 32비트 고유 식별자 (일반적으로 가장 높은 IP 주소)
- **영역 ID**: 패킷이 속한 영역
- **인증 타입**: 0(없음), 1(일반 텍스트), 2(MD5)

### Hello 패킷 형식
```
공통 헤더 (24바이트) 이후:
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       네트워크 마스크                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Hello 간격          |    옵션     |    Rtr Pri      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     라우터 비활성화 간격                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    지정 라우터(DR)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   백업 지정 라우터(BDR)                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       인접 라우터 (반복)                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**Hello 패킷 필드:**
- **네트워크 마스크**: 인터페이스 서브넷 마스크
- **Hello 간격**: Hello 패킷 전송 간격 (초)
- **옵션**: OSPF 기능 지원 여부 (E 비트, MC 비트 등)
- **라우터 우선순위**: DR/BDR 선출용 (0-255)
- **라우터 비활성화 간격**: Hello 미수신 시 인접 관계 삭제 시간 (일반적으로 Hello 간격의 4배)
- **DR/BDR**: 현재 DR과 BDR의 라우터 ID
- **인접 라우터**: 인접 관계를 수립한 라우터 ID 목록

### LSA 공통 헤더
모든 LSA 유형은 20바이트 공통 헤더를 공유합니다:

```
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           LS 연령            |    옵션    |    LS 타입      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       링크 상태 ID                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     광고 라우터                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     LS 시퀀스 번호                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         LS 체크섬           |             길이              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**LSA 헤더 필드:**
- **LS 연령**: LSA 생성 후 경과 시간 (초)
- **LS 타입**: LSA 유형 (1-7)
- **링크 상태 ID**: LSA를 고유하게 식별하는 값
- **광고 라우터**: LSA를 생성한 라우터의 ID
- **LS 시퀀스 번호**: LSA 버전 식별, 오래된 LSA 감지용
- **LS 체크섬**: LSA 내용 무결성 검증
- **길이**: LSA 전체 길이 (바이트)

---

## 결론

OSPF는 링크 상태 라우팅 프로토콜의 정수로, 현대 엔터프라이즈 네트워크의 중추적 역할을 담당하고 있습니다. 그 성공의 핵심은 **계층적 설계 철학**에 있습니다. 단일 플랫 네트워크의 확장성 한계를 인식하고 영역(Area) 개념을 도입함으로써, 네트워크가 성장함에 따라 발생하는 LSDB 크기 증가와 SPF 계산 부하 문제를 우아하게 해결했습니다.

OSPF의 가장 큰 강점은 **빠른 수렴 속도**와 **루프 없는 경로 보장**입니다. 거리 벡터 프로토콜이 전체 경로 정보를 점진적으로 학습하는 반면, OSPF는 네트워크의 완전한 토폴로지 맵을 모든 라우터가 공유함으로써, 링크 장애 발생 시 영향을 받는 경로만 신속하게 재계산할 수 있습니다. 이는 대규모 네트워크에서의 안정성과 가용성을 크게 향상시킵니다.

DR/BDR 메커니즘은 다중 접속 네트워크에서의 효율적인 LSA 교환을 보장하며, 다양한 LSA 유형과 옵션은 복잡한 네트워크 요구사항을 충족시킵니다. 특히 타입 3 LSA를 통한 영역 간 경로 요약은 라우팅 테이블 크기를 효과적으로 관리하는 핵심 기법입니다.

그러나 OSPF의 강력함은 복잡성과 함께 옵니다. 올바른 영역 설계, 적절한 라우터 ID 관리, 다양한 네트워크 유형에 대한 정확한 구성은 성공적인 OSPF 구현을 위해 필수적입니다. 또한 OSPFv3로의 전환은 IPv6 환경에서의 지속적인 관련성을 보장하면서도 새로운 기능과 향상된 보안을 제공합니다.

오늘날 소프트웨어 정의 네트워킹(SDN)과 클라우드 네이티브 환경에서도 OSPF의 기본 원리는 여전히 유효합니다. 링크 상태 개념은 많은 현대 라우팅 프로토콜과 SDN 컨트롤러에 영감을 주었으며, OSPF 자체도 진화하여 대규모 데이터센터와 클라우드 환경에 적응하고 있습니다. 따라서 OSPF에 대한 깊은 이해는 네트워크 엔지니어가 현재와 미래의 네트워크 인프라를 효과적으로 설계하고 운영하는 데 필수적인 기초 지식으로 남아있습니다.