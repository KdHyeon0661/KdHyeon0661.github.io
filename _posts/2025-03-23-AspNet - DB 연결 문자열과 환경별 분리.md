---
layout: post
title: AspNet - DB ì—°ê²° ë¬¸ìì—´ê³¼ í™˜ê²½ë³„ ë¶„ë¦¬
date: 2025-03-22 20:20:23 +0900
category: AspNet
---
# ğŸ”— ASP.NET Coreì—ì„œ DB ì—°ê²° ë¬¸ìì—´ê³¼ í™˜ê²½ë³„ ë¶„ë¦¬ ì „ëµ

---

## ğŸ“Œ Connection Stringì´ë€?

DB ì—°ê²° ë¬¸ìì—´ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ì •ë³´ë¥¼ ë‹´ì€ ë¬¸ìì—´**ì…ë‹ˆë‹¤.

ë³´í†µ ë‹¤ìŒ ìš”ì†Œë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
Server=...;Database=...;User Id=...;Password=...;
```

### ğŸ”¹ SQL Server ì˜ˆì‹œ

```json
"ConnectionStrings": {
  "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=MyAppDb;Trusted_Connection=True;"
}
```

---

## ğŸŒ í™˜ê²½ë³„ êµ¬ì„± í•„ìš”ì„±

ê°œë°œ í™˜ê²½ì—ì„œëŠ” LocalDBë‚˜ SQLite,  
ìš´ì˜ í™˜ê²½ì—ì„œëŠ” Azure SQL ë˜ëŠ” PostgreSQLì„ ì“°ëŠ” ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì—  
**í™˜ê²½ë§ˆë‹¤ ë‹¤ë¥¸ ì—°ê²° ë¬¸ìì—´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”**í•©ë‹ˆë‹¤.

---

## ğŸ“ í™˜ê²½ë³„ êµ¬ì„± íŒŒì¼

ASP.NET CoreëŠ” ë‹¤ìŒê³¼ ê°™ì€ **ê³„ì¸µì ì¸ ì„¤ì • íŒŒì¼ êµ¬ì¡°**ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤:

```
appsettings.json                    <- ê³µí†µ ì„¤ì •
appsettings.Development.json        <- ê°œë°œ í™˜ê²½ ì „ìš©
appsettings.Production.json         <- ìš´ì˜ í™˜ê²½ ì „ìš©
```

ğŸ‘‰ ê¸°ë³¸ íŒŒì¼ì—ì„œ ê³µí†µ ê°’ì„ ì •ì˜í•˜ê³ ,  
í™˜ê²½ë³„ íŒŒì¼ì—ì„œ **Override**í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

---

## âœ… 1. `appsettings.json` (ê¸°ë³¸ê°’)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=DevDb;Trusted_Connection=True;"
  }
}
```

---

## âœ… 2. `appsettings.Development.json` (ê°œë°œ ì „ìš©)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=DevDb;User Id=dev;Password=dev123;"
  }
}
```

---

## âœ… 3. `appsettings.Production.json` (ìš´ì˜ ì „ìš©)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=prod-sql;Database=ProdDb;User Id=admin;Password=prodSecret!"
  }
}
```

---

## âš™ï¸ í™˜ê²½ ê°ì§€ ë° ì„¤ì • ì ìš©

### âœ… `Program.cs`

```csharp
var builder = WebApplication.CreateBuilder(args);

// í™˜ê²½ ê°ì§€
var env = builder.Environment;

// í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ ìë™ ë¡œë“œ
builder.Configuration
    .SetBasePath(Directory.GetCurrentDirectory())
    .AddJsonFile("appsettings.json", optional: false)
    .AddJsonFile($"appsettings.{env.EnvironmentName}.json", optional: true)
    .AddEnvironmentVariables();

// ì„œë¹„ìŠ¤ ë“±ë¡
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
```

> ê¸°ë³¸ì ìœ¼ë¡œ í…œí”Œë¦¿ì—ëŠ” ì´ë¯¸ ì´ êµ¬ì¡°ê°€ í¬í•¨ë¼ ìˆì–´ìš”.

---

## ğŸ’¡ ì‹¤í–‰ í™˜ê²½ ì„¤ì • ë°©ë²•

### 1. ë¡œì»¬ì—ì„œ ì‹¤í–‰ ì‹œ

**launchSettings.json**ì—ì„œ í™˜ê²½ ì§€ì •:

```json
"profiles": {
  "MyApp": {
    "commandName": "Project",
    "environmentVariables": {
      "ASPNETCORE_ENVIRONMENT": "Development"
    }
  }
}
```

### 2. CLIë¡œ ì‹¤í–‰ ì‹œ

```bash
ASPNETCORE_ENVIRONMENT=Production dotnet run
```

### 3. Azure ë°°í¬ ì‹œ

Azure App Serviceì—ì„œ **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • > í™˜ê²½ ë³€ìˆ˜** ì¶”ê°€:

```
ASPNETCORE_ENVIRONMENT = Production
```

---

## ğŸ›¡ï¸ ë³´ì•ˆ íŒ

| í•­ëª© | ì„¤ëª… |
|------|------|
| ğŸ” ë¯¼ê° ì •ë³´ ë³´í˜¸ | `User Id`, `Password`ëŠ” Gitì— ì˜¬ë¼ê°€ì§€ ì•Šê²Œ ì£¼ì˜ |
| ğŸ”„ ë¹„ë°€ ë¶„ë¦¬ | ë¹„ë°€ë²ˆí˜¸ëŠ” **í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” Secret Manager**ë¡œ ë¶„ë¦¬ ê¶Œì¥ |
| ğŸ” ì‹¤ìˆ˜ ë°©ì§€ | `appsettings.json`ì€ ê°œë°œ ì „ìš©, ì‹¤ìš´ì˜ ì •ë³´ëŠ” `.env` ë˜ëŠ” KeyVaultì— |

---

## âœ… Secret Manager ì˜ˆì‹œ (.NET ê°œë°œ í™˜ê²½)

```bash
dotnet user-secrets init
dotnet user-secrets set "ConnectionStrings:DefaultConnection" "Server=...;Database=...;"
```

`appsettings.json`ì—ëŠ” ì €ì¥í•˜ì§€ ì•Šê³ , ê°œë°œ PCì—ë§Œ ì €ì¥ë¨.

`Program.cs`ì—ì„œëŠ” ìë™ìœ¼ë¡œ ë°˜ì˜ë¨:

```csharp
builder.Configuration.AddUserSecrets<Program>();
```

---

## ğŸ” ë‹¤ì¤‘ ì—°ê²° ë¬¸ìì—´ ì˜ˆì‹œ

```json
"ConnectionStrings": {
  "DefaultConnection": "...",
  "LoggingDb": "Server=...;Database=LogsDb;",
  "ReadOnlyDb": "Server=...;ApplicationIntent=ReadOnly;"
}
```

```csharp
var conn1 = builder.Configuration.GetConnectionString("LoggingDb");
```

---

## âœ… ìš”ì•½

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì„¤ì • íŒŒì¼ ë¶„ë¦¬ | `appsettings.[env].json` |
| í™˜ê²½ êµ¬ë¶„ ë³€ìˆ˜ | `ASPNETCORE_ENVIRONMENT` |
| í”„ë¡œê·¸ë¨ ë‚´ ê°ì§€ | `builder.Environment.EnvironmentName` |
| ë¯¼ê° ì •ë³´ ê´€ë¦¬ | User Secrets, í™˜ê²½ ë³€ìˆ˜, KeyVault |
| ì„œë¹„ìŠ¤ ë“±ë¡ | `builder.Configuration.GetConnectionString("DefaultConnection")` |

---

## ğŸ”œ ì¶”ì²œ ë‹¤ìŒ ì£¼ì œ

- âœ… EF Coreì—ì„œ ì—¬ëŸ¬ DB ì—°ê²° êµ¬ì„±
- âœ… ì—°ê²° í’€ë§ê³¼ ì„±ëŠ¥ ì„¤ì •
- âœ… Cloud DB ì ‘ì† (Azure SQL, RDS)
- âœ… Secret Manager, í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ì „ëµ
- âœ… appsettings ë‚´ ë‹¤ë¥¸ ì„¤ì • (`Logging`, `FeatureFlags`, `SMTP`)

---

í™˜ê²½ë³„ ì—°ê²° ë¬¸ìì—´ì„ ì˜ ë‚˜ëˆ„ì–´ ì„¤ì •í•˜ë©´  
**ì‹¤ìˆ˜ ì—†ëŠ” ë°°í¬ì™€ ì•ˆì •ì ì¸ ìš´ì˜ì´ ê°€ëŠ¥**í•´ì ¸ìš”!

íŠ¹íˆ ì‹¤ìš´ì˜ í™˜ê²½ì—ì„  Git ì»¤ë°‹ ë°©ì§€, ì•”í˜¸í™”, ë³´ì•ˆ ì„¤ì •ì„ ê¼­ ì§€ì¼œì•¼ í•´ìš”.