---
layout: post
title: C++ - ë©”ëª¨ë¦¬ ê´€ë¦¬
date: 2024-09-18 19:20:23 +0900
category: Cpp
---
# ë©”ëª¨ë¦¬ ê´€ë¦¬ì™€ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„° â€” RAII, ì†Œìœ ê¶Œ, ìˆœí™˜ ì°¸ì¡°, ì»¤ìŠ¤í…€ ì‚­ì œì, ìŠ¤ë ˆë“œ ì•ˆì „ì„±ê¹Œì§€

## ì™œ â€œìŠ¤ë§ˆíŠ¸ í¬ì¸í„°â€ì¸ê°€? â€” RAIIì™€ ì˜ˆì™¸ ì•ˆì „

C++ì˜ ì˜ˆì™¸ ì•ˆì „ í•µì‹¬ì€ **RAII(Resource Acquisition Is Initialization)**.
â€œíšë“=ì´ˆê¸°í™”, í•´ì œ=ì†Œë©¸ìâ€ì˜ ë“±ì‹ìœ¼ë¡œ ìì›ì„ **ìŠ¤ì½”í”„ ì¢…ë£Œ ì‹œ ìë™ í•´ì œ**í•œë‹¤.

- Raw pointerëŠ” `new`/`delete`ë¥¼ **ëª¨ë“  ê²½ë¡œ**ì—ì„œ ì§ ë§ì¶”ê¸° ì–´ë ¤ì›Œ ëˆ„ìˆ˜/ì´ì¤‘í•´ì œ/ëŒ•ê¸€ë§ì„ ì´ˆë˜.
- ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°ëŠ” **ì†Œìœ ê¶Œ ëª¨ë¸**ì„ íƒ€ì…ì— ë‹´ì•„ **ì»´íŒŒì¼ íƒ€ì„ ì œì•½** + **ìŠ¤ì½”í”„ ê¸°ë°˜ í•´ì œ**ë¥¼ ë³´ì¥.

ì˜ˆì™¸ ì•ˆì „ 3ë‹¨ê³„(ê°•ë„):

- **ê¸°ë³¸ ë³´ì¥**: ì˜ˆì™¸ ë°œìƒí•´ë„ ìì› ëˆ„ìˆ˜ ì—†ìŒ.
- **ê°• ë³´ì¥**: ì˜ˆì™¸ ì‹œ **ë¶ˆë³€**.
- **No-throw**: ì˜ˆì™¸ ì—†ìŒ.

ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°ëŠ” ìµœì†Œ **ê¸°ë³¸ ë³´ì¥**ì„ ì‰½ê²Œ ë‹¬ì„±í•˜ê²Œ í•´ ì¤€ë‹¤.

---

## ë©”ëª¨ë¦¬ ëª¨ë¸ê³¼ ìš©ì–´ ë¹ ë¥´ê²Œ ì •ì˜

- **ì†Œìœ (own)**: ê°ì²´ íŒŒê´´ ì±…ì„.
- **ì´ë™(move)**: ì†Œìœ ê¶Œ ì´ì „(ì›ë³¸ì€ `nullptr`).
- **ê³µìœ (shared)**: ì°¸ì¡° ì¹´ìš´íŠ¸ë¡œ **ë§ˆì§€ë§‰ ì†Œìœ ì**ê°€ í•´ì œ.
- **ê´€ì°°(weak)**: ì†Œìœ  ì•ˆ í•˜ê³  ìƒì¡´ ì—¬ë¶€ë§Œ ê´€ì°°.

ìˆ˜ì‹ìœ¼ë¡œ ë³´ë©´, shared_ptrì˜ íŒŒê´´ ì‹œì ì€

$$
\text{destroy}(p) \iff \text{use\_count}(p)=0
$$

---

## `unique_ptr<T>` â€” ê°€ì¥ ê°€ë³ê³  ë¹ ë¥¸ â€œë‹¨ë… ì†Œìœ â€

### ê¸°ë³¸ íŒ¨í„´

```cpp
#include <memory>
#include <utility>
#include <iostream>

struct Foo { Foo(){ std::cout << "Foo()\n"; } ~Foo(){ std::cout << "~Foo()\n"; } };

int main() {
    auto p = std::make_unique<Foo>();        // ìƒì„± + ë‹¨ë… ì†Œìœ 
    auto q = std::move(p);                   // ì†Œìœ ê¶Œ ì´ë™
    // pëŠ” nullptr, që§Œ ì†Œìœ 
} // q ì†Œë©¸ â‡’ Foo ìë™ íŒŒê´´
```

- ë³µì‚¬ ê¸ˆì§€, **ì´ë™ ì „ìš©**.
- ì˜ˆì™¸ ì•ˆì „ì„±ì´ ë†’ê³  ì˜¤ë²„í—¤ë“œ **0(ì œì–´ ë¸”ë¡ ì—†ìŒ)**.

### ë°°ì—´ / ì»¤ìŠ¤í…€ ì‚­ì œì

```cpp
auto arr = std::make_unique<int[]>(1024); // delete[] í˜¸ì¶œ
arr[0] = 42;

// ì»¤ìŠ¤í…€ ì‚­ì œì(í•¨ìˆ˜ ê°ì²´)
struct FILECloser { void operator()(FILE* f) const noexcept { if (f) std::fclose(f); } };
using FileUPtr = std::unique_ptr<FILE, FILECloser>;

FileUPtr f(std::fopen("data.txt", "r")); // ìë™ fclose
```

> **ê·œì¹™**
> - ë™ì  ë°°ì—´ì€ **ë°˜ë“œì‹œ** `unique_ptr<T[]>`.
> - ë¦¬ì†ŒìŠ¤ í•¸ë“¤(íŒŒì¼/ì†Œì¼“/ë®¤í…ìŠ¤)ì—” **ì»¤ìŠ¤í…€ ì‚­ì œì**ë¡œ RAIIë¥¼ ë¶€ì—¬.

### í´ë¦¬ëª¨í”½ ì‚­ì œì (ëŸ°íƒ€ì„ ì§€ì—° ë°”ì¸ë”©)

```cpp
std::unique_ptr<Base, void(*)(Base*)> p(create_polymorphic(), [](Base* b){ destroy_polymorphic(b); });
```

- ì‚­ì œìë¥¼ **íƒ€ì… ì§€ìš°ê¸°**(type erasure)í•˜ì—¬ **ì¸í„°í˜ì´ìŠ¤ ê²½ê³„**ì—ì„œ ìœ ì—°ì„±â†‘.

---

## `shared_ptr<T>` â€” ì»¨íŠ¸ë¡¤ ë¸”ë¡ & ì°¸ì¡° ì¹´ìš´íŒ…

### ì»¨íŠ¸ë¡¤ ë¸”ë¡ êµ¬ì¡°(ê°œë…)

```
[ Control Block ]
  use_count   --> shared ì†Œìœ ì ìˆ˜
  weak_count  --> weak ê´€ì°°ì ìˆ˜ + shared ì¡´ì¬ìˆ˜
  deleter     --> ì‚­ì œì(ì„ íƒ)
  allocator   --> í• ë‹¹ì(ì„ íƒ)
        ^
        |
shared_ptr ----> [ T ê°ì²´ ]
```

- `use_count==0` â‡’ **T íŒŒê´´**
- `weak_count==0` â‡’ **ì»¨íŠ¸ë¡¤ ë¸”ë¡ íŒŒê´´**

### ìƒì„± â€” `make_shared` vs `shared_ptr(new T)`

```cpp
auto p1 = std::make_shared<int>(42);  // ê¶Œì¥: ê°ì²´+ì»¨íŠ¸ë¡¤ë¸”ë¡ ë™ì‹œ í• ë‹¹(ìºì‹œ/ì˜ˆì™¸ ì•ˆì „)
std::shared_ptr<int> p2(new int(42)); // ë¹„ê¶Œì¥: ë‘ ë²ˆ í• ë‹¹, ì˜ˆì™¸ì‹œ ëˆ„ìˆ˜ ìœ„í—˜
```

**ê¶Œì¥ ì´ìœ **
- **1íšŒ í• ë‹¹**(ì˜¤ë¸Œì íŠ¸+ì œì–´ë¸”ë¡ contiguous) â‡’ ìºì‹œ ì¹œí™”.
- ìƒì„±ìì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ **ëˆ„ìˆ˜ ë¶ˆê°€**.

> ë‹¤ë§Œ **ì»¤ìŠ¤í…€ ì‚­ì œì**ê°€ ê¼­ í•„ìš”/íŠ¹ìˆ˜ ë°°ì¹˜ê°€ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì§ì ‘ ìƒì„± ê³ ë ¤.

### ì°¸ì¡° ì¹´ìš´íŠ¸ì™€ ë¹„ìš©

```cpp
auto p = std::make_shared<std::string>("hello");
auto q = p;                    // use_count ì¦ê°€(ì›ìì  ì¦ê°€)
std::cout << p.use_count();    // 2
q.reset();                     // ê°ì†Œ
```

- `use_count()`ëŠ” **ì§„ë‹¨ìš©**. ìŠ¤ë ˆë“œ ê²½ìŸ í™˜ê²½ì—ì„œ ì¼ì‹œ ìˆ˜ì¹˜ë‹¤.
- ì°¸ì¡° ì¦ê°ì€ **ì›ìì  ì—°ì‚°** â†’ ë©€í‹°ìŠ¤ë ˆë“œì—ì„œ ì•ˆì „í•˜ì§€ë§Œ ë¹„ìš©ì´ ìˆë‹¤.

### enable_shared_from_this â€” â€œthisë¡œ shared_ptr ë§Œë“¤ê¸°â€

```cpp
#include <memory>
#include <iostream>

struct Widget : std::enable_shared_from_this<Widget> {
    std::shared_ptr<Widget> handle() { return shared_from_this(); }
};

int main() {
    auto w = std::make_shared<Widget>();
    auto h = w->handle(); // ê°™ì€ ì»¨íŠ¸ë¡¤ ë¸”ë¡ ê³µìœ 
    std::cout << w.use_count() << "\n"; // 2
}
```

> **ì£¼ì˜**: `shared_from_this()`ëŠ” ê°ì²´ê°€ **ì´ë¯¸ shared_ptrë¡œ ê´€ë¦¬ ì¤‘**ì´ì–´ì•¼ ì‘ë™.
> `Widget w; w.handle();` â†’ **UB**.

### ìˆœí™˜ ì°¸ì¡°(Cycle)ì™€ `weak_ptr`

```cpp
struct Node {
    int v{};
    std::shared_ptr<Node> next;
    std::weak_ptr<Node>   prev; // ğŸ”‘ ìˆœí™˜ ê³ ë¦¬ ëŠê¸°
};
```

- ì„œë¡œ `shared_ptr`ë§Œ ë“¤ê³  ìˆìœ¼ë©´ `use_count`ê°€ 0ì´ **ì ˆëŒ€** ë˜ì§€ ì•Šì•„ ëˆ„ìˆ˜.
- **í•œìª½ì„ `weak_ptr`**ë¡œ ë§Œë“¤ì–´ **ì†Œìœ ê³ ë¦¬**ë¥¼ ëŠëŠ”ë‹¤.

---

## `weak_ptr<T>` â€” ê´€ì°°ì. ìˆ˜ëª… ì—°ì¥ ì—†ìŒ

```cpp
std::shared_ptr<int> p = std::make_shared<int>(7);
std::weak_ptr<int>   w = p;

if (auto s = w.lock()) {
    // ê°ì²´ ì‚´ì•„ìˆìŒ
    *s = 9;
} // ì—¬ê¸°ì„œë„ pê°€ ë§ˆì§€ë§‰ì´ë©´ ì´ ìŠ¤ì½”í”„ ì¢…ë£Œ ë•Œ íŒŒê´´ë  ìˆ˜ ìˆìŒ
```

- `lock()`ì€ **ì•ˆì „í•œ ìŠ¹ê²©**(shared íšë“) ì‹œë„. ì‹¤íŒ¨ ì‹œ ë¹ˆ `shared_ptr`.
- ìºì‹œ/ì˜µì €ë²„/ê·¸ë˜í”„ ì—­ì°¸ì¡° ë“±ì—ì„œ ìœ ìš©. **ì‚¬ìš© ì‹œì  ë ˆì´ìŠ¤**ë¥¼ í†µì œ ê°€ëŠ¥.

---

## ì˜ˆì™¸ ì•ˆì „ & ì†Œìœ ê¶Œ ì „ë‹¬ ê·œì¹™

### íŒ©í† ë¦¬/ìƒì„± í•¨ìˆ˜ëŠ” **ì†Œìœ ê¶Œ**ì„ ë°˜í™˜

```cpp
std::unique_ptr<Foo> makeFoo() {
    auto p = std::make_unique<Foo>(); // ì˜ˆì™¸ ì•ˆì „
    // ...
    return p; // NRVO/ì´ë™
}
```

### API ê²½ê³„ì—ì„œì˜ ì¸ìˆ˜ ì „ë‹¬

| ì˜ë„ | ì¸ìˆ˜ íƒ€ì… |
|---|---|
| **ì½ê¸° ì „ìš©** | `T const&` |
| **ì˜µì…”ë„ ì½ê¸°** | `T const*` or `std::optional<std::reference_wrapper<const T>>` |
| **ì†Œìœ ê¶Œ ì´ì „** | `std::unique_ptr<T>` (by value) |
| **ê³µìœ  ì˜ë„** | `std::shared_ptr<T>` (by value ë˜ëŠ” const&) |
| **ê´€ì°°ë§Œ** | `std::weak_ptr<T>` |

> **ê·œì¹™**: ì†Œìœ ê¶Œì´ ì–´ë””ì— ìˆëŠ”ì§€ ì‹œê·¸ë‹ˆì²˜ë¡œ **ëª…í™•íˆ ë“œëŸ¬ë‚´ë¼**.

---

## ì»¤ìŠ¤í…€ ì‚­ì œì ì‹¤ì „ íŒ¨í„´

### OS/ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¸ë“¤

```cpp
struct HandleCloser { void operator()(HANDLE h) const noexcept { if (h) ::CloseHandle(h); } };
using HandleUPtr = std::unique_ptr<std::remove_pointer_t<HANDLE>, HandleCloser>;
```

### ë©”ëª¨ë¦¬ í’€/ë§ì¶¤ í• ë‹¹

```cpp
template <class T>
struct PoolDelete {
    Pool* pool{};
    void operator()(T* p) const noexcept { pool->deallocate(p, sizeof(T)); }
};

auto p = std::unique_ptr<Obj, PoolDelete<Obj>>{ pool->allocate<Obj>(), PoolDelete<Obj>{pool} };
```

### polymorphic baseë¥¼ ì•ˆì „í•˜ê²Œ ì‚­ì œ

```cpp
struct Base { virtual ~Base() = default; };
struct Der  : Base { ~Der(){ /*...*/ } };

std::unique_ptr<Base> p = std::make_unique<Der>(); // ê°€ìƒ ì†Œë©¸ì í•„ìˆ˜
```

---

## ìƒì„±ì

**ë‹¤ë¥¸ í¬ì¸í„°ë¥¼ ê°€ë¦¬í‚¤ë˜ ê°™ì€ ì»¨íŠ¸ë¡¤ ë¸”ë¡ì„ ê³µìœ **í•˜ê³  ì‹¶ì„ ë•Œ:

```cpp
struct Big { int header; int payload[1024]; };

auto big = std::make_shared<Big>();
int* view = big->payload + 10;

// aliasing: bigì˜ ìˆ˜ëª…ì„ ë”°ë¼ê°€ë˜, viewë¥¼ ê°€ë¦¬í‚¤ëŠ” shared_ptr
std::shared_ptr<int> alias(big, view);
```

- GUI/ì„œë¸Œë·°/ë¶€ë¶„ ë²„í¼ë¥¼ ì•ˆì „í•˜ê²Œ ë…¸ì¶œí•  ë•Œ ìœ ìš©.

---

## `shared_ptr` ìŠ¤ë ˆë“œ ì•ˆì „ì„± â€” ë¬´ì—‡ì´ ì•ˆì „í•˜ê³  ë¬´ì—‡ì´ ì•„ë‹Œê°€

- **ì»¨íŠ¸ë¡¤ ë¸”ë¡ì˜ ì°¸ì¡° ì¹´ìš´íŠ¸ ì¡°ì‘**ì€ **ì›ìì ** â‡’ `p`ì˜ ë³µì‚¬/íŒŒê´´/`reset`ì€ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì•ˆì „.
- **ê·¸ëŸ¬ë‚˜** `*p`ê°€ ê°€ë¦¬í‚¤ëŠ” **ê°ì²´ ë‚´ë¶€ ìƒíƒœ**ëŠ” ë³„ê°œ. ë™ì‹œ ì ‘ê·¼ì—” **ë½**ì´ í•„ìš”.
- **ë™ì¼ shared_ptr ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ **ë™ì‹œì— ì½ê¸°/ì“°ê¸°**ëŠ” ë°ì´í„° ê²½í•©.
  - ê´€ë¡€: shared_ptr **ê°’ ìì²´**ëŠ” ìŠ¤ë ˆë“œë³„ ë³µì‚¬ë³¸ìœ¼ë¡œ ì‚¬ìš©.

> ì•ˆì „í•œ íŒ¨í„´: **ì†Œìœ ëŠ” shared_ptrë¡œ ê³µìœ **, ë‚´ë¶€ ë™ê¸°í™”ëŠ” `std::mutex`/`std::atomic` ë“±ìœ¼ë¡œ ëª…ì‹œ.

---

## ì„±ëŠ¥ ë©”ëª¨ â€” ì–¸ì œ ë¬´ì—‡ì„ ì“°ë‚˜

| ìƒí™© | ê¶Œì¥ |
|---|---|
| ì†Œìœ ê°€ ëª…í™•í•˜ê³  ìœ ì¼ | `unique_ptr` |
| ì—¬ëŸ¬ ì†Œìœ ìê°€ í•„ìš”(ìˆ˜ëª… ê³µìœ ) | `shared_ptr` + **ìˆœí™˜ ë°©ì§€** |
| ì˜µì €ë²„/ìºì‹œ/ì—­ì°¸ì¡° | `weak_ptr` |
| ì½œë°±ì— â€œì†Œìœ  ì—°ì¥â€ì´ í•„ìš” | ìº¡ì²˜ì—ì„œ `std::weak_ptr` â†’ `lock()` |

**ë¹„ìš© ëª¨ë¸**
- `unique_ptr`: í¬ì¸í„° 1ê°œ. ì‚­ì œì íƒ€ì… í¬ê¸° ì¶”ê°€(ì†Œí˜• ìµœì í™”).
- `shared_ptr`: í¬ì¸í„° + ì»¨íŠ¸ë¡¤ ë¸”ë¡. **ì°¸ì¡° ì¦ê° ì›ì ì—°ì‚°** ë¹„ìš©.
- `make_shared`: í• ë‹¹ 1íšŒ, `shared_ptr(new)`ëŠ” 2íšŒ.

---

## ìˆœí™˜ ì°¸ì¡° ì‹¤ì „: ê·¸ë˜í”„/ì˜µì €ë²„ íŒ¨í„´

### ì–‘ë°©í–¥ ì—°ê²° ë¦¬ìŠ¤íŠ¸

```cpp
struct Node : std::enable_shared_from_this<Node> {
    int v{};
    std::shared_ptr<Node> next;
    std::weak_ptr<Node>   prev; // ğŸ”‘ weakë¡œ ëŠê¸°

    void link_to(std::shared_ptr<Node> n) {
        next = std::move(n);
        if (next) next->prev = shared_from_this();
    }
};
```

### ê´€ë¦¬

```cpp
struct Observer { virtual void on_event() = 0; virtual ~Observer() = default; };

struct Subject {
    std::vector<std::weak_ptr<Observer>> obs;
    void add(std::shared_ptr<Observer> o) { obs.emplace_back(o); }
    void notify() {
        for (auto it = obs.begin(); it != obs.end();) {
            if (auto o = it->lock()) { o->on_event(); ++it; }
            else it = obs.erase(it); // ì£½ì€ ê´€ì°°ì ì œê±°
        }
    }
};
```

---

## ì˜ˆì™¸ ì•ˆì „ & ì»¨í…Œì´ë„ˆì™€ í•¨ê»˜ ì“°ê¸°

### ë²¡í„°ì— `unique_ptr` ì €ì¥ â€” ì´ë™ ì˜ë¯¸ë¡ 

```cpp
std::vector<std::unique_ptr<Foo>> vec;
vec.push_back(std::make_unique<Foo>());
vec.emplace_back(std::make_unique<Foo>()); // ë™ì¼, ì´ë™ë¨
```

### ë§µì— `shared_ptr` ì €ì¥ â€” ì—ì¼ë¦¬ì–´ì‹±/ê³µìœ 

```cpp
std::unordered_map<Key, std::shared_ptr<Obj>> cache;
auto obj = std::make_shared<Obj>();
cache.emplace(k, obj);    // ê³µìœ 
```

---

## í”í•œ í•¨ì • ë° ì§„ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸

1) **`shared_from_this` ì˜¤ë‚¨ìš©**
   - ë°˜ë“œì‹œ `std::make_shared<Derived>()` ë“±ìœ¼ë¡œ **shared ìƒíƒœ**ì—ì„œë§Œ í˜¸ì¶œ.
2) **ìˆœí™˜ ê³ ë¦¬ ë°©ì¹˜**
   - êµ¬ì¡°ì— í•œ ë²ˆ **weak ë‹¨ì ˆì **ì„ ì„¤ê³„.
3) **ì»¤ìŠ¤í…€ ì‚­ì œì ëˆ„ë½**
   - `FILE*`, `DIR*`, ì†Œì¼“ ë“±ì€ **ë°˜ë“œì‹œ** ì „ìš© ì‚­ì œì.
4) **`shared_ptr(new T)`**
   - íŠ¹ë³„í•œ ì´ìœ  ì—†ìœ¼ë©´ `make_shared`.
5) **ë°°ì—´ì— `unique_ptr<T>`**
   - ë°°ì—´ì€ ë°˜ë“œì‹œ `unique_ptr<T[]>`.
6) **ìŠ¤ë ˆë“œì—ì„œ `use_count()` ì‹ ë¢°**
   - ëª¨ë‹ˆí„°ë§ ê°’ì¼ ë¿ **ë™ê¸°í™” ìˆ˜ë‹¨ ì•„ë‹˜**.

---

## ë¯¸ì„¸ íŒ â€” ì•Œë©´ ì‹¤ì „ì—ì„œ ë„ì›€ë˜ëŠ” ê²ƒë“¤

- **`std::owner_less<shared_ptr<T>>`**: `map`/`set`ì—ì„œ shared/weakë¥¼ **ì»¨íŠ¸ë¡¤ ë¸”ë¡ ê¸°ì¤€** ì •ë ¬ ë¹„êµ.
- **`std::allocate_shared`**: ì»¤ìŠ¤í…€ í• ë‹¹ìì™€ ê²°í•©.
- **`std::shared_ptr<void>`**: íƒ€ì… ì§€ìš°ê¸°. ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ì˜ **ê³µí†µ ìˆ˜ëª… ê´€ë¦¬**ì— ìœ ìš©.
- **ëŒë‹¤ ì»¤ìŠ¤í…€ ì‚­ì œì**:

```cpp
auto deleter = [](auto* p){ /* ... */ delete p; };
std::unique_ptr<int, decltype(deleter)> p(new int{5}, deleter);
```

---

## ì‹¤ì „ ìƒ˜í”Œ: ì•ˆì „í•œ í”ŒëŸ¬ê·¸ì¸ í•¸ë“¤ëŸ¬

```cpp
#include <memory>
#include <vector>
#include <functional>

struct Plugin : std::enable_shared_from_this<Plugin> {
    std::vector<std::function<void()>> callbacks;

    void register_safe_callback() {
        std::weak_ptr<Plugin> self = shared_from_this();
        callbacks.emplace_back([self]{
            if (auto s = self.lock()) { /* ì•ˆì „í•˜ê²Œ ì‘ì—… */ }
            // else: ì´ë¯¸ íŒŒê´´, ë¬´ì‹œ
        });
    }
};
```

- ì½œë°±ì´ **ìˆ˜ëª…ì„ ì—°ì¥**í•˜ì§€ ì•Šë„ë¡ `weak_ptr` ìº¡ì²˜.

---

## ìˆ˜ëª…/ë¹„ìš© ëª¨ë¸ì„ ìˆ˜ì‹ìœ¼ë¡œ ê¸°ì–µí•˜ê¸°

- **unique**:
  $$ \text{owner}(p) = 1, \quad \text{move}(p \to q) \Rightarrow p=\text{null} $$
- **shared/weak**:
  $$ \text{destroy}(T) \iff \text{use\_count}=0,\quad \text{destroy}(CB) \iff \text{weak\_count}=0 $$
  (CB = Control Block)

---

## ì¢…í•© ì˜ˆì œ â€” ìˆœí™˜ ì°¸ì¡°ê°€ ìˆëŠ” ê·¸ë˜í”„ë¥¼ ì•ˆì „í•˜ê²Œ

```cpp
#include <memory>
#include <vector>
#include <string>
#include <iostream>

struct Node : std::enable_shared_from_this<Node> {
    std::string name;
    std::vector<std::shared_ptr<Node>> children;
    std::weak_ptr<Node>                parent;   // ğŸ”‘

    explicit Node(std::string n) : name(std::move(n)) {}

    std::shared_ptr<Node> add_child(std::string n) {
        auto c = std::make_shared<Node>(std::move(n));
        c->parent = shared_from_this();  // ë¶€ëª¨ëŠ” weakë¡œ ê´€ì°°
        children.push_back(c);
        return c;
    }

    void print_path() const {
        // parentë¥¼ ë”°ë¼ ë£¨íŠ¸ê¹Œì§€
        auto p = parent.lock();
        if (p) { p->print_path(); std::cout << "/"; }
        std::cout << name;
    }
};

int main() {
    auto root = std::make_shared<Node>("root");
    auto a = root->add_child("A");
    auto b = a->add_child("B");
    b->print_path(); // root/A/B
}
```

---

## ê²°ì • ê·œì¹™(Decision Table)

| ì§ˆë¬¸ | ì˜ˆ/ì•„ë‹ˆì˜¤ | ì„ íƒ |
|---|---|---|
| ê°ì²´ì˜ **ìœ ì¼ ì†Œìœ ì**ê°€ ë„ˆì¸ê°€? | ì˜ˆ | `unique_ptr<T>` |
| ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ **ë™ì¼ ìˆ˜ëª…**ì„ ê³µìœ í•´ì•¼ í•˜ëŠ”ê°€? | ì˜ˆ | `shared_ptr<T>` |
| ìˆœí™˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ”ê°€? | ì˜ˆ | ë§í¬ì˜ í•œìª½ì„ `weak_ptr<T>` |
| ì‚­ì œ ë¡œì§ì´ íŠ¹ë³„í•œê°€? | ì˜ˆ | ì»¤ìŠ¤í…€ ì‚­ì œì(`unique_ptr<T, D>`, `allocate_shared`) |
| ì½œë°±/ë¹„ë™ê¸°ì—ì„œ ì•ˆì „ ìº¡ì²˜ê°€ í•„ìš”í•œê°€? | ì˜ˆ | `weak_ptr` ìº¡ì²˜ í›„ `lock()` |

---

## ìš”ì•½

- **ê¸°ë³¸í˜•**: `unique_ptr`(ë‹¨ë…, 0 ì˜¤ë²„í—¤ë“œ).
- **ê³µìœ í˜•**: `shared_ptr`(ì»¨íŠ¸ë¡¤ ë¸”ë¡ + ì›ì ì°¸ì¡° ì¹´ìš´íŠ¸).
- **ì˜µì €ë²„**: `weak_ptr`(ìˆœí™˜ ì–µì œ, ì§€ì—° ìŠ¹ê²©).
- í• ë‹¹/ì‚­ì œ/ì˜ˆì™¸/ìŠ¤ë ˆë“œë¥¼ ê³ ë ¤í•œ **ëª¨ë²” íŒ¨í„´**ìœ¼ë¡œ ì‹¤ì œ ë²„ê·¸ë¥¼ ê·¼ë³¸ ì°¨ë‹¨.
- â€œ**ì†Œìœ ê¶Œ ì˜ë„**ê°€ íƒ€ì…/ì‹œê·¸ë‹ˆì²˜ë¡œ ë“œëŸ¬ë‚˜ì•¼ í•œë‹¤.â€

---

## ë¹ ë¥¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `make_unique` / `make_shared` ìš°ì„ 
- [ ] ìˆœí™˜ êµ¬ì¡°ì—ëŠ” `weak_ptr`ë¡œ ê³ ë¦¬ ëŠê¸°
- [ ] í•¸ë“¤/íŒŒì¼/ì†Œì¼“ì€ **ì»¤ìŠ¤í…€ ì‚­ì œì**
- [ ] ë°°ì—´ì—” `unique_ptr<T[]>`
- [ ] ë©€í‹°ìŠ¤ë ˆë“œ: ì°¸ì¡° ì¹´ìš´íŠ¸ëŠ” ì•ˆì „í•˜ì§€ë§Œ **ê°ì²´ ë‚´ë¶€ëŠ” ë³„ë„ ë™ê¸°í™”**
- [ ] `shared_from_this`ëŠ” **shared ê´€ë¦¬ í•˜ì—ì„œë§Œ** í˜¸ì¶œ
