---
layout: post
title: Avalonia - MVVMì—ì„œ ì„œë¹„ìŠ¤ ê³„ì¸µ ë¶„ë¦¬ êµ¬ì¡°
date: 2025-02-09 21:20:23 +0900
category: Avalonia
---
# ğŸªŸ Avalonia ë‹¤ì¤‘ ì°½(Window) ì—´ê¸° ë° ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì²˜ë¦¬

---

## ğŸ¯ í•µì‹¬ ëª©í‘œ

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ìƒˆ ì°½ ì—´ê¸° | MVVM ë°©ì‹ìœ¼ë¡œ ë…ë¦½ì ì¸ View/ViewModel ì—°ê²° |
| ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ | ì‚¬ìš©ìì˜ í™•ì¸/ì·¨ì†Œ ê²°ê³¼ë¥¼ ë°›ê³  ë‹«ê¸° |
| ì°½ ê°„ ë°ì´í„° ì „ë‹¬ | íŒŒë¼ë¯¸í„° ë˜ëŠ” ë°”ì¸ë”©ìœ¼ë¡œ ì „ë‹¬ |
| ì°½ ì¢…ë£Œ í›„ ê²°ê³¼ ì²˜ë¦¬ | Task ê¸°ë°˜ ê²°ê³¼ ë°˜í™˜

---

## ğŸ§± ê¸°ë³¸ êµ¬ì¡° ì˜ˆì‹œ

```
MyApp/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ MainView.axaml
â”‚   â”œâ”€â”€ DetailWindow.axaml
â”‚   â””â”€â”€ ConfirmDialog.axaml
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ MainViewModel.cs
â”‚   â”œâ”€â”€ DetailViewModel.cs
â”‚   â””â”€â”€ ConfirmDialogViewModel.cs
```

---

## 1ï¸âƒ£ ì¼ë°˜ ì°½(Window) ì—´ê¸°

### ğŸ“„ DetailWindow.axaml

```xml
<Window xmlns="https://github.com/avaloniaui">
  <StackPanel Margin="20">
    <TextBlock Text="ìƒì„¸ ì°½ì…ë‹ˆë‹¤" FontSize="18" Margin="0 0 0 10"/>
    <Button Content="ë‹«ê¸°" Click="OnCloseClick"/>
  </StackPanel>
</Window>
```

### ğŸ“„ DetailWindow.xaml.cs

```csharp
public partial class DetailWindow : Window
{
    public DetailWindow()
    {
        InitializeComponent();
    }

    private void OnCloseClick(object? sender, RoutedEventArgs e)
    {
        this.Close();
    }
}
```

### ğŸ“„ MainViewModel.cs

```csharp
public class MainViewModel : ReactiveObject
{
    public ReactiveCommand<Unit, Unit> OpenDetailCommand { get; }

    public MainViewModel()
    {
        OpenDetailCommand = ReactiveCommand.Create(OpenDetailWindow);
    }

    private void OpenDetailWindow()
    {
        var win = new DetailWindow();
        win.Show();
    }
}
```

---

## 2ï¸âƒ£ ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸° (Task ê¸°ë°˜)

### ğŸ“„ ConfirmDialog.axaml

```xml
<Window Width="300" Height="150" WindowStartupLocation="CenterScreen" CanResize="False">
  <StackPanel Margin="20" Spacing="10">
    <TextBlock Text="ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" />
    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
      <Button Content="ì˜ˆ" Click="YesClick"/>
      <Button Content="ì•„ë‹ˆì˜¤" Click="NoClick"/>
    </StackPanel>
  </StackPanel>
</Window>
```

### ğŸ“„ ConfirmDialog.axaml.cs

```csharp
public partial class ConfirmDialog : Window
{
    private TaskCompletionSource<bool> _tcs = new();

    public ConfirmDialog()
    {
        InitializeComponent();
    }

    public Task<bool> ShowDialogAsync(Window parent)
    {
        this.ShowDialog(parent); // ëª¨ë‹¬
        return _tcs.Task;
    }

    private void YesClick(object? sender, RoutedEventArgs e)
    {
        _tcs.TrySetResult(true);
        this.Close();
    }

    private void NoClick(object? sender, RoutedEventArgs e)
    {
        _tcs.TrySetResult(false);
        this.Close();
    }
}
```

### ğŸ“„ MainViewModel.cs (ëª¨ë‹¬ ì‹¤í–‰)

```csharp
public ReactiveCommand<Unit, Unit> ShowConfirmCommand { get; }

public MainViewModel()
{
    ShowConfirmCommand = ReactiveCommand.CreateFromTask(ShowDialogAsync);
}

private async Task ShowDialogAsync()
{
    var dialog = new ConfirmDialog();
    var result = await dialog.ShowDialogAsync(App.Current.ApplicationLifetime is IClassicDesktopStyleApplicationLifetime life
        ? life.MainWindow!
        : null!);

    if (result)
        Console.WriteLine("ì‚¬ìš©ìê°€ ì˜ˆë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.");
    else
        Console.WriteLine("ì‚¬ìš©ìê°€ ì•„ë‹ˆì˜¤ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.");
}
```

---

## 3ï¸âƒ£ ViewModel ì „ë‹¬ ë° ë°”ì¸ë”©

### ViewModel â†’ View ì—°ê²°

```csharp
var vm = new DetailViewModel("íŒŒë¼ë¯¸í„° ê°’");
var win = new DetailWindow { DataContext = vm };
win.Show();
```

### ì–‘ë°©í–¥ ì „ë‹¬ ì‹œ

- ViewModelì´ `Window`ë¥¼ ì§ì ‘ ê°€ì§€ì§€ ì•Šë„ë¡ **ì„œë¹„ìŠ¤ ë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ í†µí•´ ì°½ì„ ë„ìš°ëŠ” êµ¬ì¡°**ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë˜ëŠ” **INavigationService** ê°™ì€ ì°½ ê´€ë¦¬ìë¥¼ êµ¬í˜„í•´ ì¶”ìƒí™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

---

## 4ï¸âƒ£ ViewModelì—ì„œ ì°½ì„ ì§ì ‘ ì—´ì§€ ì•Šê¸° ìœ„í•œ êµ¬ì¡° (ì„œë¹„ìŠ¤ ê³„ì¸µ)

### ğŸ“„ IWindowService.cs

```csharp
public interface IWindowService
{
    void ShowDetail(DetailViewModel vm);
    Task<bool> ShowConfirmDialogAsync();
}
```

### ğŸ“„ WindowService.cs

```csharp
public class WindowService : IWindowService
{
    public void ShowDetail(DetailViewModel vm)
    {
        var win = new DetailWindow { DataContext = vm };
        win.Show();
    }

    public async Task<bool> ShowConfirmDialogAsync()
    {
        var dialog = new ConfirmDialog();
        return await dialog.ShowDialogAsync(App.Current.ApplicationLifetime is IClassicDesktopStyleApplicationLifetime life
            ? life.MainWindow!
            : null!);
    }
}
```

### DI ë“±ë¡ í›„ ì‚¬ìš©

```csharp
services.AddSingleton<IWindowService, WindowService>();
```

---

## 5ï¸âƒ£ ì°½ ëª¨ë“œ ë¹„êµ

| ì°½ ì¢…ë¥˜ | ì„¤ëª… |
|---------|------|
| `Show()` | ë¹„ëª¨ë‹¬, ë…ë¦½ ì‹¤í–‰ |
| `ShowDialog()` | ëª¨ë‹¬, ë°˜í™˜ ê°’ ë°›ì„ ìˆ˜ ìˆìŒ |
| `ShowDialogAsync()` | ë¹„ë™ê¸° ëª¨ë‹¬ë¡œ Task ë°˜í™˜ |
| `Topmost` | í•­ìƒ ìœ„ ì°½ |
| `WindowStartupLocation` | ì¤‘ì•™, ë§ˆìš°ìŠ¤ ë“± ìœ„ì¹˜ ì§€ì • ê°€ëŠ¥ |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ í¬ì¸íŠ¸

- í™•ì¸/ì·¨ì†Œ ì—¬ë¶€ì— ë”°ë¼ ë™ì‘ ë¶„ê¸°
- ì°½ ë‹«ì„ ë•Œ ì´ë²¤íŠ¸ í•¸ë“¤ë§ (`Closed`, `Closing`)
- ì°½ í¬ê¸°, ìœ„ì¹˜ ì €ì¥ í›„ ë³µì›

---

## âœ… ì •ë¦¬

| í•­ëª© | êµ¬í˜„ ë°©ì‹ |
|------|-----------|
| ìƒˆ ì°½ ì—´ê¸° | `new Window().Show()` ë˜ëŠ” DI ì£¼ì… |
| ëª¨ë‹¬ ì°½ | `ShowDialog()` / `TaskCompletionSource` |
| ViewModel ë¶„ë¦¬ | ì„œë¹„ìŠ¤ íŒ¨í„´ìœ¼ë¡œ ì°½ í˜¸ì¶œ ì¶”ìƒí™” |
| ë°ì´í„° ì „ë‹¬ | ìƒì„±ì, `DataContext` ì´ìš© |
| ì°½ ë°˜í™˜ê°’ | `ShowDialog()` ê²°ê³¼ ë°˜í™˜
