---
layout: post
title: 이산수학 - 계수의 기본 원리
date: 2025-06-03 22:20:23 +0900
category: 이산수학
---
# 계수의 기본 원리 (Basic Principles of Counting)

> 규칙: 모든 **코드**는 ``` 로, 모든 **수식**은 반드시 $$...$$ 로 감싼다.

알고리즘, 확률, 조합론에서 **경우의 수를 정확하고 효율적으로 세는 법**은 핵심 역량이다.  
이 글은 **합의 법칙**·**곱의 법칙**을 시작으로 **순열·조합**, **중복 허용/금지**, **멀티셋(중복 원소)**, **별과 막대(stars and bars)**, **포함-배제**, **비둘기집 원리**까지 **실무/코딩 친화적 예제**와 함께 정리한다.

---

## 0) 표기와 준비물

- $$n! = n\cdot(n-1)\cdots 1,\ \ 0! = 1$$  
- $$P(n,r)=\dfrac{n!}{(n-r)!}$$ : 서로 다른 $$n$$개 중 **순서 있게** $$r$$개 뽑기  
- $$\binom{n}{r}=\dfrac{n!}{r!(n-r)!}$$ : 서로 다른 $$n$$개 중 **순서 없이** $$r$$개 뽑기  
- **중복 허용 조합**(stars & bars): $$\displaystyle \binom{n+r-1}{r}$$ (종류 $$n$$, 개수 합 $$r$$)

---

## 1) 합의 법칙 (Rule of Sum)

### 1.1 정의(배타적 경우)
서로 **겹치지 않는** 선택 A, B가 각각 $$m,n$$ 가지이면 “A **또는** B”는
$$
m+n
$$
가지.

### 1.2 겹치는 경우(포함-배제의 한 줄형)
겹침이 있을 때 “A 또는 B”는
$$
|A\cup B|=|A|+|B|-|A\cap B|.
$$

### 1.3 예제
- 빨간 공 3개, 파란 공 2개에서 하나 고르기(겹침 없음): $$3+2=5$$.  
- 1부터 100까지에서 **2 또는 3의 배수 개수**:
  $$
  \left\lfloor \frac{100}{2}\right\rfloor + \left\lfloor \frac{100}{3}\right\rfloor
  - \left\lfloor \frac{100}{6}\right\rfloor
  =50+33-16=67.
  $$

---

## 2) 곱의 법칙 (Rule of Product)

### 2.1 정의(단계적 작업)
작업이 단계 1, 2, …, $$k$$ 로 나뉘고, 각각 선택 수가 $$m_1,m_2,\dots,m_k$$ 이면 전체 경우의 수는
$$
m_1\cdot m_2\cdot \dots \cdot m_k.
$$

> **주의**: 확률의 “독립”과 다르게, **계수의 곱**은 각 단계마다 “선택 수가 잘 정의됨”이면 된다. (이전 선택이 다음 선택 수를 바꿔도 **그에 맞는 숫자**를 곱하면 된다.)

### 2.2 예제
- **티셔츠 3벌 × 바지 2벌**: $$3\cdot 2=6$$.  
- **자동차 번호판** (영문 대문자 2자리 + 숫자 3자리, 반복 허용): $$26^2\cdot 10^3$$.

---

## 3) 삽입 원리와 줄세우기(순열의 씨앗)

길이가 $$n$$ 인 순서를 만들 때 각 자리의 선택 수가 차례로 $$m_1,\dots,m_n$$ 이면
$$
m_1m_2\dots m_n
$$
가지.  
서로 다른 $$n$$ 명을 일렬로 세우면
$$
n!
$$
가지.

**예**: 4명 줄세우기 → $$4!=24$$.

---

## 4) 순열 (Permutation)

### 4.1 서로 다른 $$n$$ 개 중 **순서 있게** $$r$$ 개
$$
P(n,r) = \frac{n!}{(n-r)!}.
$$
**예**: 10명 중 대표·부대표·서기(순서 중요) → $$P(10,3)=10\cdot 9\cdot 8=720$$.

### 4.2 **중복 불가** 6자리 PIN, 첫 자리는 0 금지
첫 자리 $$9$$(1–9), 둘째 자리 $$9$$(0 포함, 이미 고른 1개 제외),  
그 다음 $$8,7,6,5$$:
$$
9\cdot 9\cdot 8\cdot 7\cdot 6\cdot 5=136{,}080.
$$

### 4.3 **중복 허용 순열**(자리마다 같은 종류 재사용)
종류 $$k$$, 길이 $$r$$ → $$k^r$$.  
예: 숫자만(10종) 길이 4 → $$10^4$$.

---

## 5) 조합 (Combination)

### 5.1 서로 다른 $$n$$ 개 중 **순서 없이** $$r$$ 개
$$
\binom{n}{r} = \frac{n!}{r!(n-r)!}.
$$
**예**: 10명 중 3명 팀 → $$\binom{10}{3}=120$$.

### 5.2 **중복 허용 조합**(별과 막대; 동일 제품 여러 개 가능)
종류 $$n$$ 개에서 합이 $$r$$ 개인 다중 선택 수
$$
\binom{n+r-1}{r}.
$$
**예**: 아이스크림 5종에서 스쿱 7개(중복 허용) → $$\binom{5+7-1}{7}=\binom{11}{7}=330$$.

---

## 6) 멀티셋(중복 원소) 순열과 다항계수

### 6.1 같은 글자가 있는 단어 배치(서로 구별 안 됨)
총 길이 $$n$$, 같은 글자들이 $$a_1,a_2,\dots,a_k$$ 번씩 있다면
$$
\frac{n!}{a_1!\,a_2!\cdots a_k!}.
$$
**예**: “BALLOON”(7글자, L 2개, O 2개)
$$
\frac{7!}{2!\cdot 2!}=1260.
$$

### 6.2 **다항계수**(여러 상자에 나눠 담기)
$$
\binom{n}{a_1,\dots,a_k}=\frac{n!}{\prod_i a_i!},\ \ \sum_i a_i=n.
$$
**예**: 서로 다른 10권을 A/B/C 3박스에 각각 4/3/3권 → $$\binom{10}{4,3,3}$$.

---

## 7) 포함-배제 원리 (Inclusion–Exclusion, PIE)

서로 겹치는 경우의 수에서 **중복 카운트**를 교정한다.

### 7.1 두 집합
$$
|A\cup B|=|A|+|B|-|A\cap B|.
$$

### 7.2 세 집합
$$
|A\cup B\cup C|=|A|+|B|+|C|-|A\cap B|-|A\cap C|-|B\cap C|+|A\cap B\cap C|.
$$

### 7.3 예제 — 1..100 중 2·3·5의 배수 개수
$$
\begin{aligned}
&\left\lfloor\frac{100}{2}\right\rfloor + \left\lfloor\frac{100}{3}\right\rfloor + \left\lfloor\frac{100}{5}\right\rfloor \\
&-\left(\left\lfloor\frac{100}{6}\right\rfloor+\left\lfloor\frac{100}{10}\right\rfloor+\left\lfloor\frac{100}{15}\right\rfloor\right)
+\left\lfloor\frac{100}{30}\right\rfloor\\
&=50+33+20-(16+10+6)+3=74.
\end{aligned}
$$

---

## 8) 비둘기집 원리 (Pigeonhole Principle)

### 8.1 기본형
$$n$$ 마리 비둘기를 $$m$$ 개 집에 넣으면, $$n>m$$ 이면 **어떤 집엔 최소 2마리**가 있다.

- **예**: 13명이면 최소 2명은 같은 **월**에 생일(12집) → 참.

### 8.2 일반화
$$n$$ 마리, $$m$$ 집 → **어떤 집**은 최소
$$
\left\lceil\frac{n}{m}\right\rceil
$$
마리를 가진다.

- **예**: 100개 수를 10개 나머지(모듈러 10)로 분류 → 어떤 나머지값 클래스에 최소 $$\lceil 100/10\rceil=10$$개.

---

## 9) 조합론적 사고패턴: 보완/케이스/PIE

### 9.1 여사건(보완)으로 세기
“적어도 하나”는 **전체 - 하나도 아닌 것**.

- **예**: 8자리 영문 소문자에서 **적어도 한 글자 ‘a’** 포함  
  전체 $$26^8$$. **‘a’가 0개** $$25^8$$. → 결과 $$26^8-25^8$$.

### 9.2 케이스 분할
조건이 복잡하면 **서로 배타적인 경우**로 나눠 **합의 법칙**으로 합친다.

### 9.3 포함-배제 적용 포인트
“X 포함, Y 포함 금지, Z 중 최소 하나 포함” 같은 **겹침 다중 조건**에 유리.

---

## 10) 실전 레시피 모음

### 10.1 전화번호 규칙 예제
- 길이 7, 첫 자리 0 금지, **인접 두 자리 동일 금지**.  
  첫 자리: $$9$$. 이후 각 자리: **바로 앞과 다르게** $$9$$.  
  총 $$9\cdot 9^6=9^7$$.

### 10.2 팀 구성(역할/무역할 혼합)
- 10명 중 **리더 1명**(순서), **멤버 4명**(순서 없음):  
  $$P(10,1)\cdot \binom{9}{4}=10\cdot 126=1260.$$

### 10.3 섞인 제약 — 금지 패턴
- 길이 6의 0–9 문자열, **“13” 금지**.  
  포함-배제로:
  - 전체: $$10^6$$  
  - “13”이 시작 위치 1–5에 **적어도 한 번**: 5개 위치 각각 $$10^4$$ 이지만 겹침(오버랩) 교정 필요 → **유한 상태 DP**가 안전(§12 코드).

---

## 11) 함수 개수와 응용

정의역 $$|A|=a$$, 공역 $$|B|=b$$.

- **모든 함수** $$A\to B$$: $$b^a$$.  
- **단사(일대일)**: $$a\le b$$ 일 때 $$P(b,a)$$.  
- **전사(onto)**: $$b!\,S(a,b)$$, 여기서 $$S(a,b)$$ 는 **제2종 스털링 수**.

**예**: $$|A|=4,|B|=2$$ 의 전사 함수 수 → $$2!\,S(4,2)=2\cdot 7=14$$.

---

## 12) 파이썬으로 계수 실험/검증

### 12.1 기본 유틸
```python
from math import factorial, comb, perm

# nPr, nCr, 멀티셋 순열
def nPr(n, r): 
    return perm(n, r)  # Python 3.8+: math.perm

def nCr(n, r): 
    return comb(n, r)  # 큰 수도 정확

def multiset_perm(counts):
    # counts: 같은 원소들의 개수 리스트 [a1, a2, ...]
    n = sum(counts)
    ans = factorial(n)
    for a in counts:
        ans //= factorial(a)
    return ans

print(nPr(10, 3))            # 720
print(nCr(10, 3))            # 120
print(multiset_perm([2,2,1,1,1]))  # BALLOON -> 1260
```

### 12.2 별과 막대(중복 허용 조합)
```python
def combinations_with_repetition(n_types, r):
    # 별과 막대: C(n+r-1, r)
    from math import comb
    return comb(n_types + r - 1, r)

print(combinations_with_repetition(5, 7))  # 330
```

### 12.3 포함-배제 소형 브루트포스 검증(작은 n)
```python
# 1..N에서 2,3,5의 배수 개수 브루트
def count_multiples(N, divisors=(2,3,5)):
    return sum(any(i % d == 0 for d in divisors) for i in range(1, N+1))

print(count_multiples(100))  # 74 (PIE 결과와 일치)
```

### 12.4 금지 패턴(“13” 금지) DP
```python
def count_strings_no_13(length, alphabet=10):
    # 상태: (pos, prev_is_1) -> 다음 자리에 '3' 금지 여부
    from functools import lru_cache
    @lru_cache(None)
    def dp(pos, prev_is_1):
        if pos == length:
            return 1
        total = 0
        for digit in range(alphabet):
            if prev_is_1 and digit == 3:
                continue
            total += dp(pos+1, digit == 1)
        return total
    return dp(0, False)

print(count_strings_no_13(6))         # 금지 포함 카운트
print(10**6 - count_strings_no_13(6)) # '13'을 적어도 한 번 포함
```

---

## 13) 흔한 함정과 디버깅 팁

1. **합의 법칙 오남용**: 겹치는 경우를 “그냥 더함” → **중복**. (PIE 사용)  
2. **곱 단계 수 잘못**: 이전 선택이 다음 선택 수를 바꾸면 **각 경우를 정확히 세분화**해서 곱하라.  
3. **순서/무순서 혼동**: “자리 배치 vs 팀 구성” 구분.  
4. **중복 허용 여부** 확인: 순열/조합에서 완전 다른 결과.  
5. **중복 원소(멀티셋)**: 같은 글자는 구별 안 됨 → 다항계수 사용.  
6. **‘적어도 하나’**: 보완계수(전체-0개)로 간결·안전.  
7. **금지 패턴**: 포지션 겹침이 있으면 PIE가 복잡 → **유한 상태 DP**가 깔끔.

---

## 14) 빠른 레퍼런스 요약

| 주제 | 공식/핵심 |
|---|---|
| 합의 법칙 | 배타적일 때 $$m+n$$, 겹침은 PIE |
| 곱의 법칙 | 단계 곱 $$m_1\cdots m_k$$ |
| 순열 | $$P(n,r)=\dfrac{n!}{(n-r)!}$$ |
| 조합 | $$\binom{n}{r}=\dfrac{n!}{r!(n-r)!}$$ |
| 중복 허용 조합 | $$\displaystyle \binom{n+r-1}{r}$$ |
| 멀티셋 순열 | $$\dfrac{n!}{\prod a_i!}$$ |
| 다항계수 | $$\binom{n}{a_1,\dots,a_k}=\dfrac{n!}{\prod a_i!}$$ |
| 함수 A→B 개수 | $$b^a$$, 단사 $$P(b,a)$$, 전사 $$b!\,S(a,b)$$ |
| 비둘기집 | 최소 $$\left\lceil \dfrac{n}{m}\right\rceil$$ |

---

## 15) 연습 문제(해설 스케치)

1) **암호**: 소문자+숫자(총 36)로 8자, **적어도 1개 숫자**.  
전체 $$36^8$$, **숫자 0개** $$26^8$$ → 답 $$36^8-26^8$$.

2) **팀**: 12명 중 **리더 1명**, **멤버 4명**.  
$$P(12,1)\cdot \binom{11}{4}=12\cdot 330=3960$$.

3) **단어 배치**: “STATISTICS”의 서로 다른 배치.  
글자 수 10, S 3, T 3, I 2, A 1, C 1 →  
$$\dfrac{10!}{3!\cdot 3!\cdot 2!\cdot 1!\cdot 1!}= \dfrac{3628800}{(6\cdot 6\cdot 2)}= 50400.$$

4) **별과 막대**: 6개의 동일한 공을 4개 상자에(빈 상자 허용).  
$$\binom{4+6-1}{6}=\binom{9}{6}=84$$.

5) **비둘기집**: 73명을 12개월에. **최소 한 달**은  
$$\left\lceil \dfrac{73}{12}\right\rceil=7$$ 명 이상.

---

## 16) 마무리

- **합/곱**은 모든 계수 문제의 출발점.  
- **순열·조합·멀티셋·중복 허용**을 정확히 구분하라.  
- **포함-배제**로 겹침을, **보완계수**로 “적어도/적어도 하나”를, **비둘기집**으로 **최소 보장**을 잡는다.  
- 복잡한 금지/제약은 **유한 상태 DP**나 **케이스 분할 + PIE**로 공략한다.

이제 원하는 조합 문제를 **정확하고 재현성 있게** 셀 수 있다. 필요하면 위 파이썬 스니펫으로 **브루트 검증**까지 곁들여 견고함을 더하자.