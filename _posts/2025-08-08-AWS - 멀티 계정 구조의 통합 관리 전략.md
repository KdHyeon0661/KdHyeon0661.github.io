---
layout: post
title: AWS - 멀티 계정 구조의 통합 관리 전략
date: 2025-08-08 20:20:23 +0900
category: AWS
---
# AWS 멀티 계정 구조의 보안/네트워크/비용 통합 관리 전략

## 0. 한 눈에 보는 요약

- **조직 단위(OU)** 로 환경/위험을 구획하고, **중앙 보안·네트워크·결제** 계정을 둔다.
- **SCP + IAM 권한경계 + SSO(Identity Center)** 로 인가를 표준화한다.
- **CloudTrail(조직 트레일) / Config Aggregator / GuardDuty / Security Hub / Security Lake** 를 중앙 집계로 묶는다.
- 네트워크는 **전용 네트워크 계정 + Transit Gateway(또는 VPC 공유) + 중앙 DNS/방화**로 일관성 있게 설계한다.
- 비용은 **Consolidated Billing + 비용 태그 표준 + Budgets/Anomaly Detection + Savings Plans/RI** 를 중앙에서 최적화한다.
- **Control Tower/Account Factory/Service Catalog** 로 **계정 생명주기**(발급→정책적용→폐기)를 자동화한다.

---

## 1. 기본 개념과 목표

### 1.1 왜 멀티 계정인가?
- **보안 경계**: 사고 폭을 계정 단위로 격리
- **규정 준수**: 감사·보관·접근통제를 계정 단위로 명확화
- **책임 분리**: 팀/제품/환경별 소유권과 운영 책임 분담
- **비용/한도**: 서비스 한도 분산, 비용 라인아이템 분리

### 1.2 표준 OU/계정 구조(예시)

```
/ (Root)
├─ Security (보안 플랫폼)
│  ├─ Log-Archive (조직 로그 보관)
│  └─ Security-Tooling (SIEM/SOAR/Hub)
├─ Infrastructure (공용 인프라)
│  ├─ Network (Transit GW, DNS, Direct Connect)
│  └─ Shared-Services (AD/SSO/SSM/Jump)
├─ Sandbox (개발자 실험)
├─ Workloads
│  ├─ Prod
│  ├─ Staging
│  └─ Dev
└─ Data (DWH/Lake, ETL)
```

---

## 2. 조직 통제: Organizations + SCP + SSO

### 2.1 Organizations: 핵심 통합 레버
- **OU 기반 정책 상속**: 하위 계정 일괄 통제
- **SCP(Service Control Policies)**: 계정 내 **최대 권한 상한**을 정의
- **Consolidated Billing**: 청구 통합, 할인 공유

#### SCP 예시: 루트 사용자 차단, 특정 리전 금지, 외부 KMS 금지
```json
{
  "Version": "2012-10-17",
  "Statement": [
    { "Sid": "DenyRoot",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {"StringLike": {"aws:PrincipalArn": ["arn:aws:iam::*:root"]}}
    },
    { "Sid": "DenyUnsupportedRegions",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {"ForAnyValue:StringNotEquals": {"aws:RequestedRegion": ["ap-northeast-2","us-east-1"]}}
    },
    { "Sid": "DenyKMSFromOtherAccounts",
      "Effect": "Deny",
      "Action": ["kms:Encrypt","kms:Decrypt","kms:GenerateDataKey*","kms:ReEncrypt*"],
      "Resource": "*",
      "Condition": {"StringNotEquals": {"kms:ViaService": "s3.ap-northeast-2.amazonaws.com"}}
    }
  ]
}
```

> 팁: SCP는 **허용이 아닌 “상한”** 이다. 실제 허용은 IAM/리소스 정책에서 이뤄진다.

### 2.2 IAM Identity Center(SSO) + 권한 세트
- **중앙 인증/인가**: IdP(Okta/AD/Google) 연동
- **Permission Set** 으로 **역할·환경별 표준 권한** 배포
- **Session Manager** 를 통한 비공개 점프(SSH 키 미배포)

#### 예시 Permission Set(읽기 전용) — IAM 정책 첨부
```json
{
  "Version":"2012-10-17",
  "Statement":[
    {"Effect":"Allow","Action":["ec2:Describe*","s3:ListAllMyBuckets","s3:GetBucketLocation"],"Resource":"*"},
    {"Effect":"Allow","Action":["cloudwatch:Get*","cloudwatch:List*","logs:Describe*","logs:Get*"],"Resource":"*"}
  ]
}
```

---

## 3. 보안 통합: 로그·탐지·분석·대응의 중앙화

### 3.1 조직 로그 표준 — CloudTrail/Config/Flow Logs 집약

#### (A) CloudTrail 조직 트레일
- 모든 계정·모든 리전·관리/데이터 이벤트 활성화
- 대상: **Log-Archive 계정의 S3 버킷**(버전관리+Object Lock)

```json
{
  "Version":"2012-10-17",
  "Statement":[
    {
      "Sid":"AllowOrgTrails",
      "Effect":"Allow",
      "Principal":{"Service":"cloudtrail.amazonaws.com"},
      "Action":"s3:PutObject",
      "Resource":"arn:aws:s3:::org-cloudtrail-logs/AWSLogs/*",
      "Condition":{"StringEquals":{"aws:PrincipalOrgID":"o-xxxxxxxxxx"}}
    }
  ]
}
```

#### (B) AWS Config Aggregator
- 모든 계정/리전의 **구성 변경/규정준수 상태**를 **Security-Tooling** 계정에서 집계

```yaml
Resources:
  ConfigAggregator:
    Type: AWS::Config::ConfigurationAggregator
    Properties:
      OrganizationAggregationSource:
        AllAwsRegions: true
        RoleArn: arn:aws:iam::123456789012:role/ConfigAggRole
```

#### (C) VPC Flow Logs / DNS Query Logs / ALB/NLB 액세스 로그
- 대상 버킷: Log-Archive, 파티셔닝 규칙(계정/리전/서비스/날짜) 표준화

### 3.2 탐지/평가 — GuardDuty / Security Hub / Macie / Inspector / Detective

- **GuardDuty**: 위협 탐지(발견 시 보안 채널로 통보)
- **Security Hub**: CIS/AWS Foundational Best Practices 점수 집계
- **Macie**: S3 내 민감정보(PII) 탐지
- **Inspector**: EC2/ECR/시크릿 취약점 평가
- **Detective**: 인시던트 관계 그래프 분석

> **Delegated Administrator** 패턴: Security-Tooling 계정에 각 서비스의 관리자 위임 후 모든 계정 auto-enroll.

### 3.3 Security Lake (선택)
- 보안 이벤트를 **표준 스키마(ODS)** 로 Lake에 집적 → Athena/GLUE/SIEM에서 분석

---

## 4. 네트워크 전략: 중앙 허브와 일관된 경계 보안

### 4.1 중앙 네트워크 계정(Hub) + Transit Gateway(Spoke)
- 각 워크로드 계정의 VPC는 **Transit Gateway**에 연결
- 온프레미스(VPN/Direct Connect)도 TGW에 종단

```bash
# (요약) TGW 생성 후 계정간 Attachment 공유는 RAM으로
aws ec2 create-transit-gateway --description "Org TGW"
aws ram create-resource-share --name Org-TGW --principals arn:aws:organizations::123456789012:organization/o-xxx --resource-arns arn:aws:ec2:ap-northeast-2:111111111111:transit-gateway/tgw-abc
```

**라우팅 원칙**
- spoke VPC 라우트 테이블 ↔ TGW 라우트 테이블 **쌍방 구성**
- **세그먼트별 라우트 도메인**(Prod/Dev/Shared) 분리로 폭발반경 최소화

### 4.2 중앙 DNS(Resolver) + 프라이빗 존 위임
- Hub 계정에 **Route 53 Resolver Inbound/Outbound** 엔드포인트 배치
- 공유 서비스(AD, 프록시, 내부 API) 이름해결 중앙화
- **DNS Query Log** 를 Log-Archive로 집계

### 4.3 경계·동서 트래픽 보안
- **AWS Network Firewall** 또는 **GWLB + IDS/IPS** 로 L3/L4/L7 필터
- **Firewall Manager** 로 보안그룹/네트워크 방화 정책 일괄 배포
- **VPC Endpoint Policy** 로 서비스 접근 최소권한

```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": ["s3:GetObject","s3:ListBucket"],
      "Resource": ["arn:aws:s3:::corp-artifacts","arn:aws:s3:::corp-artifacts/*"],
      "Condition": {"StringEquals": {"aws:SourceVpce": "vpce-0abc..."}}
    }
  ]
}
```

### 4.4 VPC 공유(Shared VPC) vs VPC 피어링 vs TGW
- **Shared VPC**(RAM): 네트워크 계정이 VPC 소유, 워크로드 계정은 서브넷만 소유(거버넌스 용이)
- **Peering**: 1:1, 규모 커지면 관리 복잡
- **TGW**: 허브/스포크, 라우팅 정책·확장성·온프레 통합 우수

---

## 5. 비용 전략: 통합 청구 → 태깅 표준 → 예산/이상탐지 → 구매 최적화

### 5.1 통합 청구(Consolidated Billing)
- RI/Savings Plans, 볼륨 할인 공유
- 계정별 비용을 **Tag/Cost Category** 로 추가 분해

### 5.2 비용 태그 표준(필수)
- 키: `CostCenter`, `Project`, `Owner`, `Environment`, `DataClass`, `ExpireAt`
- Tagging 정책: Control Tower + Config Rule로 **미태깅 리소스 경고/차단**

### 5.3 예산/이상탐지 자동 알림
```bash
# 월 비용 1000 USD 초과 예측 시 알림
aws budgets create-budget --account-id 123456789012 --budget '{
  "BudgetName":"OrgMonthly",
  "BudgetLimit":{"Amount":"1000","Unit":"USD"},
  "TimeUnit":"MONTHLY","BudgetType":"COST"
}' --notifications-with-subscribers '[
 {"Notification":{"NotificationType":"FORECASTED","ComparisonOperator":"GREATER_THAN","Threshold":1000,"ThresholdType":"ABSOLUTE_VALUE"},
  "Subscribers":[{"SubscriptionType":"EMAIL","Address":"finops@example.com"}]}]'
```

### 5.4 Savings Plans / RI 의사결정(개념 수식)
- 예상 사용량 \(U\), 온디맨드 단가 \(p_o\), 약정 단가 \(p_c\), 커버리지 비율 \(c\) 일 때
$$
\text{월비용} \approx c \cdot U \cdot p_c + (1-c) \cdot U \cdot p_o
$$
- 목표: \(\frac{\partial \text{월비용}}{\partial c} < 0\) 이면서 **유연성 손실**(리스크) 최소가 되는 \(c^*\) 결정

### 5.5 Cost Explorer/Anomaly Detection
- 서비스/리전/계정/태그 축으로 비용 상관분석
- 이상탐지: 급등/급락 패턴 자동 경보

---

## 6. 데이터 보호와 KMS(다계정)

### 6.1 중앙 KMS 전략
- 민감 데이터는 **SSE-KMS**(S3/EBS/RDS/EFS 등)
- **Key Policy + Grants** 로 **다계정 사용 허용**(필요 최소 권한)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {"Sid": "AdminRoot","Effect": "Allow","Principal":{"AWS":"arn:aws:iam::111111111111:root"},"Action":"kms:*","Resource":"*"},
    {"Sid": "GrantToProdApps","Effect":"Allow","Principal":{"AWS":"arn:aws:iam::222222222222:role/app-prod"},
     "Action":["kms:Encrypt","kms:Decrypt","kms:GenerateDataKey*","kms:DescribeKey"],"Resource":"*"}
  ]
}
```

> 팁: **외부 계정의 사용 주체**를 명시하고, 리소스 정책(S3 등)에 **키 조건**을 함께 건다.

---

## 7. 계정 생명주기(AVM) — 생성→정책→런타임→폐기 자동화

### 7.1 Control Tower + Account Factory
- 새 계정 요청 시 **OU·이름·이메일·SSO 권한 세트** 선택
- 생성 직후: **SCP/Guardrails**, **CloudTrail/Config/Alarm** 자동 적용

### 7.2 Service Catalog / Terraform(선택)
- 표준 포트폴리오(네트워크/보안/관측성) 템플릿을 **자서비스** 형태로 배포

### 7.3 계정 폐기 표준 절차
1) 데이터 백업/스냅샷 → Log-Archive 이동
2) 역할/액세스 제거 → 키·시크릿 폐기
3) 청구 정리 → 계정 일시 중지/해지

---

## 8. 운영·모니터링 통합

### 8.1 대시보드(CloudWatch + Cost)
- SLO(가용성/지연) + 보안탐지 + 비용·예산의 **조합 대시보드**
- 워크로드/OU/계정 단위로 **드릴다운**

### 8.2 알림·런북·자동화
- **Security Hub/GuardDuty Findings** → SNS/Slack/Webhook
- **Runbook**: “탐지 → 우선순위 → 임시 차단(WAF/SG) → RCA → 교정”
- **자동 조치**: 예) WAF IP 셋 차단, IAM 액세스키 비활성화, S3 퍼블릭 차단

```yaml
# 예: EventBridge → Lambda 자동조치(요약)
pattern:
  source: ["aws.securityhub"]
  detail-type: ["Security Hub Findings - Imported"]
action:
  - lambda: blockPublicS3
```

---

## 9. 실전 템플릿 모음

### 9.1 OU별 강제 가드레일(SCP) – Sandbox에서 금지 예
```json
{
  "Version":"2012-10-17",
  "Statement":[
    {"Sid":"DenyExpensiveInstances","Effect":"Deny",
     "Action":["ec2:RunInstances"],"Resource":"*",
     "Condition":{"ForAnyValue:StringEquals":{"ec2:InstanceType":["p4d.24xlarge","m7i.metal-48xl"]}}},
    {"Sid":"DenyNoTags","Effect":"Deny",
     "Action":["ec2:RunInstances","rds:CreateDBInstance","s3:CreateBucket"],
     "Resource":"*",
     "Condition":{"Null":{"aws:RequestTag/CostCenter":"true"}}}
  ]
}
```

### 9.2 CloudTrail 조직 트레일 + S3 Object Lock 버킷 정책(요약)
```json
{
  "Version":"2012-10-17",
  "Statement":[
    {"Sid":"AllowOrg","Effect":"Allow",
     "Principal":{"Service":"cloudtrail.amazonaws.com"},
     "Action":"s3:PutObject","Resource":"arn:aws:s3:::org-trails/AWSLogs/*",
     "Condition":{"StringEquals":{"aws:PrincipalOrgID":"o-xxxxxx"}}},
    {"Sid":"DenyDelete","Effect":"Deny","Principal":"*",
     "Action":["s3:DeleteObject","s3:PutBucketVersioning"],"Resource":"arn:aws:s3:::org-trails/*"}
  ]
}
```

### 9.3 Transit Gateway 라우팅(개념)
```text
# TGW RT
Prod-Spoke    10.0.0.0/16  -> VPC-Prod
Shared-Svc    10.1.0.0/16  -> VPC-Shared
OnPrem        172.16.0.0/12-> DX/VPN

# VPC-Prod RT (App Subnet)
0.0.0.0/0     -> NAT
10.1.0.0/16   -> tgw-attach(shared)
172.16.0.0/12 -> tgw-attach(onprem)
```

### 9.4 비용 예산/이상탐지 워크플로
```bash
# (1) Budgets (2) Cost Anomaly Detector (3) Slack/Webhook 통보
aws ce create-anomaly-monitor --anomaly-monitor '{
  "MonitorName":"OrgAnomaly","MonitorType":"DIMENSIONAL","MonitorDimension":"SERVICE"
}'
```

---

## 10. 검증(테스트) 계획 — 통합 점검 시나리오

- **SCP 효과 검증**: 금지 리소스 생성 시도 → 즉시 거부되는지
- **CloudTrail/Config 수집**: 신규 계정 이벤트/구성 변경이 5분 내 집계되는지
- **GuardDuty Auto-Enable**: 신규 계정 생성 시 자동 등록/탐지 동작 여부
- **네트워크 회복탄력성**: TGW/방화 경로 장애 시 우회 경로 동작
- **비용 경보**: 급등 트래픽 유발 → Budgets/Anomaly Detector 알림 수신 확인

---

## 11. 거버넌스 체크리스트(복붙)

- [ ] OU/계정 구조 문서화(목적/소유자/접근경로)
- [ ] Control Tower/Account Factory 도입 및 **표준 템플릿** 공개
- [ ] SCP 기본 세트(루트사용금지/리전제한/퍼블릭차단/태그의무화)
- [ ] SSO 권한세트(읽기·개발·운영·보안) 계층화
- [ ] 조직 트레일 + Object Lock + KMS 암호화
- [ ] Config Aggregator + Security Hub/GuardDuty 위임
- [ ] 네트워크: TGW/Resolver/DNS 로그/방화 표준
- [ ] 비용: 태그 정책/예산/이상탐지/예약구매 가이드
- [ ] KMS: 키정책/그랜트/교체주기/감사
- [ ] 폐기: 데이터 백업/접근 철회/청구 정리 프로세스

---

## 12. FAQ 요약

- **Q. OU가 많아지면 관리가 어려운데?**
  A. OU는 **정책 경계**다. **환경(Prod/Dev)**, **위험 수준**, **데이터 민감도**로 최소 세트를 만들고, 팀·제품은 **태그/Cost Category**로 분리하라.

- **Q. Shared VPC vs TGW?**
  A. 중앙 거버넌스·간단 연결이면 **Shared VPC**, 다수 리전·온프레 통합·세그먼트 라우팅이면 **TGW**.

- **Q. 모든 계정을 Control Tower로?**
  A. 신규 계정부터 권장. 레거시는 순차 편입(Migration 워크플로)로 리스크 최소화.

---

## 13. 결론

멀티 계정은 **격리와 통합의 균형**이다. 계정은 경계로 격리하고, **정책/로그/네트워크/비용**은 중앙에서 통합한다.
핵심은 **표준화**(OU/템플릿/권한/태그), **자동화**(Control Tower/SSO/Config/Infra as Code), **관측성**(보안+운영+재무)이다.
이 가이드를 기반으로 **조직 맞춤형 표준**을 만들고, 분기별 **거버넌스 리뷰**로 성숙도를 끌어올려라.
