---
layout: post
title: 네트워크보안 - 무선·근거리 네트워크
date: 2025-10-27 17:25:23 +0900
category: 네트워크보안
---
# 12. 무선·근거리 네트워크

> 목표: **WPA2→WPA3·802.1X/EAP-TLS 보안 모델**을 이해하고, **WIDS/WIPS·Rogue AP 탐지**를 현업 관점으로 설계한다.

---

## 12.1 WPA2 → WPA3, 802.1X/EAP-TLS

### 12.1.1 보안 모델 한눈에
- **WPA2-PSK (Personal)**
  - 인증/키 합의: **4-Way Handshake**(PMK=PSK·PMKID)
  - 약점: **약한 PSK**에 대한 오프라인 추측 위험, PMF(Optional)
- **WPA2-Enterprise (802.1X/EAP)**
  - 인증: **EAP**(TLS/TTLS/PEAP 등) + RADIUS/AAA
  - 장점: 사용자/기기 **개별 자격증명**, 회수/회전 가능
- **WPA3-SAE (Personal)**
  - 인증: **SAE(Dragonfly PAKE)** → 오프라인 추측 완화, **PMF(필수)**
  - 호환: WPA2/WPA3 전환기에는 **Transition Mode** 주의(다운그레이드 표면)
- **WPA3-Enterprise**
  - 인증: **EAP-TLS(권장)**, 192-bit 모드 선택 가능, PMF 필수

> 운영 원칙:
> 1) **WPA3 우선**(가능시 **SAE Only**), 과도기에는 **Transition 최소화**.
> 2) 엔터프라이즈는 **EAP-TLS**로 “패스워드리스” + **단말 증명서 수명 관리**.
> 3) **PMF(Protected Management Frames)** 필수 → 디스어쏘시에이션 위조 완화.

---

### 12.1.2 WPA3-Personal(사내/게스트 분리)
- **게스트**: 별도 SSID(인터넷 전용), **WPA3-SAE Only** + **Captive Portal(정책 동의)**
- **사내**: **802.1X(EAP-TLS)** 권장. BYOD는 별도 SSID에서 **온보딩** 후 제한적 접근(ZTNA).

**AP(개념 설정, 벤더 중립)**
- `corp-wifi` (사내) : WPA3-Enterprise, EAP-TLS, PMF **Required**, VLAN 20
- `corp-guest` (게스트): WPA3-Personal(SAE Only), PMF **Required**, VLAN 30, L3 분리/인터넷 전용

---

### 12.1.3 802.1X / EAP-TLS 설계 포인트
- **CA/PKI**: 엔터프라이즈 CA로 **단말/사용자 증명서** 발급, **CRL/OCSP** 가용성 확보
- **RADIUS**: **RadSec(TLS) 또는 DTLS**로 AP–AAA 구간 암호화, 동시세션/성능 설계
- **정책**: AD/IdP 그룹 → RADIUS **Filter-Id/VLAN** 동적 할당(역할 기반 네트워크)
- **수명관리**: 짧은 만료(예: 1년) + 자동 갱신 + 분실/퇴사 즉시 폐기

**FreeRADIUS (개념 스니펫)**
```text
# mods-enabled/eap
eap {
  default_eap_type = tls
  tls-config tls-common {
    private_key_password = whatever
    private_key_file = ${certdir}/server.key
    certificate_file = ${certdir}/server.crt
    ca_file = ${cadir}/corp_ca.pem
    dh_file = ${certdir}/dh
    fragment_size = 1200
  }
}

# sites-enabled/default (authorize)
authorize {
  eap
}

# sites-enabled/default (post-auth)
post-auth {
  if (ok) {
    update reply {
      Tunnel-Type := VLAN
      Tunnel-Medium-Type := IEEE-802
      Tunnel-Private-Group-Id := "20"   # 부서/역할 기반 VLAN
    }
  }
}
```

> 실무 팁: **EAP-TLS Only** SSID를 별도로 두고, **PEAP/TTLS 사용 금지**(암호 재사용/피싱 표면).
> 무선 컨트롤러/클라우드 관리 AP는 **RADIUS over TLS**(RadSec) 지원 여부 확인.

---

### 12.1.4 PMF(Protected Management Frames)
- **역할**: 디스어쏘시에이션/디어쏘시에이트 등 Mgmt 프레임 무결성 보호
- **운영**: WPA3에서 **필수(Required)**, WPA2 환경도 **Capable→Required**로 상향

**무선 컨트롤러 설정 예(개념)**
- SSID `corp-wifi`: PMF = **Required**
- SSID `corp-guest`: PMF = **Required**
- 로그/모니터링: **Unprotected Mgmt counter** 경보

---

## 12.2 WIDS/WIPS, Rogue AP 탐지

### 12.2.1 용어·역할
- **WIDS**: 수동/스니핑 전용 센서(전용 AP/무선 카드)로 **이상 신호 탐지**
- **WIPS**: WIDS + 정책 기반 **자동 차단**(예: 불법 연결 차단)
  - ⚠️ “차단”은 법적 이슈(전파 방해 등) 소지가 있으므로 **정합성/법규** 검토 필수.
  - 본 문서는 **탐지·알림·조치 워크플로우** 중심으로 설명한다.

### 12.2.2 공격/이상 시나리오 → 탐지 신호
- **Rogue AP**: 사내 SSID/유사 SSID를 **타 BSSID/OUI**로 브로드캐스트
  - 신호: **같은 SSID·다른 OUI(제조사)**, **이상 채널/출력**
- **Evil Twin**: 강한 신호로 동일 SSID, **암호화 매개변수 불일치**(WPA3→WPA2/Open)
  - 신호: **RSN/AKM/PMF 불일치**, **Transition 비율 급증**
- **Ad-hoc/SoftAP**: 노트북·핫스팟의 임시 AP
  - 신호: **IBSS/Personal hotspot OUI**
- **WPS 활성화**: PIN 모드 노출(단종 권고)
  - 신호: **WPS IE 존재**
- **무단 브리지(유선–무선)**
  - 신호: **동일 MAC 출현 위치 이동**, **포트보안 위반 + 무선 센서 근접**
- **Mgmt 프레임 이슈**
  - 신호: **비보호 Deauth/Disassoc** 프레임 다량(※ 합법 테스트/로밍과 구분 필요)

### 12.2.3 탐지 운영 흐름
1) **스캐닝/센싱**: 전용 채널 스캔, DFS 채널 포함 규정 준수
2) **정책 매핑**: “허용된 BSSID/채널/RSN” 화이트리스트
3) **알림**: SIEM 티켓화(심각도: 동일 SSID + 보안 강등 > WPS > 신규 SSID)
4) **현장 검증**: 물리 위치 삼각측량(센서 다점), OT/시설팀 협업
5) **조치**: AP 폐기/차폐, 포트보안 강화, 사용자 교육

---

## 12.3 블루투스 / Zigbee / LoRa / UWB

> 범용 Wi-Fi 외에 **근거리/저전력/정밀측위** 기술의 보안 포인트를 요약한다.

### 12.3.1 Bluetooth (Classic & BLE)
- **페어링**:
  - **LE Secure Connections(권장)** — ECDH 기반, **Just Works** 지양(중간자 위험)
  - **Passkey/Numeric Comparison** 선호, “기기 디스플레이/입력” 조합 설계
- **프로파일**: HID/Audio/Beacon/Custom GATT — **권한 스코프 최소화**(필요 서비스만)
- **운영**:
  - 비관리 기기 BYOD 제한, **광고(Advertising) 데이터에 PII 금지**
  - 스캔/연결 로그 → **불법 비콘** 탐지, 주기적 펌웨어 업데이트

**BLE 스캔(파이썬, benign 예시: `bleak`)**
```python
# pip install bleak
import asyncio
from bleak import BleakScanner

async def main():
    devices = await BleakScanner.discover(timeout=5.0)
    for d in devices:
        # 제조사 데이터/서비스 UUID 일부 출력(보안/개인정보 고려해 최소화)
        print(d.address, d.name, d.rssi, list(d.metadata.get("uuids", [])[:3]))

asyncio.run(main())
```

### 12.3.2 Zigbee (IEEE 802.15.4, 메쉬 IoT)
- **키 관리**: 네트워크 키(전역) + 링크 키. **EZ-mode/디폴트 키 금지**, **Install Code** 사용
- **보안 레벨**: AES-CCM*, 프레임 카운터(재전송 방지) — **카운터 재설정 방지**
- **운영**: 신뢰할 수 있는 코디네이터(게이트웨이)만 허용, **네트워크 분리**(OT/IT 구분), OTA 업데이트 서명 검증

### 12.3.3 LoRa/LoRaWAN
- **키**: AppKey/NetworkKey, **Join-Server** 통한 OTAA 권장(ABP는 재사용 위험)
- **프레임 카운터**: 재전송 방지, 게이트웨이–네트워크 서버 **TLS**
- **운영**: 장치 키 보호(제조–현장), Region/DR 정책 준수, **SNR/ADR** 모니터링으로 이상 탐지

### 12.3.4 UWB (IEEE 802.15.4z, 정밀 측위)
- **보안 프레임**: **ST-SFD/HRP** 등, **치트 시도(리플레이/거리 사기)** 완화 기능
- **운영**: **크립토 앵커**(루트 키 보호), **안테나 배치/차폐**, 위치정보 접근 통제/익명화

---

## 12.4 실습: 무선 패킷 캡처 & 탐지 룰

> **목적**: 법적/허가된 랩에서 **무선 환경 상태점검**과 **Rogue/AP 보안강등** 신호를 **자동 감지**한다.
> 공격 유발(비인가 디스어쏘시에이트·재밍 등)은 수행하지 않는다.

### 12.4.1 랩 구성
- **테스트 AP 2대**:
  - `corp-wifi` : WPA3-Enterprise(EAP-TLS), PMF Required
  - `corp-guest`: WPA3-SAE Only, PMF Required
- **센서 노트북**: 모니터 모드 지원 무선 NIC(5GHz/6GHz 규정 준수), 리눅스
- **소프트웨어**: `tcpdump`/`tshark`/`Wireshark`, 파이썬 `scapy`, (선택) 무선 컨트롤러 API

**주의**: 채널 스캔·DFS 채널 사용 요건 등 **국가 전파 규정** 준수.

---

### 12.4.2 모니터 모드 캡처(예시)
```bash
# 1. 인터페이스 모니터 모드 전환(드라이버/배포판마다 다름)
sudo ip link set wlan0 down
sudo iw dev wlan0 set type monitor
sudo ip link set wlan0 up

# 2. 특정 채널 고정(예: 36)
sudo iw dev wlan0 set channel 36

# 3. 관리/빔포밍/데이터 프레임 포함 캡처
sudo tcpdump -i wlan0 -s 0 -w lab_ch36.pcap
```

> 실무 팁: **채널 고정** 후 일정시간(예: 5~10분) 수집 → 채널 교대. 로밍/PMF 확인에는
> **Beacon/Probe/Assoc/Reassoc/Deauth/Disassoc** 프레임이 중요.

---

### 12.4.3 Wireshark/TShark 디스플레이 필터
- **Beacon 프레임**: `wlan.fc.type_subtype == 8`
- **RSN 정보요소**: `wlan.rsn.version` / `wlan.rsn.akms.type` / `wlan.rsn.capabilities.mfpr`
- **WPA3-SAE AKM**: `wlan.rsn.akms.type == 8` (벤더/툴 버전에 따라 상이할 수 있음)
- **WPS IE 존재**: `wlan.tag.number == 221 && wlan.tag.oui == 00:50:f2 && wlan.tag.vendor.type == 4`(벤더 의존)
- **비보호 Deauth**: `wlan.fc.type_subtype == 12 && wlan.fixed.reason_code && !wlan.mgt.protected`
- **Open/암호화 약화**: `wlan.fixed.capabilities.privacy == 0`

---

### 12.4.4 파이썬(Scapy)로 **Rogue/강등** 신호 스코어링
> 캡처 파일에서 **SSID별 “정상 프로파일”**(허용 BSSID/OUI·채널·RSN/PMF)을 기준으로 **이상치**를 탐지한다.

```python
# pip install scapy
# safe_wifi_score.py : Beacon/Assoc 파싱 → 위험 스코어
from scapy.all import rdpcap, Dot11, Dot11Beacon, Dot11Elt
from collections import defaultdict
import json, sys

# 허용 프로파일(예: CMDB/컨트롤러에서 동기화)
ALLOW = {
  "corp-wifi": {
    "bssid": {"00:11:22:33:44:55","00:11:22:33:44:66"},
    "ouis":  {"Cisco","Aruba","Ubiquiti"},  # 벤더명은 예시
    "channels": {36, 40, 44, 48},
    "akm": {"EAP", "EAP-SHA256"},           # Enterprise
    "pmf_required": True
  },
  "corp-guest": {
    "bssid": {"00:aa:bb:cc:dd:ee"},
    "ouis":  {"Cisco","Aruba","Ubiquiti"},
    "channels": {36, 40, 44, 48},
    "akm": {"SAE"},                         # WPA3-Personal
    "pmf_required": True
  }
}

AKM_MAP = {
  1: "802.1X", 2: "PSK", 3: "FT-802.1X", 4: "FT-PSK",
  5: "802.1X-SHA256", 6: "PSK-SHA256", 8: "SAE", 12:"OSEN"
}

def parse_rsn(elt):
  # 단순 파서(스펙 단순화): AKM 목록과 PMF 요구비트 추출
  raw = elt.info
  akms = set()
  pmf_required = False
  try:
    # RSN Capabilities는 RSN IE 끝에서 2바이트 (가변 구조, 예외 처리)
    # AKM Suite Count/Types 파싱
    pos = 0
    # Version(2) + GroupCipher(4)
    pos += 2 + 4
    # Pairwise Count(2) + Types(4*n)
    pc = int.from_bytes(raw[pos:pos+2],'little'); pos += 2 + 4*pc
    # AKM Count(2)
    ac = int.from_bytes(raw[pos:pos+2],'little'); pos += 2
    for _ in range(ac):
      # OUI(3) + type(1)
      t = raw[pos+3]
      pos += 4
      akms.add(AKM_MAP.get(t, f"OUI-{t}"))
    # RSN Capabilities(2)
    caps = int.from_bytes(raw[pos:pos+2],'little'); pos += 2
    # PMF Required bit (bit 7) – 표준에서 MFP Required는 1<<7
    pmf_required = bool(caps & (1<<7))
  except Exception:
    pass
  return akms, pmf_required

def score_pcap(path):
  pkts = rdpcap(path)
  findings = []
  seen = defaultdict(set)  # ssid -> BSSID set

  for p in pkts:
    if not p.haslayer(Dot11Beacon):
      continue
    dot11 = p[Dot11]
    ssid, chan, akms, pmf_req = None, None, set(), False
    bssid = dot11.addr2.lower() if dot11.addr2 else "unknown"
    oui = "Unknown"

    elt = p[Dot11Elt]
    while isinstance(elt, Dot11Elt):
      if elt.ID == 0:
        ssid = elt.info.decode(errors="ignore")
      elif elt.ID == 3:
        chan = elt.info[0]
      elif elt.ID == 48: # RSN
        akms, pmf_req = parse_rsn(elt)
      elif elt.ID == 221 and elt.info[:3] == b"\x00\x50\xf2": # WPS/WPA vendor IE (간단표현)
        pass
      elt = elt.payload if hasattr(elt,"payload") else None

    if not ssid:
      continue
    seen[ssid].add(bssid)

    if ssid in ALLOW:
      prof = ALLOW[ssid]
      risk = 0
      reasons = []
      if bssid not in (x.lower() for x in prof["bssid"]):
        risk += 30; reasons.append("BSSID not in allowlist")
      if chan and chan not in prof["channels"]:
        risk += 20; reasons.append(f"channel {chan} unexpected")
      # AKM 분석(간단히)
      wanted = prof["akm"]
      if not (akms & wanted):
        risk += 30; reasons.append(f"AKM mismatch: found {sorted(akms)} need {sorted(wanted)}")
      if prof["pmf_required"] and not pmf_req:
        risk += 25; reasons.append("PMF not required")
      if risk>0:
        findings.append({
          "ssid": ssid, "bssid": bssid, "channel": chan,
          "akm": sorted(akms), "pmf_required": pmf_req,
          "risk": risk, "reasons": reasons
        })
    else:
      # 미등록 SSID – 관찰
      findings.append({
        "ssid": ssid, "bssid": bssid, "channel": chan,
        "akm": sorted(akms), "pmf_required": pmf_req,
        "risk": 10, "reasons": ["unknown SSID"]
      })

  return {"findings": sorted(findings, key=lambda x:-x["risk"]), "seen": {k:list(v) for k,v in seen.items()}}

if __name__ == "__main__":
  path = sys.argv[1] if len(sys.argv)>1 else "lab_ch36.pcap"
  report = score_pcap(path)
  print(json.dumps(report, indent=2, ensure_ascii=False))
```

**사용 예**
```bash
python3 safe_wifi_score.py lab_ch36.pcap > wifi_report.json
```

**결과 해석**
- `risk >= 50`: **동일 SSID인데 BSSID/채널/AKM/PMF가 불일치** → Evil Twin/강등 의심
- `risk 10–30`: 미등록 SSID/게스트용 단말 핫스팟 등 → 현장 확인

---

### 12.4.5 “보안 강등(Transition)” 가시화 대시보드(개념)
- 지표: SSID별 **WPA3(Required) 비율**, **Transition 연결 비율**, **PMF 미적용 비율**, **WPS 탐지 수**
- 경보:
  - `corp-wifi`에서 **Open/WPA2** Beacon 감지 시 **P1 경보**
  - `corp-guest`에 **WPS IE** 등장 시 **P2 경보**
  - **비보호 Deauth**가 단시간 급증 시 **관찰 경보**(로밍 이벤트와 상관분석)

---

### 12.4.6 WIDS 룰(의사 규칙)
```
RULE: SSID Security Downgrade
WHEN: beacon.ssid in ALLOW and (
        beacon.akm not intersects ALLOW[ssid].akm
        OR (ALLOW[ssid].pmf_required == true AND beacon.rsn.pmf_required == false)
      )
THEN: alert(severity=high, ssid, bssid, reason, channel)

RULE: Rogue BSSID Vendor Mismatch
WHEN: beacon.ssid in ALLOW and vendor(bssid) not in ALLOW[ssid].ouis
THEN: alert(severity=high, ssid, bssid, vendor)

RULE: WPS Present on Corporate SSID
WHEN: beacon.ssid == "corp-wifi" and beacon.has_wps == true
THEN: alert(severity=high)
```

---

### 12.4.7 BYOD·게스트 운영 체크리스트
- [ ] **SSID 분리**(사내/게스트), L3 라우팅 분리, **인터넷 전용 게스트**
- [ ] 게스트는 **WPA3-SAE Only** + Captive Portal 정책 동의(로깅/보관정책 명시)
- [ ] 사내는 **EAP-TLS** + **PMF Required**, **RadSec**
- [ ] **Transition**은 가능한 짧은 기간만, **강등 탐지 경보**
- [ ] **WPS 비활성화**, 오래된 AP 교체
- [ ] **채널/출력/로밍 정책** 표준화(혼잡/간섭 최소화)
- [ ] **무선 컨트롤러 API**로 BSSID/채널/클라이언트 동향 지표 수집
- [ ] **법/규정 준수**: 로그(PII) 최소수집/보존기간/접근통제

---

## 부록 A. 엔드포인트(노트북) 보안 권고
- **프라이빗 주소 무작위화(MAC Randomization)** 활성
- 신뢰되지 않은 네트워크에서 **자동 연결 금지**
- **TLS 1.2/1.3 강제**, 인증서 검증 실패 시 경고 차단
- **Wi-Fi 프로파일 관리**: SSID 우선순위/자동 연결 OFF, 필요시만 사용

## 부록 B. 컨트롤러/클라우드 AP 연동 아이디어
- **Webhook/Syslog**로 **새 BSSID/새 SSID** 이벤트 수집 → CMDB와 대조
- **RRM**(Radio Resource Mgmt) 변경 시 **승인 워크플로우**
- **패치 레벨**/펌웨어 드리프트 대시보드

## 부록 C. IoT(비-Wi-Fi) 보안 운영 메모
- **BLE**: “Just Works” 금지, **LE Secure Connections**, 페어링 로그
- **Zigbee**: **Install Code** 사용, 디폴트 키 금지, 오프보딩 절차 마련
- **LoRaWAN**: **OTAA** 기본, 키 보호/교체 계획, **FCnt** 모니터
- **UWB**: 위치정보 **최소 수집/익명화**, **거리 사기** 완화 기능 활성

---

## 요약
- **WPA3 + PMF + EAP-TLS**가 현대 무선의 기본 방어선이다.
- **WIDS**는 **Rogue/Evil Twin/강등/Ad-hoc/WPS** 신호를 **화이트리스트 대비**로 탐지한다.
- **BLE/Zigbee/LoRa/UWB**는 각각의 보안 모델과 운영 포인트가 다르므로 **키/인증/펌웨어/분리**를 핵심으로 본다.
- 실습은 **법적/합의된 범위** 내에서 **모니터·탐지 중심**으로 수행하고, 발견사항은 **정책·장비 설정**에 반영한다.
