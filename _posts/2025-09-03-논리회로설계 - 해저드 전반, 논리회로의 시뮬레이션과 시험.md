---
layout: post
title: 논리회로설계 - 해저드 전반, 논리회로의 시뮬레이션과 시험
date: 2025-09-03 18:25:23 +0900
category: 논리회로설계
---
# 조합회로 설계 & 시뮬레이션 — **해저드(Glitch) 전반**, **논리회로의 시뮬레이션과 시험(Testing)**

> 표기: \(+\)=OR, \(\cdot\) 또는 생략=AND, \(\overline{X}\)=NOT \(X\), \(X' \equiv \overline{X}\), \(\oplus\)=XOR.  
> 목표: 조합 논리회로에서 **해저드의 원인·종류·검출·제거**를 체계적으로 정리하고, **시뮬레이션(기능/타이밍)**과 **시험(verification & manufacturing test)** 절차를 “빠짐없이” 다룹니다.

---

## 1) 조합 논리회로의 **해저드(Glitch)**

### 1.1 왜 생기나? (근본 원인)
- **경로 지연 불균형**: 동일 입력이 **재수렴(reconvergent)** 하며 서로 다른 지연을 거쳐 한 출력에 합쳐질 때, **잠깐 잘못된 값**(짧은 펄스)이 튐.
- **인접 1(또는 0)을 한 곱항(또는 합항)이 동시에 덮지 못할 때**(K-map 관점).
- **게이트의 관성 지연(inertial)**: 짧은 펄스는 걸러지지만, 임계보다 긴 펄스는 **글리치**로 관측.

### 1.2 해저드의 종류
- **정적-1 해저드(static-1)**: 이론상 출력이 **1→1**이어야 하는 전이에서 **0**이 잠깐 나옴.  
  예) \(F=AB+\overline{A}C\), \(A\) 토글, \(B=C=1\).
- **정적-0 해저드(static-0)**: 이론상 **0→0**이어야 하는데 **1** 펄스 발생. (POS에서 대칭)
- **동적 해저드(dynamic)**: 0→1 전이 시 **여러 번 튐(0→1→0→1)**. 경로가 여럿이고 지연이 복잡할 때.
- **기능적 해저드(functional)**: **여러 입력이 동시**에 변할 때 작동 순서에 따라 다른 일시값. (근본적으로 환경·프로토콜 문제)
- **필수(essential) 해저드**: (주로 **비동기** 회로) 물리 경로의 **전파 방향 차이**로 발생. 논리식만으로는 제거 어려움 → 배선/지연 설계 필요.

### 1.3 K-map으로 **정적 해저드 검출**
- **규칙**: 출력이 동일(1-1 또는 0-0)인 **한 비트 차이(에지)** 쌍이 **하나의 임플리컨트(묶음)**로 **동시에 덮여야** 해저드 없음.
- SOP(1 묶기)에서는 **정적-1** 방지, POS(0 묶기)에서는 **정적-0** 방지.

### 1.4 **합의(컨센서스) 항**으로 제거 (SOP 기준)
- 정리: \(AB+\overline{A}C + \underline{BC} \;=\; AB+\overline{A}C\).  
  → \(\underline{BC}\) 는 **논리적으로 불필요**(제거 가능)이지만, **물리적 중첩**을 만들어 **정적-1 해저드 제거**.
- **알고리즘(해저드-프리 커버)**  
  1) 최소 SOP를 얻는다.  
  2) K-map에서 **1–1 에지**인데 **어느 한 곱항도 두 셀을 같이 덮지 않으면**, 두 셀을 함께 덮는 **추가 임플리컨트**를 넣는다.  
  3) don’t-care가 있으면 **그룹을 키우는 방향**으로 포함.

### 1.5 동적 해저드 대처
- 가능한 원인: 다단·재수렴 경로가 많고, 하나의 전이에서 **여러 임플리컨트가 순차적으로 켜졌다 꺼짐**.
- **대책**
  - 2단 구조로 **단순화**(SOP→NAND–NAND / POS→NOR–NOR) + **임플리컨트 중첩** 강화.
  - **샤논 전개** + **MUX 구현**으로 “**단일 경로**” 강제:  
    \[
    F = x\cdot F_1 + \overline{x}\cdot F_0 \;\Rightarrow\; \text{MUX}(x,F_1,F_0)
    \]
  - **지연 균형화**: 동일 신호의 분기 경로에 비슷한 지연을 갖도록 **버퍼/배선 길이** 조정.

### 1.6 해저드와 전력
- 글리치는 **불필요 토글** → 동적전력 \(P\approx \alpha C V^2 f\)의 \(\alpha\) 증가.  
- 대형 조합 블록에서 글리치 제거는 **성능**뿐 아니라 **전력 절감**에도 유효.

### 1.7 예시 (타이밍도)
```
A:  ────┌────────
        │
        └────────
B:  ─────────────  (1)
C:  ────────┌────  (1 유지)
            │
            └────
F = AB + A'C:
    ────┐__/\_____   ← 정적-1 해저드(짧은 0 펄스)
        └─────────
F' = AB + A'C + BC:
    ──────────────   ← 합의항으로 중첩 확보 → 해저드 완화
```

---

## 2) 논리회로의 **시뮬레이션** (기능/타이밍, 모델, 파형)

### 2.1 시뮬레이션 수준
- **기능(Zero-delay/Unit-delay)**: 논리 기능 검증, 해저드 존재 가능성 파악의 첫 단계.
- **게이트-레벨 타이밍**: 셀/배선 지연 반영.  
  - **SDF(표준 지연 포맷) 백어노테이션**으로 **min/typ/max** PVT 코너 확인.
- (필요시) **Tr. 레벨(Spice)**: 정밀 아날로그, 상승/하강 시간·슈트/홀드 여유 추정.

### 2.2 지연 모델
- **전파 지연** \(t_{pHL}, t_{pLH}\), **오염 지연** \(t_{cd}\), **배선 지연** \(t_{wire}\).  
- **관성(Inertial)** vs **수송(Transport)**  
  - 관성: 임계보다 **짧은 펄스는 소거**(현실 게이트 근사).  
  - 수송: 펄스를 **그대로 전달**(배선 모델·Worst-case 탐색).

### 2.3 2/4/9-값 로직 & X-전파
- \(0,1\) + **X(Unknown), Z(High-Z)** … 비교/연산의 X 전파에 주의(과도한 낙관/비관 방지).
- **초기화**(reset) 없는 조합경로가 레지스터에 영향 → **X-전파 체크**로 조기 발견.

### 2.4 Verilog 예: 해저드 관찰(게이트 지연 부여)
```verilog
`timescale 1ns/1ps
module hazard_demo(input A,B,C, output F);
  wire nA, t1, t2;
  not  #(1,1)  U0(nA, A);
  and  #(2,2)  U1(t1, A, B);    // 경로1
  and  #(3,3)  U2(t2, nA, C);   // 경로2 (느림)
  or   #(1,1)  U3(F, t1, t2);
endmodule

module tb;
  reg A,B,C; wire F;
  hazard_demo U(.A(A),.B(B),.C(C),.F(F));
  initial begin
    $dumpvars;
    B=1; C=1; A=0; #5; // 정상상태 F=1
    A=1;        #30;   // A 토글 시 글리치 관찰
    $finish;
  end
endmodule
```

### 2.5 글리치 폭 측정 & 어서션(간단)
```verilog
real t_last;
always @(posedge F or negedge F) begin
  if ($time != 0) begin
    real pw = $realtime - t_last;
    if (pw < 1.5) $display("**GLITCH width=%0t at %0t", pw, $time);
  end
  t_last = $realtime;
end
```
> 실제 프로젝트에서는 **SystemVerilog Assertions(SVA)**로 **pulse width** 체크, **CDC**/지연 여유 어서션을 함께 둡니다.

### 2.6 타이밍도 읽기 요령
- **동일 축**에 입력/내부노드/출력을 나란히 배치 → 경로 지연 차이를 시각화.  
- **최장 경로(크리티컬)**, **최단 경로**(오염) 둘 다 표시하여 **글리치 창** 확인.

---

## 3) **시험(Testing)** — 기능 검증부터 제조 시험까지

### 3.1 설계 검증(Verification)
- **Directed + Random/Constrained-Random** 테스트벤치.  
- **커버리지**: 코드(라인/분기), **함수 커버리지**(상태·코너), **토글**.  
- **등가성 검사(LEC)**: 합성 전후(RTL ↔ 게이트) **포멀 등가성**.  
- **포멀 검증**: 조합 블록은 **SAT/BDD**로 명세 위반 불가를 증명하기 용이.

### 3.2 제조 시험(Manufacturing Test) — 조합 회로의 핵심
- **결함 모델**
  - **Stuck-at**(노드가 **고정 0/1**): 노드당 2개 결함 가정 → 총 \(2N\).  
  - **Transition/Delay fault**: 느린 상승/하강.  
- **ATPG**(자동 테스트 패턴 생성):  
  1) **활성화**(결함 노드에 **반대 값** 강제),  
  2) **전파**(출력까지 **관측 경로** 개방),  
  3) **정당화**(입력으로 조건 만족).  
- **테스트 품질 지표**: **Fault coverage** \(=\#\text{검출 결함}/\#\text{총 결함}\).  
- **제어성/관측성**(SCOAP): 숫자가 작을수록 테스트 용이.  
- **BIST**(자체 시험): **LFSR**로 패턴 생성, **MISR**로 응답 압축.  
  - **서명(aliasing)** 확률 \(\approx 1/2^n\) (n=서명 비트수).

### 3.3 간단 stuck-at 시험 예(시뮬레이션)
```verilog
// 회로
module comb(input A,B,C, output F);
  assign F = (A & B) | (~A & C);
endmodule

// 결함 주입: 내부 신호 t1 stuck-at-0
module comb_faulty(input A,B,C, output F);
  wire t1 = 1'b0;       // 원래는 A & B
  assign F = t1 | (~A & C);
endmodule

module tb;
  reg A,B,C; wire F_ok, F_bad;
  comb        U1(.A(A),.B(B),.C(C),.F(F_ok));
  comb_faulty U2(.A(A),.B(B),.C(C),.F(F_bad));

  initial begin
    $display("A B C | good bad");
    for (int i=0;i<8;i++) begin
      {A,B,C}=i[2:0]; #1;
      $display("%0b %0b %0b |  %0b    %0b", A,B,C,F_ok,F_bad);
    end
    $finish;
  end
endmodule
```
- **검출 패턴**: \(A=B=1,C=0\) 등에서 정상 \(F=1\), 결함 \(F=0\) → **검출 성공**.

---

## 4) **해저드-프리 설계 절차**(SOP 기준, 실무 레시피)

1) **최소 SOP**를 얻는다(K-map/알고리즘).  
2) 모든 **1–1 에지**(한 비트 차) 쌍을 훑는다.  
3) 해당 에지가 **어떤 곱항 하나에라도** 포함되어 있으면 OK.  
4) 아니면 두 셀을 함께 덮는 **추가 임플리컨트**(합의항 포함)를 추가.  
5) don’t-care가 있으면 묶음을 **더 크게**(2,4,8셀) 만들어 **리터럴 수↓ + 해저드-프리**를 동시에 달성.  
6) **2단 구현(NAND–NAND)** 으로 매핑하고, 필요 시 **지연 균형**(버퍼)·**배선 길이 맞춤**.  
7) 타이밍 시뮬레이션으로 **펄스 폭**과 **전력 토글** 확인.

> POS에서는 위 절차를 **0–0 에지**와 **합항**에 대해 대칭적으로 적용(정적-0 해저드 방지).

---

## 5) 종합 예제 — “설계→해저드 제거→시뮬레이션→시험”

**사양**: \(F=1\) iff 다수결(3입력 \(\ge 2\)). \(F=\sum m(3,5,6,7)=AB+AC+BC\).

### 5.1 해저드 점검
- K-map에서 1-덩어리가 **상호 중첩**(AB, AC, BC가 서로 겹침) → **정적-1 해저드 없음**.  
- 만약 \(F=(A+B)(A+C)\) 로 구현(= \(A+BC\))하면, 다단 경로에서 **동적 해저드** 가능 → **SOP 2단**으로 유지 권장.

### 5.2 NAND–NAND 2단 구현
- 1단: \(N_1=(AB)'\), \(N_2=(AC)'\), \(N_3=(BC)'\)  
- 2단: \(F=\overline{N_1 N_2 N_3}\).

### 5.3 타이밍 시뮬 & 시험
- **경로 지연을 비대칭**으로 부여해 글리치 여부 확인 → 없음(중첩 충분).  
- **Stuck-at** 결함(예: \(AB\) 경로 stuck-at-0) 테스트 패턴 생성: \(A=B=1,C=0\) 등.

---

## 6) 체크리스트 (현장용)

- [ ] **해저드-프리 커버**: 모든 1–1(또는 0–0) 에지를 한 임플리컨트가 덮는가?  
- [ ] **합의항** 추가가 필요한가? (전력/면적과 트레이드오프)  
- [ ] **2단 매핑**(NAND–NAND / NOR–NOR) + **지연 균형**.  
- [ ] **기능/타이밍 시뮬레이션** 모두 수행, **SDF min/typ/max** 코너 확인.  
- [ ] **X-전파** 경로 차단(초기화/리셋/풀다운 저항 등 설계).  
- [ ] **시험 전략**: ATPG 대상 결함·커버리지 목표, BIST 여부, 관측성/제어성 확보.

---

## 7) 연습문제 (원하면 해설 제공)

1) \(F=AB+\overline{A}C\):  
   - (a) K-map으로 정적-1 해저드를 표시하고,  
   - (b) 해저드-프리 커버로 수정(SOP),  
   - (c) 수정 전/후 타이밍 시뮬 코드를 작성·비교.

2) POS \(F=(A+B)(\overline{A}+C)\):  
   - (a) 정적-0 해저드 조건을 찾고,  
   - (b) 필요 합항을 추가,  
   - (c) NOR–NOR 2단으로 구현.

3) 재수렴 경로가 큰 회로에서 **동적 해저드**가 발생하는 파형을 만들고,  
   - (a) **MUX(샤논)** 기반 구현으로 비교,  
   - (b) 글리치 폭을 수치로 리포트.

4) 작은 조합 블록에 대해 **stuck-at** 결함 리스트를 만들고(노드 6개라면 12개),  
   - (a) 검출 패턴을 수작업으로 도출,  
   - (b) 테스트벤치를 작성하여 **fault coverage**를 출력.

---

### 포켓 요약
- **해저드=지연 불균형 + 덮개 부족**. K-map에서 **에지마다 한 임플리컨트**가 덮게 하라.  
- **합의항**은 논리적으로 불필요하지만 물리적으로 **안정**을 준다.  
- **시뮬레이션**은 기능→타이밍(SDF) 순, **관성 vs 수송** 모델을 이해.  
- **시험**은 설계 검증(기능·타이밍·포멀)과 제조 시험(ATPG/BIST) 둘 다 필요.