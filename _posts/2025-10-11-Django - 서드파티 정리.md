---
layout: post
title: Django - 서드파티 정리
date: 2025-10-11 15:25:23 +0900
category: Django
---
# 자주 쓰는 서드파티 정리 — DRF / Allauth / Django Storages / Django Filter 등 (Django 5.x 기준)

> 이 문서는 **프로덕션에서 자주 쓰는 Django 서드파티 패키지**들을 한 곳에 정리합니다.  
> 각 섹션은 **설치 → 설정 → 최소 예제 → 실무 팁/함정 → 테스트 포인트** 순서로 구성했습니다.  

---

## 0. 공통 준비물

### 0.1 의존성 관리(예: `requirements.txt`)
```txt
Django>=5.0
djangorestframework>=3.15
djangorestframework-simplejwt>=5.3
django-filter>=24.2
dj-rest-auth>=6.0
django-allauth>=0.61
django-storages>=1.14
boto3>=1.34
django-redis>=5.4
drf-spectacular>=0.27
drf-spectacular-sidecar>=2024.7.1
django-cors-headers>=4.4
django-environ>=0.11
anymail[amazon_ses,sendgrid,mailgun]>=10.3
django-debug-toolbar>=4.4
django-extensions>=3.2
whitenoise>=6.6
```

### 0.2 기본 설정(`settings.py`) 일부
```python
from pathlib import Path
import environ
BASE_DIR = Path(__file__).resolve().parent.parent
env = environ.Env(DEBUG=(bool, True))
environ.Env.read_env(BASE_DIR / ".env")

DEBUG = env("DEBUG")
SECRET_KEY = env("SECRET_KEY", default="dev-secret")
ALLOWED_HOSTS = env.list("ALLOWED_HOSTS", default=["*"])

INSTALLED_APPS = [
    "django.contrib.admin", "django.contrib.auth", "django.contrib.contenttypes",
    "django.contrib.sessions", "django.contrib.messages", "django.contrib.staticfiles",
    # third-party는 각 섹션에 추가
]
```

---

# 1. Django REST Framework (DRF)

### 1.1 설치
```bash
pip install djangorestframework django-filter
```

### 1.2 설정
```python
INSTALLED_APPS += ["rest_framework", "django_filters"]

REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": (
        "rest_framework.authentication.SessionAuthentication",  # 브라우저 테스트용
    ),
    "DEFAULT_PERMISSION_CLASSES": ("rest_framework.permissions.IsAuthenticatedOrReadOnly",),
    "DEFAULT_FILTER_BACKENDS": (
        "django_filters.rest_framework.DjangoFilterBackend",
        "rest_framework.filters.SearchFilter",
        "rest_framework.filters.OrderingFilter",
    ),
    "DEFAULT_PAGINATION_CLASS": "rest_framework.pagination.PageNumberPagination",
    "PAGE_SIZE": 20,
}
```

### 1.3 최소 예제

**모델**
```python
# apps/blog/models.py
from django.db import models
class Article(models.Model):
    title = models.CharField(max_length=140)
    body = models.TextField()
    is_public = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
```

**시리얼라이저**
```python
# apps/blog/serializers.py
from rest_framework import serializers
from .models import Article

class ArticleSerializer(serializers.ModelSerializer):
    class Meta:
        model = Article
        fields = ["id","title","body","is_public","created_at"]
        read_only_fields = ["id","created_at"]
```

**뷰셋/필터**
```python
# apps/blog/views.py
from rest_framework import viewsets, filters
from django_filters import rest_framework as df
from .models import Article
from .serializers import ArticleSerializer

class ArticleFilter(df.FilterSet):
    pub = df.BooleanFilter(field_name="is_public")
    class Meta:
        model = Article
        fields = ["pub"]

class ArticleViewSet(viewsets.ModelViewSet):
    queryset = Article.objects.all().order_by("-created_at")
    serializer_class = ArticleSerializer
    filterset_class = ArticleFilter
    filter_backends = [df.DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]
    search_fields = ["title", "body"]
    ordering_fields = ["created_at","title"]
```

**라우터**
```python
# config/urls.py
from rest_framework import routers
from apps.blog.views import ArticleViewSet

router = routers.DefaultRouter()
router.register(r"articles", ArticleViewSet, basename="article")

urlpatterns = [
    # ...
    path("api/", include(router.urls)),
]
```

### 1.4 실무 팁/함정
- **N+1 방지**: `select_related/prefetch_related` 를 `get_queryset()` 에서 적용.
- **부분 업데이트**: `PATCH` 사용 시 `partial=True` 를 시리얼라이저에 전달.
- **밸리데이션**: `validate_<field>()` + `validate()` 에서 도메인 규칙 강제.
- **대용량 응답**: 페이지네이션 강제, CSV/엑셀 등은 비동기 생성 후 서명 URL 제공.

### 1.5 테스트 포인트
```python
# tests/test_articles.py
import pytest
from rest_framework.test import APIClient
from django.urls import reverse

pytestmark = pytest.mark.django_db

def test_article_list():
    c = APIClient()
    res = c.get("/api/articles/?search=hello&ordering=-created_at")
    assert res.status_code == 200
```

---

# 2. JWT 인증 — djangorestframework-simplejwt

### 2.1 설치
```bash
pip install djangorestframework-simplejwt
```

### 2.2 설정
```python
INSTALLED_APPS += ["rest_framework"]
REST_FRAMEWORK["DEFAULT_AUTHENTICATION_CLASSES"] = (
    "rest_framework_simplejwt.authentication.JWTAuthentication",
)

from datetime import timedelta
SIMPLE_JWT = {
    "ACCESS_TOKEN_LIFETIME": timedelta(minutes=15),
    "REFRESH_TOKEN_LIFETIME": timedelta(days=7),
    "ROTATE_REFRESH_TOKENS": True,
    "BLACKLIST_AFTER_ROTATION": True,
    "ALGORITHM": "HS256",
}
```

### 2.3 URL
```python
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView
urlpatterns += [
    path("api/token/", TokenObtainPairView.as_view(), name="token_obtain_pair"),
    path("api/token/refresh/", TokenRefreshView.as_view(), name="token_refresh"),
]
```

### 2.4 커스텀 클레임
```python
# core/jwt.py
from rest_framework_simplejwt.serializers import TokenObtainPairSerializer
class MyTokenSerializer(TokenObtainPairSerializer):
    @classmethod
    def get_token(cls, user):
        t = super().get_token(user)
        t["username"] = user.username
        t["is_staff"] = user.is_staff
        return t
```
```python
# core/views.py
from rest_framework_simplejwt.views import TokenObtainPairView
from .jwt import MyTokenSerializer
class MyTokenView(TokenObtainPairView):
    serializer_class = MyTokenSerializer
```
```python
# urls
urlpatterns += [ path("api/token/", MyTokenView.as_view(), name="token"), ]
```

### 2.5 팁/함정
- 토큰 저장 위치는 **브라우저 메모리/앱 보안 스토리지** 권장(쿠키 저장 시 CSRF 고려).
- 리프레시 회전 사용 시 **블랙리스트 앱**(simplejwt 옵션) 추가 가능.
- 모바일/SPA: 401 발생 시 자동 **토큰 갱신→재시도** 흐름 구현.

---

# 3. drf-spectacular — OpenAPI 문서(Swagger/Redoc)

### 3.1 설치/설정
```bash
pip install drf-spectacular drf-spectacular-sidecar
```
```python
INSTALLED_APPS += ["drf_spectacular", "drf_spectacular_sidecar"]
REST_FRAMEWORK["DEFAULT_SCHEMA_CLASS"] = "drf_spectacular.openapi.AutoSchema"
SPECTACULAR_SETTINGS = {
  "TITLE": "API",
  "DESCRIPTION": "내 서비스 API",
  "VERSION": "1.0.0",
  "SERVERS": [{"url":"https://api.example.com"}],
}
```

### 3.2 URL
```python
from drf_spectacular.views import SpectacularAPIView, SpectacularSwaggerView, SpectacularRedocView
urlpatterns += [
  path("api/schema/", SpectacularAPIView.as_view(), name="schema"),
  path("api/docs/", SpectacularSwaggerView.as_view(url_name="schema"), name="swagger-ui"),
  path("api/redoc/", SpectacularRedocView.as_view(url_name="schema"), name="redoc"),
]
```

### 3.3 스키마 커스터마이즈
```python
from drf_spectacular.utils import extend_schema, OpenApiExample
@extend_schema(
  summary="게시글 생성",
  examples=[OpenApiExample("예시", value={"title":"hi","body":"..."})]
)
class ArticleViewSet(...):
    ...
```

---

# 4. django-allauth (+ dj-rest-auth) — 회원/소셜 로그인

### 4.1 설치
```bash
pip install django-allauth dj-rest-auth
```

### 4.2 설정
```python
INSTALLED_APPS += [
  "django.contrib.sites",
  "allauth", "allauth.account", "allauth.socialaccount",  # 소셜은 provider 추가
  "dj_rest_auth", "dj_rest_auth.registration",
]
SITE_ID = 1
ACCOUNT_EMAIL_VERIFICATION = "optional"  # 또는 "mandatory"
ACCOUNT_AUTHENTICATION_METHOD = "username_email"
ACCOUNT_EMAIL_REQUIRED = True
```

### 4.3 URL
```python
urlpatterns += [
  path("api/auth/", include("dj_rest_auth.urls")),                    # 로그인/로그아웃/비번변경 등
  path("api/auth/registration/", include("dj_rest_auth.registration.urls")),  # 회원가입
]
```

### 4.4 JWT와 통합(선택)
```python
INSTALLED_APPS += ["rest_framework_simplejwt"]
REST_FRAMEWORK["DEFAULT_AUTHENTICATION_CLASSES"] = (
    "rest_framework_simplejwt.authentication.JWTAuthentication",
)
# dj-rest-auth가 simplejwt 토큰 발급하도록 설정
REST_USE_JWT = True
SIMPLE_JWT["AUTH_HEADER_TYPES"] = ("Bearer",)
```

### 4.5 소셜 로그인(provider 예시: Google)
```python
INSTALLED_APPS += ["allauth.socialaccount.providers.google"]
# callback URL은 /accounts/google/login/callback/
```

### 4.6 팁/함정
- 이메일 검증이 필수인 서비스는 `ACCOUNT_EMAIL_VERIFICATION="mandatory"` 와 `anymail` 로 발송 연동.
- 소셜 계정 매핑: `SocialAccountAdapter` 커스터마이즈로 도메인 정책 통제.

---

# 5. django-storages (S3/Cloud Storage 업로드)

### 5.1 설치
```bash
pip install django-storages boto3
```

### 5.2 설정(S3 예시)
```python
INSTALLED_APPS += ["storages"]
# 기본 스토리지를 S3로
DEFAULT_FILE_STORAGE = "storages.backends.s3boto3.S3Boto3Storage"
AWS_STORAGE_BUCKET_NAME = env("AWS_STORAGE_BUCKET_NAME")
AWS_S3_REGION_NAME = env("AWS_S3_REGION_NAME", default=None)
AWS_S3_ENDPOINT_URL = env("AWS_S3_ENDPOINT_URL", default=None)  # MinIO 등 대체 엔드포인트
AWS_QUERYSTRING_AUTH = False   # public 읽기 시 True면 서명쿼리 붙음
AWS_S3_OBJECT_PARAMETERS = {"CacheControl": "max-age=86400"}
```

### 5.3 예제 모델/업로드
```python
# apps/files/models.py
from django.db import models
class Upload(models.Model):
    file = models.FileField(upload_to="uploads/%Y/%m/")
    created_at = models.DateTimeField(auto_now_add=True)
```

### 5.4 서명 URL(대용량 직업로드; 서버 부하 줄이기)
- **직접 업로드**: 프론트가 S3에 업로드(Pre-signed URL), 서버에는 메타만 저장.
- 구현은 Boto3의 `generate_presigned_post` 또는 `generate_presigned_url` 사용.

```python
# apps/files/views.py (요약)
import boto3, os
from django.http import JsonResponse
def presign(request):
    s3 = boto3.client("s3", region_name=os.getenv("AWS_S3_REGION_NAME"))
    bucket = os.getenv("AWS_STORAGE_BUCKET_NAME")
    key = f"uploads/{request.user.id}/raw/{request.GET['filename']}"
    url = s3.generate_presigned_post(bucket, key, ExpiresIn=300)
    return JsonResponse(url)
```

### 5.5 팁/함정
- 업로드 **보안**: MIME/확장자 검증 + **바이러스 스캔**(clamav/clamd) + **이미지 변환**은 별도 작업 큐에서.
- CloudFront/ CDN 사용 시 **서명쿠키/URL** 전략으로 사설 오브젝트 보호 가능.

---

# 6. django-filter — 필터 DSL

### 6.1 설치/설정
- 이미 DRF 섹션에서 설치/등록.

### 6.2 예제
```python
import django_filters as df
from .models import Order

class OrderFilter(df.FilterSet):
    min_total = df.NumberFilter(field_name="total", lookup_expr="gte")
    max_total = df.NumberFilter(field_name="total", lookup_expr="lte")
    created_after = df.IsoDateTimeFilter(field_name="created_at", lookup_expr="gte")
    class Meta:
        model = Order
        fields = ["status","min_total","max_total","created_after"]
```

뷰셋에 `filterset_class = OrderFilter` 추가.

### 6.3 팁
- **날짜/시간대**: `IsoDateTimeFilter` 사용 시 클라이언트의 timezone 처리 주의.
- 복잡한 조건은 `method` 필터로 커스텀.

---

# 7. django-redis — 캐시/세션 백엔드

### 7.1 설치/설정
```bash
pip install django-redis
```
```python
CACHES = {
  "default": {
    "BACKEND": "django_redis.cache.RedisCache",
    "LOCATION": env("REDIS_URL", default="redis://127.0.0.1:6379/1"),
    "OPTIONS": {"CLIENT_CLASS": "django_redis.client.DefaultClient"},
    "TIMEOUT": 60,  # 기본 TTL
  }
}
# 세션도 Redis로
SESSION_ENGINE = "django.contrib.sessions.backends.cache"
SESSION_CACHE_ALIAS = "default"
```

### 7.2 Low-level 캐시 예제
```python
from django.core.cache import cache
def get_hot_articles():
    key = "hot:articles:v1"
    data = cache.get(key)
    if data is None:
        data = list(Article.objects.order_by("-created_at")[:10].values("id","title"))
        cache.set(key, data, 30)
    return data
```

### 7.3 팁
- 키 전략: prefix + 버전 + 파라미터 해시. 쓰기 후 **정밀 무효화** 또는 TTL로 수명 제한.
- Redis 장애 시 graceful degrade: `IGNORE_EXCEPTIONS=True` 옵션(캐시 실패해도 요청 통과).

---

# 8. django-cors-headers — CORS

### 8.1 설치/설정
```bash
pip install django-cors-headers
```
```python
INSTALLED_APPS += ["corsheaders"]
MIDDLEWARE.insert(1, "corsheaders.middleware.CorsMiddleware")  # CommonMiddleware 앞
CORS_ALLOWED_ORIGINS = env.list("CORS_ALLOWED_ORIGINS", default=["http://localhost:5173"])
CORS_ALLOW_CREDENTIALS = True  # 쿠키/인증 헤더 필요할 때
```

### 8.2 팁
- 와일드카드 보다는 **정확한 오리진 화이트리스트** 권장.
- Preflight 캐시: `Access-Control-Max-Age` 를 Nginx 등에서 설정.

---

# 9. anymail — 트랜잭션 이메일(SendGrid/Mailgun/SES)

### 9.1 설치/설정
```bash
pip install anymail[sendgrid]  # provider에 맞춰 선택
```
```python
INSTALLED_APPS += ["anymail"]
EMAIL_BACKEND = "anymail.backends.sendgrid.EmailBackend"
ANYMAIL = {"SENDGRID_API_KEY": env("SENDGRID_API_KEY")}
DEFAULT_FROM_EMAIL = "noreply@example.com"
```

### 9.2 보내기
```python
from django.core.mail import send_mail
send_mail(
  subject="Welcome",
  message="Hello!",
  from_email=None,  # DEFAULT_FROM_EMAIL 사용
  recipient_list=["user@example.com"],
)
```

### 9.3 웹훅(배달/반송 이벤트)
- anymail은 /anymail/ 경로에 웹훅 뷰 제공(설정 필요).
- 반송/스팸 신고 시 계정 상태 변경 로직을 연결하면 품질 관리 가능.

---

# 10. django-debug-toolbar — 개발 디버깅

### 10.1 설치/설정
```bash
pip install django-debug-toolbar
```
```python
if DEBUG:
    INSTALLED_APPS += ["debug_toolbar"]
    MIDDLEWARE.insert(0, "debug_toolbar.middleware.DebugToolbarMiddleware")
    INTERNAL_IPS = ["127.0.0.1"]
    urlpatterns = [path("__debug__/", include("debug_toolbar.urls"))] + urlpatterns
```

### 10.2 팁
- **절대 운영에 켜지지 않도록** 환경 분기 필수.
- SQL 패널로 N+1 문제 빠르게 확인.

---

# 11. django-extensions — 쉘 플러스/잡/ERD

### 11.1 설치/설정
```bash
pip install django-extensions
```
```python
INSTALLED_APPS += ["django_extensions"]
```

### 11.2 유용 명령
```bash
python manage.py shell_plus
python manage.py show_urls
python manage.py graph_models -a -o erd.png
```

---

# 12. whitenoise — 정적 파일 서빙(간단 배포)

### 12.1 설치/설정
```bash
pip install whitenoise
```
```python
MIDDLEWARE.insert(1, "whitenoise.middleware.WhiteNoiseMiddleware")
STATIC_URL = "static/"
STATIC_ROOT = BASE_DIR / "staticfiles"
STATICFILES_STORAGE = "whitenoise.storage.CompressedManifestStaticFilesStorage"
```

> 고트래픽/대용량 정적은 **CDN(Nginx/CloudFront)** 권장. 소규모 서비스/관리형 PaaS에는 편리.

---

# 13. dj-rest-auth — DRF 인증 뷰 세트(JWT 통합)

### 13.1 설치/설정
- 4장(allauth)에서 함께 설치. `REST_USE_JWT=True` 로 JWT 발급.
- 기본 제공 엔드포인트: 로그인, 리프레시, 비밀번호 변경/재설정, 소셜 로그인(추가 설정).

### 13.2 커스터마이즈
- 시리얼라이저 오버라이드: `REST_AUTH_SERIALIZERS` 로 사용자 정보 확장.

```python
REST_AUTH_SERIALIZERS = {
  "USER_DETAILS_SERIALIZER": "users.serializers.MeSerializer",
}
```
