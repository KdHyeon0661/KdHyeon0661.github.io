---
layout: post
title: AWS - AWS 계정 생성과 기본 설정
date: 2025-07-12 18:20:23 +0900
category: AWS
---
# AWS 계정 생성과 기본 설정

## AWS 계정 생성

### 공식 사이트 접속 및 가입

- https://aws.amazon.com/ 접속 → **Create an AWS Account**.
- 이메일·비밀번호·계정 이름 입력.
- 결제 수단(신용/체크카드) 등록: 소액 승인 후 취소.
- 전화/문자 인증으로 본인 확인.
- 개인/비즈니스 유형 선택(기능 차이는 없음).

### 첫 로그인(루트 계정) 후 즉시 할 일

- **루트 MFA 활성화**
- **루트 접근 키 생성 금지(이미 있다면 삭제)**
- **Alternate Contacts**(Billing/Operations/Security) 등록
- **Account Alias** 설정(회사/개인 규칙에 맞는 별칭)

> 체크리스트
- [x] 루트 계정으로만 할 수 있는 작업에 대비해 **MFA 백업 코드** 안전 보관
- [x] 콘솔 우상단 **My Account** → **Alternate Contacts** 기입
- [x] **Close Account** 메뉴 위치 숙지(오용 방지 차원에서 권한 분리)

---

## 보안 설정 (IAM 사용자/역할/SSO, MFA, 암호정책)

루트 계정은 **비상용**이다. 일상 작업은 **IAM Identity Center(SSO)** 또는 **IAM 사용자/역할**을 사용한다.

### 빠른 길: IAM 사용자(초기 학습/개인 계정)

1. 콘솔 검색창 `IAM` → **Users** → **Add users**
2. 사용자명: `admin` (실전은 이름.성 규칙 권장)
3. **Console access** + **Programmatic access** 선택(학습용)
4. 권한: **AdministratorAccess**(학습 전용) → 실전은 최소권한
5. 임시 비밀번호 발급 → 첫 로그인 시 변경

#### MFA 적용(가상 MFA)

- IAM → Users → 대상 사용자 → **Security credentials** → **Assign MFA device**
- **Google Authenticator/Authy** 등으로 QR 스캔 → 코드 2개 입력

#### 암호 정책(전사 규칙)

- IAM → **Account settings** → **Password policy**
  - 최소 길이, 복잡도, 만료 주기, 재사용 금지 개수 등 설정

```text
권장안(학습/개인): 길이≥12, 대/소문자+숫자+특수, 만료 90일, 최근 5개 재사용 금지
```

### 더 좋은 길: IAM Identity Center(SSO) 도입(팀/다계정 권장)

- 장점: **중앙 IdP**와 연동(Okta/Azure AD), **권한 세트**로 계정/역할 배치, **Access Portal** 제공
- 시작: 콘솔 → **IAM Identity Center** → **Enable** → Permission sets 설계 → 사용자/그룹 할당

---

## CLI 준비와 프로파일

CLI는 자동화·IaC의 기본이다. **프로파일**로 계정/권한을 분리 관리한다.

```bash
# AWS CLI 구성

aws configure --profile blog-admin
# AWS Access Key ID: AKIA...
# AWS Secret Access Key: ...
# Default region name: ap-northeast-2
# Default output format: json

# 환경 변수로 사용

export AWS_PROFILE=blog-admin
export AWS_REGION=ap-northeast-2

# 현재 계정/Caller 확인

aws sts get-caller-identity
```

> 실전 팁
- 장기 키 대신 **SSO 기반 자격**(aws configure sso) 사용 고려
- 로컬 키 관리는 **aws-vault** 같은 보조 도구로 보안성 향상

---

## 기본 리전 설정과 리전 관리

- 콘솔 우상단 리전 선택: **Asia Pacific (Seoul) [ap-northeast-2]**
- **Opt-in Region**(도쿄/싱가포르 등) 사용 시 계정 단위로 활성화 필요
- 실수 방지: 콘솔 북마크에 `?region=ap-northeast-2` 포함, CLI도 `--region` 고정

---

## 네트워크 첫 걸음 (VPC, 보안그룹, 키페어)

### 보안그룹 최소 개방 규칙

- **SSH(22)**: 내 IP만 허용
- **HTTP(80)/HTTPS(443)**: 필요 시 0.0.0.0/0 허용(웹서버만)
- 원치 않는 **Outbound All**은 서비스 정책에 맞게 축소 고려

```bash
# 예시: 내 IP만 SSH 허용하는 SG 만들기

MYIP=$(curl -s https://checkip.amazonaws.com)/32
aws ec2 create-security-group \
  --group-name web-sg \
  --description "web sg" \
  --vpc-id vpc-xxxxxxxx

aws ec2 authorize-security-group-ingress \
  --group-id sg-xxxxxxxx \
  --ip-permissions IpProtocol=tcp,FromPort=22,ToPort=22,IpRanges="[{\"CidrIp\":\"$MYIP\"}]"

aws ec2 authorize-security-group-ingress \
  --group-id sg-xxxxxxxx \
  --protocol tcp --port 80 --cidr 0.0.0.0/0

aws ec2 authorize-security-group-ingress \
  --group-id sg-xxxxxxxx \
  --protocol tcp --port 443 --cidr 0.0.0.0/0
```

### 키페어 생성

```bash
aws ec2 create-key-pair --key-name blog-key --query 'KeyMaterial' --output text > blog-key.pem
chmod 400 blog-key.pem
```

---

## S3 기본 버킷 생성(암호화/버전관리/퍼블릭 차단)

### 콘솔 절차 요약

1. S3 → **Create bucket**
2. 이름(전역 유일): `my-aws-storage-<랜덤>`
3. **Block all public access** 체크(권장)
4. **Bucket versioning** 켜기(롤백/삭제복구 대비)
5. **Default encryption**: SSE-S3 또는 KMS

### CLI 예시

```bash
aws s3api create-bucket \
  --bucket my-aws-storage-12345 \
  --create-bucket-configuration LocationConstraint=ap-northeast-2

# 버전관리/기본 암호화(KMS) 활성화

aws s3api put-bucket-versioning \
  --bucket my-aws-storage-12345 \
  --versioning-configuration Status=Enabled

aws s3api put-bucket-encryption \
  --bucket my-aws-storage-12345 \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "aws:kms",
        "KMSMasterKeyID": "alias/my-blog-key"
      }
    }]
  }'
```

---

## KMS 고객 관리형 키(CMK) 만들기

```bash
aws kms create-key --description "blog cmk" \
  --key-usage ENCRYPT_DECRYPT \
  --origin AWS_KMS

# 별칭 만들기

aws kms create-alias \
  --alias-name alias/my-blog-key \
  --target-key-id <KeyId>
```

> 팁: 키 정책에 **관리자만** 키 관리/사용 부여. S3/CloudTrail/Logs 등 서비스별로 필요한 범위만 열어준다.

---

## CloudTrail/Config/GuardDuty/Security Hub 즉시 활성화

**감사/보호는 만든 날부터 켠다.** 사고 후 켜면 로그가 없다.

### CloudTrail(관리 이벤트 로깅)

- 조직/단일 계정 선택
- S3 버킷 지정(전용 **log-archive** 버킷 권장)
- **Multi-Region** Trails 권장, **Data Events**(S3/DynamoDB) 선택적으로 추가

```bash
aws cloudtrail create-trail \
  --name org-trail \
  --s3-bucket-name my-cloudtrail-logs-123 \
  --is-multi-region-trail

aws cloudtrail start-logging --name org-trail
```

### AWS Config(자원 설정 추적)

- 리소스 구성 변경 이력·규정 준수 평가
```bash
aws configservice put-configuration-recorder \
  --configuration-recorder name=default,roleARN=arn:aws:iam::<acct>:role/AWSServiceRoleForConfig

aws configservice put-delivery-channel \
  --delivery-channel name=default,s3BucketName=my-config-logs-123

aws configservice start-configuration-recorder --configuration-recorder-name default
```

### GuardDuty(위협 탐지) · Security Hub(보안 기준 통합)

- 한 번 클릭으로 리전별 활성화. Organizations로 멀티계정 집계 권장.

---

## 비용 관리: 예산/알림/Cost Explorer/태깅

### 비용 예산(Budgets) 알림(이메일)

- 콘솔: **Billing → Budgets → Create** → 월 예산/알림 임계치 설정
- CLI(JSON) 예시(간략):

```json
{
  "Budget": {
    "BudgetName": "monthly-budget",
    "BudgetLimit": { "Amount": "10", "Unit": "USD" },
    "TimeUnit": "MONTHLY",
    "BudgetType": "COST"
  },
  "NotificationsWithSubscribers": [
    {
      "Notification": {
        "NotificationType": "FORECASTED",
        "ComparisonOperator": "GREATER_THAN",
        "Threshold": 80.0,
        "ThresholdType": "PERCENTAGE"
      },
      "Subscribers": [{ "SubscriptionType": "EMAIL", "Address": "me@example.com" }]
    }
  ]
}
```

> 비용 알림 기본 원리:
$$
\text{알림 발생} =
\begin{cases}
\text{실제 비용} > \text{임계값}, & \text{ACTUAL}\\
\text{예측 비용} > \text{임계값}, & \text{FORECASTED}
\end{cases}
$$

### Cost Explorer로 서비스/리전/태그별 분석

- 태깅 표준 예: `Project`, `Env`, `Owner`, `CostCenter`

---

## 무료 요금제 주의사항(확장)

| 서비스 | 무료 범위(대표) | 기간 |
|---|---|---|
| EC2 | t2.micro/t3.micro 합 750시간/월 | 12개월 |
| S3 | 5GB | 12개월 |
| Lambda | 100만 요청 + 400,000 GB-초 | 항상 무료 |
| CloudWatch | 기본 지표/로그 일부 | 12개월 |

> 반드시 **Billing → Free Tier → Usage** 모니터링.
> 리전 분산 시 무료 시간이 **합산**이므로, 여러 리전에 나눠 띄우면 초과 위험.

---

## 실전 예제 1: 첫 EC2(무료 티어) + 보안그룹 + SSH

```bash
# (1) 키페어/보안그룹은 앞에서 생성했다고 가정
# (2) AMI 조회(예: Amazon Linux 2023)

aws ec2 describe-images \
  --owners amazon \
  --filters "Name=name,Values=al2023-ami-*" "Name=architecture,Values=x86_64" \
  --query "reverse(sort_by(Images, &CreationDate))[:1].ImageId" --output text

# (3) 인스턴스 실행

aws ec2 run-instances \
  --image-id ami-xxxxxxxx \
  --instance-type t3.micro \
  --key-name blog-key \
  --security-group-ids sg-xxxxxxxx \
  --subnet-id subnet-xxxxxxxx \
  --count 1 \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=blog-ec2}]'

# (4) 공인 IP 확인 후 SSH

ssh -i blog-key.pem ec2-user@<PublicIP>
```

> 보안: SSH는 반드시 **내 IP만** 허용. 운영 환경은 **Session Manager(SSM)** 로 SSH 없이 접속 권장.

---

## 실전 예제 2: 정적 웹 호스팅(S3 + CloudFront + OAC)

### S3에 사이트 올리기

```bash
aws s3 sync ./site s3://my-aws-storage-12345 --delete
```

### OAC로 프라이빗 버킷 + CloudFront만 접근

- CloudFront 배포 생성(OAC 연결)
- 버킷 정책: **CloudFront OAC 프린시플**만 허용

버킷 정책 스니펫(예시):
```json
{
  "Version":"2012-10-17",
  "Statement":[
    {
      "Sid":"AllowCloudFrontOAC",
      "Effect":"Allow",
      "Principal":{"Service":"cloudfront.amazonaws.com"},
      "Action":["s3:GetObject"],
      "Resource":"arn:aws:s3:::my-aws-storage-12345/*",
      "Condition":{
        "StringEquals":{"AWS:SourceArn":"arn:aws:cloudfront::<acct>:distribution/E123ABC456"}
      }
    }
  ]
}
```

---

## 실전 예제 3: S3 + KMS 암호화, 버전 복구

```bash
# 파일 업로드(버전 생성)

aws s3 cp index.html s3://my-aws-storage-12345/

# 실수로 덮어씀 → 이전 버전 복구

aws s3api list-object-versions --bucket my-aws-storage-12345 --prefix index.html
# 원하는 VersionId로 복사해서 되돌리기

aws s3api copy-object \
  --bucket my-aws-storage-12345 \
  --copy-source my-aws-storage-12345/index.html?versionId=<OldVersionId> \
  --key index.html
```

---

## IaC(선택): CloudFormation/Terraform/CDK 스켈레톤

### CloudFormation: S3 버킷(버전/암호화)

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  SiteBucket:
    Type: AWS::S3::Bucket
    Properties:
      VersioningConfiguration: { Status: Enabled }
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
Outputs:
  BucketName:
    Value: !Ref SiteBucket
```

### Terraform: 보안그룹(SSH 제한)

```hcl
resource "aws_security_group" "web" {
  name   = "web-sg"
  vpc_id = var.vpc_id

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = [var.my_ip_cidr] # 예: "203.0.113.10/32"
  }

  ingress { from_port=80 to_port=80 protocol="tcp" cidr_blocks=["0.0.0.0/0"] }
  ingress { from_port=443 to_port=443 protocol="tcp" cidr_blocks=["0.0.0.0/0"] }

  egress  { from_port=0 to_port=0 protocol="-1" cidr_blocks=["0.0.0.0/0"] }
}
```

### CDK(TypeScript): KMS + S3

```ts
import * as cdk from 'aws-cdk-lib';
import * as kms from 'aws-cdk-lib/aws-kms';
import * as s3 from 'aws-cdk-lib/aws-s3';

export class StorageStack extends cdk.Stack {
  constructor(scope: cdk.App, id: string, props?: cdk.StackProps) {
    super(scope, id, props);
    const key = new kms.Key(this, 'BlogKey', {
      enableKeyRotation: true,
      alias: 'alias/my-blog-key',
    });
    new s3.Bucket(this, 'SecureBucket', {
      encryption: s3.BucketEncryption.KMS,
      encryptionKey: key,
      versioned: true,
      blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
    });
  }
}
```

---

## 초기 운영 체크리스트 (확장)

- 계정/보안
  - [x] 루트 MFA / 루트 접근키 없음
  - [x] IAM 사용자 또는 SSO 도입, MFA 필수
  - [x] 암호정책 적용, 액세스 키 로테이션 기준 수립
- 거버넌스
  - [x] 태깅 표준 수립(Project/Env/Owner/CostCenter)
  - [x] 예산/비용 알림 활성화
- 감사/보호
  - [x] CloudTrail(멀티리전), Config, GuardDuty, Security Hub 활성화
- 네트워크/리전
  - [x] 기본 리전 고정, 불필요 리전 리소스 미생성
  - [x] SG 최소 개방, NACL 기본 거부 원칙 검토
- 데이터
  - [x] S3 버전관리/암호화 기본값, KMS 키 회전
  - [x] 백업 주기·보존 정책(예: RDS 자동 백업+스냅샷)
- 관측성
  - [x] CloudWatch 대시보드/알람(EC2 CPU, 상태체크)
  - [x] Logs 보존기간 설정(예: 30~90일)
- 무료 티어
  - [x] 리전 분산 사용 피함(누적 750시간 주의)
  - [x] 매월 1회 이상 비용 확인/리소스 정리

---

## 자주 하는 실수와 해결

- **S3 403**: 버킷 퍼블릭 차단 + CloudFront OAC 미구성 → **OAC 연결 + 버킷 정책 갱신**
- **EC2 SSH 불가**: SG에서 22 포트/내 IP 미허용 → **SG 규칙 수정**
- **비용 급증**: CloudWatch Logs 무기한 보존/미사용 EIP/EBS 방치 → **보존기간/정리 자동화**
- **리전 착오**: 도쿄/서울 혼용 생성 → **리전 고정/태그로 리전 노출**
- **루트 상시 사용**: 사고 위험 증가 → **루트 금지, SSO/IAM만 사용**

---

## 마무리

이 문서는 **계정 생성→보안 강화→비용/운영 가드레일→첫 실습(S3/EC2/KMS/CloudFront)** 까지 **초기 세팅 전 과정을 실전 수준으로 정리**했다.
다음 단계로는 **Landing Zone(다계정) 설계**, **IaC로 표준 아키텍처 템플릿화**, **WAF/Shield·CICD** 등 운영 자동화를 확장하자.

---

## 부록 A) 콘솔 중심 절차(요약)

1. 루트 로그인 → **MFA** → **Alternate Contacts** → **Account Alias**
2. IAM → **Users**/**Identity Center** → 사용자/권한/MFA 설정
3. Billing → **Cost Explorer/Free Tier/Alerts** → 예산 알림
4. CloudTrail/Config/GuardDuty/Security Hub → **모두 활성화**
5. S3 → 버킷 생성(버전·암호화·퍼블릭 차단)
6. EC2 → 키페어/보안그룹 → 인스턴스 시작(필요 시)
7. CloudFront(OAC) → 정적 사이트 퍼블릭 없이 배포

---

## 부록 B) 빠른 명령 모음

```bash
# 프로파일/리전

export AWS_PROFILE=blog-admin
export AWS_REGION=ap-northeast-2

# S3 업로드/동기화

aws s3 sync ./public s3://my-aws-storage-12345 --delete

# 비용 조회(월간)

aws ce get-cost-and-usage \
  --time-period Start=2025-11-01,End=2025-12-01 \
  --granularity MONTHLY \
  --metrics "UnblendedCost"

# CloudFront 캐시 무효화

aws cloudfront create-invalidation \
  --distribution-id E123ABC456 \
  --paths "/*"
```
