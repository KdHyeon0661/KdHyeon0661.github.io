---
layout: post
title: 정보통신기사 - 서버, 스토리지, 백업·DR
date: 2025-08-22 19:25:23 +0900
category: 정보통신기사
---
# 서버/스토리지/백업·DR 기초 총정리 (tx-server-storage-backup-dr)

## 큰 그림 한 장

- **서버**: CPU/메모리/스토리지/네트워크로 구성. 물리(베어메탈) ↔ 가상화(하이퍼바이저) ↔ 컨테이너(오케스트레이션).
- **스토리지**: **DAS(직결)**, **NAS(파일)**, **SAN(블록)**, **오브젝트(S3 계열)**.
- **성능 지표**: **IOPS**, **지연(latency)**, **처리량(throughput)**, **큐 깊이(QD)**.
- **데이터 보호**: **RAID(가용성)** ≠ **백업(과거 시점 복구)**. **스냅샷**은 **즉시 복구**에 유용하나 **백업 대체 아님**.
- **DR 핵심**: **RPO(데이터 허용 손실)**, **RTO(복구 완료 목표시간)**.
- **원칙**: **3-2-1-1-0**(3사본·2매체·1오프사이트·1불변/에어갭·0검증에러).

---

## 서버 아키텍처 기초

### 폼팩터/구성

- **랙서버**(1U/2U), **블레이드**, **타워**.
- **CPU**: 코어·스레드·클럭·캐시·소켓 수·**NUMA**.
- **메모리**: 용량/대역폭/채널, **ECC** 필수.
- **스토리지 베이**: SATA/SAS/NVMe, HBA/RAID 카드.
- **NIC**: 1/10/25/40/100G, SR-IOV/DPDK 고려.

### 가상화/컨테이너

- **하이퍼바이저**: VMware ESXi, KVM(QEMU/libvirt), Hyper-V.
- **컨테이너**: Docker/CRI-O + **Kubernetes**(상태 저장 시 CSI 스토리지).
- **리소스 스케줄링**: CPU 핀닝/NUMA 인식, HugePages, vNUMA.

---

## 스토리지 미시성능: IOPS·지연·처리량

### 정의

- **IOPS**: 초당 I/O 개수(작은 블록 위주).
- **지연 \(L\)**: I/O 하나의 왕복 시간(µs~ms).
- **처리량**: 초당 전송 바이트(대블록 위주).
- **큐 깊이(QD)**: 동시 outstanding I/O 수.

### 근사 관계

\[
\text{Throughput (MB/s)} \approx \frac{\text{IOPS}\times \text{BlockSize (KB)}}{1024}
\]
\[
\text{Little's Law:}\quad \text{IOPS} \approx \frac{\text{Queue Depth}}{\text{Avg Latency (sec)}}
\]

**예)** 지연 0.5ms, QD=32 → IOPS ≈ \(32 / 0.0005 = 64{,}000\).

### 장치별 감

- **HDD 7.2K**: ~80–120 IOPS, 지연 8–12ms.
- **SATA SSD**: ~50k–100k IOPS, 지연 100–300µs.
- **NVMe SSD**: ~300k–1M+ IOPS, 지연 10–100µs.

---

## RAID/캐시/쓰기 패널티

### RAID 개요

- **RAID0**(스트라이핑): 성능↑, 내고장성 없음.
- **RAID1**(미러): 읽기↑, 쓰기≈단일, 1디스크 결함 허용.
- **RAID5/6**(패리티): 공간 효율↑, **쓰기 패널티** 존재(5: x4, 6: x6).
- **RAID10**(미러+스트라이프): 성능/복원력 매우 우수, 공간 50%.

### 쓰기 패널티 공식(랜덤 쓰기)

- RAID5: **4 I/O/쓰기** (read old data + read old parity + write data + write parity)
- RAID6: **6 I/O/쓰기**
- RAID10: **2 I/O/쓰기**(미러에 두 번)

**예)** 랜덤 2000 write IOPS 요구, RAID5 디스크가 200 IOPS라면 필요한 디스크 ≈
\[
N \approx \frac{2000 \times 4}{200} = 40\ \text{(패리티+데이터 합)}
\]

### 캐시 정책

- **Write-back**: 지연↓, 전원보호 필요(BBU/슈퍼캐패시터).
- **Write-through**: 안전↑, 성능↓.
- **Read-ahead**: 순차 읽기 성능↑.

---

## DAS/NAS/SAN/오브젝트

| 유형 | 인터페이스 | 단위 | 장점 | 유스케이스 |
|---|---|---|---|---|
| **DAS** | SATA/SAS/NVMe | 블록 | 단순/저지연 | 단일 서버, DB 로컬 |
| **NAS** | NFS/SMB | 파일 | 공유·권한 | 홈디렉터리, 미디어 |
| **SAN** | iSCSI/FC/FCoE/NVMe-oF | 블록 | 성능/클러스터 | VMFS/클러스터 파일시스템 |
| **오브젝트** | S3/Swift | 오브젝트/버킷 | 확장/불변성 | 백업/아카이브/대용량 정적 |

**SAN 팁**: 멀티패스(MPIO), **FC**(저지연) vs **iSCSI**(LAN/로컬), **DCB/로스리스**(RoCE/FC-oE) 고려.

---

## 파일시스템/볼륨 관리자

### LVM(mdadm) 기본(리눅스)

- **mdadm**: 소프트웨어 RAID.
- **LVM**: PV→VG→LV, **스냅샷/확장**.

```bash
# 소프트 RAID1

mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sdb /dev/sdc
mkfs.xfs /dev/md0
# LVM

pvcreate /dev/md0
vgcreate vgdata /dev/md0
lvcreate -L 500G -n lvapp vgdata
mkfs.xfs /dev/vgdata/lvapp
```

### ZFS/Btrfs(풀형 FS)

- **ZFS**: 풀+RAID-Z, **온더플라이 압축/검증**, **스냅샷/클론/송수신**, **ARC/L2ARC/ZIL**.
- **Btrfs**: 체크섬·스냅샷, 소규모·개발 친화.

```bash
# ZFS 예: RAIDZ2 풀 생성

zpool create tank raidz2 sdb sdc sdd sde
zfs create -o compression=zstd tank/app
zfs snapshot tank/app@daily-2025-09-19
zfs send -i tank/app@daily-2025-09-18 tank/app@daily-2025-09-19 | zfs recv backup/app
```

### 파일시스템 선택 감

- **XFS**: 대용량/병렬/로그 구조, RHEL 기본.
- **EXT4**: 범용·안정, 작은 시스템.
- **NTFS/ReFS**: 윈도/Hyper-V, ReFS 스크럽·블록클론.
- **VMFS/NFS Datastore**: vSphere.

---

## 네트워크 스토리지 튜닝

- **MTU 9000**(점보프레임)로 대블록 처리량↑(단, 경로 전체 일치).
- **iSCSI**: MPIO, 세션 분산, **flow-control** 주의(혼잡 확산).
- **DCB(PFC/ETS)**: 로스리스 요구 워크로드(특히 RoCE)에서만 신중 적용.
- **NFS**: vers=3/4, rsize/wsize, nolock 옵션 검토.

---

## 백업 기본: 유형과 스케줄

### 유형

- **전체(Full)**: 기준점.
- **증분(Incremental)**: 마지막 **백업 이후** 변경분.
- **차등(Differential)**: **마지막 Full 이후** 변경분.
- **합성 Full(Synthetic Full)**: 저장소에서 증분들을 합쳐 **새 Full** 생성(네트워크 부담↓).
- **이미지 vs 파일**: 블록단위 스냅샷/이미지, 파일 단위 선택.

### 스케줄/보존(GFS)

- **GFS(Grandfather-Father-Son)**: 일간(아들)·주간(아버지)·월간(조부).
- **예)** 일일 증분 30일, 주간 합성Full 12주, 월간 Full 12개월.

### 변경률과 용량 모델

- 데이터 총량 \(D\), 일일 변경률 \(c\) (예 3%).
- 30일 증분 용량 근사:
\[
V \approx D \times (F + 30c),\ \ F=\text{Full 비율(1.0 또는 압축/중복제거 반영)}
\]
- 중복제거/압축 비율 \(r\)를 곱하여 저장공간 \(\approx V \times r\).

**예)** \(D=10\ \text{TB}\), \(c=3\%\), **압축/중복제거 50%** →
\(V \approx 10(1 + 0.9)=19\ \text{TB} \Rightarrow 9.5\ \text{TB}\) 실 저장.

---

## 스냅샷·복제 vs 백업

- **스냅샷**: 동일 시스템 내 **시점 고정**(CoW). 매우 빠름·롤백 쉬움. **장치/풀 손상 시 함께 소실** 위험.
- **복제(Replication)**: 동/비동기, 동일/원격 사이트로 **2차 사본** 생성.
- **백업**: **논리적으로 분리**된 매체/시스템에 저장(오프사이트/오브젝트/테이프). **랜섬웨어 대비**는 **불변(Object Lock/WORM)** 필수.

---

## RPO/RTO와 DR 티어

### 정의

\[
\textbf{RPO}:\ \text{허용 가능한 데이터 손실 시간(마지막 백업 시점부터 장애까지)}\\
\textbf{RTO}:\ \text{서비스 복구 완료까지 목표 시간}
\]

### DR 전략 스펙트럼

| 전략 | RPO | RTO | 특징 |
|---|---|---|---|
| **테이프 오프사이트** | 시간~일 | 시간~일 | 비용↓, 느림 |
| **비동기 복제 + Warm** | 분 | 시간 | 현실적 타협 |
| **동기 복제 + Hot** | 0 | 분 | 비용↑, 거리 제약 |
| **액티브-액티브** | ~0 | ~0 | 애플리케이션 레벨, 복잡/고가 |

**동기 복제 주의**: 거리↑ → 왕복 지연↑ → Tx 지연 영향. 보통 수~수십 km 내.

---

## 애플리케이션 일관성

- **VSS(Windows)**, **fsfreeze(Linux)**, DB **퀘스/로그 플러시**로 **애플리케이션 일관** 스냅샷.
- **Crash-consistent**(장애 직후 상태) vs **App-consistent**(트랜잭션 정합).

```powershell
# VSS 예시(개념)

wbadmin start backup -backupTarget:F: -include:C: -allCritical -quiet
```

---

## 데이터베이스 백업·복구

### 일반 원칙

- **Full + WAL/Redo 로그**로 **PITR**(Point-In-Time Recovery).
- **논리 덤프**(mysqldump/pg_dump) vs **물리 스냅샷**(LVM/ZFS/vSphere CBT).

### 예시

- **PostgreSQL**: `basebackup` + WAL 아카이브 → `recovery.conf` 시점복구.
- **MySQL/InnoDB**: Percona XtraBackup(Hot), Binlog로 PITR.

```bash
# LVM 스냅샷 기반 이미지 백업 (서비스 중)

lvcreate -L 100G -s -n snap_app /dev/vgdata/lvapp
mount /dev/vgdata/snap_app /mnt/snap
rsync -aHAX /mnt/snap/ /backup/app/
umount /mnt/snap && lvremove -f /dev/vgdata/snap_app
```

---

## 가상화/컨테이너 백업

- **VMware vSphere**: CBT(Changed Block Tracking), VADP API, 스토리지 스냅샷 오케스트레이션.
- **KVM**: qemu-guest-agent로 FS Freeze/Thaw, 외부 스냅샷.
- **Kubernetes**:
  - **etcd 백업**(클러스터 브레인),
  - **PV 스냅샷(CSI)**,
  - **Velero**(리소스+볼륨 스냅샷/복구),
  - **StatefulSet**는 백업/복구 순서·서비스 중단 창 관리.

---

## 보안: 암호화·키관리·불변·에어갭

- **전송 암호화**: TLS(클라이언트↔저장소), VPN.
- **저장 암호화**: SW/LUKS·FS 수준·어플라이언스(자체 암호화 드라이브).
- **키 관리**: KMS/HSM, **키 로테이션**과 **백업**(키 분실=데이터 영구 소실).
- **불변(Immutability)**: **오브젝트 락/Write-Once**(S3 Object Lock, Tape WORM).
- **에어갭**: 네트워크/전원 물리 분리(테이프/오프라인 리포지터리).
- **랜섬웨어 대비**: **MFA-Delete**, **이상 탐지**(변경률 급증/중복제거율 급락), **격리된 계정**.

---

## 모니터링/테스트/성공 SLO

- **백업 성공률 SLO**: 월 **≥ 99%**, **실복구 테스트 분기 1회 이상**.
- **지표**: 작업 성공/실패, 소요시간, 처리량, 변경률, 중복제거율, 재시도 횟수.
- **복구 연습(게임데이)**: 무작위 샘플을 **복구→무결성 검증(hash/DB 체크)**.

---

## 용량/대역폭/백업창 계산 예제

### 백업 윈도우 대역폭

\[
\text{필요 대역폭(bps)} \approx \frac{\text{백업 데이터(비트)}}{\text{허용 백업창(초)}}
\]

**예)** 10TB Full을 10시간(36,000s)에 끝내려면
\[
\frac{10\times 1024^4\times 8}{36000} \approx 2.27\ \text{Gb/s}
\]
압축 2:1이면 ≈ 1.13 Gb/s.

### 증분 총량(30일, 3%/일, Full 1회)

\[
V \approx 10\text{TB}(1 + 0.9)=19\text{TB}\ (\text{압축/중복제거 전})
\]

### RAID 쓰기 패널티 반영 IOPS

- 요구 쓰기 IOPS 5k, RAID6 → **실 디스크 IOPS** 필요 ≈ \(5k \times 6 = 30k\).

---

## 테이프·오브젝트·클라우드

- **테이프(LTO-8/9)**: TB당 비용↓, **오프사이트/에어갭**에 최적. 로딩/카탈로그 관리 필요.
- **오브젝트 스토리지**: S3 호환, 수명주기 정책(IA/Glacier), **Object Lock**으로 불변.
- **클라우드 DR**: **스냅샷 복제(크로스리전)**, **Warm/Hot Standby**(오토스케일 템플릿+IaC).

---

## 고가용성(HA)와 클러스터

- **게이트웨이/서비스**: VRRP/Keepalived, Windows Failover Cluster.
- **애플리케이션 클러스터**: pacemaker/corosync, **쿼럼/펜싱(STONITH)**으로 스플릿브레인 방지.
- **저장소**: 공유블록(GFS2/OCFS2) 또는 **분산(CEPH/Gluster)**.

---

## 운영 예제 시나리오

### 중소기업(온프레미스)

- **VMware + iSCSI SAN + Veeam/지원툴**
- 일일 증분·주간 합성 Full·월간 Full, **오브젝트 락 보존 30~90일**
- 원격 NAS로 복제 + 월 1회 테이프 오프사이트.

### 지점사무소(경량)

- **NAS(2베이 RAID1)** + PC 에이전트 백업(중앙 NMS에 상태 보고)
- 클라우드 오브젝트에 일일 동기화, 랜섬웨어 대비 **버전/불변**.

### 클라우드-퍼스트

- **EBS 스냅샷 정책**, RDS 자동백업+PITR, S3 **Object Lock**
- **IaC(Terraform)**로 **Warm Standby** 템플릿 유지, DR **게임데이** 분기 1회.

---

## 툴 체인(예시)

- **엔터프라이즈**: Veeam, Commvault, Veritas NetBackup.
- **오픈소스/경량**: **restic**, **borg**, **kopia**, **rsnapshot**, **Amanda/Bacula**.
- **모니터링**: Prometheus+Alertmanager, Grafana, Loki/Elastic.

```bash
# restic 예시 (오브젝트 저장소)

export RESTIC_REPOSITORY=s3:https://s3.example.com/backup
export RESTIC_PASSWORD=SuperSecret
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
restic init
restic backup /srv/data --tag daily
restic snapshots
restic forget --keep-daily 30 --keep-weekly 12 --keep-monthly 12 --prune
```

---

## 체크리스트(설계/구축/운영)

### 설계

- [ ] 워크로드 유형(IO 패턴/IOPS/지연/블록 크기) 파악
- [ ] RAID/풀 설계(패널티 고려), 캐시/BBU
- [ ] 네트워크 스토리지 경로(MPIO/Jumbo/DCB)
- [ ] 백업 목표 **RPO/RTO** 수립 및 계층화(핵심/일반/아카이브)
- [ ] **3-2-1-1-0** 전략·보존정책(GFS)·불변성 적용
- [ ] 보안(암호화·키관리·MFA-Delete·에어갭)

### 구축

- [ ] ifindex/pool 이름 표준화, 태깅/CMDB
- [ ] 백업 계정 최소권한/전용 네트워크
- [ ] VSS/퀘스 스크립트, DB 로그 아카이브 연동
- [ ] 모니터링/알림/대시보드 배포

### 운영

- [ ] 백업 성공률/지속시간 추적, 실패 자동재시도
- [ ] **정기 복구 테스트**(샘플링) + 해시/애플리케이션 검증
- [ ] 변경률·용량 추세 보고서(분기)
- [ ] 취약점/패치, 키 로테이션, **DR 게임데이**

---

## 자주 틀리는 포인트(정오표)

1) **RAID는 백업이 아니다**: 삭제/랜섬웨어/논리손상은 RAID로 못 막음.
2) **스냅샷 단일 스토리지 의존**: 어레이 장애/오염 시 함께 사라질 수 있음.
3) **동기 복제=RPO 0**지만 **지연/거리 제약**.
4) **App-consistent** 필요 워크로드(DB/메일). **Crash-consistent**만으로는 불충분할 수 있음.
5) **Jumbo MTU**는 경로 전체 동일해야 효과.
6) **키 분실=데이터 소실**(암호화). 키 백업·절차 필수.
7) **DR 미연습=DR 실패**: 복구는 “버튼”이 아니라 “과정”.

---

## 연습문제(풀이 포함)

**Q1.** 일일 변경률 2%, 데이터 20TB. 월 1 Full(압축/중복제거 50%) + 일일 증분 30일. 필요한 원시/실 저장량은?
**A.** 원시 \(=20(1+0.6)=32\ \text{TB}\). 실 ≈ **16TB**.

**Q2.** RAID6에서 600 랜덤 write IOPS가 필요, 단일 디스크 150 IOPS. 최소 디스크 수?
**A.** \(600\times 6 / 150 = 24\)개.

**Q3.** RPO 15분, RTO 1시간. 어떤 전략?
**A.** **비동기 복제(≤15분)** + **Warm Standby**(템플릿/오토스케일) 또는 자주 스냅샷+로그 재생.

**Q4.** iSCSI 처리량이 낮다. 우선 점검할 3가지?
**A.** **MTU 일치(점보)**, **MPIO 경로/해시**, **스토리지/서버 양단 큐·IRQ 바인딩/CPU 핀닝**.

**Q5.** 3-2-1-1-0의 “마지막 0”은 무엇?
**A.** **복구 검증 에러 0**(정기 복구 테스트/무결성 체크).

**Q6.** 스냅샷과 백업의 차이 한 줄 요약?
**A.** 스냅샷=**동일 플랫폼의 시점 고정**, 백업=**분리된 매체에 독립 사본**.

**Q7.** 애플리케이션 일관 스냅샷을 위한 Windows 메커니즘은?
**A.** **VSS(Volume Shadow Copy Service)**.

---

## 미니 스크립트/템플릿 모음

### rsync 기반 증분(하드링크·합성 Full 느낌)

```bash
# /backup/daily/2025-09-19 생성, 전일과 링크

TARGET=/backup/daily/$(date +%F)
LAST=/backup/daily/$(date -d "yesterday" +%F)
rsync -aHAX --delete --link-dest=$LAST /srv/data/ $TARGET/
```

### borg(압축/중복제거/암호화)

```bash
export BORG_REPO=/backup/borg
export BORG_PASSPHRASE='StrongPass!'
borg init --encryption=repokey $BORG_REPO
borg create --stats --progress $BORG_REPO::daily-{now:%Y-%m-%d} /srv/data
borg prune -v --list --keep-daily=30 --keep-weekly=12 --keep-monthly=12 $BORG_REPO
```

### ZFS 스냅샷+증분 송수신

```bash
POOL=tank/app
zfs snapshot $POOL@$(date +%F)
# 증분: 어제 스냅샷과 오늘 비교

zfs send -i $POOL@$(date -d "yesterday" +%F) $POOL@$(date +%F) | ssh backup zfs recv -F backup/app
```

---

## 현장 런북(요약)

```yaml
incident: "랜섬웨어 감염 – 파일서버"
steps:
  - isolate: "네트워크 차단, 스냅샷 즉시 보존(immutable)"
  - assess: "감염 범위/시점 파악(백업 카탈로그 비교)"
  - restore:
      order: ["AD/DNS", "DB", "파일서버", "어플리케이션"]
      source: "Object Lock 보존본(감염 전)"
  - validate: "해시/샘플 파일 사용자 검증"
  - harden: "자격증명 교체, 패치, MFA-Delete 적용"
```

---

## 압축 암기표(시험 직전 16줄)

1) **IOPS/지연/처리량**과 **QD** 관계(Little’s Law)
2) RAID **쓰기 패널티**: R5×4, R6×6, R10×2
3) **DAS/NAS/SAN/오브젝트** 차이·용도
4) **LVM/ZFS** 스냅샷·확장·송수신
5) **iSCSI MPIO/Jumbo**, DCB는 신중
6) 백업 유형: Full/Inc/Diff, **합성 Full**
7) **GFS 보존**, **3-2-1-1-0**(불변·검증)
8) 스냅샷≠백업, 복제≠백업
9) **RPO/RTO** 정의, 동기=RPO 0
10) **VSS/fsfreeze**로 App-consistent
11) DB **PITR**: Full+WAL/Binlog
12) VM **CBT**, K8s **etcd+CSI+Velero**
13) 암호화/키관리, **Object Lock/MFA-Delete**
14) 백업 성공률 SLO ≥99%, **복구 훈련**
15) 백업창→필요 **Gb/s** 계산
16) 키 분실=데이터 소실(키 백업 필수)

---

## 마무리

- **성능은 수식으로**, **보호는 원칙으로**. RAID·캐시·네트워크를 수치로 설계하고,
- 데이터 보호는 **스냅샷/복제/백업**을 **계층화**하며 **3-2-1-1-0**로 **무결·불변·오프사이트**를 보장하세요.
- 마지막은 **복구 훈련**입니다. **복구 가능한 백업**만이 진짜 백업입니다.
