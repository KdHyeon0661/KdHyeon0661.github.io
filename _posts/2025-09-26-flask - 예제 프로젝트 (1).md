---
layout: post
title: flask - 예제 프로젝트 (1) 인증 + CRUD + 페이지네이션
date: 2025-09-26 14:25:23 +0900
category: flask
---
# 예제 프로젝트 (1) 미니 블로그: 인증 + CRUD + 페이지네이션

> 이 예제는 **Flask**로 구현하는 **미니 블로그**다.
> 포함 기능: **회원가입/로그인(Flask-Login, 비밀번호 해시)** → **게시글 CRUD(생성/조회/수정/삭제)** → **페이지네이션** → **권한(작성자만 수정/삭제)** → **CSRF 보호 & 폼 검증(Flask-WTF)** → **템플릿(Jinja2) & 플래시 메시지** → **CLI(시드/관리자 생성)**.
> 모든 코드는 ``` 로 감싸며, 수식이 있으면 $$...$$ 로 표기한다(본 문서엔 수식이 없다).

---

## 0. 빠른 미리보기

- 홈(목록): `/` (비회원도 열람 가능, 페이지네이션)
- 보기: `/post/<id>`
- 작성/수정/삭제: 로그인 필요(작성자만 수정/삭제)
- 가입: `/auth/register`
- 로그인: `/auth/login`
- 로그아웃: `/auth/logout`

---

## 1. 환경 준비

### 1.1 요구 사항

- Python 3.11+ 권장
- 가상환경(venv/poetry) 중 택1

### 1.2 requirements.txt

```txt
Flask==3.0.3
Flask-SQLAlchemy==3.1.1
Flask-Migrate==4.0.7
Flask-WTF==1.2.1
WTForms==3.1.2
email-validator==2.2.0
Flask-Login==0.6.3
python-dotenv==1.0.1
```

### 1.3 디렉터리 레이아웃

```
mini_blog/
├─ .env
├─ requirements.txt
├─ wsgi.py
├─ config.py
├─ app/
│  ├─ __init__.py
│  ├─ extensions.py
│  ├─ models.py
│  ├─ forms.py
│  ├─ cli.py
│  ├─ blueprints/
│  │  ├─ auth.py
│  │  └─ blog.py
│  └─ templates/
│     ├─ base.html
│     ├─ macros/
│     │  └─ pagination.html
│     ├─ auth/
│     │  ├─ login.html
│     │  └─ register.html
│     └─ blog/
│        ├─ index.html
│        ├─ detail.html
│        └─ edit.html
└─ migrations/   # (flask db init 후 생성)
```

### 1.4 .env (개발용)

```env
FLASK_APP=wsgi:app
FLASK_ENV=development
SECRET_KEY=dev-secret-change-me
DATABASE_URL=sqlite:///dev.db
```

---

## 2. 설정 & 앱 팩토리

### 2.1 config.py

```python
import os

class BaseConfig:
    SECRET_KEY = os.getenv("SECRET_KEY", "change-me")
    SQLALCHEMY_DATABASE_URI = os.getenv("DATABASE_URL", "sqlite:///app.db")
    SQLALCHEMY_TRACK_MODIFICATIONS = False
    WTF_CSRF_TIME_LIMIT = 60 * 60 * 8  # 8h
    REMEMBER_COOKIE_DURATION = 60 * 60 * 24 * 14  # 14 days

class DevelopmentConfig(BaseConfig):
    DEBUG = True

class ProductionConfig(BaseConfig):
    DEBUG = False

def get_config():
    env = os.getenv("FLASK_ENV", "production").lower()
    return DevelopmentConfig if env.startswith("dev") else ProductionConfig
```

### 2.2 app/extensions.py

```python
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate
from flask_login import LoginManager
from flask_wtf.csrf import CSRFProtect

db = SQLAlchemy(session_options={"autoflush": False, "expire_on_commit": False})
migrate = Migrate()
login_manager = LoginManager()
csrf = CSRFProtect()
```

### 2.3 app/__init__.py

```python
from flask import Flask
from .extensions import db, migrate, login_manager, csrf
from .models import User
from . import cli

def create_app():
    from config import get_config
    app = Flask(__name__, instance_relative_config=False)
    app.config.from_object(get_config())

    # init extensions
    db.init_app(app)
    migrate.init_app(app, db)
    csrf.init_app(app)
    login_manager.init_app(app)
    login_manager.login_view = "auth.login"
    login_manager.login_message = "로그인이 필요합니다."

    # blueprints
    from .blueprints.auth import bp as auth_bp
    from .blueprints.blog import bp as blog_bp
    app.register_blueprint(auth_bp)
    app.register_blueprint(blog_bp)

    # cli 등록
    cli.init_cli(app)

    # shell context
    @app.shell_context_processor
    def _ctx():
        from .models import User, Post
        return {"db": db, "User": User, "Post": Post}

    return app

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))
```

### 2.4 wsgi.py

```python
from app import create_app
app = create_app()

if __name__ == "__main__":
    app.run()
```

---

## 3. 모델

### 3.1 app/models.py

```python
from datetime import datetime, timezone
from werkzeug.security import generate_password_hash, check_password_hash
from flask_login import UserMixin
from .extensions import db

def utcnow():
    return datetime.now(timezone.utc)

class User(UserMixin, db.Model):
    __tablename__ = "users"
    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(255), unique=True, index=True, nullable=False)
    name = db.Column(db.String(120), nullable=False)
    password_hash = db.Column(db.String(255), nullable=False)
    is_active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime(timezone=True), default=utcnow)

    posts = db.relationship("Post", back_populates="author", lazy="dynamic")

    def set_password(self, raw: str):
        self.password_hash = generate_password_hash(raw)

    def check_password(self, raw: str) -> bool:
        return check_password_hash(self.password_hash, raw)

class Post(db.Model):
    __tablename__ = "posts"
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    body = db.Column(db.Text, nullable=False)
    created_at = db.Column(db.DateTime(timezone=True), default=utcnow, index=True)
    updated_at = db.Column(db.DateTime(timezone=True), onupdate=utcnow)
    author_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=False)

    author = db.relationship("User", back_populates="posts")
```

> 인덱스: `Post.created_at` 에 인덱스를 두어 최신순 정렬 페이지네이션을 빠르게 한다.

---

## 4. 폼(Flask-WTF)

### 4.1 app/forms.py

```python
from flask_wtf import FlaskForm
from wtforms import StringField, PasswordField, TextAreaField, BooleanField, SubmitField
from wtforms.validators import DataRequired, Email, Length, EqualTo

class RegisterForm(FlaskForm):
    email = StringField("이메일", validators=[DataRequired(), Email(), Length(max=255)])
    name = StringField("이름", validators=[DataRequired(), Length(max=120)])
    password = PasswordField("비밀번호", validators=[DataRequired(), Length(min=8, max=128)])
    password2 = PasswordField("비밀번호 확인", validators=[DataRequired(), EqualTo("password")])
    submit = SubmitField("가입")

class LoginForm(FlaskForm):
    email = StringField("이메일", validators=[DataRequired(), Email()])
    password = PasswordField("비밀번호", validators=[DataRequired()])
    remember = BooleanField("로그인 유지")
    submit = SubmitField("로그인")

class PostForm(FlaskForm):
    title = StringField("제목", validators=[DataRequired(), Length(max=200)])
    body = TextAreaField("내용", validators=[DataRequired(), Length(min=1)])
    submit = SubmitField("저장")
```

---

## 5. 블루프린트: 인증

### 5.1 app/blueprints/auth.py

```python
from flask import Blueprint, render_template, redirect, url_for, flash, request
from flask_login import login_user, logout_user, current_user
from ..extensions import db
from ..forms import RegisterForm, LoginForm
from ..models import User

bp = Blueprint("auth", __name__, url_prefix="/auth")

@bp.route("/register", methods=["GET", "POST"])
def register():
    if current_user.is_authenticated:
        flash("이미 로그인되어 있습니다.", "info")
        return redirect(url_for("blog.index"))
    form = RegisterForm()
    if form.validate_on_submit():
        if User.query.filter_by(email=form.email.data.lower()).first():
            flash("이미 존재하는 이메일입니다.", "warning")
            return render_template("auth/register.html", form=form)
        user = User(email=form.email.data.lower(), name=form.name.data)
        user.set_password(form.password.data)
        db.session.add(user); db.session.commit()
        flash("가입이 완료되었습니다. 로그인해주세요.", "success")
        return redirect(url_for("auth.login"))
    return render_template("auth/register.html", form=form)

@bp.route("/login", methods=["GET", "POST"])
def login():
    if current_user.is_authenticated:
        flash("이미 로그인되어 있습니다.", "info")
        return redirect(url_for("blog.index"))
    form = LoginForm()
    if form.validate_on_submit():
        user = User.query.filter_by(email=form.email.data.lower()).first()
        if not user or not user.check_password(form.password.data):
            flash("이메일 또는 비밀번호가 올바르지 않습니다.", "danger")
            return render_template("auth/login.html", form=form)
        login_user(user, remember=form.remember.data)
        flash("환영합니다!", "success")
        next_url = request.args.get("next") or url_for("blog.index")
        return redirect(next_url)
    return render_template("auth/login.html", form=form)

@bp.route("/logout", methods=["POST"])
def logout():
    if current_user.is_authenticated:
        logout_user()
        flash("로그아웃되었습니다.", "info")
    return redirect(url_for("blog.index"))
```

---

## 6. 블루프린트: 블로그(목록/보기/작성/수정/삭제)

### 6.1 권한 헬퍼

```python
# app/blueprints/blog.py (상단)
from flask import abort
from flask_login import login_required, current_user

def ensure_author(post):
    if post.author_id != current_user.id:
        abort(403)
```

### 6.2 app/blueprints/blog.py

```python
from flask import Blueprint, render_template, redirect, url_for, request, flash
from sqlalchemy import desc
from flask_login import login_required, current_user
from ..extensions import db
from ..models import Post
from ..forms import PostForm

bp = Blueprint("blog", __name__)

@bp.get("/")
def index():
    # 페이지네이션: ?page=1&per=10 (per는 선택)
    page = max(1, int(request.args.get("page", 1)))
    per_page = min(50, int(request.args.get("per", 10)))
    q = Post.query.order_by(desc(Post.created_at))
    pagination = q.paginate(page=page, per_page=per_page, error_out=False)
    return render_template("blog/index.html", pagination=pagination, posts=pagination.items)

@bp.get("/post/<int:post_id>")
def detail(post_id):
    post = Post.query.get_or_404(post_id)
    return render_template("blog/detail.html", post=post)

@bp.route("/post/new", methods=["GET", "POST"])
@login_required
def create():
    form = PostForm()
    if form.validate_on_submit():
        post = Post(title=form.title.data, body=form.body.data, author_id=current_user.id)
        db.session.add(post); db.session.commit()
        flash("게시글이 생성되었습니다.", "success")
        return redirect(url_for("blog.detail", post_id=post.id))
    return render_template("blog/edit.html", form=form, mode="create")

@bp.route("/post/<int:post_id>/edit", methods=["GET", "POST"])
@login_required
def edit(post_id):
    post = Post.query.get_or_404(post_id)
    if post.author_id != current_user.id:
        return ("권한이 없습니다.", 403)
    form = PostForm(obj=post)
    if form.validate_on_submit():
        post.title = form.title.data
        post.body = form.body.data
        db.session.commit()
        flash("게시글이 수정되었습니다.", "success")
        return redirect(url_for("blog.detail", post_id=post.id))
    return render_template("blog/edit.html", form=form, mode="edit", post=post)

@bp.post("/post/<int:post_id>/delete")
@login_required
def delete(post_id):
    post = Post.query.get_or_404(post_id)
    if post.author_id != current_user.id:
        return ("권한이 없습니다.", 403)
    db.session.delete(post); db.session.commit()
    flash("게시글이 삭제되었습니다.", "info")
    return redirect(url_for("blog.index"))
```

---

## 7. 템플릿(Jinja2)

### 7.1 templates/base.html

{% raw %}
```html
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>{% block title %}미니 블로그{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto;max-width:860px;margin:0 auto;padding:1.25rem;}
    header,footer{margin:1rem 0;}
    nav a{margin-right:.5rem}
    .flash{padding:.75rem;border-radius:.5rem;margin:.5rem 0}
    .flash.info{background:#eef5ff}
    .flash.success{background:#ecfbf0}
    .flash.warning{background:#fff6e6}
    .flash.danger{background:#ffecec}
    form.inline{display:inline}
    textarea{width:100%;min-height:200px}
    input[type=text],input[type=email],input[type=password]{width:100%;padding:.5rem}
    .muted{color:#666}
    .post-card{padding:1rem;border:1px solid #ddd;border-radius:.5rem;margin:.75rem 0}
    .pagination a, .pagination span{margin:.2rem .15rem}
  </style>
  {% block head %}{% endblock %}
</head>
<body>
<header>
  <h1><a href="{{ url_for('blog.index') }}">미니 블로그</a></h1>
  <nav>
    {% if current_user.is_authenticated %}
      <span class="muted">{{ current_user.name }} ({{ current_user.email }})</span>
      <a href="{{ url_for('blog.create') }}">새 글</a>
      <form class="inline" method="post" action="{{ url_for('auth.logout') }}">
        {{ csrf_token() }}
        <button type="submit">로그아웃</button>
      </form>
    {% else %}
      <a href="{{ url_for('auth.login') }}">로그인</a>
      <a href="{{ url_for('auth.register') }}">회원가입</a>
    {% endif %}
  </nav>
</header>

{% for c,m in [('info','info'),('success','success'),('warning','warning'),('danger','danger')] %}
  {% for msg in get_flashed_messages(category_filter=[c]) %}
    <div class="flash {{ m }}">{{ msg }}</div>
  {% endfor %}
{% endfor %}

<main>
  {% block content %}{% endblock %}
</main>

<footer class="muted">
  <p>© Mini Blog Example</p>
</footer>

</body>
</html>
```
{% endraw %}

### 7.2 templates/macros/pagination.html

{% raw %}
```html
{% macro render_pagination(pagination, endpoint) -%}
<nav class="pagination" aria-label="페이지네이션">
  {% if pagination.has_prev %}
    <a href="{{ url_for(endpoint, page=1, per=pagination.per_page) }}">&laquo; 처음</a>
    <a href="{{ url_for(endpoint, page=pagination.prev_num, per=pagination.per_page) }}">이전</a>
  {% else %}
    <span>&laquo; 처음</span>
    <span>이전</span>
  {% endif %}

  <span class="muted">페이지 {{ pagination.page }}/{{ pagination.pages or 1 }}</span>

  {% if pagination.has_next %}
    <a href="{{ url_for(endpoint, page=pagination.next_num, per=pagination.per_page) }}">다음</a>
    <a href="{{ url_for(endpoint, page=pagination.pages, per=pagination.per_page) }}">마지막 &raquo;</a>
  {% else %}
    <span>다음</span>
    <span>마지막 &raquo;</span>
  {% endif %}
</nav>
{%- endmacro %}
```
{% endraw %}

### 7.3 templates/auth/login.html

{% raw %}
```html
{% extends "base.html" %}
{% block title %}로그인 - 미니 블로그{% endblock %}
{% block content %}
<h2>로그인</h2>
<form method="post">
  {{ form.hidden_tag() }}
  <p>
    {{ form.email.label }}<br>
    {{ form.email(size=40) }}<br>
    {% for e in form.email.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>
    {{ form.password.label }}<br>
    {{ form.password(size=40) }}<br>
    {% for e in form.password.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>{{ form.remember() }} {{ form.remember.label }}</p>
  <p>{{ form.submit(class_="btn") }}</p>
</form>
{% endblock %}
```
{% endraw %}

### 7.4 templates/auth/register.html

{% raw %}
```html
{% extends "base.html" %}
{% block title %}회원가입 - 미니 블로그{% endblock %}
{% block content %}
<h2>회원가입</h2>
<form method="post">
  {{ form.hidden_tag() }}
  <p>
    {{ form.email.label }}<br>
    {{ form.email(size=40) }}<br>
    {% for e in form.email.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>
    {{ form.name.label }}<br>
    {{ form.name(size=40) }}<br>
    {% for e in form.name.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>
    {{ form.password.label }}<br>
    {{ form.password(size=40) }}<br>
    {% for e in form.password.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>
    {{ form.password2.label }}<br>
    {{ form.password2(size=40) }}<br>
    {% for e in form.password2.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>{{ form.submit(class_="btn") }}</p>
</form>
{% endblock %}
```
{% endraw %}

### 7.5 templates/blog/index.html

{% raw %}
```html
{% extends "base.html" %}
{% from "macros/pagination.html" import render_pagination %}
{% block title %}홈 - 미니 블로그{% endblock %}
{% block content %}
<h2>최신 글</h2>

{% if posts %}
  {% for p in posts %}
    <article class="post-card">
      <h3><a href="{{ url_for('blog.detail', post_id=p.id) }}">{{ p.title }}</a></h3>
      <p class="muted">by {{ p.author.name }} · {{ p.created_at.strftime("%Y-%m-%d %H:%M") }}</p>
      <p>{{ p.body[:180] }}{% if p.body|length > 180 %}...{% endif %}</p>
      <p><a href="{{ url_for('blog.detail', post_id=p.id) }}">자세히</a></p>
    </article>
  {% endfor %}
  {{ render_pagination(pagination, 'blog.index') }}
{% else %}
  <p>아직 글이 없습니다. 첫 글을 작성해보세요!</p>
{% endif %}
{% endblock %}
```
{% endraw %}

### 7.6 templates/blog/detail.html

{% raw %}
```html
{% extends "base.html" %}
{% block title %}{{ post.title }} - 미니 블로그{% endblock %}
{% block content %}
<article>
  <h2>{{ post.title }}</h2>
  <p class="muted">by {{ post.author.name }} · {{ post.created_at.strftime("%Y-%m-%d %H:%M") }}</p>
  <div>
    <pre style="white-space:pre-wrap">{{ post.body }}</pre>
  </div>
  {% if current_user.is_authenticated and current_user.id == post.author_id %}
    <p>
      <a href="{{ url_for('blog.edit', post_id=post.id) }}">수정</a>
      <form class="inline" method="post" action="{{ url_for('blog.delete', post_id=post.id) }}" onsubmit="return confirm('삭제할까요?');">
        {{ csrf_token() }}
        <button type="submit">삭제</button>
      </form>
    </p>
  {% endif %}
  <p><a href="{{ url_for('blog.index') }}">← 목록</a></p>
</article>
{% endblock %}
```
{% endraw %}

### 7.7 templates/blog/edit.html

{% raw %}
```html
{% extends "base.html" %}
{% block title %}{% if mode=='create' %}새 글{% else %}글 수정{% endif %} - 미니 블로그{% endblock %}
{% block content %}
<h2>{% if mode=='create' %}새 글{% else %}글 수정{% endif %}</h2>
<form method="post">
  {{ form.hidden_tag() }}
  <p>
    {{ form.title.label }}<br>
    {{ form.title(size=60) }}<br>
    {% for e in form.title.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>
    {{ form.body.label }}<br>
    {{ form.body() }}<br>
    {% for e in form.body.errors %}<small class="muted">{{ e }}</small><br>{% endfor %}
  </p>
  <p>{{ form.submit(class_="btn") }}</p>
</form>
<p><a href="{{ url_for('blog.index') }}">← 목록</a></p>
{% endblock %}
```
{% endraw %}

---

## 8. CLI: 시드 & 관리자 생성

### 8.1 app/cli.py

```python
import click
from .extensions import db
from .models import User, Post
from datetime import datetime, timezone, timedelta
from faker import Faker

def init_cli(app):
    @app.cli.command("create-admin")
    @click.option("--email", prompt=True)
    @click.option("--name", prompt=True, default="Admin")
    @click.option("--password", prompt=True, hide_input=True, confirmation_prompt=True)
    def create_admin(email, name, password):
        """관리자/테스트 사용자 생성"""
        if User.query.filter_by(email=email.lower()).first():
            click.echo("이미 존재하는 이메일입니다.")
            raise SystemExit(1)
        u = User(email=email.lower(), name=name)
        u.set_password(password)
        db.session.add(u); db.session.commit()
        click.echo(f"생성 완료: {u.id} {u.email}")

    @app.cli.command("seed-posts")
    @click.option("--count", type=int, default=40, show_default=True)
    def seed_posts(count):
        """더미 포스트 시드"""
        fake = Faker("ko_KR")
        user = User.query.order_by(User.id.asc()).first()
        if not user:
            click.echo("먼저 사용자부터 만들어요: flask create-admin")
            raise SystemExit(1)
        for _ in range(count):
            p = Post(
                title=fake.sentence(nb_words=6),
                body="\n\n".join(fake.paragraphs(nb=4)),
                author_id=user.id,
            )
            db.session.add(p)
        db.session.commit()
        click.echo(f"{count}건 생성")
```

> `Faker` 사용 시 `pip install Faker`가 필요하다. 필수가 아니라면 제거해도 된다.

---

## 9. 마이그레이션

### 9.1 초기화 & 적용

```bash
# 1. 가상환경 활성화 후
pip install -r requirements.txt

# 2. DB 마이그레이션 초기화
flask db init

# 3. 모델로부터 스크립트 생성
flask db migrate -m "init tables"

# 4. DB 반영
flask db upgrade
```

---

## 10. 실행 & 사용

### 10.1 개발 서버

```bash
# .env 로 설정 불러옴 (python-dotenv)
flask run
```

- 브라우저: http://127.0.0.1:5000

### 10.2 관리자/시드

```bash
# 관리자/사용자 1명 생성
flask create-admin --email admin@example.com --name Admin

# 더미 포스트 40건
flask seed-posts --count 40
```

### 10.3 로그인 & CRUD

- 로그인 후 **새 글** → 생성
- 상세 페이지에서 **수정/삭제** (작성자만 노출)

---

## 11. 페이지네이션 심화 팁

- `paginate(page, per_page, error_out=False)`
  - `error_out=False` 로 범위를 넘는 페이지에서도 200 응답(빈 목록)
- 목록 정렬 기준은 **created_at DESC**(인덱스 권장)
- 대량 데이터에서 **커서 기반 페이지네이션**을 고려(다음/이전의 기준 ID를 사용)

커서 기반 예(개념):

```python
# created_at, id 로 커서
cursor = request.args.get("cursor")  # "created_at:id" 형태
limit = min(50, int(request.args.get("limit", 10)))

q = Post.query
if cursor:
    ts, pid = cursor.split(":")
    # ts, pid보다 "이전" 레코드만
    q = q.filter(
        db.or_(
            Post.created_at < ts,
            db.and_(Post.created_at == ts, Post.id < int(pid))
        )
    )
rows = q.order_by(Post.created_at.desc(), Post.id.desc()).limit(limit + 1).all()
next_cursor = None
if len(rows) > limit:
    last = rows[limit-1]
    next_cursor = f"{last.created_at.isoformat()}:{last.id}"
```

---

## 12. 권한 & 보안 포인트

- **작성자만 수정/삭제**: 서버에서 반드시 검사(템플릿 노출만으로는 불충분).
- **CSRF**: Flask-WTF 사용으로 폼/POST 보호(로그아웃도 POST).
- **비밀번호 해시**: `werkzeug.security` 사용(해시 저장, 평문 저장 금지).
- **세션 설정**: `SECRET_KEY` 는 환경변수로 안전하게 주입(실서비스에서 랜덤/강력한 키).
- **속도 제한(선택)**: 로그인 시도 등에 Flask-Limiter 적용 가능.

---

## 13. 에러 핸들러(선택)

```python
# app/__init__.py 끝부분에 추가해도 됨
from flask import render_template

def _register_errors(app):
    @app.errorhandler(403)
    def _403(e): return (render_template("errors/403.html"), 403)
    @app.errorhandler(404)
    def _404(e): return (render_template("errors/404.html"), 404)
```

템플릿은 생략 가능(간단 메시지 반환도 충분).

---

## 14. 테스트 스케치(선택)

```python
# tests/test_auth.py
def test_register_and_login(client, db_session):
    r = client.post("/auth/register", data={
        "email":"u@example.com", "name":"U",
        "password":"password123", "password2":"password123"
    }, follow_redirects=True)
    assert r.status_code == 200
    r = client.post("/auth/login", data={"email":"u@example.com", "password":"password123"}, follow_redirects=True)
    assert b"환영합니다" in r.data
```

> 실제 테스트는 15장에서 다룬 픽스처(app/client/db)를 적용하면 깔끔해진다.

---

## 15. Docker(선택)

```dockerfile
# Dockerfile
FROM python:3.11-slim
WORKDIR /app
ENV PYTHONDONTWRITEBYTECODE=1 PYTHONUNBUFFERED=1
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
ENV FLASK_APP=wsgi:app
EXPOSE 5000
CMD ["flask","run","--host=0.0.0.0","--port=5000"]
```

---

## 16. 확장 아이디어

- **태그/검색**: PostTag, LIKE/FTS, Meilisearch/Whoosh
- **댓글**: Comment 모델 + 작성/삭제 권한
- **이미지 업로드**: 사전서명 URL(13장)로 대용량 처리
- **API(모바일)**: `/api/posts` JSON + JWT (8~9장 참고)
- **캐싱**: 목록 TTL 캐시 / 글 조회수 카운트 Redis
- **Admin**: Flask-Admin/AppBuilder로 관리 UI(14장)

---

## 17. 트러블슈팅

- **`CSRF token missing`**: 폼에 {% raw %}`{{ form.hidden_tag() }}`{% endraw %} / 수동 POST엔 {% raw %}`{{ csrf_token() }}`{% endraw %} 포함 필요
- **페이지네이션 404**: `error_out=False` 사용
- **SQLite 잠금**: 동시 쓰기 많으면 Postgres로 전환(7장 체크리스트 참고)
- **한글 깨짐**: 템플릿 `<meta charset="utf-8">` 확인, 파일 인코딩 UTF-8

---

## 18. 요약

- Flask-Login + Flask-WTF 조합으로 **안전한 인증/폼 처리**
- SQLAlchemy 모델로 **User/Post** 관계 구성
- **페이지네이션**은 `paginate()` 로 간단히
- **권한**(작성자만 수정/삭제)과 **CSRF** 보호는 서버에서 확실히
- CLI로 **관리자 생성/시드** 자동화
