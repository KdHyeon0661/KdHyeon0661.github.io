---
layout: post
title: AWS - 고가용성과 확장성
date: 2025-08-08 16:20:23 +0900
category: AWS
---
# 고가용성(HA)과 확장성(Scalability) 설계 — 완전 가이드

고가용성(High Availability, HA)과 확장성(Scalability)은 클라우드 애플리케이션 설계의 핵심 목표입니다.  
이 문서는 개념·원칙·아키텍처 패턴·AWS 서비스별 구현 방법·운영 절차·검증(테스트)까지 실무에서 바로 쓸 수 있도록 자세히 정리합니다.

---

## 📌 요약(한 문장)
- **HA**는 장애를 감지하고 서비스 중단 없이 복구(또는 자동 전환)하는 능력입니다.  
- **Scalability**는 트래픽·부하 증가에 따라 성능을 유지하도록 용량을 늘리거나 줄이는 능력입니다.  
둘은 함께 설계되어야 하며, 핵심 키워드는 **중복성, 분리(Decoupling), 자동화, 관측성(Observability)** 입니다.

---

## 1. 핵심 개념 정리

### 고가용성 (HA)
- 목표: **서비스 중단(다운타임) 최소화** → RTO(복구시간)·RPO(데이터 손실 허용범위) 정의 필요.
- 전략: 중복(인스턴스/존/리전), 장애격리(Failure Isolation), 자동 장애 복구(Health checks + Auto Healing).

### 확장성 (Scalability)
- 목표: **증가하는 부하를 효율적으로 감당** → 성능/응답시간 보장.
- 유형:
  - **수평 확장(Horizontal)**: 인스턴스/노드를 늘림. (권장)
  - **수직 확장(Vertical)**: 인스턴스 사양 업그레이드.
- 방법: 자동화된 오토스케일링(수요 기반), 큐잉/버퍼링으로 부하 평준화.

---

## 2. 설계 원칙 (Design Principles)

1. **무상태(Stateless)** 우선: 가능한 컴포넌트는 무상태로 설계 → 어떤 인스턴스든 요청 처리 가능.  
2. **결합도 낮추기(Decouple)**: SQS, SNS, EventBridge 등으로 서비스 간 의존성 완화.  
3. **데이터 격리 및 복제**: 데이터는 복제(멀티-AZ/멀티-리전)하고 읽기 전용 복제본 활용.  
4. **자동화(Automate everything)**: 인프라(Provisoning), 배포(Deploy), 스케일링, 롤백까지 자동화.  
5. **관측성(Observe)**: 메트릭·로그·트레이스 수집 — SLO/SLI/에러버젯 기반 운영.  
6. **점진적 배포(Progressive Delivery)**: Canary / Blue-Green / Immutable 배포로 리스크 최소화.  
7. **한계 설정(Saturation-aware)**: CPU/Mem/IO/Network 포화(saturation)을 항상 측정하고 대비.

---

## 3. 아키텍처 패턴 모음

### 3.1 엣지(Edge) + CDN
- **CloudFront**(CDN)를 사용해 글로벌 캐싱 → 원본 부하 감소, 레이턴시 개선.

### 3.2 로드 밸런싱 + Auto Scaling
- **ALB / NLB** + **Auto Scaling Group (ASG)** 또는 **ECS/Fargate 오토스케일링**.
- 헬스체크와 함께 자동 교체(heal) 설정.

### 3.3 큐잉(비동기 처리)
- **SQS / Kinesis / SNS** 사용 → 생산자-소비자 분리, 버퍼링, 흡수력 향상.

### 3.4 캐싱 계층
- **ElastiCache (Redis/Memcached)** 또는 애플리케이션 레벨 캐시로 데이터베이스 부하 감소.

### 3.5 데이터베이스 고가용성
- RDS: **Multi-AZ** (동기 복제 → 장애 시 자동 페일오버)  
- Aurora: **Multi-AZ + Read Replica**, **Global DB**(멀티-리전 복제)  
- DynamoDB: **Global Tables**(멀티-리전), 온디맨드 모드로 자동 확장

### 3.6 분산 트랜잭션 회피
- 장기 트랜잭션 대신 **Eventual consistency**, SAGA 패턴, 보상 트랜잭션 사용.

### 3.7 데이터 레이크/아카이브
- S3 + Lifecycle, Redshift Spectrum, Athena로 콜드 데이터 분리.

---

## 4. AWS 서비스별 구현 가이드 (핵심)

### Compute (웹/앱)
- **EC2 + ASG + ALB**
  - ASG 헬스 체크: EC2 상태 + ALB 통합 헬스 체크권장
  - Scaling 정책: TargetTracking(예: ALB 요청/target), StepScaling(예: CPU 임계치)
- **ECS/EKS**
  - Fargate: 서버 관리 불필요, 수평 확장 쉬움
  - EKS: 쿠버네티스 HPA / Cluster Autoscaler 사용 가능
- **Lambda**
  - 이벤트 기반 자동 수평 확장, 하지만 동시 실행 한계/Cold start 고려

### 네트워크 & DNS
- **Route 53**: 가중치 기반, 지리적 라우팅, 헬스체크로 DNS 레벨 장애 분산/페일오버.
- **VPC**: 다중 AZ 서브넷 분배, NAT/Private subnet 구조, 엔드포인트(VPC Endpoint) 활용.

### 스토리지
- **S3**: 내구성(11 9's) · 멀티-AZ 자동 제공 → 정적 자원, 데이터 레이크.
- **EBS**: AZ 단위, 스냅샷/백업 관리 필요.
- **EFS**: 멀티-AZ 파일 스토리지(서버리스 공유 파일).

### DB (관계형)
- **RDS Multi-AZ**: 높은 HA, 자동 페일오버
- **Read Replica**: 읽기 확장, 비대칭 읽기 집중 워크로드
- **Aurora**: 빠른 자동 복구, 분산 스토리지, Global DB로 리전 간 지연 최소화

### DB (NoSQL)
- **DynamoDB On-demand** / **Provisioned + Auto Scaling**: 대규모 확장성
- **Global Tables**: 멀티-리전 활성/활성(Active-Active)

### 메시징 & 스트리밍
- **SQS**: 느슨한 결합, 백프레셔(Backpressure) 처리
- **SNS**: 푸시 기반 분배(Fan-out)
- **Kinesis / MSK**: 스트리밍 실시간 처리

---

## 5. 확장 전략과 오토스케일링 설정

### 확장 방식
- **Reactive (반응형)**: 임계치 초과 시 스케일 아웃. (예: CPU>70%)  
  - 장점: 단순, 비용절감 가능. 단점: 지연(Scale-out latency).
- **Proactive / Predictive**: 트래픽 예측 기반 사전 스케일링(예: scheduled scaling, predictive scaling).  
- **Hybrid**: scheduled + target tracking + step scaling 조합.

### 오토스케일링 팁
- **Metric 선택**: CPU만 보지 말고(더 중요한 경우도 많음) Latency, Queue length, RequestCount per target 등 사용.  
- **Cooldown / Stabilization**: 불필요한 스케일 인/아웃 방지.  
- **Warm pools / Provisioned Capacity**: 빠른 확장이 필요하면 미리 인스턴스 준비.  
- **Graceful shutdown**: Lifecycle hooks로 연결 해제 전 작업 처리.

#### 예: Target Tracking Policy (CloudFormation snippet)
```yaml
Resources:
  MyAutoScalingGroup:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      MinSize: "2"
      MaxSize: "10"
      ...
  MyScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: "TargetTrackingPolicy"
      PolicyType: "TargetTrackingScaling"
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 50.0
        PredefinedMetricSpecification:
          PredefinedMetricType: ALBRequestCountPerTarget
        ScaleInCooldown: 300
        ScaleOutCooldown: 300
```

---

## 6. 데이터 계층(Consistency, Replication, Failover)

### RPO / RTO 설정
- 정의: 비즈니스 요구에 따른 RPO(데이터 손실 허용범위)와 RTO(복구시간)를 명확히 정합니다.
- 데이터 중요도에 따라 멀티-AZ 동기복제(최소 RPO) 또는 비동기 리플리카(성능 트레이드오프)를 선택.

### 복제 패턴
- **Active-Passive**: 주 DB만 쓰고, 리플리카는 대기(간단, 비용 적음).
- **Active-Active**: 여러 리전/노드에서 읽기·쓰기 가능(복잡, Conflict 해결 필요).

### S3 CRR (Cross-Region Replication)
- 리전 장애 대비, 리전별 근접성 향상.

---

## 7. 배포 전략 (가용성 영향 최소화)

- **Immutable / Blue-Green**: 새 인프라 생성 후 트래픽 전환 → 롤백 간단, 다운타임 제로(또는 최소).  
- **Canary**: 소수 트래픽에서 변경 검증 후 점진 확장.  
- **Rolling with health checks**: 점진 업그레이드, 헬스 체크 실패 시 중단.

---

## 8. 장애 대비(Resilience) 구현 기법

- **Circuit Breaker**: 외부 서비스 실패 시 빠르게 실패(fail fast)하고 복구 시도.  
- **Retry & Backoff**: 지수 백오프, 최대 재시도 제한, idempotency key 사용.  
- **Bulkhead**: 리소스 격리 — 한 서비스가 다른 서비스의 리소스를 소비하지 않도록 분리.  
- **Graceful degradation**: 핵심 기능만 유지(에러 발생 시 비핵심 기능 비활성화).

---

## 9. 관측성(Observability) & SLO/SLI 설계

### 핵심 지표(Metrics)
- 가용성: 성공 요청 비율, HTTP 5xx 비율  
- 성능: p50/p95/p99 레이턴시  
- 용량: CPU, Memory, IO, Network, Queue length  
- 안정성: Error rate, Throttles, Retries

### 모니터링 툴
- **CloudWatch Metrics/Alarms**, **CloudWatch Logs Insights**, **X-Ray**(분산 추적), **OpenTelemetry** 연동, 서드파티(APM) 도입 가능

### SLO / SLI
- SLI: "응답시간 < 500ms 비율" 등  
- SLO: "99.9% of requests within 500ms"  
- Error budget: 허용 오차 → 배포 주기·실험(Chaos) 제어 기준

---

## 10. 테스트 및 검증 (검증 주기와 방법)

### 정기적 테스트
- **가용성 테스트**: 리전/존 장애 모사(예: instance termination, AZ isolation 시나리오)  
- **로드 테스트**: 부하 수준에서 스케일 정책 작동 확인(Autoscaling latency 포함)  
- **Chaos Engineering**: 의도적 장애(예: terminate, network latency)로 복원력 검증  
- **DR Drills (Disaster Recovery Drill)**: 장애 시나리오 실전 훈련(복구 시간 측정)

### 테스트 체크리스트
- 헬스체크 → 인스턴스 교체 검증  
- 세션 무상태/세션 스토리지(또는 Sticky session의 트레이드오프) 검증  
- 데이터 복제 일관성 검증(RTO/RPO 확인)

---

## 11. 운영(운영 Playbook & Runbook)

### 인시던트 시 행동 흐름
1. 알람 수신 → SRE/온콜 호출  
2. 롤백 또는 트래픽 쉐이핑(예: Route53 가중치 조정) 결정  
3. 임시 조치(스케일 아웃, 인스턴스 교체) 실행  
4. 포렌식(CloudWatch, CloudTrail, VPC Flow Logs) 확인  
5. RCA(근본원인), 개선 조치, SLO·알람 튜닝 반영

### 자동화 예시
- Incident Lambda: 특정 알람 발생 시 자동으로 추가 인스턴스 생성 또는 장애 라우팅.
- Playbook은 자동 및 수동 액션을 명확히 구분.

---

## 12. 비용-성능 트레이드오프

- 고가용성은 비용 상승을 동반: 멀티-AZ, 멀티-리전, 복제본, 예비 인프라 등.  
- 가용성 목표 → 비용 예산 매핑 필요: SLO 수준에 따라 어떤 HA/DR 전략(Active-Active vs Active-Passive)을 채택할지 결정.

---

## 13. 실무 체크리스트 (설계/배포 전 확인)

- [ ] RTO / RPO가 문서화되어 있는가?  
- [ ] 서비스는 무상태인가? (세션 관리 방법 명시)  
- [ ] 모든 상태 데이터는 적절한 HA 스토리지(멀티-AZ/리전) 사용인가?  
- [ ] 오토스케일링 정책이 트래픽 특성에 적절한가? (latency / requests / queue length 등)  
- [ ] 배포 전략은 Canary / Blue-Green / Rolling 등으로 리스크를 줄이는가?  
- [ ] 헬스체크와 자동 복구(재시작/교체)가 작동하는가?  
- [ ] SLO/SLI/알람/대시보드가 정의되고 모니터링 되는가?  
- [ ] 장애 시 수동 롤백 절차 및 자동화가 준비되어 있는가?  
- [ ] 정기적으로 가용성·복구 연습(게임데이, DR drill)을 시행하는가?

---

## 14. 예제: 간단한 ALB + ASG (CloudFormation YAML 스니펫)
```yaml
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  WebALB:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      Name: web-alb
      Scheme: internet-facing
      Subnets: [subnet-aaa, subnet-bbb, subnet-ccc]
  WebTG:
    Type: AWS::ElasticLoadBalancingV2::TargetGroup
    Properties:
      Port: 80
      Protocol: HTTP
      VpcId: vpc-123
  WebASG:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      MinSize: "2"
      MaxSize: "6"
      DesiredCapacity: "2"
      VPCZoneIdentifier: [subnet-aaa, subnet-bbb]
      LaunchConfigurationName: !Ref WebLaunchConfig
      TargetGroupARNs: [ !Ref WebTG ]
  WebScalingPolicy:
    Type: AWS::ApplicationAutoScaling::ScalingPolicy
    Properties:
      PolicyName: ALBTargetTracking
      PolicyType: TargetTrackingScaling
      TargetTrackingScalingPolicyConfiguration:
        TargetValue: 50.0
        PredefinedMetricSpecification:
          PredefinedMetricType: ALBRequestCountPerTarget
```

> 이 스니펫은 핵심 아이디어만 보여줍니다. 실제 구축시 보안 그룹, IAM, 로그, 헬스 체크 세부 설정을 추가하세요.

---

## 15. 마무리 — 권장 실행 로드맵 (단계별)

1. **정의**: 비즈니스 요구에 따른 RTO/RPO, SLO 정의  
2. **설계**: 무상태·분리·중복성 원칙을 반영한 아키텍처 도출  
3. **구현**: IaC(CF/Terraform/CDK), 헬스체크, 오토스케일 자동화 적용  
4. **관측성 구성**: 대시보드, 알람, 분산 추적, 로그 수집  
5. **검증**: 로드테스트 + 장애 주입(Chaos) + DR Drill  
6. **운영**: 정기 리뷰, 권장사항 반영, 비용/성능 튜닝 반복

---

고가용성·확장성 설계는 단회성 작업이 아니라 **지속적 개선 프로세스**입니다.  
처음부터 모든 것을 완벽하게 만들 필요는 없지만, 위 핵심 원칙(무상태, 분리, 자동화, 관측성)을 따르는 설계는 운영 리스크를 크게 줄여줍니다.
