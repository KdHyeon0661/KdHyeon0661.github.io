---
layout: post
title: 정보보안기사 - 데이터베이스 암호화 기술, MySQL 취약점 점검
date: 2025-11-13 19:25:23 +0900
category: 정보보안기사
---
# SECTION 11 데이터베이스 보안 — 03) 데이터베이스 암호화 기술 & 04) MySQL 취약점 점검

## 목표와 범위

- **무엇**: 저장/전송/사용 중 데이터 암호화(At-Rest/ In-Transit/ In-Use), 키관리(KMS/HSM), 운영상의 체크리스트.
- **대상**: MySQL 8.0/8.4 LTS 중심(Community/Enterprise), 실무에서 바로 돌려볼 수 있는 설정·점검 SQL/스크립트 제공.
- **포함**: TDE(테이블스페이스 암호화), 컬럼/필드 암호화, 백업 암호화, TLS, 계정·권한·설정·로깅·감사까지 **최신 동향 반영**.

---

## 암호화 총론 — 범위·성능·운영 트레이드오프

| 범주 | 목적 | 대표 기술 | 장점 | 주의점 |
|---|---|---|---|---|
| **At-Rest**(디스크/스냅샷/백업) | 매체 탈취·스냅샷 유출 시 보호 | TDE(테이블스페이스/로그 암호화), OS/스토리지 암호화 | 앱 수정 최소 | 키 유출·운영 키순환이 핵심 위험 |
| **In-Transit**(네트워크) | 중간자·스니핑 대응 | **TLS(SSL)**, 계정의 `REQUIRE SSL`, `require_secure_transport` | 쉽고 표준 | 인증서 배포·회전 자동화 필요. 설정 미흡 시 다운그레이드 공격 위험.  |
| **In-Use**(메모리/CPU) | 메모리 스크래핑 대응 | 메모리 내 최소 보존, 크리덴셜 보관도구, 일부 하드웨어 보안(TEE) | 심화 방어 | 일반 RDBMS 권장은 “민감값을 짧게 보존/즉시 파기” |

> 실무 팁: **대량 데이터는 TDE + TLS**, **정밀 보호 필드는 애플리케이션 계층(컬럼/토큰화)**로 이중화.

---

## 저장 데이터 암호화(At-Rest)

### MySQL의 TDE/데이터-앳-레스트 암호화

- MySQL **InnoDB Data-at-Rest Encryption**은 **마스터 키 → 테이블스페이스 키** 구조를 쓰며, **중앙 키관리(KMS) 연계 시 “MySQL Enterprise TDE”**라 칭한다.
- **키 저장소(Keyring/Component)**
  - **Enterprise**: `keyring_okv`(KMIP/Oracle Key Vault 등), `keyring_aws`(AWS KMS 연동) 등.
  - **8.4 LTS 변화**: 기존 `keyring_file`/`keyring_encrypted_file` 플러그인이 **제거**되고, **`component_keyring_encrypted_file`**로 대체. 마이그레이션 고려 필수.

#### (예제) MySQL 8.4 LTS + 파일 기반 Keyring(Component) + 테이블 암호화

`/etc/my.cnf`:
```ini
[mysqld]
early-plugin-load-add=component_keyring_encrypted_file
component_keyring_encrypted_file.file_data=/var/lib/mysql/keyring/keyring_encrypted
# 테이블스페이스/Undo/Redo 암호화 활성화(필요 시)

innodb_undo_log_encrypt=ON
innodb_redo_log_encrypt=ON
```

**테이블 암호화**:
```sql
-- 기본값(옵션): 스키마/테이블 생성 시 암호화
CREATE TABLE hr.employee (
  id BIGINT PRIMARY KEY,
  name VARBINARY(256) NOT NULL,
  ssn VARBINARY(256) NOT NULL
) ENGINE=InnoDB ENCRYPTION='Y';

-- 기존 테이블 암호화 전환
ALTER TABLE hr.legacy_table ENCRYPTION='Y';
```

**키교체(회전)**: 키링/KMS 측에서 마스터키 회전 후, InnoDB 키 재래핑 절차 수행(운영 절차서 필요).

> 운영 체크: **백업/복구 도구**가 암호화 테이블스페이스를 지원하는지 확인(Enterprise Backup는 지원).

---

### 컬럼/필드 수준 암호화(애플리케이션 계층 권장)

- **장점**: 필드 단위 최소권한, 데이터셋 일부만 복호화, **RBAC/ABAC**와 결합 용이.
- **인덱싱**: 완전 무작위(Non-deterministic) 암호문은 인덱스/LIKE에 불리.
  - **정정합(deterministic)** 암호화(예: 동일 평문→동일 암호문)는 **정확 일치 조회** 가능하나 패턴 노출 위험. 솔트/도메인분리/HMAC 인덱스 등 혼합 설계 권장.
- **MySQL 내장 암복호화 함수** 주의: `AES_ENCRYPT/AES_DECRYPT`는 **운영 키관리와 모드 설정**이 핵심. 앱단 라이브러리(OpenSSL, libsodium 등) 권장.

(예제) **AES-256-CBC** + IV 사용:
```sql
-- 안전한 운영을 위해서는 키/IV는 DB 밖(KMS/비밀관리)에 두고,
-- 애플리케이션에서 주입하는 패턴이 바람직.
SET block_encryption_mode='aes-256-cbc';

-- 암호화 저장 예시(IV는 레코드별 난수, 함께 보관)
INSERT INTO customer_secret (cust_id, email_ct, iv)
VALUES (
  1001,
  AES_ENCRYPT('alice@example.com', UNHEX('00112233445566778899AABBCCDDEEFF'), UNHEX('3CFA...IV...')),
  UNHEX('3CFA...IV...')
);

-- 복호화
SELECT AES_DECRYPT(email_ct, UNHEX('00112233445566778899AABBCCDDEEFF'), iv) AS email
FROM customer_secret WHERE cust_id=1001;
```
> 주의: 모드·키·IV 운영은 **정책/감사**로 통제. 필요 시 **토큰화(Tokenization)**, **형식보존암호(FPE)**, **HMAC 인덱스**로 검색성·포맷 요구 충족.

---

### 로그/임시/스냅샷과 백업 암호화

- **Redo/Undo/Temp** 로그도 암호화 옵션 제공(위 my.cnf 예시).
- **백업**:
  - Enterprise 환경: **암호화 테이블스페이스 인지** 백업(Enterprise Backup).
  - Community: `mysqldump` → **OS/GPG로 암호화** 파이프 처리.
```bash
mysqldump --single-transaction --routines --triggers mydb \
| gpg --symmetric --cipher-algo AES256 -o /secure/backup/mydb-$(date +%F).sql.gpg
```

---

## 전송 데이터 암호화(In-Transit) — TLS & 강제 보안 연결

- **`require_secure_transport=ON`** 설정 시, 서버는 **TLS/Unix-Socket/Shared-Memory**만 허용(비보안 TCP 거부).
- 서버 인증서/키 경로 지정 후, 클라이언트에도 CA/클라이언트 인증서 배포.

(예제) `/etc/my.cnf`:
```ini
[mysqld]
require_secure_transport=ON
ssl_ca=/etc/mysql/ssl/ca.pem
ssl_cert=/etc/mysql/ssl/server-cert.pem
ssl_key=/etc/mysql/ssl/server-key.pem
tls_version=TLSv1.2,TLSv1.3
```
(검증)
```sql
SHOW VARIABLES LIKE 'require_secure_transport';
SHOW VARIABLES LIKE 'tls_version';
SHOW STATUS LIKE 'Ssl_%';
```
> 운영 배포서는 **클라이언트 연결 실패 플랜**(드라이버, 워크벤치, ETL 등 갱신)을 포함. RHEL 가이드도 서버/클라 TLS 활성화를 권고.

---

## 사용 중 데이터(In-Use) — 최소 보존과 노출면 축소

- **민감값 메모리 보존 최소화**(즉시 파기), 스왑/덤프 보호.
- **크리덴셜 저장**: `mysql_config_editor` 같은 안전 저장소 활용.
- **애플리케이션**: DTO/로그에 평문 출력 금지(마스킹·레드액션).

---

## 키관리(KMS/HSM) — 수명주기·역할분리·감사

- **키수명주기**: 생성→활성→회전→폐기.
- **역할 분리**: DBA≠KMS 관리자.
- **MySQL 연계**:
  - **KMIP/OKV**: `keyring_okv`로 중앙관리.
  - **AWS KMS**: `keyring_aws`로 키 생성·저장 위임.
- **8.4 이행 유의**: 플러그인 → **Component 기반 키링** 전환 점검.

---

## 실습: “암호화 테이블 + TLS + 권한 최소화” 빠른 구축

1) **Keyring(Component) + InnoDB 암호화**: 위 2.1 예제.
2) **TLS 강제**: `require_secure_transport=ON` 설정(3장).
3) **계정 생성 + SSL 강제 + 암호정책**:
```sql
-- 패스워드 정책(컴포넌트) 활성/튜닝
INSTALL COMPONENT 'file://component_validate_password';
SET PERSIST validate_password.length=14;
SET PERSIST validate_password.mixed_case_count=1;
SET PERSIST validate_password.number_count=1;
SET PERSIST validate_password.special_char_count=1;
-- (원복/제거: UNINSTALL COMPONENT 'file://component_validate_password';)

-- TLS 필수 사용자
CREATE USER 'app'@'10.10.%' IDENTIFIED WITH caching_sha2_password BY 'Str0ng!Passw0rd'
REQUIRE SSL
PASSWORD EXPIRE INTERVAL 180 DAY
FAILED_LOGIN_ATTEMPTS 5 PASSWORD_LOCK_TIME 2;
GRANT SELECT, INSERT, UPDATE, DELETE ON prod.* TO 'app'@'10.10.%';
```
> `validate_password`는 **컴포넌트**로 제공(8.0.4+), 시스템 변수로 정책을 세밀 조정 가능.

---

## MySQL 취약점 점검(최신) — 체크리스트 & 실행 예제

### 인벤토리/버전

- `mysql --version`으로 구동 버전 식별, **8.4 LTS** 채택 여부와 릴리즈 노트로 **비호환/변경** 확인(특히 키링).

### 계정·인증·암호정책

```sql
-- 1) 계정/호스트/플러그인/락 상태
SELECT user, host, plugin, account_locked, password_expired
FROM mysql.user ORDER BY user, host;

-- 2) 원격 루트/광범위 호스트(%) 존재 여부
SELECT user, host FROM mysql.user WHERE user='root' AND host NOT IN ('localhost','127.0.0.1','::1');
SELECT user, host FROM mysql.user WHERE host='%';

-- 3) 취약 플러그인(구형 native_password) 사용 계정 확인
SELECT user, host FROM mysql.user WHERE plugin='mysql_native_password';

-- 4) 강제 TLS(SSL) 필요 여부(예: 권한 조회)
SHOW GRANTS FOR 'app'@'10.10.%';
-- 출력에 REQUIRE SSL 포함 확인
```
- **기본 인증 플러그인**: `caching_sha2_password` 사용 권장(드라이버 호환성 확인).
- **패스워드 정책**: `validate_password` 컴포넌트로 길이/복잡도/사용자명 포함여부 등을 강제.

### 권한 최소화(Dynamic Privileges 포함)

- `SHOW GRANTS FOR 'user'@'host';` 로 과권한 식별, **스키마 단위 최소 권한** 부여.
- `DEFINER`가 `root@%` 인 뷰/프로시저 제거/수정(권한 상승 경로).

### 네트워크/접속 경로

- 방화벽/보안그룹으로 3306 **허용 IP 최소화**.
- MySQL 설정:
```ini
[mysqld]
# 원격 노출 통제

bind-address=0.0.0.0     # (필요 시 제한 IP로)
require_secure_transport=ON
```
> **보안 연결 강제**를 통해 평문 접속 금지.

### “취약 설정” 점검 포인트

```sql
-- 1) LOAD DATA LOCAL 위험 여부 확인
SHOW VARIABLES LIKE 'local_infile';      -- 기대값: OFF

-- 2) 파일 입출력 제한 디렉토리(권장: 특정 경로/NULL)
SHOW VARIABLES LIKE 'secure_file_priv';  -- 기대: /var/lib/mysql-files 또는 NULL

-- 3) TLS 버전/암호군
SHOW VARIABLES LIKE 'tls_version';
SHOW STATUS LIKE 'Ssl_cipher';

-- 4) 로깅(오류/슬로우)
SHOW VARIABLES LIKE 'log_error_verbosity';
SHOW VARIABLES LIKE 'slow_query_log';
```
- `LOAD DATA LOCAL INFILE`는 **클라이언트 측 파일 유출** 위험이 있으므로 기본 **OFF** 권장.
- `secure_file_priv`로 파일 입출력을 **특정 디렉토리로 제한**.

(수정 예시)
```ini
[mysqld]
local_infile=OFF
secure_file_priv=/var/lib/mysql-files
```

### 로깅/감사(Audit)

- **엔터프라이즈**: `audit_log` 플러그인 기반 **MySQL Enterprise Audit**로 접속/쿼리 활동 감사(정책 기반).
- **커뮤니티**: 일반 로그는 성능 비용 높음 → **필요 시 한시적** 활성화. MariaDB `server_audit` 대안 검토(제품 혼동 주의).

### 백업·복구

- **암호화 백업**(Enterprise Backup) 또는 **외부 암호화**(GPG/볼륨 단). 복구 테스트는 분리된 환경에서 **주기적** 수행.

### 운영 자동점검 스크립트(샘플)

```bash
#!/usr/bin/env bash
# mysql-audit-lite.sh : 필수 보안 변수/계정 상태 점검

MYSQL="mysql -N -B -uroot -p'$MYSQL_PWD'"

echo "[*] Version"
$MYSQL -e "select @@version, @@version_comment;"

echo "[*] TLS"
$MYSQL -e "show variables like 'require_secure_transport';"
$MYSQL -e "show variables like 'tls_version';"

echo "[*] Local infile / secure_file_priv"
$MYSQL -e "show variables like 'local_infile';"
$MYSQL -e "show variables like 'secure_file_priv';"

echo "[*] Users (plugin/lock/expire)"
$MYSQL -e "select user,host,plugin,account_locked,password_expired from mysql.user order by user,host;"

echo "[*] Remote root"
$MYSQL -e "select user,host from mysql.user where user='root' and host not in ('localhost','127.0.0.1','::1');"
```

---

## 실전 시나리오

### 시나리오 A — “민감고객 테이블 암호화 + 애플리케이션 조회”

1) 테이블 암호화 활성(2.1).
2) 민감 필드(휴대폰/이메일)는 앱단 **AES-256-GCM/CBC**로 암호화 후 저장.
3) 검색은 **HMAC(email)** 보조 인덱스 컬럼으로 처리(정확 일치).

### 시나리오 B — “TLS 강제 + 계정 SSL 필수”

```sql
ALTER USER 'report'@'10.20.%' REQUIRE SSL;
```
애플리케이션 커넥터에 **CA/클라 인증서 경로** 반영. 실패 시 **명확한 런북** 제공(드라이버 업데이트/옵션).

### 시나리오 C — “LOCAL INFILE 위험 차단”

- 서버:
```ini
[mysqld]
local_infile=OFF
secure_file_priv=/var/lib/mysql-files
```
- 점검:
```sql
SHOW VARIABLES LIKE 'local_infile';
```
> `LOCAL INFILE`은 웹서버-DB 패턴에서 **웹서버 파일 유출** 트릭이 가능, 불가피 시 전용 디렉토리+권한 최소화.

---

## MySQL 보안 베이스라인(my.cnf 예시)

```ini
[mysqld]
# 네트워크

bind-address=0.0.0.0
require_secure_transport=ON
tls_version=TLSv1.2,TLSv1.3
ssl_ca=/etc/mysql/ssl/ca.pem
ssl_cert=/etc/mysql/ssl/server-cert.pem
ssl_key=/etc/mysql/ssl/server-key.pem

# 파일/로컬 입출력

local_infile=OFF
secure_file_priv=/var/lib/mysql-files

# InnoDB 암호화/로그 암호화(필요 시)

early-plugin-load-add=component_keyring_encrypted_file
component_keyring_encrypted_file.file_data=/var/lib/mysql/keyring/keyring_encrypted
innodb_undo_log_encrypt=ON
innodb_redo_log_encrypt=ON

# 로깅

slow_query_log=ON
log_error_verbosity=2

# 기타

sql_safe_updates=ON
```

---

## 점검 보고서 템플릿(요지)

- **환경/버전**: 예) MySQL 8.4.6 LTS(Community/Enterprise)
- **At-Rest**: TDE(테이블스페이스/로그) 적용 여부, Keyring/KMS, 키수명주기.
- **In-Transit**: `require_secure_transport`, TLS 버전/암호군, 사용자 `REQUIRE SSL` 비율.
- **계정/정책**: 플러그인(`caching_sha2_password`), `validate_password` 정책 값, 만료/락.
- **설정 취약점**: `local_infile`, `secure_file_priv` 상태와 보완계획.
- **감사/로깅**: Enterprise Audit/대체 수단 여부.
- **조치안**: 단기(설정 변경), 중기(키관리·TLS 재발급 자동화), 장기(애플리케이션 계층 암호화/토큰화).

---

## 부록 A. 유용 SQL 스니펫 모음

```sql
-- TLS 필수 위반 접속 시도 탐지(에러로그 모니터링이 더 정확)
SHOW VARIABLES LIKE 'require_secure_transport';

-- validate_password 현재 정책
SHOW VARIABLES LIKE 'validate_password.%';

-- 계정별 인증 플러그인/락/만료
SELECT user, host, plugin, account_locked, password_expired
FROM mysql.user ORDER BY user, host;

-- 광범위 호스트 사용 계정
SELECT user, host FROM mysql.user WHERE host='%';

-- 파일 입출력 범위
SHOW VARIABLES LIKE 'secure_file_priv';

-- 로컬 로딩 위험
SHOW VARIABLES LIKE 'local_infile';

-- TLS 버전/현재 암호군
SHOW VARIABLES LIKE 'tls_version';
SHOW STATUS LIKE 'Ssl_cipher';
```

---

## 부록 B. 간단 Python 점검(드라이버 예: mysql-connector-python)

```python
import mysql.connector, json
cn = mysql.connector.connect(user='auditor', password='***', host='127.0.0.1', database='mysql', ssl_disabled=False)
cur = cn.cursor()

def q(sql): cur.execute(sql); return cur.fetchall()

report = {
  "require_secure_transport": q("SHOW VARIABLES LIKE 'require_secure_transport';"),
  "tls_version": q("SHOW VARIABLES LIKE 'tls_version';"),
  "local_infile": q("SHOW VARIABLES LIKE 'local_infile';"),
  "secure_file_priv": q("SHOW VARIABLES LIKE 'secure_file_priv';"),
  "users": q("SELECT user,host,plugin,account_locked,password_expired FROM mysql.user ORDER BY user,host;")
}
print(json.dumps(report, indent=2, default=str))
```

---

## 참고(핵심 변경·권고 출처)

- **8.4 LTS/변경 사항**: 8.4 릴리스 노트(키링 관련 변경 포함).
- **TDE/Keyring/KMS**: InnoDB Data-at-Rest Encryption, Enterprise TDE 설명, `keyring_okv`/`keyring_aws`.
- **TLS 강제/설정**: `require_secure_transport`와 암호화 연결 가이드.
- **LOCAL INFILE 보안**: 보안 고려사항(공식 매뉴얼/사고 사례 논의).
- **Enterprise Audit**: 정책 기반 감사 플러그인.
- **암호정책 컴포넌트**: `validate_password`(컴포넌트) 설치·튜닝.

---

### 마무리 체크리스트(요약)

- [ ] **At-Rest**: 테이블스페이스/Redo/Undo 암호화, 8.4 **Component Keyring** 적용·문서화.
- [ ] **In-Transit**: `require_secure_transport=ON`, 계정 `REQUIRE SSL`, TLS 1.2/1.3만 허용.
- [ ] **계정/정책**: `caching_sha2_password` 기본, `validate_password` 가동(길이≥14, 복잡도).
- [ ] **설정 취약점**: `local_infile=OFF`, `secure_file_priv` 특정 디렉터리.
- [ ] **감사/로깅**: Enterprise Audit 정책/보존주기, 일반/슬로우 로그 튜닝.
- [ ] **백업**: 암호화 인지 백업·복구 테스트(주기).

이 문서는 **실전 운영 관점**에서 최신 MySQL(특히 8.4 LTS)의 **암호화와 보안 설정**을 한 번에 점검·적용할 수 있도록 구성했다. 프로젝트/시험 대비용으로 그대로 체크리스트화해도 무방하며, 환경별(온프레미스·클라우드·RDS)로는 **KMS/키링 구현과 TLS 배포 자동화**만 차이를 반영하면 된다.
