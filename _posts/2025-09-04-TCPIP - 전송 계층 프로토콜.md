---
layout: post
title: TCPIP - 전송 계층 프로토콜
date: 2025-09-04 14:25:23 +0900
category: TCPIP
---
# TCP/IP 전송 계층 프로토콜

## 전송 제어 프로토콜(TCP)과 사용자 데이터그램 프로토콜(UDP)

### TCP와 UDP 개요 및 TCP/IP에서의 역할
TCP/IP 프로토콜 스택에서 전송 계층(4계층)은 네트워크 계층(3계층)과 응용 프로그램 계층(7계층) 사이의 중요한 가교 역할을 합니다. 이 계층에서 작동하는 두 개의 주요 프로토콜—TCP와 UDP—은 근본적으로 다른 서비스 모델을 제공하며, 각각 특정 유형의 네트워크 통신에 최적화되어 있습니다.

**TCP(Transmission Control Protocol)** 는 **연결 지향적**이고 **신뢰성 있는** 전송 서비스를 제공합니다. 이는 마치 등기 우편과 유사하여, 메시지가 순서대로 정확하게 전달됨을 보장합니다. TCP는 데이터 손실, 중복, 순서 바뀜 등의 문제를 자동으로 감지하고 복구합니다.

**UDP(User Datagram Protocol)** 는 **비연결형**이고 **최소한의 오버헤드**로 작동하는 간단한 프로토콜입니다. 이는 일반 우편과 유사하여, 신속한 배달을 우선시하지만 전달을 보장하지는 않습니다. UDP는 실시간 응용 프로그램이나 단순한 질의-응답 통신에 적합합니다.

```
TCP와 UDP의 개념적 비교
+--------------------+----------------------+----------------------+
| 특성               | TCP                  | UDP                  |
+--------------------+----------------------+----------------------+
| 연결 방식          | 연결 지향            | 비연결형             |
| 신뢰성             | 높음 (재전송, 확인) | 낮음 (최선형 전달)   |
| 순서 보장          | 예                   | 아니오               |
| 흐름 제어          | 예                   | 아니오               |
| 혼잡 제어          | 예                   | 아니오               |
| 헤더 크기          | 20바이트 이상        | 8바이트 고정         |
| 전송 속도          | 상대적으로 느림     | 빠름                 |
| 주요 응용 분야     | 웹, 이메일, 파일 전송| DNS, 음성/영상, 게임 |
+--------------------+----------------------+----------------------+
```

## TCP/IP 전송 계층 프로토콜 주소 체계: 포트와 소켓

### TCP/IP 프로세스, 다중화 및 클라이언트/서버 응용 프로그램 역할
단일 컴퓨터 시스템에서 수백 개의 네트워크 응용 프로그램이 동시에 실행될 수 있습니다. 전송 계층의 핵심 역할 중 하나는 여러 응용 프로그램 간의 트래픽을 **다중화(Multiplexing)** 하고 **역다중화(Demultiplexing)** 하는 것입니다.

**다중화 과정**:
```
시스템 내 다양한 응용 프로그램
       ↓
전송 계층에서 포트 번호 할당
       ↓
모든 데이터가 IP 계층을 통해 단일 네트워크 연결로 통합
       ↓
원격 시스템으로 전송
```

**역다중화 과정**:
```
수신된 네트워크 패킷
       ↓
전송 계층에서 포트 번호 확인
       ↓
해당 포트를 수신 대기 중인 응용 프로그램으로 전달
       ↓
각 응용 프로그램이 자신의 데이터 처리
```

이 메커니즘은 **클라이언트/서버 모델**에 기반합니다:
- **서버**: 특정 포트에서 계속적으로 연결 요청을 수신 대기
- **클라이언트**: 서버에 연결하여 서비스를 요청하고 일시적 포트 사용

## TCP/IP 포트: 전송 계층 주소 체계

### 포트의 개념적 이해
포트는 16비트 정수(0~65535)로 표현되며, 컴퓨터 내 특정 프로세스나 서비스를 식별하는 논리적 단위입니다. IP 주소가 "아파트 건물"을 식별한다면, 포트 번호는 "특정 호실"을 지정하는 것에 비유할 수 있습니다.

```
포트 주소 체계 비유
+----------------+----------------+------------------------+
| 계층           | 비유           | 설명                   |
+----------------+----------------+------------------------+
| IP 주소        | 아파트 건물    | 특정 컴퓨터 시스템     |
| 포트 번호      | 호실 번호      | 특정 응용 프로그램     |
| 소켓           | 정확한 주소    | IP:포트 조합           |
+----------------+----------------+------------------------+
```

### 포트 번호 범주화
포트 번호는 IANA(Internet Assigned Numbers Authority)에 의해 세 가지 범주로 체계화되어 관리됩니다:

## TCP/IP 응용 프로그램 할당 및 서버 포트 번호 범위: 웰노운, 등록됨, 동적/사설 포트

### 1. 웰노운 포트(Well-Known Ports): 0-1023
시스템 서비스와 주요 네트워크 응용 프로그램을 위해 예약된 포트입니다. 이러한 포트를 사용하려면 시스템 수준의 권한(루트/관리자)이 일반적으로 필요합니다.

**주요 웰노운 포트 예시**:
```
+--------+---------------------+---------------------------+---------------------------+
| 포트   | 프로토콜           | 서비스 이름               | 설명                      |
+--------+---------------------+---------------------------+---------------------------+
| 20/21  | FTP                 | File Transfer Protocol    | 파일 전송 (데이터/제어)   |
| 22     | SSH                 | Secure Shell             | 안전한 원격 접속          |
| 23     | Telnet              | Telnet                    | 원격 터미널 접속          |
| 25     | SMTP                | Simple Mail Transfer      | 이메일 전송               |
| 53     | DNS                 | Domain Name System        | 도메인 이름 해석          |
| 80     | HTTP                | Hypertext Transfer        | 웹 페이지 전송            |
| 110    | POP3                | Post Office Protocol v3   | 이메일 수신               |
| 143    | IMAP                | Internet Message Access   | 이메일 관리               |
| 443    | HTTPS               | HTTP Secure               | 암호화된 웹 통신          |
| 3389   | RDP                 | Remote Desktop Protocol   | 원격 데스크톱             |
+--------+---------------------+---------------------------+---------------------------+
```

### 2. 등록된 포트(Registered Ports): 1024-49151
일반 응용 프로그램과 서비스가 IANA에 등록하여 사용하는 포트 범위입니다. 벤더나 조직이 특정 응용 프로그램을 위해 공식적으로 등록할 수 있습니다.

**주요 등록 포트 예시**:
```
+--------+---------------------+---------------------------+---------------------------+
| 포트   | 프로토콜/응용 프로그램 | 서비스 이름             | 설명                      |
+--------+---------------------+---------------------------+---------------------------+
| 1433   | MS-SQL              | Microsoft SQL Server      | 데이터베이스 서비스       |
| 1521   | Oracle DB           | Oracle Database           | 데이터베이스 서비스       |
| 1723   | PPTP                | Point-to-Point Tunneling  | VPN 터널링                |
| 3306   | MySQL               | MySQL Database            | 데이터베이스 서비스       |
| 3389   | RDP                 | Remote Desktop            | 윈도우 원격 데스크톱      |
| 5060   | SIP                 | Session Initiation        | VoIP 시그널링            |
| 5432   | PostgreSQL          | PostgreSQL Database       | 데이터베이스 서비스       |
| 8080   | HTTP-Alt            | HTTP Alternative          | 대체 웹 서버 포트         |
+--------+---------------------+---------------------------+---------------------------+
```

### 3. 동적/사설 포트(Dynamic/Private Ports): 49152-65535
클라이언트 측에서 임시로 사용하기 위한 포트로, **임시 포트(Ephemeral Ports)** 라고도 불립니다. 운영체제가 클라이언트 응용 프로그램에 동적으로 할당하며, 세션이 종료되면 재사용됩니다.

**역사적 변화**:
- **전통적**: 1024-5000 범위를 임시 포트로 사용
- **현대적**: RFC 6056에 따라 49152-65535를 권장 (보안 및 예측 가능성 향상)

## TCP/IP 클라이언트(임시) 포트와 클라이언트/서버 응용 프로그램 포트 사용

### 클라이언트-서버 상호작용 모델
네트워크 통신에서 포트 사용은 엄격한 규칙을 따릅니다:

```
전형적인 HTTP 연결 설정 과정
[클라이언트]                             [서버]
IP: 192.168.1.100                     IP: 203.0.113.50
     |                                      |
     |--- SYN 패킷 ------------------------>|
     | 소스 포트: 54321 (임시)              |
     | 목적지 포트: 80 (웰노운)             |
     |                                      |
     |<- SYN-ACK 패킷 ----------------------|
     | 소스 포트: 80                        |
     | 목적지 포트: 54321                   |
     |                                      |
     |--- ACK 패킷 ------------------------>|
     | 연결 확립                            |
     |                                      |
데이터 교환 시작
```

### 임시 포트 할당 메커니즘
운영체제는 클라이언트 포트 할당을 위해 다양한 알고리즘을 사용합니다:

1. **순차적 할당**: 이전 포트 번호에서 순차 증가
2. **임의 할당**: 보안 강화를 위한 무작위 선택
3. **범위 기반 할당**: 특정 범위 내에서만 할당

**현대 운영체제의 할당 정책**:
```bash
# 리눅스 시스템의 임시 포트 범위 확인
$ cat /proc/sys/net/ipv4/ip_local_port_range
32768   60999

# Windows 시스템 확인 (PowerShell)
> netsh int ipv4 show dynamicport tcp
```

## TCP/IP 소켓과 소켓 쌍: 프로세스와 연결 식별

### 소켓의 기본 개념
소켓은 네트워크 통신의 종단점(endpoint)으로, IP 주소와 포트 번호의 조합으로 정의됩니다. 소켓 프로그래밍 인터페이스는 응용 프로그램이 네트워크 통신을 할 수 있게 하는 API입니다.

**소켓 주소 형식**:
```
IPv4 소켓: [IPv4 주소]:[포트 번호]
예: 192.168.1.100:54321

IPv6 소켓: [IPv6 주소]:[포트 번호]
예: [2001:0db8::1]:80
```

### 소켓 쌍과 연결 식별
TCP 연결은 두 개의 소켓으로 구성된 **소켓 쌍**에 의해 고유하게 식별됩니다:

```
TCP 연결의 고유 식별자
{로컬 IP, 로컬 포트, 원격 IP, 원격 포트}

예시 연결:
로컬 소켓:  192.168.1.100:54321
원격 소켓:  203.0.113.50:80

고유 식별: {192.168.1.100, 54321, 203.0.113.50, 80}
```

이 4개의 값이 모두 동일한 두 연결은 존재할 수 없습니다. 이 원리는 다음과 같은 시나리오를 가능하게 합니다:

```
동일 서버에 대한 다중 클라이언트 연결
클라이언트 A: {192.168.1.100, 54321, 203.0.113.50, 80}
클라이언트 B: {192.168.1.100, 54322, 203.0.113.50, 80}
클라이언트 C: {192.168.1.101, 54321, 203.0.113.50, 80}
→ 모든 연결이 고유하게 식별됨
```

### 소켓 상태와 라이프사이클
TCP 소켓은 연결 수명 주기 동안 다양한 상태를 거칩니다:

```
TCP 소켓 상태 다이어그램
+-----------+     +-----------+     +-----------+
| CLOSED    |---->| LISTEN    |---->| SYN_RCVD  |
+-----------+     +-----------+     +-----------+
     |                 |                 |
     |                 |                 |
     v                 v                 v
+-----------+     +-----------+     +-----------+
| SYN_SENT  |---->| ESTABLISHED |-->| FIN_WAIT_1 |
+-----------+     +-----------+     +-----------+
                       |
                       v
              +-----------+     +-----------+
              | CLOSE_WAIT|---->| LAST_ACK  |
              +-----------+     +-----------+
```

## 일반적인 TCP/IP 응용 프로그램과 할당된 웰노운 및 등록 포트 번호

### 포트 번호 체계의 실무적 적용

#### 인터넷 인프라 서비스
```
핵심 인터넷 서비스 포트 맵
                   +-----------------+
                   |    DNS (53)     |
                   |  UDP/TCP        |
                   +--------+--------+
                            |
    +-----------------------+-----------------------+
    |                       |                       |
+-------+-----+       +-----+-------+         +-----+-------+
|  SMTP (25)  |       |   HTTP (80) |         |   FTP (21)  |
|  TCP        |       |   TCP       |         |   TCP       |
+-------------+       +-------------+         +-------------+
    |                       |                       |
+-------+-----+       +-----+-------+         +-----+-------+
|  POP3 (110) |       | HTTPS (443) |         | FTP-D (20)  |
|  TCP        |       |   TCP       |         |   TCP       |
+-------------+       +-------------+         +-------------+
```

#### 데이터베이스 서비스
```
주요 데이터베이스 포트 할당
+----------------+-----------+------------------+------------------------+
| 데이터베이스   | 기본 포트 | 프로토콜        | 비고                   |
+----------------+-----------+------------------+------------------------+
| MySQL          | 3306      | TCP              | 가장 인기 있는 오픈소스 |
| PostgreSQL     | 5432      | TCP              | 고급 기능의 오픈소스   |
| Oracle DB      | 1521      | TCP              | 엔터프라이즈 데이터베이스|
| Microsoft SQL  | 1433      | TCP              | 윈도우 환경 표준      |
| MongoDB        | 27017     | TCP              | 문서 지향 NoSQL       |
| Redis          | 6379      | TCP              | 인메모리 키-값 저장소  |
| Elasticsearch  | 9200      | HTTP/TCP         | 검색 및 분석 엔진     |
+----------------+-----------+------------------+------------------------+
```

#### 클라우드 및 컨테이너 환경
현대 클라우드와 컨테이너 환경에서는 포트 사용이 더욱 동적이고 복잡해졌습니다:

```yaml
# 쿠버네티스 서비스 정의 예시
apiVersion: v1
kind: Service
metadata:
  name: web-service
spec:
  ports:
  - port: 80        # 서비스가 노출하는 포트
    targetPort: 8080 # 파드 내에서 실제 작동하는 포트
    protocol: TCP
  selector:
    app: web-app
```

#### 보안 관점의 포트 관리
포트 번호는 네트워크 보안의 1차적 방어선 역할을 합니다:

**방화벽 규칙 예시**:
```bash
# 웹 서버만 허용하는 iptables 규칙
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -j DROP  # 그 외 모든 연결 차단

# SSH 접속 제한 (특정 IP만 허용)
iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 22 -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j DROP
```

### 포트 스캐닝과 네트워크 진단
포트 스캐닝은 네트워크 보안 평가와 문제 해결에 필수적인 도구입니다:

```bash
# 일반적인 nmap 스캔 명령어
nmap -sS -p 1-1000 192.168.1.1     # SYN 스캔 (기본 포트 범위)
nmap -sU -p 53,67,68,123,161 192.168.1.1  # UDP 포트 스캔
nmap -sV -p 80,443 192.168.1.1     # 버전 감지 스캔
nmap -O 192.168.1.1                # 운영체제 감지
```

## 결론

TCP/IP 전송 계층의 포트와 소켓 체계는 인터넷 통신의 근간을 이루는 정교한 주소 지정 시스템입니다. 이 체계는 단순하면서도 강력한 디자인으로, 수십 년 동안 인터넷의 폭발적 성장을 지탱해왔습니다. 16비트 포트 공간(65,536개 포트)은 놀랍도록 효율적으로 관리되어, 웰노운 포트의 안정성, 등록 포트의 유연성, 임시 포트의 동적 특성이 완벽한 조화를 이루고 있습니다.

포트 번호 체계의 진정한 가치는 그 **보편성**과 **일관성**에 있습니다. 전 세계 모든 시스템이 동일한 포트 번호로 동일한 서비스에 접근할 수 있다는 사실은 인터넷의 상호운용성을 보장하는 핵심 요소입니다. 또한 소켓 개념은 네트워크 프로그래밍을 추상화하여, 개발자가 복잡한 네트워크 프로토콜보다는 응용 프로그램 로직에 집중할 수 있게 했습니다.

현대 네트워크 환경에서는 포트 사용이 더욱 동적이고 복잡해지고 있습니다. 컨테이너 오케스트레이션, 서버리스 아키텍처, 동적 포트 매핑 등 새로운 기술들이 기존 포트 체계에 새로운 도전을 제시하고 있습니다. 그러나 이러한 변화 속에서도 기본적인 포트와 소켓의 개념은 변함없이 유지되고 있으며, 새로운 기술들은 대부분 이 기본 체계 위에 구축되고 있습니다.

네트워크 전문가에게 포트와 소켓의 깊은 이해는 필수 불가결한 역량입니다. 이는 단순한 기술적 지식을 넘어, 네트워크 트래픽의 흐름을 시각화하고, 문제를 진단하며, 보안 정책을 설계하는 기초가 됩니다. 80번 포트가 HTTP를 의미하는 것처럼 간단한 사실에서부터, 소켓 쌍이 연결을 고유하게 식별하는 복잡한 메커니즘에 이르기까지, 이 체계는 인터넷이 작동하는 방식을 이해하는 열쇠입니다.