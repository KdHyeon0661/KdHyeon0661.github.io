---
layout: post
title: 네트워크보안 - 장비/플랫폼별 보안 템플릿
date: 2025-11-03 22:25:23 +0900
category: 네트워크보안
---
# B. 장비/플랫폼별 보안 템플릿(스위치 · 라우터 · 프록시 · 방화벽 · Kubernetes)

> 목표
> - 핵심 인프라(스위치/라우터/프록시/방화벽/K8s)에 즉시 적용 가능한 **보안 베이스라인 템플릿**을 제공한다.
> - “**기본 거부(Deny-by-default)** → **업무 플로우 허용** → **관측 및 자동화**” 순서를 일관되게 적용한다.
> - 각 장비/플랫폼별로 **구성 예제**, **검증 방법(명령/쿼리)**, **운영 체크리스트**, **오류나 충돌 시 디버깅 포인트**를 포함한다.
> ⚠️ 실제 반영 전, **승인/변경관리/CAB**, **롤백 계획**을 반드시 마련하고 **스테이징→카나리** 절차로 배포할 것.

---

## 1. 스위치(Switch): 액세스/엣지 L2 보안 템플릿

### 1.1 설계 원칙
- 포트별 **역할 기반 템플릿**: `USER`, `VOICE`, `IOT`, `TRUNK`, `DC-Uplink` 등 클래스화.
- **802.1X(MAB 백업)** + **Guest VLAN**로 미인증 단말 격리.
- **DHCP Snooping → DAI(동적 ARP 검사) → IP Source Guard** 3종 세트.
- **STP 보호**(BPDU Guard/Root Guard), **Storm Control**, **Port Security**(MAC 갯수 제한).
- 관리면: **SSHv2**, **SNMPv3**, **전용 관리 VLAN**, **RADIUS/TACACS+**, **Syslog/NTP**.

### 1.2 Cisco IOS-XE/Classic 예제
```cisco
! --- 공통(장비) ---
hostname SW-ACC-01
ip domain-name corp.local
no ip http server
no ip http secure-server
service password-encryption
!
! AAA & 관리자
aaa new-model
aaa authentication login default group radius local
aaa authorization exec default group radius local if-authenticated
radius server R1
 address ipv4 10.10.60.11 auth-port 1812 acct-port 1813
 key 7 0822455D0A16
!
! 관리 인터페이스 / 원격접속
interface Vlan60
 description MGMT
 ip address 10.10.60.21 255.255.255.0
 ip access-group ACL-MGMT in
!
ip access-list standard ACL-MGMT
 permit 10.10.60.0 0.0.0.255
 deny   any log
!
ip ssh version 2
ip ssh source-interface Vlan60
line vty 0 4
 transport input ssh
 login authentication default
!
! 시간/로그
ntp server 10.10.60.10
logging host 10.10.70.20
logging trap warnings
!
! DHCP Snooping / DAI / IP Source Guard
ip dhcp snooping
ip dhcp snooping vlan 10,20,50
no ip dhcp snooping information option
!
ip arp inspection vlan 10,20
!
! 트렁크(Uplink)는 TRUST
interface Gig1/0/49
 description UPLINK-CORE
 switchport trunk encapsulation dot1q
 switchport mode trunk
 ip dhcp snooping trust
 ip arp inspection trust
 spanning-tree portfast trunk
 spanning-tree guard root
!
! 액세스 포트 템플릿 (유저)
define interface-range USER_RANGE Gig1/0/1 - 24
 interface range USER_RANGE
  description USER-ACCESS
  switchport mode access
  switchport access vlan 10
  authentication port-control auto
  mab
  dot1x pae authenticator
  spanning-tree portfast
  spanning-tree bpduguard enable
  storm-control broadcast level 2.00
  storm-control multicast level 2.00
  storm-control action shutdown
  ip verify source
  ip arp inspection limit rate 30
  switchport port-security
  switchport port-security maximum 2
  switchport port-security violation restrict
!
! 게스트 VLAN(미인증)
aaa authorization network default group radius
dot1x system-auth-control
interface range USER_RANGE
 authentication event fail action authorize vlan 50
 authentication event server dead action authorize vlan 50
!
! 음성 VLAN(옵션)
interface Gig1/0/25
 switchport mode access
 switchport access vlan 10
 switchport voice vlan 40
 spanning-tree portfast
 spanning-tree bpduguard enable
!
! STP
spanning-tree mode rapid-pvst
spanning-tree portfast default
spanning-tree extend system-id
```

#### 검증(운영 커맨드)
```cisco
show ip dhcp snooping binding
show ip arp inspection statistics
show authentication sessions interface gi1/0/10 details
show spanning-tree inconsistentports
show logging
```

### 1.3 Juniper EX 예제(요약)
```juniper
system {
  services { ssh; netconf { ssh; } }
  syslog { host 10.10.70.20 any any; }
  ntp { server 10.10.60.10; }
}
interfaces {
  ge-0/0/1 {
    unit 0 {
      family ethernet-switching {
        port-mode access;
        vlan { members VLAN10; }
        storm-control { level 2; }
      }
    }
  }
}
ethernet-switching-options {
  secure-access-port {
    interface ge-0/0/1 {
      mac-limit 2 action drop-and-log;
      sticky-entries;
    }
  }
}
protocols {
  rstp { interface all; }
  lldp { interface all; }
}
```

### 1.4 체크리스트
- [ ] 802.1X+MAB, Guest VLAN
- [ ] DHCP Snooping/DAI/IPSG
- [ ] STP 보호(BPDU/Root Guard), Storm Control
- [ ] 관리면 분리(관리 VLAN/ACL), SSH/SNMPv3, Syslog/NTP

---

## 2. 라우터(Router): L3 경계/코어 보안 템플릿

### 2.1 원칙
- **uRPF**(Strict/Loose)으로 스푸핑 억제, **ICMP rate-limit**로 제어면 보호.
- **BGP 보안**: TTL-Security, Prefix/AS-PATH 필터, **Max-Prefix**, **RPKI(ROA/RTR)**, Graceful Restart/Route Dampening.
- **RTBH/Flowspec**으로 DDoS 대응 경로, **NetFlow/IPFIX**로 가시성.
- 관리면: **CTL Plane Policing(CoPP)**, SSH, AAA, 분리된 관리 VRF.

### 2.2 Cisco IOS-XE BGP 경계 예제
```cisco
! 관리 VRF
vrf definition MGMT
 rd 65000:60
!
interface Gig0/0
 description INTERNET
 ip address 203.0.113.2 255.255.255.252
 ip verify unicast source reachable-via rx  ! uRPF strict
!
ip icmp rate-limit unreachable 1000
!
! CoPP (간단)
class-map match-any CONTROL-PLANE
 match protocol ssh
 match protocol snmp
!
policy-map CONTROL-PLANE-POLICY
 class CONTROL-PLANE
  police 128000 conform-action transmit exceed-action drop
 class class-default
  police 64000 conform-action transmit exceed-action drop
!
control-plane
 service-policy input CONTROL-PLANE-POLICY
!
! BGP
router bgp 65000
 bgp log-neighbor-changes
 neighbor 198.51.100.1 remote-as 64501
 neighbor 198.51.100.1 description TRANSIT-A
 neighbor 198.51.100.1 ebgp-multihop 2
 neighbor 198.51.100.1 ttl-security hops 2
 neighbor 198.51.100.1 update-source Gig0/0
 !
 address-family ipv4
  neighbor 198.51.100.1 activate
  neighbor 198.51.100.1 route-map OUT-FILTER out
  neighbor 198.51.100.1 maximum-prefix 50000 90 restart 5
  network 203.0.113.0 mask 255.255.255.0
 exit-address-family
!
ip prefix-list ALLOW-OUT seq 10 permit 203.0.113.0/24
route-map OUT-FILTER permit 10
 match ip address prefix-list ALLOW-OUT
 set community 65000:100 additive
route-map OUT-FILTER deny 100
!
! RTBH(블랙홀 커뮤니티)
ip route 192.0.2.0 255.255.255.0 Null0 tag 666
```

### 2.3 RPKI/RTR(개념)
- 라우터에 RTR 세션을 구성하여 Valid/Invalid/Unknown 라우트 태그 후 `Invalid drop`.

```cisco
bgp rpki server tcp 10.10.90.9 port 3323 refresh 600
bgp bestpath origin-as use validity
route-map IN-FILTER deny 5
 match rpki invalid
```

### 2.4 NetFlow/IPFIX(요약)
```cisco
ip flow-export destination 10.10.70.30 2055
ip flow-export version 9
interface Gig0/0
 ip flow ingress
 ip flow egress
```

### 2.5 체크리스트
- [ ] uRPF/CoPP/ICMP rate-limit
- [ ] BGP TTL-Sec/Prefix-Filter/Max-Prefix/RPKI
- [ ] RTBH/Flowspec 경로
- [ ] NetFlow/IPFIX + 중앙 수집

---

## 3. 프록시(Proxy): 리버스/포워드, WAF/캐시/접근제어 템플릿

### 3.1 원칙
- 외부 노출은 **리버스 프록시**(Nginx/Envoy/HAProxy) 앞단에 **WAF(ModSecurity/클라우드 WAF)**.
- 내부 사용자는 **인증 프록시**(SSO/OIDC) + **카테고리 필터/DLP/안티멀웨어**.
- **TLS 1.2+**, HSTS, 보안 헤더(CSP/XFO/X-Content-Type-Options/Referrer-Policy).
- **업로드 제한/확장자 제한/콘텐츠 검사**(ICAP) + **캐시 정책**(정적만).

### 3.2 Nginx 리버스 프록시 + 보안 헤더
```nginx
# /etc/nginx/conf.d/app.conf
map $request_method $cacheable { default 0; GET 1; HEAD 1; }
server {
  listen 443 ssl http2;
  server_name app.example.com;

  # TLS (간략)
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers HIGH:!aNULL:!MD5;
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
  add_header X-Frame-Options DENY;
  add_header X-Content-Type-Options nosniff;
  add_header Referrer-Policy strict-origin-when-cross-origin;
  add_header Content-Security-Policy "default-src 'self'; frame-ancestors 'none'";

  # 업로드/메서드 제한
  client_max_body_size 10m;
  if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE)$) { return 405; }

  # WAF(모듈/별도 프록시 연계 권장)
  # modsecurity on; modsecurity_rules_file /etc/nginx/modsec/main.conf;

  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header X-Request-ID $request_id;
    proxy_read_timeout 15s;
    proxy_pass http://app-backend:8443;
  }

  # 캐시(정적만)
  location ~* \.(css|js|png|jpg|gif|ico)$ {
    proxy_cache STATIC;
    proxy_cache_valid 200 1h;
    expires 1h;
    proxy_pass http://app-backend:8443;
  }

  # 헬스체크
  location = /healthz { return 200; }
}
```

### 3.3 HAProxy(리버스) + mTLS(내부)
```haproxy
global
  log 127.0.0.1 local0
defaults
  mode http
  timeout connect 5s
  timeout client 30s
  timeout server 30s

frontend https-in
  bind :443 ssl crt /etc/haproxy/certs/fullchain.pem
  http-response set-header Strict-Transport-Security max-age=31536000;\ includeSubDomains
  http-response set-header X-Content-Type-Options nosniff
  http-response set-header X-Frame-Options DENY
  # 업로드 제한
  http-request deny if { req.body_size > 10485760 }
  default_backend app

backend app
  option httpchk GET /healthz
  server s1 10.10.20.30:8443 ssl verify required ca-file /etc/haproxy/ca.pem crt /etc/haproxy/mtls.pem
```

### 3.4 Squid(포워드 인증 프록시)
```squid
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
acl auth_users proxy_auth REQUIRED
http_access allow auth_users
# 카테고리/URL/DLP는 상용 솔루션/ICAP 권장
http_port 3128
maximum_object_size 10 MB
cache_mem 256 MB
cache_dir aufs /var/spool/squid 4096 16 256
logformat json %ts.%03tu %{X-Request-ID}>h %>a %<st %rm %ru %un
access_log stdio:/var/log/squid/access.log json
```

### 3.5 체크리스트
- [ ] TLS 1.2+/HSTS/보안 헤더
- [ ] 인증 프록시/SSO, 카테고리 필터, 업로드 제한
- [ ] 정적 캐시/원본 보호, 헬스체크
- [ ] 로깅(JSON/Request-ID) → SIEM

---

## 4. 방화벽(FW/NGFW): 존/정책·오브젝트 표준 + L4/L7 룰

### 4.1 원칙
- **존 기반 설계**: `USER`, `SERVER`, `DMZ`, `GUEST`, `MGMT`, `WAN`.
- **기본 거부**, **업무 플로우 기반 화이트리스트**.
- 오브젝트 표준: `OBJ_{ZONE}_{TYPE}_{DESC}` / 그룹: `GRP_{ZONE}_{APP}_{ENV}`.
- **히트 카운트**, **Shadow/중복 규칙** 정기 제거(운영 표준 29장에서 다룸).
- **IPS(서명) + App-ID**로 보완, HTTP/HTTPS는 **리버스 프록시/WAF**로 분리.

### 4.2 벤더 중립 정책 예(의사 표현)
```
# 기본 거부
rule 0000 DENY any:any -> any:any ANY log:enable

# User → Proxy (웹은 프록시만)
rule 0100 ALLOW user:10.10.10.0/24 -> proxy-lb:10.10.30.10 tcp 80,443 log

# Proxy → Internet (안티멀웨어/카테고리 통과 트래픽만)
rule 0110 ALLOW proxy-lb -> any tcp 80,443 profile:web_filter,antimalware log

# User → AD (Kerberos/LDAP/LDAPS/WinRM)
rule 0200 ALLOW user -> dc-group tcp 88,389,636,5985 log

# User → File (업무시간만)
rule 0210 ALLOW user -> file-srv tcp 445 schedule:BUSINESS_HOURS log

# DMZ ←→ Server (앱 경유)
rule 0300 ALLOW dmz-web -> app-srv tcp 8443
rule 0310 ALLOW app-srv -> db-srv tcp 5432
```

### 4.3 Linux Nftables 템플릿(간단)
```bash
#!/usr/bin/env bash
nft -f - <<'EOF'
flush ruleset
table inet filter {
  sets {
    srv_db = { type ipv4_addr; elements = { 10.10.20.30 } }
    user_net = { type ipv4_addr; elements = { 10.10.10.0/24 } }
  }
  chains {
    input {
      type filter hook input priority 0; policy drop;
      ct state established,related accept
      iifname "lo" accept
      tcp dport {22} ip saddr 10.10.60.0/24 accept   # 관리망만 SSH
      counter drop
    }
    forward {
      type filter hook forward priority 0; policy drop;
      ct state established,related accept
      ip saddr @user_net ip daddr 10.10.30.10 tcp dport {80,443} accept   # 프록시로만
      ip saddr @user_net ip daddr @srv_db tcp dport 5432 accept
      counter drop
    }
    output { type filter hook output priority 0; policy accept; }
  }
}
EOF
```

### 4.4 Suricata Inline(IPS) 연동(옵션)
```bash
# NFQUEUE로 트래픽 전달
iptables -I FORWARD -p tcp --dport 80 -j NFQUEUE --queue-num 0
suricata -q 0 -c /etc/suricata/suricata.yaml
```
- 룰은 “정책 위반/악성”만 차단하도록 최소화, 오탐 시 Fail-Open 전략 검토.

### 4.5 체크리스트
- [ ] 존/오브젝트 표준 네이밍
- [ ] 기본 거부 + 플로우 허용
- [ ] 프록시 경유 원칙(직접 인터넷 금지)
- [ ] 히트/Shadow/중복 정리 자동화
- [ ] IPS 최소 서명(정책 위반/악성), SIEM 연계

---

## 5. Kubernetes: 네트워크/ID/런타임 보안 템플릿

### 5.1 원칙
- **네임스페이스 분리**: `prod`, `stg`, `dev`, `ops` 등.
- **NetworkPolicy 기본 거부**(Ingress+Egress), **필요 플로우만 허용**.
- **Service Mesh(mTLS)**로 S2S 암호화 및 **인증/인가**(JWT/Spiffe).
- **Pod Security**(Baseline/Restricted), **RBAC 최소 권한**, **이미지 서명/스캔**, **비밀관리(KMS/CSI)**.

### 5.2 기본 거부 + 허용 예

**(1) Namespace별 기본 거부**
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: prod
  labels: { pod-security.kubernetes.io/enforce: "restricted" }
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata: { name: default-deny, namespace: prod }
spec:
  podSelector: {}
  policyTypes: ["Ingress","Egress"]
```

**(2) Ingress: Ingress Controller → backend 허용**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata: { name: allow-from-ingress, namespace: prod }
spec:
  podSelector: { matchLabels: { app: backend } }
  policyTypes: ["Ingress"]
  ingress:
  - from:
    - namespaceSelector: { matchLabels: { role: ingress } }
    ports: [{ protocol: TCP, port: 8443 }]
```

**(3) Egress: backend → db만 허용**
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata: { name: backend-egress-db, namespace: prod }
spec:
  podSelector: { matchLabels: { app: backend } }
  policyTypes: ["Egress"]
  egress:
  - to:
    - namespaceSelector: { matchLabels: { role: data } }
      podSelector: { matchLabels: { app: db } }
    ports: [{ protocol: TCP, port: 5432 }]
```

### 5.3 Service Mesh(mTLS + AuthZ) 예(Istio)
```yaml
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata: { name: default, namespace: prod }
spec:
  mtls: { mode: STRICT }
---
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata: { name: db-allow-from-backend, namespace: prod }
spec:
  selector: { matchLabels: { app: db } }
  rules:
  - from:
    - source:
        principals: ["spiffe://corp.local/ns/prod/sa/backend-sa"]
    to:
    - operation: { ports: ["5432"] }
```

### 5.4 RBAC 최소 권한
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata: { name: app-read-config, namespace: prod }
rules:
- apiGroups: [""]
  resources: ["configmaps","secrets"]
  verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata: { name: app-bind, namespace: prod }
subjects:
- kind: ServiceAccount
  name: backend-sa
roleRef:
  kind: Role
  name: app-read-config
  apiGroup: rbac.authorization.k8s.io
```

### 5.5 Pod 보안/런타임
```yaml
apiVersion: apps/v1
kind: Deployment
metadata: { name: backend, namespace: prod }
spec:
  replicas: 3
  selector: { matchLabels: { app: backend } }
  template:
    metadata: { labels: { app: backend } }
    spec:
      serviceAccountName: backend-sa
      securityContext: { runAsNonRoot: true, fsGroup: 2000 }
      containers:
      - name: app
        image: registry.corp/backend:1.2.3
        securityContext:
          readOnlyRootFilesystem: true
          allowPrivilegeEscalation: false
          capabilities: { drop: ["ALL"] }
        resources:
          requests: { cpu: "100m", memory: "256Mi" }
          limits:   { cpu: "500m", memory: "512Mi" }
        envFrom:
        - secretRef: { name: app-secrets }
```

### 5.6 Ingress 보안(헤더/크기/메서드 제한)
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app
  namespace: prod
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      more_set_headers "X-Frame-Options: DENY";
      more_set_headers "X-Content-Type-Options: nosniff";
      more_set_headers "Strict-Transport-Security: max-age=31536000; includeSubDomains";
spec:
  ingressClassName: nginx
  tls:
  - hosts: ["app.example.com"]
    secretName: app-tls
  rules:
  - host: app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service: { name: backend, port: { number: 8443 } }
```

### 5.7 이미지 보안/서명(Cosign 예)
```bash
cosign sign --key cosign.key registry.corp/backend:1.2.3
cosign verify --key cosign.pub registry.corp/backend:1.2.3
```
- 배포 파이프라인에서 **서명 검증 Admission(OPA/Gatekeeper/Kyverno)** 적용.

### 5.8 체크리스트
- [ ] 네임스페이스/Pod Security `restricted`
- [ ] NetworkPolicy 기본 거부 + 필요 플로우 허용
- [ ] Mesh mTLS + AuthZ(주체/클레임 기반)
- [ ] RBAC 최소권한, Secret CSI/KMS
- [ ] Ingress 헤더/업로드 제한, 이미지 서명/스캔

---

## 6. 환경별 오버레이(Dev/Stg/Prod) — 공통 패턴

### 6.1 네트워크/방화벽
- Dev는 **로그만, 차단은 최소**(관찰) → Stg에서 정책 강화 → Prod는 **기본 거부 완전 적용**.
- 시간 기반 룰(업무시간)에 **예외 만료일** 명시.

### 6.2 프록시/Ingress
- Dev: 낮은 HSTS(또는 비활성), 테스트 도메인 **검색엔진 차단**.
- Prod: **엄격 HSTS**, 모든 외부 노출은 **WAF 통과**.

### 6.3 K8s
- Dev: `baseline` → Stg/Prod: `restricted`
- Dev: 임시 Egress 허용(만료 Annotation), Stg/Prod: **목록 기반 Egress**.

---

## 7. 검증 & 모니터링

### 7.1 스위치/라우터
- `show` 계열로 **DHCP Snooping/DAI 바인딩**, **uRPF Drop**, **CoPP 카운터** 확인.
- NetFlow/IPFIX → “Top talker/Protocol/AS/Port”.

### 7.2 프록시
- **헬스체크** 성공률, 4xx/5xx 비율, 평균 응답시간, 캐시 Hit Ratio.
- “업로드 크기/분할 횟수 임계” 알림.

### 7.3 방화벽
- 룰 **히트 통계**(Top/Zero), **Shadow/중복** 리포트.
- 차단→업무 영향 확인을 위한 **카나리 그룹** 운용.

### 7.4 K8s
- `kubectl get networkpolicies -A`로 커버리지 점검.
- Mesh 대시보드(주요 서비스 **mTLS On**, **Denied Counter**).
- Admission(OPA/Kyverno) 위반 로그.

---

## 8. 실습 시나리오(핸즈온)

### 8.1 액세스 스위치 랩
1) VLAN10(사용자), VLAN50(Guest), DHCP Snooping/DAI 활성화.
2) 미인증 단말 연결→Guest VLAN 할당 확인.
3) 스푸핑(고정 IP/ARP) 시도 → 차단 로그 확인.

### 8.2 라우터 경계 랩
1) uRPF strict로 모의 스푸핑 차단.
2) BGP Prefix-Filter/Max-Prefix로 잘못된 광고 방지.
3) RTBH 네트워크(예: `192.0.2.0/24`)로 차단 테스트.

### 8.3 프록시/리버스 랩
1) Nginx 보안 헤더/HSTS/업로드 제한 적용.
2) 모의 대용량 분할 업로드 → 429/차단 동작 검증.
3) (옵션) ModSecurity에 기본 OWASP-CRS 적용.

### 8.4 방화벽 정책 랩
1) 기본 거부 + User→Proxy/AD/File만 허용.
2) 직접 인터넷 접속 시도(우회) → 차단 로그.
3) 히트 수집 후 Zero-Hit/Shadow 제거 워크숍(29장 연계).

### 8.5 K8s 랩
1) `default-deny` + 백엔드→DB만 허용.
2) mTLS `STRICT` 적용 후 비인가 서비스 접근 실패 확인.
3) Ingress에 보안 헤더/업로드 제한 → 실제 요청으로 검증.

---

## 9. 운영 체크리스트(요약)

- [ ] **스위치**: 802.1X+MAB, DHCP Snooping/DAI/IPSG, STP 보호, 관리면 ACL
- [ ] **라우터**: uRPF, CoPP, BGP 보안/Max-Prefix/RPKI, NetFlow
- [ ] **프록시**: TLS/HSTS/보안 헤더, 인증/카테고리, 업로드 제한, 캐시, JSON 로깅
- [ ] **방화벽**: 존/오브젝트 표준, 기본 거부, 프록시 경유, IPS 최소 서명, 히트/Shadow 관리
- [ ] **K8s**: NS/PSA(restricted), NP 기본 거부, Mesh mTLS+AuthZ, RBAC 최소, 서명/스캔

---

## 10. 트러블슈팅 힌트

- **예상치 못한 차단**: (1) 룰/정책 순서, (2) 세션 캐시/Conntrack, (3) 오브젝트 그룹 확장.
- **프록시 499/504**: 원본 Keep-Alive/커넥션 풀, `proxy_read_timeout`, DNS 지연.
- **K8s 통신 오류**: NP/Egress 누락, Mesh 정책(Principal), ClusterIP vs Headless 차이.
- **BGP Drop**: Prefix-List/Max-Prefix 초과, TTL-Sec mismatch, RPKI invalid.

---

### 결론
- 장비별로 달라도 **보안의 공통 구조**는 같다: **기본 거부**, **최소 권한 플로우 허용**, **ID & mTLS**, **관측과 자동화**.
- 위 템플릿을 **조직 표준**으로 삼고, 리포지토리(IaC/구성 백업)에서 **환경 오버레이**로 차이를 관리하면, **안전성과 민첩성**을 동시에 얻을 수 있다.
- 필요하면 현재 환경(대역/장비/플로우 다이어그램)을 주면, 위 템플릿을 **회사 맞춤형 번들**(NAC/프록시/NGFW/K8s 포함)로 구체화해 줄게.
