---
layout: post
title: 논리회로설계 - MOS와 CMOS 로직
date: 2025-09-13 19:25:23 +0900
category: 논리회로설계
---
# MOS와 CMOS 로직 — **디바이스 기본기**, **CMOS 정적 로직(인버터·NAND·NOR·XOR)**, **패스/전송게이트**, **Ratioed·동적 로직**, **전력/지연/노이즈 여유**, **레이아웃·신뢰성**, **논리적 노력(Logical Effort)**

> 표기
> - \(V_{DD}\) (전원), \(V_T\) (임계), \(k=\mu C_{ox}\dfrac{W}{L}\) (공정·사이징 상수), \(\beta_n=k_n\), \(\beta_p=k_p\)
> - NMOS: **0**를 잘 통과(Strong-0), **1**은 \(V_{DD}-V_{TN}\)까지(Weak-1)
> - PMOS: **1**을 잘 통과(Strong-1), **0**은 \(|V_{TP}|\)만큼 손실(Weak-0)
> - 식은 장채널 근사(단채널 효과·핀치오프·DIBL 등은 부록에 요약)

---

## MOSFET 기초 요약 (디지털 관점)

### 전류식(장채널 근사, 포화/선형)

NMOS (\(V_{GS}\ge V_{TN}\)):
$$
I_D=
\begin{cases}
k_n\!\left[(V_{GS}-V_{TN})V_{DS}-\tfrac{1}{2}V_{DS}^2\right], & (선형:\ V_{DS}<V_{GS}-V_{TN})\\[6pt]
\tfrac{1}{2}k_n(V_{GS}-V_{TN})^2(1+\lambda V_{DS}), & (포화:\ V_{DS}\ge V_{GS}-V_{TN})
\end{cases}
$$

PMOS는 부호만 반대(분석 편의상 \(|V_{TP}|\) 사용). **디지털 스위치** 근사로는
$$
R_{on}\approx\frac{1}{k\,(V_{GS}-V_T)}
$$
를 이용해 **RC 지연**으로 모델링한다.

### 바디 효과/기생 용량/서브스레시홀드

- 바디 효과:
  $$
  V_T(V_{SB})=V_{T0}+\gamma\!\left(\sqrt{|2\phi_F+V_{SB}|}-\sqrt{|2\phi_F|}\right)
  $$
  → 소스가 바디보다 높아지면 \(V_T↑\).
- 기생 용량: \(C_{gs}, C_{gd}, C_{db}, C_{sb}\)는 **지연/동적전력**의 핵심.
- 서브스레시홀드 누설(디지털 유휴 전력 지배):
  $$
  I_{sub}\approx I_0\exp\!\left(\frac{V_{GS}-V_T}{nV_T}\right)\!\left(1-e^{-\frac{V_{DS}}{V_T}}\right)
  $$

---

## CMOS 인버터: DC/AC, 사이징, 노이즈 여유

### 회로 & 듀얼 네트워크

```
 VDD
  │
 PMOS (Wp,Lp)
  │─── Vout
 NMOS (Wn,Ln)
  │
 GND
```
- 입력=게이트 공유, 이상적으로 한쪽만 ON(정적 소모전력≈0).
- **Pull-Up**(PMOS) ↔ **Pull-Down**(NMOS) 네트워크의 **듀얼** 관계.

### 전달 특성(VTC)·스위칭점 \(V_M\)

정적 평형에서 \(I_n=I_p\) (포화 근사):
$$
\tfrac{1}{2}\beta_n(V_M-V_{TN})^2=\tfrac{1}{2}\beta_p\,(V_{DD}-V_M-|V_{TP}|)^2
$$
$$
\Rightarrow\; V_M=\frac{V_{DD}+\sqrt{\beta_p/\beta_n}\,V_{TN}-|V_{TP}|}{1+\sqrt{\beta_p/\beta_n}}
$$

- **대칭 스위칭점**(~\(V_{DD}/2\))을 원하면 \(\beta_n\approx\beta_p\)가 되도록 **사이징**.
- \(\beta\propto \mu \frac{W}{L}\), 장채널에서 대략 \(\mu_n/\mu_p\approx 2\sim 3\) → **\(W_p \approx 2\sim 3\,W_n\)**.

**예)** \(V_{DD}=1.0\rm V\), \(V_{TN}=0.40\rm V\), \(|V_{TP}|=0.45\rm V\), \(\mu_n/\mu_p=2.5\).
\(W_p/W_n=2.5\)로 맞추면 \(\sqrt{\beta_p/\beta_n}=1\) → \(V_M=\frac{1.0+0.40-0.45}{2}\approx 0.475\rm V\).

### 노이즈 여유

- \(NM_H=V_{OH}-V_{IH}\), \(NM_L=V_{IL}-V_{OL}\). \(V_{IL}, V_{IH}\)는 VTC에서 \(|dV_{out}/dV_{in}|=1\) 교점으로 정의.
- 인버터가 **대칭**이면 \(NM_H\approx NM_L\) → 공정/EMI 견고성↑.

### 지연·전력 1차 모델

- **동적전력**: \(P_{dyn}=\alpha\,C_L\,V_{DD}^2\,f\) (활성도 \(\alpha\)).
- **숏서킷 전력**: 입력 \(t_r, t_f\)가 길면 NMOS/PMOS **동시 도통** 시간↑ → \(P_{sc}↑\).
- **지연**:
  $$
  t_p\approx 0.69\,R_{eq}\,(C_{int}+C_{load})
  $$
  직렬 트랜지스터가 늘면 \(R_{eq}↑\) → **폭 스케일링**으로 보정.

---

## 정적 CMOS 게이트 — NAND/NOR/복합/사이징

### 듀얼 네트워크 규칙(핵심)

불 대수식 \(F\)가 주어지면 **NMOS= \(F\)**, **PMOS= \(F\)의 듀얼**(AND↔OR, series↔parallel 치환).

### 2입력 NAND (\(Y=\overline{A\cdot B}\))

```
PU(PMOS):  A ─┐
             ├─┐
             └─┘─── Vout
PD(NMOS): A ───┬─── B  (series) ── GND
```
- 하강 최악: **NMOS 직렬 2개** → 각 NMOS 폭을 **2×**로 키워 인버터와 동급 \(R_n\) 맞춤.
- 상승 최악: PMOS **하나**만 켜져도 됨 → 인버터 수준으로.

### 2입력 NOR (\(Y=\overline{A+B}\))

- 상승 최악: **PMOS 직렬 2개** → 각 PMOS 폭을 **2×**(κ배 기준).
- 하강 최악: NMOS **병렬** → 각 NMOS는 인버터 수준.

### 사이징 경험칙(인버터 기준 \(W_n=W\), \(W_p=\kappa W,\ \kappa\approx 2\sim 3\))

| 게이트 | 최악 경로 | NMOS 폭(기준 W) | PMOS 폭(기준 κW) |
|---|---|---:|---:|
| INV  | 단일 | 1, — | 1, — |
| NAND2| NMOS 직렬2 | **2,2** | **1,1** |
| NOR2 | PMOS 직렬2 | **1,1** | **2,2** |
| NAND3| NMOS 직렬3 | **3,3,3** | **1,1,1** |
| NOR3 | PMOS 직렬3 | **1,1,1** | **3,3,3** |

> 목적: **최악 상승/하강 경로의 \(R_{eq}\)** 가 인버터와 유사해지도록 균등화 ⇒ 파형 왜곡↓, 지연 대칭↑.

### 복합 게이트 예 — \(Y=\overline{A\cdot(B+C)}\)

- NMOS: \(A\) **AND** \((B \text{ OR } C)\) → **A 직렬 (B‖C)**
- PMOS: 듀얼 → **A 병렬 (B 직렬 C)**
- 사이징: **직렬인 쪽 폭 키움**(하강=NMOS·A, 상승=PMOS·B,C).

### XOR/XNOR

- 정적 CMOS XOR2(12T)는 입력용량·면적↑.
- **전송게이트(TG) XOR2(8T + 버퍼)**가 보통 빠르고 용량↓(§4 참조).

---

## 패스 트랜지스터 & 전송게이트(TG), MUX·래치

### 단독 패스의 한계

- NMOS 패스: ‘1’ 전달이 \(V_{DD}-V_{TN}\)로 **레벨 손실**.
- PMOS 패스: ‘0’ 전달이 \(|V_{TP}|\)만큼 손실.
→ 체인 시 로직 레벨 붕괴 위험.

### 전송게이트(Transmission Gate)

- **NMOS+PMOS 병렬**, 보완 게이트 `EN`/`\overline{EN}` → **레일-투-레일** 전달, \(R_{on}\)↓.

**2:1 MUX (TG)**
```
IN0 --TG(/S)──┐
               ├── Y → (버퍼 인버터 권장)
IN1 --TG(S) ──┘
```

### D 래치(투명-High)

```
D --TG(EN)--> X -- INV1 --> Q
           ^            |
           '--- INV2 ---'
```
- EN=1: TG 열림 → D가 X로, 인버터 쌍이 **재생**
- EN=0: TG 닫힘 → INV1·INV2 피드백으로 **홀드**

---

## Ratioed Logic (Pseudo-nMOS) — 면적↓·정적전력↑

### 구조

- **항상 ON PMOS(로드)** + **NMOS 네트워크**.
- 출력 ‘0’에서는 PMOS와 NMOS가 **전류 경쟁** → **정적 소모전력** 발생.

### 설계 규칙

- 로직 ‘0’ 보장: \(I_{pd,\max} > I_{pu}\).
- VOH 보장: PMOS가 너무 약하면 ‘1’ 레벨 저하.
- 유스케이스: 큰 팬인의 NOR 등 **트랜지스터 수 절감**이 매우 유리할 때만 제한적 사용.

---

## 동적 로직(Domino/NP) — 프리차지/평가, 이슈와 완화

### Domino (N-형, 단일 위상)

- **프리차지(φ=0)**: 노드 \(X\)를 PMOS로 충전(출력 버퍼 인버터로 \(Y=1\)).
- **평가(φ=1)**: NMOS 트리가 조건부로 \(X\) 방전 → 인버터 거쳐 \(Y=0\).

**장점**: PMOS 트리 제거 → 입력용량↓, 깊은 NMOS 트리 빠름.
**제약**: 평가 동안 입력은 **모노토닉 증가**만 허용(1→0 금지). 계단 연결은 **인버터(도미노)** 필요.

### 문제점 & 대책

- **차지 셰어링**: 하부 기생과 전하 분배 → \(X\) 레벨 저하 → **약한 키퍼 PMOS**로 유지.
- **리크/잡음**: 평가 시간 길면 방전 없이 \(X\)가 새어 오판 → **클록 듀티/창 조절**, **키퍼 강도 튜닝**.
- **노이즈 민감**: 프리차지 노드가 비등록 → **버퍼링/가드링**.

### NORA/NP 도미노

- N-도미노와 P-도미노 교번으로 모노토닉 제약 완화(복잡·클록 분배 주의).

---

## 전력·지연·노이즈 — 계산과 팁

### 전력

- **동적**: \(P_{dyn}=\alpha C V_{DD}^2 f\) → \(\alpha\)를 줄이는 **클럭 게이팅/데이터 코딩**이 핵심.
- **숏서킷**: 입력 스루 레이트가 느릴수록 ↑ → 드라이버 강도·버퍼 체인 최적화.

### 지연(Elmore/RC)

- 선로 분포 RC의 **Elmore 지연**:
  $$
  t_d\approx \sum_i R_i\,C_i^\*
  $$
  (소스에 가까운 C일수록 가중↑)
- 게이트 지연 1차:
  $$
  t_p \approx 0.69\,R_{eq}\big(C_{int}+C_{load}\big)
  $$
- **직렬 NMOS가 \(m\)**개면 각 폭을 \(m×\)로 키워 \(R_{eq}\) 보정(§3 표).

### 노이즈 여유/글리치

- 정적: 인버터 VTC에서 \(NM_H,NM_L\) 확보.
- 동적: 도미노/패스 로직은 프리차지 노드가 비등록 → **키퍼/레벨 레스토어/버퍼** 필수.

---

## 논리적 노력(Logical Effort) — 빠르게 균형 사이징

### 정의

- **논리적 노력 \(g\)**: 같은 입력용량으로 인버터 대비 “얼마나 더 어려운가”.
  - INV: \(g=1\)
  - NAND2: \(g\approx \tfrac{4}{3}\)
  - NOR2: \(g\approx \tfrac{5}{3}\)
- **전기적 노력 \(h=C_{out}/C_{in}\)**, **분기 노력 \(b\)**
- **스테이지 노력 \(f=gbh\)**, 경로 노력 \(F=\prod f\)**.
- 최적 스테이지 수 \(N\approx \ln F\), 각 스테이지 목표 \(f^{1/N}\)로 **폭 스케일링**.

### 짧은 예

경로: `INV → NAND2 → NOR2`, 최종 부하 \(C_L=20 C_{inv}\).
\(G\approx 1\cdot\frac{4}{3}\cdot\frac{5}{3}\approx 2.22\).
\(H=20\), \(F=GH\approx 44.4\). \(N=3\)이면 목표 \(f\approx 44.4^{1/3}\approx 3.53\).
각 게이트의 입력용량(폭)을 **출력용량/3.53**으로 역산하여 배치 → 대략 균형 지연.

---

## 레이아웃·물리: 스틱 다이어그램, 웰/가드링, 래치업, DRC/LVS

### 스틱 다이어그램(개요)

- **폴리(게이트)**가 **확산(n/p)** 위를 직교로 가로질러 트랜지스터 형성.
- NMOS는 **p-웰/벌크=GND**, PMOS는 **n-웰/벌크=VDD**.
- **확산 공유**로 접합C↓, 면적↓ (예: NAND의 직렬 NMOS).

### 가드링/래치업 방지

- 寄생 pnpn(SCR) 경로 트리거 → **래치업**.
- **웰/서브스트레이트 콘택트 촘촘히**, **가드링**, ESD·전원 램프 업 순서 관리.

### DRC/LVS·현대 노드

- **DRC**(선폭/간격/확장) 준수, **LVS**로 회로-레이아웃 일치 검증.
- FinFET/CFET 세대: **폭=Fin 개수**로 이산적, 단위 트랜지스터 그리드 제약.

---

## 신뢰성/공정 편차: PVT, NBTI/HCI, IR/EM

- **PVT 코너**: SS/TT/FF × \(V_{DD}\)± × 온도 범위에서 지연/전력 검증.
- **NBTI/BTI**(PMOS \(V_T↑\)), **HCI**(핫캐리어) → 장기 열화 → **타이밍 가드밴드** 필요.
- **IR Drop/EM**: 전원망 낙전/전류밀도 제한 → **전원 그리드·리피터** 설계.

---

## 예제 모음 — 해석·사이징·SPICE 스타일

### 인버터 스위칭점 계산(수치)

- 공정: \(\mu_n/\mu_p=2.5\), \(V_{DD}=1.0\rm V\), \(V_{TN}=0.40\rm V\), \(|V_{TP}|=0.45\rm V\).
- \(W_p/W_n=2.5\) → \(V_M\approx 0.475\rm V\) (대칭에 근접).

### NAND2 사이징 예

- 인버터 기준 \(W_n=1\), \(W_p=\kappa=2.5\).
- NAND2: NMOS 직렬 → 각 **\(W_{n,i}=2\)**, PMOS 병렬 → 각 **\(W_{p,i}=2.5\)**.
- 입력용량 증가에 맞춰 **전단 드라이버**도 스케일.

### SPICE 형식(개념)

```spice
* CMOS INV (W/L in um)
Mn out in 0 0 nmos L=0.06 W=0.12
Mp out in vdd vdd pmos L=0.06 W=0.30
Cl out 0 5f
Vin in 0 PULSE(0 1 0 20p 20p 100p 200p)
Vdd vdd 0 1.0
.tran 1p 5n
.measure tpHL TRIG V(in) VAL=0.5 RISE=1 TARG V(out) VAL=0.5 FALL=1
.end
```

---

## VHDL/Verilog 상위 모델과 CMOS 매핑

### 정적 CMOS 게이트 (합성용)

```vhdl
library ieee; use ieee.std_logic_1164.all;
entity cmos_nand2 is
  port (A,B: in std_logic; Y: out std_logic);
end;
architecture rtl of cmos_nand2 is
begin
  Y <= not (A and B); -- 표준 셀 NAND2로 매핑
end;
```

### 전송게이트 MUX (합성 우호형)

```vhdl
library ieee; use ieee.std_logic_1164.all;
entity tg_mux2 is
  port (A,B,S: in std_logic; Y: out std_logic);
end;
architecture rtl of tg_mux2 is
begin
  Y <= A when S='0' else B; -- 셀라이브러리 TG MUX 있을 경우 활용
end;
```

---

## XOR 구현 비교 — 정적 vs 전송게이트

### 정적 CMOS XOR2 (개념도)

- NMOS/PMOS 네트워크가 복잡(12T 수준), 입력용량↑, 팬아웃 드라이브에 버퍼 추가 필요.

### 전송게이트 XOR2 (권장)

```
Y = A ⊕ B
TG1: sel=B  → 경로 A→Y
TG2: sel=/B → 경로 /A→Y
Y는 최종 인버터로 버퍼링
```
- **장점**: 레일-투-레일, 용량↓, 지연↓.
- **주의**: TG가 보는 제어 신호(B, \(\overline{B}\))의 **동시 논리 무결성** 확보(글리치 방지).

---

## 종합 체크리스트

- [ ] 인버터 **VTC 대칭**: \(W_p/W_n\approx \mu_n/\mu_p\).
- [ ] NAND/NOR/복합: **최악 직렬 경로** 폭 보정(§3 표).
- [ ] TG 사용: MUX/래치/플롭에 **레일-투-레일** 보장.
- [ ] Ratioed/Dynamic: **정적 전력/노이즈/모노토닉성** 관리(키퍼, 듀티, 버퍼).
- [ ] 지연: \(R_{eq}C\)·논리적 노력으로 **균형 사이징**.
- [ ] 전력: \(\alpha C V^2 f\) 최소화(클럭 게이팅, 데이터 활동 제어).
- [ ] 레이아웃: 확산 공유, 웰타이/가드링, DRC/LVS.
- [ ] 신뢰성: PVT/IR/EM/BTI/HCI **코너 검증**.
- [ ] Self-start/불법 상태 대비(상위 FSM 설계 시).

---

## 부록 — 단채널 효과 간단 정리

- **DIBL**: 드레인 전계가 채널 장벽을 낮춰 \(V_T\)가 \(V_{DS}\)에 의존 → 누설↑, 포화 영역 정의 약화.
- **벨로시티 새츄레이션**: 고전계에서 운반자 속도 포화 → 전류식 지수 변경 → \(\alpha\)-파워 법칙 사용:
  $$
  I_{sat}\propto (V_{GS}-V_T)^\alpha,\quad 1<\alpha<2
  $$
- **핀펫/게이트올어라운드**: 짧은 채널 전기장 제어력↑ → \(S\)-팩터↓, 누설↓, 하지만 **폭 스케일이 이산적**(Fin 개수).

---

## 연습문제(원하면 해설 제공)

1) \(V_{DD}=0.9\rm V\), \(V_{TN}=0.35\rm V\), \(|V_{TP}|=0.40\rm V\), \(\mu_n/\mu_p=2.2\)에서 대칭 스위칭점을 얻기 위한 \(W_p/W_n\)을 구하고, 계산한 \(V_M\)을 제시하라.
2) NAND3와 NOR3의 **최악 경로**를 기준으로 인버터 동등 지연이 되게 각 트랜지스터 폭을 설계하라.
3) TG 기반 **2:1 MUX**와 정적 CMOS MUX를 비교 분석하고, 동일 부하에서의 입력용량·지연을 논리적 노력으로 추산하라.
4) Domino 게이트에서 **차지 셰어링** 시나리오를 가정하고 키퍼 크기를 선정하는 방법을 제시하라(리크/노이즈 마진 포함).
5) Ratioed NOR4를 설계한다. PMOS를 항상 ON으로 뒀을 때 ‘0’에서의 정적 전력을 전류 근사로 계산하고, **CMOS NOR4** 대비 장단점을 정리하라.

---

### 맺음말

MOS/CMOS 로직은 **디바이스 물리**(임계·이동도·기생)와 **논리 합성**(불식/네트워크 듀얼), 그리고 **타이밍·전력**(RC·논리적 노력)이 교차하는 지점이다.
정적 CMOS(인버터·NAND·NOR)를 기초로, **전송게이트**로 레벨 무결성을 확보하고, 필요 시 **Ratioed/동적** 기법을 신중히 사용하라.
마지막으로, **사이징과 버퍼링**을 데이터·부하에 맞게 최적화하면, 공정 편차와 노이즈를 견디는 **균형 잡힌 회로**를 얻을 수 있다.






