---
layout: post
title: 논리회로설계 - MOS와 CMOS 로직
date: 2025-09-13 19:25:23 +0900
category: 논리회로설계
---
# MOS와 CMOS 로직 — **디바이스 기본기**, **CMOS 정적 로직(인버터·NAND·NOR·XOR)**, **패스/전송게이트**, **Ratioed·동적 로직**, **전력/지연/노이즈 여유**, **레이아웃·신뢰성**, **논리적 노력(Logical Effort)**

> 표기  
> - \(V_{DD}\) (전원), \(V_T\) (임계), \(k=\mu C_{ox}\frac{W}{L}\) (공정·사이징 상수), \(\beta_n=k_n\), \(\beta_p=k_p\)  
> - NMOS: **0**를 잘 통과(Strong-0), **1**은 \(V_{DD}-V_{TN}\)까지(Weak-1)  
> - PMOS: **1**을 잘 통과(Strong-1), **0**은 \(|V_{TP}|\)만큼 손실(Weak-0)  
> - 식은 장채널 근사(SPICE 장단채널 차이·핀치오프 등은 부록에서 요약)

---

## 1) MOSFET 기초 요약 (디지털 관점)

### 1.1 전류식(장채널 근사, 포화/선형)
NMOS (\(V_{GS}\ge V_{TN}\)):
\[
I_D=
\begin{cases}
k_n\!\left[(V_{GS}-V_{TN})V_{DS}-\tfrac{1}{2}V_{DS}^2\right], & (선형: V_{DS}<V_{GS}-V_{TN})\\[4pt]
\tfrac{1}{2}k_n(V_{GS}-V_{TN})^2(1+\lambda V_{DS}), & (포화: V_{DS}\ge V_{GS}-V_{TN})
\end{cases}
\]
PMOS는 부호만 반대(편의상 \(|V_{TP}|\) 사용). **디지털 스위치**로는 **ON 저항** \(R_{on}\approx\frac{1}{k(V_{GS}-V_T)}\) 근사, **스위칭 RC**로 지연 예측.

### 1.2 바디 효과/캡acitance/서브스레시홀드
- 바디 효과: \(V_T(V_{SB})=V_{T0}+\gamma\big(\sqrt{|2\phi_F+V_{SB}|}-\sqrt{|2\phi_F|}\big)\)  
- 기생 C: \(C_{gs}, C_{gd}\)(게이트), \(C_{db}, C_{sb}\)(접합) → 지연·전력의 핵심  
- 서브스레시홀드 누설: \(I_{sub}\!\approx\!I_0 e^{\frac{V_{GS}-V_T}{nV_T}}(1-e^{-\frac{V_{DS}}{V_T}})\)

---

## 2) **CMOS 인버터**: DC/AC, 사이징, 노이즈 여유

### 2.1 회로 & 듀얼 네트워크
```
 VDD
  │
 PMOS (Wp,Lp)
  │----→ Vout
 NMOS (Wn,Ln)
  │
 GND
```
- 입력=게이트 공유, **한쪽만 ON**(정적 소모전력≈0).  
- 듀얼: Pull-Up(전류원: PMOS 네트워크) ↔ Pull-Down(NMOS 네트워크).

### 2.2 전달 특성(VTC)·스위칭점 \(V_M\)
정적 평형에서 \(I_n=I_p\) 가정(포화 근사):
\[
\frac{1}{2}\beta_n(V_M-V_{TN})^2=\frac{1}{2}\beta_p(V_{DD}-V_M-|V_{TP}|)^2
\]
\[
\Rightarrow\; V_M=\frac{V_{DD}+\sqrt{\beta_p/\beta_n}\,V_{TN}-|V_{TP}|}{1+\sqrt{\beta_p/\beta_n}}
\]
- **대칭 스위칭점**(≈\(V_{DD}/2\))을 원하면 \(\beta_n\approx\beta_p\)가 되도록 **사이징**:  
  \(\beta \propto \mu \frac{W}{L}\) 이므로 \(\mu_n\!\approx\!2\sim 3\mu_p\) → **\(W_p \approx 2\sim 3\,W_n\)**.

**예)** \(V_{DD}=1.0\rm V\), \(V_{TN}=0.40\rm V\), \(|V_{TP}|=0.45\rm V\), \(\mu_n/\mu_p=2.5\).  
\(W_p/W_n=2.5\)로 맞추면 \(\sqrt{\beta_p/\beta_n}=1\) → \(V_M=\frac{1.0+0.40-0.45}{2}\approx 0.475\rm V\).

### 2.3 노이즈 여유
- \(NM_H=V_{OH}-V_{IH}\), \(NM_L=V_{IL}-V_{OL}\); \(V_{IL/V_{IH}}\)는 VTC의 \(|dV_{out}/dV_{in}|=-1\) 교점.  
- **대칭 사이징**이면 두 노이즈 여유가 비슷(EMI·공정 편차에 강함).

### 2.4 지연·전력 1차 모델
- **동적전력**: \(P_{dyn}=\alpha C_L V_{DD}^2 f\) (활성도 \(\alpha\), 부하 \(C_L\)).  
- **숏서킷**: 입력 상승/하강 중 NMOS·PMOS 동시 ON → \(P_{sc}\propto (t_r,t_f)\).  
- **지연**: \(t_p\approx 0.69 R_{eq} C_{load}\) (상승/하강 각각 \(R_p,R_n\)).  
  - 등가저항 스케일 \(R\propto \frac{1}{W}\) → **직렬 트랜지스터 수**에 따라 **폭을 키워** 저항 보정.

---

## 3) **정적 CMOS 게이트** — NAND/NOR/복합/해석·사이징

### 3.1 듀얼 네트워크 규칙(핵심)
- 불 대수식 \(F\)가 주어지면 **NMOS네트워크 = \(F\)의 구현**, **PMOS네트워크 = \(F\)의 듀얼**  
  - 시리즈 ↔ 패럴렐 치환, 0↔1, AND↔OR.

### 3.2 2입력 NAND
불식: \(Y=\overline{A\cdot B}\)

```
PU(PMOS):  A ─┐
             ├─┐
             └─┘─── Vout ───
PB(NMOS): A ───┬─── B (series) ── GND
```
- **동작**: \(A=B=1\)일 때만 NMOS 직렬 경로로 0 방전 → 나머지는 ‘1’.  
- **사이징 가이드**(인버터 기준 Wn=W, Wp=κW; κ≈2~3):
  - NMOS는 **직렬 2개** → **각각 2W** (직렬저항 합 ≈ 인버터의 \(R_n\)과 유사)  
  - PMOS는 **병렬** → **각각 κW**(최악 상승은 1개 PMOS만 ON 이므로 인버터와 같게)

**상대 입력용량**: \(C_{in}\) 증가 (각 입력에 연결된 게이트 수·폭). NAND2는 인버터 대비 **입력 부하↑**.

### 3.3 2입력 NOR
불식: \(Y=\overline{A+B}\)
- PMOS **직렬 2개**(최악 상승 저항 증가) → **각각 2κW**  
- NMOS **병렬**(최악 하강은 1개 NMOS 경로) → **각각 W**

> **경험칙 표**

| 게이트 | 최악 경로 | NMOS 폭(기준 W) | PMOS 폭(기준 κW) |
|---|---|---:|---:|
| INV | 1개 | 1 | 1 |
| NAND2 | NMOS 직렬 | **2, 2** | **1, 1** |
| NOR2 | PMOS 직렬 | **1, 1** | **2, 2** |
| NAND3 | NMOS 직렬3 | **3,3,3** | **1,1,1** |
| NOR3 | PMOS 직렬3 | **1,1,1** | **3,3,3** |

> 목적: **최악 상승/하강**의 등가저항을 인버터 수준으로 균등화(지연 대칭·파형 품질 ↑).

### 3.4 복합 게이트 예 — \(Y=\overline{A\cdot(B+C)}\)
- NMOS: \(A\) **AND** \((B\) **OR** \(C)\) → A **직렬** (B‖C)  
- PMOS: 듀얼 → A **패럴렐** (B **직렬** C)  
- **사이징**: A가 직렬(하강 worst) → A의 NMOS 폭을 크게. PMOS는 B,C 직렬(상승 worst) → 각 PMOS 폭을 크게.

### 3.5 XOR/XNOR (정적 CMOS vs 전송게이트)
- **정적 CMOS XOR2**(12T 전형): NMOS/PMOS 네트워크 복잡, 입력용량 큼  
- **전송게이트(TG) XOR2**(8T + 2버퍼): 입력용량↓, 레일-투-레일 확보, **권장**

**TG XOR2**
```
Y = A ⊕ B
실장: TG1:(sel=B) 경로 A→Y,  TG2:(sel=/B) 경로 /A→Y,  출력버퍼 인버터
```

---

## 4) **패스 트랜지스터**와 **전송게이트(TG)**, MUX·래치

### 4.1 NMOS/PMOS 단독 패스의 한계
- NMOS는 ‘1’ 전달 시 \(V_{DD}-V_{TN}\)까지 → **레벨 손실**, 문턱 전압 스택으로 **로직 실패**  
- PMOS는 ‘0’ 전달 시 \(|V_{TP}|\)만큼 손실.

### 4.2 전송게이트(Transmission Gate)
- **NMOS+PMOS 병렬**, 보완 게이트: `EN`/`/EN`
- **장점**: **레일-투-레일** 전달, **낮은 R\_on**, MUX/래치에 최적

**2:1 MUX (TG)**
```
IN0 --TG(/S)──┐
               ├── Y ── INV(옵션 버퍼)
IN1 --TG(S) ──┘
```

**레벨 보정 불필요**, 속도·전력 모두 우수(입력용량도 작음).

### 4.3 D 래치(투명-고)
```
D --TG(EN)--> Node X -- INV1 --> Q
          ^             |
          '--- INV2 <---'
```
- EN=1일 때 TG 열림: D가 X로 전달, 인버터 쌍이 **재생**  
- EN=0일 때 TG 닫힘: 인버터 피드백으로 X **보유(홀드)**

---

## 5) **Ratioed Logic** (Pseudo-nMOS) — 면적↓·전력↑ 트레이드오프

### 5.1 회로 개념
- **항상 ON PMOS(로드)** + **NMOS 네트워크**  
- **출력 ‘1’**: NMOS OFF → PMOS를 통해 끌어올림  
- **출력 ‘0’**: NMOS ON → PMOS와 **저항 경쟁**으로 0 방전

### 5.2 설계 규칙
- **정적 소모전력** 존재(‘0’에서 PMOS와 NMOS 동시 전도)  
- 로직 ‘0’ 보장: \(I_{pd,max} > I_{pu}\) (NMOS 강함)  
- VOH 보장/노이즈 여유: PMOS 너무 약하면 ‘1’ 높이가 **낮아짐**  
- **용도**: **대팬인 NOR** 등 트랜지스터 수 절감이 매우 클 때만 제한적 사용

**예)** 4입력 NOR (정적 CMOS: 8 PMOS 직렬지연↑ → Pseudo-nMOS로 1 PMOS + 4 NMOS 병렬로 간단화, 단 전력↑)

---

## 6) **동적 로직** (Domino/N-P)는 왜 빠른가 — **프리차지/평가**, 이슈와 해결

### 6.1 단일 위상(Domino, N-형)
```
프리차지(φ=0):  Pch(PMOS) ON → 노드 X, Y=1로 충전
평가(φ=1):      NMOS 논리 네트워크로 X를 조건부 방전 → 버퍼 인버터로 출력
```
- **장점**: PMOS 네트워크 제거(용량↓), **깊은 NMOS 트리** 빠름  
- **제약**: **모노토닉 증가** 필요(평가 단계에서 1→0 금지), **다단은 인버터(도미노)** 필요

### 6.2 문제점
- **차지 셰어링**: X에서 하부 기생 C로 전하 분배 → **레벨 하강**  
- **리크/노이즈**: 평가 기간 길면 X가 새어 **오경보**  
- **해결**: **키퍼(keeper) PMOS**(약한 유지), 프리차지/평가 시간 최적화, **부트스트랩 금지**

### 6.3 NORA(노라)/NP 도미노
- N도미노 + P도미노 교번으로 **모노토닉 제약** 완화(복잡·클럭 분배 필요)

---

## 7) **전력·지연·노이즈**의 빠른 계산과 실무 팁

### 7.1 동적전력·활성도
- \(P_{dyn}=\alpha C V_{DD}^2 f\), **활성도 \(\alpha\)** 설계가 전력에 직결(클럭 게이팅, 데이터 코딩)  
- **숏서킷 전력**은 입력 상승/하강 시간에 비례 → **드라이버 강도·버퍼링**으로 억제

### 7.2 지연 1차(Elmore/RC)  
- 라인 분할 RC의 **Elmore delay**: \(t_d\approx \sum_i R_i C_i^\*\) (상위에 있는 C일수록 가중↑)  
- **게이트 지연**: \(t_p \approx 0.69 R_{eq} (C_{int}+C_{load})\)  
  - **직렬 NMOS 개수 \(m\)** → 각 폭을 \(m\times\) 늘려 \(R_{eq}\) 보정(§3 표 참조)

### 7.3 노이즈 여유·글리치
- **정적**: 인버터 VTC로 \(NMH,NML\) 확보  
- **동적**: 도미노/패스 로직은 노드가 비등록 → **잡음 취약** → 키퍼/레벨레스토어/버퍼 필수

---

## 8) **Logical Effort(논리적 노력)** — 게이트 크기 최적화

### 8.1 정의
- **논리적 노력 \(g\)**: 입력용량이 같은 인버터 대비 **추가 어려움**  
  - INV: \(g=1\) (기준)  
  - NAND2: \(g\approx \tfrac{4}{3}\)  
  - NOR2: \(g\approx \tfrac{5}{3}\) (대략; 공정·사이징에 따라 다름)
- **전기적 노력 \(h=C_{out}/C_{in}\)**, **분기 노력 \(b\)**  
- **스테이지 노력 \(f=gbh\)**, **경로 노력 \(F=\prod f\)**  
- 최적 스테이지 수 \(N\approx \ln F\) (베이스 \(e\)), 각 스테이지 \(f^{1/N}\)에 맞춰 **폭 스케일링**

### 8.2 짧은 예
- 경로: `INV → NAND2 → NOR2`, 최종 부하 \(C_L=20 C_{inv}\)  
- 대략 \(g\) 곱 \(G\approx 1 \cdot \frac{4}{3}\cdot\frac{5}{3}\approx 2.22\)  
- \(H=20\), \(F=GH\approx 44.4\). 스테이지 3개 → 이상적 스테이지 노력 \(f\approx F^{1/3}\approx 3.53\).  
- 각 게이트의 **입력용량(폭)**을 \(C_{out}/f\)로 역산하여 사이징 → 균형 지연 달성.

---

## 9) **레이아웃/물리**: 스틱다이어그램, 웰/가드링, 래치업, DRC

### 9.1 스틱 다이어그램 규칙(개요)
- **폴리(게이트)**는 **확산(n/p)** 위를 직교로 가로질러 **트랜지스터** 형성  
- NMOS는 **p-웰/벌크=GND**, PMOS는 **n-웰/벌크=VDD**  
- **동일 논리**는 확산 공유로 접합C↓, 면적↓ (예: NAND의 직렬 NMOS 공유)

### 9.2 가드링/래치업 방지
- **래치업**: pnpn 寄생 SCR 경로 트리거 → 대전류  
- **대책**: 웰/서브스트레이트 콘택트 촘촘히, **가드링**, ESD·전원 온순.

### 9.3 DRC/LVS
- **DRC**(선폭/간격/확장 등) 준수, **LVS**로 회로-레이아웃 일치 확인.  
- 첨단 노드: **이중/삼중 패터닝**, **FinFET**(폭=Fin 개수), **단위 트랜지스터 그리드** 제한.

---

## 10) **신뢰성/공정 편차**: PVT, NBTI/HCI, IR/EM

- **PVT 코너**: SS/TT/FF & \(V_{DD}\)± & 온도 범위에서 **지연/전력** 검증  
- **NBTI/BTI**(PMOS \(V_T↑\)), **HCI**(핫캐리어) → **장기 성능 열화**  
- 전원망 **IR Drop**, 배선 **EM**(전기이민) → 타이밍 여유/전류밀도 설계 필요

---

## 11) **예제 모음** — 해석·사이징·스파이스 스타일 넷리스트

### 11.1 인버터 스위칭점 계산(수치)
- 공정: \(\mu_n/\mu_p=2.5\), \(L\) 동일  
- 목표: \(V_M\approx V_{DD}/2\) → \(W_p/W_n\approx 2.5\)  
- 결과: \(V_M\approx 0.475\rm V\) (상단 §2.2)

### 11.2 NAND2 사이징 예
- 인버터 기준 \(W_n=1\), \(W_p=2.5\)  
- NAND2: \(N\) 직렬 2 → \(W_{n,i}=2\)씩, \(P\) 병렬 → \(W_{p,i}=2.5\)  
- **입력용량**: 각 입력이 NMOS 2 + PMOS 1 개의 게이트를 본다 → **전단 드라이버**를 이에 맞춰 크기 조정.

### 11.3 간단 SPICE 형식(개념)
```spice
* CMOS INV (W/L in um)
Mn out in 0 0 nmos L=0.06 W=0.12
Mp out in vdd vdd pmos L=0.06 W=0.30
Cl out 0 5f
Vin in 0 PULSE(0 1 0 20p 20p 100p 200p)
Vdd vdd 0 1.0
.tran 1p 5n
.measure tpHL TRIG V(in) VAL=0.5 RISE=1 TARG V(out) VAL=0.5 FALL=1
.end
```
> 실제 모델카드는 공정 PDK 제공. 여기선 **형식**만 예시.

---

## 12) **VHDL 상위 모델**(합성용)과 CMOS 구현의 연결

> 트랜지스터 수준은 VHDL-AMS/Verilog-A가 적합. RTL 합성에서는 **행동/구조**로 기술하고 **CMOS 셀**로 맵핑.

### 12.1 표준 정적 CMOS 게이트 RTL
```vhdl
library ieee; use ieee.std_logic_1164.all;

entity cmos_nand2 is
  port (A,B: in std_logic; Y: out std_logic);
end;
architecture rtl of cmos_nand2 is
begin
  Y <= not (A and B); -- 합성 시 NAND2 셀로 매핑
end;
```

### 12.2 전송게이트 MUX (합성기 우호형 표현)
```vhdl
entity tg_mux2 is
  port (A,B,S: in std_logic; Y: out std_logic);
end;
architecture rtl of tg_mux2 is
begin
  Y <= A when S='0' else B; -- 셀라이브러리에 TG MUX가 있으면 자동 매핑
end;
```

---

## 13) **FAQ & 실무 팁**

1) **왜 NOR은 느리고 NAND는 빠른가?**  
→ PMOS는 이동도 낮아 직렬에 취약. NOR은 상승 경로가 **PMOS 직렬**이라 느림. NAND는 하강 경로가 NMOS 직렬이어도 **폭 스케일**로 보정이 상대적으로 수월.

2) **패스 로직에서 레벨 손실은 꼭 문제인가?**  
→ 다음 단계가 TG/버퍼면 상쇄 가능. **직접 NMOS 패스로 레지스터 클럭을 전달** 같은 건 금물(레벨 미달/메타안정).

3) **도미노에서 왜 인버터가 필수?**  
→ 평가 단계에서 **출력만 상승**(모노토닉), 다음 단 NMOS 트리가 0→1 입력을 받으면 **잘못된 평가** 발생. 인버터가 이를 **보장**.

4) **전력 최적화 첫 단추**  
- 클럭 게이팅, 불필요 토글 억제(카운터·FSM), MUX선택 입력 고정, **멀티-Vt** 혼용.

5) **지연 디버깅**  
- **최악 경로의 직렬 트랜지스터 수** 확인 → **폭 증대**  
- 배선 RC 큰 곳은 **버퍼 삽입/리피터**  
- 도메인 교차 경계는 **레벨 시프터/동기화**.

---

## 14) 한눈에 보는 **설계 체크리스트**

- [ ] 인버터 VTC 대칭: \(W_p/W_n\approx \mu_n/\mu_p\)  
- [ ] NAND/NOR/복합: **최악 직렬 경로 폭 보정**  
- [ ] TG 사용: MUX/래치/플롭 **레일-투-레일** 보장  
- [ ] Ratioed/Dynamic: **정적 전력/노이즈/모노토닉성** 관리(키퍼/버퍼)  
- [ ] 지연: \(R_{eq}C\)·논리적 노력으로 **균형 사이징**  
- [ ] 전력: \(\alpha C V^2 f\) 최소화(클럭 게이팅·활성도 관리)  
- [ ] 레이아웃: 확산 공유·가드링·웰타이·DRC/LVS  
- [ ] PVT/신뢰성: 코너·IR/EM·BTI/HCI 검증

---

### 맺음말
MOS/CMOS 로직 설계는 **디바이스 물리**(임계·이동도·기생)와 **논리·시스템 관점**(불식, 듀얼 네트워크, 전력/지연/노이즈)의 **교차점**입니다.  
정적 CMOS(인버터·NAND·NOR)를 **탄탄히** 익히고, **전송게이트**로 **레이어을 깔끔히** 처리하며, 필요할 때 **Ratioed/동적** 기법을 신중히 활용하세요.  
마지막으로, **사이징(폭 스케일)** 과 **버퍼링**, **논리적 노력**을 통해 *균형 잡힌* 타이밍/전력 설계가 가능해집니다.
