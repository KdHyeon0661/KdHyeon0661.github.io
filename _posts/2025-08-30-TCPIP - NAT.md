---
layout: post
title: TCPIP - NAT
date: 2025-08-30 14:25:23 +0900
category: TCPIP
---
# IP 네트워크 주소 변환(NAT) 프로토콜

## NAT 개요, 필요성, 장점 및 단점

네트워크 주소 변환(NAT)은 IP 패킷의 출발지 또는 목적지 주소를 변환하는 기술로, 주로 사설 네트워크와 공인 네트워크 간의 주소 변환에 사용됩니다. 이 기술은 1990년대 IPv4 주소 고갈 문제를 해결하기 위해 널리 채택되었습니다.

### NAT의 주요 필요성
1. **IPv4 주소 고갈 대응**: 하나의 공인 IP 주소로 여러 사설 IP 장치가 인터넷 접속
2. **보안 강화**: 내부 네트워크 구조를 외부로부터 숨김
3. **네트워크 유연성**: 내부 네트워크 재구성 시 외부 설정 변경 최소화
4. **ISP 이전 용이성**: 공인 IP 변경 시 내부 네트워크 재구성 불필요

### NAT의 장점과 단점
**장점:**
- 공인 IP 주소 요구량 감소
- 내부 네트워크 주소 체계의 독립성 보장
- 기본적인 방화벽 기능 제공
- 네트워크 병합 시 주소 충돌 문제 해결

**단점:**
- 종단 간 연결성 저해
- 특정 애플리케이션과의 호환성 문제
- 네트워크 성능 저하 가능성
- 복잡한 트러블슈팅 요구
- IPsec 등의 보안 프로토콜과 충돌 가능

## NAT 주소 용어

NAT 환경에서 사용되는 주요 주소 개념:

```
사설 네트워크                NAT 장비                공인 네트워크
(내부)                    (변환기)                  (외부)
┌─────────────┐      ┌─────────────────┐      ┌─────────────┐
│ 내부 로컬    │──────│ 변환 테이블      │──────│ 외부 글로벌  │
│ 주소        │      │                 │      │ 주소        │
│ (192.168.1.10)│      │                 │      │ (203.0.113.5)│
│             │      │                 │      │             │
│ 내부 글로벌  │      │                 │      │ 외부 로컬   │
│ 주소        │      │                 │      │ 주소        │
│ (변환된 주소) │      │                 │      │ (변환된 주소)│
└─────────────┘      └─────────────────┘      └─────────────┘
```

**주요 용어 정의:**
- **내부 로컬 주소**: 내부 네트워크에서 실제 사용되는 주소 (사설 IP)
- **내부 글로벌 주소**: 내부 호스트가 외부와 통신할 때 사용되는 공인 IP
- **외부 로컬 주소**: 외부 호스트가 내부 네트워크에 나타나는 주소
- **외부 글로벌 주소**: 외부 호스트의 실제 공인 IP 주소

## 정적 NAT와 동적 NAT 매핑

### 정적 NAT (Static NAT)
내부 주소와 공인 주소 간의 **1:1 고정 매핑**. 주로 서버와 같이 외부에서 접근해야 하는 장치에 사용됩니다.

**예시:**
```
내부 주소      ↔      공인 주소
192.168.1.10   ↔     203.0.113.10
192.168.1.20   ↔     203.0.113.20
```

**특징:**
- 항상 동일한 공인 IP로 변환
- 외부에서 내부 서버 접속 가능
- 주소 자원 비효율적일 수 있음

### 동적 NAT (Dynamic NAT)
내부 주소 풀과 공인 주소 풀 간의 **동적 매핑**. 내부 호스트가 외부 통신을 시작할 때마다 사용 가능한 공인 IP를 할당합니다.

**동작 과정:**
```
공인 IP 풀: 203.0.113.1 ~ 203.0.113.10

1. 내부 호스트 192.168.1.100 외부 접속 시도
2. NAT 장비가 사용 가능한 공인 IP 할당 (예: 203.0.113.1)
3. 변환 테이블에 매핑 정보 저장
4. 통신 종료 시 주소 반환 (타임아웃 또는 명시적 종료 시)
```

**특징:**
- 공인 IP 공유 가능
- 주소 자원 효율적 사용
- 세션당 주소 할당
- 동시 접속 수가 공인 IP 수로 제한됨

## 단방향 NAT (전통적/아웃바운드) 동작

단방향 NAT는 내부에서 외부로의 통신만 허용하는 가장 일반적인 NAT 모드입니다.

### 기본 동작 흐름
```
내부 네트워크 → NAT 장비 → 인터넷

1. 내부 호스트(192.168.1.10:3000)가 웹 서버(93.184.216.34:80) 접속
2. NAT 장비가 출발지 주소를 공인 IP(203.0.113.5:5000)로 변환
3. 변환 정보를 NAT 테이블에 저장:
   │ 내부 주소        │ 공인 주소       │ 목적지 주소     │
   │ 192.168.1.10:3000│203.0.113.5:5000│93.184.216.34:80│
4. 응답 패킷 수신 시 테이블 조회하여 역변환
5. 내부 호스트에 패킷 전달
```

**주요 특징:**
- 상태 저장형(Stateful) 동작
- 내부에서 시작된 트래픽만 허용
- 외부에서 내부로의 시작된 연결 차단
- 기본 방화벽 기능 제공

## 양방향 NAT (투웨이/인바운드) 동작

양방향 NAT는 외부에서 내부 서비스로의 접속도 허용하는 모드입니다.

### 정적 포트 포워딩 예시
```
외부 클라이언트 → NAT 장비 → 내부 서버

NAT 설정: 외부 203.0.113.5:80 → 내부 192.168.1.100:80

1. 외부 클라이언트가 203.0.113.5:80 접속
2. NAT 장비가 사전 정의된 규칙에 따라
   203.0.113.5:80 → 192.168.1.100:80 변환
3. 내부 웹 서버가 요청 처리
4. 응답 시 역변환 수행
```

### DMZ(Demilitarized Zone) 설정
```
인터넷 → NAT 장비 → [DMZ 서버: 192.168.1.50] → 내부 네트워크
                    모든 인바운드 트래픽 전달
```

## 포트 기반 NAT (NAPT/PAT)

네트워크 주소 포트 변환(NAPT) 또는 포트 주소 변환(PAT)은 단일 공인 IP로 여러 내부 호스트를 지원하기 위해 포트 번호까지 변환하는 기술입니다.

### PAT 동작 원리
```
내부 네트워크 (사설 IP) → NAT 장비 (단일 공인 IP) → 인터넷

호스트A: 192.168.1.10:1024 → 203.0.113.5:5000
호스트B: 192.168.1.20:1024 → 203.0.113.5:5001  
호스트C: 192.168.1.30:1024 → 203.0.113.5:5002

NAT 테이블:
│ 내부 주소        │ 변환된 주소      │ 목적지         │
├─────────────────┼─────────────────┼───────────────┤
│192.168.1.10:1024│203.0.113.5:5000 │ 8.8.8.8:53    │
│192.168.1.20:1024│203.0.113.5:5001 │ 1.1.1.1:80    │
│192.168.1.30:1024│203.0.113.5:5002 │ 9.9.9.9:443   │
```

**주요 특징:**
- 단일 공인 IP로 수천 개의 내부 연결 지원
- 포트 번호를 추가 식별자로 사용 (0-65535)
- 가장 일반적인 NAT 구현 방식
- "IP 마스커레이딩"이라고도 불림

**포트 할당 전략:**
1. **풀 범위**: 1024-65535 사용
2. **포트 보존**: 가능한 원본 포트 유지 시도
3. **포트 오버로딩**: 포트 재사용 (타임아웃 후)

## 중첩 NAT ("트와이스 NAT") 동작

중첩 NAT는 두 개의 서로 다른 사설 네트워크가 같은 주소 공간을 사용할 때 발생하는 문제를 해결합니다.

### 시나리오: 회사 합병 시 주소 충돌
```
회사 A: 192.168.1.0/24 사용
회사 B: 192.168.1.0/24 사용 (동일 대역!)

두 회사 네트워크 통합 필요 → 주소 충돌 발생
```

### 트와이스 NAT 솔루션
```
회사 A 네트워크 ↔ NAT 장비 A ↔ 중간 네트워크 ↔ NAT 장비 B ↔ 회사 B 네트워크
192.168.1.x      10.0.0.x               10.0.1.x       192.168.1.x

변환 과정:
회사A의 192.168.1.10 → 회사B에서 볼 때 10.0.0.10
회사B의 192.168.1.20 → 회사A에서 볼 때 10.0.1.20
```

**양방향 주소 변환 테이블:**
```
NAT 장비 A 테이블:
│ 원본 주소      │ 변환 주소    │ 목적지        │
├───────────────┼─────────────┼───────────────┤
│192.168.1.10   │ 10.0.0.10   │ 10.0.1.20     │

NAT 장비 B 테이블:
│ 원본 주소      │ 변환 주소    │ 목적지        │
├───────────────┼─────────────┼───────────────┤
│192.168.1.20   │ 10.0.1.20   │ 10.0.0.10     │
```

## NAT 호환성 문제 및 특별 처리 요구사항

### 애플리케이션 계층 게이트웨이(ALG) 필요
일부 프로토콜은 패킷 데이터 부분에 IP 주소나 포트 정보를 포함하여 NAT와 호환성 문제가 발생합니다.

**문제가 있는 프로토콜 예시:**
1. **FTP (Active Mode)**: PORT 명령에 클라이언트 IP/포트 포함
2. **SIP/VoIP**: SDP 메시지에 미디어 주소 정보 포함
3. **ICMP**: 에러 메시지에 원본 IP 헤더 포함
4. **IPsec**: 주소 검증으로 NAT 통과 불가

### FTP ALG 동작 예시
```
FTP 클라이언트(내부) → NAT → FTP 서버(외부)

1. 클라이언트: "PORT 192,168,1,10,12,34" (192.168.1.10:3106)
2. NAT ALG: "PORT 203,0,113,5,12,100"으로 변환 (203.0.113.5:3204)
3. 변환 정보를 상태 테이블에 저장
4. 데이터 채널 연결 시 변환 적용
```

### NAT 트래버셜 기술
P2P 애플리케이션을 위한 NAT 통과 기술:
1. **STUN**: 클라이언트가 공인 주소/포트 확인
2. **TURN**: 릴레이 서버를 통한 중계
3. **ICE**: STUN/TURN을 결합한 최적 경로 선택
4. **UPnP/IGD**: 로컬 네트워크에서 NAT 포트 매핑 자동 구성

### IPv6 전환과 NAT
**NAT64/DNS64:**
```
IPv6 전용 네트워크 ↔ NAT64 ↔ IPv4 인터넷
2001:db8::1       ↔ 203.0.113.1
```
- IPv6 호스트가 IPv4 리소스 접근 시 주소 변환
- DNS64가 AAAA 레코드 생성 시 IPv6 접두사 추가

## 결론

NAT는 단순한 주소 변환 기술을 넘어 현대 네트워크 아키텍처의 핵심 구성 요소로 자리 잡았습니다. IPv4 주소 고갈이라는 절박한 문제에 대한 실용적인 해결책으로 시작되었지만, 시간이 지남에 따라 보안, 네트워크 관리, 비용 절감 등 다양한 이점을 제공하는 다목적 도구로 발전했습니다.

NAT의 가장 큰 강점은 투명성에 있습니다. 대부분의 사용자와 애플리케이션은 NAT의 존재를 인지하지 못한 채 인터넷을 사용할 수 있습니다. 그러나 이 투명성은 양날의 검으로, P2P 통신, 온라인 게임, 화상 회의 등 특정 애플리케이션에서는 심각한 장벽이 되기도 합니다. 이러한 문제를 해결하기 위해 STUN, TURN, ICE와 같은 NAT 트래버셜 기술이 발전해 왔습니다.

NAT 구현의 진화는 동적 NAT에서 PAT로, 그리고 현재는 CGN(Carrier-Grade NAT)으로 이어지며 점점 더 복잡해지고 있습니다. 특히 이동통신망에서는 수천 명의 사용자가 단일 공인 IP를 공유하는 경우도 흔합니다. 이러한 과도한 NAT 중첩은 성능 저하와 트러블슈팅의 어려움을 초래합니다.

장기적인 관점에서 NAT는 IPv6의 보급으로 점차 그 필요성이 감소할 것으로 예상됩니다. IPv6의 방대한 주소 공간은 NAT 없이도 모든 장치에 고유한 글로벌 주소를 할당할 수 있게 합니다. 그러나 현실적으로는 IPv4와 IPv6가 공존하는 기간이 길어질 것이며, 이 기간 동안 NAT64와 같은 이중 스택 기술은 필수적일 것입니다.

네트워크 엔지니어에게 NAT는 단순한 설정 작업이 아닌, 네트워크 설계 철학을 반영하는 중요한 결정입니다. NAT를 적용할 때는 보안 요구사항, 애플리케이션 호환성, 성능 영향, 미래 확장성 등을 종합적으로 고려해야 합니다. NAT가 제공하는 편의성과 그것이 초래하는 복잡성 사이의 균형을 이해하는 것이 현대 네트워킹 전문가에게 요구되는 핵심 역량입니다.