---
layout: post
title: 선형대수 - 4가지 기본 벡터 공간
date: 2025-06-02 22:20:23 +0900
category: 선형대수
---
# Four Fundamental Subspaces — 열공간·행공간·영공간·좌영공간 완전 가이드

> **핵심 한 줄**
> 임의의 행렬 \(A\in\mathbb{R}^{m\times n}\)에 대해 공간 네 개가 모든 구조를 설명한다:
> \[
> \boxed{
> \begin{aligned}
> &\text{Col}(A)\subset \mathbb{R}^m,\quad &&\text{Row}(A)=\text{Col}(A^\top)\subset \mathbb{R}^n,\\
> &\text{Null}(A)\subset \mathbb{R}^n,\quad &&\text{Null}(A^\top)\subset \mathbb{R}^m.
> \end{aligned}}
> \]
> 이들은 직교쌍을 이루며
> \[
> \boxed{\mathbb{R}^n=\text{Row}(A)\oplus \text{Null}(A)},\qquad
> \boxed{\mathbb{R}^m=\text{Col}(A)\oplus \text{Null}(A^\top)}.
> \]

---

## 로드맵

1. **정의 & 직관** — 각 공간이 무엇이며 무엇을 의미하는가
2. **차원 공식(랭크-널리티)** — 차원 관계와 즉석 판단법
3. **직교성 & 분해** — 입력/출력 공간의 직교분해와 투영
4. **기저 구하는 법** — RREF/피벗, SVD, 심볼릭 접근
5. **완전 예제** — 손계산 예제(랭크 결핍) & 직사각형 예제
6. **최소제곱 & 의사역행렬** — \(AA^+\), \(A^+A\), 잔차의 의미
7. **Python 코드** — SymPy/NumPy로 네 공간, 투영행렬, 검증
8. **체크리스트 & 자주 하는 실수**

---

## 네 개의 기본 공간 — 정의와 직관

### Column Space \( \text{Col}(A) \subset \mathbb{R}^m \)

- **정의:** \( \text{Col}(A) = \{A\vec{x}\mid \vec{x}\in\mathbb{R}^n\} \) (열벡터들의 선형결합)
- **직관:** \(A\vec{x}=\vec{b}\)의 **출력 범위**. \(\vec{b}\)가 이 안에 있어야 해가 존재.
- **차원:** \(\dim\text{Col}(A)=\operatorname{rank}(A)=:r\).

### Row Space \( \text{Row}(A) = \text{Col}(A^\top)\subset\mathbb{R}^n \)

- **정의:** 행벡터들의 span.
- **직관:** 입력공간에서 **제약이 걸리는 방향**들. 선형식 \( \ell_i(\vec{x}) \)들의 세계.
- **차원:** \(\dim\text{Row}(A)=\operatorname{rank}(A)=r\).

### Null Space \( \text{Null}(A) \subset \mathbb{R}^n \)

- **정의:** \( \text{Null}(A)=\{\vec{x}\in\mathbb{R}^n \mid A\vec{x}=\vec{0}\} \).
- **직관:** \(A\)가 **정보를 잃는 방향**(출력 0). 동차해의 전체.
- **차원:** \(\dim\text{Null}(A)=n-r\).

### Left Null Space \( \text{Null}(A^\top) \subset \mathbb{R}^m \)

- **정의:** \( \text{Null}(A^\top)=\{\vec{y}\in\mathbb{R}^m \mid A^\top\vec{y}=\vec{0}\} \).
- **직관:** 출력공간에서 \( \vec{y}^\top A=0 \)가 되는 **출력의 직교 보완**.
- **차원:** \(\dim\text{Null}(A^\top)=m-r\).

---

## 차원 공식 — 랭크-널리티 두 줄 요약

\[
\boxed{\operatorname{rank}(A)+\dim\text{Null}(A)=n},\qquad
\boxed{\operatorname{rank}(A)+\dim\text{Null}(A^\top)=m}.
\]

- 즉, **입력 차원 \(n\)**은 “행공간 \(r\)” + “영공간 \(n-r\)”.
- **출력 차원 \(m\)**은 “열공간 \(r\)” + “좌영공간 \(m-r\)”.

---

## 직교성 & 직교분해

\[
\boxed{\text{Row}(A)\ \perp\ \text{Null}(A)},\qquad
\boxed{\text{Col}(A)\ \perp\ \text{Null}(A^\top)}.
\]

- 모든 \(\vec{u}\in\text{Row}(A)\), \(\vec{v}\in\text{Null}(A)\)에 대해 \(\vec{u}\cdot\vec{v}=0\).
- 모든 \(\vec{y}\in\text{Null}(A^\top)\), \(\vec{w}\in\text{Col}(A)\)에 대해 \(\vec{y}\cdot\vec{w}=0\).

따라서
\[
\mathbb{R}^n = \text{Row}(A)\ \oplus\ \text{Null}(A),\qquad
\mathbb{R}^m = \text{Col}(A)\ \oplus\ \text{Null}(A^\top).
\]

---

## 기저 구하는 법 — 세 가지 실무 루트

### RREF(행최소기약형) & 피벗

- RREF에서 **피벗 열** → \( \text{Col}(A) \)의 기저(원래 행렬의 해당 열 사용).
- RREF의 **비영(非零) 행** → \( \text{Row}(A) \)의 기저(그대로 사용).
- RREF로 \(A\vec{x}=\vec{0}\) 풀어 **자유변수**로 \( \text{Null}(A) \) 기저 도출.
- \( \text{Null}(A^\top) \)는 \(A^\top \vec{y}=0\)을 RREF로.

### SVD 관점(가장 안정적, 직교기저 제공)

\[
A=U\Sigma V^\top,\quad \Sigma=\mathrm{diag}(\sigma_1,\dots,\sigma_r,0,\dots)
\]
- **열공간:** \( \text{Col}(A)=\mathrm{span}\{U_1,\dots,U_r\} \).
- **행공간:** \( \text{Row}(A)=\mathrm{span}\{V_1,\dots,V_r\} \).
- **영공간:** \( \text{Null}(A)=\mathrm{span}\{V_{r+1},\dots,V_n\} \).
- **좌영공간:** \( \text{Null}(A^\top)=\mathrm{span}\{U_{r+1},\dots,U_m\} \).

### 심볼릭(정확한 기저)

- SymPy의 `columnspace()`, `rowspace()`, `nullspace()`, `A.T.nullspace()`.

---

## 손계산 예제 — 랭크 결핍 3×3

\[
A=
\begin{bmatrix}
1&2&3\\
0&1&4\\
0&0&0
\end{bmatrix}
\quad(m=n=3,\ r=2)
\]

### Row/Col

- **Row(A)** 기저: \([1,2,3],\ [0,1,4]\) (비영 행들) → \(\dim=2\).
- **Col(A)** 기저: **피벗 열** 1,2열 → \(\{[1,0,0]^\top,\ [2,1,0]^\top\}\) → \(\dim=2\).

### Null(A)

연립식 \(A\vec{x}=\vec{0}\):
\[
\begin{cases}
x_1+2x_2+3x_3=0\\
x_2+4x_3=0
\end{cases}
\Rightarrow x_2=-4t,\ x_1=5t
\]
\(\Rightarrow \text{Null}(A)=\mathrm{span}\{[5,-4,1]^\top\}\), \(\dim=1=n-r\).

### Left Null \(\text{Null}(A^\top)\)

\[
A^\top=\begin{bmatrix}
1&0&0\\
2&1&0\\
3&4&0
\end{bmatrix},\quad A^\top \vec{y}=\vec{0}
\Rightarrow y_1=0,\ y_2=0,\ y_3\ \text{자유}
\]
\(\Rightarrow \text{Null}(A^\top)=\mathrm{span}\{[0,0,1]^\top\}\), \(\dim=1=m-r\).

### 직교성 체크(수동)

- \([5,-4,1]\cdot [1,2,3]=5-8+3=0\), \([5,-4,1]\cdot[0,1,4]=-4+4=0\) → \( \text{Row}\perp \text{Null}\).
- \([0,0,1]\)은 \(\text{Col}(A)\)의 모든 벡터와 내적 0(세 번째 성분이 0) → \( \text{Col}\perp \text{Null}(A^\top)\).

---

## 직사각형 예제 — \(m=3,\ n=4,\ r=2\)

\[
A=
\begin{bmatrix}
1&0&1&2\\
0&1&1&1\\
1&1&2&3
\end{bmatrix}
\quad(\text{세 번째 행}=\text{첫째}+\text{둘째})
\]
- \(\operatorname{rank}(A)=2\).
- \(\dim\text{Col}(A)=2\subset\mathbb{R}^3\), \(\dim\text{Row}(A)=2\subset\mathbb{R}^4\).
- \(\dim\text{Null}(A)=n-r=2\), \(\dim\text{Null}(A^\top)=m-r=1\).

**해석**
- 모든 \(\vec{b}\in\mathbb{R}^3\)는 유일하게 \(\vec{b}=\vec{p}+\vec{r}\)로 분해됨
  (\(\vec{p}\in\text{Col}(A),\ \vec{r}\in\text{Null}(A^\top)\), 서로 직교).
- \(A\vec{x}=\vec{b}\)의 **최소제곱해** \(\vec{x}_{\mathrm{LS}}\)는 \(\vec{p}=A\vec{x}_{\mathrm{LS}}\), 잔차 \(\vec{r}=\vec{b}-\vec{p}\in\text{Null}(A^\top)\).

---

## 최소제곱, 의사역행렬, 투영행렬

### 무어–펜로즈 의사역행렬 \(A^+\)

- **정사영 행렬**
  \[
  \boxed{P_{\text{col}} = A A^+},\qquad
  \boxed{P_{\text{row}} = A^+ A}.
  \]
- **보완 투영**
  \[
  P_{\text{left-null}}=I_m - A A^+,\qquad
  P_{\text{null}}=I_n - A^+ A.
  \]
- 성질: \(P^2=P\) (멱등), \(P^\top=P\) (대칭).
  범위/핵: \(\mathrm{Range}(A A^+)=\text{Col}(A)\), \(\ker(A A^+)=\text{Null}(A^\top)\), 등.

### 최소제곱과 잔차의 정교한 해석

- 최소제곱해 \(\vec{x}_{\mathrm{LS}}=A^+\vec{b}\).
- 투영벡터 \(\vec{p}=A\vec{x}_{\mathrm{LS}}=(A A^+)\vec{b}\in\text{Col}(A)\).
- 잔차 \(\vec{r}=\vec{b}-\vec{p}=(I-A A^+)\vec{b}\in\text{Null}(A^\top)\).

---

## Python (SymPy/NumPy) — 네 공간·직교성·투영행렬 검증

> **주의:** 실수 오차를 감안하여 `np.allclose` 사용 권장.

```python
# ----- SymPy: 정확 기저/차원/직교성 검증 -----

import sympy as sp

A = sp.Matrix([
    [1, 0, 1, 2],
    [0, 1, 1, 1],
    [1, 1, 2, 3],  # = row1 + row2
])

# 네 공간의 기저

colB = A.columnspace()
rowB = A.rowspace()
nullB = A.nullspace()
leftNullB = A.T.nullspace()

print("rank(A) =", A.rank())
print("dim Col(A) =", len(colB))
print("dim Row(A) =", len(rowB))
print("dim Null(A) =", len(nullB))
print("dim Null(A^T) =", len(leftNullB))

# 직교성 확인: Row(A) ⟂ Null(A)

def dot(u, v): return sum(ui*vi for ui,vi in zip(u, v))
for r in rowB:
    for n in nullB:
        print("r·n =", sp.simplify(dot(r, n)))  # 모두 0이어야 함

# 직교성 확인: Col(A) ⟂ Null(A^T)

for c in colB:
    for ln in leftNullB:
        print("c·ln =", sp.simplify(dot(c, ln)))  # 모두 0이어야 함
```

```python
# ----- NumPy: 의사역행렬과 투영행렬, 최소제곱 분해 -----

import numpy as np

A = np.array([
    [1., 0., 1., 2.],
    [0., 1., 1., 1.],
    [1., 1., 2., 3.],
])

Ap = np.linalg.pinv(A)           # 무어-펜로즈 의사역행렬
P_col  = A @ Ap                  # Col(A)로의 정사영 (m×m)
P_row  = Ap @ A                  # Row(A)로의 정사영 (n×n)
P_lns  = np.eye(A.shape[0]) - P_col
P_null = np.eye(A.shape[1]) - P_row

# 투영행렬 성질 확인: 멱등/대칭

print("||P_col^2 - P_col||:", np.linalg.norm(P_col@P_col - P_col))
print("||P_row^2 - P_row||:", np.linalg.norm(P_row@P_row - P_row))
print("||P_col - P_col^T||:", np.linalg.norm(P_col - P_col.T))
print("||P_row - P_row^T||:", np.linalg.norm(P_row - P_row.T))

# 최소제곱 분해 b = p + r,  p⊥r

b = np.array([3., 1., 4.])
x_ls = Ap @ b
p = A @ x_ls                    # Col(A) 성분
r = b - p                       # Left Null 성분
print("x_LS:", x_ls)
print("p (in Col(A)):", p)
print("r (in Left-Null):", r)
print("p·r ≈ 0 ?", np.allclose(p @ r, 0.0))
```

---

## 현업에서의 빠른 판단 레시피

1) **해 존재 여부** \(A\vec{x}=\vec{b}\): \(\vec{b}\in\text{Col}(A)\) 인가?
   - 아니면 최소제곱으로 \( \vec{b}=(AA^+)\vec{b} + (I-AA^+)\vec{b} \) 분해.
2) **해의 개수**: 자유변수 수 \(= n - r\) (Nullity).
3) **조건수/수치안정**: SVD로 작은 \(\sigma_i\) 확인 → 정규화/정칙화.
4) **기저 구하기**: SVD(직교기저) → RREF(피벗 확인) 보완.
5) **투영 필요**: \(P_{\text{col}}=AA^+\), \(P_{\text{row}}=A^+A\) 바로 사용.

---

## 자주 하는 실수 & 팁

- **Col(A) 기저를 RREF의 열에서 뽑지 않기**: **원래 행렬의 피벗열**을 써야 함.
- **Row(A) 기저**는 **RREF의 비영 행**이 간편(원래 행 행벡터는 중복/종속일 수 있음).
- **직교성 검증** 시 부동소수 오차 고려 → `np.allclose`.
- **랭크 추정**은 SVD가 견고(작은 특이값 임계값 필요).
- 최소제곱 잔차는 항상 **Left Null**에 놓임: \((A^\top r=0)\)을 기억.

---

## 요약 표

| 공간 | 기호 | 존재 공간 | 차원 | 직교쌍 |
|---|---|---|---|---|
| 열공간 | \( \text{Col}(A) \) | \( \mathbb{R}^m \) | \( r \) | \( \text{Null}(A^\top) \) |
| 행공간 | \( \text{Row}(A) \) | \( \mathbb{R}^n \) | \( r \) | \( \text{Null}(A) \) |
| 영공간 | \( \text{Null}(A) \) | \( \mathbb{R}^n \) | \( n-r \) | \( \text{Row}(A) \) |
| 좌영공간 | \( \text{Null}(A^\top) \) | \( \mathbb{R}^m \) | \( m-r \) | \( \text{Col}(A) \) |

---

## 연습문제 (스스로 확인)

1) \(A=\begin{bmatrix}1&2&3\\ 2&4&6\\ 1&1&1\end{bmatrix}\). RREF로 \(r\), 네 공간 기저, 차원, 직교성 확인.
2) \(A\in\mathbb{R}^{3\times4}\)가 \(r=2\). 임의의 \(\vec{b}\)에 대해 \(b=(AA^+)b+(I-AA^+)b\) 분해가 왜 유일한지 증명.
3) SVD로 네 공간의 **직교 기저**를 만들어보고, SymPy의 기저와 비교.

---

### 마무리 한 줄

> 네 공간은 **해의 존재/유일성, 근사, 투영, 직교성**을 한꺼번에 설명하는 프레임이다.
> RREF/SVD/의사역행렬을 손에 익히면, 어떤 선형문제든 구조가 바로 보인다.
