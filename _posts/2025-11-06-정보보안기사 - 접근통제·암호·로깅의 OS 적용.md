---
layout: post
title: 정보보안기사 - 접근통제·암호·로깅의 OS 적용
date: 2025-11-06 16:25:23 +0900
category: 정보보안기사
---
# 접근통제·암호·로깅의 OS 적용(계정 수명주기, 암호정책, 감사정책)

## 0) 큰 그림(One-Page)

- **접근통제(IA)**: 식별·인증·권한부여. **계정 수명주기(Joiner-Mover-Leaver)** 표준화(템플릿·자동화).
- **암호정책(PW)**: 길이·복잡성·재사용·최대/최소 사용기간·잠금(실패 n회). **정적 비밀 최소화**(MFA/SSO/키/토큰 전환).
- **감사정책(AU)**: **누가(Identity), 언제(Time), 어디서(Source), 무엇을(Action)**. 중앙 수집(WEF/rsyslog/journald/Unified Log),  
  탐지 규칙(프로세스 생성, 권한 상승, 정책 변경)과 **보존/무결성**.

---

# 1) 계정 수명주기(Account Lifecycle)

### 1.1 원칙
- **개인계정 ≠ 관리자계정**(분리), 관리 작업은 `sudo`/`Run as`/JEA로 **승격**.
- **서비스계정**은 비대화형(`nologin`/권한 최소), **암호 자동 회전**(LAPS/gMSA/Keychain/Secrets Manager).
- **그룹기반 권한**: 사용자에게 직접 권한 부여 금지 → **그룹** 단위로.
- **오프보딩**: 즉시 **비활성** → 자격 회수(키/토큰) → 홈/메일/공유 **보관 기간** 정책.

---

## 1.2 Linux: 생성·변경·중지·삭제

### (A) 생성(대화형/비대화형)
```bash
# 대화형 사용자 + 만료/경고 + 기본 셸
sudo useradd -m -s /bin/bash -c "Dev User" devuser
echo "devuser:Init@1234" | sudo chpasswd
sudo chage -M 90 -m 1 -W 14 devuser     # 최대90/최소1/만료 14일 전 경고
sudo usermod -aG wheel devuser          # 필요 시 관리자 그룹(최소화)

# 서비스 계정(비대화형, 홈/디렉터리 관리)
sudo useradd -r -s /usr/sbin/nologin -d /var/lib/myapp -M myapp
sudo install -o myapp -g myapp -d /var/lib/myapp /var/log/myapp
```

### (B) 전환/휴면/퇴사
```bash
# 권한 변경(그룹 이동)
sudo usermod -G appgrp devuser

# 휴면(비활성/만료)
sudo usermod -L devuser                 # 잠금
sudo chage -E 2026-12-31 devuser        # 만료일

# 삭제(데이터 보존은 별도 백업/아카이브 후)
sudo userdel -r devuser
```

### (C) 홈/권한/쉘 보호
```bash
# 홈 디렉터리 권한
sudo chmod 700 /home/devuser
# 비대화형 쉘 강제
sudo usermod -s /usr/sbin/nologin svcbuild
```

---

## 1.3 Windows: 로컬/AD 계정, 그룹, 오프보딩

### (A) 로컬 사용자(랩/단독 서버)
```powershell
# New local user
$pw = Read-Host -AsSecureString "Input Temp Password"
New-LocalUser -Name "svc-backup" -Password $pw -NoPasswordNeverExpires:$false -AccountNeverExpires:$false
# 최소 그룹만
Add-LocalGroupMember -Group "Backup Operators" -Member "svc-backup"
```

### (B) AD 사용자/그룹(권장)
```powershell
Import-Module ActiveDirectory

# 생성(OU/템플릿/속성)
$pw = ConvertTo-SecureString "Init@1234" -AsPlainText -Force
New-ADUser -Name "Kim DoHyun" -SamAccountName dhkim -UserPrincipalName dhkim@corp.local `
  -Path "OU=Users,OU=Seoul,DC=corp,DC=local" -ChangePasswordAtLogon $true `
  -AccountPassword $pw -Enabled $true

# 그룹 기반 권한
Add-ADGroupMember -Identity "App-Readers" -Members dhkim

# 오프보딩
Disable-ADAccount -Identity dhkim
Move-ADObject (Get-ADUser dhkim).DistinguishedName -TargetPath "OU=Disabled,DC=corp,DC=local"
# 그룹 제거(핵심 그룹만)
(Get-ADUser dhkim -Properties memberOf).memberOf | ForEach-Object { Remove-ADGroupMember -Identity $_ -Members dhkim -Confirm:$false }
```

### (C) LAPS / gMSA(서비스/로컬 관리자 비밀 회전)
```powershell
# gMSA 생성(AD, KDS Root 준비 가정)
New-ADServiceAccount -Name gmsaWeb -DNSHostName web01.corp.local -PrincipalsAllowedToRetrieveManagedPassword "WEB-SERVERS"
# 웹 서비스에 계정 연결(IIS AppPool/서비스 계정으로)
```

---

## 1.4 macOS: dscl/관리
```bash
# 사용자 생성
sudo dscl . -create /Users/devuser
sudo dscl . -create /Users/devuser UserShell /bin/zsh
sudo dscl . -create /Users/devuser RealName "Dev User"
sudo dscl . -create /Users/devuser UniqueID 501
sudo dscl . -create /Users/devuser PrimaryGroupID 20
sudo dscl . -create /Users/devuser NFSHomeDirectory /Users/devuser
sudo dscl . -passwd /Users/devuser 'Init@1234'

# 비활성(로그인 금지)
sudo dscl . -create /Users/devuser UserShell /usr/bin/false
```

---

# 2) 암호정책(Password/Lockout/MFA 접점)

> 원칙: **길이 우선 · 재사용 금지 · 잠금 정책 · 사용자 교육**.  
> OS 암호정책과 **MFA/SSO(AD/IdP)**를 결합하고, 서비스계정·API는 **키/토큰**으로 전환.

---

## 2.1 Linux — PAM + pwquality + faillock + aging

### (A) 전역 기본값
`/etc/login.defs`
```ini
PASS_MAX_DAYS   90
PASS_MIN_DAYS   1
PASS_WARN_AGE   14
ENCRYPT_METHOD  SHA512   # (신규 배포판은 yescrypt가 기본인 경우도 있음)
```

### (B) 복잡도/길이(pwquality)
`/etc/security/pwquality.conf`
```ini
minlen = 12
dcredit = -1      # 숫자 1+
ucredit = -1      # 대문자 1+
lcredit = -1      # 소문자 1+
ocredit = -1      # 특수문자 1+
maxrepeat = 3
maxclassrepeat = 4
dictcheck = 1
```

**PAM 연결(배포판별 조금 상이)**  
Debian/Ubuntu: `/etc/pam.d/common-password`
```text
password requisite pam_pwquality.so retry=3
password [success=1 default=ignore] pam_unix.so sha512 shadow use_authtok
```

### (C) 잠금(faillock)
RHEL/Alma/Rocky:
```bash
sudo authselect select sssd with-faillock --force
sudo authselect apply-changes
# /etc/security/faillock.conf
deny=5
unlock_time=900
fail_interval=900
```
Debian/Ubuntu(버전에 따라 구성):
`/etc/pam.d/common-auth`
```text
auth required pam_faillock.so preauth silent deny=5 unlock_time=900 fail_interval=900
auth [success=1 default=bad] pam_unix.so nullok
auth [default=die] pam_faillock.so authfail
account required pam_faillock.so
```

**검증**
```bash
faillock --user devuser          # 잠금 상태 확인
```

### (D) 사용자 별 Aging
```bash
sudo chage -M 90 -m 1 -W 14 devuser
sudo chage -l devuser            # 요약 보기
```

---

## 2.2 Windows — 도메인/로컬 암호·잠금 정책

### (A) 도메인 기본 정책(GPO)
- **최소 길이** ≥ 12, **복잡성** On, **역사(재사용 금지)** ≥ 24, **최대 사용기간** 90일, **최소** 1일.
- **계정 잠금 임계값** 5회, **관찰 기간** 15분, **잠금 시간** 15~30분.

PowerShell(로컬 정책 예: 랩 환경)
```powershell
# 로컬 보안 정책(서버가 도메인이 아니라고 가정)
secedit /export /cfg C:\Temp\secpol.cfg

# net accounts 사용(간단)
net accounts /minpwlen:12 /maxpwage:90 /minpwage:1 /uniquepw:24 /lockoutthreshold:5 /lockoutduration:15 /lockoutwindow:15
```

### (B) Fine-Grained Password Policy(FGPP, 도메인 내 그룹별)
```powershell
New-ADFineGrainedPasswordPolicy -Name "FGPP-Priv-Admin" `
 -Precedence 1 -ComplexityEnabled $true -LockoutDuration (New-TimeSpan -Minutes 30) `
 -LockoutObservationWindow (New-TimeSpan -Minutes 30) -LockoutThreshold 5 `
 -MinPasswordLength 14 -MaxPasswordAge (New-TimeSpan -Days 30) -PasswordHistoryCount 24
Add-ADFineGrainedPasswordPolicySubject -Identity "FGPP-Priv-Admin" -Subjects "Domain Admins"
```

### (C) 스크립트/PowerShell 보안(무관과 같아 보이지만 **인증 회피 경로 차단 핵심**)
```powershell
# PowerShell 로깅
$base='HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell'
New-Item -Path "$base\ScriptBlockLogging" -Force | Out-Null
Set-ItemProperty "$base\ScriptBlockLogging" -Name EnableScriptBlockLogging -Type DWord -Value 1
New-Item -Path "$base\ModuleLogging\ModuleNames" -Force | Out-Null
Set-ItemProperty "$base\ModuleLogging" -Name EnableModuleLogging -Type DWord -Value 1
New-ItemProperty "$base\ModuleLogging\ModuleNames" -Name "*" -PropertyType String -Value "*" -Force | Out-Null

# 프로세스 명령줄 로깅
New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit" -Force | Out-Null
Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit" `
 -Name "ProcessCreationIncludeCmdLine_Enabled" -Type DWord -Value 1
```

---

## 2.3 macOS — pwpolicy/MDM

```bash
# 길이/복잡성 예(로컬)
sudo pwpolicy -setaccountpolicies \
'<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
 "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0"><dict>
  <key>policyCategoryAuthentication</key>
  <array>
    <dict>
      <key>policyContent</key>
      <string>minimumLength:12 requiresNumeric:1 requiresMixedCase:1 requiresSymbol:1</string>
    </dict>
  </array>
</dict></plist>'
```
> 조직 환경에서는 **MDM 구성 프로파일**로 패스코드/스크린락/MFA(Entra/Okta 등)와 연동.

---

# 3) 감사정책(로깅/감사/포워딩)

> “기록되지 않은 보안은 존재하지 않는다.”  
> **정책 변경/인증/권한 상승/프로세스 생성/스크립트 실행/로그 삭제**는 **반드시** 감사.

---

## 3.1 Windows — Advanced Audit Policy + WEF + Sysmon

### (A) Advanced Audit Policy(핵심 서브카테고리)
- **Logon/Logoff**: 4624(성공), 4625(실패), 4634/4647, 4672(특권).
- **Account Logon/Management**: 4768-4771(Kerberos), 4720/4722/4723/4725(계정 변경), 4732/4728(그룹).
- **Object Access**: 민감 파일/레지스트리 SACL.
- **Process Creation**: 4688(명령줄 포함).
- **Policy Change**: 4719(감사정책 변경), 1102(로그 지움).
- **PowerShell**: 4103/4104.

PowerShell: 빠른 구성
```powershell
# 핵심 서브카테고리 On
$subs = @(
"Logon","Account Logon","Account Management","Policy Change",
"Detailed Tracking","DS Access","Object Access","Privilege Use"
)
foreach($s in $subs){ auditpol /set /category:$s /success:enable /failure:enable }

# 4688에 명령줄 로깅(위 2.2C와 중복 확인)
```

### (B) WEF(Windows Event Forwarding)
Collector:
```cmd
wecutil qc         :: Collector 준비
winrm quickconfig  :: 랩/테스트. 운영은 HTTPS/도메인 인증으로.
```
Subscription(보안 로그/PowerShell/작업 스케줄러 등 → `ForwardedEvents`)

### (C) Sysmon(선택)
- **프로세스/네트워크/파일 생성/드라이버 로드** 고해상도 텔레메트리.
- 커뮤니티 **Sysmon config** 기반 → 오탐 튜닝 후 배포.

---

## 3.2 Linux — auditd + journald + rsyslog/relp + osquery(옵션)

### (A) auditd 규칙(예)
`/etc/audit/rules.d/hardening.rules`
```text
# 계정/암호 파일 변경 감시
-w /etc/passwd -p wa -k auth_change
-w /etc/shadow -p wa -k auth_change
-w /etc/group  -p wa -k auth_change

# sudoers/폴더 감시
-w /etc/sudoers -p wa -k sudo_edit
-w /etc/sudoers.d/ -p wa -k sudo_edit

# 정책 파일 감시(ssh/pam)
-w /etc/ssh/sshd_config -p wa -k ssh_conf
-w /etc/pam.d/ -p wa -k pam_conf

# execve 추적(고비용: 선택)
-a always,exit -F arch=b64 -S execve -k exec
-a always,exit -F arch=b32 -S execve -k exec
```
적용/검증
```bash
sudo augenrules --load
sudo systemctl restart auditd
sudo ausearch -k auth_change | tail
sudo aureport -au    # 인증 보고서
```

### (B) journald 지속/용량 제한
`/etc/systemd/journald.conf`
```ini
Storage=persistent
SystemMaxUse=1G
```
```bash
sudo systemctl restart systemd-journald
```

### (C) rsyslog TLS 포워딩
Collector
```conf
# /etc/rsyslog.d/10-input-tls.conf
module(load="imtcp")
input(type="imtcp" port="6514" StreamDriver.Name="gtls" StreamDriver.Mode="1" StreamDriver.Authmode="x509/name")
```
Agent
```conf
# /etc/rsyslog.d/99-remote.conf
*.* @@(o)logs.example.com:6514;RSYSLOG_SyslogProtocol23Format
```

### (D) osquery(옵션) — 정책 준수 점검 쿼리
```sql
-- 잠금 임계/암호 길이 규정 준수(배포판별 테이블 상이, 예시)
SELECT * FROM etc_security_limits WHERE domain='*';
```

---

## 3.3 macOS — Unified Logging + OpenBSM(audit)

### (A) Unified Log(헌팅)
```bash
# 보안 서브시스템 최근 1시간
log show --predicate 'subsystem CONTAINS "com.apple.security"' --last 1h
```

### (B) OpenBSM 감사 활성화
`/etc/security/audit_control`
```text
dir:/var/audit
flags:lo,ad,ex
minfree:20
naflags:lo,ad,ex
```
```bash
sudo launchctl unload /System/Library/LaunchDaemons/com.apple.auditd.plist
sudo launchctl load   /System/Library/LaunchDaemons/com.apple.auditd.plist
# 리포트
sudo auditreduce -m AUE_EXECVE | praudit | tail
```

---

# 4) 엔드투엔드 시나리오

## 시나리오 A — “Linux 웹/앱 서버 표준화: 접근통제·암호·로깅”
1) **계정 템플릿**: `useradd`(대화형) / `-r -s /usr/sbin/nologin`(서비스) → 그룹/디렉터리/권한.  
2) **암호정책**: `pwquality`(minlen 12, class 4), `faillock`(5회/15분), `chage`(90/1/14).  
3) **SSH**: 루트 로그인 금지, 패스워드 인증 Off, 키만 허용, `AllowUsers` 화이트리스트.  
4) **감사**: `auditd` 핵심 파일/execve, journald 영속, rsyslog TLS 포워딩.  
5) **검증**: 실패 로그인 5회 잠금, `ausearch -k`, 중앙 수집에서 대시보드 확인.  
6) **롤백**: PAM/sshd/audit 규칙 백업 복원.

## 시나리오 B — “Windows 도메인 서버: FGPP + Advanced Audit + WEF”
1) **암호**: 도메인 기본 12/90/24, **FGPP**로 Admin 14/30/24/잠금 강화.  
2) **감사**: 고급 감사정책 카테고리 전부 Success/Failure, 4688 명령줄, PS 로깅.  
3) **포워딩**: **WEF** 구독(보안/PowerShell/작업스케줄러).  
4) **검증**: 4624/4625/4688/4719/1102 이벤트 실시간 유입, 알림 규칙.  
5) **롤백**: GPO 링크 해제/백업, WEF 구독 비활성.

## 시나리오 C — “오프보딩(Leaver) 자동화”
- **Disable + Move**(Disabled OU) → 그룹 탈퇴 → 토큰/SSH키/앱 접근 회수 → 홈/메일 보관 정책 → 알림.  
PowerShell(발췌)
```powershell
param([string]$Sam)
Disable-ADAccount $Sam
Move-ADObject (Get-ADUser $Sam).DistinguishedName -TargetPath "OU=Disabled,DC=corp,DC=local"
(Get-ADUser $Sam -Properties memberOf).memberOf | % { Remove-ADGroupMember $_ $Sam -Confirm:$false }
```

---

# 5) 검증·헌팅·보고 쿼리

## 5.1 Windows
```powershell
# 최근 24h 특권 로그온(4672) 사용 계정 Top
$start=(Get-Date).AddDays(-1)
Get-WinEvent -FilterHashtable @{LogName='Security'; Id=4672; StartTime=$start} |
Group-Object {$_.Properties[1].Value} | Sort Count -Desc | Select Name,Count

# PowerShell -enc 탐지(4104/4688)
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; StartTime=$start} |
? { $_.Message -match "-enc" -or $_.Message -match "FromBase64String" } |
Select TimeCreated,Message
```

## 5.2 Linux
```bash
# 최근 1h sudo 실패/성공 요약
sudo ausearch -m USER_AUTH -ts recent | aureport -au -i | tail

# 비정상 리스닝 포트(허용 목록 외)
ss -ltnp | awk '$4 !~ /:22|:80|:443|:5432|:3306/'
```

## 5.3 macOS
```bash
# 최근 1h 보안 관련 로그 키워드
log show --predicate '(eventMessage CONTAINS "exec" OR eventMessage CONTAINS "auth")' --last 1h
```

---

# 6) 자동화 번들(발췌)

## 6.1 Ansible — Linux 암호·감사·ssh 하드닝
```yaml
- hosts: linux_all
  become: true
  tasks:
    - name: login.defs
      lineinfile:
        path: /etc/login.defs
        regexp: "^{{ item.key }}\\s+"
        line: "{{ item.key }} {{ item.val }}"
      loop:
        - { key: PASS_MAX_DAYS, val: 90 }
        - { key: PASS_MIN_DAYS, val: 1 }
        - { key: PASS_WARN_AGE, val: 14 }

    - name: pwquality.conf
      copy:
        dest: /etc/security/pwquality.conf
        content: |
          minlen=12
          dcredit=-1
          ucredit=-1
          lcredit=-1
          ocredit=-1
          maxrepeat=3
          dictcheck=1

    - name: sshd_config
      copy:
        dest: /etc/ssh/sshd_config
        content: |
          Protocol 2
          PermitRootLogin no
          PasswordAuthentication no
          PubkeyAuthentication yes
          ClientAliveInterval 300
          ClientAliveCountMax 2
      notify: Reload sshd

    - name: audit rules
      copy:
        dest: /etc/audit/rules.d/hardening.rules
        content: |
          -w /etc/passwd -p wa -k auth_change
          -w /etc/shadow -p wa -k auth_change
          -w /etc/sudoers -p wa -k sudo_edit
          -w /etc/ssh/sshd_config -p wa -k ssh_conf
          -a always,exit -F arch=b64 -S execve -k exec
          -a always,exit -F arch=b32 -S execve -k exec
      notify:
        - Load audit
        - Restart auditd

  handlers:
    - name: Reload sshd
      service: { name: sshd, state: reloaded }
    - name: Load audit
      command: augenrules --load
    - name: Restart auditd
      service: { name: auditd, state: restarted }
```

## 6.2 PowerShell — 로깅/잠금/정책(로컬)
```powershell
# 잠금 정책
net accounts /lockoutthreshold:5 /lockoutduration:15 /lockoutwindow:15
# 패스워드
net accounts /minpwlen:12 /uniquepw:24 /maxpwage:90 /minpwage:1

# 고급 감사
$a = @(
  "Logon","Account Logon","Account Management","Policy Change",
  "Detailed Tracking","DS Access","Object Access","Privilege Use"
)
$a | % { auditpol /set /category:$_ /success:enable /failure:enable }

# 4688 명령줄 + PS 로깅(위 섹션 참고)
```

---

# 7) 체크리스트(운영 점검)

**계정 수명주기**
- [ ] JML 자동화(생성/권한/이동/퇴사)  
- [ ] 서비스계정 비대화형 + 자동 회전(LAPS/gMSA/Secrets)  
- [ ] 그룹 기반 권한, 직접 부여 금지

**암호정책**
- [ ] 최소 길이≥12, 복잡성, 재사용 24, 90/1/14  
- [ ] 잠금 5회/15분, 실패 관찰 15분  
- [ ] MFA/SSO 연계(콘솔/원격/특권)

**감사정책**
- [ ] Windows: 4624/4625/4672/4688/4719/1102 + 4103/4104  
- [ ] Linux: passwd/shadow/sudoers/sshd_config + execve/audit 보고  
- [ ] macOS: OpenBSM flags + Unified Log  
- [ ] 중앙 수집(WEF/rsyslog), 보존/무결성/권한

**검증/보고**
- [ ] 실패 잠금 테스트, 정책 유효성 보고서  
- [ ] 관리자 로그인/정책 변경 알림  
- [ ] 분기별 샘플 감사를 통한 오탐/누락 보정

---

# 8) 트러블슈팅 & 롤백

- **Linux 로그인 불가(FAIILOCK 과도)**: `faillock --user <u> --reset`. PAM 백업 복원.  
- **Windows 이벤트 과다**: 채널/필드 샘플링, 구독 필터 조정, 보존 기간·압축·아카이브.  
- **macOS 감사 용량**: `minfree`↑, 주기 아카이브.  
- **정책 충돌**: GPO 상속/우선순위, PAM 스택 순서 확인.  
- **성능**: execve 전체 추적은 비용 큼 → 위험 구간만(예: `/usr/bin/sudo`, `/bin/sh`).

롤백 스니펫
```bash
# PAM/SSH
sudo cp /etc/pam.d/common-auth.bak /etc/pam.d/common-auth
sudo cp /etc/ssh/sshd_config.bak /etc/ssh/sshd_config
sudo systemctl reload sshd
```
```powershell
# GPO 링크/로컬 정책 되돌리기
secedit /configure /db secedit.sdb /cfg C:\Temp\secpol.cfg
```

---

# 9) 요약(암기 포인트)

- **접근통제**: 계정 분리·그룹 권한·서비스계정 비대화형·오프보딩 자동화.  
- **암호정책**: 길이·복잡성·재사용·기간·잠금 → MFA/SSO와 결합.  
- **감사정책**: 프로세스/정책/인증/권한 이벤트 **필수** + 중앙 포워딩/보존.  
- **운영**: 파일럿→링 배포→지표/알림→분기 리뷰. **백업/롤백** 경로를 항상 준비.
