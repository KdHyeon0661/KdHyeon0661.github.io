---
layout: post
title: 미적분 - 연쇄법칙의 증명
date: 2025-08-02 17:20:23 +0900
category: 미적분
---
# 연쇄법칙(Chain Rule)

연쇄법칙은 “**합성함수의 미분 = 바깥 미분 × 안쪽 미분**”이라는 간명한 한 줄로 요약되지만,  
**증명 방식**(극한/평균값정리/작은-o/선형사상)과 **적용 범위(다변수, 야코비안)**, **실패/예외 사례**까지 알면 훨씬 탄탄해집니다.

---

## 1) 정식 진술 (일변수)

함수 \(f, g:\mathbb{R}\to\mathbb{R}\) 가 주어지고 \(x\in\mathbb{R}\)에서  
- \(g\) 가 미분 가능,  
- \(f\) 가 \(g(x)\) 에서 미분 가능이면,

$$
\frac{d}{dx}\,f\!\big(g(x)\big) \;=\; f'\!\big(g(x)\big)\cdot g'(x).
$$

---

## 2) 표준 극한 분해 증명 (라디안·연속성 유의)

**아이디어**: 차분비를 두 조각으로 나눠 각각 극한을 보낸다.

$$
\begin{aligned}
\frac{d}{dx}f(g(x))
&= \lim_{h\to 0}\frac{f(g(x+h))-f(g(x))}{h}\\[4pt]
&= \lim_{h\to 0}\left[
\frac{f(g(x+h))-f(g(x))}{\,g(x+h)-g(x)\,}\;\cdot\;
\frac{g(x+h)-g(x)}{h}
\right].
\end{aligned}
$$

- 첫 항은 \(u=g(x+h)\to g(x)\) 이므로 $$\displaystyle \lim_{h\to0}\frac{f(g(x+h)) - f(g(x))}{g(x+h)-g(x)} = f'(g(x)).$$
- 둘째 항은 정의 그대로 $$\displaystyle \lim_{h\to0}\frac{g(x+h)-g(x)}{h} = g'(x).$$

따라서 곱의 극한으로 결론이 따라옵니다.  
> **주의 1**: 드물게 \(g(x+h)=g(x)\) 가 무한히 자주 발생하는 경우(예: 국소적으로 상수)도 있으나, 그때는 \(g'(x)=0\) 이고 전체 극한도 0으로 정리됩니다.  
> **주의 2**: 위 증명은 \(f\) 가 \(g(x)\) 에서 미분 가능(=연속)임을 사용합니다.

---

## 3) 평균값정리(MVT) 기반 증명 (연속적 도함수 가정)

\(h\neq 0\) 에 대해 \(u_h=g(x+h)\), \(u_0=g(x)\) 라 두면, 평균값정리에 의해
$$
\frac{f(u_h)-f(u_0)}{u_h-u_0}=f'(\xi_h)
$$
인 \(\xi_h\) 가 \(u_h\) 와 \(u_0\) 사이에 존재합니다. 그러면
$$
\frac{f(g(x+h))-f(g(x))}{h} \;=\; f'(\xi_h)\cdot \frac{g(x+h)-g(x)}{h}.
$$
\(h\to 0\) 이면 \(\xi_h\to g(x)\) (여기서 \(f'\) 의 연속성 사용), 따라서
$$
\lim_{h\to0}\frac{f(g(x+h))-f(g(x))}{h} = f'(g(x))\cdot g'(x).
$$

---

## 4) 작은-o(리틀-o) / 카라테오도리(Caratheodory) 방식

미분 가능을 **선형 근사 + 더 작은 항**으로 쓰면,
- \(g(x+h) = g(x) + g'(x)\,h + o(h)\),
- \(f(g(x)+k) = f(g(x)) + f'(g(x))\,k + o(k)\).

여기서 \(k=g(x+h)-g(x)=g'(x)h+o(h)\). 대입하면
$$
\begin{aligned}
f(g(x+h)) - f(g(x))
&= f'(g(x))\,[g'(x)h+o(h)] + o\!\big(g'(x)h+o(h)\big)\\
&= f'(g(x))g'(x)\,h + o(h).
\end{aligned}
$$
따라서
$$
\frac{f(g(x+h)) - f(g(x))}{h} \to f'(g(x))\,g'(x).
$$

> **장점**: \(f'\) 의 연속성 가정이 불필요(진정한 “미분 가능”만으로 충분).

---

## 5) 선형사상(프레셰 미분) 관점 → 다변수 곧장 확장

실함수 대신 **벡터**로 보자. \(g:\mathbb{R}^m\to\mathbb{R}^n\), \(f:\mathbb{R}^n\to\mathbb{R}^p\).  
각 점에서 미분(=최적의 선형사상) \(Dg(x)\in\mathbb{R}^{n\times m}\), \(Df(g(x))\in\mathbb{R}^{p\times n}\) 가 존재하면

$$
D(f\circ g)(x) \;=\; Df\!\big(g(x)\big)\;\cdot\;Dg(x).
$$

**스케치**:  
\(g(x+h)=g(x)+Dg(x)\,h + r_g(h)\), \(\|r_g(h)\|=\!o(\|h\|)\).  
\(f(g(x)+k)=f(g(x))+Df(g(x))\,k + r_f(k)\), \(\|r_f(k)\|=\!o(\|k\|)\).  
합성하면 잔차는 \(o(\|h\|)\) 로 정리 → 곧장 야코비안 곱.

---

## 6) 다변수 연쇄법칙(성분/야코비안 버전)

### 6-1) 스칼라 출력 \(z=f(x_1,\dots,x_n)\), 매개변수 \(x_i=x_i(t)\)
$$
\frac{dz}{dt} \;=\; \sum_{i=1}^{n}\frac{\partial f}{\partial x_i}\,\frac{dx_i}{dt}.
$$

### 6-2) 행렬식(야코비안) 버전
\(y=f(u)\), \(u=g(x)\) 일 때
$$
J_{y}(x) \;=\; J_f(u)\Big|_{u=g(x)}\;\cdot\;J_g(x).
$$

> **그래디언트 형태**: \(\nabla(f\circ g)(x)= J_g(x)^\top\,\nabla f(g(x))\).

---

## 7) 암묵미분/역함수 정리: 연쇄법칙의 즉시 응용

### 7-1) 암묵미분
\(F(x,y(x))=0\). 양변을 \(x\) 로 미분(연쇄법칙):
$$
F_x + F_y\,y'(x)=0 \;\;\Rightarrow\;\; y'(x)=-\frac{F_x}{F_y}.
$$
**예**: \(x^2+y^2=1\) 에서 \(y'=-x/y\) (단, \(y\neq 0\)).

### 7-2) 역함수 도함수
\(f\) 가 가역이고 \(f'(x_0)\neq 0\). \(f(f^{-1}(y))=y\) 를 미분:
$$
f'\!\big(f^{-1}(y)\big)\cdot (f^{-1})'(y)=1 \;\Rightarrow\; (f^{-1})'(y)=\frac{1}{f'(x)}.
$$

---

## 8) 연쇄법칙이 **실패하거나** 그대로 쓸 수 없는 상황

- **\(f\) 가 \(g(x_0)\) 에서 미분 불가**:  
  예: \(f(u)=|u|\) 은 \(u=0\) 에서 미분 불가. 그런데 \(g(x)=x^2\) 이면 \(f(g(x))=|x^2|=x^2\) 는 \(x=0\) 에서 미분 가능.  
  이때 **연쇄법칙 공식을 그대로 쓰면 안 됩니다**(바깥 미분이 정의되지 않음).  
  실제 도함수는 0 이지만, \(f'(g(0))\) 가 존재하지 않습니다.
- **\(g\) 가 \(x_0\) 에서 미분 불가**: 당연히 적용 불가.
- **벡터형에서 순서 혼동**: \(J_{f\circ g}=J_f\cdot J_g\) (반대 아님).

---

## 9) 예제 모음 (풀이 포함)

### 9-1) 일변수 합성
- \(y=\sin(x^2+3x)\)  
  $$y'=\cos(x^2+3x)\cdot(2x+3).$$
- \(y=\sqrt{3x+1}=\,(3x+1)^{1/2}\)  
  $$y'=\tfrac12(3x+1)^{-1/2}\cdot 3 = \frac{3}{2\sqrt{3x+1}}.$$

### 9-2) 곱/합성 섞임
- \(y=e^{2x}\sin(5x^2)\)  
  $$y'=\underbrace{2e^{2x}}_{\text{밖: }e^{2x}}\sin(5x^2)+e^{2x}\cdot\underbrace{\cos(5x^2)\cdot10x}_{\text{안: }\sin(5x^2)}.$$

### 9-3) 다변수 스칼라 → 시간 매개
- \(z=f(x,y)=x^2y+e^{xy}\), \(x=t^2\), \(y=\sin t\)  
  $$
  \frac{dz}{dt}
  = f_x\,x' + f_y\,y'
  = (2xy + ye^{xy})\cdot 2t + (x^2 + x e^{xy})\cdot \cos t.
  $$

### 9-4) 야코비안 곱
- \(g:\mathbb{R}^2\to\mathbb{R}^2,\; g(u,v)=(u^2+v,\, e^u\sin v)\)  
- \(f:\mathbb{R}^2\to\mathbb{R},\; f(x_1,x_2)=x_1x_2\)  
  \(\Rightarrow J_f=[x_2\; x_1]\), \(J_g=\begin{bmatrix}2u&1\\ e^u\sin v & e^u\cos v\end{bmatrix}\).  
  따라서 \(J_{f\circ g} = J_f|_{g(u,v)}\cdot J_g(u,v)\).

---

## 10) 체크리스트

- [ ] **바깥 \(f\)**: \(g(x_0)\) 에서 미분 가능?  
- [ ] **안쪽 \(g\)**: \(x_0\) 에서 미분 가능?  
- [ ] (다변수) **행렬 곱의 순서** 확인: \(J_f(g(x))\,J_g(x)\).  
- [ ] (수치검증) **근사 미분**과 심벌 미분 일치?

---

## 11) 코드로 확인 (NumPy/SymPy)

> 아래 코드는 교육용으로, 수치 근사와 상징 미분 결과를 대조합니다.

### 11-1) 수치 미분으로 \( \dfrac{d}{dx}\sin(x^2+3x) \) 검증
```python
import numpy as np

def f(x): return np.sin(x*x + 3*x)
def f_chain(x): return np.cos(x*x + 3*x) * (2*x + 3)

def dnum(g, x, h=1e-6):
    return (g(x+h) - g(x-h)) / (2*h)

xs = np.linspace(-2, 2, 5)
for x in xs:
    num = dnum(f, x)
    tru = f_chain(x)
    print(f"x={x:+.2f}  num={num:+.8f}  true={tru:+.8f}  err={abs(num-tru):.2e}")
```

### 11-2) SymPy로 합성, 다변수 체인 룰 확인
```python
import sympy as sp

x, t, u, v = sp.symbols('x t u v')
y = sp.sin(x**2 + 3*x)                 # 1D 합성
print('d/dx sin(x^2+3x) =', sp.diff(y, x).simplify())

# 다변수: z=f(x,y)=x^2*y+exp(x*y), x=t^2, y=sin t
t = sp.symbols('t')
x_t = t**2
y_t = sp.sin(t)
z = (x_t**2)*y_t + sp.exp(x_t*y_t)
dzdt = sp.diff(z, t).simplify()
print('dz/dt =', dzdt)
```

---

## 12) 직관 요약 그림(말로)

- 입력 \(x\) → **안쪽** \(g\) → 중간값 \(u=g(x)\) → **바깥** \(f\) → 출력 \(y\).  
- 아주 작은 변화 \(dx\) 가 먼저 \(du=g'(x)\,dx\) 로 바뀌고, 다시 \(dy=f'(u)\,du\) 로 바뀜.  
- 곱해서 \(dy = f'(g(x))\,g'(x)\,dx\). 이것이 **선형 근사의 합성**.

---

## 13) 한 줄 결론

> **연쇄법칙은 “선형 근사(미분)의 합성은 곱”이라는 사실**을 다양한 관점(극한, MVT, 작은-o, 야코비안)으로 확인한 것.  
> 실전에서는 **조건(어디서 미분 가능한가)**, **행렬 곱의 순서**, **예외 사례**만 확실히 챙기면 됩니다.