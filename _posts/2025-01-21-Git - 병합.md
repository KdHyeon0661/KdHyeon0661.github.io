---
layout: post
title: Git - merge
date: 2025-01-21 20:20:23 +0900
category: Git
---
# Git 브랜치 병합(Merge)

## 병합의 이해와 목적

브랜치 병합은 Git에서 가장 중요한 작업 중 하나로, 독립적으로 개발된 기능을 메인 코드베이스에 통합하는 과정입니다. 이 작업을 통해 팀원들이 각자 작업한 내용을 하나의 안정적인 코드베이스로 합칠 수 있습니다.

병합은 단순히 코드를 합치는 것 이상의 의미를 가집니다. 변경 이력의 구조를 결정하고, 코드 리뷰 과정을 완료하며, 향후 디버깅과 유지보수를 위한 명확한 역사를 남깁니다.

---

## 기본 병합 명령어

가장 기본적인 병합 작업은 다음과 같이 수행합니다.

```bash
# 메인 브랜치로 이동
git checkout main

# 기능 브랜치 병합
git merge feature/login
```

이 명령은 `feature/login` 브랜치의 모든 변경사항을 `main` 브랜치에 통합합니다.

---

## Fast-forward 병합 vs 병합 커밋

Git은 두 가지 주요 병합 방식을 제공하며, 상황에 따라 적절한 방식을 선택할 수 있습니다.

### Fast-forward 병합
메인 브랜치가 병합 대상 브랜치의 직접적인 조상인 경우 발생합니다. Git은 단순히 브랜치 포인터를 앞으로 이동시키며 새로운 병합 커밋을 생성하지 않습니다.

```text
A---B---C (main)
         \
          D---E (feature)

# Fast-forward 병합 후
A---B---C---D---E (main)
```

Fast-forward 병합만 허용하려면:
```bash
git merge --ff-only feature/login
```

### 병합 커밋 생성 (Non-Fast-forward)
두 브랜치가 각기 다른 방향으로 발전한 경우, Git은 새로운 병합 커밋을 생성하여 변경사항을 통합합니다.

```text
A---B---C-----F (main)
     \     /
      D---E (feature)   # F: 병합 커밋
```

병합 커밋을 강제로 생성하려면:
```bash
git merge --no-ff feature/login
```

---

## 스쿼시 병합(Squash Merge)

여러 개의 커밋을 하나의 커밋으로 압축하여 병합하는 방식입니다. PR(풀 리퀘스트) 리뷰 과정을 거친 기능을 하나의 논리적 단위로 메인 브랜치에 추가할 때 유용합니다.

```bash
git checkout main
git merge --squash feature/payment
git commit -m "feat(payment): 신규 결제 모듈 추가"
```

**스쿼시 병합의 장점**:
- 메인 브랜치의 히스토리를 깔끔하게 유지
- "한 기능 = 한 커밋" 원칙 준수
- WIP(작업 중) 커밋이나 시도적 변경사항이 메인 히스토리를 어지럽히지 않음

**주의사항**:
- 원본 브랜치의 개별 커밋 히스토리가 사라짐
- `git blame`으로 특정 라인의 변경 역사를 추적하기 어려울 수 있음
- 병합 후 원본 브랜치를 계속 사용하려면 재동기화가 필요

---

## 병합 충돌 해결

두 브랜치에서 동일한 파일의 동일한 부분을 수정한 경우 병합 충돌이 발생합니다. Git은 자동으로 병합할 수 없으므로 수동 해결이 필요합니다.

### 충돌 해결 과정
```bash
# 병합 시도
git merge feature/banner

# 충돌 발생 시
# CONFLICT (content): Merge conflict in src/ui/Header.tsx

# 충돌 파일을 편집기로 열어 수정
# <<<<<<< HEAD
# 현재 브랜치의 내용
# =======
# 병합 대상 브랜치의 내용
# >>>>>>> feature/banner

# 충돌 해결 후
git add src/ui/Header.tsx
git commit -m "resolve: 배너와 헤더 충돌 해결"
```

### 시각적 도구 활용
충돌 해결을 위한 GUI 도구를 사용할 수 있습니다.
```bash
git mergetool
```

사용할 도구를 미리 설정하려면:
```bash
git config --global merge.tool meld
```

### 병합 중단
충돌 해결을 중단하고 원래 상태로 돌아가려면:
```bash
git merge --abort
```

---

## 병합 전 준비 작업

병합 충돌을 최소화하기 위한 사전 준비 작업이 중요합니다.

```bash
# 메인 브랜치를 최신 상태로 유지
git checkout main
git pull --rebase origin main

# 기능 브랜치를 메인 브랜치 기준으로 리베이스
git checkout feature/x
git rebase main

# 충돌 해결 후 메인 브랜치로 병합
git checkout main
git merge feature/x
```

**중요**: 리베이스는 공유 브랜치에서 사용하면 안 됩니다. 리베이스는 커밋 히스토리를 재작성하므로, 다른 팀원들이 이미 가져간 브랜치에 대해 수행하면 심각한 문제를 일으킬 수 있습니다.

---

## 병합 실수 되돌리기

병합 후 문제가 발견되면 적절한 방법으로 되돌릴 수 있습니다.

### 병합 커밋 되돌리기 (revert)
이미 원격 저장소에 푸시된 병합을 안전하게 되돌리는 방법입니다.
```bash
git revert -m 1 <병합-커밋-SHA>
```
`-m 1` 옵션은 첫 번째 부모(메인 브랜치)를 기준으로 되돌리겠다는 의미입니다.

### 강제 되돌리기 (reset)
아직 공유되지 않은 로컬 병합을 완전히 삭제하는 방법입니다.
```bash
git reset --hard <되돌릴-커밋-SHA>
git push --force-with-lease
```
이 방법은 히스토리를 재작성하므로, 팀원들과 사전 협의가 필수입니다.

---

## 특수 파일 유형 병합

### 바이너리 파일
이미지, PDF, 컴파일된 파일 등 바이너리 파일은 자동 병합이 불가능합니다. 한쪽 버전을 선택하거나 수동으로 새 파일을 생성해야 합니다.

`.gitattributes` 파일을 통해 바이너리 파일 처리 방식을 설정할 수 있습니다.
```
*.png binary
*.psd -diff -merge
```

### 서브모듈
서브모듈이 포함된 경우, 각 브랜치가 서로 다른 서브모듈 커밋을 참조하면 충돌이 발생합니다.
```bash
# 서브모듈 디렉터리로 이동
cd modules/libA

# 원하는 커밋으로 체크아웃
git checkout <원하는-커밋-SHA>

# 상위 저장소에 반영
cd ../..
git add modules/libA
git commit -m "fix: libA 서브모듈 버전 업데이트"
```

---

## 병합 전략 선택 가이드

### Merge Commit 사용 시기
- 브랜치의 개발 역사를 보존해야 할 때
- 팀원들이 브랜치의 생성부터 병합까지의 전체 흐름을 이해해야 할 때
- GitHub PR에서 "Merge pull request" 옵션을 사용할 때

### Squash Merge 사용 시기
- 기능 개발 중 생성된 많은 WIP 커밋을 정리하고 싶을 때
- PR 단위로 코드 변경을 관리하고 싶을 때
- 깔끔한 선형 히스토리를 유지하고 싶을 때

### Rebase and Merge 사용 시기
- 엄격하게 선형 히스토리를 유지해야 할 때
- 개인 브랜치를 정리한 후 메인 브랜치에 통합할 때
- 충돌 해결 능력이 있는 팀에서 사용할 때

---

## 실전 시나리오

### 시나리오 1: 기능 개발 완료 후 병합
```bash
# 최신 메인 브랜치 가져오기
git checkout main
git pull origin main

# 기능 브랜치 병합 (병합 커밋 생성)
git merge --no-ff feature/search

# 원격 저장소에 푸시
git push origin main
```

### 시나리오 2: 바이너리 파일 충돌 해결
```bash
# 충돌 발생 시 한쪽 버전 선택
git checkout --ours path/to/image.png   # 현재 브랜치 버전 선택
# 또는
git checkout --theirs path/to/image.png # 대상 브랜치 버전 선택

git add path/to/image.png
git commit -m "fix: 이미지 충돌 해결"
```

### 시나리오 3: 병합 실패 후 재시도
```bash
# 병합 중단
git merge --abort

# 메인 브랜치 최신화
git pull --rebase origin main

# 기능 브랜치 리베이스 (개인 브랜치인 경우)
git checkout feature/login
git rebase main

# 충돌 해결 후 다시 병합
git checkout main
git merge feature/login
```

---

## 마무리

Git 병합은 단순한 기술적 작업 이상의 의미를 가집니다. 이는 팀의 협업 방식, 코드 리뷰 문화, 그리고 소프트웨어 개발 철학을 반영합니다.

**기억해야 할 핵심 원칙**:

1. **팀 규칙을 우선시하세요**: 어떤 병합 전략을 사용할지는 팀 합의가 가장 중요합니다.
2. **충돌은 자연스러운 현상입니다**: 충돌이 발생하는 것은 팀원들이 동시에 활발하게 작업하고 있다는 증거입니다.
3. **사전 예방이 최선입니다**: 정기적으로 메인 브랜치와 동기화하고, 작은 단위로 자주 병합하면 충돌 규모를 줄일 수 있습니다.
4. **히스토리는 중요합니다**: 선택한 병합 방식이 미래의 디버깅과 유지보수에 영향을 미칩니다.
5. **실수는 되돌릴 수 있습니다**: `revert` 명령어를 활용하면 안전하게 병합을 취소할 수 있습니다.

적절한 병합 전략을 선택하고, 충돌을 두려워하지 않으며, 팀원들과 지속적으로 소통하는 것이 성공적인 Git 협업의 핵심입니다. 병합은 코드를 통합하는 기술적 과정일 뿐만 아니라, 팀워크와 소프트웨어 품질을 관리하는 중요한 도구입니다.