---
layout: post
title: Avalonia - ë²„íŠ¼ í™•ì¥
date: 2025-01-06 20:20:23 +0900
category: Avalonia
---
# ğŸ”˜ Avalonia ë²„íŠ¼ í™•ì¥ ê¸°ëŠ¥ ì´ì •ë¦¬ (ë‹¤ì´ì–¼ë¡œê·¸, ì• ë‹ˆë©”ì´ì…˜, í˜ì´ì§€ ì „í™˜ ë“±)

Avalonia MVVM êµ¬ì¡°ì—ì„œ ë²„íŠ¼ í´ë¦­ê³¼ í•¨ê»˜ ìì£¼ ì“°ëŠ” ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ§© í¬í•¨ ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| 1ï¸âƒ£ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ | ë©”ì‹œì§€ ë°•ìŠ¤, íŒŒì¼ ì—´ê¸° ë“± |
| 2ï¸âƒ£ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ | ì²˜ë¦¬ ì¤‘ ìŠ¤í”¼ë„ˆë‚˜ í…ìŠ¤íŠ¸ |
| 3ï¸âƒ£ í™•ì¸ì°½(Yes/No) | ì‚¬ìš©ì ì…ë ¥ í™•ì¸ |
| 4ï¸âƒ£ ë·° ì „í™˜ | ContentControlì„ ì´ìš©í•œ í™”ë©´ ì „í™˜ |

---

## ğŸ“ êµ¬ì¡° ê°œìš”

```
MyAvaloniaApp/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ MainView.axaml
â”‚   â”œâ”€â”€ SettingsView.axaml
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ MainViewModel.cs
â”‚   â”œâ”€â”€ SettingsViewModel.cs
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ IDialogService.cs
```

---

## 1ï¸âƒ£ ë‹¤ì´ì–¼ë¡œê·¸ ë„ìš°ê¸°

### ğŸ”§ DialogService

```csharp
public interface IDialogService
{
    Task ShowMessageAsync(string title, string message);
    Task<bool> ShowConfirmAsync(string title, string message);
}
```

```csharp
public class DialogService : IDialogService
{
    public async Task ShowMessageAsync(string title, string message)
    {
        var dialog = new Window
        {
            Title = title,
            Content = new TextBlock { Text = message, Margin = new Thickness(20) },
            Width = 300,
            Height = 150,
            WindowStartupLocation = WindowStartupLocation.CenterScreen
        };
        await dialog.ShowDialog(App.Current.ApplicationLifetime as IClassicDesktopStyleApplicationLifetime);
    }

    public async Task<bool> ShowConfirmAsync(string title, string message)
    {
        var result = MessageBox.Avalonia.MessageBoxManager
            .GetMessageBoxStandardWindow(title, message, MessageBox.Avalonia.Enums.ButtonEnum.YesNo);
        var res = await result.Show();
        return res == MessageBox.Avalonia.Enums.ButtonResult.Yes;
    }
}
```

> ğŸ’¡ `MessageBox.Avalonia` NuGet íŒ¨í‚¤ì§€ í•„ìš”

---

## 2ï¸âƒ£ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜

ViewModelì—ì„œ `IsBusy` ìƒíƒœë¥¼ ë°”ì¸ë”©í•©ë‹ˆë‹¤.

```csharp
private bool _isBusy;
public bool IsBusy
{
    get => _isBusy;
    set => this.RaiseAndSetIfChanged(ref _isBusy, value);
}
```

```csharp
public ReactiveCommand<Unit, Unit> LoadCommand { get; }

public MainViewModel()
{
    LoadCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        IsBusy = true;
        await Task.Delay(2000); // ì‘ì—… ì¤‘
        IsBusy = false;
    });
}
```

```xml
<Button Content="ë°ì´í„° ë¡œë“œ" Command="{Binding LoadCommand}" />
<TextBlock Text="ë¡œë”© ì¤‘..." IsVisible="{Binding IsBusy}" Foreground="Red"/>
```

---

## 3ï¸âƒ£ í™•ì¸ì°½ Yes/No

```csharp
public ReactiveCommand<Unit, Unit> ConfirmCommand { get; }

public MainViewModel(IDialogService dialogService)
{
    ConfirmCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        var confirmed = await dialogService.ShowConfirmAsync("ì‚­ì œ", "ì •ë§ ì‚­ì œí• ê¹Œìš”?");
        if (confirmed)
            await dialogService.ShowMessageAsync("ê²°ê³¼", "ì‚­ì œ ì™„ë£Œ!");
        else
            await dialogService.ShowMessageAsync("ê²°ê³¼", "ì·¨ì†Œë¨.");
    });
}
```

---

## 4ï¸âƒ£ View ì „í™˜ (í˜ì´ì§€ ë³€ê²½)

### ğŸ”§ ViewModel ì „í™˜

```csharp
private ViewModelBase _currentViewModel;
public ViewModelBase CurrentViewModel
{
    get => _currentViewModel;
    set => this.RaiseAndSetIfChanged(ref _currentViewModel, value);
}
```

```csharp
public ReactiveCommand<Unit, Unit> GoSettingsCommand { get; }

public MainViewModel()
{
    CurrentViewModel = new DashboardViewModel();

    GoSettingsCommand = ReactiveCommand.Create(() =>
    {
        CurrentViewModel = new SettingsViewModel();
    });
}
```

### ğŸ“„ MainView.axaml

```xml
<StackPanel>
    <Button Content="ì„¤ì •ìœ¼ë¡œ ì´ë™" Command="{Binding GoSettingsCommand}" />
    <ContentControl Content="{Binding CurrentViewModel}" />
</StackPanel>
```

### ğŸ“„ App.axamlì˜ DataTemplate ë“±ë¡

```xml
<Application.DataTemplates>
    <DataTemplate DataType="{x:Type vm:DashboardViewModel}">
        <views:DashboardView />
    </DataTemplate>
    <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
        <views:SettingsView />
    </DataTemplate>
</Application.DataTemplates>
```

---

## ğŸ§  í™•ì¥ íŒ

| ê¸°ëŠ¥ | ê¸°ìˆ  |
|------|------|
| Spinner ë„£ê¸° | `ProgressRing` or ì• ë‹ˆë©”ì´ì…˜ ì´ë¯¸ì§€ ì‚¬ìš© |
| ë‹¤ì´ì–¼ë¡œê·¸ì— ì…ë ¥ì°½ í¬í•¨ | Custom Window ë§Œë“¤ê¸° |
| Navigation êµ¬ì¡° ê´€ë¦¬ | `INavigationService`ë¡œ ì¶”ìƒí™” |
| ì—¬ëŸ¬ ì°½ ë„ìš°ê¸° | `Show()` ë˜ëŠ” `ShowDialog()` ì‚¬ìš© |

---

## âœ… ì •ë¦¬

| ê¸°ëŠ¥ | í•µì‹¬ ê¸°ìˆ  | MVVM ì²˜ë¦¬ ë°©ì‹ |
|------|------------|----------------|
| ë‹¤ì´ì–¼ë¡œê·¸ | MessageBox.Avalonia | DialogServiceë¡œ ë¶„ë¦¬ |
| ë¡œë”© í‘œì‹œ | IsBusy, Task.Delay | ìƒíƒœ ë°”ì¸ë”© |
| í™•ì¸ì°½ | Custom Confirm or MessageBox | await + ì¡°ê±´ |
| í˜ì´ì§€ ì „í™˜ | ContentControl + DataTemplate | ViewModel êµì²´ |

---

## â–¶ï¸ ë‹¤ìŒ í™•ì¥ ì•„ì´ë””ì–´

- ì…ë ¥ í¼ ìœ íš¨ì„± ê²€ì¦ (Validation)
- íŒŒì¼ ì—´ê¸°/ì €ì¥ ê¸°ëŠ¥
- ì„¤ì • ì €ì¥ (JSON, SQLite)
- ë‹¤êµ­ì–´ ì§€ì›
- íƒ­ êµ¬ì¡° UI êµ¬ì„±

---

# ğŸ§ª Avalonia MVVMì—ì„œ ì…ë ¥ ê²€ì¦ê³¼ ì„¤ì • ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„

## ğŸ§© ì´ë²ˆì— êµ¬í˜„í•  ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| 1ï¸âƒ£ ì…ë ¥ í¼ ê²€ì¦ | ì´ë¦„ê³¼ ë‚˜ì´ ë“± í•„ìˆ˜ ì…ë ¥ê°’ ì²´í¬, ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥ |
| 2ï¸âƒ£ ì„¤ì • ì €ì¥ | JSONìœ¼ë¡œ ì‚¬ìš©ì ì„¤ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°

---

## ğŸ“ ì˜ˆì œ êµ¬ì¡°

```
MyAvaloniaApp/
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ UserSettings.cs
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ SettingsViewModel.cs
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ SettingsView.axaml
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ ISettingsService.cs / SettingsService.cs
```

---

# âœ… 1. ì…ë ¥ í¼ ìœ íš¨ì„± ê²€ì¦

## ğŸ“„ SettingsViewModel.cs

```csharp
using ReactiveUI;
using System.ComponentModel.DataAnnotations;
using System.Collections.Generic;
using System.Linq;
using System.Reactive;

public class SettingsViewModel : ReactiveObject, IValidatableObject
{
    private string _userName;
    private int _age;
    private string _error;

    public string UserName
    {
        get => _userName;
        set => this.RaiseAndSetIfChanged(ref _userName, value);
    }

    public int Age
    {
        get => _age;
        set => this.RaiseAndSetIfChanged(ref _age, value);
    }

    public string Error
    {
        get => _error;
        private set => this.RaiseAndSetIfChanged(ref _error, value);
    }

    public ReactiveCommand<Unit, Unit> SubmitCommand { get; }

    public SettingsViewModel()
    {
        SubmitCommand = ReactiveCommand.Create(OnSubmit);
    }

    private void OnSubmit()
    {
        var results = new List<ValidationResult>();
        var context = new ValidationContext(this);
        bool isValid = Validator.TryValidateObject(this, context, results, true);

        if (isValid)
        {
            Error = "âœ… ì €ì¥ ì„±ê³µ!";
            // ì„¤ì • ì €ì¥í•  ìˆ˜ ìˆìŒ
        }
        else
        {
            Error = string.Join("\n", results.Select(r => $"âŒ {r.ErrorMessage}"));
        }
    }

    public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
    {
        if (string.IsNullOrWhiteSpace(UserName))
            yield return new ValidationResult("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.", new[] { nameof(UserName) });

        if (Age <= 0)
            yield return new ValidationResult("ë‚˜ì´ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.", new[] { nameof(Age) });
    }
}
```

---

## ğŸ–¼ï¸ SettingsView.axaml

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             x:Class="MyAvaloniaApp.Views.SettingsView"
             xmlns:vm="clr-namespace:MyAvaloniaApp.ViewModels"
             Width="400" Height="300">
    
    <UserControl.DataContext>
        <vm:SettingsViewModel/>
    </UserControl.DataContext>

    <StackPanel Margin="20" Spacing="10">
        <TextBlock Text="ì‚¬ìš©ì ì„¤ì •" FontSize="18"/>

        <TextBox Watermark="ì´ë¦„ ì…ë ¥" Text="{Binding UserName}" />
        <TextBox Watermark="ë‚˜ì´ ì…ë ¥" Text="{Binding Age}" />

        <Button Content="ì €ì¥" Command="{Binding SubmitCommand}" />

        <TextBlock Text="{Binding Error}" Foreground="Red" TextWrapping="Wrap"/>
    </StackPanel>
</UserControl>
```

---

# ğŸ’¾ 2. ì„¤ì • ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°

## ğŸ“„ Models/UserSettings.cs

```csharp
public class UserSettings
{
    public string UserName { get; set; }
    public int Age { get; set; }
}
```

---

## ğŸ“„ Services/ISettingsService.cs

```csharp
public interface ISettingsService
{
    Task SaveAsync(UserSettings settings);
    Task<UserSettings?> LoadAsync();
}
```

---

## ğŸ“„ Services/SettingsService.cs

```csharp
using System.Text.Json;
using System.IO;
using System.Threading.Tasks;

public class SettingsService : ISettingsService
{
    private const string FilePath = "user-settings.json";

    public async Task SaveAsync(UserSettings settings)
    {
        var json = JsonSerializer.Serialize(settings, new JsonSerializerOptions { WriteIndented = true });
        await File.WriteAllTextAsync(FilePath, json);
    }

    public async Task<UserSettings?> LoadAsync()
    {
        if (!File.Exists(FilePath))
            return null;

        var json = await File.ReadAllTextAsync(FilePath);
        return JsonSerializer.Deserialize<UserSettings>(json);
    }
}
```

---

## ğŸ›  ViewModelì— ì ìš©

```csharp
private readonly ISettingsService _settingsService;

public ReactiveCommand<Unit, Unit> LoadCommand { get; }

public SettingsViewModel(ISettingsService settingsService)
{
    _settingsService = settingsService;

    LoadCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        var loaded = await _settingsService.LoadAsync();
        if (loaded != null)
        {
            UserName = loaded.UserName;
            Age = loaded.Age;
            Error = "ğŸ“¦ ì„¤ì • ë¶ˆëŸ¬ì˜´";
        }
        else
        {
            Error = "âš ï¸ ì„¤ì • ì—†ìŒ";
        }
    });

    SubmitCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        var validationResults = new List<ValidationResult>();
        var context = new ValidationContext(this);
        bool isValid = Validator.TryValidateObject(this, context, validationResults, true);

        if (isValid)
        {
            await _settingsService.SaveAsync(new UserSettings { UserName = UserName, Age = Age });
            Error = "âœ… ì €ì¥ ì™„ë£Œ!";
        }
        else
        {
            Error = string.Join("\n", validationResults.Select(r => $"âŒ {r.ErrorMessage}"));
        }
    });
}
```

---

## ğŸ–¼ï¸ ë²„íŠ¼ ì¶”ê°€ (SettingsView.axaml)

```xml
<Button Content="ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°" Command="{Binding LoadCommand}" />
```

---

## âœ… ì •ë¦¬

| ê¸°ëŠ¥ | ì‚¬ìš© ê¸°ìˆ  |
|------|-----------|
| ì…ë ¥ ê²€ì¦ | `IValidatableObject`, `Validator` |
| ë©”ì‹œì§€ ì¶œë ¥ | `TextBlock` ë°”ì¸ë”© |
| ì„¤ì • ì €ì¥ | `JsonSerializer` â†’ íŒŒì¼ ì €ì¥ |
| ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° | JSON â†’ ViewModel ìƒíƒœ ë³µì› |