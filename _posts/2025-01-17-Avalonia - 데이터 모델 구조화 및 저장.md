---
layout: post
title: Avalonia - ë¼ì´íŠ¸-ë‹¤í¬ ëª¨ë“œ
date: 2024-12-26 19:20:23 +0900
category: Avalonia
---
# ğŸ§± Avalonia MVVM: ë°ì´í„° ëª¨ë¸ êµ¬ì¡°í™” ë° ì €ì¥ (JSON ê¸°ë°˜)

---

## âœ… ëª©í‘œ

- ğŸ’¡ Modelì€ UIì™€ ViewModelë¡œë¶€í„° ë¶„ë¦¬ëœ **ì•±ì˜ í•µì‹¬ ë°ì´í„° êµ¬ì¡°**
- ğŸ—‚ï¸ Modelì„ ê³„ì¸µì ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ì—¬ í™•ì¥ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì„
- ğŸ’¾ íŒŒì¼(JSON)ë¡œ ëª¨ë¸ì„ ì €ì¥í•˜ê³ , ì•± ì¬ì‹¤í–‰ ì‹œ ë³µì›í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±

---

## ğŸ§© í”„ë¡œì íŠ¸ êµ¬ì¡° ì˜ˆì‹œ

```
MyAvaloniaApp/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ UserProfile.cs
â”‚   â””â”€â”€ Address.cs
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IDataService.cs
â”‚   â””â”€â”€ JsonDataService.cs
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ UserViewModel.cs
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ UserView.axaml
```

---

# ğŸ§± 1. ë°ì´í„° ëª¨ë¸ ì •ì˜

## ğŸ“„ Models/UserProfile.cs

```csharp
public class UserProfile
{
    public string Name { get; set; } = "";
    public int Age { get; set; }
    public Address Address { get; set; } = new Address();
}
```

## ğŸ“„ Models/Address.cs

```csharp
public class Address
{
    public string City { get; set; } = "";
    public string Street { get; set; } = "";
}
```

> ğŸ“Œ ì´ë ‡ê²Œ ëª¨ë¸ì„ **ì¤‘ì²© êµ¬ì¡°**ë¡œ êµ¬ì„±í•˜ë©´ í™•ì¥ì„±, ìœ ì—°ì„±, ìœ ì§€ë³´ìˆ˜ê°€ í›¨ì”¬ ì¢‹ì•„ì§‘ë‹ˆë‹¤.

---

# ğŸ’¾ 2. ë°ì´í„° ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì„œë¹„ìŠ¤

## ğŸ“„ Services/IDataService.cs

```csharp
using System.Threading.Tasks;

public interface IDataService<T>
{
    Task SaveAsync(T data);
    Task<T?> LoadAsync();
}
```

## ğŸ“„ Services/JsonDataService.cs

```csharp
using System.Text.Json;
using System.IO;
using System.Threading.Tasks;

public class JsonDataService<T> : IDataService<T> where T : class, new()
{
    private readonly string _filePath;

    public JsonDataService(string filePath = "userdata.json")
    {
        _filePath = filePath;
    }

    public async Task SaveAsync(T data)
    {
        var json = JsonSerializer.Serialize(data, new JsonSerializerOptions { WriteIndented = true });
        await File.WriteAllTextAsync(_filePath, json);
    }

    public async Task<T?> LoadAsync()
    {
        if (!File.Exists(_filePath))
            return new T(); // ê¸°ë³¸ê°’ ë°˜í™˜

        var json = await File.ReadAllTextAsync(_filePath);
        return JsonSerializer.Deserialize<T>(json);
    }
}
```

> âœ… ì´ ì„œë¹„ìŠ¤ëŠ” ì–´ë–¤ ëª¨ë¸ í´ë˜ìŠ¤ì—ë„ ì¬ì‚¬ìš© ê°€ëŠ¥ (`JsonDataService<UserProfile>`, `JsonDataService<Settings>` ë“±)

---

# ğŸ” 3. ViewModelê³¼ ì—°ê²°

## ğŸ“„ ViewModels/UserViewModel.cs

```csharp
using ReactiveUI;
using System.Reactive;
using System.Threading.Tasks;

public class UserViewModel : ReactiveObject
{
    private readonly IDataService<UserProfile> _dataService;

    public UserProfile Profile { get; set; } = new();

    public ReactiveCommand<Unit, Unit> SaveCommand { get; }
    public ReactiveCommand<Unit, Unit> LoadCommand { get; }

    public UserViewModel()
    {
        _dataService = new JsonDataService<UserProfile>();

        SaveCommand = ReactiveCommand.CreateFromTask(SaveAsync);
        LoadCommand = ReactiveCommand.CreateFromTask(LoadAsync);
    }

    private async Task SaveAsync()
    {
        await _dataService.SaveAsync(Profile);
    }

    private async Task LoadAsync()
    {
        var loaded = await _dataService.LoadAsync();
        if (loaded != null)
            Profile = loaded;

        this.RaisePropertyChanged(nameof(Profile));
    }
}
```

---

# ğŸ–¼ï¸ 4. Viewì—ì„œ ë°”ì¸ë”©

## ğŸ“„ Views/UserView.axaml

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             x:Class="MyAvaloniaApp.Views.UserView"
             xmlns:vm="clr-namespace:MyAvaloniaApp.ViewModels"
             Width="400" Height="300">

    <UserControl.DataContext>
        <vm:UserViewModel/>
    </UserControl.DataContext>

    <StackPanel Margin="20" Spacing="10">
        <TextBox Text="{Binding Profile.Name}" Watermark="ì´ë¦„" />
        <TextBox Text="{Binding Profile.Age}" Watermark="ë‚˜ì´" />
        <TextBox Text="{Binding Profile.Address.City}" Watermark="ë„ì‹œ" />
        <TextBox Text="{Binding Profile.Address.Street}" Watermark="ê±°ë¦¬" />

        <StackPanel Orientation="Horizontal" Spacing="8">
            <Button Content="ë¶ˆëŸ¬ì˜¤ê¸°" Command="{Binding LoadCommand}" />
            <Button Content="ì €ì¥í•˜ê¸°" Command="{Binding SaveCommand}" />
        </StackPanel>
    </StackPanel>
</UserControl>
```

---

# ğŸ“ 5. ì¶”ê°€ ê³ ë ¤ ì‚¬í•­

### ğŸ§ª ìœ íš¨ì„± ê²€ì‚¬
- `UserProfile`ì— `DataAnnotation` ì†ì„± ì¶”ê°€ ê°€ëŠ¥ (`[Required]`, `[Range]` ë“±)

### ğŸ” ë³´ì•ˆ ì´ìŠˆ
- ë¯¼ê°í•œ ë°ì´í„° ì €ì¥ ì‹œ ì•”í˜¸í™” í•„ìš” (ì˜ˆ: AES)

### ğŸ’¾ ì €ì¥ ê²½ë¡œ ê´€ë¦¬
- Windows: `Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)`
- Linux: `~/.config/ì•±ì´ë¦„/`

---

# âœ… ì •ë¦¬

| í•­ëª© | ì„¤ëª… |
|------|------|
| Model ì •ì˜ | í•µì‹¬ ë°ì´í„° êµ¬ì¡°, ì¤‘ì²© ê°€ëŠ¥ |
| Json ì €ì¥ | `JsonDataService<T>` ë¡œ ëª¨ë“  ëª¨ë¸ ì €ì¥ ê°€ëŠ¥ |
| MVVM ì—°ê²° | ViewModelì—ì„œ Save/Load ì»¤ë§¨ë“œ ì œê³µ |
| ë·° ë°”ì¸ë”© | `Profile.ì†ì„±ëª…` ë°©ì‹ìœ¼ë¡œ ë·°ì—ì„œ ì§ì ‘ ë°”ì¸ë”© |