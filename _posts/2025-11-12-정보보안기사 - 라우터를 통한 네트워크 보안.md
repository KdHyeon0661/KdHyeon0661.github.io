---
layout: post
title: 정보보안기사 - 라우터를 통한 네트워크 보안
date: 2025-11-12 14:25:23 +0900
category: 정보보안기사
---
# SECTION 06 라우터 보안 — 03. 라우터를 통한 네트워크 보안 (세그멘테이션·안티스푸핑·라우팅 보안·RTBH/Flowspec·QoS/CoPP·NAT 보안·ZBF·가시성·운영 시나리오)

## 개요 — “라우터”로 만드는 보안 경계

라우터는 단순 포워더를 넘어 **네트워크 경계에서 정책을 집행**하는 1차 방어선이다. 방화벽/IPS와 역할이 겹치기도 하지만, **경로/정책이 만나는 곳**이 라우터이므로 다음 기능을 통해 **방어·격리·완화**를 수행한다.

- **세그멘테이션**: VRF/VRF-lite, 인터-VRF 제어, iACL(인프라 ACL)
- **안티스푸핑**: BCP38(ingress 필터), uRPF(strict/loose), Bogon/Martian 차단
- **라우팅 보안**: BGP prefix/as-path 필터, TTL Security, MD5/TCP-AO, OSPF 인증, RPKI(지원 시)
- **DDoS 완화**: CoPP(Control-plane policing), QoS policing/shaping, RTBH(원격 트리거 블랙홀), BGP Flowspec, 스크러빙센터 연동
- **암호화/캡슐화**: (DIA/백업) IPsec·GRE-over-IPsec, IKEv2, VRF-aware IPsec
- **NAT 보안**: PAT/NAT 규칙 최소 허용, 포트포워딩+ACL, ALG 주의
- **상태기반 필터(선택)**: Zone-Based Firewall(ZBF), L3/L4 상태 추적
- **가시성**: NetFlow/IPFIX/sFlow, Syslog/NTP(인증), 라우팅/CoPP 카운터

> 원칙(요약): **(1) 최소 권한, (2) 경로와 보안의 일치, (3) 관측 기반 튜닝**
> 이미 앞 절에서 다룬 *라우터 자체 하드닝*·*ACL*을 **기반**으로, 이번 절은 **네트워크 전체 방어 아키텍처**를 라우터 관점에서 완성한다.

---

## 설계 프레임 — “3 플레인 + 경계/코어 역할”

| 범주 | 설명 | 보안 포인트 |
|---|---|---|
| **관리(Management)** | SSH/NETCONF/RESTCONF/SNMP | mgmt VRF/OOB, VTY ACL, SNMPv3, Syslog/NTP |
| **제어(Control)** | BGP/OSPF/IS-IS/BFD | CoPP, 프로토콜 인증, TTL-S, Max-Prefix |
| **데이터(Data)** | 사용자/서버 트래픽 | iACL, uRPF, ZBF(선택), QoS, NAT 정책 |

### 경계/코어별 차이

- **엣지(경계) 라우터**: 안티스푸핑, DDoS 완화, 정책 라우팅, NAT, VPN, RTBH/Flowspec
- **코어 라우터**: 고속 포워딩, iACL 최소화, 제어면 보호(CoPP), RPKI·정책 집행(가능 시)

---

## 안티스푸핑 — BCP38 + uRPF + Bogon/Martian
### BCP38 (Ingress 필터링)

고객/다운스트림 인터페이스에서 **소스 IP가 해당 서브넷에 속하는지** 검사 후, 아닌 트래픽은 drop. (L3 단에서 즉시 차단)

**Cisco 예시**
```cisco
ip access-list extended INGRESS-CUST1
  permit ip 10.50.0.0 0.0.255.255 any
  deny   ip any any log
interface GigabitEthernet0/1
 ip access-group INGRESS-CUST1 in
```

### uRPF (Unicast Reverse Path Forwarding)

**소스 주소의 역방향 경로 유효성 검사**.
- **strict**: 수신 인터페이스가 소스의 최선 경로로 계산되어야 통과
- **loose**: 라우팅 테이블에 소스 prefix가 **존재**하기만 하면 통과

**Cisco 예시**
```cisco
interface GigabitEthernet0/1
 ip verify unicast source reachable-via rx   ! strict
 ip verify unicast source reachable-via any  ! loose (상황에 따라)
```

### Bogon/Martian 필터

- **Bogon**: 공인 인터넷에 광고되면 안 되는 사설/예약 대역(예: 10/8, 192.168/16, 127/8 등)
- **Martian**: 비정상/금지 라우팅(예: RFC 규정상 금지된 “목적지=소스=루프백” 형태 등)

**Cisco iACL 예시**
```cisco
ip access-list extended EDGE-BOGON
  deny   ip 10.0.0.0 0.255.255.255 any
  deny   ip 172.16.0.0 0.15.255.255 any
  deny   ip 192.168.0.0 0.0.255.255 any
  deny   ip 127.0.0.0 0.255.255.255 any
  permit ip any any
interface GigabitEthernet0/0
 ip access-group EDGE-BOGON in
```

**JunOS(Receive Protect)**
```junos
set firewall family inet filter BOGON term PRIVATE from source-address [10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 127.0.0.0/8]
set firewall family inet filter BOGON term PRIVATE then discard
set firewall family inet filter BOGON term ALLOW then accept
set interfaces lo0 unit 0 family inet filter input BOGON
```

---

## 세그멘테이션 — VRF/VRF-lite & 인터-VRF 통제
### VRF 개념

VRF는 **라우팅 테이블을 논리적으로 분리**하여, 한 장비에서 여러 네트워크를 **격리**한다. “망분리”/“테넌트 분리”/“관리면 전용 VRF”에 사용.

**Cisco 예시 (관리 VRF)**
```cisco
vrf definition MGMT
 address-family ipv4
 exit-address-family

interface GigabitEthernet0
 vrf forwarding MGMT
 ip address 10.100.0.2 255.255.255.0
ip route vrf MGMT 0.0.0.0 0.0.0.0 10.100.0.1
```

### 인터-VRF 통신(선택적 허용)

- **라우터 내부 route leaking** 또는 **방화벽을 통한 inter-VRF 연결**
- **보안 원칙**: 업무상 필요한 포트·방향만 **명시 허용**(기본 차단)

**Cisco route-leaking(정책 기반)**
```cisco
ip access-list extended VRF-LEAK
  permit tcp 10.10.10.0 0.0.0.255 10.20.20.0 0.0.0.255 eq 443
route-map LEAK permit 10
  match ip address VRF-LEAK
  set global
ip vrf MGMT
ip vrf PROD
! (플랫폼/버전에 따라 구성 방식 상이; 전용 FW 경유 권장)
```

**JunOS(Instance Import/Export)**
```junos
set routing-instances PROD instance-type vrf
set routing-instances MGMT instance-type vrf
set policy-options policy-statement LEAK term 1 from route-filter 10.20.20.0/24 exact
set policy-options policy-statement LEAK term 1 then accept
set routing-instances PROD vrf-export LEAK
set routing-instances MGMT vrf-import LEAK
```

---

## 라우팅 보안 — BGP/OSPF/IS-IS
### BGP: Prefix/AS-Path 필터 + Max-Prefix + TTL Security + MD5/TCP-AO

**Cisco 예시**
```cisco
ip prefix-list FROM-PEER seq 5 permit 203.0.113.0/24
ip prefix-list FROM-PEER seq 10 deny 0.0.0.0/0 le 32
route-map RM-IN permit 10
 match ip address prefix-list FROM-PEER
 set local-preference 200
!
router bgp 65001
 neighbor 198.51.100.2 remote-as 65002
 neighbor 198.51.100.2 password <MD5KEY>
 neighbor 198.51.100.2 ttl-security hops 2
 neighbor 198.51.100.2 maximum-prefix 20000 90 restart 5
 neighbor 198.51.100.2 route-map RM-IN in
```

**JunOS 예시**
```junos
set policy-options prefix-list FROM-PEER 203.0.113.0/24
set policy-options policy-statement IN term 1 from prefix-list FROM-PEER
set policy-options policy-statement IN term 1 then accept
set protocol bgp group EDGE type external
set protocol bgp group EDGE peer-as 65002
set protocol bgp group EDGE neighbor 198.51.100.2 authentication-key "$9$md5hash"
set protocol bgp group EDGE neighbor 198.51.100.2 ttl 2
set protocol bgp group EDGE neighbor 198.51.100.2 family inet unicast
set protocol bgp group EDGE import IN
set protocol bgp group EDGE damping
```

- **RPKI/ROA 검증**(지원 시): 잘못된(Invalid) 경로 drop/저선호
- **Communities 위생**: 외부 유입 community 제한/정규화

### OSPF/IS-IS

- OSPFv2: **HMAC-SHA**(또는 MD5) 인증, **passive interface**, 네트워크 타입 일치
- OSPFv3: **IPsec ESP** 기반 인증·암호화(플랫폼 의존)

**Cisco OSPF 예시**
```cisco
interface GigabitEthernet0/1
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 <KEY>
router ospf 1
 passive-interface default
 no passive-interface GigabitEthernet0/1
```

---

## DDoS 대응 — CoPP/Policing + RTBH + Flowspec + 스크러빙
### CoPP(Control Plane Policing)

제어면 트래픽을 클래스별로 **폴리싱**하여 CPU 고갈을 차단.

```cisco
class-map match-any CM-ROUTING
 match protocol bgp
 match protocol ospf
class-map match-any CM-MGMT
 match access-group name ACL-MGMT
!
policy-map PM-COPP
 class CM-ROUTING
  police 128000 16000 conform-action transmit exceed-action drop
 class CM-MGMT
  police 64000 8000 conform-action transmit exceed-action drop
 class class-default
  police 16000 2000 conform-action transmit exceed-action drop
control-plane
 service-policy input PM-COPP
```

### 토큰 버킷(Policing) 개념(수식)

평균 속도 \(r\), 버스트 크기 \(B\)일 때, 허용 가능한 최대 순간 전송량은
$$
\text{허용 버스트(bit)} \le B + r \cdot \Delta t.
$$
폴리싱은 버킷 토큰이 고갈되면 **즉시 Drop**, 쉐이핑은 큐잉 후 **지연**을 증가시킨다.

### RTBH (Remote Triggered Blackhole)

BGP community를 트리거로 **공격 대상/소스** 경로를 **/32(또는 /128)** 로 blackhole next-hop(Null0)에 유도.

**Cisco 예시(유입 트리거용 iBGP)**
- **Upstream/코어가 community “666:666”**을 보게 되면 Null0로 블랙홀
```cisco
ip route 192.0.2.1 255.255.255.255 Null0 tag 666
route-map RM-RTBH permit 10
 set community 666:666 additive
!
router bgp 65001
 neighbor 10.0.0.10 remote-as 65001
 address-family ipv4
  network 192.0.2.1 mask 255.255.255.255 route-map RM-RTBH
 exit-address-family
```

> 운영 절차: 관제 → 공격 타깃/소스 식별 → **자동화 스크립트**로 /32 Prefix 광고 + Community 셋 → **수 분 내 블랙홀** 반영 → 사후 정상화 시 Withdraw.

### BGP Flowspec (지원 시)

**L3/L4 기준의 룰을 BGP로 배포**하여 DDoS 특성을 실시간으로 차단(예: 특정 소스/목적지/포트/플래그 조합).

**JunOS Flowspec 예시(개략)**
```junos
set protocols flow name DDOS-HTTP match destination-port 80
set protocols flow name DDOS-HTTP then discard
set protocols bgp group FLOWSPEC type internal
set protocols bgp group FLOWSPEC family inet flow
set protocols bgp group FLOWSPEC neighbor 10.0.0.10 peer-as 65001
```

### 스크러빙센터 연동(우회/리턴)

- BGP로 우회 경로 광고 → 스크러빙센터로 유입 → 정화 후 GRE/IPsec 리턴
- 라우터는 **정상 트래픽만 복귀**하도록 정책 라우팅/VRF 구성

---

## 암호화 경계 — GRE/IPsec, VRF-aware IPsec

**Cisco IKEv2 + IPsec(요약)**
```cisco
crypto ikev2 proposal P1
 encryption aes-cbc-256 integrity sha256 group 14
crypto ikev2 policy POL1
 proposal P1
crypto ikev2 keyring KR1
 peer BRANCH1
  address 203.0.113.10
  pre-shared-key <PSK>
crypto ikev2 profile IKEV2P
 match identity remote address 203.0.113.10 255.255.255.255
 authentication remote pre-share
 authentication local pre-share
 keyring local KR1

crypto ipsec transform-set TS1 esp-gcm 256
crypto ipsec profile IPSEC-P
 set transform-set TS1
 set ikev2-profile IKEV2P

interface Tunnel0
 ip address 10.250.0.1 255.255.255.252
 tunnel source 198.51.100.1
 tunnel destination 203.0.113.10
 tunnel mode gre ip
 tunnel protection ipsec profile IPSEC-P
```
- **GRE over IPsec**: 라우팅/멀티캐스트 필요 시 유용
- **VRF-aware IPsec**: 관리/업무 VRF 분리 상태로 암호화 경로 확보

---

## NAT 보안 — 포트포워딩 최소화, ALG 주의, 예외 ACL
### PAT(오버로드) 최소 정책

```cisco
ip access-list extended NAT-INSIDE
  permit ip 10.10.0.0 0.0.255.255 any
ip nat inside source list NAT-INSIDE interface GigabitEthernet0/0 overload
```
- “**누가** 밖으로 나가는가”를 명시. 필요 없는 내부 대역은 제외.

### 포트포워딩(외부→내부) + ACL 동시 적용

```cisco
ip nat inside source static tcp 10.10.10.100 443 interface Gig0/0 8443
!
ip access-list extended PF-GATE
  permit tcp any host 198.51.100.1 eq 8443
  deny   ip any any log
interface GigabitEthernet0/0
 ip access-group PF-GATE in
```
- 반드시 **엣지 ACL**로 접근 대상을 제한. Geo/IP 레벨 필터를 앞 단 CDN/LB에서 병행 권장.

### ALG(Application Layer Gateway) 주의

- SIP/FTP ALG는 편리하지만 **비의도 변환/보안취약**을 유발할 수 있음. 필요 시에만 활성.

---

## Zone-Based Firewall(ZBF) — 라우터에서 상태기반 보안(선택)

ZBF는 트래픽을 **Zone**으로 묶고, **Zone 간 정책**을 **상태기반**으로 정의한다.

**Cisco 예시(간단)**
```cisco
zone security Z-INTERNAL
zone security Z-EXTERNAL
!
zone-pair security ZP-IN-OUT source Z-INTERNAL destination Z-EXTERNAL
 service-policy type inspect PM-IN-OUT
!
class-map type inspect match-any CM-WEB
 match protocol http
 match protocol https
policy-map type inspect PM-IN-OUT
 class type inspect CM-WEB
  inspect
 class class-default
  drop
!
interface Gig0/1
 zone-member security Z-INTERNAL
interface Gig0/0
 zone-member security Z-EXTERNAL
```
- 라우터에서 방화벽 역할을 간소 구현. **고성능 필요/복잡 규칙**은 전용 FW 권장.

---

## 가시성 — NetFlow/IPFIX, Syslog, NTP(인증)

**Cisco NetFlow**
```cisco
ip flow-export destination 10.100.50.50 2055
ip flow-export version 9
ip flow-cache timeout active 1
interface Gig0/0
 ip flow ingress
 ip flow egress
```
- **DDoS/스캔** 패턴 감지, **RTBH/Flowspec** 자동 트리거 소스 데이터로 활용
- Syslog에는 **CoPP drop**, **BGP up/down**, **uRPF drop** 등을 남겨 원인분석

---

## 운영 시나리오(3가지)

### 시나리오 A — 중소기업 Internet Edge(단일 ISP)

목표: **안티스푸핑 + NAT 최소화 + 원격지 VPN + 관리면 분리**
1. uRPF(strict) on, BCP38 ingress ACL
2. iACL: 라우터 IP 대상으로 관리망만 접근 허용
3. PAT 정책(업무망만 외부 허용), 포트포워딩+ACL 병행
4. 브랜치 IKEv2 IPsec (GRE 필요 시 GRE-over-IPsec)
5. NetFlow/Syslog/NTP(인증) + 백업/버전관리

### 시나리오 B — 데이터센터 Edge(이중 ISP)

목표: **라우팅 보안 + DDoS 완화 + 세그멘테이션**
1. BGP prefix/as-path 필터 + TTL-S + MD5/TCP-AO + max-prefix
2. RPKI 검증/선호도 조정(가능 시)
3. CoPP/폴리싱 + RTBH/Flowspec + 스크러빙센터 경로 준비
4. VRF로 테넌트/업무망 분리, inter-VRF는 방화벽 경유
5. 흐름 가시성(NetFlow/IPFIX), 자동화로 RTBH 트리거

### 시나리오 C — ISP PE(간단)

목표: **고객단 BCP38 + control-plane 보호**
1. 고객 인터페이스 inbound BCP38, bogon 필터
2. CoPP로 라우팅/BFD 한도 엄격히
3. 자동화된 커스텀 community 정책(고객-요청 RTBH)

---

## 검증/트러블슈팅 명령 모음

**Cisco**
```cisco
show ip cef drop
show ip interface Gig0/0
show access-lists
show policy-map control-plane input
show ip bgp summary
show ip bgp neighbors 198.51.100.2 received-routes
show ip flow top-talkers
show ip verify unicast source reachable-via
```

**JunOS**
```junos
show firewall
show interfaces terse | match lo0
show bgp summary
show route receive-protocol bgp 198.51.100.2
show security flow session summary   # (플랫폼 의존)
```

**Linux**
```bash
nft list ruleset
ip -s link
ip route get 198.51.100.2
```

---

## 아키텍처 다이어그램(텍스트)

```
                +--------------------+    +---------------------+
                |  Scrubbing Center  |    |  Monitoring/SIEM    |
                +----------+---------+    +----------+----------+
                           ^                         ^
                           | GRE/BGP                 | Syslog/Flow
Internet ---- [Edge Router R1] ---- Core ---- Servers/Apps/VRF ---- OOB/MGMT
   |              |  ^     ^                              |
   |              |  |     |                              |
   |           iACL CoPP  BGP Sec/RTBH/Flowspec         ZBF(옵션)
   |
 (BCP38/uRPF)
```

---

## 수학/성능 직관 — 폴리싱/쉐이핑과 지연

- 토큰 버킷에서 **토큰 생성률** \(r\) (bps), **버스트** \(B\) (bit), **버스트 시간** \(T_b = B / r\).
- 쉐이핑 큐의 평균 지연 \(\bar{d}\)는 대략 트래픽 부하 \(\rho\)와 큐 길이 \(Q\)에 비례:
$$
\bar{d} \approx \frac{Q}{C(1-\rho)}
$$
여기서 \(C\)는 링크 용량. (운영 직감: **과도 쉐이핑은 지연 급증** → 실전에서는 **CoPP/RTBH로 원인 제거**가 우선)

---

## 체크리스트(간이)

- [ ] **uRPF/BCP38**: 고객/엣지에서 소스 검증
- [ ] **Bogon/Martian**: iACL로 차단
- [ ] **BGP 보안**: prefix/as-path 필터, TTL-S, MD5/TCP-AO, max-prefix, (RPKI)
- [ ] **OSPF/IS-IS**: 인증, passive 인터페이스
- [ ] **CoPP/폴리싱**: 제어면 보호(관측 후 튜닝)
- [ ] **RTBH/Flowspec**: 자동화 스크립트·프로세스 마련
- [ ] **VRF**: 관리/테넌트 분리, inter-VRF는 최소 허용
- [ ] **NAT**: 내부→외부 최소화, 포트포워딩은 ACL 병행
- [ ] **ZBF**(선택): 라우터 내 상태기반 필터
- [ ] **가시성**: NetFlow/IPFIX, Syslog/NTP(인증), 변경 이력/백업

---

## 미니 실습 — “RTBH + iACL + CoPP” 30분 구성(랩)

1) **iACL 배치**: 라우터 IP 대상으로 관리망/BGP/ICMP만 허용
2) **BGP 보안**: prefix 필터 + TTL-S + MD5, max-prefix 설정
3) **CoPP**: BGP/관리/ICMP 별도 폴리싱
4) **RTBH**: community “666:666” 트리거 구성 + 테스트 /32 광고
5) **관측**: NetFlow로 drop/정상 트래픽 비교, Syslog로 CoPP exceed 로그 확인

---

## 결론

라우터는 **경로와 정책이 만나는 지점**으로, 잘 설계하면 **세그멘테이션·안티스푸핑·라우팅 보안·DDoS 완화·암호화·상태기반 필터**를 아우르는 **경계 방어 플랫폼**이 된다.
핵심은 **기본 거부 + 명시 허용**, **제어면 보호(CoPP)**, **관측 기반 자동화(RTBH/Flowspec)**, 그리고 **VRF로의 격리**다.
본 문서의 템플릿을 바탕으로, 환경별 *정책·가용성·성능* 요구를 맞추는 **미세 튜닝**이 최종 품질을 좌우한다.
