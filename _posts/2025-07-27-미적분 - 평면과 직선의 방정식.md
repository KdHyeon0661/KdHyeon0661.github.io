---
layout: post
title: 미적분 - 평면과 직선의 방정식
date: 2025-07-27 16:20:23 +0900
category: 미적분
---
# 평면과 직선의 방정식

## 직선(Line)의 표준 형태들

### 벡터 방정식

$$
\mathbf r(t)=\mathbf r_0+t\,\mathbf v,\quad t\in\mathbb R,
$$
여기서 $$\mathbf r_0=\langle x_0,y_0,z_0\rangle$$ 는 한 점, $$\mathbf v=\langle a,b,c\rangle\neq\mathbf 0$$ 는 방향벡터.

### 매개변수 방정식

$$
\begin{aligned}
x&=x_0+a t,\\
y&=y_0+b t,\\
z&=z_0+c t.
\end{aligned}
$$

### 방정식

$$
\frac{x-x_0}{a}=\frac{y-y_0}{b}=\frac{z-z_0}{c},
$$
단, 분모가 0이면 해당 성분은 별도 등식(예: $$a=0\Rightarrow x=x_0$$)으로 처리.

### 사항

- $$\mathbf v=\mathbf 0$$ 이면 직선이 정의되지 않는다(퇴화).
- 대칭형은 성분 분모가 0일 수 있으므로 사용 시 조건 분기를 명시하는 편이 안전.

---

## 평면(Plane)의 표준 형태들

### 형

$$
\mathbf n\cdot(\mathbf r-\mathbf r_0)=0,
$$
여기서 $$\mathbf n=\langle A,B,C\rangle\neq\mathbf 0$$ 는 법선벡터, $$\mathbf r_0$$ 는 평면 위의 한 점.

### 방정식

$$
A x+B y+C z+D=0,\qquad D=-A x_0-B y_0-C z_0.
$$

### 형

$$
\mathbf r(s,t)=\mathbf r_0+s\,\mathbf v+t\,\mathbf w,\qquad \mathbf v,\mathbf w\ \text{평면 내 독립벡터}.
$$

### 사항

- $$\mathbf n=\mathbf 0$$ 이면 평면이 아니다(퇴화).
- 매개 형에서 $$\mathbf v,\mathbf w$$ 가 선형 독립이 아니면 평면이 아니라 직선/점으로 퇴화.

---

## 직선–평면 관계 판정

### 교점(Line–Plane intersection)

직선 $$\mathbf r(t)=\mathbf r_0+t\,\mathbf v$$, 평면 $$\mathbf n\cdot(\mathbf r-\mathbf p_0)=0$$ 에서
$$
t^\star=-\frac{\mathbf n\cdot(\mathbf r_0-\mathbf p_0)}{\mathbf n\cdot\mathbf v}\quad(\mathbf n\cdot\mathbf v\neq 0),
$$
$$
\mathbf r^\star=\mathbf r(t^\star).
$$

### 평행·포함

- 평행(혹은 포함): $$\mathbf n\cdot\mathbf v=0$$.
- 포함: 추가로 $$\mathbf n\cdot(\mathbf r_0-\mathbf p_0)=0$$.

### 수직

- 직선이 평면에 수직 ⇔ $$\mathbf v$$ 가 $$\mathbf n$$ 에 평행(스칼라배 관계).

---

## 각도와 거리

### 각도

- 직선–직선 각도(방향벡터 $$\mathbf v_1,\mathbf v_2$$):
$$
\cos\theta=\frac{|\mathbf v_1\cdot\mathbf v_2|}{\|\mathbf v_1\|\,\|\mathbf v_2\|}.
$$

- 직선–평면 각도(직선과 평면 사이의 예각 $$\phi\in[0,\frac\pi2]$$):
$$
\sin\phi=\frac{|\mathbf v\cdot\mathbf n|}{\|\mathbf v\|\,\|\mathbf n\|}.
$$

- 평면–평면 각도(법선 $$\mathbf n_1,\mathbf n_2$$):
$$
\cos\Theta=\frac{|\mathbf n_1\cdot\mathbf n_2|}{\|\mathbf n_1\|\,\|\mathbf n_2\|}.
$$

### 거리

- 점–평면 거리(점 $$\mathbf p$$, 평면 $$A x+B y+C z+D=0$$):
$$
d(\mathbf p,\Pi)=\frac{|A x_p+B y_p+C z_p+D|}{\sqrt{A^2+B^2+C^2}}.
$$

- 점–직선 거리(점 $$\mathbf p$$, 직선 $$\mathbf r_0+t\mathbf v$$):
$$
d(\mathbf p,\ell)=\frac{\|(\mathbf p-\mathbf r_0)\times \mathbf v\|}{\|\mathbf v\|}.
$$

- 평행 두 평면 사이 거리(같은 $$A,B,C$$):
$$
d(\Pi_1,\Pi_2)=\frac{|D_2-D_1|}{\sqrt{A^2+B^2+C^2}}.
$$

- 비꼬임(스큐) 두 직선 $$\ell_1:\mathbf r=\mathbf a+t\,\mathbf u,\ \ell_2:\mathbf r=\mathbf b+s\,\mathbf v$$ 의 최단거리:
$$
d(\ell_1,\ell_2)=\frac{|(\mathbf b-\mathbf a)\cdot(\mathbf u\times\mathbf v)|}{\|\mathbf u\times\mathbf v\|},\quad \mathbf u\times\mathbf v\neq\mathbf 0.
$$
(평행이면 분모가 0이므로 점–직선 거리로 환원)

---

## 투영과 반사

- 점의 평면 투영(점 $$\mathbf p$$ 을 평면 $$\mathbf n\cdot(\mathbf r-\mathbf p_0)=0$$ 에 내리기):
$$
\mathbf p_{\text{proj}}=\mathbf p-\frac{\mathbf n\cdot(\mathbf p-\mathbf p_0)}{\|\mathbf n\|^2}\,\mathbf n.
$$

- 점의 평면 반사:
$$
\mathbf p_{\text{refl}}=\mathbf p-2\,\frac{\mathbf n\cdot(\mathbf p-\mathbf p_0)}{\|\mathbf n\|^2}\,\mathbf n.
$$

- 벡터의 평면 접선/법선 성분 분해(벡터 $$\mathbf w$$):
$$
\mathbf w_{\perp}=\frac{\mathbf n\cdot \mathbf w}{\|\mathbf n\|^2}\mathbf n,\qquad
\mathbf w_{\parallel}=\mathbf w-\mathbf w_{\perp}.
$$

---

## 두 평면의 교선(Intersection line of two planes)

평면
$$
\Pi_1:\ A_1 x+B_1 y+C_1 z+D_1=0,\quad
\Pi_2:\ A_2 x+B_2 y+C_2 z+D_2=0.
$$

- 방향벡터(교선의 방향)
$$
\mathbf d=\mathbf n_1\times\mathbf n_2,\quad
\mathbf n_i=\langle A_i,B_i,C_i\rangle.
$$
- 한 점 찾기(선형계 해): 임의 성분을 고정해 2×2 풀기(수치적으로는 최소제곱/정규방정식 사용이 안전).
- 교선의 방정식
$$
\mathbf r(t)=\mathbf r_\ast+t\,\mathbf d.
$$

특수: $$\mathbf n_1\times\mathbf n_2=\mathbf 0$$ 이면 평행(혹은 일치).
일치 여부는 한 평면 방정식을 다른 평면에 대입해 확인.

---

## 예제 풀이

### 평면의 점–법선식과 일반형

점 $$P(1,2,3)$$, 법선 $$\langle 4,-2,5\rangle$$:
$$
4(x-1)-2(y-2)+5(z-3)=0\ \Rightarrow\ 4x-2y+5z-21=0.
$$

### 직선–평면 수직 확인

직선 방향 $$\langle 1,2,-1\rangle$$, 평면 법선 $$\langle 1,2,-1\rangle$$ 은 평행.
따라서 직선은 평면에 수직(직선 방향이 법선과 평행).

### 직선–평면 교점

직선 $$\mathbf r=\langle 2,0,1\rangle+t\langle 1,1,2\rangle$$,
평면 $$2x-y+z-3=0$$.
$$
\mathbf n\cdot\mathbf v=2\cdot 1+(-1)\cdot 1+1\cdot 2=3\neq 0,
$$
$$
t^\star=-\frac{\mathbf n\cdot(\mathbf r_0-\mathbf p_0)}{\mathbf n\cdot\mathbf v}
=-\frac{2\cdot 2-1\cdot 0+1\cdot 1-3}{3}=-\frac{2}{3}.
$$
$$
\mathbf r^\star=\langle 2,0,1\rangle-\tfrac{2}{3}\langle 1,1,2\rangle=\left\langle \tfrac{4}{3},-\tfrac{2}{3},-\tfrac{1}{3}\right\rangle.
$$

### 점–직선 거리

점 $$\mathbf p=(1,2,3)$$, 직선 $$\mathbf r=\langle 0,0,0\rangle+t\langle 1,-1,2\rangle$$:
$$
d=\frac{\|(\mathbf p-\mathbf 0)\times \langle 1,-1,2\rangle\|}{\|\langle 1,-1,2\rangle\|}
=\frac{\|\langle 1,2,3\rangle\times\langle 1,-1,2\rangle\|}{\sqrt{1+1+4}}
=\frac{\|\langle 7,1,-3\rangle\|}{\sqrt{6}}=\frac{\sqrt{59}}{\sqrt{6}}.
$$

### 두 평면의 교선

$$
\Pi_1:\ x+2y+z-1=0,\quad \Pi_2:\ 2x-y+3z-4=0.
$$
방향
$$
\mathbf d=\langle 1,2,1\rangle\times\langle 2,-1,3\rangle
=\langle 7,-1,-5\rangle.
$$
한 점: 예를 들어 $$z=0$$ 가정 후
$$
\begin{cases}
x+2y=1\\
2x-y=4
\end{cases}
\Rightarrow (x,y)=\left(\tfrac{2}{5},\tfrac{1}{5}\right).
$$
따라서
$$
\mathbf r(t)=\left\langle \tfrac{2}{5},\tfrac{1}{5},0\right\rangle+t\langle 7,-1,-5\rangle.
$$

---

## — 판정·거리·각도·투영·교점/교선

> 벡터/행렬 연산과 수치적 예외(분모 0, 공선성, 평행성)를 고려해 작은 $$\varepsilon$$ 로 안정화한다.

```python
import torch

EPS = 1e-12

def unit(v):
    n = torch.linalg.vector_norm(v, dim=-1, keepdim=True).clamp_min(EPS)
    return v / n

def line_point(r0, v, t):
    return r0 + t * v

def line_plane_intersection(r0, v, p0, n):
    num = torch.sum(n * (r0 - p0), dim=-1)
    den = torch.sum(n * v, dim=-1)
    mask_parallel = den.abs() < EPS
    t = - num / (den + (~mask_parallel)*0.0 + mask_parallel*1.0)  # avoid div0
    # If parallel: t is meaningless; caller should check mask_parallel
    p = line_point(r0, v, t[..., None])
    return p, mask_parallel

def distance_point_plane(p, n, d):
    # plane: n·x + d = 0
    return (torch.abs(torch.sum(n * p, dim=-1) + d) / (torch.linalg.vector_norm(n, dim=-1).clamp_min(EPS)))

def distance_point_line(p, r0, v):
    num = torch.linalg.vector_norm(torch.cross(p - r0, v, dim=-1), dim=-1)
    den = torch.linalg.vector_norm(v, dim=-1).clamp_min(EPS)
    return num / den

def angle_between_lines(v1, v2):
    c = (torch.sum(v1 * v2, dim=-1) /
         (torch.linalg.vector_norm(v1, dim=-1).clamp_min(EPS) *
          torch.linalg.vector_norm(v2, dim=-1).clamp_min(EPS))).clamp(-1+1e-9, 1-1e-9)
    return torch.arccos(c)  # radians

def angle_line_plane(v, n):
    s = (torch.abs(torch.sum(v * n, dim=-1)) /
         (torch.linalg.vector_norm(v, dim=-1).clamp_min(EPS) *
          torch.linalg.vector_norm(n, dim=-1).clamp_min(EPS))).clamp(0, 1)
    return torch.arcsin(s)  # radians in [0, pi/2]

def angle_between_planes(n1, n2):
    c = (torch.abs(torch.sum(n1 * n2, dim=-1)) /
         (torch.linalg.vector_norm(n1, dim=-1).clamp_min(EPS) *
          torch.linalg.vector_norm(n2, dim=-1).clamp_min(EPS))).clamp(0, 1-1e-9)
    return torch.arccos(c)  # radians

def project_point_to_plane(p, p0, n):
    alpha = torch.sum(n * (p - p0), dim=-1, keepdim=True) / (torch.sum(n * n, dim=-1, keepdim=True).clamp_min(EPS))
    return p - alpha * n

def reflect_point_across_plane(p, p0, n):
    alpha = torch.sum(n * (p - p0), dim=-1, keepdim=True) / (torch.sum(n * n, dim=-1, keepdim=True).clamp_min(EPS))
    return p - 2 * alpha * n

def distance_skew_lines(a, u, b, v):
    cross = torch.cross(u, v, dim=-1)
    denom = torch.linalg.vector_norm(cross, dim=-1).clamp_min(EPS)
    num = torch.abs(torch.sum((b - a) * cross, dim=-1))
    return num / denom

def intersection_line_line_3d(a, u, b, v):
    # Solve a + t u = b + s v in least squares (for skew/parallel too).
    # Stack equations: [u, -v] [t s]^T = b - a
    U = torch.stack([u, -v], dim=-1)  # shape (3,2)
    rhs = (b - a)
    # least squares via lstsq
    sol = torch.linalg.lstsq(U, rhs).solution  # shape (2,)
    t, s = sol[0], sol[1]
    p1 = a + t * u
    p2 = b + s * v
    return p1, p2, torch.linalg.vector_norm(p1 - p2)

# Quick self-checks:

r0 = torch.tensor([2.0, 0.0, 1.0])
v  = torch.tensor([1.0, 1.0, 2.0])
p0 = torch.tensor([0.0, 0.0, 0.0])
n  = torch.tensor([2.0, -1.0, 1.0])
p, is_parallel = line_plane_intersection(r0, v, p0, n)
print("Line–plane intersection:", p.tolist(), " parallel?", bool(is_parallel))

p_test = torch.tensor([1.0, 2.0, 3.0])
r00    = torch.zeros(3)
v00    = torch.tensor([1.0, -1.0, 2.0])
print("d(point,line) =", float(distance_point_line(p_test, r00, v00)))

n1 = torch.tensor([1.0, 2.0, 1.0])
n2 = torch.tensor([2.0, -1.0, 3.0])
theta_pp = angle_between_planes(n1, n2)
print("angle(planes) [deg] =", float(theta_pp * 180.0 / torch.pi))

a = torch.tensor([0.,0.,0.])
u = torch.tensor([1.,0.,0.])
b = torch.tensor([0.,1.,1.])
v2= torch.tensor([0.,1.,0.])
print("d(skew) =", float(distance_skew_lines(a,u,b,v2)))
```

---

## 수치적/논리적 예외 처리 체크리스트

- 분모 0: $$\mathbf n\cdot\mathbf v=0,\ \|\mathbf v\|=0,\ \|\mathbf n\|=0,\ \|\mathbf u\times\mathbf v\|=0$$ 등은 예외 분기.
- 평행/포함 판정은 하나 더(점 대입) 확인: $$\mathbf n\cdot(\mathbf r_0-\mathbf p_0)=0$$.
- 교선 구하기는 직접 대입보다 최소제곱(수치안정) 권장.
- 반사/투영은 $$\|\mathbf n\|^2$$ 로 나누므로 정규화/클램프.

---

## 응용 맥락 요약

| 문제 | 입력 | 출력 | 공식/알고리즘 |
|---|---|---|---|
| 직선–평면 교점 | $$(\mathbf r_0,\mathbf v),(\mathbf p_0,\mathbf n)$$ | $$\mathbf r^\star$$ | $$t^\star=-\frac{\mathbf n\cdot(\mathbf r_0-\mathbf p_0)}{\mathbf n\cdot\mathbf v}$$ |
| 점–평면 거리 | $$\mathbf p, (A,B,C,D)$$ | $$d$$ | $$\frac{|A x_p+B y_p+C z_p+D|}{\sqrt{A^2+B^2+C^2}}$$ |
| 점–직선 거리 | $$\mathbf p,(\mathbf r_0,\mathbf v)$$ | $$d$$ | $$\frac{\|(\mathbf p-\mathbf r_0)\times\mathbf v\|}{\|\mathbf v\|}$$ |
| 직선–평면 각 | $$\mathbf v,\mathbf n$$ | $$\phi$$ | $$\sin\phi=\frac{|\mathbf v\cdot\mathbf n|}{\|\mathbf v\|\,\|\mathbf n\|}$$ |
| 평면–평면 각 | $$\mathbf n_1,\mathbf n_2$$ | $$\Theta$$ | $$\cos\Theta=\frac{|\mathbf n_1\cdot\mathbf n_2|}{\|\mathbf n_1\|\,\|\mathbf n_2\|}$$ |
| 투영/반사 | $$\mathbf p,(\mathbf p_0,\mathbf n)$$ | $$\mathbf p_{\text{proj}},\mathbf p_{\text{refl}}$$ | $$\mathbf p-\frac{\mathbf n\cdot(\mathbf p-\mathbf p_0)}{\|\mathbf n\|^2}\mathbf n,\ \mathbf p-2\frac{\cdot}{\|\mathbf n\|^2}\mathbf n$$ |
| 두 평면 교선 | $$(A_i,B_i,C_i,D_i)$$ | $$(\mathbf r_\ast,\mathbf d)$$ | $$\mathbf d=\mathbf n_1\times\mathbf n_2,\ \text{한 점은 2×2 해/최소제곱}$$ |
| 비꼬임 직선 거리 | $$(\mathbf a,\mathbf u),(\mathbf b,\mathbf v)$$ | $$d$$ | $$\frac{|(\mathbf b-\mathbf a)\cdot(\mathbf u\times\mathbf v)|}{\|\mathbf u\times\mathbf v\|}$$ |

---

## 마무리

- 직선과 평면의 모든 표준 형태는 상호 변환 가능하며, 문제 맥락에 맞는 표현을 고르면 계산이 단순해진다.
- 관계 판정(교차/평행/포함)은 내적/대입 두 테스트로 안정적으로 판별한다.
- 각도·거리 공식은 내적/외적의 기하학적 의미(투영/면적)에서 바로 나온다.
- 투영/반사는 그래픽스·물리에서 기본 툴킷이며, 교선/교점은 제약 해석의 핵심이다.
- 수치 구현에서는 분모 0, 평행성, 공선성, 정규화 누락 등으로 인한 불안정을 철저히 방지한다.
