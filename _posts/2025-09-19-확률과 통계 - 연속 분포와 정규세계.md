---
layout: post
title: 확률과 통계 - 연속 분포와 정규세계
date: 2025-09-19 17:25:23 +0900
category: 확률과 통계
---
# 4. 연속 분포와 정규세계

> **목표**
> - **균등·지수·감마·카이제곱·정규**의 역할과 상호관계를 이해한다.
> - **대기시간(지수/감마)**, **집계 지표의 정규 근사**(CLT·델타법)의 적용 한계를 실무 예제로 파악한다.
> - **체류시간(heavy-tail)** 같은 분포에서 **평균·표준편차만**으로 보고하는 위험을 진단하고 대안을 제시한다.

---

## 0. Hook — “정규성은 공짜가 아니다”
- 일별 **평균 체류시간**이 어느 정도 모이면 **정규근사**가 잘 맞을 것 같지만, **원분포가 heavy-tail**이면 **수렴이 느리거나 왜곡**된다.
- “평균 120초, 표준편차 300초”라는 한 줄은 **꼬리**를 숨긴다.
- 해법은 **분포의 모양**을 먼저 짚고, **요약치(중앙값·상위 분위·로그척도)**를 병기하는 것.

---

## 1. 균등 분포 (Uniform) — “모른다는 것의 공식”
### 1.1 정의와 성질
- $$X\sim \mathrm{Unif}(a,b)$$
- **PDF**: $$f_X(x)=\frac{1}{b-a}\;(a\le x\le b)$$
- **CDF**: $$F_X(x)=\frac{x-a}{b-a}$$
- **기대/분산**: $$E[X]=\frac{a+b}{2},\quad \mathrm{Var}(X)=\frac{(b-a)^2}{12}$$

### 1.2 웹/앱 직관
- **실험 시작~종료 사이** “사용자 최초 방문 시각”이 특별한 편향 없이 균일하다고 가정할 때 근사 가능.
- **무정보성**(non-informative) 가정으로 **샘플링/시뮬**에 기초값으로 자주 사용.

---

## 2. 지수 분포 (Exponential) — “기다림과 기억 없음”
### 2.1 정의와 핵심
- $$T\sim \mathrm{Exp}(\lambda)$$
- **PDF**: $$f_T(t)=\lambda e^{-\lambda t},\; t\ge 0$$
- **CDF**: $$F_T(t)=1-e^{-\lambda t}$$
- **기대/분산**: $$E[T]=\frac{1}{\lambda},\; \mathrm{Var}(T)=\frac{1}{\lambda^2}$$
- **기억 없음**: $$P(T>s+t\mid T>s)=P(T>t)$$

### 2.2 포아송 과정과의 연결
- “분당 평균 λ건 발생”인 **포아송 과정**의 **사건 간 간격**이 지수.
- 오류/클릭 **사건 간 대기시간** 모델로 바로 연결된다.

### 2.3 실무 예 — 대기열·알림 응답
- 알림 발송 후 **첫 클릭까지 대기시간**이 Exp(λ)라고 하자.
  - **10초 이내 클릭 확률**: $$1-e^{-\lambda \cdot 10}$$
  - **중앙값**: $$\mathrm{med}(T)=\frac{\ln 2}{\lambda}$$
- **메시지**: **“평균 1/λ”**만 말하면 꼬리를 잊는다. **중앙값·상위 분위**를 함께.

---

## 3. 감마 분포 (Gamma) — “지수 k개 합 = Erlang”
### 3.1 정의(형상 k, 척도 θ)
- $$T\sim \mathrm{Gamma}(k,\theta)$$
- **PDF**: $$f(t)=\frac{1}{\Gamma(k)\theta^k}t^{k-1}e^{-t/\theta},\; t\ge 0$$
- **기대/분산**: $$E[T]=k\theta,\; \mathrm{Var}(T)=k\theta^2$$
- **CV(변동계수)**: $$\frac{\sqrt{\mathrm{Var}}}{E}=\frac{1}{\sqrt{k}}$$ → **k↑**일수록 안정.

### 3.2 포아송 과정 관점
- **k번째 사건까지의 시간**이 감마. 특히 **정수 k**면 **Erlang**.
- 예: “k=3 단계의 전환 퍼널”을 통과하는 **누적 대기시간** 모델링.

### 3.3 웹/앱 직관
- **세션 체류**가 여러 **잠복 단계(읽기→결정→행동)**로 합성될 때 감마가 자연스럽다.
- **위험률(hazard)**가 지수는 일정, 감마는 (k>1)에서 **증가형** → “머무를수록 떠날 확률 감소/증가” 같은 해석 가능.

---

## 4. 카이제곱 (Chi-square) — “정규제곱의 합”
### 4.1 정의와 관계
- $$Z_i\sim \mathcal{N}(0,1)$$ 독립, $$Q=\sum_{i=1}^\nu Z_i^2\sim \chi^2_\nu$$
- **Gamma 연결**: $$\chi^2_\nu \equiv \mathrm{Gamma}\!\left(\frac{\nu}{2}, 2\right)$$

### 4.2 용도
- **분산 추정**: 정규모집단의 표본분산 스케일링이 $$\chi^2$$.
- **회귀/적합도 검정**의 기본 구성요소.
- **A/B 카이제곱 독립성 검정**에서도 셀 기대빈도 요건을 점검.

---

## 5. 정규 (Normal) — “합/평균의 자연한 끝”
### 5.1 정의
- $$X\sim \mathcal{N}(\mu,\sigma^2)$$, **PDF**: $$\frac{1}{\sqrt{2\pi}\sigma}\exp\!\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)$$
- 표준화: $$Z=\frac{X-\mu}{\sigma}\sim \mathcal{N}(0,1)$$

### 5.2 중심극한정리(CLТ) 스케치
- 적절한 조건에서 **독립 동일분포** RV의 **합/평균**은 정규로 수렴.
- **Berry–Esseen**류 보정: 꼬리/왜도 존재 시 **수렴 속도**가 느릴 수 있다.

### 5.3 정규근사 실무 규칙
- **합/평균** **표본크기 n가 충분히 크고**, 개별 분포의 **분산 유한** 및 **지배적 꼬리 없음**일 때 안전.
- **연속성 보정**: 이산→정규 근사 시 ±0.5 보정.

---

## 6. 대기시간 모델링: 지수 ↔ 감마
### 6.1 응답 SLA 예
- 오류 간 평균시간이 5분(λ=0.2/분). **10분 내 재오류** 확률: $$1-e^{-0.2\cdot 10}\approx 0.8647$$
- **k=3 사건**까지 시간(감마): 평균 15분, **상위 분위**로 SLA 설정 가능.

### 6.2 전환지연(TTF-C: Time-to-First-Conversion)
- 알림 후 k단계 의사결정(읽기·고려·구매) → 감마(k, θ).
- **보고**: 평균·중앙값·90% 분위 **동시 표기**로 꼬리 체감도를 제공.

---

## 7. 집계 지표의 정규 근사 — 평균의 세계
### 7.1 일별 평균 체류시간의 근사
- 사용자별 체류시간 $$T_i$$ 가 i.i.d., **분산 유한**이라면
  $$\bar T=\frac{1}{n}\sum T_i \approx \mathcal{N}\!\left(E[T], \frac{\mathrm{Var}(T)}{n}\right)$$
- **신뢰구간**:
  $$\bar T \pm t_{0.975,\;n-1}\cdot \frac{S_T}{\sqrt{n}}$$
  (σ 미지 → **t 사용**)

### 7.2 CTR·CVR 평균의 근사(델타법 한 줄)
- 비율의 비율(총 클릭/총 노출) 같은 **함수형 추정량**은 **델타법**으로 근사 분산 계산.
- 원형이 **정규근사**되면, **함수의 1차 선형화**로 분산 예측이 가능.

---

## 8. Heavy-tail(로그정규·파레토)에서의 위험
### 8.1 왜 평균·표준편차가 위험한가
- **로그정규**: $$\log T \sim \mathcal{N}(\mu,\sigma^2)$$ 이면
  $$E[T]=e^{\mu+\sigma^2/2}$$, 꼬리가 두꺼워 **평균이 “극단값”에 매우 민감**.
- **파레토**: 모수에 따라 **분산이 무한**일 수도 → **CLT 요건 위배**.

### 8.2 실무 증상
- 일별 평균이 **툭툭 튀는**데, 표본 수는 충분해 보인다 → **원분포 꼬리** 의심.
- “평균 120초, 표준편차 300초”만으론 의사결정이 불가능.

### 8.3 대안 리포팅
- **중앙값·IQR(사분위 범위)**, **상위 분위(90p/95p)** 병기.
- **로그척도**(log1p) 평균·표준편차 추가 표기.
- **로버스트 회귀/정규화(윈저라이징·트리밍)**.

---

## 9. 예제 1 — 체류시간: 지수 vs 감마 vs 로그정규 비교
### 9.1 설정
- 시나리오 A(지수): λ=1/60(평균 60s)
- 시나리오 B(감마): k=3, θ=20(평균 60s, 분산 ↓)
- 시나리오 C(로그정규): μ=3.8, σ=1.0(평균 ≈ e^{3.8+0.5}=e^{4.3}≈73.7s; 꼬리 두꺼움)

### 9.2 상위 분위(95p) 비교
- 지수: $$q_{0.95}=\frac{-\ln(0.05)}{\lambda}\approx 179.2s$$
- 감마(k=3): 지수보다 **짧아짐**(증가 hazard)
- 로그정규: **더 길다**(heavy-tail) → 같은 평균이라도 SLA/UX 체감이 나쁘다.

### 9.3 메시지
- “평균 60s”로만 보고하면 A/B/C가 **구분 불가능**.
- **95p·99p**를 함께 보고해야 **꼬리**가 드러난다.

---

## 10. 예제 2 — 일별 평균 체류시간의 정규 근사 검증
### 10.1 두 팀 비교
- 팀 A: 사용자 50,000명, 로그정규(μ=3.8, σ=0.9)
- 팀 B: 사용자 50,000명, 로그정규(μ=3.85, σ=0.9) → 평균 미세 ↑

### 10.2 근사
- 표본 수가 매우 크므로 **평균의 분포는 정규에 가깝다**.
- 다만, **σ가 큰 heavy-tail**이면 수렴이 느려 **일별 변동성이 기대보다 크다**.
- **권장**: t-CI와 함께 **부트스트랩 CI** 병기(재표본화로 꼬리 민감성 보완).

---

## 11. 예제 3 — 카이제곱과 분산 추정
### 11.1 정규 가정에서의 표본분산
- $$X_i\stackrel{i.i.d.}{\sim} \mathcal{N}(\mu,\sigma^2)$$ 일 때
  $$\frac{(n-1)S^2}{\sigma^2}\sim \chi^2_{n-1}$$
- **분산에 대한 CI**:
  $$\left[\frac{(n-1)S^2}{\chi^2_{1-\alpha/2}},\ \frac{(n-1)S^2}{\chi^2_{\alpha/2}}\right]$$
- **실무**: 정규성 위배 시 신뢰성 낮아짐 → **부트스트랩** 대안 고려.

---

## 12. 예제 4 — 지수/감마로 “재방문까지의 시간” 모델
### 12.1 D1 리텐션 해석
- D1(다음날 재방문) 확률 **p**는 베르누이지만, **재방문까지의 시간**은 **대기시간**.
- 알람/콘텐츠 노출 **빈도**를 바꾸면 **λ(또는 k, θ)**가 변한다 → **정책 실험** 가능.

### 12.2 **정책 A vs B**
- A: 푸시 하루 1회 → λ_A=1/36h
- B: 푸시 하루 2회 → λ_B=1/24h
- **24시간 이내 재방문**: $$1-e^{-\lambda\cdot 24}$$ 비교 → B가 이론상 ↑.
- **주의**: 너무 잦으면 **피로도 증가**로 **λ 감소**(모형 파라미터가 사용자 행태 반영).

---

## 13. 정규성 진단 — “검정”보다 “그림+요약치” 우선
### 13.1 QQ-plot 사고
- **직선**이면 정규성 근사 양호.
- 하위/상위 꼬리가 휘면 heavy/light tail 신호.

### 13.2 Shapiro–Wilk/Anderson–Darling
- **대표본**에선 사소한 일탈도 유의 → **“실질 의미”** 감안.
- **권장**: 검정 결과보다 **QQ-plot + 분위수 리포팅** + **민감도 분석**.

---

## 14. 로그 변환(및 Box–Cox) — 언제, 어떻게
### 14.1 log1p 변환의 실무성
- **0 포함** 데이터(체류 0초 포함 등)에 대비해 **log1p(x)=\log(1+x)** 활용.
- 정규근사/회귀에서 **잔차 대칭화**에 도움.

### 14.2 Box–Cox
- $$g_\lambda(x)=\begin{cases}\frac{x^\lambda-1}{\lambda},& \lambda\ne 0\\ \log x,& \lambda=0\end{cases}$$
- λ를 데이터로 추정해 **가장 대칭**에 가깝게 만드는 방법.

---

## 15. 실무 리포트 템플릿(연속형 지표)
- **체류시간**: “중앙값 45s [IQR 18–120], 95p 280s, log-평균 3.5±0.7, 평균 68s(heavy-tail 주의).”
- **대기시간**: “감마(k=2.7, θ=22s) 추정, 평균 59s, 90p 110s, hazard 증가형.”
- **일별 평균**: “A 대비 B +3.2s [ +1.5, +4.9 ], t-CI; 부트스트랩 CI 유사.”

---

## 16. 미니 계산·시뮬 스니펫(개념용)
```python
# 개념 시뮬: 지수/감마/로그정규의 꼬리 비교와 일별 평균의 정규근사 체감
import random, math

def exp_sample(lam):  # lam = 1/mean
    u = random.random()
    return -math.log(1-u)/lam

def gamma_sample(k, theta):  # k integer for simplicity (Erlang)
    return sum(exp_sample(1/theta) for _ in range(int(k)))

def lognorm_sample(mu, sigma):
    z = random.gauss(0,1)
    return math.exp(mu + sigma*z)

def daily_mean(draw_fn, n=1000):
    xs = [draw_fn() for _ in range(n)]
    m = sum(xs)/n
    return m

# 예: heavy-tail에서 일별 평균 변동 관찰 (실행환경에서 수치 확인)
```

---

## 17. 체크리스트 — 연속분포·정규세계 사용 전 점검
1) **시간/양수형**이면 (지수·감마·로그정규) 후보부터 본다.
2) **기억없음**이 합리적? (지수) 아니면 단계 합성? (감마) 꼬리 두꺼움? (로그정규)
3) **SLA/UX**에 중요하면 **95p/99p**를 함께 보고한다.
4) **평균 보고** 전 **중앙값·IQR**을 먼저 본다.
5) **정규근사**는 **합/평균**에서만 신중히. 개별 분포의 heavy-tail이면 **수렴 속도** 주의.
6) **분산 CI/검정**에 정규 가정이 들어가면, **부트스트랩** 병행.
7) **로그 변환/Box–Cox**로 대칭화 후 해석을 **원척도**로 재번역할 계획이 있는가?
8) **카이제곱** 사용 시 기대빈도 요건·정규가정·자유도 계산을 명확히.

---

## 18. 연습문제 (정답 스케치 포함)

**[1] 지수 분포 중앙값**
- Exp(λ)에서 중앙값과 평균 관계를 서술하라.
- **스케치**: med = (ln2)/λ < mean = 1/λ.

**[2] Erlang 대기시간**
- 포아송율 λ=0.1/s, k=3번째 이벤트까지의 평균/분산은?
- **스케치**: Gamma(k=3, θ=1/λ) → E=30s, Var=300s².

**[3] heavy-tail 리포팅**
- 로그정규(μ=3.5, σ=1.1) 체류시간의 평균·중앙값·95p를 개념적으로 비교하고, 어떤 지표를 리포트할지 제안하라.
- **스케치**: mean > median, 95p 매우 큼 → 중앙값+IQR+상위 분위 병기.

**[4] CLT 한계**
- 파레토(α≤2)에서 분산 무한이면 평균의 정규근사는 왜 깨지나?
- **스케치**: 분산 유한성 가정 위배 → 안정분포(레비)류로 수렴.

---

## 19. TL;DR
- **지수**: 기억 없음, 사건 간격.
- **감마(Erlang)**: 지수 합, k단계 대기시간.
- **카이제곱**: 정규제곱 합 = 감마(ν/2, 2), 분산 추정·회귀 기초.
- **정규**: 합/평균의 끝; CLT는 **꼬리·왜도**가 크면 느리게 온다.
- **Heavy-tail 주의**: 체류·금액 등은 평균·표준편차만으론 위험 → **중앙값·분위·로그척도** 병기, **부트스트랩** 병행.
