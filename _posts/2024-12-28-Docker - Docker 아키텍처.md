---
layout: post
title: Docker - Docker 아키텍처
date: 2024-12-28 21:20:23 +0900
category: Docker
---
# 🐳 Docker 아키텍처: 이미지, 컨테이너, 레지스트리, 데몬

Docker는 애플리케이션을 컨테이너 단위로 패키징하고 실행하는 플랫폼이며, 다음의 핵심 요소들로 구성됩니다:

---

## 📦 1. 이미지 (Image)

### ✔️ 개념
이미지는 컨테이너를 실행하기 위한 **불변의 실행 파일(템플릿)**입니다.  
소스 코드, 라이브러리, 환경설정 파일 등 실행에 필요한 모든 것을 포함합니다.

> 즉, "컨테이너를 찍어내는 청사진"입니다.

### ✔️ 계층 구조  
이미지는 여러 계층(layer)으로 구성되며,  
Dockerfile의 명령 하나하나가 각각의 계층이 됩니다.

예:
```Dockerfile
FROM ubuntu:20.04
RUN apt-get update
RUN apt-get install -y nginx
COPY . /app
```

→ 위의 명령마다 하나씩 계층이 쌓임  
→ 중간 계층은 **캐시**로 재사용 가능

---

## 📦 2. 컨테이너 (Container)

### ✔️ 개념  
컨테이너는 이미지를 기반으로 실행되는 **격리된 실행 환경(프로세스)**입니다.

> 이미지를 실행시킨 “결과물”이며, **가볍고 일시적인 가상 머신**처럼 동작합니다.

### ✔️ 특징
- **호스트 OS 커널을 공유**
- 독립된 파일 시스템, 네트워크, PID 공간을 가짐
- 컨테이너는 일시적이며, 종료되면 변경 사항은 사라짐 (별도 저장 안 하면)

```bash
docker run -it ubuntu bash
```
→ 위 명령은 `ubuntu` 이미지를 기반으로 새 컨테이너를 만들고 bash 쉘을 실행함

---

## 🗃️ 3. 레지스트리 (Registry)

### ✔️ 개념  
이미지를 저장하고 공유할 수 있는 중앙 저장소입니다.  
Docker는 이미지를 **pull(가져오기)** 하거나 **push(업로드)** 할 수 있습니다.

### ✔️ 대표 레지스트리
- **Docker Hub**: 공식 기본 레지스트리 (hub.docker.com)
- **GitHub Container Registry (ghcr.io)**
- **Harbor, JFrog Artifactory**: 사내 전용 프라이빗 레지스트리

### ✔️ 주요 명령어
```bash
docker pull nginx          # 레지스트리에서 이미지 가져오기
docker push myrepo/myapp  # 레지스트리에 이미지 업로드
```

---

## ⚙️ 4. Docker 데몬 (Docker Daemon)

### ✔️ 개념  
`dockerd`는 Docker의 핵심 백그라운드 프로세스로,  
**이미지 빌드, 컨테이너 생성, 네트워크 설정, 볼륨 관리 등 모든 실제 작업을 처리**합니다.

> Docker CLI에서 명령을 입력하면, 실제 처리는 **데몬이 수행**합니다.

### ✔️ 예: 내부 흐름
```bash
docker run nginx
```

1. Docker CLI가 `dockerd`에 요청 전달
2. 데몬이 레지스트리에서 `nginx` 이미지 존재 확인 또는 pull
3. 컨테이너 생성 및 실행

### ✔️ 특징
- 루트 권한으로 실행되는 경우 많음 → 보안 주의 필요
- REST API 기반으로 동작 (Unix socket 또는 TCP로 통신)

---

## 🔄 전체 흐름 정리 (아키텍처 순서)

```
+------------------+        docker pull / push
|   Registry       |  <-------------------------->
|  (Docker Hub)    |
+------------------+
          ↑
          |
          |   Image 저장/불러오기
          ↓
+------------------+     docker build
|    Image         | <---------------------+
| (계층 구조 파일) |                       |
+------------------+                       |
          ↓                                |
          |   docker run                   |
          ↓                                |
+------------------+                       |
|   Container      | ----------------------+
| (격리된 실행 환경)|       based on Image
+------------------+

           ↕
      Docker CLI ↔ Docker Daemon (dockerd)
```

---

## ✅ 요약

| 구성 요소 | 설명 |
|-----------|------|
| **Image** | 컨테이너의 템플릿. 불변, 계층 구조 |
| **Container** | 실행 중인 인스턴스. 이미지 기반, 격리된 환경 |
| **Registry** | 이미지 저장소 (공개 또는 프라이빗) |
| **Daemon** | 백그라운드에서 컨테이너/이미지를 실질적으로 처리하는 핵심 엔진 |

---

## 🚀 결론

Docker는 **이미지 → 컨테이너 → 배포 및 실행**이라는 단순한 흐름이지만,  
그 내부는 레이어 캐싱, 데몬 API, 컨테이너 격리 등으로 매우 **유연하고 강력한 구조**를 가집니다.