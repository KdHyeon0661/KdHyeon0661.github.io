---
layout: post
title: 논리회로설계 - 설계 복습, 한정된 팬인 설계 기법, 게이트 지연·타이밍도
date: 2025-09-03 17:25:23 +0900
category: 논리회로설계
---
# 조합회로 설계 & 시뮬레이션 — **설계 복습**, **한정된 팬인 설계 기법**, **게이트 지연·타이밍도**

> 표기: \(+\)=OR, \(\cdot\) 또는 생략=AND, \(\overline{X}\)=NOT \(X\), \(X'\equiv\overline{X}\), \(\oplus\)=XOR.  
> 목표: (1) 조합회로 설계 절차를 처음부터 끝까지 복습하고, (2) **게이트 팬인 제한**(FPGA LUT/표준셀) 환경에서의 구조화 기법을 익히며, (3) **지연 모델과 타이밍도**로 시간적 동작을 정확히 읽고 **시뮬레이션**까지 수행합니다.

---

## 1. 조합회로 설계 **복습**

### 1.1 Top-down 설계 흐름
1. **사양 정리**: 자연어 요구사항을 **입출력 변수**와 제약(팬인·팬아웃·전력·면적·지연), don’t-care(미사용 코드)로 구조화.  
2. **행동 명세화**: **진리표** 또는 **불 대수식**(SOP/POS/ESOP)으로 기술.  
3. **최소화**: K-map(2~6변수) → 큰 문제는 **퀸–맥클러스키/에스프레소(Espresso)** 등 휴리스틱으로 용어·리터럴·깊이 축소.  
4. **구현 선택**:  
   - SOP → **NAND–NAND**, POS → **NOR–NOR** (드모르간+버블 푸시).  
   - **샤논 전개(Shannon expansion)**로 **MUX 기반** 구현(아래 §2.2).   
   - **디코더+OR/NOR**, **PLA/ROM**, **LUT 기반** 등.  
5. **다중 출력 공유**: 공통 곱항/합항을 **1단에서 한 번만** 생성해 여러 출력이 공유(PLA 감각).  
6. **해저드 분석**: 정적-1/0 글리치 → **합의항(Consensus term)** 추가 등으로 완화.   
7. **검증**: 등가성 확인(진리표/SMT), **기능 시뮬** → **타이밍 시뮬**(지연·타이밍도) → **후공정(SDF) 백어노테이션**. 

### 1.2 구현 스타일 한눈에 요약
- **SOP → NAND–NAND**, **POS → NOR–NOR**:  
  \[
  \text{SOP } F=\textstyle\sum P_i\ \Rightarrow\ F=\overline{\prod \overline{P_i}} \quad
  \text{POS } F=\prod S_j\ \Rightarrow\ F=\overline{\sum \overline{S_j}}
  \]
- **샤논 전개(=MUX)**:  
  \[
  F(x,\mathbf{u}) = x\cdot F|_{x=1} + \overline{x}\cdot F|_{x=0}
  \Rightarrow F=\text{MUX}(x,\,F|_{1},\,F|_{0})
  \] 
- **디코더+OR/NOR**: \(\sum m(\cdot)\)을 **디코더 one-hot**로 켠 뒤 합산.

---

## 2. **한정된 게이트 팬인**을 갖는 설계

> 전형적 제약: **FPGA k-LUT**(k=4,6), **표준셀**에서 NAND2/3 권장, NOR는 큰 팬인에서 느림(물리적 이유는 §3.1). 

### 2.1 깊이의 하한
\(n\)개의 신호를 팬인 \(k\) 게이트로 결합할 때, 균형 트리의 **최소 단계 수**는  
\[
\text{stages}_{\min}=\left\lceil \log_k n \right\rceil .
\]
예) 16-input OR, \(k=2\) → 최소 4단.

### 2.2 구조화 기법 7가지
1) **균형 트리(Balanced tree)**  
   - 8-input OR를 OR2 7개로 3단 트리 구성(지연·글리치 모두 유리).  
   - NAND-only가 필요하면 입력에 **버블**을 배치해 OR를 NAND 트리로 등가 변환.
2) **인수화(Factoring)**  
   \[
   AB+AC+AD = A(B+C+D)
   \]
   → 단일 큰 OR/AND를 **작은 팬인** 조합으로 분해(배선·깊이 동시 감소).
3) **샤논 전개(변수 분할)**  
   \[
   F = x\cdot F_1 + \overline{x}\cdot F_0
   \]
   → **MUX 트리**로 구현, 각 노드 팬인 ≤3(AND2/OR2/MUX). 
4) **프리픽스(접두) 네트워크**  
   - 누적 AND/OR/Carry는 **Kogge–Stone/Brent–Kung**류로 \(\mathcal{O}(\log n)\) 지연 달성.
5) **공유(Reuse)**  
   - 다중 출력에서 공통 부분식을 **1단 공유**. 팬아웃↑이면 버퍼/재생성 트레이드오프.
6) **NAND/NOR 전용 분할**  
   - NOR 큰 팬인은 느리므로(상부 pMOS 직렬) 3-입력 초과시 **두 단계**로 쪼갬. 
7) **k-LUT 분해**(FPGA)  
   - 예: 6-LUT로 커버 안 되면 **샤논 전개**로 6-LUT 두 개 + 1 MUX로 결합.

### 2.3 사례 ① — 8-input Majority @ 팬인=2
명세: \(F=1 \iff\) 1의 개수 ≥4.  
전략: 2-비트 로컬 카운터 4개 → 부분합 결합 → 4-비트 비교기(≥4).  
깊이(정성): 카운터(2) + 결합(3) + 비교(2) ≈ **7단**.

### 2.4 사례 ② — 16-input OR @ NAND-only, 팬인=2
단계: NAND2 15개로 트리 구성(OR는 입력 버블로 대체).  
지연 근사: \(t_{pd}\approx 4\cdot t_{\text{NAND2}} + t_{\text{wire}}\).

### 2.5 사례 ③ — 4-비트 동등 비교 \(A==B\)
\[
E=\bigwedge_{i=0}^{3}(A_i\odot B_i)
\]
XNOR2 네 개 → AND2 균형 트리(깊이 \(=1+2=3\)).

---

## 3. **게이트 지연**과 **타이밍도**

### 3.1 지연 파라미터
- \(t_{pHL}\): 출력 H→L 전파 지연, \(t_{pLH}\): L→H 전파 지연  
- \(\displaystyle t_{pd}=\max(t_{pHL},t_{pLH}),\; t_{cd}=\min(t_{pHL},t_{pLH})\)  
- \(t_r,t_f\): 상승/하강 시간, \(t_{\text{wire}}\): 배선 지연(RC)  
- **관성 지연(inertial)**: 아주 짧은 펄스를 **걸러냄**, **수송 지연(transport)**: 펄스를 **그대로 전달**(시뮬레이터 선택)

**물리 직관(팬인과 속도)**  
CMOS에서 **NOR**는 풀업망 pMOS가 **직렬**로 길어져 상승 지연이 커지므로, 동일 팬인이라면 **NAND가 일반적으로 유리**. 큰 팬인은 NAND 중심으로, NOR는 2~3 입력으로 분할하는 것이 흔한 규칙입니다. 

### 3.2 경로·슬랙
- 경로 지연: \(\displaystyle T_{\text{path}}=\sum t_{gate} + \sum t_{wire}\)  
- **크리티컬 경로**: 최장 경로, **최단 경로**는 글리치 유발 가능(오염 지연 \(t_{cd}\) 관점)

### 3.3 불균형 지연과 해저드(glitch)
예: \(F=AB+\overline{A}C\). \(A\)가 0→1 전이 시 두 경로 지연이 다르면 순간 0(정적-1 해저드) 가능.  
**합의항** \(+BC\) 추가로 중첩을 만들어 완화합니다. 

#### 타이밍도(ASCII)
```
A:  ────┌────────
        │
        └─────────
B:  ──────────────  (1)
C:  ────────┌─────  (1 유지)
            │
            └─────
F=AB+A'C:
    ────┐__/\_____   ← 경로 지연 차로 순간 0(글리치)
        └─────────
F'=AB+A'C+BC:
    ──────────────   (중첩으로 해저드 완화)
```

### 3.4 트리 vs 체인(계산 근사)
- 8-input OR, OR2 지연 \(=d\).  
  - **균형 트리**: \(t_{pd}\approx 3d\).  
  - **직렬 체인**: 7단 → \(7d\).

---

## 4. **시뮬레이션**: 기능·타이밍 — Verilog/VHDL

### 4.1 기능 검증(등가성 & 합의항 효과)
```verilog
`timescale 1ns/1ps
module comb_ref(input A,B,C, output F);
  assign F = (A & B) | (~A & C);           // 기준식
endmodule

module comb_factored(input A,B,C, output F);
  assign F = (A & B) | (~A & C) | (B & C); // 합의항 추가
endmodule

module tb_equiv;
  reg A,B,C; wire F1,F2;
  comb_ref      U1(.A(A),.B(B),.C(C),.F(F1));
  comb_factored U2(.A(A),.B(B),.C(C),.F(F2));
  initial begin
    $display("t  A B C | F1 F2");
    for (integer i=0;i<8;i++) begin
      {A,B,C}=i[2:0]; #1;
      $display("%2t %0b %0b %0b |  %0b  %0b",$time,A,B,C,F1,F2);
    end
    $finish;
  end
endmodule
```

### 4.2 타이밍 시뮬(경로 지연·글리치 관찰)
```verilog
`timescale 1ns/1ps
module path_delays(input A,B,C, output F);
  wire nA, t1, t2;
  not  #(1,1)  U0(nA, A);
  and  #(2,2)  U1(t1, A, B);      // 경로1
  and  #(3,3)  U2(t2, nA, C);     // 경로2 (느림)
  or   #(1,1)  U3(F, t1, t2);
endmodule

module tb_timing;
  reg A,B,C; wire F;
  path_delays U(.A(A),.B(B),.C(C),.F(F));
  initial begin
    $dumpfile("wave.vcd"); $dumpvars(0, tb_timing);
    B=1; C=1; A=0; #5;
    A=1;          #20;   // A 토글 시 글리치 확인
    $finish;
  end
endmodule
```

### 4.3 VHDL — **inertial** vs **transport** 비교
```vhdl
library ieee; use ieee.std_logic_1164.all;
entity inertial_vs_transport is port (a: in std_logic; y1,y2: out std_logic); end;
architecture sim of inertial_vs_transport is
  signal w: std_logic;
begin
  -- 기본(관성) 지연: 짧은 펄스는 걸러짐
  y1 <= a after 5 ns;               -- inertial (default)
  -- 수송 지연: 펄스를 보존
  y2 <= transport a after 5 ns;     -- transport
end architecture;
```

### 4.4 후공정(SDF) 백어노테이션
ASIC/FPGA 흐름에서 **SDF(Standard Delay Format)**로 셀/배선 지연을 역주입해 타이밍 시뮬을 수행합니다(IEEE Std **1497**). 

---

## 5. MUX·디코더·Tri-State와 타이밍

### 5.1 MUX(샤논 전개)로 임의 함수 구현
2:1 MUX 하나로  
\[
F(x,\mathbf{u})=x\cdot F|_{x=1}+\overline{x}\cdot F|_{x=0}
\]
을 그대로 매핑(선택선= \(x\), 데이터= \(F|_{1},F|_{0}\)). 

### 5.2 내부 Tri-State 금지(현대 FPGA)
현대 FPGA 내부는 **실제 삼상(3-state) 버스**를 쓰지 않고, 합성 시 **MUX로 변환**됩니다. (I/O 핀 단에서는 OBUFT 등으로 3-state 사용) 

### 5.3 Tri-State 기반 4:1 MUX(외부 버스)
- \(2\!\to\!4\) **디코더**로 one-hot \(E_0..E_3\) 생성  
- 각 데이터 \(D_i\)를 **3-상태 버퍼**로 구동, **OE=E_i**  
- 네 버퍼를 **공통 버스**에 접속(한 번에 **하나만 OE=1**)

**타이밍 주의**: 해제(Z)→활성 사이의 **릴리즈/인에이블 시간**을 확보해 겹침·공백을 방지.

---

## 6. 종합 **설계 사례**

### 6.1 팬인 제한 아래의 10-input OR (NOR-only 불가 조건 포함)
- 표준셀에서 NOR3 초과 금지라면: **NOR2 트리**로 10개 입력 결합(깊이 \(\lceil\log_2 10\rceil=4\)).  
- 지연 비교(정성): 같은 팬인이라도 **NOR 트리**가 **NAND 트리**보다 상향 지연이 커지는 경향 → NAND 중심이 유리. 

### 6.2 3변수 함수의 4:1 MUX 구현
목표: \(F(A,B,C)=\sum m(1,2,6,7)\).  
선택선 \(S_1S_0=AB\), 데이터 \(D_i=F|_{AB=i}\): \(D_0=0,\ D_1=\overline{C},\ D_2=0,\ D_3=1\)  
\[
F=\text{MUX}_{S_1S_0}(1,0,\overline{C},0).
\]

---

## 7. 실무 팁 요약

1. **초기부터 팬인 제약**(LUT/셀)을 설계식에 반영.  
2. **균형 트리**와 **인수화**로 지연·전력·글리치를 함께 줄임.  
3. 큰 팬인은 **NAND 우선**, NOR는 2~3 입력으로 분해.   
4. **don’t-care**는 결합에만 사용해 큰 임플리컨트를 확보.  
5. **해저드 완화**: 합의항 추가, 또는 **레지스터 삽입**(동기화).   
6. **타이밍 시뮬**: 기능(0-delay) → 유닛딜레이 → **SDF**(포스트 배치/배선) 순으로 정밀도 상승.   
7. **FPGA 내부 Tri-State 금지**: 내부 버스는 **MUX/LUT**, 외부는 OBUFT. 

---

## 8. 연습문제(풀이 원하면 이어서 제공)

1) **팬인=2 제한**에서 \(F=A+B+C+D+E\) 를  
   - (a) OR2 균형 트리로 구현(게이트 수·깊이 계산),  
   - (b) NAND-only로 변환(버블 배치 포함)하라.  

2) \(F=AB+\overline{A}C\) 의 \(A\) 토글 시 정적-1 해저드를 **타이밍도**로 보이고,  
   - (a) 합의항 \(+BC\) 추가 후 파형 변화를 설명,  
   - (b) Verilog로 경로 지연을 주어 글리치를 관찰하라(§4.2 기반).  

3) **k-LUT(=4)** 에서 \(F(A,B,C,D,E)=\text{Majority}(5)\) 를  
   - (a) 샤논 전개로 4-LUT 2개 + 1 MUX로 분해,  
   - (b) 깊이·LUT 수를 계산하라.  

4) 다중 출력  
   \[
   F_1=AB+AC+\overline{B}D,\quad F_2=\overline{A}C+BD
   \]
   - (a) 공유 곱항을 선정해 2단 NAND–NAND 네트워크를 그리기,  
   - (b) 공유 노드 팬아웃 증가가 타이밍에 미치는 영향과 해결책(버퍼/재생성)을 논하라.  

5) 16-input OR를 **NOR-only**로 구현해야 한다면  
   - (a) NOR2 깊이를 계산,  
   - (b) 동일 팬인 NAND-only 대비 지연을 정성적으로 비교하라. 

---

## 9. 참고(US/EU 출처)

- **Shannon 전개 ↔ MUX 구현** 개요(유럽): KTH 강의 노트.   
- **CMOS 게이트·팬인·지연 직관 & Logical Effort**(미국): Weste/Harris 자료 및 Logical Effort 개론.   
- **해저드·합의항(Consensus)**(미국): UC Davis 노트.   
- **SDF 표준(타이밍 백어노테이션)**(미국): IEEE Std 1497 표준 페이지.   
- **FPGA 내부 3-state 금지(버스→MUX)**(미국): Spartan-3E 설명서(스파크펀 배포 PDF). 

---

### 포켓 요약
- 설계: **사양→명세(진리표/식)→최소화→구현 선택→해저드→검증(기능·타이밍·SDF)**.  
- 팬인 제한: **균형 트리/인수화/샤논 전개/공유**로 해결.  
- 지연·타이밍: \(t_{pd},t_{cd}\), 크리티컬 경로, 관성/수송 지연, 글리치.  
- 시뮬: **Verilog/VHDL**로 기능→타이밍, SDF로 후공정 검증.  
- 현실 규칙: 큰 팬인에선 **NAND가 유리**, **FPGA 내부 3-state 금지**(MUX 대체).