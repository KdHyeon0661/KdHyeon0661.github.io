---
layout: post
title: 논리회로설계 - 설계 복습, 한정된 팬인 설계 기법, 게이트 지연·타이밍도
date: 2025-09-03 17:25:23 +0900
category: 논리회로설계
---
# 조합회로 설계 & 시뮬레이션 — **설계 복습**, **한정된 팬인 설계 기법**, **게이트 지연·타이밍도**

> 표기: \(+\)=OR, \(\cdot\) 또는 생략=AND, \(\overline{X}\)=NOT \(X\), \(X'\equiv\overline{X}\), \(\oplus\)=XOR.  
> 목표: (1) 조합회로 설계 절차를 처음부터 끝까지 복습하고, (2) **게이트 팬인 제한**이 있는 현실 환경(FPGA LUT, 셀 라이브러리)에서의 구조화 기법을 익히며, (3) **지연 모델과 타이밍도**로 회로의 시간적 동작을 정확히 읽고 시뮬레이션하는 법을 정리합니다.

---

## 1) 조합회로 설계 **복습**

### 1.1 전형적 설계 흐름(Top-down)
1. **사양 정리**: 한국어/영문 서술 → **입출력 변수 정의**. 케이스, 제약(팬인·팬아웃·전력), don’t-care(미사용 코드) 명시.  
2. **행동 명세화**: **진리표** 작성 또는 **불 대수식**(SOP/POS/ESOP)으로 초기 표현.  
3. **최소화**: K-map(2~6변수), **퀸–맥클러스키**/Espresso(알고리즘)로 항·리터럴·깊이 감소.  
4. **구현 선택**: NAND-only/NOR-only, **PLA/ROM**, **디코더+OR**, **MUX 기반**(샤논 전개), **LUT 기반** 등.  
5. **다중 출력 공유**: 공통 곱항/합항을 1단에서 **한 번만** 생성해 여러 출력이 공유.  
6. **해저드 분석**: 정적-1/0 글리치 → **합의항** 추가 또는 중첩 그룹으로 완화.  
7. **검증**: 등가성(진리표·K-map·SMT), **시뮬레이션**(기능/타이밍), **타이밍도**로 시간 동작 검증.

### 1.2 구현 스타일 한 눈에
- **SOP → NAND–NAND**, **POS → NOR–NOR** (드모르간+버블 푸시)  
- **MUX(샤논 전개)**:  
  \[
  F=x\cdot F|_{x=1}+\overline{x}\cdot F|_{x=0}
  \Rightarrow F = \text{MUX}(x,\ F|_{1},\ F|_{0})
  \]
- **디코더+OR**: \(\sum m(\cdot)\) 직접 합.  
- **PLA/ROM**: 다중 출력에 유리(공유 항, 규칙적 배선).

### 1.3 미니 체크리스트
- [ ] don’t-care를 **결합에는 활용**, 최종 커버 판단에서는 제외(ISF 원칙).  
- [ ] 2단이면 팬인 점검, 다단이면 경로 균형(트리형).  
- [ ] NAND가 큰 팬인에서 NOR보다 유리(§3 지연 참고).

---

## 2) **한정된 게이트 팬인**을 갖는 회로의 설계

> 팬인 제한 예: **FPGA k-LUT**(k=4,6), **표준셀**(NAND2/NAND3 권장, NOR는 2~3입력 권장).  
> 목표: “넓은 OR/AND”를 **작은 팬인** 게이트로 **깊이·게이트 수** 균형 있게 분해.

### 2.1 기본 개념과 하한
- \(n\)개의 신호를 팬인 \(k\) 게이트로 결합 시, **균형 이진트리**로 깊이 하한:
  \[
  \text{stage}_{\min}\ \ge\ \left\lceil \log_k n \right\rceil
  \]
  예) 16-input OR, \(k=2\) → 최소 4단.

### 2.2 구조화 기법 7가지
1) **균형 트리(Balanced tree)**  
   - 8-input OR = OR2 트리 7개, 깊이 \(= \lceil\log_2 8\rceil=3\).  
   - NAND-only: OR를 **입력 버블+NAND 트리**로 변환.

2) **인수화(Factoring)**  
   \[
   AB+AC+AD = A(B+C+D)
   \]
   → 작은 팬인의 OR/AND 조합으로 **단계·배선** 동시 감소.

3) **샤논 전개(변수 분할)**  
   \[
   F = x\cdot F_1 + \overline{x}\cdot F_0
   \]
   → **MUX 트리**로 구현(각 노드 팬인 ≤3: MUX, AND2, OR2).

4) **프리픽스(접두) 네트워크**  
   - 대규모 OR/AND/Carry 누적에 **Kogge–Stone/Brent–Kung**류로 깊이 \(\mathcal{O}(\log n)\) 달성.

5) **재사용(공유)**  
   - 다중 출력에서 공통 부분식을 1단으로 묶고 **팬아웃만 관리**(버퍼/재생성 트레이드오프).

6) **NAND/NOR 전용 분할**  
   - **NOR 큰 팬인 지양**: pMOS 직렬로 상승 지연↑. 3입력 초과 시 **두 단계**로 쪼갬.  
   - NAND는 상대적으로 유리하나, 과도한 팬인은 역시 지연·전력↑.

7) **k-LUT 분해**(FPGA)  
   - 6-LUT로 커버 안 되는 식은 **샤논 전개**로 2개의 6-LUT + 1 MUX로 결합.

### 2.3 사례 ① — 8-input 다수결(Majority) @ 팬인=2
- 명세: \(F=1\) iff 1의 개수 ≥4.  
- **전략**: (i) **가중 합**을 직접 만들기보다, (ii) **계층적 카운트**  
  - 2비트 카운터 4개 → 부분 합 → 4비트 가산(팬인=2).  
  - 비교기(≥4)는 **트리형 OR/AND**로 구성.  
- 깊이: 카운터(2) + 가산(3) + 비교(2) ≈ **7단**(게이트 기준).

### 2.4 사례 ② — 16-input OR @ NAND-only, 팬인=2
- **단계**: 15개의 NAND2로 **트리** 구성(OR는 입력 버블로).  
- 지연: \(t_{pd}\approx 4\cdot t_{\text{NAND2}} + t_{\text{배선}}\).

### 2.5 사례 ③ — 4비트 동등 비교 \(A==B\) (XNOR 체인)
\[
E = \bigwedge_{i=0}^{3}(A_i \odot B_i)
\]
- XNOR2 → AND2 트리. NOR-only가 필요하면 드모르간으로 변환.  
- 팬인=2 유지, 깊이 \(= \lceil\log_2 4\rceil + 1 = 3\).

---

## 3) **게이트 지연**과 **타이밍도**

### 3.1 지연 파라미터(정의)
- \(t_{pHL}\): 출력이 **H→L**로 전이하는 **전파 지연**  
- \(t_{pLH}\): **L→H** 전파 지연  
- \(\displaystyle t_{pd}=\max(t_{pHL},t_{pLH}),\quad t_{cd}=\min(t_{pHL},t_{pLH})\) (오염 지연)  
- \(t_r,t_f\): 상승/하강 시간(에지 기울기)  
- **배선 지연**: \(t_{\text{wire}}\) (RC + 인덕턴스, 길이/부하 의존)  
- **관성 지연(inertial)**: **짧은 펄스**(\(<t_{pd}\) 근방)를 **필터링**  
- **수송 지연(transport)**: 펄스를 **그대로 전달**(시뮬레이터 모델에 따라 선택)

### 3.2 경로·슬랙
- 경로 지연: \(\displaystyle T_{\text{path}}=\sum t_{gate} + \sum t_{wire}\)  
- **최장 경로=크리티컬 경로**(회로 속도 한계), **최단 경로**는 **글리치**의 원인(\(t_{cd}\) 분석)  
- **슬랙**: \(T_{\text{요구}}-T_{\text{도착}}\) (조합–레지스터 경계에서 중요)

### 3.3 불균형 지연과 해저드(glitch)
- 예: \(F=AB+\overline{A}C\). \(A\)가 0→1 전이 시 두 경로 지연 다르면 일시적 0 발생(정적-1 해저드).  
- **합의항** \(+BC\) 로 중첩시켜 완화(K-map에서 덮개 겹침).

#### 타이밍도(ASCII)
```
A:  ────┌───────
        │
        └──────────
B:  ─────────────── (1)
C:  ────────┌───── (1 유지)
            │
            └─────
F=AB+A'C:
    ────┐__/\_____   ← 경로 지연 차로 순간 0(글리치)
        └─────────
F'=AB+A'C+BC:
    ──────────────   (중첩으로 해저드 완화)
```

### 3.4 계산 예 — 트리 vs 직결
- 8-input OR, OR2 지연 \(=d\).  
  - **균형 트리**: \(t_{pd}\approx 3d\).  
  - **직렬 체인**(비합법적 OR2 연쇄): 최악 7단 → \(7d\).  
- NOR3 vs NAND3: pMOS 직렬 영향으로 \(t_{pd,\text{NOR3}} \gtrsim t_{pd,\text{NAND3}}\) 경향 → 팬인 제한 시 NOR는 더 빨리 분할.

---

## 4) **시뮬레이션**(기능/타이밍) — Verilog 예제

### 4.1 기능 검증(조합 등가성)
```verilog
`timescale 1ns/1ps
module comb_ref(input A,B,C, output F);
  assign F = (A & B) | (~A & C); // 기준식
endmodule

module comb_factored(input A,B,C, output F);
  // 합의항 추가 버전
  assign F = (A & B) | (~A & C) | (B & C);
endmodule

module tb;
  reg A,B,C;
  wire F1,F2;
  comb_ref     U1(.A(A),.B(B),.C(C),.F(F1));
  comb_factored U2(.A(A),.B(B),.C(C),.F(F2));

  initial begin
    $display("t A B C | F1 F2");
    for (integer i=0;i<8;i++) begin
      {A,B,C} = i[2:0]; #1;
      $display("%0t %0b %0b %0b |  %0b  %0b",$time,A,B,C,F1,F2);
    end
    $finish;
  end
endmodule
```

### 4.2 타이밍 시뮬레이션(지연 모델 & 글리치 관찰)
```verilog
`timescale 1ns/1ps
module path_delays(input A,B,C, output F);
  wire nA, t1, t2;
  // 게이트 지연 모델링: #(t_rise, t_fall)
  not  #(1,1)  U0(nA, A);
  and  #(2,2)  U1(t1, A, B);
  and  #(3,3)  U2(t2, nA, C); // 경로2가 더 느림
  or   #(1,1)  U3(F, t1, t2);
endmodule

module tb;
  reg A,B,C; wire F;
  path_delays U(.A(A),.B(B),.C(C),.F(F));
  initial begin
    $dumpvars; // GTKWave 등 파형 출력
    B=1; C=1; A=0; #5;
    A=1;        #20; // A 토글 시 글리치 관찰
    $finish;
  end
endmodule
```
- 위 테스트에서 \(t_1\ne t_2\) 이면 **F 파형**에 짧은 펄스가 보일 수 있음.  
- **합의항 추가** 버전과 비교하면 글리치가 사라지는 것을 확인.

> **후공정 타이밍**은 셀/배선 지연이 반영된 **SDF 백어노테이션**으로 검증합니다(툴에서 `+$sdf_annotate`).

---

## 5) 실무 팁(팬인·지연·시뮬레이션)

1. **팬인 제한**: 라이브러리 제약(NOR3 이상 지양 등)을 **초기에** 반영해 구조를 잡을 것.  
2. **균형화**: 트리/프리픽스로 **경로 균형** → 지연·글리치 모두 개선.  
3. **NAND 우선**: 큰 팬인이면 NAND 중심, NOR는 2~3입력으로 자주 분할.  
4. **don’t-care**: 결합에만 사용하여 **큰 임플리컨트** 확보(리터럴↓).  
5. **타이밍도**: \(t_{pd}/t_{cd}\)와 에지 타이밍을 항상 **같은 축**에 표시해 경로 차이를 시각화.  
6. **시뮬 모델**: 기능(0-delay) → 유닛딜레이 → **SDF** 순서로 정밀도 상승.  
7. **해저드 완화**: 합의항 추가, 또는 레지스터 삽입(동기화)로 시스템 레벨 안정화.

---

## 6) 연습문제(풀이 가능)

1) **팬인=2 제한**으로 \(F=A+B+C+D+E\) 를  
   - (a) OR2 균형 트리로 구현(게이트 수·깊이 계산),  
   - (b) NAND-only로 변환(버블 배치 포함).

2) \(F=AB+\overline{A}C\) 에서 \(A\) 토글 시 정적-1 해저드가 발생함을 **타이밍도**로 보이고,  
   - (a) 합의항 \(+BC\) 추가 후 파형 변화를 설명,  
   - (b) and/or 게이트 지연을 임의로 주어 **시뮬레이션 코드**를 작성.

3) **k-LUT(=4)** 에서 \(F(A,B,C,D,E)=\text{Majority}(5)\) 를  
   - (a) 샤논 전개로 4-LUT 2개 + 1 MUX로 분해,  
   - (b) 깊이·LUT 수를 계산.

4) 다중 출력  
   \[
   F_1=AB+AC+\overline{B}D,\quad F_2=\overline{A}C+BD
   \]
   - (a) 공유 곱항을 선정해 2단 NAND–NAND 네트워크를 그리기,  
   - (b) 공유 노드 팬아웃 증가가 타이밍에 미치는 영향과 해결책(버퍼링/재생성) 토론.

5) 16-input OR를 **NOR-only**로 구현해야 한다면  
   - (a) NOR2의 깊이를 계산,  
   - (b) 동일 팬인에서 NAND-only와 지연을 비교(정성적 분석 포함).

---

## 7) 포켓 요약
- 설계: **사양→진리표/식→최소화→구현 선택→해저드→검증**.  
- 팬인 제한: **균형 트리**, **인수화**, **샤논 전개**, **공유**로 해결.  
- 지연/타이밍: \(t_{pd}, t_{cd}\)·크리티컬 경로·**관성 지연**·글리치.  
- 시뮬: 기능→타이밍(지연 모델)→후공정(SDF).  
- 안전: 합의항/중첩으로 **해저드 완화**, NAND가 **큰 팬인에서 유리**.