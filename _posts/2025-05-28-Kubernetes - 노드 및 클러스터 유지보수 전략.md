---
layout: post
title: Kubernetes - ë…¸ë“œ ë° í´ëŸ¬ìŠ¤í„° ìœ ì§€ë³´ìˆ˜ ì „ëµ
date: 2025-05-28 22:20:23 +0900
category: Kubernetes
---
# Kubernetes ë…¸ë“œ ë° í´ëŸ¬ìŠ¤í„° ìœ ì§€ë³´ìˆ˜ ì „ëµ

Kubernetes í´ëŸ¬ìŠ¤í„°ëŠ” **ì§€ì†ì ìœ¼ë¡œ ìš´ì˜**ë˜ì–´ì•¼ í•˜ë©°, ê·¸ ê³¼ì •ì—ì„œ ë…¸ë“œ ì¥ì• , ì»¤ë„ ì—…ë°ì´íŠ¸, íŒ¨ì¹˜ ì‘ì—…, ë¦¬ì†ŒìŠ¤ ê³ ê°ˆ ë“± ë‹¤ì–‘í•œ ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤.

ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ **ë…¸ë“œ ë° í´ëŸ¬ìŠ¤í„° ìœ ì§€ë³´ìˆ˜ ì „ëµ**ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## âœ… ìœ ì§€ë³´ìˆ˜ ì£¼ìš” ëª©ì 

- OS ë° ì»¤ë„ ì—…ë°ì´íŠ¸ (ë³´ì•ˆ íŒ¨ì¹˜)
- Kubelet, Container Runtime, Docker ë“± ë²„ì „ ì—…ë°ì´íŠ¸
- ë…¸ë“œ ìŠ¤ì¼€ì¼ ì¸/ì•„ì›ƒ
- ë…¸ë“œ ì¥ì•  ì¡°ì¹˜ ë° ëŒ€ì²´
- í´ëŸ¬ìŠ¤í„° ì „ì²´ ì—…ê·¸ë ˆì´ë“œ
- ë””ìŠ¤í¬/ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ëŒ€ì‘

---

## âœ… ë…¸ë“œ ìœ ì§€ë³´ìˆ˜ ì ˆì°¨

KubernetesëŠ” **ë…¸ë“œë¥¼ ë“œë ˆì´ë‹(Draining)**í•˜ì—¬ ì•ˆì „í•˜ê²Œ Podì„ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.

### ğŸ”¹ 1. ë…¸ë“œ cordon (ìŠ¤ì¼€ì¤„ ê¸ˆì§€)

```bash
kubectl cordon <ë…¸ë“œì´ë¦„>
```

â†’ í•´ë‹¹ ë…¸ë“œì— **ìƒˆë¡œìš´ Pod ë°°ì¹˜ê°€ ê¸ˆì§€ë¨**

---

### ğŸ”¹ 2. ë…¸ë“œ drain (Pod ëŒ€í”¼)

```bash
kubectl drain <ë…¸ë“œì´ë¦„> --ignore-daemonsets --delete-emptydir-data
```

- ëª¨ë“  Podì„ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•˜ê³  ë‹¤ë¥¸ ë…¸ë“œë¡œ ì´ë™
- DaemonSetì€ ì œì™¸ (`--ignore-daemonsets`)
- `emptyDir`ëŠ” ì‚­ì œë¨ ì£¼ì˜

> ğŸ’¡ `PodDisruptionBudget`ì„ ì¤€ìˆ˜í•˜ë©´ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë¨

---

### ğŸ”¹ 3. ìœ ì§€ë³´ìˆ˜ ì‘ì—… ìˆ˜í–‰

- OS íŒ¨ì¹˜
- ì»¤ë„ ì—…ë°ì´íŠ¸
- ì¬ë¶€íŒ…
- Docker/Kubelet ì—…ê·¸ë ˆì´ë“œ ë“±

---

### ğŸ”¹ 4. ë…¸ë“œ ë³µêµ¬ ë° uncordon

```bash
kubectl uncordon <ë…¸ë“œì´ë¦„>
```

â†’ ë‹¤ì‹œ ìŠ¤ì¼€ì¤„ë§ ê°€ëŠ¥ ìƒíƒœë¡œ ì „í™˜

---

## âœ… drain ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ë²•

- PDB (PodDisruptionBudget)ë¡œ ì¸í•´ ì¼ë¶€ Podì´ ì œê±°ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ  
  â†’ `kubectl get pdb`ë¡œ í™•ì¸
- DaemonSet Podì€ ìë™ìœ¼ë¡œ ìœ ì§€ë¨
- PVCê°€ local-pathë©´ migration ë¶ˆê°€

---

## âœ… DaemonSet ì¬ë°°í¬ ì˜ˆì‹œ (ì˜ˆ: ë¡œê·¸ ì—ì´ì „íŠ¸)

```bash
kubectl rollout restart daemonset <ì´ë¦„> -n <ë„¤ì„ìŠ¤í˜ì´ìŠ¤>
```

â†’ ê° ë…¸ë“œì— ì¬ë°°í¬ë˜ë©° ìµœì‹  ìƒíƒœë¡œ ìœ ì§€

---

## âœ… í´ëŸ¬ìŠ¤í„° ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì „ëµ

### ğŸ”¹ kubeadm ê¸°ë°˜

1. Control Plane ë…¸ë“œë¶€í„° ìˆœì°¨ ì—…ê·¸ë ˆì´ë“œ
2. `kubeadm upgrade plan`ìœ¼ë¡œ ë²„ì „ í™•ì¸
3. ê° ë…¸ë“œì— ëŒ€í•´ `kubeadm upgrade node` ì‹¤í–‰
4. kubelet ì¬ì‹œì‘

### ğŸ”¹ í´ë¼ìš°ë“œ ê¸°ë°˜(GKE, EKS, AKS)

- UI ë˜ëŠ” CLIë¡œ ë…¸ë“œ í’€ ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œ ì œê³µ
- ìë™ ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥ë„ ì‚¬ìš© ê°€ëŠ¥ (ë³´ì•ˆ íŒ¨ì¹˜ ì¤‘ì‹¬)

---

## âœ… OS ë° íŒ¨í‚¤ì§€ ìœ ì§€ë³´ìˆ˜ ìë™í™”

- **unattended-upgrades** (Ubuntu)
- **yum-cron** (CentOS/RHEL)
- CRON + `kubectl cordon/drain` ìŠ¤í¬ë¦½íŠ¸ ìë™í™”
- ì‹œìŠ¤í…œ ì¬ë¶€íŒ… í›„ `kubelet` ìë™ ë³µêµ¬ ì—¬ë¶€ í™•ì¸

---

## âœ… ë…¸ë“œ ì¥ì•  ëŒ€ì²˜ ì „ëµ

| ìƒí™© | ëŒ€ì‘ |
|------|------|
| ë…¸ë“œ Crash | ìë™ ê°ì§€ + Pod ì¬ìŠ¤ì¼€ì¤„ |
| ë…¸ë“œ Disk Full | ë¡œê·¸ íšŒìˆ˜ ì •ì±… + `emptyDir` ì‚¬ìš© ì œí•œ |
| ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ | ë¦¬ì†ŒìŠ¤ ì œí•œ + Prometheus Alert |
| Kubelet Down | `node-problem-detector`, `taint` ì„¤ì • í™œìš© |

---

## âœ… ìš´ì˜ íŒ

| íŒ | ì„¤ëª… |
|-----|------|
| `taint`ë¡œ ìœ ì§€ë³´ìˆ˜ ë…¸ë“œ ê²©ë¦¬ | ìˆ˜ë™ ë˜ëŠ” ìë™ìœ¼ë¡œ `NoSchedule` ì„¤ì • |
| `PodDisruptionBudget` ì ìš© | ì¤‘ìš” ì„œë¹„ìŠ¤ëŠ” ìœ ì§€ë³´ìˆ˜ ì‹œ ì¤‘ë‹¨ë˜ì§€ ì•Šë„ë¡ ë³´í˜¸ |
| `readinessProbe`/`livenessProbe` ì ê·¹ ì‚¬ìš© | ì•ˆì •ì ì¸ ìƒíƒœ ê°ì§€ ë° íšŒë³µ ìœ ë„ |
| ë…¸ë“œë³„ `label`ë¡œ ì—­í•  êµ¬ë¶„ | GPU, Worker, Ingress ë“± ëª©ì ë³„ ë¶„ë¦¬ ê´€ë¦¬ |
| ë¡œê·¸ ë°±ì—… ë° ë¡¤ë§ ì„¤ì • | ë””ìŠ¤í¬ ê³ ê°ˆ ë°©ì§€ (`logrotate`, `fluentbit` í™œìš©) |

---

## âœ… ë…¸ë“œ ìë™ ë³µêµ¬ ì˜ˆì‹œ (í´ë¼ìš°ë“œ)

- **EKS**: ë…¸ë“œ ê·¸ë£¹ì— AutoScaling ì„¤ì • â†’ ì¥ì•  ì‹œ ìë™ ëŒ€ì²´  
- **GKE**: ë…¸ë“œ ìë™ ë³µêµ¬ ê¸°ëŠ¥ ì œê³µ (Node Auto Repair)  
- **AKS**: VMSS ê¸°ë°˜ ìë™ ë³µêµ¬ ê°€ëŠ¥

---

## âœ… ìì£¼ ì“°ëŠ” ëª…ë ¹ ìš”ì•½

```bash
kubectl get nodes
kubectl describe node <ë…¸ë“œëª…>
kubectl cordon <ë…¸ë“œëª…>
kubectl drain <ë…¸ë“œëª…> --ignore-daemonsets --delete-emptydir-data
kubectl uncordon <ë…¸ë“œëª…>
```

---

## âœ… ê²°ë¡ 

| í•­ëª© | ìš”ì•½ |
|------|------|
| ë…¸ë“œ ìœ ì§€ë³´ìˆ˜ | cordon â†’ drain â†’ patch â†’ uncordon |
| í´ëŸ¬ìŠ¤í„° ì—…ê·¸ë ˆì´ë“œ | kubeadm ë˜ëŠ” í´ë¼ìš°ë“œ ê´€ë¦¬ íˆ´ í™œìš© |
| ìë™í™” | cron, kubelet self-healing, ë…¸ë“œ ë³µêµ¬ ì„¤ì • |
| ì•ˆì •ì„± í™•ë³´ | PDB, ë¦¬ì†ŒìŠ¤ ì œí•œ, ì ì ˆí•œ probe ì„¤ì • í•„ìš” |

ì •ê¸°ì ì¸ ìœ ì§€ë³´ìˆ˜ì™€ ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘ ì „ëµì„ í†µí•´ **ë¬´ì¤‘ë‹¨ ìš´ì˜**ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

---

## âœ… ì°¸ê³  ë§í¬

- [kubectl drain ê³µì‹ ë¬¸ì„œ](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#drain)
- [kubeadm ì—…ê·¸ë ˆì´ë“œ ê°€ì´ë“œ](https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/)
- [GKE ìë™ ë³µêµ¬ ì„¤ì •](https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-repair)
