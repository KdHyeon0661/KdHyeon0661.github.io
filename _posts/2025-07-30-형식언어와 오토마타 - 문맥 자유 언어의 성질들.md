---
layout: post
title: 형식언어와 오토마타 - 문맥 자유 언어의 성질들
date: 2025-07-30 15:20:23 +0900
category: 형식언어와 오토마타
---
# 문맥 자유 언어의 성질들 — 두 가지 펌핑 보조 정리

- **표기**: 입력 알파벳 \(\Sigma\), 문자열 길이 \(|w|\), 공백(빈 문자열) \(\varepsilon\).

---

## 0. 큰 그림과 전략 요약

- **CFL 펌핑 보조 정리(Bar-Hillel–Perles–Shamir)**
  \(\exists p\ge 1\) s.t. \(\forall w\in L\) with \(|w|\ge p\), \(\exists u,v,x,y,z\) with
  \[
  w=uvxyz,\quad |vy|\ge 1,\quad |vxy|\le p,\quad \forall i\ge 0:\; uv^i x y^i z\in L.
  \]
  → **좁은 창(|vxy|\le p)** 안에서 **두 조각 \(v,y\)** 를 **같은 지수로 동시 펌핑**.

- **선형 언어(Linear) 펌핑 보조 정리**
  선형 언어 \(L\)에 대해 \(\exists p\ge 1\) s.t. \(|w|\ge p\Rightarrow\) \(\exists u,v,x,y,z\):
  \[
  w=uvxyz,\quad |v|+|y|\ge 1,\quad |vxy|\le p,\quad \forall i\ge 0:\; uv^i x y^i z\in L.
  \]
  → 형태는 CFL 펌핑과 유사하지만 **선형 문법의 “척추(spine)” 구조**에서 나오는 **좌·우 대칭 펌핑**으로 해석하면 직관적.

> ⚠️ **두 정리는 필요조건**이다. “펌핑이 가능”하다고 해서 해당 클래스(CFL/Linear)임이 보장되지는 않는다.
> 난해한 사례에는 **오그덴 보조 정리(Ogden’s lemma)**, **Interchange Lemma** 등 더 강한 도구를 고려.

---

## 1. 문맥 자유 언어(CFL) 펌핑 보조 정리

### 1.1 정확한 진술
임의의 CFL \(L\)에 대해 \(\exists p\ge 1\) s.t. \(\forall w\in L, |w|\ge p\),
\[
\exists u,v,x,y,z:\; w=uvxyz,\;\; |vy|\ge 1,\;\; |vxy|\le p,\;\; \forall i\ge 0:\; uv^i x y^i z\in L.
\]

### 1.2 직관 (파스 트리 관점)
- 충분히 긴 유도 트리에서 **루트→잎** 경로에 같은 비단말이 **반복**됨(비둘기집 원리).
- 두 등장 사이의 하부 유도를 **한 번 더/덜** 적용하는 효과가 곧 \(v,y\)를 같은 배수로 **동시 펌핑**하는 것.

### 1.3 “증명 스케치” 머리맵
1) 문법을 **치환/정규화**(필요시 CNF) → 파스 트리 높이/폭에 대한 단순한 상계.
2) 높이 \(>p\)면 경로에 반복 비단말 존재 → 그 구간을 기준으로 \(u,v,x,y,z\) 분해.
3) 반복 구간을 \(i\)번 삽입/삭제해도 **구문 구조가 유지**됨 → 펌핑 성질 성립.

### 1.4 적용 “템플릿”
- **반증법**: \(L\)이 CFL이라고 가정하고 펌핑 길이 \(p\)를 받는다.
- 특정 **긴 문자열 \(w\)** 를 선택한다(보통 블록형 \(a^p b^p c^p\) 등).
- \(|vxy|\le p\) 제약을 이용해 **\(v,y\)의 위치를 제한**한다(“이 창 안에서는 OOO만 변함”).
- \(i=0\) 또는 \(i=2\)로 펌핑해 **언어의 불변량**(개수 동일·균형·순서 등)이 깨짐을 보인다.
- **모든 가능한 분해**에 대해 모순이 나야 한다(경우분석 완결).

### 1.5 대표 예제 ①: \(L=\{a^n b^n c^n\mid n\ge 0\}\)는 CFL이 **아님**
- 가정: CFL. 펌핑 길이 \(p\) 취함. \(w=a^p b^p c^p\).
- \(|vxy|\le p\) ⇒ \(v,y\)는 **서로 가깝게** 있어 최대 두 블록에만 걸친다(예: \(a|b\) 또는 \(b|c\)).
- 경우분석:
  - \(v,y\subseteq a^*b^*\): \(i\) 변조 시 \(a\)/\(b\)만 변하고 \(c\) 고정 ⇒ \(a,b,c\) 3개수 불일치.
  - \(v,y\subseteq b^*c^*\): 대칭.
  - \(v,y\subseteq b^*\) 내부: \(b\)만 변함.
- 모두 모순 ⇒ 비CFL.

### 1.6 대표 예제 ②: \(L=\{ww\mid w\in\{a,b\}^*\}\) (코멘트)
- 본 정리만으로도 반증 가능하나 **경우분석이 매우 까다롭다**.
- 실전에서는 **오그덴 보조 정리**로 간명하게 반증하는 것이 정석.

---

## 2. 선형 언어(Linear language) 펌핑 보조 정리

### 2.1 선형 문법 & 언어
- **선형 문법**: 모든 생성규칙의 RHS에 **비단말이 최대 하나**
  \[
  A\to u B v\quad \text{또는}\quad A\to w\qquad (u,v,w\in\Sigma^*).
  \]
- 계층: \(\text{Regular} \subsetneq \text{Linear} \subsetneq \text{CFL}\).
  예) 팔린드롬 \(\{w w^R\}\)은 선형, 균형괄호(Dyck)는 CFL이지만 **비선형**.

### 2.2 정리(전형적 표준형)
\(\exists p\ge 1\) s.t. \(\forall w\in L, |w|\ge p\),
\[
\exists u,v,x,y,z:\; w=uvxyz,\;\; |v|+|y|\ge 1,\;\; |vxy|\le p,\;\; \forall i\ge 0:\; uv^i x y^i z\in L.
\]

> **척추(spine) 직관**: 유도 과정에서 항상 **하나의 비단말**만 전진하므로, 동일 비단말 반복 지점에서 **좌측 단말 블록 \(v\)** 와 **우측 단말 블록 \(y\)** 을 **대칭 펌핑** 가능.

### 2.3 예제 ①: 팔린드롬 언어는 **선형**
- 문법(선형):
  ```
  S → a S a | b S b | … | ε | a | b | …
  ```
- 펌핑 감각: 중심을 기준으로 좌우 대칭으로 \(v,y\)를 골라 함께 늘려도 팔린드롬 유지.

### 2.4 예제 ②: \(L=\{a^n b^n c^n\}\)는 **비선형**
- 앞서 비CFL이므로 당연히 비선형.
- **선형 펌핑**만으로도 반증: \(|vxy|\le p\) 창이 중간 \(b^p\) 벽을 넘지 못하게 하여, \(v,y\) 펌핑 시 세 블록 동시 균형을 깨뜨리면 끝.

### 2.5 (스케치) 균형괄호 Dyck(한 종류)은 **선형이 아님**
- 정규와의 교집합 보존을 이용해 \(D\cap a^* b^* a^* b^* = \{a^i b^i a^j b^j\}\) 류로 축약하고,
- 선형 펌핑을 적용하면 좌우 동시 펌핑으로 **두 구간 균형을 동시에 유지**해야 하므로 모순 유도(상세한 경우분석 생략).
- 실전에서는 **1-turn PDA/구조적 인수분해** 성질을 쓰는 증명이 더 짧다.

---

## 3. 두 펌핑 정리 **비교·활용 팁·흔한 함정**

### 3.1 비교 핵심
| 항목 | CFL 펌핑 | 선형 펌핑 |
|---|---|---|
| 분해 | \(w=uvxyz\) | 동일 |
| 비공백 | \(|vy|\ge 1\) | \(|v|+|y|\ge 1\) |
| 창 크기 | \(|vxy|\le p\) | 동일 |
| 펌핑 | \(uv^i x y^i z\) | 동일(대칭 해석이 자연스러움) |
| 직관 | 파스 트리 경로 반복 | 선형 척추 반복(좌우 대칭) |

### 3.2 언제 무엇을?
- **비CFL 반증**: 우선 **CFL 펌핑** 또는 **오그덴**.
- **비선형 반증**: 선형 펌핑이 효과적. (단, 보조 정리도 필요조건임을 항상 명심)

### 3.3 함정
- “어떤 분해”가 아니라 **“모든 분해”**에서 모순이 나야 함.
- \(|vxy|\le p\)를 소홀히 하면 반례 구성이 무너짐.
- 펌핑이 **가능**하다고 해서 그 언어가 CFL/Linear라는 **충분조건은 아님**.

---

## 4. 폐포·부가 도구(간단 메모)

- **CFL**: 정규와 교집합, 합집합, 연접, Kleene-스타에는 닫힘. **교집합/보수**에는 일반적으로 닫히지 않음.
- **Linear**: 정규와의 교집합, 동형사상, 역상 등에 대한 닫힘 성질을 조합해 **축약 기법** 자주 사용.
- **강화 도구**: **Ogden’s Lemma**, **Interchange Lemma** — 펌핑에서 못 뚫는 언어(예: \(\{ww\}\))에 유용.

---

## 5. 코딩 데모 ① — **CFL 펌핑 반증 실습**(비CFL: \(a^n b^n c^n\))

> 목적: 펌핑 창 \(|vxy|\le p\)를 만족하는 다양한 분해를 **샘플**링해 \(i=0,2\) 펌핑 시 **균형 붕괴**를 확인한다.
> (코드는 **증명**이 아니라 **직관 강화**용 실험이다.)

```python
# -*- coding: utf-8 -*-
# 비공식 실습: w = a^p b^p c^p 에 대해 |vxy| <= p 를 만족하는 분해를 샘플링하고,
# i=0 또는 i=2 로 펌핑했을 때 언어 조건 a#=b#=c# 이 깨지는지 검사한다.

from collections import Counter
import random

def make_abc(n):
    return 'a'*n + 'b'*n + 'c'*n

def counts_ok(s):
    c = Counter(s)
    return c['a'] == c['b'] == c['c']

def sample_decompositions(w, p, trials=200):
    n = len(w)
    res = []
    for _ in range(trials):
        # pick a short window [L, R) of length <= p that will contain v x y
        L = random.randint(0, n-1)
        R = min(n, L + random.randint(1, p))
        # within [L,R) choose a split into v|x|y (allow empty x but require |v|+|y|>=1)
        if R - L < 1:
            continue
        a = random.randint(L, R-1)
        b = random.randint(a+1, R)
        u = w[:L]
        v = w[L:a]
        x = w[a:b]
        y = w[b:R]
        z = w[R:]
        if len(v) + len(y) == 0:
            continue
        res.append((u,v,x,y,z))
    return res

def pump(u,v,x,y,z,i):
    return u + v*i + x + y*i + z

def demo_abc(p=12, trials=100):
    w = make_abc(p)
    decs = sample_decompositions(w, p, trials)
    bad = 0
    for (u,v,x,y,z) in decs:
        for i in (0,2):
            s = pump(u,v,x,y,z,i)
            if not counts_ok(s):
                bad += 1
                break
    print(f"w length={len(w)}, trials={len(decs)}, #violations(found quickly)={bad}")

demo_abc()
```

- 기대: 대부분의 샘플 분해에서 \(i=0\) 또는 \(2\)로 펌핑 시 **세 블록 균형이 깨짐**을 관찰.

---

## 6. 코딩 데모 ② — **CFL 펌핑이 ‘성공’하는 예**(\(a^n b^n\))

> \(L=\{a^n b^n\}\)는 CFL. 펌핑 정리는 **“있음(exists) 성질”**이므로,
> 모든 분해가 아니라 **적절한 분해** 하나를 잡으면 펌핑이 유지됨을 볼 수 있다.

```python
# a^n b^n 의 '좋은' 분해: w = a^p b^p, u='', v='a', x='a^{p-1} b^{p-1}', y='b', z=''
# 그 결과 uv^i x y^i z = a^{i + (p-1)} b^{i + (p-1)} ∈ L

def is_anbn(s):
    # 정규식 없이 간단 체크
    i = 0
    while i < len(s) and s[i] == 'a':
        i += 1
    j = i
    while j < len(s) and s[j] == 'b':
        j += 1
    return j == len(s) and i > 0 and (len(s) - i) == i

def demo_anbn(p=8):
    w = 'a'*p + 'b'*p
    u = ''
    v = 'a'
    x = 'a'*(p-1) + 'b'*(p-1)
    y = 'b'
    z = ''
    for i in range(0,5):
        s = u + v*i + x + y*i + z
        print(i, s, is_anbn(s))

demo_anbn()
```

- 출력: 모든 \(i\)에 대해 `True` → 펌핑이 **유지**됨을 확인.

---

## 7. 코딩 데모 ③ — **CYK 파서**로 “펌핑 결과 소속성” 확인 (CFL 대상)

> **목적**: CNF 문법을 가진 간단 CFL(예: \(a^n b^n\))에 대해,
> 펌핑 전/후 문자열의 소속성을 **CYK**로 자동 점검.

```python
# -*- coding: utf-8 -*-
# CNF 기반 CYK 파서 (교육용 미니)
# 문법: S -> A B | ε,   A -> a A | a,   B -> b B | b  를 CNF로 근사 변환해 사용
# 여기서는 직접 CNF 딕셔너리를 준비한다.

from collections import defaultdict

def cyk_parse(w, cnf, start='S'):
    n = len(w)
    if n == 0:
        return (start in cnf.get(('',), [])) or ('ε' in cnf and start in cnf['ε'])
    # T[i][l] = set(nonterminals that derive w[i:i+l])
    T = [[set() for _ in range(n+1)] for _ in range(n)]
    # length 1
    for i,ch in enumerate(w):
        for A in cnf.get((ch,), []):
            T[i][1].add(A)
    # lengths 2..n
    for l in range(2, n+1):
        for i in range(0, n-l+1):
            cell = T[i][l]
            for k in range(1, l):
                lefts = T[i][k]
                rights = T[i+k][l-k]
                if not lefts or not rights:
                    continue
                for B in lefts:
                    for C in rights:
                        for A in cnf.get((B,C), []):
                            cell.add(A)
    return start in T[0][n]

# CNF 예시(rough): S->AB ; A->aA|a ; B->bB|b
# CNF로 변환하면 단말분리: a->X, b->Y 등을 도입해야 하지만
# 교육용으로 (ch,) -> {Nonterms} 와 (B,C)->{A}의 딕셔너리로 직접 제공한다.

cnf_anbn = {
    ('a',): ['A'],
    ('b',): ['B'],
    ('A','A'): ['A'],  # A -> A A (근사: a^+ 를 유도하기 위한 축약)
    ('B','B'): ['B'],  # B -> B B
    ('A','B'): ['S'],  # S -> A B
}
# 이 간이 CNF는 오동작할 수 있으나, a^+ b^+의 골격 판단 정도는 보여준다.

def test_cyk_anbn():
    for n in range(1,6):
        w = 'a'*n + 'b'*n
        print(w, cyk_parse(w, cnf_anbn, start='S'))
    # 펌핑으로 a^{n+1} b^{n+1}도 True, a^{n-1} b^{n-1}도 True

test_cyk_anbn()
```

> 주의: 위 CNF 사전은 **엄밀한 CNF 변환**이 아니다(교육용 휴리스틱).
> 실제 검증엔 **정확한 CNF 변환기**를 쓰거나, 멤버십 함수(예: `is_anbn`)로 확인하자.

---

## 8. 선형 펌핑 감각 데모 — 팔린드롬

> 팔린드롬 \(L=\{w w^R\}\)는 선형. 중심을 기준으로 좌우 대칭 블록 \(v,y\)를 골라 펌핑해도 소속성 유지.

```python
def is_pal(s):
    return s == s[::-1]

def pump_pal_example(m=6, center='c'):
    # w = a^m center a^m (center는 홀수 길이 팔린드롬의 중심 문자)
    w = 'a'*m + center + 'a'*m
    # 분해: u='', v='a', x='a'*(m-1) + center + 'a'*(m-1), y='a', z=''
    u = ''
    v = 'a'
    x = 'a'*(m-1) + center + 'a'*(m-1)
    y = 'a'
    z = ''
    for i in range(0,5):
        s = u + v*i + x + y*i + z
        print(i, s, is_pal(s))

pump_pal_example()
```

- 출력: 모든 \(i\)에서 `True` → 선형 펌핑의 **좌·우 대칭** 감각을 직관화.

---

## 9. 케이스 스터디 — “어떤 언어에 무엇을 쓰나?”

### 9.1 비CFL
- \( \{a^n b^n c^n\} \), \( \{ww\} \), \( \{a^i b^j c^k \mid i=j=k\} \), \( \{a^n b^n a^n\} \) 등.
- **CFL 펌핑** 또는 **오그덴**으로 반증.

### 9.2 CFL이지만 비선형
- **Dyck(균형괄호)**, \( \{a^i b^j a^i b^j\}\) 류 등(대표적 사례로 알려짐).
- **선형 펌핑**으로 반증(또는 PDA 구조 성질로 반증).

### 9.3 선형(⊋정규)
- **팔린드롬** \(\{w w^R\}\), \(\{a^n b^n\}\) 등.
- 선형 문법/펌핑으로 양의 예시 구성 가능.

---

## 10. 실전 체크리스트(요약)

1) **언어의 불변량**을 먼저 잡자(개수 동등, 좌우 대칭, 균형/중첩 등).
2) **긴 문자열 \(w\)** 선택: 보통 구간이 또렷한 블록형.
3) \(|vxy|\le p\) 창으로 **\(v,y\)의 영향권을 제한**.
4) \(i=0,2\)로 펌핑 → 불변량 붕괴를 **정확한 문장**으로 적시.
5) **모든 분해**(또는 모든 중요한 구간 유형)로 경우분석을 **완결**.

---

## 11. 연습문제(스스로 해보기)

1) \(L=\{a^n b^{2n}\mid n\ge 0\}\)는 CFL? 선형?
   - 힌트: 문법/NPDA 구성 가능(선형도 가능). 펌핑으로도 ‘있음’ 성질 확인.
2) \(L=\{a^i b^j c^k \mid i=j \text{ or } j=k\}\)는 CFL?
   - 힌트: CFL의 합집합 닫힘.
3) \(L=\{a^n b^n c^m d^m\}\)는 CFL인가?
   - 힌트: 정규와 교집합으로 \(a^n b^n c^n\)로 축약.

---

## 12. 결론 정리

- **CFL 펌핑 보조 정리**: 좁은 구간에서 **두 조각 동시 펌핑** → 비CFL 반증의 1차 무기.
- **선형 펌핑 보조 정리**: 선형 문법의 척추에서 나오는 **좌·우 대칭 펌핑** → 비선형 반증에 유용.
- 두 정리는 모두 **필요조건**. 막힐 땐 **Ogden/Interchange**로 보강.
- 간단한 **파이썬 실습**으로 감을 잡고, 실제 증명에서는 **모든 분해/모든 경우**를 덮는 논리를 완결할 것.

---

## 부록 A) “증명처럼 쓰는” 미니 템플릿

> 언어 \(L\)이 (비)CFL/(비)선형임을 보이고 싶을 때 복붙해 뼈대를 채워넣자.

```text
가정: L이 CFL(혹은 선형)이라고 하자. 그러면 펌핑 길이 p가 존재한다.
문자열 선택: w = (여기에 긴 문자열; 보통 a^p b^p c^p 류).
분해: 임의의 분해 w=uvxyz (조건 |vy|≥1, |vxy|≤p).
구간분석: v,y가 위치할 수 있는 경우를 (경계 기준) 완전 분류.
펌핑: 각각의 경우에 대해 i=0 (또는 2 등)을 대입하면,
      (언어 불변량)이 깨져 uv^i x y^i z ∉ L.
모순: 모든 경우 모순 ⇒ 가정이 틀림 ⇒ L은 비CFL(또는 비선형).
```

---

## 부록 B) 수학 표기 리마인더

- 펌핑 표기:
  \[
  w = u\;\underbrace{v}_{\text{pump}}\;x\;\underbrace{y}_{\text{pump}}\;z,\quad
  |vxy|\le p,\; |vy|\ge 1,\;
  \forall i\ge 0:\; u v^i x y^i z\in L.
  \]
- 좌우 대칭(선형 감각): 중심(척추)을 기준으로 왼쪽 조각 \(v\), 오른쪽 조각 \(y\)를 같이 늘렸다 줄였다.
