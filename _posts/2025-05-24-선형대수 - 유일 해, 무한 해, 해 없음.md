---
layout: post
title: 선형대수 - 유일 해, 무한 해, 해 없음
date: 2025-05-24 21:20:23 +0900
category: 선형대수
---
# 연립방정식의 해의 종류: 유일 해, 무한 해, 해 없음

연립 1차 방정식의 해는 **유일 해(하나)**, **무한 해(무수히 많음)**, **해 없음(모순)**으로 나뉜다.  
이 구분은 **랭크(rank)**와 **자유변수의 개수**로 정확하게 판정할 수 있다.

---

## 1) 표기와 기본 정의

선형 연립방정식
$$
A\,\vec{x}=\vec{b},
$$
여기서 $$A\in\mathbb{R}^{m\times n}$$, 미지수 $$\vec{x}\in\mathbb{R}^{n}$$, 상수벡터 $$\vec{b}\in\mathbb{R}^{m}$$.

- **확대행렬**: $$[A\mid \vec{b}]$$  
- **랭크**: $$\operatorname{rank}(M)$$는 행/열공간의 차원(선형 독립한 행 혹은 열의 최대 개수)

핵심 정리(랭크 판정식, 흔히 Rouché–Capelli로 알려짐):

- **해가 존재할 필요충분조건**  
  $$
  \operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}]).
  $$
- **해의 카디널리티(개수) 판정**  
  $$
  \begin{cases}
  \text{유일 해} & \text{if } \operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])=n \\
  \text{무한 해} & \text{if } \operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])<n \\
  \text{해 없음} & \text{if } \operatorname{rank}(A)<\operatorname{rank}([A\mid \vec{b}])
  \end{cases}
  $$

---

## 2) 기하학적 직관

- $$m=n=2$$ (평면의 직선 두 개)
  - 유일 해: 서로 다른 기울기의 직선이 한 점에서 만남.
  - 무한 해: 두 직선이 완전히 겹침.
  - 해 없음: 서로 평행하며 다른 위치.
- $$m=n=3$$ (공간의 평면 두/세 개)
  - 유일 해: 두 평면이 한 직선이 아니라 한 점에서 만남(세 평면의 단일 점 교차 등).
  - 무한 해: 한 직선 위로 무수히 많은 해 또는 같은 평면이 겹침.
  - 해 없음: 서로 평행하거나 모순적인 배치로 교차 없음.

일반 차원에서도 **열공간(Column space)**과 $$\vec{b}$$의 상대관계로 동일한 해석이 성립한다.  
$$\vec{b}$$가 $$A$$의 열공간에 있으면(투영될 수 있으면) **해 존재**, 아니면 **해 없음**.

---

## 3) 해의 세 가지 경우

### 3.1 유일 해
조건:
$$
\operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])=n.
$$
모든 변수가 피벗열에 해당(자유변수 0개) → 해 하나.

예:
$$
\begin{cases}
x+y=2\\
x-y=0
\end{cases}
\quad\Rightarrow\quad
\begin{bmatrix}1&1\\1&-1\end{bmatrix}\vec{x}=\begin{bmatrix}2\\0\end{bmatrix}.
$$
역행렬 또는 가우스 소거로 $$x=1,\,y=1$$.

특징: 정방행렬에서 $$\det(A)\neq 0$$이면 항상 유일 해.

---

### 3.2 무한 해
조건:
$$
\operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])<n.
$$
일부 열이 피벗이 아니므로 **자유변수**가 존재 → 해가 무수히 많음.

예:
$$
\begin{cases}
x+y+z=2\\
2x+2y+2z=4
\end{cases}
\quad\Rightarrow\quad
\begin{bmatrix}
1&1&1\mid 2\\
0&0&0\mid 0
\end{bmatrix}
$$
자유변수 $$y, z$$ 를 매개변수로 두고
$$
x=2-y-z.
$$
벡터형으로 쓰면
$$
\vec{x}=\vec{x}_p+\alpha\,\vec{v}_1+\beta\,\vec{v}_2,
$$
여기서 $$\vec{x}_p$$는 특정해(particular), $$\{\vec{v}_i\}$$는 영공간(nullspace) 기저.

---

### 3.3 해 없음(모순)
조건:
$$
\operatorname{rank}(A)<\operatorname{rank}([A\mid \vec{b}]).
$$
RREF에서 $$[0\ 0\ \cdots\ 0\mid c]$$, $$c\neq 0$$ 꼴의 모순행이 나타난다.

예:
$$
\begin{cases}
x+y=2\\
x+y=3
\end{cases}
\quad\Rightarrow\quad
\begin{bmatrix}
1&1\mid 2\\
0&0\mid 1
\end{bmatrix}
$$
$$0=1$$ 모순 → 해 없음.

---

## 4) 랭크와 자유변수: 랭크–널리티의 관점

열의 수가 $$n$$, 랭크가 $$r$$ 이라면 **자유변수 수**는
$$
n-r.
$$
특히 $$A\vec{x}=\vec{0}$$의 해공간(영공간)의 차원(널리티)은
$$
\operatorname{nullity}(A)=n-\operatorname{rank}(A).
$$
무한 해의 경우, $$A\vec{x}=\vec{b}$$의 모든 해는
$$
\vec{x}=\vec{x}_p+\mathcal{N}(A),
$$
즉 특정해에 영공간 전체를 더한 아핀(affine) 부분공간이다.

---

## 5) RREF로 읽는 법(실무 체크리스트)

1. 확대행렬 $$[A\mid \vec{b}]$$를 RREF로 만든다.  
2. 모순행이 있으면 **해 없음**.  
3. 모순행이 없으면 **해 존재**.  
   - 피벗열 개수 $$=n$$ 이면 **유일 해**.  
   - 피벗열 개수 $$<n$$ 이면 **무한 해**(자유변수 존재).  
4. 무한 해인 경우, 자유변수에 매개변수를 두고 해를 파라미터화한다.

---

## 6) 추가 상황별 코멘트

- **과잉결정**(식이 더 많음, $$m>n$$): $$\vec{b}$$가 열공간에 정확히 놓이면 유일 해, 아니면 해 없음(보통 최소제곱으로 근사해 사용).  
- **미지수 과다**(식이 적음, $$m<n$$): 보통 무한 해(추가 제약 없으면 자유변수 다수).  
- **수치해석 관점**: 부동소수점 오차로 랭크 판정은 **허용오차(tol)** 를 둔 SVD/QR 기반이 안전.

---

## 7) PyTorch로 랭크 기반 판정 및 해 구성

아래 코드는 모두 PyTorch(이 사용자는 PyTorch 선호)로 작성한다.  
핵심은
- 랭크 비교로 **유일/무한/없음** 판정,
- **유일 해**면 직접 풀이,
- **무한 해**면 특정해와 영공간 기저를 함께 제시,
- **해 없음**이면 모순 보고.

### 7.1 도우미: 랭크, nullspace, particular 해
```python
import torch

DT = torch.float64

def matrix_rank_torch(M: torch.Tensor, tol: float = 1e-12) -> int:
    # torch.linalg.matrix_rank는 자동 톨러런스가 있지만 통일성을 위해 직접 tol 설정
    U, S, Vh = torch.linalg.svd(M.to(DT), full_matrices=False)
    return int((S > tol).sum().item())

def nullspace_basis(M: torch.Tensor, tol: float = 1e-12):
    # A x = 0의 해공간 기저를 SVD로 계산
    U, S, Vh = torch.linalg.svd(M.to(DT), full_matrices=False)
    mask = S <= tol
    if mask.any():
        # 작은 특이값에 해당하는 Vh의 행(=V^T의 행)들이 nullspace 기저
        # Vh shape: (n, n); nullspace는 Vh[mask]의 전치 열벡터들
        return Vh[mask].T  # shape: (n, nullity)
    else:
        # 널리티 0 → 기저 없음
        n = M.shape[1]
        return torch.zeros((n, 0), dtype=DT)

def particular_solution_if_consistent(A: torch.Tensor, b: torch.Tensor, tol: float = 1e-12):
    # 일단 최소노름해 x_p = A^+ b (pseudoinverse) 를 후보로 삼고,
    # consistency를 확인. consistent면 실제 해다(정확히 만족).
    A = A.to(DT); b = b.to(DT).reshape(-1, 1)
    x_p = torch.linalg.pinv(A, rcond=tol) @ b  # 최소노름 특정해
    resid = torch.norm(A @ x_p - b, p=2).item()
    if resid <= 1e-8:
        return x_p.squeeze(1)  # shape: (n,)
    else:
        return None
```

### 7.2 전체 판정기
```python
def analyze_linear_system(A: torch.Tensor, b: torch.Tensor, tol: float = 1e-12):
    """
    반환:
      - type: 'unique' | 'infinite' | 'inconsistent'
      - x: 유일 해일 때 해벡터 (n,)
      - x_particular: 무한 해일 때 특정해 (n,)
      - nullspace: 무한 해일 때 영공간 기저 (n, k) [k = 자유변수 수]
    """
    A = A.to(DT); b = b.to(DT).reshape(-1, 1)
    m, n = A.shape
    rA = matrix_rank_torch(A, tol)
    Ab = torch.cat([A, b], dim=1)
    rAb = matrix_rank_torch(Ab, tol)

    if rA < rAb:
        return {"type": "inconsistent", "x": None}

    # 해 존재
    if rA == n:
        # 유일 해 (full column rank)
        # 정방이면 torch.linalg.solve, 비정방이면 최소제곱으로도 정확해가 성립(consistent이므로)
        if m == n:
            x = torch.linalg.solve(A, b).squeeze(1)
        else:
            # 과잉결정이지만 정확해 존재: 최소제곱 해가 곧 정확해
            x = torch.linalg.lstsq(A, b).solution.squeeze(1)
        return {"type": "unique", "x": x}

    # 무한 해: rA = rAb < n
    x_p = particular_solution_if_consistent(A, b, tol=tol)
    N = nullspace_basis(A, tol=tol)  # shape: (n, nullity)
    return {"type": "infinite", "x_particular": x_p, "nullspace": N}
```

---

## 8) 예제 시나리오(모두 PyTorch)

### 8.1 유일 해
```python
A = torch.tensor([[2., 1.],
                  [1., -1.]], dtype=DT)
b = torch.tensor([5., 1.], dtype=DT)

info = analyze_linear_system(A, b)
print(info["type"])       # unique
print(info["x"])          # [2., 3.] 같은 형태(값은 시스템에 따라 다름)
```

### 8.2 무한 해(자유변수 존재)
```python
A = torch.tensor([[1., 1., 1.],
                  [2., 2., 2.]], dtype=DT)
b = torch.tensor([2., 4.], dtype=DT)

info = analyze_linear_system(A, b)
print(info["type"])              # infinite
print(info["x_particular"])      # 특정해 (최소노름해)
print(info["nullspace"])         # 영공간 기저: shape (3, k)
# 해의 일반형: x = x_p + nullspace @ t,  (t는 R^k의 매개변수 벡터)
```

예를 들어 nullspace가
$$
\begin{bmatrix}
1\\ -1\\ 0
\end{bmatrix},\ 
\begin{bmatrix}
1\\ 0\\ -1
\end{bmatrix}
$$
로 주어지면
$$
\vec{x}=\vec{x}_p + \alpha
\begin{bmatrix}
1\\ -1\\ 0
\end{bmatrix}
+\beta
\begin{bmatrix}
1\\ 0\\ -1
\end{bmatrix}.
$$

### 8.3 해 없음(모순)
```python
A = torch.tensor([[1., 1.],
                  [1., 1.]], dtype=DT)
b = torch.tensor([2., 3.], dtype=DT)

info = analyze_linear_system(A, b)
print(info["type"])  # inconsistent
```

---

## 9) RREF로 직접 판정하고 해를 구성하는 방법(옵션)

정확한 구조를 보려면 RREF가 직관적이다. 아래는 교육용 간단 RREF.

```python
def rref_torch(A: torch.Tensor, tol: float = 1e-12):
    A = A.clone().to(DT)
    m, n = A.shape
    R = A
    row = 0
    pivot_cols = []
    for col in range(n):
        if row >= m:
            break
        # 부분 피벗팅
        idx = torch.argmax(torch.abs(R[row:, col])) + row
        if torch.abs(R[idx, col]) <= tol:
            continue
        if idx != row:
            R[[row, idx]] = R[[idx, row]]
        # 피벗을 1로
        R[row, :] = R[row, :] / R[row, col]
        # 같은 열의 다른 행 0화
        for r in range(m):
            if r != row:
                R[r, :] -= R[r, col] * R[row, :]
        pivot_cols.append(col)
        row += 1
    R[torch.abs(R) < tol] = 0.0
    return R, pivot_cols
```

확대행렬 $$[A\mid \vec{b}]$$ 에 적용하면:
- 모순행 등장 → **해 없음**  
- 모순행 없음 → 해 존재. 피벗열 개수로 유일/무한을 구분.  
- 자유변수에 매개변수를 두고 해를 구성하면 영공간 기저와 동일 구조가 나온다.

---

## 10) 최소제곱과의 관계(참고)

과잉결정(보통 $$m>n$$)에서 $$\vec{b}$$가 열공간에 없으면 **정확해 없음**.  
이때 **최소제곱해**는
$$
\min_{\vec{x}}\|A\vec{x}-\vec{b}\|_2^2
$$
의 해로, 정규방정식 $$A^\top A\vec{x}=A^\top \vec{b}$$(또는 QR/SVD)로 구한다.  
정확해가 존재하는 경우에는 최소제곱해와 정확해가 일치한다.

---

## 11) 요약표

| 구분 | 판정식 | 결과 | 구조 |
|---|---|---|---|
| 유일 해 | $$\operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])=n$$ | 해 하나 | 자유변수 0개, 모든 변수가 피벗 |
| 무한 해 | $$\operatorname{rank}(A)=\operatorname{rank}([A\mid \vec{b}])<n$$ | 무수히 많음 | 자유변수 존재, $$\vec{x}=\vec{x}_p+\mathcal{N}(A)$$ |
| 해 없음 | $$\operatorname{rank}(A)<\operatorname{rank}([A\mid \vec{b}])$$ | 모순 | RREF에서 $$[0\ \cdots\ 0\mid c\neq 0]$$ |

---

## 12) 연습 문제

1) 다음 시스템의 해 종류를 판정하고, 무한 해라면 일반해를 써라:
$$
\begin{cases}
x+2y+z=1\\
2x+4y+2z=2\\
x+2y=1
\end{cases}
$$

2) 임의의 $$A\in\mathbb{R}^{4\times 3}$$, $$\vec{b}\in\mathbb{R}^4$$를 생성하여 코드를 이용해 세 종류의 예(유일/무한/없음)를 각각 만들고 랭크, 자유변수 수, 해 구조를 출력하라.

3) 과잉결정에서 정확해가 없는 사례를 만들고 최소제곱해와 잔차 노름을 출력하라.

---

## 13) 핵심 정리 문장

- 해의 존재는 **랭크 일치**로, 해의 개수는 **랭크와 변수 수 비교**로 즉시 판정된다.  
- **유일 해**는 자유변수 0개, **무한 해**는 자유변수 ≥1, **해 없음**은 모순행으로 드러난다.  
- 구조적으로 **모든 해 = 특정해 + 영공간** 이라는 사실을 기억하라.