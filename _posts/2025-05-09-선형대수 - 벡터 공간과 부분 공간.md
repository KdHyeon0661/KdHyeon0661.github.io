---
layout: post
title: 선형대수 - 벡터 공간과 부분 공간
date: 2025-05-09 20:20:23 +0900
category: 선형대수
---
# — 정의, 성질, 예시, 증명 스케치, PyTorch 예제

본 글은 벡터 공간과 부분 공간을 **정의 → 공리 → 예시/비예시 → 부분공간 판정법 → 생성/기저/차원 → 열공간·영공간 → 부분공간의 합/교집합/직합 → 직교보완/정사영 → 수치 구현(PyTorch)** 순으로 정리합니다.

---

## 표기(Notation)

- 스칼라: $$a,b,c,\alpha,\beta\in\mathbb{R}$$ (필요 시 $$\mathbb{C}$$)
- 벡터: $$\mathbf{u},\mathbf{v},\mathbf{w}\in\mathbb{R}^n$$ (열벡터)
- 영벡터: $$\mathbf{0}$$, 단위행렬: $$\mathbf{I}$$
- 전치: $$\mathbf{A}^\top$$, 노름: $$\lVert\cdot\rVert\equiv\lVert\cdot\rVert_2$$
- 생성(span): $$\operatorname{span}\{\cdot\}$$

---

## 벡터 공간(Vector Space)

### 정의

집합 $$V$$ 와 두 연산(벡터 덧셈, 스칼라 곱)이 주어졌을 때, $$V$$ 가 다음 8개 공리를 만족하면 $$V$$ 를 체(예: $$\mathbb{R}$$) 위의 **벡터 공간**이라 합니다.

### 8개 공리

모든 $$\mathbf{u},\mathbf{v},\mathbf{w}\in V,\ a,b\in\mathbb{R}$$ 에 대하여
1) 교환법칙
$$
\mathbf{u}+\mathbf{v}=\mathbf{v}+\mathbf{u}.
$$
2) 결합법칙
$$
(\mathbf{u}+\mathbf{v})+\mathbf{w}=\mathbf{u}+(\mathbf{v}+\mathbf{w}).
$$
3) 덧셈 항등원 존재
$$
\exists\,\mathbf{0}\in V:\ \mathbf{v}+\mathbf{0}=\mathbf{v}.
$$
4) 덧셈 역원 존재
$$
\forall \mathbf{v}\ \exists (-\mathbf{v})\in V:\ \mathbf{v}+(-\mathbf{v})=\mathbf{0}.
$$
5) 스칼라 결합법칙
$$
a(b\mathbf{v})=(ab)\mathbf{v}.
$$
6) 스칼라 항등원
$$
1\cdot \mathbf{v}=\mathbf{v}.
$$
7) 벡터에 대한 분배
$$
a(\mathbf{u}+\mathbf{v})=a\mathbf{u}+a\mathbf{v}.
$$
8) 스칼라에 대한 분배
$$
(a+b)\mathbf{v}=a\mathbf{v}+b\mathbf{v}.
$$

### 대표 예시

- $$\mathbb{R}^n$$: 모든 $$n$$-차원 실수 벡터들의 집합
- $$\mathbb{C}^n$$: 복소수 벡터 공간
- $$\mathbb{R}^{m\times n}$$: 모든 $$m\times n$$ 실수 행렬
- $$\mathcal{P}_k$$: 차수 $$\le k$$ 인 실수 다항식들의 집합
- $$\mathbb{R}^\Omega$$: 집합 $$\Omega$$ 위의 실함수(적합한 연산 정의 시 함수공간)

---

## 부분 공간(Subspace)

### 정의

벡터 공간 $$V$$ 의 부분집합 $$W\subseteq V$$ 가 **그 자체로도** 벡터 공간이면 $$W$$ 를 $$V$$ 의 **부분 공간**이라 합니다.

### 부분공간 판정 3요건(충분조건)

부분집합 $$W\subseteq V$$ 가 부분공간이기 위한 간명한 판정:
1) 영벡터 포함
$$
\mathbf{0}\in W.
$$
2) 덧셈에 닫힘
$$
\mathbf{u},\mathbf{v}\in W\Rightarrow \mathbf{u}+\mathbf{v}\in W.
$$
3) 스칼라 곱에 닫힘
$$
\mathbf{v}\in W,\ a\in\mathbb{R}\Rightarrow a\mathbf{v}\in W.
$$

위 3조건이 성립하면 8공리가 자동 상속되어 부분공간입니다.

### 기하적 해석(예: $$\mathbb{R}^3$$)

- 원점을 지나는 직선/평면/전체 공간
- 핵심: **원점을 지나야 함**. 원점에서 어긋난 선/평면은 아핀 집합일 뿐 부분공간이 아닙니다.

---

## 예시와 비예시

### 예시

- $$W=\{(x,0)\in\mathbb{R}^2:x\in\mathbb{R}\}$$: x축(원점 포함, 닫힘)
- $$W=\{(x,y,z)\in\mathbb{R}^3: x+2y-3z=0\}$$: 동차 선형방정식의 해집합(선/평면/공간)
- $$\operatorname{Col}(\mathbf{A})$$: 행렬 $$\mathbf{A}$$ 의 열공간
- $$\mathcal{N}(\mathbf{A})=\{\mathbf{x}:\mathbf{A}\mathbf{x}=\mathbf{0}\}$$: 영공간

### 비예시

- $$\{(x,1):x\in\mathbb{R}\}\subset\mathbb{R}^2$$: 원점 미포함 → 부분공간 아님
- $$\{(x,y): xy=0\}$$: 덧셈에 닫혀 있지 않음 → 부분공간 아님
- $$\{(x,y): x\ge 0\}$$: 스칼라배(음수)에 닫혀 있지 않음 → 부분공간 아님

---

## 생성(span), 선형독립, 기저, 차원

### 생성

벡터들 $$\mathbf{v}_1,\dots,\mathbf{v}_k$$ 의 **생성**:
$$
\operatorname{span}\{\mathbf{v}_1,\dots,\mathbf{v}_k\}
=
\left\{\sum_{i=1}^k \alpha_i \mathbf{v}_i:\ \alpha_i\in\mathbb{R}\right\}.
$$
이는 $$V$$ 의 부분공간입니다.

### 선형독립

$$
\sum_{i=1}^k \alpha_i\mathbf{v}_i=\mathbf{0}
\ \Rightarrow\
\alpha_1=\cdots=\alpha_k=0
$$
이면 독립. 아니면 종속.

### 기저와 차원

- **기저**: 독립이면서 공간을 생성하는 벡터 집합
- **차원**: 기저 벡터의 개수(동일 공간에서 기저의 크기는 항상 같음)

---

## 행렬과 연립방정식: 열공간·영공간·랭크

### 열공간/행공간/영공간

- $$\operatorname{Col}(\mathbf{A})=\{\mathbf{A}\mathbf{x}:\mathbf{x}\in\mathbb{R}^n\}$$
- $$\operatorname{Row}(\mathbf{A})=\operatorname{Col}(\mathbf{A}^\top)$$
- $$\mathcal{N}(\mathbf{A})=\{\mathbf{x}:\mathbf{A}\mathbf{x}=\mathbf{0}\}$$

### 랭크–널리티 정리

$$
\operatorname{rank}(\mathbf{A})+\operatorname{nullity}(\mathbf{A})=n.
$$
여기서 $$n$$ 은 열의 수. 즉, 열공간 차원 + 영공간 차원 = 전체 변수 수.

---

## 부분공간의 연산: 합, 교집합, 직합

### 합과 교집합

부분공간 $$U,W\subseteq V$$ 에 대해
- 합: $$U+W=\{\mathbf{u}+\mathbf{w}:\mathbf{u}\in U,\mathbf{w}\in W\}$$ (부분공간)
- 교집합: $$U\cap W$$ (부분공간)

### 차원 공식

$$
\dim(U+W)=\dim U+\dim W-\dim(U\cap W).
$$

### 직합(직접합)

$$
U\cap W=\{\mathbf{0}\}
\ \Rightarrow\
V=U\oplus W\ \text{라 쓰며}\ \mathbf{v}\in V\ \text{를 유일하게}\ \mathbf{u}+\mathbf{w}\ \text{로 분해}.
$$

---

## 직교보완과 정사영

### 직교보완

내적공간 $$\mathbb{R}^n$$ 에서 부분공간 $$W$$ 의 직교보완:
$$
W^\perp=\{\mathbf{v}:\ \forall \mathbf{w}\in W,\ \mathbf{v}^\top \mathbf{w}=0\}.
$$
항상 $$\mathbb{R}^n=W\oplus W^\perp$$ 가 성립합니다.

### 정사영(직교투영)

열이 기저인 행렬 $$\mathbf{Q}$$ 가 **정규직교**라면 투영 행렬은
$$
\mathbf{P}=\mathbf{Q}\mathbf{Q}^\top,\quad \mathbf{P}^2=\mathbf{P},\ \mathbf{P}^\top=\mathbf{P}.
$$
임의의 $$\mathbf{A}$$ 에 대해 SVD 또는 QR 로 $$\operatorname{Col}(\mathbf{A})$$ 의 직교기저를 얻어 투영을 계산합니다.

---

## 부분공간 판정/계산 — PyTorch 구현

아래 코드는 독립 실행 가능하며, 수치 안정성을 위해 SVD 를 사용합니다.

```python
import torch
torch.set_printoptions(precision=5, sci_mode=False)

def nullspace(A, tol=1e-10):
    # A: (m, n)
    U, S, Vh = torch.linalg.svd(A, full_matrices=False)
    # 작은 특이값의 인덱스
    mask = S <= tol * S.max()
    if not torch.any(mask):
        return torch.empty(A.size(1), 0, dtype=A.dtype)  # nullity = 0
    Ns = Vh[mask, :].T  # (n, k)
    return Ns

def orthonormal_basis_from_A(A, tol=1e-10):
    # Col(A)의 직교기저 Q (SVD)
    U, S, Vh = torch.linalg.svd(A, full_matrices=False)
    r = int((S > tol * S.max()).sum().item())
    return U[:, :r]  # (m, r), orthonormal columns

def projector_onto_col(A, tol=1e-10):
    # P = Q Q^T
    Q = orthonormal_basis_from_A(A, tol=tol)
    if Q.numel() == 0:
        return torch.zeros(A.size(0), A.size(0), dtype=A.dtype)
    return Q @ Q.T

def in_span(A, x, tol=1e-8):
    # x가 Col(A) 안에 있는지: ||(I - P) x|| <= tol
    m = A.size(0)
    P = projector_onto_col(A)
    resid = torch.linalg.norm((torch.eye(m) - P) @ x)
    return bool(resid <= tol), resid.item()
```

### 부분공간 예/비예시 검증

```python
# 예시: x축 W = {(x,0)} in R^2

W_generators = torch.tensor([[1., 0.]]).T    # (2,1)
x1 = torch.tensor([3., 0.])                  # in W
x2 = torch.tensor([3., 1.])                  # not in W

print("x1 in W? ", in_span(W_generators, x1))
print("x2 in W? ", in_span(W_generators, x2))

# 비예시: y=1 직선 (원점 미포함 → 부분공간 아님)
# "부분공간 여부"는 생성자 관점으론 애초에 span으로 표현 불가(상수항 필요).

```

### 계산

```python
# x + 2y - 3z = 0 의 해공간 (R^3의 부분공간)

A = torch.tensor([[1., 2., -3.]])  # (1,3)
N = nullspace(A)
print("Null(A) 기저(열벡터):\n", N)
# 임의 벡터는 N @ c 로 표현 가능

c = torch.tensor([1., -1.]) if N.numel() else torch.tensor([])
v = N @ c if N.numel() else torch.zeros(3)
print("임의 해 벡터 v:", v, " A v =", A @ v)
```

### 열공간 기저·투영

```python
# 의 직교기저와 투영행렬

A = torch.tensor([[1., 2.],
                  [2., 4.],
                  [0., 1.]], dtype=torch.float64)  # 열 종속

Q = orthonormal_basis_from_A(A)   # (3, r)
P = projector_onto_col(A)
x = torch.tensor([1., 0., 1.], dtype=torch.float64)

proj_x = P @ x
resid = x - proj_x
print("rank =", Q.size(1))
print("투영 P x =", proj_x)
print("잔차 ⟂ Col(A)?", float(Q.T @ resid).__abs__() < 1e-9)
```

### 부분공간의 합과 교집합(수치)

- 합: $$U+W=\operatorname{span}\{U\text{의 기저}, W\text{의 기저}\}$$
- 교집합: $$\mathbf{U}\mathbf{a}=\mathbf{W}\mathbf{b} \iff [\mathbf{U}\;-\mathbf{W}]\begin{bmatrix}\mathbf{a}\\ \mathbf{b}\end{bmatrix}=\mathbf{0}$$
  해를 구해 $$\mathbf{x}=\mathbf{U}\mathbf{a}$$ 를 얻으면 $$U\cap W$$ 의 원소.

```python
def span_union_basis(U, W, tol=1e-10):
    # U: (n, rU), W: (n, rW) — 기저(열)들을 이어붙인 뒤 SVD로 직교기저
    A = torch.cat([U, W], dim=1)
    return orthonormal_basis_from_A(A, tol=tol)  # (n, r)

def span_intersection_basis(U, W, tol=1e-10):
    # [U | -W] [a;b] = 0 → a,b를 구해 x = U a
    n = U.size(0)
    UW = torch.cat([U, -W], dim=1)          # (n, rU + rW)
    Ns = nullspace(UW, tol=tol)             # (rU+rW, k)
    if Ns.numel() == 0:
        return torch.empty(n, 0, dtype=U.dtype)
    rU = U.size(1)
    Acoef = Ns[:rU, :]                      # a 계수들
    X = U @ Acoef                           # 교집합의 생성자들
    return orthonormal_basis_from_A(X, tol=tol)

# 예시

U = orthonormal_basis_from_A(torch.tensor([[1.,0.],[0.,1.],[0.,0.]]))  # xy-평면
W = orthonormal_basis_from_A(torch.tensor([[1.,0.],[0.,0.],[0.,1.]]))  # xz-평면

UplusW = span_union_basis(U, W)
UcapW  = span_intersection_basis(U, W)
print("dim(U) =", U.size(1), " dim(W) =", W.size(1))
print("dim(U+W) =", UplusW.size(1), " dim(U∩W) =", UcapW.size(1))
# 차원 공식 확인: 2+2 = dim(U+W)+dim(U∩W)

```

---

## 증명 스케치

### 부분공간 판정 3요건의 충분성

가정: $$W\subseteq V$$ 가 (i) 영벡터 포함, (ii) 덧셈 닫힘, (iii) 스칼라배 닫힘을 만족.
결론: $$W$$ 는 8공리를 만족한다.
스케치: 공리 1–2는 상위 공간 $$V$$ 의 연산을 그대로 제한했을 때 닫힘으로 보장. 3–4는 (i)와 (iii)로부터 역원 존재가 따라옴(스칼라 $$-1$$ 배). 5–8은 스칼라연산과 분배성 등이 $$V$$ 에서 성립하므로 $$W$$ 에서도 성립.

### 동차 선형방정식 해집합은 부분공간

$$
\mathcal{N}(\mathbf{A})=\{\mathbf{x}:\mathbf{A}\mathbf{x}=\mathbf{0}\}.
$$
명백히 $$\mathbf{0}\in \mathcal{N}(\mathbf{A})$$. 두 해의 합과 스칼라배도 선형성으로 다시 해가 되므로 닫힘.

### 차원 공식

선형사상 $$T:U\oplus W\to U+W$$ 를 $$T(\mathbf{u},\mathbf{w})=\mathbf{u}+\mathbf{w}$$ 로 두고, 순서쌍 공간의 차원과 핵/상 공간의 차원을 비교하면
$$
\dim(U+W)=\dim U+\dim W-\dim(U\cap W).
$$

---

## 실전 체크리스트(모델링/구현)

- 부분공간 여부: 원점 포함 여부, 선형결합 닫힘인지 즉시 확인
- **해집합**: 동차식이면 부분공간, 비동차식이면 아핀집합(원점 미포함)
- 차원/기저: QR/SVD 로 수치적으로 견고하게 추출
- 열공간/영공간: 랭크–널리티로 차원 확인
- 합/교집합: 생성자 결합 → SVD 로 기저·차원 계산
- 직교투영: 직교기저 $$\mathbf{Q}$$ 확보 후 $$\mathbf{P}=\mathbf{Q}\mathbf{Q}^\top$$

---

## 추가 예시(다항식/함수)

### 다항식 공간

$$
\mathcal{P}_2=\{a_0+a_1x+a_2x^2:\ a_i\in\mathbb{R}\}
$$
은 차원 3의 벡터공간.
부분공간 예: $$\{p\in\mathcal{P}_2:\ p(0)=0\}=\{a_1x+a_2x^2\}$$ (영벡터 포함, 닫힘).
비예시: $$\{p\in\mathcal{P}_2:\ p(0)=1\}$$ (영벡터 불포함).

### 함수 공간

적분가능 함수공간에서 $$W=\{f: \int f=0\}$$ 는 부분공간(선형성).
$$W=\{f: \int f=1\}$$ 는 아핀집합.

---

## 연습문제(힌트 포함)

1) $$W=\{(x,y,z)\in\mathbb{R}^3: x+2y-3z=0\}$$ 가 부분공간임을 판정 3요건으로 보이시오.
힌트: 영벡터 대입, 합·스칼라배 후 선형성 이용.

2) $$\mathbb{R}^3$$ 에서
$$
U=\operatorname{span}\{(1,0,0)^\top,(0,1,0)^\top\},\
W=\operatorname{span}\{(1,0,0)^\top,(0,0,1)^\top\}
$$
에 대해 $$\dim(U+W),\ \dim(U\cap W)$$ 를 구하시오.
힌트: 차원 공식.

3) 행렬 $$\mathbf{A}\in\mathbb{R}^{m\times n}$$ 에 대하여 $$\operatorname{Row}(\mathbf{A})=(\mathcal{N}(\mathbf{A}))^\perp$$ 임을 보이시오.
힌트: 내적이 0인 조건을 양변 전치로 옮겨 표현.

4) $$\mathbf{A}$$ 의 열공간으로의 정사영 행렬 $$\mathbf{P}$$ 가 대칭이고 아이델포턴트($$\mathbf{P}^2=\mathbf{P}$$)임을 보이시오.
힌트: 정규직교 기저 $$\mathbf{Q}$$ 에 대해 $$\mathbf{P}=\mathbf{Q}\mathbf{Q}^\top$$.

5) $$\mathcal{P}_2$$ 에서 $$W=\{p: p'(0)=0\}$$ 의 차원을 구하고 기저를 제시하시오.
힌트: 일반형에 미분 조건 대입.

---

## 요약

- 벡터 공간은 8공리를 만족하는 연산 구조, 부분공간은 그 구조를 상속받는 **원점 중심의 닫힌** 부분집합입니다.
- 해집합이 동차면 부분공간, 비동차면 아핀집합입니다.
- 열공간/영공간/랭크–널리티, 합·교집합·직합, 직교보완/정사영은 벡터공간 이론의 실무 핵심입니다.
- 구현은 SVD/QR 로 기저·차원·투영을 수치적으로 안정히 구합니다.
