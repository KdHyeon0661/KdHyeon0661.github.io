---
layout: post
title: 형식언어와 오토마타 - 유한 상태 변환기의 일반적 구조
date: 2025-08-15 16:20:23 +0900
category: 형식언어와 오토마타
---
# 유한 상태 변환기(Finite-State Transducer, FST)의 **일반적 구조** — 정의·변형·구성요소·연산·검증·확장

유한 상태 변환기(FST)는 **입력 문자열을 출력 문자열로 바꾸는** 유한상태 장치입니다.  
정규언어를 인식하는 DFA/NFA가 “입력 ∈/∉ 언어?”만 판단하는 데 비해, FST는 **문자열→문자열** 변환(관계)을 기술합니다.  
아래에서는 **형식적 정의 → 결정/비결정 변형 → ε 처리 → 합성/역/폐포 → 최소화/정정성 검사 → 가중 확장**까지, “일반 구조”를 체계적으로 정리합니다. 수식은 MathJax, 예시는 코드블록(```)로 표기합니다.

---

## 1) 기본 정의: FST가 다루는 대상

FST가 구현하는 대상은 **이항 관계** \(R \subseteq \Sigma^* \times \Gamma^*\) 입니다.  
입력 알파벳 \(\Sigma\), 출력 알파벳 \(\Gamma\) 에 대해, 하나의 입력 \(x\)가 **여러 출력**과 짝지을 수도 있고(관계), **딱 하나의 출력**이 정해질 수도 있습니다(함수).

- **정규 관계(rational relation)**: **유한 상태** 재기록으로 표현 가능한 관계.
- **정규 함수(regular function)**: 정규 관계 중 **함수**인 것(입력마다 출력이 최대 한 개).

---

## 2) 전형적 모델들

### 2.1 Mealy형(전이에서 출력)
\[
T=(Q,\Sigma,\Gamma,\delta,\lambda,q_0,F)
\]
- \(Q\): 상태, \(q_0\): 시작, \(F\subseteq Q\): (선택적) 수용 상태  
- \(\delta:Q\times \Sigma_{\varepsilon}\to 2^Q\): 전이 (입력 \(\varepsilon\) 포함 가능)  
- \(\lambda:Q\times \Sigma_{\varepsilon}\to \Gamma_{\varepsilon}^*\): 전이 출력(문자열 가능)

> 한 전이에서 **입력 1기호(또는 ε)를 소비**하고 **출력 문자열(또는 ε)** 을 방출합니다.

### 2.2 Moore형(상태에서 출력)
\[
T=(Q,\Sigma,\Gamma,\delta,\rho,q_0,F)
\]
- \(\rho:Q\to \Gamma^*\) 가 상태 출력. 전이 때가 아니라 **도착 상태** 또는 “상태 방문” 시 출력을 붙입니다.  
- 순수 Moore는 입력을 읽기 전 **초기 출력**을 가질 수 있습니다.

### 2.3 **(후속)순차 변환기**(subsequential/DFT)
실전과 이론에서 많이 쓰는, **결정적** Mealy형에 “**최종 출력 함수** \(\tau: F\to \Gamma^*\)”를 더한 모델:
\[
T=(Q,\Sigma,\Gamma,\delta,\lambda,q_0,F,\tau).
\]
- 입력을 모두 소진해 \(p\in F\)에 도달하면 **마무리 출력 \(\tau(p)\)** 를 덧붙입니다.
- 이들이 구현하는 함수류를 **(후속)순차 함수**라고 부릅니다.

---

## 3) 비결정 FST와 ε-전이/ε-출력

### 3.1 비결정성
\(\delta\) 가 다가값이면 **여러 경로**가 가능하며, 하나의 입력에 **여러 출력**이 나올 수 있습니다(관계).  
**함수성(functionality)** 이 필요한 경우 “같은 입력에 두 개의 상이한 출력이 생기는 경로가 없는가?”를 따로 검사합니다(§8).

### 3.2 ε의 네 가지 케이스
- **입력 ε, 출력 기호**: 입력을 소비하지 않고 출력만 방출(삽입).
- **입력 기호, 출력 ε**: 입력만 소비(삭제).
- **ε→ε**: 아무것도 하지 않는 전이. **순환**(loop)이 있으면 무한 출력 생성 위험 → 일반적으로 금지하거나 정규화 필요.
- **실무**: 합성/결정화에서 **ε-필터**(전용 오토마타)로 **순서/소거 규칙**을 강제합니다.

---

## 4) 실행 의미(런)과 경로 출력

입력 \(x=x_1\dots x_n\)에 대한 **런(run)** 은
\[
q_0 \xrightarrow{x_1/u_1} q_1 \xrightarrow{x_2/u_2} \cdots \xrightarrow{x_n/u_n} q_n
\]
형태의 전이열(ε-전이가 있으면 그 사이에 섞임)이며, 총 출력은 \(u_1u_2\cdots u_n\) (중간 ε 전이 출력 포함).  
수용 조건(보통 \(q_n\in F\))을 만족하면 \((x, u_1\cdots u_n \tau(q_n))\in R(T)\).

---

## 5) 예: 패턴 치환 “`ab` → `X`” (나머지는 복사)

```text
상태: q0(기본), qA('a' 직후)
전이 (입력 / 출력):
q0 -- a/ε --> qA              # 'a'를 소비만 (보류)
q0 -- b/b --> q0              # 평범 복사
q0 -- 기타 c/c --> q0

qA -- b/X --> q0              # 'ab'를 'X'로 치환
qA -- a/ a --> qA             # 'aa'면 앞의 a를 확정 출력, 새 'a' 보류
qA -- 기타 c/ a c --> q0      # 'a' 다음에 b 외 기호가 오면 'a'를 방출 후 c 복사
# 종료 시: qA에 남아 있으면 τ(qA) = 'a' 방출
```

- 이 장치는 **지연 출력(delay)** 을 이용해 ‘앞글자 `a`가 진짜 치환될지’를 보고 결정합니다.  
- **후속 출력 \(\tau\)** 가 없으면 입력 끝에서 `a`가 **유실**될 수 있으므로 subsequential 모델에서 \(\tau(qA)=\text{"a"}\)가 필수.

---

## 6) 구조적 속성: 결정성·함수성·지연·정규함수

- **결정적(sequential)**: 각 상태·입력 기호(ε 포함 여부에 따라 다름)에 대해 전이가 **최대 한 개**.  
- **함수성(functionality)**: 모든 입력 \(x\)에 대해 출력이 **최대 1개**. (결정적이면 자동 만족)  
- **지연(delay)**: 같은 접두 입력에 대해 경로 간 만들어진 출력의 **길이 차**.  
  - 지연이 **유계**이면(특히 **twinning property**) 비결정 FST도 **결정화(순차화)** 가능.
- **정규 함수(regular function)**: **FST로 실현 가능한 함수**.  
  - 모든 정규 함수는 **양방향 DFA 두 개**로 이루어진 **bimachine**으로도 표현 가능.

---

## 7) 연산(알고리즘) — 합성·역·합집합·스타

### 7.1 합성(composition)
\(T_1:\Sigma\to\Delta,\ T_2:\Delta\to\Gamma\) 이면 \(T_2\circ T_1:\Sigma\to\Gamma\).
- **구성**: 상태는 곱 \(Q_1\times Q_2\);  
  \(T_1\)의 출력 라벨과 \(T_2\)의 입력 라벨을 **일치**시키며 진행.  
- **ε-정렬**: 출력 ε vs 입력 ε의 순서를 통제하는 **ε-필터** FSA를 중간에 곱해 **유일 경로**를 보장.

### 7.2 역(inversion)
라벨을 **스왑**(입력↔출력)하면 관계의 **역 \(R^{-1}\)** 를 얻습니다.  
함수였던 것이 일반적으로 **함수 아님**(여러 입력이 같은 출력을 낼 수 있기 때문).

### 7.3 폐포(닫힘)
- **정규 관계**(일반 FST)는 합집합/연접/Kleene★/합성/역 등에 닫혀 있습니다.  
- **정규 함수**는 합성/부분적 병합 등에 잘 닫히나, 역연산에서 함수성이 깨질 수 있습니다.

---

## 8) 정정성(올바름) 검사: **함수성·동치성·포용**

### 8.1 함수성(functionality) 판정
아이디어: \(T\)와 자기 자신을 **동시에** 달리 수행해 동일 입력에 대해 **상이한 출력**이 생성되는지 확인.
- **제품 기계(square)** 를 만들고, 두 경로의 출력 차이가 **0이 아닌 지연**으로 귀결되는지 탐색.
- 존재하면 **비함수**; 없으면 **함수**.

### 8.2 동치성/포함성
결정적·함수인 FST(순차 함수) 사이에서는 **정규언어**에서의 Myhill–Nerode류 합리성이 일반화됨.
- **출력 푸시(output pushing)** 로 **정규형**을 만든 뒤 상태 동치로 비교(§9).

---

## 9) **결정화·최소화**(순차 함수의 경우)

### 9.1 결정화(determinization)
- 모든 비결정 FST가 결정화되는 것은 **아님**.  
- **지연 유계(= twinning property)** 를 만족하는 **함수 관계**는 **subsequential** 로 결정화 가능.

### 9.2 최소화(minimization)
- 결정화 후 **출력 푸시**(공통 접두 출력은 앞쪽으로, 접미는 뒤쪽으로 이동)로 **정규형**을 만든 다음,
- DFA 최소화와 유사한 **우언어 동치**(right congruence)에 근거해 상태를 병합 → **최소 순차 변환기**.  
- (가중의 경우는 **가중 푸시(weight pushing)** 를 먼저 수행)

---

## 10) 가중 유한 상태 변환기(WFST) — 일반 구조의 확장

가중치(점수/비용/확률)를 도입한 **WFST**는 다음과 같습니다.
- **호/전이**: \((p, a:b, w, q)\) — 상태 \(p\)에서 \(a\)를 소비하고 \(b\)를 출력, 가중치 \(w\)를 더해 \(q\)로.
- **반가환 반환대(semiring)** \((\oplus,\otimes)\):  
  - 경로 선택은 \(\oplus\) (예: 최소/합), 경로 연결은 \(\otimes\) (예: 덧셈/곱셈).
  - 예: **tropical**(최소, 덧셈), **log**(log-확률 합), **boolean**(OR, AND).
- **경로 가중치**: 전이 가중치를 \(\otimes\) 로 누적, 대안 경로는 \(\oplus\) 로 병합.
- **연산**: 합성, 결정화(조건부; twins property), 최소화, **N-최단경로**, **Viterbi** 등이 정의됨.

> **응용**: 음성 인식(발음사전·언어모델 결합), 형태론/형태소 분석, 텍스트 정규화, 토큰화·교정 파이프라인 등.

---

## 11) 구현 관점: 자료구조와 실행기

- **상태/전이 테이블**(배열/해시), **라벨→전이 인덱스** 인덱싱이 핵심.
- **런타임**: 입력 스트림을 한 글자씩 읽어, 일치 전이 선택 → 출력 버퍼에 라벨을 **이어붙임** → 상태 이동.
- **합성**: BFS/큐 기반으로 \((q_1,q_2)\) 제품 상태를 확장, ε-필터 상태를 함께 곱해 정규화.

```text
# FST 실행(순차)의사코드
out := ""
q := q0
for x in input:
  (q', u) := δ/λ(q, x)          # 전이와 출력
  out := out + u
  q := q'
if q ∈ F: out := out + τ(q)
return out
```

---

## 12) 작은 연습: “자음은 그대로, 모음 a→e”

```text
Σ = Γ = {a,b,c,d,e}
상태: q0
전이:
q0 -- a/e --> q0
q0 -- e/e --> q0
q0 -- b/b --> q0
q0 -- c/c --> q0
q0 -- d/d --> q0
```

- 단 하나의 상태로 충분(단순 치환).  
- **문맥 의존** 변환(예: `qu` 다음의 `e`는 보존 등)이면 **상태를 추가**해 “최근 맥락”을 기억시킵니다.

---

## 13) 체크리스트 — FST 설계/검증/최적화

1) **모델 선택**: Mealy vs Moore vs subsequential(최종 출력 필요 여부).  
2) **ε 규율**: 입력/출력 ε 사용을 최소화, 필요 시 **ε-필터** 설계.  
3) **함수성**: 필요한가? 필요하면 **square 검사**로 확인.  
4) **결정화**: 지연 유계인지(혹은 twinning property) 점검.  
5) **최소화**: 출력 푸시 → 상태 병합.  
6) **합성 계획**: 여러 변환을 작게 쪼개고 **합성**으로 연결(모듈화).  
7) **가중 사용**: 점수/확률이 필요하면 **semiring** 을 선택(열림/폐포 고려).

---

## 14) 한 페이지 요약

- **FST**는 **유한 상태**로 **문자열→문자열** 관계를 구현한다.  
- **Mealy/Moore**, **subsequential(최종 출력)**, **비결정/ε** 등 변형이 있다.  
- 정규 관계는 **합성/역/합집합/스타** 등에 닫힘.  
- **함수성 검사**, **결정화(가능 시)**, **최소화**로 작고 빠른 실현이 가능.  
- **WFST**는 가중치를 더해 검색/최단경로/베스트 경로 추정까지 포괄한다.