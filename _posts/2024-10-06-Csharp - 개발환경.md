---
layout: post
title: C# - 개발환경
date: 2024-10-06 19:20:23 +0900
category: Csharp
---
# C# 개발 환경 설정 (VS Code 기준)

## 0. 개요 — 무엇을 설치하고 어떻게 쓸 것인가

- **필수**: .NET SDK, VS Code, C# 확장
- **선택**: C# Dev Kit(프로젝트 뷰/테스트/솔루션 편의), Docker(컨테이너 개발), Dev Containers, WSL(Windows에서 리눅스 개발)
- **권장 흐름**: SDK 설치 → VS Code + C# 확장 → `dotnet new`로 프로젝트 생성 → `launch.json`/`tasks.json`으로 디버깅/빌드 → NuGet 도입 → 테스트/포맷팅 → 컨테이너/WSL/CI 확장

---

## 1. .NET SDK 설치

### 1.1 공식 다운로드

- 링크: https://dotnet.microsoft.com/en-us/download
  운영체제(OS)에 맞는 **.NET SDK**(런타임이 아니라 SDK)를 설치합니다.

### 1.2 설치 확인

```bash
dotnet --info
dotnet --version
```

- 버전 문자열(예: `9.0.100`)이 출력되면 정상.
- `--info`는 설치된 SDK/런타임, RID, 경로 등을 보여줍니다.

### 1.3 흔한 이슈와 해결

- **명령을 찾을 수 없음**: PATH에 SDK 경로가 누락.
  - Windows: `C:\Program Files\dotnet\` 가 PATH에 있어야 합니다.
  - macOS: `/usr/local/share/dotnet/` 심볼릭 링크 또는 `~/.zprofile`/`~/.zshrc`에 PATH 추가.
  - Linux: 배포판 패키지로 설치했다면 `/usr/share/dotnet` 등 기본 경로 확인.
- **여러 버전 공존**: `global.json`으로 프로젝트별 고정.

```json
{
  "sdk": {
    "version": "9.0.100",
    "rollForward": "latestFeature"
  }
}
```

---

## 2. Visual Studio Code 설치

### 2.1 다운로드 및 설치

- 링크: https://code.visualstudio.com/
- 설치 후 `code` 명령 사용을 위해:
  - macOS: VS Code → Command Palette(⇧⌘P) → “Shell Command: Install 'code' command in PATH”
  - Windows: 기본 설치 시 자동 등록
  - Linux: 배포판 스토어 또는 `.deb/.rpm` 설치

### 2.2 필수/권장 확장

1) **C# (Microsoft)**
   - 핵심 언어 지원(IntelliSense, 디버깅, 리팩토링)

2) **C# Dev Kit (Microsoft, 선택)**
   - 솔루션/프로젝트 탐색, 테스트 관리, 코드 탐색 향상

3) **.NET Test Explorer (선택)** 또는 C# Dev Kit의 테스트 뷰
4) **EditorConfig for VS Code** (코딩 규칙 일관)
5) **GitLens** (이력·블레임·리뷰 편의)
6) **Docker** (컨테이너 개발 시)

> 확장은 VS Code 좌측 Extensions 탭에서 검색/설치합니다.

---

## 3. 첫 C# 프로젝트 생성

### 3.1 콘솔 앱 템플릿

```bash
mkdir HelloCSharp && cd HelloCSharp
dotnet new console
code .
```

- `Program.cs`, `HelloCSharp.csproj`가 생성됩니다.
- VS Code가 열리면 C# 확장이 자동으로 프로젝트를 로드합니다.

### 3.2 Program.cs (예제)

```csharp
using System;

class Program
{
    static void Main()
    {
        Console.WriteLine("Hello from VS Code!");
    }
}
```

### 3.3 실행

```bash
dotnet run
```

- 출력: `Hello from VS Code!`

---

## 4. 디버깅 설정 — launch.json과 기본 사용

VS Code 상단 메뉴 → **Run > Add Configuration** → `.vscode/launch.json` 자동 생성.
일반적인 .NET 콘솔 앱의 기본 예시는 아래와 유사합니다.

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": ".NET Launch (console)",
      "type": "coreclr",
      "request": "launch",
      "program": "${workspaceFolder}/bin/Debug/net9.0/HelloCSharp.dll",
      "args": [],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal",
      "stopAtEntry": false,
      "justMyCode": true,
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  ]
}
```

- **브레이크포인트**: 코드 좌측 여백 클릭
- **Watch/Locals/Call Stack**: 디버그 패널에서 확인
- **조건부 브레이크포인트**: Breakpoint에서 조건(예: `i == 100`) 추가
- **환경변수/작업 디렉터리**: `env`, `cwd`로 제어

---

## 5. 빌드·테스트 자동화 — tasks.json

VS Code의 **Tasks**로 빌드·테스트를 키 바인딩 또는 명령 팔레트에서 손쉽게 실행합니다.

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "dotnet build",
      "command": "dotnet",
      "type": "process",
      "args": [ "build", "${workspaceFolder}" ],
      "problemMatcher": "$msCompile",
      "group": "build"
    },
    {
      "label": "dotnet test",
      "command": "dotnet",
      "type": "process",
      "args": [ "test", "${workspaceFolder}" ],
      "problemMatcher": "$msCompile",
      "group": "test"
    }
  ]
}
```

- **Run Task**(`Ctrl+Shift+B` 또는 명령 팔레트)로 빌드 실행
- `dotnet test`를 자주 쓴다면 키 바인딩으로 연결

---

## 6. 프로젝트 구조 확장 — 솔루션/클래스 라이브러리/테스트

### 6.1 솔루션 및 다중 프로젝트

```bash
mkdir VscodeCsharpDemo && cd VscodeCsharpDemo
dotnet new sln -n VscodeCsharpDemo

dotnet new classlib -n Demo.Core
dotnet new console -n Demo.Cli
dotnet new xunit -n Demo.Tests

dotnet sln add Demo.Core/Demo.Core.csproj Demo.Cli/Demo.Cli.csproj Demo.Tests/Demo.Tests.csproj
dotnet add Demo.Cli/Demo.Cli.csproj reference Demo.Core/Demo.Core.csproj
dotnet add Demo.Tests/Demo.Tests.csproj reference Demo.Core/Demo.Core.csproj
code .
```

### 6.2 Core 라이브러리 예시

```csharp
// Demo.Core/StringTools.cs
namespace Demo.Core;

public static class StringTools
{
    public static string Reverse(string s)
        => new string(s.Reverse().ToArray());
}
```

### 6.3 CLI에서 라이브러리 사용

```csharp
// Demo.Cli/Program.cs
using Demo.Core;

Console.WriteLine(StringTools.Reverse("Hello VS Code"));
```

### 6.4 xUnit 테스트

```csharp
// Demo.Tests/StringToolsTests.cs
using Demo.Core;
using Xunit;

public class StringToolsTests
{
    [Fact]
    public void Reverse_Works()
    {
        var r = StringTools.Reverse("abc");
        Assert.Equal("cba", r);
    }
}
```

```bash
dotnet test
```

---

## 7. NuGet 패키지 추가 — 예: Newtonsoft.Json

```bash
dotnet add Demo.Cli/Demo.Cli.csproj package Newtonsoft.Json
```

```csharp
// Demo.Cli/Program.cs
using Newtonsoft.Json;
using Demo.Core;

var obj = new { Msg = "Hello", Time = DateTimeOffset.UtcNow };
string json = JsonConvert.SerializeObject(obj);
Console.WriteLine(json);
Console.WriteLine(StringTools.Reverse("Package"));
```

- **패키지 버전 고정**: `dotnet add package Newtonsoft.Json --version 13.*`
- **사설 피드** 사용 시 `NuGet.Config`로 소스 등록

---

## 8. 코드 스타일·분석 — .editorconfig / Analyzers / 포맷팅

### 8.1 .editorconfig (예시)

```ini
root = true

[*.cs]
charset = utf-8-bom
indent_style = space
indent_size = 4
end_of_line = lf

# C# 규칙
dotnet_diagnostic.IDE0055.severity = warning  # Formatting
dotnet_diagnostic.CA1062.severity = warning   # Null 체크
dotnet_style_qualification_for_field = false:suggestion
csharp_prefer_braces = when_multiline:suggestion
csharp_style_namespace_declarations = file_scoped:suggestion
```

### 8.2 포맷팅/정적분석

```bash
dotnet tool install --global dotnet-format
dotnet format
```

- 빌드 시 경고를 에러로 처리:

```xml
<!-- csproj -->
<PropertyGroup>
  <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
</PropertyGroup>
```

---

## 9. 환경 분리/설정 — appsettings & 환경변수 & User Secrets

### 9.1 Minimal API 예시 + 설정 바인딩

```csharp
// Demo.Cli/Program.cs (웹 템플릿이라 가정)
var builder = WebApplication.CreateBuilder(args);

builder.Services.Configure<MyOptions>(builder.Configuration.GetSection("MyOptions"));
var app = builder.Build();

app.MapGet("/opts", (IOptions<MyOptions> opts) => Results.Json(opts.Value));

app.Run();

public record MyOptions(string ApiKey, string Endpoint);
```

```json
// appsettings.json
{
  "MyOptions": {
    "ApiKey": "local-dev-key",
    "Endpoint": "https://dev.example.com"
  }
}
```

- 환경별 파일: `appsettings.Development.json`, `appsettings.Production.json`
- 환경변수 우선순위: `ASPNETCORE_ENVIRONMENT=Development`

### 9.2 비밀(개발기) — User Secrets

```bash
cd Demo.Cli
dotnet user-secrets init
dotnet user-secrets set "MyOptions:ApiKey" "super-secret"
```

---

## 10. 통합 터미널 사용 팁

- VS Code: `Ctrl + ~` (또는 View → Terminal)
- 프로젝트 루트에서 `dotnet run`, `dotnet build`, `dotnet test` 즉시 가능
- 멀티 루트 워크스페이스에서도 폴더별 터미널 분리

---

## 11. WSL(Windows Subsystem for Linux)과 VS Code

- Windows에서 리눅스 유사 환경 제공
- Microsoft의 **Remote - WSL** 확장으로, WSL 배포판 내부의 파일을 VS Code로 바로 열고 빌드/디버깅 가능

### 11.1 간단 흐름

1. Microsoft Store에서 Ubuntu 설치
2. Ubuntu 셸에서 `.NET SDK` 설치
3. VS Code에서 “Open Folder in WSL”
4. 동일하게 `dotnet new`/`dotnet run`/디버깅

---

## 12. 컨테이너/Dev Containers — 동일한 개발환경 공유

### 12.1 Dockerfile (콘솔/웹 공용 예시)

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src
COPY . .
RUN dotnet publish -c Release -o /out

FROM mcr.microsoft.com/dotnet/runtime:9.0 AS run
WORKDIR /app
COPY --from=build /out .
ENTRYPOINT ["dotnet", "HelloCSharp.dll"]
```

```bash
docker build -t hello-csharp .
docker run --rm hello-csharp
```

### 12.2 Dev Containers (개발용 컨테이너)

```json
// .devcontainer/devcontainer.json
{
  "name": "C# Dev",
  "image": "mcr.microsoft.com/dotnet/sdk:9.0",
  "postCreateCommand": "dotnet --info",
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-dotnettools.csdevkit",
        "ms-dotnettools.csharp",
        "ms-azuretools.vscode-docker",
        "editorconfig.editorconfig"
      ]
    }
  }
}
```

- “Reopen in Container”로 통일된 개발환경 확보
- 팀 온보딩/CI 환경과 일치시키기 쉽습니다.

---

## 13. 디버깅 고급 — 여러 프로필, 인자, 환경

### 13.1 여러 구성

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": ".NET Debug (Default)",
      "type": "coreclr",
      "request": "launch",
      "program": "${workspaceFolder}/Demo.Cli/bin/Debug/net9.0/Demo.Cli.dll",
      "args": [],
      "cwd": "${workspaceFolder}/Demo.Cli",
      "console": "integratedTerminal"
    },
    {
      "name": ".NET Debug (WithArgs)",
      "type": "coreclr",
      "request": "launch",
      "program": "${workspaceFolder}/Demo.Cli/bin/Debug/net9.0/Demo.Cli.dll",
      "args": ["--seed", "42", "--verbose"],
      "env": {
        "LOG_LEVEL": "Debug"
      },
      "cwd": "${workspaceFolder}/Demo.Cli"
    }
  ]
}
```

### 13.2 ASP.NET Core 디버깅

- `launchSettings.json`의 프로필을 VS Code 디버깅에 반영하거나, `program`/`args`에 Kestrel 런칭을 명시합니다.
- SSL 개발 인증서 문제 시: `dotnet dev-certs https --trust`

---

## 14. 성능 측정 — BenchmarkDotNet

```bash
dotnet new console -n BenchDemo
dotnet add BenchDemo/BenchDemo.csproj package BenchmarkDotNet
```

```csharp
// BenchDemo/Program.cs
using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

[MemoryDiagnoser]
public class Bench
{
    [Benchmark] public int SumLinq() => Enumerable.Range(0, 1000).Sum();
    [Benchmark] public int SumLoop() { int s=0; for(int i=0;i<1000;i++) s+=i; return s; }
}

BenchmarkRunner.Run<Bench>();
```

```bash
dotnet run -c Release
```

- 결과 보고서로 할당량/시간 비교

---

## 15. 예외·로깅 — 개발 중 확인 포인트

### 15.1 예외 필터/조건부 처리

```csharp
try
{
    Dangerous();
}
catch (Exception ex) when (ex.Message.Contains("retryable"))
{
    // 재시도 로직
}
```

### 15.2 로깅 (Console + 구조적)

```csharp
using Microsoft.Extensions.Logging;

using var loggerFactory = LoggerFactory.Create(b => b.AddSimpleConsole());
var logger = loggerFactory.CreateLogger("App");

logger.LogInformation("Started at {Time}", DateTimeOffset.UtcNow);
```

---

## 16. 자주 만나는 에러와 해결책

| 증상 | 원인 | 해결 |
|---|---|---|
| `The framework 'Microsoft.NETCore.App', version 'x.x.x' was not found.` | 런타임 미설치/버전 불일치 | SDK/런타임 설치, `global.json` 확인 |
| `The SDK 'Microsoft.NET.Sdk' specified could not be found.` | SDK 경로/버전 문제 | PATH 수정, SDK 재설치, VS Code 재시작 |
| `Required assets to build and debug are missing.` | 디버깅 자산 누락 | VS Code가 제안하는 “Yes” 클릭 또는 `.vscode` 수동 생성 |
| HTTPS 개발 인증서 오류 | dev cert 미신뢰 | `dotnet dev-certs https --trust` 실행 |
| NuGet 복원 실패 | 네트워크/피드 문제 | `dotnet restore -s <feed-url>` / 프록시 설정 / `NuGet.Config` |

---

## 17. 문서화·품질 게이트 — XML 주석, Code Analysis

### 17.1 XML 주석 활성화

```xml
<!-- csproj -->
<PropertyGroup>
  <GenerateDocumentationFile>true</GenerateDocumentationFile>
  <NoWarn>$(NoWarn);1591</NoWarn> <!-- 공개 API 주석 경고 제어 -->
</PropertyGroup>
```

### 17.2 코드 분석/경고 수준

```xml
<PropertyGroup>
  <AnalysisLevel>latest</AnalysisLevel>
  <WarningsAsErrors>CS8602;CS8618</WarningsAsErrors>
</PropertyGroup>
```

---

## 18. 배포 빌드 — self-contained / single-file / ReadyToRun

```bash
dotnet publish -c Release -r linux-x64 --self-contained true -p:PublishSingleFile=true -p:PublishReadyToRun=true
```

- 결과물: 단일 실행 파일(플랫폼별)
- 빠른 기동/간편 배포. 크기 증가/리플렉션 제한 고려

---

## 19. 학습 확장 — 추천 실습 루트

1. **콘솔 유틸리티**: 파일/HTTP/JSON 처리
2. **웹 API**: Minimal API + Swagger + 통합테스트
3. **데이터**: EF Core로 SQLite/SQL Server 접속
4. **백그라운드**: `BackgroundService`로 큐/배치 구현
5. **컨테이너화**: Dockerfile + Dev Containers
6. **클라우드**: GitHub Actions → Azure App Service 배포

---

## 20. 종합 실습: “메모 API” (VS Code에서 끝장내기)

### 20.1 프로젝트 생성

```bash
mkdir MemoApi && cd MemoApi
dotnet new web -n MemoApi
code .
```

### 20.2 Program.cs

```csharp
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

app.UseSwagger();
app.UseSwaggerUI();

var store = new Dictionary<int, string>();
var nextId = 1;

app.MapGet("/memos", () => store.OrderBy(kv => kv.Key));
app.MapPost("/memos", (string text) =>
{
    var id = nextId++;
    store[id] = text;
    return Results.Created($"/memos/{id}", new { id, text });
});
app.MapGet("/memos/{id:int}", (int id) =>
    store.TryGetValue(id, out var text) ? Results.Ok(new { id, text }) : Results.NotFound());
app.MapPut("/memos/{id:int}", (int id, string text) =>
{
    if (!store.ContainsKey(id)) return Results.NotFound();
    store[id] = text;
    return Results.NoContent();
});
app.MapDelete("/memos/{id:int}", (int id) =>
{
    if (!store.Remove(id)) return Results.NotFound();
    return Results.NoContent();
});

app.Run();
```

### 20.3 디버깅/실행

- `F5` 또는 `Ctrl+F5`
- 브라우저에서 `/swagger`로 API 테스트

### 20.4 xUnit 통합 테스트(간단 예)

```bash
dotnet new xunit -n MemoApi.Tests
dotnet add MemoApi.Tests/MemoApi.Tests.csproj package Microsoft.AspNetCore.Mvc.Testing
dotnet add MemoApi.Tests/MemoApi.Tests.csproj reference MemoApi/MemoApi.csproj
```

```csharp
// MemoApi.Tests/IntegrationTests.cs
using System.Net.Http.Json;
using Microsoft.AspNetCore.Mvc.Testing;
using Xunit;

public class IntegrationTests : IClassFixture<WebApplicationFactory<Program>>
{
    private readonly HttpClient _client;
    public IntegrationTests(WebApplicationFactory<Program> factory) => _client = factory.CreateClient();

    [Fact]
    public async Task Create_And_Get()
    {
        var res = await _client.PostAsJsonAsync("/memos?text=hello", new { });
        res.EnsureSuccessStatusCode();
        var created = await res.Content.ReadFromJsonAsync<dynamic>();
        int id = (int)created.id;

        var get = await _client.GetAsync($"/memos/{id}");
        get.EnsureSuccessStatusCode();
    }
}
```

```bash
dotnet test
```

---

## 21. 정리 표

| 항목 | 핵심 내용 |
|---|---|
| 필수 설치 | .NET SDK, VS Code, C# 확장 |
| 프로젝트 시작 | `dotnet new console/web` → `code .` |
| 실행/디버깅 | `dotnet run`, `launch.json`, 브레이크포인트 |
| 품질 | xUnit 테스트, .editorconfig, Analyzers, `dotnet format` |
| 패키지 | `dotnet add package <Name>` |
| 환경 | `appsettings.*.json`, 환경변수, User Secrets |
| 확장 | WSL, Docker/Dev Containers, CI/CD |

---

## 22. 부록 — 자주 쓰는 명령어 모음

```bash
# 템플릿
dotnet new list
dotnet new console -n App
dotnet new webapi -n Api
dotnet new classlib -n Lib
dotnet new xunit -n Tests

# 참조/패키지
dotnet add Api/Api.csproj reference Lib/Lib.csproj
dotnet add Api/Api.csproj package Serilog.AspNetCore

# 빌드/실행/테스트
dotnet build
dotnet run --project Api/Api.csproj
dotnet test

# 퍼블리시(배포)
dotnet publish -c Release -r linux-x64 --self-contained true -p:PublishSingleFile=true
```

---

## 23. 트러블슈팅 체크리스트

- [ ] SDK/런타임 버전이 프로젝트와 일치하는가? (`global.json`, `TargetFramework`)
- [ ] C# 확장이 활성화되었는가?
- [ ] `.vscode/launch.json`에 올바른 `program` 경로가 설정되었는가?
- [ ] HTTPS dev cert 신뢰가 필요한가? (`dotnet dev-certs https --trust`)
- [ ] NuGet 소스/프록시 문제는 없는가? (`dotnet restore --verbosity detailed`로 진단)

---

# 결론

VS Code에서 C# 개발은 **가벼움 + 생산성**을 동시에 제공합니다.
