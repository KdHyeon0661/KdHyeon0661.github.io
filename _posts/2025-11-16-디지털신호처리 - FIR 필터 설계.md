---
layout: post
title: 디지털신호처리 - FIR 필터 설계
date: 2025-11-16 17:25:23 +0900
category: 디지털신호처리
---
# FIR 필터 설계 — 예비사항과 선형 위상 FIR 필터의 특성

## 예비사항 개요 — 무엇을, 어떻게 설계할 것인가

FIR 필터 설계는 결국 다음 질문에 답하는 과정이다.

1. **어떤 신호를 통과/차단** 하고 싶은가?
2. **어떤 주파수 축(연속시간 vs 이산시간)** 에서 사양을 줄 것인가?
3. 원하는 크기 응답(리플/감쇠)과 **허용 가능한 필터 차수**는?
4. 위상 특성(선형 위상 여부, 군지연)은 얼마나 중요한가?

FIR 필터는 다음과 같이 정의된다.

$$
y[n] = \sum_{k=0}^{M} h[k]\,x[n-k]
$$

- $$h[k]$$ : 필터의 임펄스 응답 (길이 $$M+1$$)
- $$H(z) = \sum_{k=0}^{M} h[k]z^{-k}$$ : 전송함수
- 디지털 주파수 응답:

  $$
  H(e^{j\omega}) = \sum_{k=0}^{M} h[k]\,e^{-j\omega k}, \quad -\pi \le \omega \le \pi
  $$

**예비사항**에서는 보통 다음 항목들을 먼저 정리한다.

- 필터 종류: 저역통과/고역통과/대역통과/대역저지/특수(힐버트, 미분기 등)
- 통과대역/저지대역 경계 주파수
- 통과대역 리플/저지대역 감쇠
- 허용 가능한 차수/지연
- 샘플링 주파수와 정규화

이 정보가 명확해져야 설계 방법(윈도우법, 주파수 표본화, 최소 리플 설계 등)을 선택할 수 있고,
특히 **선형 위상 FIR** 을 설계할 때 “어떤 타입(Type I~IV)”을 사용할지도 결정된다.

---

## FIR 설계의 기본 사양 정의

### 연속시간 vs 디지털 주파수 사양

실무에서는 설계 사양이 보통 **연속시간 주파수(Hz)** 로 주어진다.

예를 들어:

- 샘플링 주파수 $$F_s = 48\,\text{kHz}$$
- 저역통과 필터에서
  - 통과대역 끝: $$F_p = 6\,\text{kHz}$$
  - 저지대역 시작: $$F_s' = 8\,\text{kHz}$$

디지털 신호 처리에서 이 주파수들은 다음과 같이 **정규화**한다.

1. 각 주파수를 **라디안/샘플** 로 변환:

   $$
   \omega = 2\pi \frac{F}{F_s}
   $$

2. 또는 **정규화 주파수** (디지털 주파수 축을 $$[0,1]$$ 에 매핑):

   $$
   f_\mathrm{norm} = \frac{F}{F_s/2} = \frac{2F}{F_s}
   $$

   - $$f_\mathrm{norm} = 1$$ 이 Nyquist (즉 $$F = F_s/2$$)
   - Octave/MATLAB의 대부분 FIR 설계 함수(`fir1`, `fir2` 등)는 이 **정규화 주파수**를 사용한다.

예:

- $$F_s = 48\,\text{kHz}$$, $$F_p = 6\,\text{kHz}$$, $$F_s' = 8\,\text{kHz}$$
- 정규화:

  $$
  f_p = \frac{2F_p}{F_s} = \frac{2\cdot 6000}{48000} = 0.25
  $$

  $$
  f_s = \frac{2F_s'}{F_s} = \frac{2\cdot 8000}{48000} \approx 0.3333
  $$

Octave의 `fir1`에 넣을 때는 `fir1(N, 0.25)` 형태로 사용한다.

---

### 필터 종류와 이상 응답

기본 필터 종류:

1. **저역통과 (Low-Pass, LPF)**
   - 목적: 저주파 통과, 고주파 차단
2. **고역통과 (High-Pass, HPF)**
   - 목적: 일정 주파수 이상만 통과
3. **대역통과 (Band-Pass, BPF)**
   - 목적: 특정 대역 $$[F_{p1}, F_{p2}]$$ 만 통과
4. **대역저지 (Band-Stop, Notch, BSF)**
   - 목적: 특정 대역만 차단, 그 외는 통과
5. **기타 특수 필터**
   - 힐버트 변환기, 미분기, 분산 보상 필터 등

각 필터는 **이상적인 크기 응답**을 가지고, 실제 설계된 FIR은 여기에 **근사**할 뿐이다.

---

### 통과대역/저지대역 리플, 감쇠 정의

FIR 설계 사양은 보통 다음과 같이 주어진다.

- 통과대역에서 **허용 리플**: $$\delta_p$$
- 저지대역에서 **허용 최대 크기**: $$\delta_s$$
- 혹은 동일한 것을 데시벨로 표현:

  - 통과대역 최대 리플 (passband ripple) $$A_p$$ [dB]
  - 저지대역 감쇠 (stopband attenuation) $$A_s$$ [dB]

관계식:

- 통과대역 리플:

  $$
  20 \log_{10}\frac{1+\delta_p}{1-\delta_p} \approx A_p
  $$

- 저지대역 감쇠:

  $$
  A_s = -20 \log_{10}(\delta_s)
  $$

일반적인 오디오/통신 예:

- $$A_p \approx 0.1\ \text{dB}$$
- $$A_s \approx 60\ \text{dB}$$

---

### 사양 그림으로 정리

저역통과 필터의 이상 사양을 텍스트 그림으로 표현하면:

```text
|H(e^{jω})|
   1 + δp ────┐■■■■■■■■■■■■■■■■■■■
              │       통과대역
   1 - δp ────┘--------------------
              |        |       |
              0      ωp     ωs       ω
                         ■■■■■■■■■■■
                          저지대역
     δs ──────────────────┘
```

- $$\omega_p$$: 통과대역 끝 주파수
- $$\omega_s$$: 저지대역 시작 주파수
- $$[\omega_p, \omega_s]$$: **전이대역(transition band)**
  이 구간에서 응답이 부드럽게 1 → 0으로 내려간다.

---

### 설계 예 사양 표

| 항목               | 기호          | 값 (예)                  |
|--------------------|---------------|--------------------------|
| 샘플링 주파수      | $$F_s$$       | 48 kHz                   |
| 통과대역 끝        | $$F_p$$       | 6 kHz                    |
| 저지대역 시작      | $$F_s'$$      | 8 kHz                    |
| 통과대역 리플      | $$A_p$$       | 0.1 dB                   |
| 저지대역 감쇠      | $$A_s$$       | 60 dB                    |
| 정규화 통과대역    | $$f_p$$       | 0.25                     |
| 정규화 저지대역    | $$f_s$$       | ≈ 0.3333                 |
| 정규화 전이대역    | $$\Delta f$$  | ≈ 0.0833 (= 0.3333-0.25) |

이 정도 표가 있으면 어떤 설계 방법으로 들어가든(윈도우, Parks–McClellan 등) 출발점이 된다.

---

## FIR 차수와 전이대역/리플의 관계 (대략적 추정)

실무에서 FIR 설계를 할 때 가장 중요한 감각 중 하나는:

> “이 정도 리플/전이대역이면 FIR 길이가 어느 정도 나올까?”

이다. 전형적으로 윈도우/카이저 창 기반 FIR 설계에서
필터 차수는 대략 다음과 같이 추정할 수 있다.

- 저지대역 감쇠 $$A_s$$ [dB]
- 정규화 전이대역 폭 $$\Delta\omega = \omega_s - \omega_p$$

에 대해, 카이저 창 FIR에서 필요한 탭 수(길이) $$L = M+1$$ 을 대략

$$
L \approx \frac{A_s - 8}{2.285 \Delta\omega} + 1
$$

로 추정한다.

- $$A_s$$ 가 커질수록(더 큰 감쇠) 필터가 길어짐
- $$\Delta\omega$$ 가 좁아질수록(더 날카로운 전이) 필터가 길어짐

이 식은 정확한 것이 아니라 **설계 전의 감** 을 잡기 위한 경험식이다.

---

## GNU Octave에서의 FIR 설계 준비

Octave에서 FIR 설계를 위해 자주 쓰는 함수:

- `fir1(N, Wn)`: 윈도우 기반 저역/고역/대역통과 FIR
- `fir2(N, F, A)`: 주파수 샘플링 기반 FIR
- `kaiser`, `hamming`, `hann`, `blackman` 등: 창 함수
- `freqz(b, 1, N)`: 주파수 응답
- `grpdelay(b, 1, N)`: 군지연

기본 준비 코드는 다음과 같이 짤 수 있다.

```octave
clear; clc; pkg load signal;

Fs = 48000;         % 샘플링 주파수
Fp = 6000;          % 통과대역 끝
Fs1 = 8000;         % 저지대역 시작

% 정규화 주파수 (0~1, 1은 Nyquist)
fp = (2*Fp)/Fs;
fs1 = (2*Fs1)/Fs;

fprintf("정규화 주파수: fp=%.4f, fs=%.4f\n", fp, fs1);

% 대략 차수 추정 (카이저 창 가정, As=60dB)
As = 60;
Dw = pi*(fs1 - fp);         % 라디안/샘플 기준 전이대역
L_approx = (As - 8) / (2.285 * Dw) + 1;
fprintf("대략적 필요한 탭 수 L≈%.1f\n", L_approx);
```

이처럼 **예비사항**을 수치로 정리해 두면,
설계 방법을 바꾸더라도 “어느 정도 길이가 나올지, 어느 수준 SNR/감쇠인지”를 빠르게 파악할 수 있다.

---

## 선형 위상 FIR 필터의 정의

FIR 필터의 주파수 응답을

$$
H(e^{j\omega}) = |H(e^{j\omega})| e^{j\theta(\omega)}
$$

라고 할 때, 선형 위상(linear phase) FIR의 위상은

$$
\theta(\omega) = -\omega\cdot n_0 + \theta_0
$$

꼴(혹은 상수 항만 다른 변형)을 갖는다.

- $$n_0$$: **그룹 지연(group delay)**
- $$\theta_0$$: 상수 위상 오프셋

이 경우 **군지연**은

$$
\tau_g(\omega) = -\frac{d\theta(\omega)}{d\omega} = n_0
$$

으로 **주파수에 무관한 상수**가 된다.
즉, **모든 주파수 성분이 동일한 지연을 겪는다**.

이것이 의미하는 것:

> 신호의 **파형 모양(파형 왜곡)** 이 크기 응답에 의한 스펙트럼 변형만 받을 뿐,
> 위상에 의해 **성분별로 밀리는 정도가 다르게 왜곡되지 않는다**.

오디오, 통신, 계측 등에서 선형 위상이 중요한 이유가 여기에 있다.

---

## 선형 위상 FIR의 대칭 조건

FIR 필터의 임펄스 응답이 **실수(real)** 고, 다음과 같은 대칭을 만족하면
선형 위상이 된다.

길이가 $$M+1$$인 FIR 필터를 생각하자.
인덱스는 $$n = 0,\dots,M$$.

### 짝수 길이/홀수 길이

- 길이 $$L = M+1$$ 이 **홀수** 인 경우:
  가운데 샘플이 한 개 있다.
- 길이 $$L = M+1$$ 이 **짝수** 인 경우:
  가운데가 두 샘플 사이(정수 샘플에 없음).

대칭 조건은 필터 중심을 기준으로 쓰는 것이 직관적이다.

#### 짝 대칭 (대칭, even symmetry)

$$
h[n] = h[M-n]
$$

- 임펄스 응답을 좌우 뒤집으면 그대로 같다.
- 예: $$L=5$$, $$M=4$$

  $$
  h[0]=h[4],\quad h[1]=h[3],\quad h[2] \text{는 중심}
  $$

#### 반대칭 (antisymmetric, odd symmetry)

$$
h[n] = -h[M-n]
$$

- 좌우 뒤집으면 부호가 바뀜.
- 예: $$L=5$$, $$M=4$$

  $$
  h[0]=-h[4],\quad h[1]=-h[3],\quad h[2]=0
  $$

이 두 가지 형태(짝대칭, 반대칭)가 선형 위상 FIR의 기본이다.

---

## 선형 위상 FIR의 4가지 타입 (I~IV)

FIR 길이와 대칭 타입을 조합하면 총 4가지 선형 위상 FIR 타입이 나온다.

### Type I — 짝대칭, 홀수 길이

- 길이 $$L = M+1$$ 이 홀수 (예: 3,5,7,…)
- 짝대칭:

  $$
  h[n] = h[M-n]
  $$

- 군지연: $$\tau_g = \frac{M}{2}$$ (정수 또는 .5, 구체적 형태는 L에 따라)
- 사용할 수 있는 용도:
  - 일반적인 저역통과, 고역통과, 대역통과, 대역저지
- 주파수 0과 $$\pi$$ 에서 유연하게 0 또는 비0 값을 가질 수 있어 가장 일반적이다.


### Type II — 짝대칭, 짝수 길이

- 길이 $$L$$(=M+1)가 **짝수** (예: 4,6,8,…)
- 짝대칭:

  $$
  h[n] = h[M-n]
  $$

- 이 경우 $$\omega = \pi$$ 에서의 크기 응답이 **항상 0** 이 되므로,
  **정확한 고역통과 필터** (즉 $$H(e^{j\pi}) \neq 0$$)로는 사용하기 어렵다.
- 주로 **저역통과/대역저지** 등에서 사용.

### Type III — 반대칭, 홀수 길이

- 길이 홀수
- 반대칭:

  $$
  h[n] = -h[M-n]
  $$

- $$\omega = 0$$, $$\omega = \pi$$ 에서 크기 응답이 0이 된다.
- **미분기(differentiator)** 같이 DC와 Nyquist에서 0이 되는 필터,
  혹은 **위상 보상**, **특수 위상 필터**에 사용.

### Type IV — 반대칭, 짝수 길이

- 길이 짝수
- 반대칭:

  $$
  h[n] = -h[M-n]
  $$

- $$\omega = 0$$ 에서 크기 응답이 항상 0.
- **힐버트 변환기(Hilbert transformer)** 같이
  특정 대역에서 위상만 90° 회전시키는 필터 등에 적합.

---

### 요약 표

| 타입  | 길이(탭 수) | 대칭 조건                  | 특징/용도 예시                                 |
|-------|-------------|---------------------------|-----------------------------------------------|
| I     | 홀수        | $$h[n]=h[M-n]$$          | 일반 LPF/HPF/BPF/BSF, 가장 일반적             |
| II    | 짝수        | $$h[n]=h[M-n]$$          | $$\omega=\pi$$에서 0, HPF 설계 제약           |
| III   | 홀수        | $$h[n]=-h[M-n]$$         | DC, $$\pi$$에서 0, differentiator 등          |
| IV    | 짝수        | $$h[n]=-h[M-n]$$         | DC에서 0, Hilbert 변환기 등                   |

실제 설계에서는 사양에 따라 어떤 타입이 가능한지 먼저 판단한 후,
해당 타입에 맞는 설계 도구(`firpm`, `firls` 등)를 사용한다.

---

## 선형 위상 FIR의 군지연과 위상

### 대칭 FIR의 위상 유도 (개념)

짝대칭 FIR (예: Type I)을 예로 들자.

길이 $$L=M+1$$, 대칭 조건 $$h[n]=h[M-n]$$ 이면
주파수 응답은

$$
H(e^{j\omega}) = \sum_{n=0}^{M} h[n] e^{-j\omega n}
$$

이를 필터 중심 $$n_0 = \frac{M}{2}$$ 를 기준으로 쓰면

$$
H(e^{j\omega})
= e^{-j\omega n_0} \sum_{m=-n_0}^{n_0} h[n_0+m] e^{-j\omega m}
$$

여기서 **대칭성** $$h[n_0+m]=h[n_0-m]$$ 을 사용하면
내부 합이 **완전히 실수** 꼴이 되어

$$
H(e^{j\omega}) = A(\omega)e^{-j\omega n_0}
$$

꼴이 된다.

- $$A(\omega)$$: 실수 크기 응답
- 위상은 $$\theta(\omega) = -\omega n_0$$ 또는 상수 부호/π shift를 포함한 형태

결과적으로 **위상은 주파수에 대해 선형** 이고,
군지연은 $$n_0 = M/2$$ 로 일정하다.

비슷한 방식으로 반대칭 FIR(Type III, IV)에 대해서도
위상이 선형이 되며, 대신 크기 응답이 $$\omega=0,\pi$$에서 0이 되는 등
추가 제약이 생긴다.

---

### GNU Octave로 군지연 확인 예제

이제 간단한 선형 위상 FIR 저역통과 필터를 설계하고
위상과 군지연이 어떻게 나오는지 확인해 보자.

#### 예제: 선형 위상 저역통과 FIR

- $$F_s = 48000\ \text{Hz}$$
- $$F_p = 6000\ \text{Hz}$$
- $$F_s' = 8000\ \text{Hz}$$
- Hamming 창, 탭 수 101 (Type I, 홀수 길이, 짝대칭)

```octave
clear; clc; pkg load signal;

Fs  = 48000;
Fp  = 6000;
Fs1 = 8000;

fp = (2*Fp)/Fs;   % 0~1
fs = (2*Fs1)/Fs;

N  = 100;         % 차수, 탭 수는 N+1=101 (홀수 → Type I)
b  = fir1(N, fp, hamming(N+1));  % 저역통과 FIR

% 임펄스 응답 대칭성 확인
fprintf("대칭성 체크: max|h[n]-h[M-n]| = %.3e\n", ...
        max(abs(b - fliplr(b))));

% 주파수 응답과 위상
[H, w] = freqz(b, 1, 2048);
mag = abs(H);
ph  = unwrap(angle(H));
tau = -diff(ph)./diff(w);  % 군지연 근사

% 플롯
subplot(3,1,1);
plot(w/pi, 20*log10(mag+eps));
xlabel('정규화 주파수 (\times\pi rad/sample)');
ylabel('Magnitude [dB]');
title('선형 위상 FIR 저역통과 - 크기 응답');
grid on;

subplot(3,1,2);
plot(w/pi, ph);
xlabel('정규화 주파수'); ylabel('위상 [rad]');
title('위상 응답');
grid on;

subplot(3,1,3);
w_mid = (w(1:end-1) + w(2:end))/2;
plot(w_mid/pi, tau);
xlabel('정규화 주파수');
ylabel('군지연 [sample]');
title('군지연');
grid on;
```

- `max|h[n]-h[M-n]|` 값이 거의 0이면 **짝대칭**이 잘 나왔다는 뜻.
- 군지연 플롯은 거의 수평선에 가깝게 나와야 한다.
  이 수평선의 값은 대략 $$M/2$$ 근처 (여기서는 100/2=50 샘플)이다.

---

## 선형 위상 FIR의 실무적 장점과 제약

### 장점

1. **위상 왜곡 없음**
   - 모든 주파수 성분이 동일한 샘플 수만큼 지연 → 신호 파형 보존
2. **항상 안정(BIBO)**
   - FIR 특성상 분모가 1 → 극점이 모두 원점 (또는 z=0)
3. **구조 상수/대칭 활용**
   - 짝대칭 이용 시 곱셈기 수를 절반 수준으로 줄일 수 있음
4. **고정소수점에서 수치 안정성 우수**
   - 피드백이 없으므로 **계수 양자화**의 영향이 IIR보다 덜 치명적
   - 내부 오버플로/한계 주기(limit cycle)가 IIR보다 훨씬 문제 덜 됨

### 제약

1. **필터 길이가 길어지기 쉬움**
   - 주어진 리플/감쇠를 만족하려면 IIR 대비 더 많은 탭이 필요
2. **일부 응답은 구현 불가**
   - 선형 위상 조건으로 인해 크기 응답의 자유도가 제한
   - 예: Type II/III/IV는 $$\omega = 0$$ 또는 $$\pi$$ 에서 응답이 0이어야 하는 등 조건 존재
3. **지연 증가**
   - 군지연 $$\tau_g \approx \frac{M}{2}$$ 가 **긴 지연**으로 작용
   - 실시간 제어/초저지연 통신에서는 문제가 될 수 있음

그래도 오디오 처리, 데이터 통신의 등화, 계측 신호 전처리 등에서는
“선형 위상 FIR + 충분한 프로세싱 파워”가 가능한 경우가 많아
널리 사용된다.

---

## 선형 위상 FIR 설계 예제 1 — 저역통과 필터

앞의 예비사항과 선형 위상 특성을 종합해서
실제 하나의 선형 위상 FIR 저역통과 필터를 설계해 보자.

### 사양

- $$F_s = 48\ \text{kHz}$$
- 저역통과
  - 통과대역: $$0 \le F \le 6\ \text{kHz}$$
  - 저지대역: $$8\ \text{kHz} \le F \le 24\ \text{kHz}$$ (Nyquist)
- 창: Hamming
- 차수: N=100 (탭 수 101, Type I 선형 위상)

### 설계 및 특성 확인

```octave
clear; clc; pkg load signal;

Fs  = 48000;
Fp  = 6000;
Fs1 = 8000;

fp = (2*Fp)/Fs;

N  = 100;                % FIR 차수
b  = fir1(N, fp, hamming(N+1));

% 임펄스 응답 플롯
n = 0:N;
subplot(3,1,1);
stem(n, b, 'filled');
xlabel('n'); ylabel('h[n]');
title('FIR 임펄스 응답 (선형 위상, 짝대칭)');
grid on;

% 대칭성 확인
fprintf("대칭성: max|h[n]-h[M-n]| = %.3e\n", ...
        max(abs(b - fliplr(b))));

% 주파수 응답
[H, w] = freqz(b, 1, 2048);
mag = abs(H);
ph  = unwrap(angle(H));

subplot(3,1,2);
plot(w/pi, 20*log10(mag+eps));
xlabel('정규화 주파수');
ylabel('Magnitude [dB]');
title('크기 응답 (Hamming 창 FIR)');
grid on;
axis([0 1 -100 5]);

subplot(3,1,3);
plot(w/pi, ph);
xlabel('정규화 주파수');
ylabel('위상 [rad]');
title('위상 응답');
grid on;
```

- 임펄스 응답이 좌우 대칭으로 나오는지 시각적으로 확인할 수 있다.
- 위상 응답은 거의 직선에 가까운 모양을 한다.

---

## 선형 위상 FIR 설계 예제 2 — 고역통과 필터

고역통과 필터도 선형 위상 FIR로 쉽게 설계할 수 있다.
윈도우법에서는 **스펙트럼 반전(spectral inversion)** 또는
`fir1`의 `'high'` 옵션을 사용한다.

### 사양

- $$F_s = 48\ \text{kHz}$$
- 고역통과
  - 저지대역: $$0 \le F \le 5\ \text{kHz}$$
  - 통과대역: $$7\ \text{kHz} \le F \le 24\ \text{kHz}$$
- 차수: N=100

### 설계 코드

```octave
clear; clc; pkg load signal;

Fs  = 48000;
Fs0 = 5000;    % 저지대역 끝
Fp  = 7000;    % 통과대역 시작

fp = (2*Fp)/Fs;   % 고역통과 차단 주파수 (정규화 기준)

N = 100;

% (1) fir1의 'high' 옵션 사용
b_hp = fir1(N, fp, 'high', hamming(N+1));

% (2) 임펄스 응답 대칭 확인
fprintf("HPF 대칭성: max|h[n]-h[M-n]| = %.3e\n", ...
        max(abs(b_hp - fliplr(b_hp))));

[H, w] = freqz(b_hp, 1, 2048);
mag = abs(H);
ph  = unwrap(angle(H));

subplot(3,1,1);
stem(0:N, b_hp, 'filled');
xlabel('n'); ylabel('h[n]');
title('선형 위상 FIR 고역통과 - 임펄스 응답');
grid on;

subplot(3,1,2);
plot(w/pi, 20*log10(mag+eps));
xlabel('정규화 주파수');
ylabel('Magnitude [dB]');
title('크기 응답 (고역통과)');
grid on;
axis([0 1 -100 5]);

subplot(3,1,3);
plot(w/pi, ph);
xlabel('정규화 주파수');
ylabel('위상 [rad]');
title('위상 응답 (고역통과)');
grid on;
```

고역통과 필터에서도 임펄스 응답 대칭성, 위상의 선형성을 확인할 수 있다.

---

## 선형 위상 FIR의 구조 최적화 — 대칭성 활용

앞 글에서 본 것처럼, 짝대칭 FIR에서는 곱셈기를 절반으로 줄일 수 있다.

길이 $$L=M+1$$ 이고 짝대칭 $$h[n]=h[M-n]$$ 인 경우,
출력은

$$
y[n] = \sum_{k=0}^{M} h[k]x[n-k]
$$

대칭을 이용하면 대응되는 항들을 묶어서

$$
y[n]
= \sum_{k=0}^{\lfloor M/2 \rfloor} h[k]\,(x[n-k] + x[n-M+k])
$$

(중심 샘플은 길이가 홀수인 경우에만 별도 처리)

### 텍스트 블록도 예 (길이 6)

길이 6, $$h[0]=h[5], h[1]=h[4], h[2]=h[3]$$ 인 FIR:

```text
x[n] ──▶[z⁻¹]──▶[z⁻¹]──▶[z⁻¹]──▶[z⁻¹]──▶[z⁻¹]
  │        │        │        │        │        │
  │        │        │        │        │        │
  ▼        ▼        ▼        ▼        ▼        ▼
 x0       x1       x2       x3       x4       x5
  │  ┌─────┘        │  ┌─────┘        │  ┌─────┘
  ├─▶(+)            ├─▶(+)            ├─▶(+)
  │  │              │  │              │  │
 [×h0]            [×h1]            [×h2]
   \                \                /
    └───────────────(+)─────────────┘──▶ y[n]
```

- 입력 샘플 쌍: $$x_0=x[n], x_5=x[n-5]$$ → 합산 후 $$h[0]$$ 곱
- $$x_1=x[n-1], x_4=x[n-4]$$ → 합산 후 $$h[1]$$ 곱
- $$x_2=x[n-2], x_3=x[n-3]$$ → 합산 후 $$h[2]$$ 곱

곱셈기: 6개 → 3개로 감소.

---

### GNU Octave로 대칭 구조 vs Direct Form 비교

```octave
clear; clc;

% 예: 대칭 FIR 계수
h = [0.1 0.2 0.3 0.3 0.2 0.1];   % 길이 6, 짝대칭

N = 200;
x = randn(1, N);

% (1) Direct Form (conv)
y_direct = conv(x, h, 'same');

% (2) 대칭성 활용한 구조
L = length(h);
M = L - 1;
x_delay = zeros(1, M);
y_sym = zeros(1, N);

for n = 1:N
  taps = [x(n) x_delay];   % [x[n], x[n-1], ..., x[n-M]]

  % (x0+x5), (x1+x4), (x2+x3) 조합
  s0 = taps(1) + taps(6);
  s1 = taps(2) + taps(5);
  s2 = taps(3) + taps(4);

  y_sym(n) = h(1)*s0 + h(2)*s1 + h(3)*s2;

  if M > 0
    x_delay(2:end) = x_delay(1:end-1);
    x_delay(1) = x(n);
  end
end

fprintf("max|y_direct - y_sym| = %.3e\n", max(abs(y_direct - y_sym)));
```

`max|y_direct - y_sym|` 이 머신 정밀도 수준이면
대칭 구조가 Direct Form과 **완전히 동일한 기능**을 수행한다는 뜻이다.

---

## 선형 위상 검증 실습 — 위상 직선과 그룹 지연 상수

마지막으로, 선형 위상 FIR 설계 후 **위상이 실제로 선형인지** 검증하는
작은 실험 코드를 작성해 보자.

### 위상 직선 피팅

아이디어:

1. `freqz`로 위상 $$\theta(\omega)$$를 구한다.
2. `unwrap`으로 연속 위상으로 만든다.
3. 관심 있는 주파수 대역(예: 통과대역 근처)을 골라
   $$\theta(\omega) = a\omega + b$$ 형식으로 **선형 회귀**를 한다.
4. $$a \approx -\tau_g$$, $$b \approx \theta_0$$ 이다.

```octave
clear; clc; pkg load signal;

Fs  = 48000;
Fp  = 6000;
fp  = (2*Fp)/Fs;

N = 100;
b = fir1(N, fp, hamming(N+1));

[H, w] = freqz(b, 1, 4096);
ph = unwrap(angle(H));

% 통과대역 근처만 사용 (예: w/pi <= 0.3)
idx = find(w/pi <= 0.3);
w_sel  = w(idx);
ph_sel = ph(idx);

% 선형 회귀: ph ≈ a*w + b
A = [w_sel, ones(size(w_sel))];  % [w, 1]
p = A \ ph_sel;                  % 최소제곱해
a = p(1); b0 = p(2);

tau_g_est = -a;

fprintf("추정 군지연 tau_g ≈ %.3f (이론값: M/2=%.1f)\n", tau_g_est, N/2);

% 위상과 피팅 직선 비교 플롯
ph_fit = a*w + b0;

plot(w/pi, ph, 'b', w/pi, ph_fit, 'r--');
xlabel('정규화 주파수');
ylabel('위상 [rad]');
legend('실제 위상', '선형 피팅', 'Location', 'best');
title('선형 위상 FIR의 위상 직선 검증');
grid on;
```

- `tau_g_est` 가 이론값 $$M/2$$와 잘 맞으면
  **선형 위상**이 잘 구현되었다는 의미.
- 이 방식은 실제 설계 검증에서 자주 사용되는 테크닉이다.

---

## 정리

이 글에서는 **FIR 필터 설계에 들어가기 전 준비해야 할 예비사항**과
**선형 위상 FIR 필터의 핵심 특성**을 정리하고,
GNU Octave 예제로 그 특성을 직접 확인하는 방법까지 다루었다.

핵심 포인트를 다시 요약하면:

1. **예비사항(설계 사양 정리)**
   - 필터 종류 (LPF/HPF/BPF/BSF/특수)
   - $$F_s, F_p, F_s'$$ 등 연속시간 사양과 정규화 디지털 주파수 사양
   - 통과대역 리플/저지대역 감쇠 $$A_p, A_s$$ 와 각에 대응하는 $$\delta_p, \delta_s$$
   - 전이대역 폭과 필요한 FIR 차수(카이저 창 경험식 등)

2. **선형 위상 FIR 필터의 정의**
   - $$H(e^{j\omega}) = A(\omega)e^{-j\omega n_0}$$ 꼴
   - 위상 $$\theta(\omega) = -\omega n_0 + \theta_0$$ → 군지연 $$\tau_g = n_0$$ 상수

3. **대칭 조건과 4가지 타입**
   - 짝대칭/반대칭, 길이 홀수/짝수를 조합한 Type I~IV
   - 각 타입마다 $$\omega = 0,\pi$$ 에서의 응답 제약과 주 필터 용도

4. **선형 위상의 장/단점**
   - 위상 왜곡 없음, 수치 안정성, 대칭 구조로 곱셈기 절감
   - 대신 더 긴 탭, 더 큰 지연, 특정 응답 제약

5. **GNU Octave 실습**
   - FIR 저역통과/고역통과 설계 (`fir1`)
   - 임펄스 응답 대칭성 검증
   - 위상/군지연 플롯 및 선형 피팅으로 선형 위상 확인
   - 대칭 구조를 이용한 곱셈기 수 절감 예제

이 토대를 바탕으로, 다음 단계에서는

- **윈도우법** (Hamming/Blackman/Kaiser) 을 비교하며 설계 특성 분석
- **최소 리플(minimax) 설계** (Parks–McClellan)으로 리플을 균등하게 분포시키는 방법
- **Polyphase+다중레이트** 를 결합한 효율적인 FIR 구현
- **고정소수점 환경에서의 FIR 계수 양자화 영향**
