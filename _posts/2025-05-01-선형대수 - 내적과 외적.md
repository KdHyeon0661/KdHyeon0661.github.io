---
layout: post
title: 선형대수 - 내적과 외적
date: 2025-05-01 20:20:23 +0900
category: 선형대수
---
# 벡터의 내적(Dot Product)과 외적(Cross Product) — 정의, 기하, 성질, 응용, PyTorch 예제

본 문서는 내적과 외적을 **정의 → 기하적 의미 → 대수적 성질 → 수치 계산법 → 실전 응용 → 연습문제** 흐름으로 정리합니다.

---

## 0. 표기 규약(Notation)

- 스칼라: $$a,b,\alpha,\beta,\lambda\in\mathbb{R}$$
- 벡터: $$\mathbf{a},\mathbf{b},\mathbf{u},\mathbf{v}\in\mathbb{R}^n$$ (기본은 열벡터로 해석)
- 전치: $$\mathbf{v}^\top$$
- 노름: $$\lVert\cdot\rVert \equiv \lVert\cdot\rVert_2$$
- 단위벡터: $$\hat{\mathbf{v}}=\dfrac{\mathbf{v}}{\lVert\mathbf{v}\rVert} \ (\mathbf{v}\neq\mathbf{0})$$
- 3차원 표준기저: $$\hat{\mathbf{i}},\hat{\mathbf{j}},\hat{\mathbf{k}}$$

---

## 1. 내적(Dot Product)

### 1.1 대수적 정의(모든 차원)
$$
\mathbf{a}\cdot\mathbf{b} \;=\; \sum_{i=1}^n a_i b_i \;=\; \mathbf{a}^\top \mathbf{b}.
$$

### 1.2 기하적 정의(각도와 연결)
$$
\mathbf{a}\cdot\mathbf{b} \;=\; \lVert\mathbf{a}\rVert\,\lVert\mathbf{b}\rVert \cos\theta,
$$
여기서 $$\theta$$ 는 두 벡터 사이의 각도입니다. 따라서
$$
\cos\theta \;=\; \frac{\mathbf{a}^\top\mathbf{b}}{\lVert\mathbf{a}\rVert\,\lVert\mathbf{b}\rVert},\quad
\theta \;=\; \arccos\!\Big(\frac{\mathbf{a}^\top\mathbf{b}}{\lVert\mathbf{a}\rVert\,\lVert\mathbf{b}\rVert}\Big).
$$

### 1.3 직교성, 투영, 성분
- 직교(수직): $$\mathbf{a}\cdot\mathbf{b}=0 \iff \mathbf{a}\perp\mathbf{b}.$$
- $$\mathbf{b}$$ 방향 성분(스칼라):
$$
\operatorname{comp}_{\mathbf{b}}(\mathbf{a}) \;=\; \frac{\mathbf{a}^\top\mathbf{b}}{\lVert\mathbf{b}\rVert}.
$$
- $$\mathbf{b}$$ 위로의 정사영(벡터):
$$
\operatorname{proj}_{\mathbf{b}}(\mathbf{a}) \;=\; \frac{\mathbf{a}^\top\mathbf{b}}{\mathbf{b}^\top\mathbf{b}}\,\mathbf{b}
\;=\; (\mathbf{a}^\top\hat{\mathbf{b}})\,\hat{\mathbf{b}}.
$$

### 1.4 기본 성질(양의정부호·쌍선형성·대칭성)
모든 $$\mathbf{u},\mathbf{v},\mathbf{w}\in\mathbb{R}^n,\ \alpha\in\mathbb{R}$$ 에 대해
- 대칭성: $$\mathbf{u}\cdot\mathbf{v}=\mathbf{v}\cdot\mathbf{u}.$$
- 선형성: $$(\alpha\mathbf{u}+\mathbf{v})\cdot\mathbf{w}=\alpha(\mathbf{u}\cdot\mathbf{w})+\mathbf{v}\cdot\mathbf{w}.$$
- 양의정부호: $$\mathbf{v}\cdot\mathbf{v}=\lVert\mathbf{v}\rVert^2\ge 0,$$ 등호는 $$\mathbf{v}=\mathbf{0}$$ 일 때만.

### 1.5 코시–슈바르츠와 법칙들
- 코시–슈바르츠:
$$
\lvert\mathbf{u}^\top\mathbf{v}\rvert \le \lVert\mathbf{u}\rVert\,\lVert\mathbf{v}\rVert.
$$
- 삼각부등식(노름):
$$
\lVert \mathbf{u}+\mathbf{v}\rVert \le \lVert\mathbf{u}\rVert+\lVert\mathbf{v}\rVert.
$$
- 코사인 법칙:
$$
\lVert\mathbf{u}-\mathbf{v}\rVert^2 \;=\; \lVert\mathbf{u}\rVert^2 + \lVert\mathbf{v}\rVert^2 - 2\,\mathbf{u}^\top\mathbf{v}.
$$

---

## 2. 외적(Cross Product) — $$\mathbb{R}^3$$ 전용 연산

### 2.1 대수적 정의
$$
\mathbf{a}\times\mathbf{b} \;=\;
\begin{bmatrix}
a_2 b_3 - a_3 b_2\\[4pt]
a_3 b_1 - a_1 b_3\\[4pt]
a_1 b_2 - a_2 b_1
\end{bmatrix}.
$$
또는
$$
\mathbf{a}\times\mathbf{b}
=
\begin{vmatrix}
\hat{\mathbf{i}} & \hat{\mathbf{j}} & \hat{\mathbf{k}}\\
a_1 & a_2 & a_3\\
b_1 & b_2 & b_3
\end{vmatrix}.
$$

### 2.2 기하적 의미(면적·방향)
- 크기(스칼라):
$$
\lVert\mathbf{a}\times\mathbf{b}\rVert \;=\; \lVert\mathbf{a}\rVert\,\lVert\mathbf{b}\rVert \sin\theta.
$$
이 값은 두 벡터가 이루는 **평행사변형의 면적**과 같습니다(삼각형 면적은 그 절반).
- 방향: 결과 벡터는 $$\mathbf{a},\mathbf{b}$$ 에 **둘 다 수직**이며, **오른손 법칙**을 따릅니다.

### 2.3 기본 성질
- 반대칭성: $$\mathbf{a}\times\mathbf{b}=-(\mathbf{b}\times\mathbf{a}).$$
- 분배법칙: $$\mathbf{a}\times(\mathbf{b}+\mathbf{c})=\mathbf{a}\times\mathbf{b}+\mathbf{a}\times\mathbf{c}.$$
- 스칼라 결합: $$(\alpha\mathbf{a})\times\mathbf{b}=\alpha(\mathbf{a}\times\mathbf{b}).$$
- 직교성: $$(\mathbf{a}\times\mathbf{b})\cdot\mathbf{a}=(\mathbf{a}\times\mathbf{b})\cdot\mathbf{b}=0.$$

### 2.4 벡터·스칼라 삼중곱과 부피
- 스칼라 삼중곱(정육면체 부피, 부호는 방향):
$$
[\mathbf{a},\mathbf{b},\mathbf{c}] \;\equiv\; \mathbf{a}\cdot(\mathbf{b}\times\mathbf{c})
\;=\; \det\big[\mathbf{a}\ \mathbf{b}\ \mathbf{c}\big].
$$
- 벡터 삼중곱(BAC–CAB 항등식):
$$
\mathbf{a}\times(\mathbf{b}\times\mathbf{c}) \;=\; \mathbf{b}(\mathbf{a}\cdot\mathbf{c}) - \mathbf{c}(\mathbf{a}\cdot\mathbf{b}).
$$

### 2.5 2차원에서의 “외적” 스칼라(z-성분)
2D 벡터 $$\mathbf{p}=(p_x,p_y),\ \mathbf{q}=(q_x,q_y)$$ 에 대해, 3D 로 확장하면
$$
\mathbf{p}\times\mathbf{q} \;=\; (0,0,\ p_x q_y - p_y q_x).
$$
따라서 2D의 유용한 스칼라는
$$
\operatorname{cross2}(\mathbf{p},\mathbf{q}) \;=\; p_x q_y - p_y q_x,
$$
이는 **방향성(좌/우회전) 테스트**, **다각형 면적(슈레이스 공식)** 등에 쓰입니다.

---

## 3. 내적과 외적의 비교 요약

| 항목 | 내적(Dot) | 외적(Cross) |
|---|---|---|
| 정의 차원 | 모든 $$n$$ 차원 | $$\mathbb{R}^3$$ (2D는 z-성분 스칼라를 자주 사용) |
| 결과 | 스칼라 | 벡터(3D) |
| 기하 의미 | 투영 크기, 각도, 유사도 | 면적 크기, 법선 방향 |
| 수직 판단 | $$\mathbf{a}\cdot\mathbf{b}=0$$ | 결과가 두 벡터 모두에 수직 |
| 대표 응용 | 정사영, 유사도, 에너지/일 | 회전축, 토크, 면적/부피, 법선 |

---

## 4. PyTorch 예제 — 내적

### 4.1 기본 내적, 각도, 정사영
```python
import torch
torch.set_printoptions(precision=4, sci_mode=False)

a = torch.tensor([3.0, 4.0])
b = torch.tensor([2.0, 1.0])

dot = torch.dot(a, b)  # a^T b
na, nb = torch.linalg.norm(a), torch.linalg.norm(b)
cos_th = (dot / (na * nb)).clamp(-1+1e-12, 1-1e-12)
theta = torch.arccos(cos_th)

proj_a_on_b = (dot / (b @ b)) * b  # (a^T b / b^T b) b

print("a·b =", float(dot))                  # 10.0
print("cosθ =", float(cos_th), "θ(rad) =", float(theta))
print("proj_b(a) =", proj_a_on_b)
```

### 4.2 행렬적 관점(Gram 행렬, 쌍별 내적)
```python
X = torch.tensor([[1., 2., 0.],
                  [0., 1., 3.]], dtype=torch.float32)  # 2 x 3, 두 벡터(열) a,b,c
G = X.T @ X     # Gram matrix: (a·a, a·b, ...)

print("Gram(X) =\n", G)
# G_ij = x_i · x_j, 대칭 양의준정치
```

---

## 5. PyTorch 예제 — 외적

### 5.1 기본 외적과 면적
```python
import torch

a = torch.tensor([1.0, 2.0, 3.0])
b = torch.tensor([4.0, 5.0, 6.0])

c = torch.cross(a, b)
area_parallelogram = torch.linalg.norm(c)           # ||a×b||
area_triangle      = 0.5 * area_parallelogram

print("a×b =", c)                                   # tensor([-3.,  6., -3.])
print("평행사변형 면적 =", float(area_parallelogram))
print("삼각형 면적 =", float(area_triangle))
print("직교성 검사 c·a, c·b =", float(torch.dot(c, a)), float(torch.dot(c, b)))
```

### 5.2 회전축과 각도(두 단위벡터 사이)
$$
\hat{\mathbf{u}}=\frac{\mathbf{u}}{\lVert\mathbf{u}\rVert},\quad
\hat{\mathbf{v}}=\frac{\mathbf{v}}{\lVert\mathbf{v}\rVert},\quad
\text{축 } \mathbf{k}=\frac{\hat{\mathbf{u}}\times\hat{\mathbf{v}}}{\lVert\hat{\mathbf{u}}\times\hat{\mathbf{v}}\rVert},\quad
\theta=\operatorname{atan2}\big(\lVert\hat{\mathbf{u}}\times\hat{\mathbf{v}}\rVert,\ \hat{\mathbf{u}}\cdot\hat{\mathbf{v}}\big).
$$

```python
import torch

def unit(v, eps=1e-12):
    n = torch.linalg.norm(v)
    return v / (n + eps)

u = torch.tensor([1., 0., 0.])
v = torch.tensor([0.3, 0.4, 0.8660254])  # 대략 60° 기울어진 방향(정규화 가정 X)
uh, vh = unit(u), unit(v)
cross_uv = torch.cross(uh, vh)
sin_th = torch.linalg.norm(cross_uv)
cos_th = (uh @ vh).clamp(-1+1e-12, 1-1e-12)
axis   = unit(cross_uv)  # 축 방향
theta  = torch.atan2(sin_th, cos_th)

print("axis ~", axis, "  theta(rad) ~", float(theta))
```

### 5.3 평면의 법선과 방정식(세 점으로부터)
세 점 $$\mathbf{p}_1,\mathbf{p}_2,\mathbf{p}_3$$ 가 주어지면
$$
\mathbf{n} \;=\; (\mathbf{p}_2-\mathbf{p}_1)\times(\mathbf{p}_3-\mathbf{p}_1),\quad
\text{평면: } \mathbf{n}^\top(\mathbf{x}-\mathbf{p}_1)=0.
$$

```python
import torch

p1 = torch.tensor([0., 0., 0.])
p2 = torch.tensor([1., 0., 0.])
p3 = torch.tensor([0., 1., 1.])

n = torch.cross(p2 - p1, p3 - p1)           # 법선
d = - (n @ p1)                               # n·x + d = 0 형태
print("법선 n =", n, " 평면식: n·x + d = 0, d =", float(d))
```

### 5.4 토크, 각운동량(물리 예)
$$
\boldsymbol{\tau} = \mathbf{r}\times\mathbf{F},\quad
\mathbf{L}=\mathbf{r}\times\mathbf{p}.
$$

```python
import torch

r = torch.tensor([0.0, 0.1, 0.0])     # m
F = torch.tensor([10.0, 0.0, 0.0])    # N

tau = torch.cross(r, F)               # N·m
print("토크 τ =", tau)
```

### 5.5 2D에서의 방향성 테스트와 면적(슈레이스)
삼각형 $$\triangle(\mathbf{a},\mathbf{b},\mathbf{c})$$ 의 부호 있는 면적:
$$
\operatorname{area}_{\pm}=\frac{1}{2}\big((\mathbf{b}-\mathbf{a})\times(\mathbf{c}-\mathbf{a})\big)_z
=\frac{1}{2}(b_x-a_x)(c_y-a_y)-\frac{1}{2}(b_y-a_y)(c_x-a_x).
$$

```python
import torch

def cross2(p, q):
    return p[0]*q[1] - p[1]*q[0]      # z-성분

a = torch.tensor([0., 0.])
b = torch.tensor([2., 1.])
c = torch.tensor([1., 3.])

area2 = 0.5 * cross2(b - a, c - a)    # 부호 포함 면적
print("부호 있는 삼각형 면적 =", float(area2))
print("좌회전/우회전:", "좌회전" if cross2(b - a, c - a) > 0 else "우회전/일직선")
```

---

## 6. 수치 안정성과 구현 팁

1. 각도 계산 시 `arccos` 입력은 반드시 $$[-1,1]$$ 범위로 클램핑:
   $$
   \cos\theta=\operatorname{clip}\Big(\frac{\mathbf{a}^\top\mathbf{b}}{\lVert\mathbf{a}\rVert\lVert\mathbf{b}\rVert},-1,1\Big).
   $$
2. 거의 평행한 벡터: $$\lVert\mathbf{a}\times\mathbf{b}\rVert$$ 가 매우 작아 **축 방향 불안정**. `atan2(||a×b||, a·b)` 사용이 더 안정적.
3. 정규화 시 영벡터 방지: $$\varepsilon$$ 로 분모 가드.
4. 큰/작은 값 혼재: 최대성분 스케일링 또는 float64 사용.
5. 배치 연산: PyTorch `torch.einsum`, `matmul`로 대량 내적/외적 최적화.

---

## 7. 실전 시나리오 모음

### 7.1 3D 메시의 면적과 면 법선 집계
- 각 삼각형 면적: $$\tfrac12\lVert(\mathbf{p}_2-\mathbf{p}_1)\times(\mathbf{p}_3-\mathbf{p}_1)\rVert.$$
- 면 법선(방향 일관) 누적 후 정규화하여 정점 법선 근사.

### 7.2 컴퓨터 비전/그래픽스: 카메라 자세
- 회전축–각(외적/내적)으로 두 좌표계 정렬.
- 필수 행렬의 에피폴라 제약은 내적/외적이 섞여 나타남.

### 7.3 머신러닝 임베딩
- 코사인 유사도는 **정규화 후 내적**. 대규모 검색에서 미리 정규화하여 행렬곱으로 가속.

### 7.4 로봇공학/제어
- 토크, 모멘트, 각속도/각운동량 관계를 외적으로 기술.
- 경사면 법선과 마찰 계산에서 외적 기반 법선 추출.

---

## 8. 내적·외적 종합 예제

다음은 한 번에 각도, 투영, 회전축/각, 삼각형 면적, 부피(삼중곱)를 계산하는 스니펫입니다.

```python
import torch
torch.set_printoptions(precision=5, sci_mode=False)

def unit(v, eps=1e-12):
    return v / (torch.linalg.norm(v) + eps)

# 벡터들
a = torch.tensor([3., 4., 0.])
b = torch.tensor([2., 1., 0.])
c = torch.tensor([1., 2., 3.])

# 1. 내적/각도/투영
dot = torch.dot(a, b)
cos_th = (dot / (torch.linalg.norm(a)*torch.linalg.norm(b))).clamp(-1+1e-12, 1-1e-12)
theta  = torch.arccos(cos_th)
proj_a_on_b = (dot / (b @ b)) * b

# 2. 외적/면적
axb = torch.cross(a, b)
area_parallelogram = torch.linalg.norm(axb)

# 3. 회전축과 각(단위벡터 버전)
ah, bh = unit(a), unit(b)
axis = unit(torch.cross(ah, bh))
sin_th = torch.linalg.norm(torch.cross(ah, bh))
cos_th2 = (ah @ bh).clamp(-1+1e-12, 1-1e-12)
theta2  = torch.atan2(sin_th, cos_th2)

# 4. 스칼라 삼중곱(부피 부호 포함)
triple = torch.dot(a, torch.cross(b, c))     # det[a b c]
volume_parallelepiped = abs(float(triple))

print("a·b =", float(dot), "  θ(rad) =", float(theta))
print("proj_b(a) =", proj_a_on_b)
print("|a×b| =", float(area_parallelogram))
print("axis ~", axis, "  θ'(rad) =", float(theta2))
print("삼중곱 =", float(triple), "  부피 =", volume_parallelepiped)
```

---

## 9. 흔한 실수와 체크리스트

- 내적과 행렬곱 혼동: 내적은 같은 길이 1차원 벡터에 대해 스칼라를 반환.
- 외적 차원 오류: `torch.cross` 는 마지막 차원 크기 3 이어야 함(2D 는 z-성분 스칼라를 직접 계산).
- 각도 계산에서 미세한 범위 외 값: 부동소수 오차로 인해 `clip` 필수.
- 거의 평행/정렬된 벡터에서 축 불안정: `atan2` 형태, SVD 기반 보정 고려.
- 스케일 문제: 정규화 또는 표준화로 비교/유사도 해석을 일관화.

---

## 10. 연습문제(힌트 포함)

1) 벡터 $$\mathbf{a}=[3,4]^\top,\ \mathbf{b}=[2,1]^\top$$ 에 대해
   $$\mathbf{a}\cdot\mathbf{b},\ \theta,\ \operatorname{proj}_{\mathbf{b}}(\mathbf{a})$$ 를 구하시오.
   힌트: 내적 공식과 정사영 공식을 그대로 적용.

2) $$\mathbb{R}^3$$ 의 $$\mathbf{a}=[1,2,3]^\top,\ \mathbf{b}=[4,5,6]^\top$$ 에 대해
   $$\mathbf{a}\times\mathbf{b}$$ 와 면적, 그리고 $$\mathbf{a},\mathbf{b}$$ 와의 직교성을 확인하시오.

3) 세 점 $$\mathbf{p}_1=(0,0,0),\ \mathbf{p}_2=(1,0,0),\ \mathbf{p}_3=(0,1,1)$$ 이 정하는 평면의 법선과 평면 방정식을 구하시오.
   힌트: $$(\mathbf{p}_2-\mathbf{p}_1)\times(\mathbf{p}_3-\mathbf{p}_1).$$

4) 2D 점 $$\mathbf{a}=(0,0),\ \mathbf{b}=(2,1),\ \mathbf{c}=(1,3)$$ 에 대해
   $$\tfrac12\,\operatorname{cross2}(\mathbf{b}-\mathbf{a},\mathbf{c}-\mathbf{a})$$ 로 부호 있는 삼각형 면적과 진행 방향(좌/우회전)을 판정하시오.

5) BAC–CAB 항등식 $$\mathbf{a}\times(\mathbf{b}\times\mathbf{c})=\mathbf{b}(\mathbf{a}\cdot\mathbf{c})-\mathbf{c}(\mathbf{a}\cdot\mathbf{b})$$ 을 증명하시오.
   힌트: 좌변을 성분 전개하거나 외적의 성질과 내적의 쌍선형성을 활용.

---

## 11. 요약

- 내적은 **크기·각도·투영**을 연결하며 모든 차원에서 정의됩니다.
- 외적은 **면적·법선·회전축**을 제공하며 $$\mathbb{R}^3$$ 에서 정의됩니다(2D 는 z-성분 스칼라 활용).
- 수치 계산에서는 **정규화, 클램핑, atan2, dtype 선택**으로 안정성을 확보합니다.
- 실무에서는 내적/외적이 **그래픽스, 로봇, 물리, 임베딩 검색** 전반의 핵심 연산입니다.
