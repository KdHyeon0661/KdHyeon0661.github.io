---
layout: post
title: Docker - exec vs attach
date: 2025-01-14 19:20:23 +0900
category: Docker
---
# ğŸŒ Docker ë„¤íŠ¸ì›Œí¬ ì‹¬í™” ì£¼ì œ

---

## ğŸ”— 1. macvlan + bridge ì—°ê²°

### ğŸ“Œ ë¬¸ì œ ìƒí™©

- macvlanì€ **ì»¨í…Œì´ë„ˆê°€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ IP**ë¥¼ ê°–ì§€ë§Œ,
- **í˜¸ìŠ¤íŠ¸ì™€ macvlan ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì´ ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.

> ì´ìœ : ê°™ì€ NICë¥¼ ê³µìœ í•˜ë©°, í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì´ ì°¨ë‹¨ë˜ê¸° ë•Œë¬¸  
â†’ `ARP broadcast` ì¶©ëŒì„ ë§‰ê¸° ìœ„í•œ ë³´ì•ˆ ì¡°ì¹˜

### ğŸ› ï¸ í•´ê²°ë²•: macvlan bridge êµ¬ì„±

```bash
# ê°€ìƒ macvlan ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ ìƒì„±
docker network create -d macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  -o macvlan_mode=bridge \
  my_macvlan
```

- `macvlan_mode=bridge`: ê°™ì€ NICë¼ë„ ë‚´ë¶€ í†µì‹  í—ˆìš©
- ì´ ì„¤ì •ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ â†” ì»¨í…Œì´ë„ˆ í†µì‹ ì´ ê°€ëŠ¥í•´ì§

### ğŸ§ª ì˜ˆì‹œ

```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d --name external-nginx \
  --network my_macvlan \
  --ip 192.168.1.100 \
  nginx
```

- ì´ì œ `192.168.1.100`ìœ¼ë¡œ **ì™¸ë¶€ ì¥ë¹„ + í˜¸ìŠ¤íŠ¸ ëª¨ë‘** ì ‘ê·¼ ê°€ëŠ¥
- `ping 192.168.1.100` â†’ OK

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

- `eth0`ì™€ macvlan ì‚¬ì´ì— **ì¤‘ë³µ IP**ê°€ ì—†ì–´ì•¼ í•¨
- **ì •ì  IP ê´€ë¦¬ í•„ìš”** (DHCP ì„¤ì • ì¶©ëŒ ë°©ì§€)
- ì¼ë¶€ ì‹œìŠ¤í…œì—ì„œëŠ” `promiscuous mode` ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ë„ ìˆìŒ

---

## ğŸŒ 2. Overlay + Consul ê¸°ë°˜ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

### ğŸ“Œ ë¬¸ì œ ìƒí™©

- DockerëŠ” í˜¸ìŠ¤íŠ¸ ê°„ ê¸°ë³¸ì ìœ¼ë¡œ **ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ì—†ìŒ**
- Overlay ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ì‹œ `Swarm`ì´ ì•„ë‹ˆë©´ ì´ë¦„ ê¸°ë°˜ í†µì‹ ì´ ì œí•œë¨

### âœ… í•´ê²°ì±…: Overlay + ì™¸ë¶€ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ (ì˜ˆ: Consul)

---

### ğŸ§  Consulë€?

> HashiCorpì—ì„œ ë§Œë“  **ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ & í‚¤/ê°’ ì €ì¥ì†Œ ì‹œìŠ¤í…œ**

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| DNS ì§€ì› | ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ DNS ì‘ë‹µ (`web.service.consul`) |
| Health Check | ë¹„ì •ìƒ ì»¨í…Œì´ë„ˆ ì œì™¸ |
| ë™ì  ë“±ë¡ | ì»¨í…Œì´ë„ˆê°€ Consulì— ìì‹ ì„ ìë™ ë“±ë¡ ê°€ëŠ¥ |

---

### ğŸ”§ êµ¬ì„± ê°œìš”

1. Consul ì„œë²„ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
2. Docker ì»¨í…Œì´ë„ˆê°€ Consul ì—ì´ì „íŠ¸ë¡œ ë“±ë¡
3. Overlay ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„œë¹„ìŠ¤ë¼ë¦¬ **Consulì„ í†µí•´ ì´ë¦„ìœ¼ë¡œ í†µì‹ **

---

### ğŸ§ª ì˜ˆì‹œ êµ¬ì„± (Docker Compose ê¸°ë°˜)

```yaml
version: '3.7'
services:
  consul:
    image: consul
    command: agent -server -bootstrap -ui -client=0.0.0.0
    ports:
      - "8500:8500"
    networks:
      - overlay-net

  web:
    image: nginx
    networks:
      - overlay-net
    environment:
      - SERVICE_NAME=web
    depends_on:
      - consul

networks:
  overlay-net:
    external: true
```

- Consul UI â†’ http://localhost:8500
- `web` ì„œë¹„ìŠ¤ê°€ `SERVICE_NAME=web` ìœ¼ë¡œ Consulì— ë“±ë¡ë¨

---

### ğŸ› ï¸ DNS ì‚¬ìš© ì˜ˆ

ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ:

```bash
curl http://web.service.consul:80
```

- Consul DNSê°€ `.service.consul` ë„ë©”ì¸ì„ ì‘ë‹µí•´ì¤Œ
- ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `/etc/resolv.conf`ì— Consul DNS ì£¼ì†Œ ë“±ë¡ í•„ìš”

---

### ğŸ” ë³´ì•ˆ íŒ

- ACL, TLS ì„¤ì •ìœ¼ë¡œ Consul ë³´ì•ˆ ê°•í™”
- ì„œë¹„ìŠ¤ ê°„ ì¸ì¦ì€ Consul Connect + Envoy proxy ë“± í™œìš© ê°€ëŠ¥

---

## ğŸ“‹ ìš”ì•½ ë¹„êµ

| ì£¼ì œ | ëª©ì  | íŠ¹ì§• | í™œìš©ë„ |
|------|------|------|--------|
| macvlan + bridge | ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ IPë¥¼ ê°–ë˜ í˜¸ìŠ¤íŠ¸ì™€ë„ í†µì‹  | MAC/IP ë¶„ë¦¬ | IoT, ì‚¬ì„¤ë§ |
| overlay + consul | ë‹¤ì¤‘ í˜¸ìŠ¤íŠ¸ ê°„ DNS ê¸°ë°˜ í†µì‹  | Swarm ì—†ì´ ì´ë¦„ í•´ì„ | í´ëŸ¬ìŠ¤í„°, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Docker macvlan ê³µì‹ ë¬¸ì„œ](https://docs.docker.com/network/macvlan/)
- [HashiCorp Consul ê³µì‹ ì‚¬ì´íŠ¸](https://www.consul.io/)
- [Docker + Consul DNS ì˜ˆì œ](https://learn.hashicorp.com/tutorials/consul/docker-container-networking)