---
layout: post
title: 컴퓨터시스템 - 캐싱 도구로서의 VM
date: 2025-08-16 21:20:23 +0900
category: 컴퓨터시스템
---
# VM(가상 메모리, Virtual Memory) — 캐싱 도구로서의 역할

가상 메모리(Virtual Memory, VM)는 단순히 **물리 메모리를 확장**하는 기술이 아니라, **캐싱 메커니즘**으로도 작동합니다.  
운영체제(OS)는 VM을 이용해 **자주 접근하는 데이터나 코드**를 빠른 저장 장치(DRAM)에 유지하고,  
덜 사용되는 데이터는 느린 저장 장치(디스크)로 옮겨 성능과 메모리 활용 효율을 높입니다.

---

## 1. VM의 캐싱 관점

- **기본 개념**:  
  VM은 **디스크를 백스토어(back store)**로 하고, **DRAM을 캐시(cache)**처럼 사용하는 구조입니다.
- DRAM은 용량이 제한적이지만 속도가 매우 빠름 → 자주 쓰는 페이지를 DRAM에 유지.
- 디스크(HDD/SSD)는 속도는 느리지만 용량이 큼 → 덜 쓰는 페이지를 저장.
- 페이지 교체 알고리즘이 **캐시 교체 정책**과 동일한 역할 수행 (LRU, CLOCK 등).

---

## 2. 페이지 단위 캐싱

- **페이지(Page)**: 가상 메모리와 물리 메모리 간 전송의 기본 단위(보통 4KB).
- DRAM은 전체 주소 공간의 일부만 보유 → 나머지는 디스크에 위치.
- **페이지 히트(Page Hit)**: 접근하려는 페이지가 DRAM에 존재.
- **페이지 폴트(Page Fault)**: 접근하려는 페이지가 DRAM에 없어서 디스크에서 로드.

---

## 3. VM 캐싱의 3단계 계층 구조

| 계층 | 속도 | 역할 |
|------|------|------|
| CPU 캐시(L1/L2/L3) | 나노초(ns) | DRAM 내용을 CPU 가까이 캐싱 |
| DRAM (주 메모리) | 마이크로초(μs) | 가상 메모리 페이지의 캐시 역할 |
| 디스크(SSD/HDD) | 밀리초(ms) | 백스토어(원본 저장소) |

즉, VM은 **"메모리 안의 메모리"** 개념을 도입하여 DRAM을 디스크의 캐시처럼 활용합니다.

---

## 4. 페이지 교체 알고리즘과 캐싱 전략

- **LRU (Least Recently Used)**: 가장 오래 사용되지 않은 페이지 제거.
- **Clock 알고리즘**: LRU 근사.
- **Working Set Model**: 프로세스가 일정 시간 동안 사용하는 페이지 집합 유지.
- 이러한 알고리즘들은 CPU 캐시에서 사용하는 교체 정책과 매우 유사.

---

## 5. 쓰기 정책 (Write Policy)

VM의 캐싱 성능에는 **쓰기 정책**도 큰 영향:
- **Write-Through**: 변경된 페이지를 즉시 디스크에 기록 (안전하지만 느림).
- **Write-Back**: 페이지를 DRAM에서만 변경하다가 교체 시 디스크에 기록 (성능 ↑, 복잡성 ↑).
- 대부분의 VM 구현은 Write-Back + Dirty Bit 관리.

---

## 6. 지역성과 VM 캐싱

VM 캐싱 효율은 **지역성(Locality)** 원리에 크게 의존:
1. **시간 지역성(Temporal Locality)**: 최근에 접근한 페이지를 다시 접근할 가능성 ↑.
2. **공간 지역성(Spatial Locality)**: 접근한 주소 근처 페이지를 곧 접근할 가능성 ↑.
- OS는 페이지 크기, 교체 정책을 설계할 때 이 지역성 특성을 고려.

---

## 7. 성능과 병목 현상

- DRAM과 디스크 속도 차이가 크기 때문에, **페이지 폴트율**을 최소화하는 것이 핵심.
- SSD 사용 시 HDD 대비 페이지 폴트 비용이 낮아지지만, 여전히 DRAM보다 느림.
- VM 튜닝 시 고려 요소:
  - **스와핑(Swapping) 최소화**: 과도한 페이지 교체 방지.
  - **메모리 압축**: DRAM 내 페이지 압축해 공간 확보.
  - **NUMA 최적화**: 여러 메모리 노드 간 접근 지연 최소화.

---

## 8. 실습 예시: Linux `vmstat`

리눅스에서 VM 캐싱 동작을 관찰:
```bash
vmstat 1
```
출력 예:
```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 102400  20480 256000    0    0     5     1  100  200  5  1 94  0  0
```
- **si/so**: swap in/out 속도 (디스크 ↔ DRAM 페이지 전송).
- **cache**: 파일 시스템 캐시뿐 아니라 VM 페이지 캐싱 포함.

---

## 9. 요약

- VM은 **디스크와 DRAM 사이의 캐싱 계층**을 제공.
- DRAM은 디스크의 "핫 페이지"를 저장해 빠른 접근 가능.
- 페이지 교체, 쓰기 정책, 지역성 최적화가 성능 핵심.
- VM 캐싱은 CPU 캐시 설계 원리와 유사하지만, 전송 단위·속도·비용이 다름.