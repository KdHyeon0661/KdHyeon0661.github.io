---
layout: post
title: Kubernetes - Health Check
date: 2025-04-27 21:20:23 +0900
category: Kubernetes
---
# Kubernetes Health Check ì´í•´í•˜ê¸°  
## Liveness Probe vs Readiness Probe

KubernetesëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ìƒíƒœë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì²´í¬**í•´ì„œ  
ì •ìƒì¸ì§€ ì•„ë‹Œì§€ë¥¼ íŒë‹¨í•˜ê³  ìë™ìœ¼ë¡œ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

ì´ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ **Probe(í”„ë¡œë¸Œ)**ì…ë‹ˆë‹¤.

---

## âœ… 1. Probeë€?

**Probe**ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ **ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ ì²´í¬**í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

Kubernetesì—ëŠ” ë‹¤ìŒ 3ê°€ì§€ ì¢…ë¥˜ì˜ í”„ë¡œë¸Œê°€ ìˆìŠµë‹ˆë‹¤:

| ì¢…ë¥˜ | ì„¤ëª… |
|------|------|
| **Liveness Probe** | ì»¨í…Œì´ë„ˆê°€ **ì‚´ì•„ìˆëŠ”ì§€(ì£½ì—ˆëŠ”ì§€)** í™•ì¸ |
| **Readiness Probe** | ì»¨í…Œì´ë„ˆê°€ **ì„œë¹„ìŠ¤ë¥¼ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€** í™•ì¸ |
| **Startup Probe** | ì»¨í…Œì´ë„ˆê°€ **ì‹œì‘ë˜ëŠ” ë° ì˜¤ë˜ ê±¸ë¦´ ë•Œ** ì²´í¬ (ì„ íƒì ) |

---

## âœ… 2. Liveness Probe: ì‚´ì•„ìˆëŠ”ê°€?

### ğŸ’¡ ëª©ì   
ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **ì‘ë‹µì€ ë©ˆì·„ì§€ë§Œ, í”„ë¡œì„¸ìŠ¤ëŠ” ì£½ì§€ ì•Šì€ ìƒíƒœ**ë¥¼ ê°ì§€í•˜ì—¬  
Kubernetesê°€ **ì»¨í…Œì´ë„ˆë¥¼ ìë™ìœ¼ë¡œ ì¬ì‹œì‘**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

> ì˜ˆ: ì„œë²„ê°€ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œ ë©ˆì·„ëŠ”ë° OS ë ˆë²¨ì—ì„œëŠ” ì‚´ì•„ìˆì„ ë•Œ

### âœ… ì˜ˆì œ: HTTP ì²´í¬ ë°©ì‹

```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
  failureThreshold: 3
```

- `initialDelaySeconds`: ì‹œì‘ í›„ ëª‡ ì´ˆ ë’¤ë¶€í„° ì²´í¬í• ì§€
- `periodSeconds`: ëª‡ ì´ˆë§ˆë‹¤ ì²´í¬í• ì§€
- `failureThreshold`: ëª‡ ë²ˆ ì—°ì† ì‹¤íŒ¨í•˜ë©´ ì£½ì€ ê²ƒìœ¼ë¡œ ê°„ì£¼í• ì§€

â†’ `/healthz` ê²½ë¡œê°€ 3ë²ˆ ì—°ì† ì‹¤íŒ¨í•˜ë©´ `kubectl describe pod`ì—ì„œ ì´ë²¤íŠ¸ í™•ì¸ ê°€ëŠ¥  
â†’ ì»¨í…Œì´ë„ˆ ìë™ ì¬ì‹œì‘ë¨

---

## âœ… 3. Readiness Probe: ì¤€ë¹„ë˜ì—ˆëŠ”ê°€?

### ğŸ’¡ ëª©ì   
ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **ìš”ì²­ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸**í•˜ê³ ,  
ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë‹¤ë©´ **Serviceì—ì„œ íŠ¸ë˜í”½ì„ ì°¨ë‹¨**í•©ë‹ˆë‹¤.

> ì¦‰, **íŠ¸ë˜í”½ì„ ë°›ì„ì§€ ì—¬ë¶€ ê²°ì •** = Load Balancer ì—°ê²° ì—¬ë¶€

### âœ… ì˜ˆì œ: TCP ë°©ì‹

```yaml
readinessProbe:
  tcpSocket:
    port: 3306
  initialDelaySeconds: 5
  periodSeconds: 10
```

â†’ ì»¨í…Œì´ë„ˆê°€ í¬íŠ¸ 3306ì—ì„œ ì‘ë‹µí•˜ì§€ ì•Šìœ¼ë©´ í•´ë‹¹ Podìœ¼ë¡œ íŠ¸ë˜í”½ì„ ë³´ë‚´ì§€ ì•ŠìŒ

---

## âœ… 4. Startup Probe (ì„ íƒ)

ì»¨í…Œì´ë„ˆê°€ **ê¸°ë™ ì†ë„ê°€ ëŠë¦´ ë•Œ** ì‚¬ìš©í•˜ëŠ” ì¶”ê°€ì ì¸ Probeì…ë‹ˆë‹¤.  
`startupProbe`ê°€ ì„±ê³µí•  ë•Œê¹Œì§€ëŠ” `livenessProbe`ì™€ `readinessProbe`ê°€ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```yaml
startupProbe:
  httpGet:
    path: /startup
    port: 8080
  failureThreshold: 30
  periodSeconds: 5
```

â†’ 150ì´ˆ(= 30Ã—5ì´ˆ) ë™ì•ˆ `/startup` ì„±ê³µì„ ê¸°ë‹¤ë¦¼

---

## âœ… 5. ì‹¤í–‰ ë°©ì‹

KubernetesëŠ” ì•„ë˜ 3ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ Probeë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ë°©ì‹ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `httpGet` | HTTP ìš”ì²­ ë³´ëƒ„ | `/health`, `/ready` |
| `tcpSocket` | TCP í¬íŠ¸ ì˜¤í”ˆ ì—¬ë¶€ í™•ì¸ | `3306`, `6379` |
| `exec` | ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ëª…ë ¹ ì‹¤í–‰ | `["cat", "/tmp/ready"]` |

---

## âœ… 6. ì „ì²´ YAML ì˜ˆì‹œ

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: probe-demo
spec:
  containers:
  - name: app
    image: myapp:latest
    ports:
    - containerPort: 8080
    livenessProbe:
      httpGet:
        path: /healthz
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 5
      failureThreshold: 3
    readinessProbe:
      httpGet:
        path: /ready
        port: 8080
      initialDelaySeconds: 5
      periodSeconds: 5
      failureThreshold: 2
```

---

## âœ… 7. Liveness vs Readiness ë¹„êµ

| í•­ëª© | Liveness Probe | Readiness Probe |
|------|----------------|-----------------|
| ëª©ì  | ì»¨í…Œì´ë„ˆê°€ **ì£½ì—ˆëŠ”ì§€** ê°ì§€ | ì»¨í…Œì´ë„ˆê°€ **ìš”ì²­ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€** í™•ì¸ |
| ì‹¤íŒ¨ ì‹œ | ì»¨í…Œì´ë„ˆ **ì¬ì‹œì‘** | Serviceì—ì„œ **ì œì™¸** (íŠ¸ë˜í”½ ì°¨ë‹¨) |
| ì˜í–¥ | í”„ë¡œì„¸ìŠ¤ ë¦¬ì…‹ | ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë§Œ ëŠê¹€ |
| ì˜ˆì‹œ | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, ë°ë“œë½ | DB ì—°ê²° ëŒ€ê¸°, ìºì‹œ ë¡œë”© ë“± |

---

## âœ… 8. í…ŒìŠ¤íŠ¸ ë°©ë²•

### Liveness ì‹œë®¬ë ˆì´ì…˜

```bash
kubectl describe pod <pod-name>
# "Liveness probe failed" ë¡œê·¸ í™•ì¸
```

### ë™ì‘ í™•ì¸

```bash
kubectl get endpoints <service-name>
```

â†’ Readinessê°€ falseë©´ endpointì—ì„œ ì œì™¸ë¨

---

## âœ… 9. ì‹¤ì œ ìš´ì˜ ì‹œ íŒ

- Liveness ProbeëŠ” **ë„ˆë¬´ ë¹ ë¥´ê²Œ ì‹¤íŒ¨ ì²˜ë¦¬í•˜ë©´ ìœ„í—˜** (ex: GC ì¤‘ì¸ ì•±ì´ ì£½ìŒìœ¼ë¡œ íŒë‹¨ë  ìˆ˜ ìˆìŒ)
- Readiness ProbeëŠ” **íŠ¸ë˜í”½ ìœ ì… ì „ ì„¤ì • í•„ìˆ˜**
- `exec`ëŠ” ë¹„ìš©ì´ ë†’ìœ¼ë¯€ë¡œ HTTP ë˜ëŠ” TCP ë°©ì‹ ê¶Œì¥
- Spring Boot, Express ë“±ì—ì„œëŠ” `/actuator/health`, `/readyz`, `/livez` ë“± ì—”ë“œí¬ì¸íŠ¸ í™œìš© ê°€ëŠ¥
- `failureThreshold`ì™€ `periodSeconds`ë¥¼ ì¡°í•©í•´ **ì‹œê°„ ë²„í¼ í™•ë³´**

---

## âœ… ê²°ë¡ 

Kubernetesì—ì„œ **Liveness**ì™€ **Readiness**ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒì¡´ì„±ê³¼ ì¤€ë¹„ ìƒíƒœë¥¼ ì²´í¬í•˜ì—¬  
ë³´ë‹¤ **íƒ„ë ¥ì ì´ê³  ì•ˆì •ì ì¸ ë°°í¬ í™˜ê²½**ì„ êµ¬ì¶•í•˜ëŠ” ë° í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.

| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ìš© í”„ë¡œë¸Œ |
|----------|--------------|
| ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¨¹í†µì´ì§€ë§Œ ì£½ì§„ ì•ŠìŒ | âœ… Liveness |
| DB ì—°ê²° ë“± ì™¸ë¶€ ì˜ì¡´ì„± ëŒ€ê¸° ì¤‘ | âœ… Readiness |
| ì‹œì‘ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì•± | âœ… Startup |