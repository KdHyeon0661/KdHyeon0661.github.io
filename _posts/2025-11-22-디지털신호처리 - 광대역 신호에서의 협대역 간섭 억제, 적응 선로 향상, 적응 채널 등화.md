---
layout: post
title: 디지털신호처리 - 광대역 신호에서의 협대역 간섭 억제, 적응 선로 향상, 적응 채널 등화
date: 2025-11-22 17:25:23 +0900
category: 디지털신호처리
---
# 적응 필터 응용 2 — 광대역 신호에서의 협대역 간섭 억제, 적응 선로 향상(ALE), 적응 채널 등화 (GNU Octave)

이번 글은 앞에서 정리한 **적응 FIR + LMS/NLMS 기본기**를 그대로 가져와, 실제 통신/레이다/오디오/계측에서 자주 나오는 세 가지 응용으로 확장한다.

1) **광대역(broadband) 신호에 섞인 협대역(narrowband) 간섭 억제**
2) **적응 선로 향상(Adaptive Line Enhancement, ALE)**
3) **적응 채널 등화(Adaptive Channel Equalization)**

세 응용은 겉보기엔 달라 보이지만, 공통적으로

- **필터 출력 \(y[n]=\mathbf{w}^T\mathbf{x}[n]\)**
- **오차 \(e[n]=d[n]-y[n]\)**
- **LMS 업데이트 \(\mathbf{w}[n+1]=\mathbf{w}[n]+\mu e[n]\mathbf{x}[n]\)**

---

## 0) 공통 준비: 적응 FIR + LMS 기본

적응 FIR(탭 수 \(M+1\)):

$$
\mathbf{x}[n]=[x[n],x[n-1],\dots,x[n-M]]^T,\quad
y[n]=\mathbf{w}^T[n]\mathbf{x}[n]
$$

목표 신호 \(d[n]\)과의 오차:

$$
e[n]=d[n]-y[n]
$$

LMS:

$$
\mathbf{w}[n+1]=\mathbf{w}[n]+\mu e[n]\mathbf{x}[n]
$$

안정 조건(평균 안정):

$$
0<\mu<\frac{2}{\lambda_{\max}(\mathbf{R})}
$$

입력 파워 기반 근사:

$$
\mu \lesssim \frac{1}{(M+1)P_x},\quad P_x=\mathbb{E}\{x^2[n]\}
$$

입력이 컬러드/파워 변동이 크면 **NLMS**가 실무 표준:

$$
\mathbf{w}[n+1]
=\mathbf{w}[n]+\frac{\mu}{\delta+\|\mathbf{x}[n]\|^2}\,e[n]\mathbf{x}[n]
$$

이제 이 기본 블록을 세 문제에 “어디에 꽂느냐”가 관건이다.

---

## 1) 광대역 신호에서의 협대역 간섭 억제

### 문제 상황과 신호 모델

**광대역 신호** \(s[n]\)는 넓은 주파수 대역을 차지한다.
예: 스펙트럼이 넓은 통신 신호, 레이다 펄스 압축 신호, 오디오·진동 신호 등.

여기에 **협대역 간섭** \(i[n]\)가 섞인다.
예: 전원(50/60 Hz) 험, 특정 톤 간섭, 협대역 재머, 캐리어 유출 등.

관측:

$$
d[n] = s[n] + i[n] + v[n]
$$

- \(s[n]\): 원하는 광대역 성분
- \(i[n]\): 얇은 대역의 강한 톤/AM/FM 간섭
- \(v[n]\): 추가 백색 잡음

목표: **\(i[n]\)만 제거하고 \(s[n]\)는 최대한 보존**.

---

### 해법 A: 적응 노이즈 캔슬러(ANC, reference가 있는 경우)

협대역 간섭과 **상관된 참조 입력** \(x[n]\)을 얻을 수 있을 때 가장 강력하다.

- 참조 \(x[n]\): 간섭원이 만든 “간섭만의 버전”
  - 예: 다른 센서가 간섭을 더 강하게 보는 경우
  - 예: 송신기 로컬 오실레이터 누설을 직접 측정한 경우
  - 예: 다중 안테나에서 재머를 기준 채널로 잡는 경우

구조:

```text
x[n] ─▶(적응 FIR w)──▶ y[n] ≈ i[n]
                           │
d[n]=s+i+v ────────────────┼─▶ e[n]=d[n]-y[n] ≈ s[n]+v[n]
                           │
                        w 업데이트(LMS/NLMS)
```

수식:

$$
y[n]=\mathbf{w}^T[n]\mathbf{x}[n],\quad
e[n]=d[n]-y[n]
$$

적응이 수렴하면 \(y[n]\to i[n]\), 그래서 \(e[n]\)에 원하는 신호가 남는다.

---

### 해법 B: 참조가 없을 때 — 적응 노치(Adaptive Notch) / ALE 계열

참조가 없으면 **간섭이 “협대역이라 예측 가능”하다는 특성**을 쓴다.

- 협대역 톤은 자기상관이 **길게 유지**됨
- 광대역 잡음/신호는 **지연하면 빠르게 비상관화**됨

이 생각을 구조화한 것이 **ALE(§2)**이고,
노치 필터 관점으로 보면 “간섭 주파수에 자동으로 골을 파는 적응 노치”가 된다.

---

### Octave 예제 1: ANC로 협대역 톤 제거

**상황**
- 원하는 신호: 광대역(대역 제한된) 잡음
- 간섭: 1 kHz 강한 사인 톤
- 참조 \(x[n]\): 간섭 톤 + 약간의 잡음 (실무적 가정)
- NLMS로 학습하여 간섭을 예측하고 빼기

```octave
clear; close all; clc; pkg load signal

Fs = 8000;                 % 샘플링 주파수
N  = 40000;
n  = (0:N-1)';

% (1) 원하는 광대역 신호 s[n] : 대역 제한 잡음
u  = randn(N,1);
b_lp = fir1(128, 0.6);     % 0~0.6*Nyq 구간에 넓게 퍼진 신호
s  = filter(b_lp, 1, u);
s  = s / std(s);

% (2) 협대역 간섭 i[n]
fi = 1000;                 % 1 kHz 톤
i  = 2.0*sin(2*pi*fi*n/Fs);  % 신호보다 강한 간섭

% (3) 관측 d[n]
v  = 0.05*randn(N,1);
d  = s + i + v;

% (4) 참조 x[n] (간섭과 높은 상관)
x_ref = i + 0.2*randn(N,1);

% (5) NLMS ANC
M = 64;                    % 적응 필터 탭 수 = M+1
mu = 0.8; delta=1e-3;

w = zeros(M+1,1);
y = zeros(N,1);
e = zeros(N,1);

for k=M+1:N
  xvec = x_ref(k:-1:k-M);
  y(k) = w'*xvec;
  e(k) = d(k) - y(k);
  w = w + (mu/(delta + xvec'*xvec))*e(k)*xvec;
end

% (6) 스펙트럼 비교
Lfft = 8192;
D = fft(d(end-Lfft+1:end) .* hann(Lfft), Lfft);
E = fft(e(end-Lfft+1:end) .* hann(Lfft), Lfft);
f = (0:Lfft-1)/Lfft*Fs;

figure;
plot(f,20*log10(abs(D)+1e-12)); hold on;
plot(f,20*log10(abs(E)+1e-12),'r');
xlim([0 Fs/2]); grid on;
legend("Before ANC (d)","After ANC (e)");
title("Narrowband Interference Suppression by NLMS ANC");
ylabel("Magnitude (dB)"); xlabel("Hz");
```

**관찰 포인트**
- \(d[n]\) 스펙트럼에는 1 kHz에서 큰 스파이크가 있음
- \(e[n]\) 스펙트럼에서는 그 스파이크가 크게 낮아짐
- 광대역 성분은 상대적으로 유지

---

### 실무 파라미터 팁

1. **필터 차수 \(M\)**
   - 참조 경로(간섭 → 참조 센서)의 임펄스 길이 이상
   - 너무 크면 수렴 느려짐, 너무 작으면 잔류 간섭

2. **μ 선택**
   - NLMS는 보통 \(0.1\sim1.0\)에서 안정적
   - 간섭이 시간에 변하면 μ를 약간 키워 **트래킹** 강화

3. **참조 품질**
   - 참조가 간섭과 상관이 낮으면(=오염되면) 성능 급락
   - 실무에선 참조 SNR을 확보하는 하드웨어 설계가 중요

---

## 2) 적응 선로 향상(ALE)

ALE는 **참조가 없는 상황**에서 협대역 성분을 뽑거나 간섭을 억제할 때 쓰는 대표 구조다.

### 기본 아이디어

관측 신호:

$$
x[n]=s[n]+v[n]
$$

여기서

- \(s[n]\): 협대역(또는 선로(line) 성분)
- \(v[n]\): 광대역 잡음

ALE는 “지연된 자기 자신”으로 \(x[n]\)을 예측한다.

- 지연 \(D\)를 주면
  - 협대역 \(s[n]\)는 여전히 **상관이 높음**
  - 광대역 \(v[n]\)는 **상관이 거의 0**

그래서 적응 필터가 예측한 성분은 **협대역 위주**로 남는다.

---

### ALE 구조

```text
x[n] ────────────────┐
                     ▼
                   (+)──▶ e[n]  (광대역 잡음 쪽)
                     ▲
x[n-D] ─▶(적응 FIR w)─┘
          y[n]≈협대역 s[n]
```

- 입력 벡터는 지연된 샘플들:

$$
\mathbf{x}_D[n]=[x[n-D],x[n-D-1],...,x[n-D-M]]^T
$$

- 출력/오차:

$$
y[n]=\mathbf{w}^T[n]\mathbf{x}_D[n],\quad
e[n]=x[n]-y[n]
$$

수렴하면 \(y[n]\to s[n]\), \(e[n]\to v[n]\).

---

### ALE가 잘 되기 위한 조건

1. **\(D\) 선택:**
   - \(D\)는 광대역 잡음의 상관 길이보다 커야 한다.
   - 협대역 성분의 상관은 유지되는 범위여야 한다.
   - 직관적으로 “잡음은 잊고, 톤은 기억하는” 지연 길이.

2. **탭 수 \(M\):**
   - 협대역 성분의 대역폭이 좁을수록 더 큰 \(M\)이 유리
   - 너무 크면 수렴 속도 저하

3. **μ:**
   - 시간이 변하는 톤이면 μ↑(트래킹), 고정 톤이면 μ↓(정밀)

---

### Octave 예제 2: ALE로 협대역 신호 추출

**상황**
- 협대역 성분: 700 Hz 톤(약한 진폭)
- 광대역 잡음: 강한 백색잡음
- ALE로 톤만 강화

```octave
clear; close all; clc; pkg load signal

Fs=8000; N=30000; n=(0:N-1)';

% 협대역 성분 s[n] (약한 톤)
f0=700;
s=0.3*sin(2*pi*f0*n/Fs);

% 광대역 잡음 v[n]
v=1.0*randn(N,1);

x=s+v;

% ALE 파라미터
D=20;            % 지연
M=64;            % 필터 차수
mu=0.01;

w=zeros(M+1,1);
y=zeros(N,1); e=zeros(N,1);

for k=D+M+1:N
  xvec = x(k-D:-1:k-D-M);
  y(k) = w'*xvec;          % 추정된 협대역 성분
  e(k) = x(k) - y(k);      % 잔차(광대역)
  w = w + mu*e(k)*xvec;
end

% 스펙트럼 비교
Lfft=8192;
X=fft(x(end-Lfft+1:end).*hann(Lfft),Lfft);
Y=fft(y(end-Lfft+1:end).*hann(Lfft),Lfft);
f=(0:Lfft-1)/Lfft*Fs;

figure;
plot(f,20*log10(abs(X)+1e-12)); hold on;
plot(f,20*log10(abs(Y)+1e-12),'r');
xlim([0 Fs/2]); grid on;
legend("Input x","ALE output y (enhanced line)");
title("Adaptive Line Enhancement");
ylabel("Magnitude (dB)"); xlabel("Hz");
```

**관찰 포인트**
- 입력 \(x\) 스펙트럼에서는 700 Hz 톤이 잡음 바닥에 묻힘
- 출력 \(y\)에서는 700 Hz 부근이 **눈에 띄게 솟아오름**
- 즉 “선로(line) 성분 강화”가 구현됨

---

### ALE ↔ 협대역 간섭 억제의 양면성

ALE 출력 \(y[n]\)는 **협대역을 강화**한다.
그러면

- 협대역이 “원하는 신호”면 → \(y[n]\) 사용
- 협대역이 “간섭”이면 → \(e[n]\) 사용 (톤이 제거된 광대역만 남음)

즉 ALE는 “참조 없는 협대역 분리기”로 이해하면 된다.

---

## 3) 적응 채널 등화(Adaptive Equalization)

### 문제 상황

통신/저장 채널은 멀티패스/대역 제한 때문에 **ISI(Inter-Symbol Interference)**를 만든다.

이산 베이스밴드 채널:

$$
r[n] = \sum_{k=0}^{L_h} h[k]\,s[n-k] + v[n]
     = \mathbf{h}^T\mathbf{s}[n] + v[n]
$$

- \(s[n]\): 전송 심볼
- \(h[k]\): 채널 임펄스 응답(미지)
- \(r[n]\): 수신
- \(v[n]\): 잡음

목표: 등화기 \(w\)를 적응시켜

$$
y[n] = \mathbf{w}^T\mathbf{r}_v[n]\approx s[n-\ell]
$$

즉, 채널의 역특성을 학습해서 ISI를 제거.

---

### 선형 트랜스버설 등화기 구조

입력 벡터:

$$
\mathbf{r}_v[n]=[r[n],r[n-1],...,r[n-M]]^T
$$

출력:

$$
y[n]=\mathbf{w}^T[n]\mathbf{r}_v[n]
$$

훈련 구간(training)에서는 송신 심볼을 알고 있으므로

$$
d[n]=s[n-\ell]
$$

로 두고 LMS/NLMS로 학습한다.

훈련 이후에는 **결정지향(Decision-Directed)**으로

$$
d[n]=\hat{s}[n-\ell]=\mathrm{decide}(y[n])
$$

로 돌려 트래킹한다.

---

### 등화기 탭 위치(지연 \(\ell\))

등화기는 전체 채널+등화기 응답이 “원 심볼 하나 + 작은 잔류”가 되도록 해야 한다.

- \(\ell\)을 잘못 잡으면 주탭이 옆으로 밀려
  수렴이 느리거나 오차 바닥이 커질 수 있음

실무에서는 훈련 구간 중 **최대 피크 위치**를 찾아 \(\ell\)로 둔다.

---

### Octave 예제 3: BPSK 채널에서 LMS 등화

**상황**
- BPSK 심볼 전송
- 3탭 멀티패스 채널
- 훈련 구간으로 학습 후 결정지향으로 유지
- 등화 전후 BER/ISI 비교

```octave
clear; close all; clc; pkg load signal

Fs = 1; N = 20000;                   % 심볼 샘플링(1샘플/심볼)
trainN = 4000;

% (1) BPSK 송신 심볼
s = 2*(rand(N,1)>0.5)-1;             % ±1

% (2) 미지 채널(멀티패스)
h = [0.9, 0.5, -0.3]';               % ISI 유발 채널
r_clean = filter(h,1,s);

% (3) 잡음 추가
snr_db = 15;
Ps = mean(r_clean.^2);
sigma2 = Ps/10^(snr_db/10);
v = sqrt(sigma2)*randn(N,1);
r = r_clean + v;

% (4) 선형 LMS 등화기
M = 8;                               % 등화기 차수(9탭)
mu = 0.01;
w = zeros(M+1,1);
y = zeros(N,1); e = zeros(N,1);

% 지연(주탭) 선택: 여기선 채널 길이를 감안해 2로 둠
ell = 2;

for n=M+1:N
  rvec = r(n:-1:n-M);
  y(n) = w'*rvec;

  if n <= trainN
    d = s(n-ell);                    % training
  else
    d = sign(y(n));                  % decision-directed
  end

  e(n) = d - y(n);
  w = w + mu*e(n)*rvec;
end

% (5) BER 계산 (훈련 이후 구간)
y_hat = sign(y(trainN+1:end));
s_ref = s(trainN+1-ell:end-ell);
BER = mean(y_hat ~= s_ref);
fprintf("BER after equalization ≈ %.4f\n", BER);

% (6) 등화 전후 아이 다이어그램/ISI 감각(간단 비교)
figure;
subplot(2,1,1);
plot(r(500:800)); grid on;
title("Received r[n] (with ISI)");

subplot(2,1,2);
plot(y(500:800),'r'); grid on;
title("Equalized y[n]");
```

**관찰 포인트**
- \(r[n]\)은 이전 심볼의 꼬리가 섞여 진폭이 흔들림
- \(y[n]\)은 ±1 근처로 다시 모이며 ISI가 줄어듦
- BER가 크게 개선됨(채널/μ/SNR에 따라 수치가 달라질 수 있음)

---

### 실무 확장 이슈

1. **Fractionally Spaced Equalizer (FSE)**
   - 심볼보다 **더 촘촘한 샘플**로 등화
   - 타이밍 오차/채널 영점 문제에 더 강함

2. **NLMS / RLS 사용**
   - 채널이 빠르게 변하면 LMS는 느림
   - NLMS는 기본 업그레이드
   - RLS는 빠르지만 연산/수치 이슈 증가

3. **결정지향의 위험**
   - 수렴 이전에 DD로 넘어가면 오판이 누적되어 발산 가능
   - 실무에서는 “훈련 길이/스위칭 조건”을 보수적으로 둔다.

---

## 4) 세 응용을 한눈에 비교

| 응용 | 목표 \(d[n]\) | 입력 \(\mathbf{x}[n]\) | 출력 의미 | 언제 유리? |
|---|---|---|---|---|
| 협대역 간섭 억제(ANC) | 관측 \(d=s+i\) | 간섭 참조 \(x\) | \(y\approx i\), \(e\approx s\) | 간섭과 상관된 참조가 있을 때 |
| ALE | 관측 \(x=s+v\) | 지연된 자기 자신 \(x[n-D]\) | \(y\approx\) 협대역, \(e\approx\) 광대역 | 참조 없음 + 협대역/광대역 혼합 |
| 채널 등화 | 송신 심볼 \(s\) (훈련/결정) | 수신 \(r\) | \(y\approx s\) | ISI 채널에서 심볼 복원 |

모두 같은 LMS지만, **어떤 신호를 “목표”로 두느냐**와
**입력 벡터를 어떻게 구성하느냐**가 응용을 갈라놓는다.

---

## 5) 실무 체크리스트

1. **모델 가정 확인**
   - 간섭이 정말 협대역인가? (ALE/노치가 먹히는지)
   - 참조가 충분히 간섭과 상관되는가? (ANC 성패)

2. **차수/지연/μ는 함께 튜닝**
   - \(M\)↑ → 표현력↑, 수렴↓
   - \(D\)↑ → 광대역 비상관화↑, 협대역 상관↓
   - μ↑ → 트래킹↑, 잔차↑

3. **입력이 컬러드면 NLMS 우선**
   - 통신/오디오 대부분 컬러드
   - LMS만 쓰면 “되긴 되는데 너무 느림”이 흔함

4. **유한정밀도/고정소수점**
   - μ 너무 작으면 업데이트가 0으로 죽음
   - 스케일링/가드비트/Leaky/NLMS로 안정화

---

## 6) 마무리

이번 글에서는 적응 FIR+LMS 기본기를 바탕으로

- **광대역 신호에서 협대역 간섭 억제(ANC/ALE/노치 관점)**
- **참조 없는 협대역 분리기인 ALE**
- **ISI 채널의 역특성을 학습하는 적응 등화기**

를 구조–수식–파라미터–Octave 실험까지 한 흐름으로 정리했다.

다음 단계로는 보통

- 주파수 영역 LMS(FDLMS)로 대형 필터 가속
- RLS로 빠른 채널 트래킹
- 적응 격자(Adaptive Lattice)로 수치 안정 강화
- 실제 AEC/ANC에서의 2차 경로/더블토크/루프 안정
