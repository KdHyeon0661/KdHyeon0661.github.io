---
layout: post
title: Avalonia - í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
date: 2025-02-22 20:20:23 +0900
category: Avalonia
---
# ğŸ§© Avaloniaì—ì„œ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ êµ¬í˜„í•˜ê¸° (ëª¨ë“ˆ ë¡œë”©)

---

## ğŸ¯ ëª©í‘œ

| í•­ëª© | ì„¤ëª… |
|------|------|
| ë…ë¦½ëœ DLLì„ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ë¡œë“œ | ì‹¤í–‰ ì¤‘ ë™ì ìœ¼ë¡œ `.dll` ì½ê¸° |
| ê³µí†µ ì¸í„°í˜ì´ìŠ¤ë¡œ í†µì‹  | IPlugin ë“± ì •ì˜ëœ ê³„ì•½(interface) ê¸°ë°˜ |
| MEF/Prism/ì§ì ‘ êµ¬í˜„ ë°©ì‹ ë¹„êµ | ìƒí™©ì— ë§ëŠ” ë°©ë²• ì„ íƒ

---

## ğŸ§± ê¸°ë³¸ êµ¬ì¡° ì˜ˆì‹œ

```
MyApp/
â”œâ”€â”€ MainApp/                  - Avalonia ì‹¤í–‰ ì•±
â”‚   â”œâ”€â”€ PluginLoader.cs       - DLL ë¡œë”
â”‚   â”œâ”€â”€ Interfaces/IPlugin.cs - í”ŒëŸ¬ê·¸ì¸ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
â”‚   â””â”€â”€ Program.cs
â”œâ”€â”€ Plugins/
â”‚   â””â”€â”€ MyPlugin.dll          - ë™ì ìœ¼ë¡œ ë¡œë“œë  ì™¸ë¶€ ê¸°ëŠ¥
```

---

## 1ï¸âƒ£ ê³µí†µ ì¸í„°í˜ì´ìŠ¤ ì •ì˜

ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ì´ êµ¬í˜„í•´ì•¼ í•  ê³„ì•½ì„ ì •ì˜í•©ë‹ˆë‹¤.

### ğŸ“„ Interfaces/IPlugin.cs

```csharp
public interface IPlugin
{
    string Name { get; }
    void Initialize(IServiceProvider serviceProvider);
    Control GetMainView(); // Avalonia UIìš©
}
```

---

## 2ï¸âƒ£ í”ŒëŸ¬ê·¸ì¸ DLL í”„ë¡œì íŠ¸ ì˜ˆì œ

Visual Studio ë˜ëŠ” CLIë¡œ **í´ë˜ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ í”„ë¡œì íŠ¸** ìƒì„± (ì˜ˆ: `MyPlugin`)

### ğŸ“„ Plugin.cs

```csharp
public class MyPlugin : IPlugin
{
    public string Name => "ğŸ’¡ í…ŒìŠ¤íŠ¸ í”ŒëŸ¬ê·¸ì¸";

    public void Initialize(IServiceProvider serviceProvider)
    {
        // í•„ìš”í•œ DI ì„œë¹„ìŠ¤ ì ‘ê·¼ ê°€ëŠ¥
    }

    public Control GetMainView()
    {
        return new TextBlock { Text = "ğŸ§© í”ŒëŸ¬ê·¸ì¸ UI View!" };
    }
}
```

- ì´ DLLì€ **ì‹¤í–‰ í”„ë¡œì íŠ¸ì— ì°¸ì¡°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**  
- ì˜¤ì§ **ëŸ°íƒ€ì„ì— ë¡œë”©**ë©ë‹ˆë‹¤.

---

## 3ï¸âƒ£ ë©”ì¸ ì•±ì—ì„œ Plugin ë¡œë” ì‘ì„±

### ğŸ“„ PluginLoader.cs

```csharp
public static class PluginLoader
{
    public static List<IPlugin> LoadPlugins(string path, IServiceProvider serviceProvider)
    {
        var plugins = new List<IPlugin>();
        if (!Directory.Exists(path)) return plugins;

        var dlls = Directory.GetFiles(path, "*.dll");

        foreach (var dll in dlls)
        {
            try
            {
                var asm = Assembly.LoadFrom(dll);
                var types = asm.GetTypes()
                    .Where(t => typeof(IPlugin).IsAssignableFrom(t) && !t.IsInterface);

                foreach (var type in types)
                {
                    if (Activator.CreateInstance(type) is IPlugin plugin)
                    {
                        plugin.Initialize(serviceProvider);
                        plugins.Add(plugin);
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"[í”ŒëŸ¬ê·¸ì¸ ë¡œë”© ì‹¤íŒ¨] {dll}: {ex.Message}");
            }
        }

        return plugins;
    }
}
```

---

## 4ï¸âƒ£ DIì™€ ê²°í•©í•œ ì´ˆê¸°í™” ì˜ˆì‹œ

### ğŸ“„ App.xaml.cs ë˜ëŠ” MainViewModel.cs

```csharp
var plugins = PluginLoader.LoadPlugins("Plugins", serviceProvider);

foreach (var plugin in plugins)
{
    Console.WriteLine($"â–¶ï¸ ë¡œë”©ëœ í”ŒëŸ¬ê·¸ì¸: {plugin.Name}");
    PluginViewContainer.Children.Add(plugin.GetMainView());
}
```

- `PluginViewContainer`ëŠ” StackPanel ë“±
- ë˜ëŠ” ê° í”ŒëŸ¬ê·¸ì¸ì„ íƒ­, ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ë¡œ êµ¬ì„± ê°€ëŠ¥

---

## 5ï¸âƒ£ Prism/MEF ê¸°ë°˜ í™•ì¥ (ì„ íƒ)

### ğŸ§© MEF (Managed Extensibility Framework)

MEFëŠ” .NET ë‚´ì¥ í™•ì¥ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

```csharp
[Export(typeof(IPlugin))]
public class MyPlugin : IPlugin
{
    ...
}
```

ê·¸ë¦¬ê³  `CompositionContainer`ë¡œ ìë™ ìˆ˜ì§‘:

```csharp
var catalog = new DirectoryCatalog("Plugins");
var container = new CompositionContainer(catalog);
var plugins = container.GetExports<IPlugin>().Select(p => p.Value).ToList();
```

> MEFëŠ” ë³µì¡í•œ í™•ì¥ êµ¬ì¡°ì— ì í•©í•˜ì§€ë§Œ, Avaloniaì—ì„œëŠ” ì£¼ë¡œ **ì§ì ‘ ë¡œë”© ë°©ì‹**ì´ ë” ê°€ë³ê³  ìœ ì—°í•©ë‹ˆë‹¤.

---

## âœ… í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡° ì„¤ê³„ íŒ

| ìš”ì†Œ | ê³ ë ¤ì‚¬í•­ |
|------|----------|
| ì¸í„°í˜ì´ìŠ¤ | ê³µí†µ ê¸°ë°˜ ê³„ì•½ ì •ì˜ (UI/ëª…ë ¹/ê¶Œí•œ ë“±) |
| í˜¸í™˜ì„± | .NET ë²„ì „, Avalonia ë²„ì „ ë™ì¼í•´ì•¼ í•¨ |
| ë³´ì•ˆ | DLLì—ì„œ ì•…ì„± ì½”ë“œ ì‹¤í–‰ ë°©ì§€ (ì„œëª…, ìƒŒë“œë°•ì‹± ê³ ë ¤) |
| ë…ë¦½ì„± | í”ŒëŸ¬ê·¸ì¸ì€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ ì‘ë™ |

---

## ğŸ’¡ í™•ì¥ ì•„ì´ë””ì–´

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ğŸ”„ í”ŒëŸ¬ê·¸ì¸ Hot Reload | íŒŒì¼ ì‹œìŠ¤í…œ ê°ì§€ + DLL ì¬ë¡œë”© |
| ğŸ”’ Role ê¸°ë°˜ í”ŒëŸ¬ê·¸ì¸ ì ‘ê·¼ ì œì–´ | Adminë§Œ ë³´ì´ëŠ” í”ŒëŸ¬ê·¸ì¸ ë“± |
| ğŸ”§ DI ì£¼ì… ìë™í™” | `IServiceProvider` ì „ë‹¬ ë˜ëŠ” DI ë“±ë¡ ìš”ì²­ |
| ğŸ§© ì»¤ë§¨ë“œ ê¸°ë°˜ í”ŒëŸ¬ê·¸ì¸ | ë²„íŠ¼ í´ë¦­ â†’ í”ŒëŸ¬ê·¸ì¸ ëª…ë ¹ ì‹¤í–‰ (`ICommandPlugin`) |
| ğŸ” ë§ˆì¼“ ê¸°ë°˜ ì„¤ì¹˜ êµ¬ì¡° | NuGet ë˜ëŠ” ì••ì¶•ëœ Zipìœ¼ë¡œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

---

## ğŸ“ ì˜ˆì‹œ í”ŒëŸ¬ê·¸ì¸ í´ë” êµ¬ì¡°

```
/Plugins
 â”œâ”€â”€ ReportPlugin.dll
 â”œâ”€â”€ ExportPlugin.dll
 â””â”€â”€ ChartPlugin.dll
```

ê° DLLì€ `IPlugin`ì„ êµ¬í˜„í•˜ê³  UI ë˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•¨.

---

## ğŸ“š ì°¸ê³  ë§í¬

- [MEF (Microsoft Docs)](https://learn.microsoft.com/en-us/dotnet/framework/mef/)
- [Avalonia + Reflection-based plugin system ì˜ˆì œ](https://github.com/AvaloniaUI)

---

## âœï¸ ê²°ë¡ 

- `IPlugin` ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤ë¡œ **ê³„ì•½** ì •ì˜
- ì‹¤í–‰ ì¤‘ **ë™ì  DLL ë¡œë”©** â†’ ViewModel ë˜ëŠ” UIì— ë°˜ì˜
- MEF/Prismê³¼ ê°™ì€ í™•ì¥ í”„ë ˆì„ì›Œí¬ë„ ê³ ë ¤ ê°€ëŠ¥
- ë³´ì•ˆê³¼ í˜¸í™˜ì„±, DI ì „ë‹¬ êµ¬ì¡°ê¹Œì§€ ê³ ë ¤í•˜ë©´ ì•ˆì •ì  í™•ì¥ ê°€ëŠ¥
