---
layout: post
title: 디지털신호처리 - 샘플링과 z-영역에서의 복원
date: 2025-11-11 17:25:23 +0900
category: 디지털신호처리
---
# 샘플링과 z-영역에서의 복원

## 0. 맥락과 목표
이 글은 앞선 **DTFT**, **Z-변환/역 Z**, **LTI 시스템** 글들을 바탕으로 **연속→이산 샘플링**, **에일리어싱**, **이상/현실 복원(싱크, ZOH/FOH)**, **안티에일리어싱/안티이미징** 체인, **ZOH 기반 이산화(펄스 전달함수)**, **업샘플링(보간) 필터 설계**를 **z-영역 관점**으로 꿰어 설명한다. 모든 핵심 정리는 **GNU Octave** 코드로 검증한다.

---

## 1. 이상 샘플링과 DTFT/에일리어싱

### 1.1 이상 샘플링 모델(펄스열 샘플러)
연속 신호 \(x_c(t)\), 샘플링 주기 \(T\) \((F_s=1/T)\)에 대해
$$
x_s(t)=x_c(t)\,\sum_{n=-\infty}^{\infty}\delta(t-nT).
$$
푸리에 변환은
$$
X_s(j\Omega)=\frac{1}{T}\sum_{k=-\infty}^{\infty} X_c\!\big(j(\Omega-k\Omega_s)\big),\qquad \Omega_s=\frac{2\pi}{T}.
$$
즉 **스펙트럼 복제(replication)**가 발생하며, **나이퀴스트** \(\Omega_s/2\)를 넘는 대역은 **겹침(에일리어싱)**을 일으킨다.

### 1.2 시퀀스와 DTFT 대응
샘플 시퀀스 \(x[n]=x_c(nT)\)의 DTFT는
$$
X(e^{j\omega})=\sum_{n=-\infty}^{\infty}x[n]\,e^{-j\omega n},\qquad \omega=\Omega T.
$$
연속 스펙트럼과의 연결은
$$
X(e^{j\omega})=\frac{1}{T}\sum_{k=-\infty}^{\infty} X_c\!\left(j\frac{\omega+2\pi k}{T}\right).
$$
대역제한 \(X_c(j\Omega)=0\ (|\Omega|>\Omega_N)\)이고 \(\Omega_s>2\Omega_N\)이면 **무손실 샘플링**이 가능하다.

### 1.3 용어 정리: 에일리어싱 vs 이미징
- **에일리어싱**: **ADC 전** 대역 외 신호가 샘플링 후 기저대역으로 **접힘**.
- **이미징**: **DAC 후** ZOH/보간으로 생기는 **고주파 복제 대역**. **안티이미징 필터**로 억제.

---

## 2. 이상 복원(싱크) vs 현실 복원(ZOH/FOH)

### 2.1 이상 복원: 싱크(sinc) 보간
대역제한·나이퀴스트 충족 시 이상 복원 필터
$$
H_{\text{ideal}}(j\Omega)=
\begin{cases}
T, & |\Omega|<\Omega_N\\
0, & \text{else}
\end{cases}
$$
시간영역 복원식
$$
\hat x_c(t)=\sum_{n=-\infty}^{\infty} x[n]\ \mathrm{sinc}\!\left(\frac{t-nT}{T}\right),\qquad \mathrm{sinc}(u)=\frac{\sin(\pi u)}{\pi u}.
$$
이상적이지만 **무한 지연/롤오프** 등으로 **비구현적**이다.

### 2.2 ZOH(Zero-Order Hold, 영차 유지)
일반적인 DAC는 각 샘플을 \(T\) 동안 고정(계단). 아날로그 전달함수
$$
H_{\text{ZOH}}(j\Omega)=T\,e^{-j\Omega T/2}\,\mathrm{sinc}\!\left(\frac{\Omega T}{2}\right).
$$
- **크기 드룹(droop)**: \(|H_{\text{ZOH}}|\)은 \(\Omega\) 증가에 따라 감소.
- **위상**: 선형지연 \(\approx T/2\) (중앙 정렬).

디지털 주파수 \(\omega=\Omega T\)로 쓰면
$$
H_{\text{ZOH}}(e^{j\omega})=T\,e^{-j\omega/2}\,\mathrm{sinc}\!\left(\frac{\omega}{2}\right).
$$

### 2.3 FOH(First-Order Hold, 일차 유지)
연속 구간을 **선형**으로 잇는 복원. 등가 커널이 **삼각함수(triangular)**라서
$$
H_{\text{FOH}}(j\Omega)=T\,e^{-j\Omega T}\,\mathrm{sinc}^2\!\left(\frac{\Omega T}{2}\right).
$$
ZOH보다 대역 내 평탄하지만 하드웨어/연산 부담이 크다.

### 2.4 샘플러의 개구(aperture) 효과
ADC가 진짜 **순간 샘플**이 아닌 **짧은 평균 \(T_a\)**를 취하면
$$
H_{\text{aperture}}(j\Omega)=e^{-j\Omega T_a/2}\,\mathrm{sinc}\!\left(\frac{\Omega T_a}{2}\right),
$$
고역 감쇠가 추가된다. 고속·고주파 계측에서 중요하다.

---

## 3. z-영역 관점과 시스템 블록

### 3.1 \(\omega=\Omega T\) 사상
단위원 \(|z|=1\)에서 \(z=e^{j\omega}=e^{j\Omega T}\). 아날로그 응답을 단위원 위 DT 주파수로 **평행 이동**해 해석할 수 있다.

### 3.2 전체 체인(AA/ADC/DSP/DAC/AI)
- **AA(안티에일리어싱)** 아날로그 LPF로 샘플 전 대역 제한.
- **ADC**(샘플·양자화) → **DSP**(이산 처리) → **DAC(ZOH)** → **AI(안티이미징)** 아날로그 LPF.

### 3.3 원형 vs 선형 컨볼루션 주의
DFT 영역 곱셈은 **원형** 컨볼루션에 해당. 선형 컨볼루션은 충분한 **제로패딩**이 필요.

---

## 4. 반에일리어싱/반이미징 필터 설계 요령

### 4.1 규격 예시(저역 통과)
- 통과대역 끝 \(F_p\), 스톱대역 시작 \(F_s^{(stop)}\), 샘플링 \(F_s\).
- 정규화 DT 주파수로는 \(\omega_p=2\pi F_p/F_s\), \(\omega_s=2\pi F_s^{(stop)}/F_s\).
- 전형적 경험칙: **가드밴드** 확보(예: \(F_p \le 0.45F_s\))로 필터 차수 감소.

### 4.2 설계(Octave FIR)
- 간단: `fir1(M, ωc/π, window)`  
- 엄격: `firls`(Least-squares), `firpm`(Parks–McClellan, Octave에선 `firpm` 또는 `remez` 패키지).

---

## 5. ZOH 기반 이산화(펄스 전달함수, Step-Invariant)

연속 LTI \(G(s)\)에 대해 ZOH로 한 주기 \(T\) 동안 **상수 입력**을 가정하면,
$$
G_d(z)=\mathcal{Z}\!\left\{g_h[n]\right\},\qquad 
g_h(t)=\mathcal{L}^{-1}\!\left\{\frac{1-e^{-sT}}{s}G(s)\right\},\quad g_h[n]=g_h(nT).
$$
- \(\dfrac{1-e^{-sT}}{s}\): ZOH가 만든 **직사 펄스 입력**의 라플라스.
- 결과 \(G_d(z)\)는 **스텝 응답 일치**(샘플 시점에서)라는 장점을 갖는다.

### 5.1 표준 1차 \(G(s)=\dfrac{1}{\tau s+1}\)
$$
\alpha=e^{-T/\tau},\qquad 
G_d(z)=\frac{1-\alpha}{z-\alpha}.
$$

### 5.2 상태공간 일반식
연속 \(x'(t)=Ax(t)+Bu(t),\ y=Cx+Du\)에 대해
$$
\Phi=e^{AT},\qquad 
\Gamma=\int_0^T e^{A\tau}B\,d\tau,
$$
$$
x[n+1]=\Phi x[n]+\Gamma u[n],\qquad y[n]=C x[n]+D u[n].
$$
- \(A\) 비가역이면 블록지수로 안정적 계산:
  \[
  \exp\!\begin{bmatrix}A&B\\0&0\end{bmatrix}T=
  \begin{bmatrix}\Phi&\Gamma\\0&I\end{bmatrix}.
  \]

---

## 6. 멀티레이트(업샘플링/보간/다운샘플링)와 z-영역

### 6.1 업샘플링 \(↑L\)
정의
$$
x_\uparrow[n]=
\begin{cases}
x[n/L], & n\equiv 0\pmod L\\
0, & \text{else}
\end{cases}
$$
스펙트럼
$$
X_\uparrow(e^{j\omega})=X(e^{j\omega L}).
$$
\(\omega\) 축이 **압축**되어 **\(L\)개의 이미지**가 생긴다.  
**보간 LPF** \(H(e^{j\omega})\)로 **기저대역만 통과**시키면 연속(이상) 보간에 근접.

### 6.2 다운샘플링 \(↓M\)과 안티에일리어싱
정의 \(y[n]=x[nM]\). 필수 조건은
$$
\text{다운샘플 전 } H_{\text{AA}}(e^{j\omega}) \text{로 } |\omega|\le \frac{\pi}{M}\ \text{내만 통과}.
$$

### 6.3 폴리페이즈(계산량 절감)
업샘플 보간 FIR \(H(z)=\sum_{m=0}^{L-1} z^{-m}E_m(z^L)\)로 나누면, **영 샘플에 곱하지 않도록** 효율 개선.

---

## 7. GNU Octave 실습(핵심 시나리오)

> 필요 시 `pkg load signal`을 먼저 실행하라.

### 7.1 이상(싱크) vs ZOH 복원 — 단일 톤
```octave
clear; close all; clc
Fs_cont = 200e3; T_cont = 1/Fs_cont;
t_cont = 0:T_cont:5e-3;     % 5 ms
f0 = 4e3;
x_cont = sin(2*pi*f0*t_cont);

Fs = 48e3; T = 1/Fs;
n = 0:floor(t_cont(end)/T);
t_samp = n*T; x = sin(2*pi*f0*t_samp);

% 이상 싱크 복원 (K개 항 근사)
K = 50; x_rec_sinc = zeros(size(t_cont));
for i=1:numel(t_cont)
  u = (t_cont(i)-t_samp)/T;
  s = sin(pi*u)./(pi*u); s(u==0)=1;
  idx = abs(u) <= K;
  x_rec_sinc(i) = sum(x(idx).*s(idx));
end

% ZOH 복원
x_rec_zoh = zeros(size(t_cont));
for i=1:numel(n)
  t0 = n(i)*T; t1 = t0+T;
  idx = (t_cont>=t0) & (t_cont<t1);
  x_rec_zoh(idx) = x(i);
end

i0=1; i1=min(numel(t_cont),2000);
plot(t_cont(i0:i1)*1e3,x_cont(i0:i1),'k', ...
     t_cont(i0:i1)*1e3,x_rec_sinc(i0:i1),'r--', ...
     t_cont(i0:i1)*1e3,x_rec_zoh(i0:i1),'b-.'); grid on
xlabel('time [ms]'); legend('x_c(t)','sinc','ZOH'); title('Ideal vs ZOH reconstruction');
```

### 7.2 에일리어싱 관측
```octave
clear; close all; clc
Fs=8e3; T=1/Fs; f0=5e3; N=1024; n=0:N-1;
x = sin(2*pi*f0*n*T);
fa = abs(f0 - round(f0/Fs)*Fs);     % 관측 주파수
fprintf("Aliased frequency ≈ %.1f Hz\n", fa);
```

### 7.3 ZOH 드룹 시각화
```octave
clear; close all; clc
w = linspace(0,pi,2000);
H = exp(-1j*w/2) .* (sin(w/2)./(w/2));  % 정규화된 ZOH
mag = 20*log10(abs(H)+1e-12);
plot(w/pi,mag); grid on; xlabel('\omega/\pi'); ylabel('|H_{ZOH}| [dB]');
title('ZOH magnitude droop');
```

### 7.4 연속 RC 저역통과의 ZOH 이산화
```octave
clear; close all; clc
tau = 1e-3; Fs=48e3; T=1/Fs; alpha = exp(-T/tau);
b = (1 - alpha); a = [1 -alpha];     % (1-alpha)/(1 - alpha z^-1)
N=2000; n=0:N-1; u=ones(1,N);
y_d = filter(b, a, u);

Fs_cont=200e3; t=0:1/Fs_cont:(N-1)*T;
y_c = 1 - exp(-t/tau);
plot(n*T*1e3,y_d,'b', t*1e3,y_c,'k--'); grid on
xlabel('time [ms]'); legend('ZOH discrete step','continuous step'); title('RC: step-invariant discretization');
```

### 7.5 업샘플링·보간 필터(멀티레이트)
```octave
clear; close all; clc
pkg load signal
Fs=12e3; T=1/Fs; N=256; n=0:N-1;
x = cos(2*pi*1e3*n*T) + 0.3*cos(2*pi*2e3*n*T);

L=4; xu = zeros(1,N*L); xu(1:L:end)=x;
Fc = 0.5/L; M=63; b = fir1(M, Fc, hamming(M+1)); a=1;   % 간단한 LPF
y = filter(b,a,xu);
t = (0:numel(y)-1)/(Fs*L);
plot(t*1e3,y,'b'); grid on; xlabel('time [ms]'); title('L=4 interpolation (LPF approximation to sinc)');
```

### 7.6 ZOH 드룹 프리엠퍼시스(평탄화) 예시
```octave
clear; close all; clc
pkg load signal
N=1024; w=linspace(0,pi,N);
H_zoh = abs( sin(w/2)./(w/2) ); H_zoh(1)=1;   % 정규화(위상 제외)

% 목표: 0..0.8π에서 평탄하도록 FIR LS 보정
Wp = 0.8; bands = [0 Wp  Wp 1];  % [0..Wp] 통과, [Wp..1]는 자유
des   = [1 1  0 0];              % 이상적 크기(여기서는 완전 평탄을 목표)
wts   = [1 0.01];                 % 통과대를 강하게
M=128;
% firls로 'H_pre * H_zoh ≈ 1'을 맞추고자 H_pre ≈ 1/H_zoh 를 샘플링 근사
Hd = 1./max(H_zoh,1e-3);         % 간단 준비
% 실제 firls는 원하는 응답을 직접 지정: 여기선 piecewise로 1을 주고, H_zoh 보정은 적용 시 곱으로 확인
b = firls(M, [0 Wp Wp 1], [1 1 0 0]);
% 검증 곱(평탄성)
H_pre = freqz(b,1,w);
H_tot = H_pre(:) .* (H_zoh(:).*exp(-1j*w/2));    % 위상 포함시 위상성은 변함
plot(w/pi, 20*log10(abs(H_tot)+1e-12)); grid on
xlabel('\omega/\pi'); ylabel('|H_{pre}H_{ZOH}| [dB]'); title('ZOH droop compensation (illustrative)');
```

> 주: 실제 프리엠퍼시스는 통과대역에서 \(1/H_{\text{ZOH}}\)을 근사하도록 LS/최소맥시민으로 설계한다. 위 코드는 개념 시연용이다.

---

## 8. 심화: 수학적 쟁점과 실무 체크리스트

### 8.1 나이퀴스트 조건
충분조건은
$$
F_s>2B
$$
이지만, 필터 롤오프/가드밴드/부정확한 대역제한 등을 고려해 **여유 배수**(예: \(2.5\sim 3\times\))를 둔다.

### 8.2 싱크 보간의 현실화
유한 항으로 **윈도우드 싱크**를 사용한다:
$$
h[n]=w[n]\ \mathrm{sinc}\!\left(\frac{n}{L}\right).
$$
윈도우에 따라 패스밴드 립플·지연·스톱밴드 감쇠가 트레이드오프.

### 8.3 ZOH vs 임펄스 불변 vs 쌍선형(BLT)
- **ZOH(펄스 불변)**: 스텝 응답 동일. 저주파 정확, 제어에 적합.
- **임펄스 불변**: 임펄스 샘플 동일. 고주파에서 **에일리어싱** 위험.
- **쌍선형**: 사상 \(\Omega=\tfrac{2}{T}\tan(\omega/2)\), 안정성/최소위상 보존, **주파수 왜곡**은 **프리워핑**으로 보정.

### 8.4 이미징/에일리어싱 필터 설계 팁
- 다운샘플 \(↓M\) 전 저역 통과 컷오프 \(\omega_c\lesssim \pi/M\).
- 업샘플 \(↑L\) 후 저역 통과 컷오프 \(\omega_c\lesssim \pi/L\).
- **하프밴드**(L=2) FIR은 절반 계수가 0이라 계산량 절감.

### 8.5 지터·양자화(간단 언급)
- **지터**: 샘플 타이밍 변동 → 위상 노이즈·고역 SNR 저하.
- **양자화 노이즈**: 이상적이면 균등 분포 백색 잡음, \(SNR\approx 6.02b+1.76\) dB.

---

## 9. 이론 정리(핵심 공식 모음)

- 샘플링 스펙트럼
$$
X_s(j\Omega)=\frac{1}{T}\sum_{k=-\infty}^{\infty}X_c\!\big(j(\Omega-k\Omega_s)\big).
$$
- DTFT 대응
$$
X(e^{j\omega})=\frac{1}{T}\sum_{k=-\infty}^{\infty}X_c\!\left(j\frac{\omega+2\pi k}{T}\right),\qquad \omega=\Omega T.
$$
- 이상 복원
$$
\hat x_c(t)=\sum_{n=-\infty}^{\infty}x[n]\ \mathrm{sinc}\!\left(\frac{t-nT}{T}\right).
$$
- ZOH 응답
$$
H_{\text{ZOH}}(j\Omega)=T\,e^{-j\Omega T/2}\,\mathrm{sinc}\!\left(\frac{\Omega T}{2}\right).
$$
- FOH 응답
$$
H_{\text{FOH}}(j\Omega)=T\,e^{-j\Omega T}\,\mathrm{sinc}^2\!\left(\frac{\Omega T}{2}\right).
$$
- ZOH 이산화(펄스 전달함수)
$$
G_d(z)=\mathcal{Z}\!\left\{\left.\mathcal{L}^{-1}\!\left(\frac{1-e^{-sT}}{s}G(s)\right)\right|_{t=nT}\right\}.
$$
- 상태공간 등가
$$
\Phi=e^{AT},\quad \Gamma=\int_0^T e^{A\tau}B\,d\tau,\quad x[n+1]=\Phi x[n]+\Gamma u[n].
$$

---

## 10. 연습문제(풀이 스케치/코드)

### 문제 1) 이상/현실 복원 비교와 드룹 정량화
\(f_0=6\) kHz, \(F_s=44.1\) kHz로 §7.1을 수정해 싱크/ZOH를 비교하고, §7.3으로 드룹 dB를 플롯하라.

### 문제 2) 에일리어싱 측정
\(F_s=10\) kHz, \(f_0=7\) kHz. \(f_a=|f_0-mF_s|\) 중 \(<F_s/2\)를 구하고, 싱크 복원 결과 파형 주기를 측정하라.

### 문제 3) ZOH 이산화 검증
\(G(s)=\dfrac{\omega_c}{s+\omega_c}\), \(\omega_c=2\pi\cdot 1\) kHz, \(F_s=48\) kHz.  
\(G_d(z)=\dfrac{1-e^{-\omega_c T}}{z-e^{-\omega_c T}}\)를 유도하고 §7.4로 스텝 응답을 비교하라.

### 문제 4) 업샘플링 FIR 요구조건
\(↑3\) 보간에서 패스밴드 \([0,\pi/3]\) 립플 < 0.5 dB, 스톱밴드 감쇠 \(\ge 60\) dB. `firpm`(또는 긴 `fir1`)으로 필터를 설계하고 §7.5 코드를 수정해 파형을 확인하라.

### 문제 5) 폴리페이즈 구현 스케치
\(L=4\) 보간 FIR을 \(E_m(z)\)로 분해해 **영 삽입 샘플에 대한 곱셈을 회피**하는 구조도를 그려라(계산량 비교 포함).

---

## 11. 결론
- 샘플링은 **스펙트럼 복제**, 복원은 그 중 **기저대역 선택·보간** 문제다.  
- 이상 복원(싱크)은 기준선, 현실 복원(ZOH/FOH)은 **드룹/이미징**을 유발하므로 **AI 필터/프리엠퍼시스**가 필수다.  
- z-영역에서는 \(\omega=\Omega T\) 사상으로 아날로그/디지털 응답을 통일적으로 해석할 수 있다.  
- 연속 시스템은 **ZOH 이산화**로 \(G_d(z)\)를 얻고, **멀티레이트**는 \(↑L/↓M\)+저역필터로 엄밀히 모델링된다.  
- 본문 Octave 코드로 본인의 **ADC→DSP→DAC** 체인을 수치적으로 재현·검증하라.