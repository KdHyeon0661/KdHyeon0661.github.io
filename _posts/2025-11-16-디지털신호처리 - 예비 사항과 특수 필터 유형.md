---
layout: post
title: 디지털신호처리 - 예비 사항과 특수 필터 유형
date: 2025-11-16 21:25:23 +0900
category: 디지털신호처리
---
# IIR 필터 — 예비 사항과 특수 필터 유형

## 1. 예비 사항

### 1.1 IIR 필터의 기본 정의

IIR 필터는 **무한 임펄스 응답(Infinite Impulse Response)** 을 가지는 선형 시불변(LTI) 디지털 필터다.

시간 영역 차분방정식:

$$
y[n]
=
-\sum_{k=1}^{N} a_k\, y[n-k]
+
\sum_{k=0}^{M} b_k\, x[n-k]
$$

- $$x[n]$$: 입력
- $$y[n]$$: 출력
- $$a_k$$: 피드백 계수 (과거 출력 항)
- $$b_k$$: 피드포워드 계수 (과거 입력 항)

**전송함수**(Transfer function)는 \(z\)-변환으로 표현하면:

$$
H(z) = \frac{Y(z)}{X(z)}
= \frac{b_0 + b_1 z^{-1} + \dots + b_M z^{-M}}{1 + a_1 z^{-1} + \dots + a_N z^{-N}}
$$

- 분자 다항식: **영점(zero)** 를 결정
- 분모 다항식: **극점(pole)** 을 결정

**IIR**라는 이름은 피드백 때문에 **임펄스 응답이 무한히 지속**되기 때문이다.  
예: 1차 IIR

$$
y[n] = \alpha y[n-1] + x[n]
$$

에 대해 임펄스 입력 $$x[n] = \delta[n]$$ 을 넣으면

$$
h[n] = \alpha^{n} u[n]
$$

로 끝없이 이어진다(단, $$|\alpha|<1$$ 이면 점점 작아짐).

---

### 1.2 극/영점, 안정성, 주파수 응답

#### 1.2.1 극/영점과 안정성

전송함수:

$$
H(z) = \frac{B(z)}{A(z)}
= \frac{\prod_{k=1}^{M} (1 - z_k z^{-1})}{\prod_{\ell=1}^{N} (1 - p_\ell z^{-1})}
$$

- $$z_k$$: 영점(zero)
- $$p_\ell$$: 극점(pole)

**안정성(BIBO 안정)**

- IIR 시스템이 BIBO 안정이려면, 모든 **극점이 단위원 안**에 있어야 한다:
  
  $$
  |p_\ell| < 1 \quad \forall \ell
  $$

- 직관적으로, 극점이 단위원 밖에 있으면, 응답이 지수적으로 발산한다.

#### 1.2.2 주파수 응답

주파수 응답은

$$
H(e^{j\omega}) = H(z)\big|_{z=e^{j\omega}}
$$

- 크기 응답: $$|H(e^{j\omega})|$$
- 위상 응답: $$\angle H(e^{j\omega})$$

샘플링 주파수가 $$F_s$$ 라면, 아날로그 주파수 $$F$$ 와 디지털 주파수 관계:

$$
\omega = 2\pi \frac{F}{F_s}, \quad 0 \le \omega \le \pi
$$

**정규화 주파수**(normalized frequency)를

$$
f = \frac{F}{F_s/2} = \frac{\omega}{\pi}, \quad 0 \le f \le 1
$$

로 쓰면 편리하다.

---

### 1.3 IIR 필터 구조: Direct Form, 2차 섹션(SOS)

차분방정식

$$
y[n]
=
-\sum_{k=1}^{N} a_k y[n-k]
+
\sum_{k=0}^{M} b_k x[n-k]
$$

을 구현하는 가장 직관적인 구조:

- **Direct Form I**  
  - 입력 지연선에 $$x[n-k]$$ 보관 → 곱셈기 $$b_k$$  
  - 출력 지연선에 $$y[n-k]$$ 보관 → 곱셈기 $$a_k$$  
  - 두 경로를 더함.

- **Direct Form II**  
  - 피드포워드/피드백 지연선 공유 → 지연소자 개수 절반.

그러나 IIR 필터는 **고차수**일수록

- 극점이 단위원 근처에 밀집
- 계수 양자화에 민감

해서 비수치적으로 불안정해질 수 있다.

그래서 실무에서는 **2차 섹션(Second-Order Section, SOS, biquad)** 들의 캐스케이드 구조가 일반적이다.

$$
H(z) = \prod_{i=1}^{L} H_i(z),
$$

각 섹션은

$$
H_i(z) = \frac{b_{0,i} + b_{1,i} z^{-1} + b_{2,i} z^{-2}}{1 + a_{1,i} z^{-1} + a_{2,i} z^{-2}}
$$

---

### 1.4 예제: 간단한 2차 IIR 설계와 극점 확인 (Octave)

- 샘플링: $$F_s = 48\,\mathrm{kHz}$$  
- 아날로그 느낌의 **저Q(완만한)** 2차 저역통과 필터를 가정해보자.

여기서는 직접 계수를 써서 구조·극점·응답을 확인한다.

```octave
pkg load signal;
clear; close all; clc;

Fs = 48000;
% 예: "조금 둔탁한" 2차 저역통과 느낌의 계수
b = [0.0675  0.1349  0.0675];
a = [1.0000 -1.1430  0.4128];

% 극/영점
z = roots(b);
p = roots(a);

printf("Zeros:\n"); disp(z);
printf("Poles:\n"); disp(p);

% 안정성 확인: |p| < 1 ?
printf("Pole magnitudes:\n"); disp(abs(p));

% 주파수 응답
[H, w] = freqz(b, a, 1024);
f = w / pi;   % 0~1

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized frequency'); ylabel('Magnitude (dB)');
title('2nd-order IIR LPF magnitude');

subplot(2,1,2);
plot(f, unwrap(angle(H)));
grid on;
xlabel('Normalized frequency'); ylabel('Phase (rad)');
title('2nd-order IIR LPF phase');
```

- 극점 크기가 모두 1보다 작으면 **BIBO 안정**.
- 크기 응답은 저역에서 0 dB 부근, 고역에서 감쇠.
- 위상은 **비선형**, FIR 선형 위상과 달리 주파수에 따라 휘어진다.

---

### 1.5 아날로그 프로토타입과 디지털 IIR 설계 절차 개관

실무에서 IIR 필터는 대개 **아날로그 필터 프로토타입**을 기준으로 설계한다.

1. **디지털 스펙 정리**

   - 통과대역 끝 주파수 $$\omega_p$$  
   - 저지대역 시작 주파수 $$\omega_s$$  
   - 허용 통과대역 리플 $$A_p$$ (예: 1 dB)  
   - 필요한 저지대역 감쇠 $$A_s$$ (예: 60 dB)

2. **주파수 축 매핑: Bilinear Transform**

   - 샘플링 주기 $$T=\frac{1}{F_s}$$
   - Bilinear 변환:
     
     $$
     s = \frac{2}{T} \frac{1 - z^{-1}}{1 + z^{-1}}
     $$
     
   - 이것은 아날로그 축의 모든 주파수를 디지털 영역의 $$0\le \omega \le \pi$$ 로 매핑.

3. **Prewarping (프리워핑)**

   bilinear 변환은 **주파수 축 비선형 매핑**이므로,  
   설계에 사용되는 아날로그 컷오프 $$\Omega_p, \Omega_s$$ 는

   $$
   \Omega = \frac{2}{T} \tan{\frac{\omega}{2}}
   $$

   으로 역변환해서 사용한다.

4. **아날로그 프로토타입 선택**

   - Butterworth: 통과·저지대역 **모노토닉**
   - Chebyshev I: 통과대역 등리플, 저지대역 모노토닉
   - Chebyshev II: 통과대역 모노토닉, 저지대역 등리플
   - Elliptic: 통과/저지대역 모두 등리플 (가장 급경사)
   - Bessel: 군지연(flat group delay)에 최적화

5. **아날로그 프로토타입 필터 계수 계산**

   - Octave: `buttord`, `butter` / `cheb1ord`, `cheby1` / `cheb2ord`, `cheby2` / `ellipord`, `ellip` 등
   - 아날로그 저역통과로 먼저 설계 후, 필요하면 저역→대역통과/대역저지/고역으로 변환.

6. **bilinear 변환으로 디지털 필터 계수 계산**

---

### 1.6 예제: Butterworth IIR 설계 절차 스케치 (Octave)

- 샘플링: $$F_s = 48\,\mathrm{kHz}$$  
- 통과대역 끝: $$F_p = 4.8\,\mathrm{kHz}$$  
- 저지대역 시작: $$F_s' = 9.6\,\mathrm{kHz}$$  
- 통과대역 리플: $$A_p = 1\,\mathrm{dB}$$  
- 저지대역 감쇠: $$A_s = 60\,\mathrm{dB}$$

```octave
pkg load signal;
clear; close all; clc;

Fs  = 48000;
Fp  = 4800;
Fs1 = 9600;
Ap  = 1;     % dB
As  = 60;    % dB

Wp = Fp  / (Fs/2);  % 정규화 (0~1)
Ws = Fs1 / (Fs/2);

% 1) Butterworth 차수와 컷오프 계산
[N, Wn] = buttord(Wp, Ws, Ap, As);
printf("Butterworth order N = %d, Wn = %f\n", N, Wn);

% 2) 디지털 Butterworth IIR 계수
[b, a] = butter(N, Wn, "low");

% 3) 주파수 응답
[H, w] = freqz(b, a, 4096);
f = w / pi;

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized frequency'); ylabel('Magnitude (dB)');
title(sprintf('Butterworth LPF: N=%d', N));
ylim([-120 5]);

subplot(2,1,2);
plot(f, unwrap(angle(H)));
grid on;
xlabel('Normalized frequency'); ylabel('Phase (rad)');
title('Phase response');
```

- `buttord`가 스펙을 만족하는 최소 차수를 계산.
- `butter`가 실제 디지털 필터 계수 생성.
- 이 예제는 이어지는 **특수 필터 유형** 설명의 기준 역할을 한다.

---

## 2. 특수 필터 유형 — 아날로그 프로토타입 계열

여기서 “특수 필터 유형”은 먼저 **클래식 아날로그 필터 패밀리**를 의미한다.

- 통과대역 리플/저지대역 감쇠/군지연 특성에 따라 여러 “개성 있는” 필터가 있다.
- 이들은 미국·유럽에서 개발된 필터 이론(Butterworth, Chebyshev, Elliptic, Bessel 등)에 기반한다.

---

### 2.1 Butterworth 필터

#### 2.1.1 크기 응답 특성

Butterworth(1930년대):

- 통과대역/저지대역에서 **리플이 전혀 없는(monotonic)** 필터.
- 크기 응답:

  $$
  |H(j\Omega)|^2 = \frac{1}{1 + \left( \frac{\Omega}{\Omega_c} \right)^{2N}}
  $$

  - $$N$$: 필터 차수
  - $$\Omega_c$$: 컷오프 주파수

특징:

- 통과대역에서 **최대한 평탄(maximally flat)**.
- 전이대역은 Chebyshev, Elliptic보다 **완만**. (동일 스펙일 때 더 큰 차수 필요)
- 위상/군지연은 비선형.

디지털로는 bilinear 변환을 통해 Butterworth 프로토타입에서 IIR 필터를 얻는다.

#### 2.1.2 예제: Butterworth 저역통과 (Octave)

앞의 예비 예제에서 사용한 것과 유사하지만, 스펙을 조금 바꿔 보자.

- 샘플링: $$F_s = 44.1\,\mathrm{kHz}$$ (CD 오디오 표준)
- 통과대역 끝: $$F_p = 5\,\mathrm{kHz}$$
- 저지대역 시작: $$F_s' = 8\,\mathrm{kHz}$$
- $$A_p = 1\,\mathrm{dB},\ A_s = 60\,\mathrm{dB}$$

```octave
pkg load signal;
clear; close all; clc;

Fs  = 44100;
Fp  = 5000;
Fs1 = 8000;
Ap  = 1;
As  = 60;

Wp = Fp  / (Fs/2);
Ws = Fs1 / (Fs/2);

[N, Wn] = buttord(Wp, Ws, Ap, As);
printf("Butterworth: N=%d, Wn=%.4f\n", N, Wn);

[b, a] = butter(N, Wn, "low");

[H, w] = freqz(b, a, 4096);
f = w / pi;

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
title(sprintf('Butterworth LPF (N=%d)', N));
ylim([-100 5]);

subplot(2,1,2);
plot(f, unwrap(angle(H)));
grid on;
xlabel('Normalized freq'); ylabel('Phase (rad)');
title('Phase response');
```

---

### 2.2 Chebyshev I 필터 (등리플 통과대역)

#### 2.2.1 크기 응답

Chebyshev I 필터는 **통과대역에서 등리플(equiripple)**, 저지대역에서 단조 감소(monotonic):

$$
|H(j\Omega)|^2
=
\frac{1}{1 + \epsilon^2 T_N^2\!\left(\frac{\Omega}{\Omega_c}\right)}
$$

- $$T_N(\cdot)$$: N차 Chebyshev 다항식
- $$\epsilon$$: 통과대역 리플을 결정하는 파라미터

통과대역 리플 $$A_p$$ 와 $$\epsilon$$ 관계:

- 최대 크기:
  
  $$
  |H|_{\max} = 1
  $$
- 최소 크기:

  $$
  |H|_{\min} = \frac{1}{\sqrt{1 + \epsilon^2}}
  $$
- dB 단위 리플:

  $$
  A_p = -20 \log_{10}\left( |H|_{\min} \right)
       = 10 \log_{10}(1 + \epsilon^2)
  $$

따라서

$$
\epsilon = \sqrt{10^{A_p/10} - 1}
$$

#### 2.2.2 Chebyshev I 예제 (Octave)

동일 스펙에서 Chebyshev I vs Butterworth 차수를 비교해 보자.

```octave
pkg load signal;
clear; close all; clc;

Fs  = 44100;
Fp  = 5000;
Fs1 = 8000;
Ap  = 1;
As  = 60;

Wp = Fp  / (Fs/2);
Ws = Fs1 / (Fs/2);

% Butterworth vs Chebyshev I 차수 비교
[Nb, Wnb] = buttord(Wp, Ws, Ap, As);
[Nh, Wnh] = cheb1ord(Wp, Ws, Ap, As);

printf("Butterworth N = %d, Chebyshev I N = %d\n", Nb, Nh);

[b_b, a_b] = butter(Nb, Wnb, "low");
[b_c, a_c] = cheby1(Nh, Ap, Wnh, "low");  % 통과대역 리플 Ap(dB)

[Hb, w] = freqz(b_b, a_b, 4096);
[Hc, ~] = freqz(b_c, a_c, 4096);
f = w / pi;

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(Hb)+eps), ...
     f, 20*log10(abs(Hc)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
legend('Butterworth', 'Chebyshev I');
title('Magnitude (dB)');

subplot(2,1,2);
plot(f, unwrap(angle(Hb)), ...
     f, unwrap(angle(Hc)));
grid on;
xlabel('Normalized freq'); ylabel('Phase (rad)');
legend('Butterworth', 'Chebyshev I');
title('Phase response');
```

- 일반적으로 Chebyshev I가 **더 낮은 차수**로 같은 스펙을 만족한다.
- 대신 통과대역에 **등리플**이 생긴다.

---

### 2.3 Chebyshev II 필터 (등리플 저지대역)

Chebyshev II는 통과대역 모노토닉, 저지대역이 등리플:

$$
|H(j\Omega)|^2
=
\frac{1}{1 + \frac{1}{\epsilon^2 T_N^2(\Omega_c / \Omega)}}
$$

- $$\epsilon$$: 저지대역 리플을 결정.

#### 예제 (Octave)

```octave
pkg load signal;
clear; close all; clc;

Fs  = 44100;
Fp  = 5000;
Fs1 = 8000;
Ap  = 1;
As  = 60;

Wp = Fp  / (Fs/2);
Ws = Fs1 / (Fs/2);

[N2, Wn2] = cheb2ord(Wp, Ws, Ap, As);
printf("Chebyshev II order = %d\n", N2);

[b2, a2] = cheby2(N2, As, Wn2, "low");  % As: 저지대역 감쇠(dB)

[H2, w] = freqz(b2, a2, 4096);
f = w / pi;

figure;
plot(f, 20*log10(abs(H2)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
title(sprintf('Chebyshev II LPF (N=%d)', N2));
ylim([-100 5]);
```

---

### 2.4 Elliptic (Cauer) 필터

Elliptic(=Cauer) 필터는

- 통과대역/저지대역 **모두 등리플**.
- 동일 스펙에서 가장 **낮은 차수**로 설계 가능.

크기 응답:

$$
|H(j\Omega)|^2
=
\frac{1}{1 + \epsilon^2 R_N^2(\Omega)}
$$

- $$R_N(\cdot)$$: Jacobian elliptic 함수 기반의 Rational Chebyshev 함수.
- 실제 설계는 수치 루틴(`ellipord`, `ellip`)이 내부적으로 처리.

#### 예제 (Octave)

```octave
pkg load signal;
clear; close all; clc;

Fs  = 44100;
Fp  = 5000;
Fs1 = 8000;
Ap  = 1;
As  = 60;

Wp = Fp  / (Fs/2);
Ws = Fs1 / (Fs/2);

[Ne, Wne] = ellipord(Wp, Ws, Ap, As);
printf("Elliptic order = %d\n", Ne);

[be, ae] = ellip(Ne, Ap, As, Wne, "low");

[He, w] = freqz(be, ae, 4096);
f = w / pi;

figure;
plot(f, 20*log10(abs(He)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
title(sprintf('Elliptic LPF (N=%d)', Ne));
ylim([-100 5]);
```

- 같은 스펙(1 dB passband ripple, 60 dB stopband)에서  
  Butterworth, Chebyshev I/II보다 **차수가 낮은 필터**가 나온다.

---

### 2.5 Bessel 필터 (군지연 최적화)

Bessel 필터는 **군지연(flat group delay)** 에 초점을 맞춘 아날로그 필터:

- 크기 응답은 Butterworth보다 더 완만(롤오프가 느림).
- 대신 시간 영역에서 **파형 유지**에 유리.

디지털로는 `bilinear` 변환으로 IIR을 만들 수 있지만,  
신호 처리 라이브러리에서 직접 Bessel 디지털 필터 설계 함수가 없을 수도 있다.

아이디어만 정리:

- 아날로그 Bessel 필터의 전송함수:

  $$
  H(s) = \frac{\theta_N(0)}{\theta_N(s/\Omega_c)}
  $$

  여기서 $$\theta_N(\cdot)$$ 는 Bessel 폴리노미얼.

- 그룹 지연:

  $$
  \tau_g(\Omega) = -\frac{d}{d\Omega} \angle H(j\Omega)
  $$

  이 저역에서 거의 상수.

실제 오디오/통신에서는

- “군지연이 정말 중요하면”: Bessel 계열 또는 **FIR 선형 위상** 선택.
- “스펙이 더 중요하면”: Butterworth/Chebyshev/Elliptic 사용.

---

## 3. 특수 IIR 필터 유형 — 디지털 구조 관점

이제 아날로그 프로토타입 외에, **디지털에서 자주 쓰이는 특수 IIR 구조**들을 다룬다.

- Notch 필터 (Notch / Bandstop)
- Comb 필터
- Allpass 필터
- Resonator (공진 필터)
- Shelving / Peaking EQ (오디오)

---

### 3.1 Notch 필터 (좁은 대역 제거)

#### 3.1.1 구조와 극/영점

정규화 중심 주파수 $$\omega_0$$ 에서 **협대역을 제거**하는 Notch 필터:

$$
H(z)
=
\frac{1 - 2\cos\omega_0 z^{-1} + z^{-2}}
{1 - 2r\cos\omega_0 z^{-1} + r^2 z^{-2}}
$$

- 영점: $$z = e^{\pm j\omega_0}$$ (단위원 상 → 해당 주파수 완전 제거)
- 극점: $$z = r e^{\pm j\omega_0}$$, $$0<r<1$$
  - $$r$$ 이 1에 가까울수록 **더 좁고 깊은 노치**.
  - 너무 1에 가까우면 Q가 높고 수치적으로 민감.

#### 3.1.2 60 Hz 전원 노치 예제 (Octave)

- 샘플링: $$F_s=48000\,\mathrm{Hz}$$
- 제거하고 싶은 주파수: 60 Hz (북미 전원 주파수)
- 정규화:  
  $$\omega_0 = 2\pi \frac{60}{48000}$$

```octave
clear; close all; clc;

Fs = 48000;
f0 = 60;
omega0 = 2*pi*f0/Fs;

r = 0.99;  % 노치 폭 조절: 1에 가까울수록 좁은 노치

b = [1, -2*cos(omega0), 1];
a = [1, -2*r*cos(omega0), r^2];

[z, p, k] = tf2zp(b, a);
printf("Zeros:\n"); disp(z);
printf("Poles:\n"); disp(p);

[H, w] = freqz(b, a, 4096);
f = w / (2*pi) * Fs;  % Hz 단위

figure;
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Frequency (Hz)'); ylabel('Magnitude (dB)');
title('60 Hz Notch IIR Filter');
xlim([0 500]);
ylim([-80 5]);
```

사용 상황 예:

- 센서 신호 안에 포함된 **60 Hz(또는 50 Hz) 전력선 간섭** 제거.
- 협대역 진동/공진 제거(기계 진동, 전력전자 등).

---

### 3.2 Comb 필터

#### 3.2.1 구조와 주파수 응답

Comb 필터는 **주기적인 스펙트럼 노치/피크**를 가진다.

- **피드포워드 Comb**:

  $$
  H(z) = 1 + z^{-N}
  $$

  - 크기 응답:

    $$
    |H(e^{j\omega})| = 2|\cos(\omega N/2)|
    $$

  - 주파수에서 주기적으로 영점/극대.

- **피드백 Comb**:

  $$
  H(z) = \frac{1}{1 - \alpha z^{-N}}, \quad |\alpha| < 1
  $$

  - 좁은 간격의 공진 피크.

#### 3.2.2 Echo/Flanger 느낌 예제 (Octave)

간단한 피드포워드 comb 필터:

```octave
clear; close all; clc;

Fs = 48000;
N  = round(0.01 * Fs);   % 10 ms 딜레이
b  = [1 zeros(1,N-1) 1]; % 1 + z^-N
a  = 1;

[H, w] = freqz(b, a, 4096);
f = w / pi;  % 0~1 normalized

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
title('Feedforward comb filter');

subplot(2,1,2);
stem(0:N, b, 'filled');
grid on;
xlabel('n'); ylabel('h[n]');
title('Impulse response');
```

- 오디오에서 **코러스/플랜저**(짧은 딜레이 + 시간 변조)를 구성할 때 사용.
- 통신/계측에서는 **주기적인 간섭 제거**나 **스펙트럼 샘플링**에 쓰인다.

---

### 3.3 Allpass 필터

#### 3.3.1 정의

Allpass 필터는

$$
|H(e^{j\omega})| = 1 \quad \forall \omega
$$

이지만 위상/군지연은 원하는 대로 조절할 수 있는 필터.

- 크기 응답: 항상 0 dB
- 위상 응답: 설계에 따라 복잡하게 변형 가능 → **위상 보상**, **군지연 보상**, **필터 뱅크 설계** 등에 중요.

1차 Allpass 예:

$$
H(z) = \frac{a + z^{-1}}{1 + a z^{-1}}, \quad |a| < 1
$$

극/영점 관계:

- 영점: $$z = -a$$
- 극점: $$z = -1/a$$ → 영점/극점이 **단위원에 대해 대칭**.

일반 Allpass:

$$
H(z) = \frac{a_0 + a_1 z^{-1} + \dots + a_N z^{-N}}
{a_N + a_{N-1} z^{-1} + \dots + a_0 z^{-N}}
$$

- 분자/분모 계수 벡터가 **거꾸로 뒤집힌(conjugate reversed)** 관계.

#### 3.3.2 1차 Allpass 예제 (Octave)

```octave
clear; close all; clc;

a = 0.5; % |a|<1
b = [a 1];
c = [1 a];

[H, w] = freqz(b, c, 1024);
f = w / pi;

figure;
subplot(2,1,1);
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Normalized freq'); ylabel('Magnitude (dB)');
title('1st-order Allpass magnitude');

subplot(2,1,2);
plot(f, unwrap(angle(H)));
grid on;
xlabel('Normalized freq'); ylabel('Phase (rad)');
title('1st-order Allpass phase');
```

응용:

- IIR 구조의 **선형 위상 근사**(allpass + magnitude shaping)
- 오디오에서 **위상 왜곡 보상**, **스테레오 확장**
- 필터 뱅크에서 **필터 페어**(예: 두 개의 allpass를 더/빼서 대역분리)

---

### 3.4 Resonator (공진 필터)

Resonator는 특정 주파수에서 **Q가 높은 피크**를 가지는 2차 IIR:

$$
H(z) = \frac{1 - r^2}{1 - 2r\cos\omega_0 z^{-1} + r^2 z^{-2}}
$$

- 극점: $$z = r e^{\pm j\omega_0}$$
- $$r \to 1$$ 일수록 Q가 증가 (날카로운 공진).

#### 예제: 1 kHz 공진 필터 (Octave)

```octave
clear; close all; clc;

Fs = 48000;
f0 = 1000;
omega0 = 2*pi*f0/Fs;

r = 0.99;
b = [1 - r^2];  % 정규화
a = [1, -2*r*cos(omega0), r^2];

[H, w] = freqz(b, a, 4096);
f = w / (2*pi) * Fs;

figure;
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Frequency (Hz)'); ylabel('Magnitude (dB)');
title('1 kHz Resonator (r=0.99)');
xlim([0 5000]);
```

사용 예:

- 악기/음성의 **포만트(resonance)** 모델
- 레이더/계측에서 특정 공진 모드 추적
- 시스템 식별(폴 위치 추정)

---

### 3.5 오디오용 Shelving / Peaking EQ (Biquad 형태)

오디오에서 **톤 컨트롤/파라메트릭 EQ**는 거의 모두 **2차 IIR(Biquad)** 구조로 구현된다.

- **Low-shelf / High-shelf**:  
  특정 컷오프보다 낮은/높은 대역을 전체적으로 올리거나 깎는 필터.
- **Peaking EQ**:  
  특정 중심 주파수 주변을 부스트/컷.

디지털 구현 방식:

1. 아날로그 프로토타입(예: Shelving, Peaking)의 s-domain 전송함수 사용
2. 빌리니어 변환으로 IIR 계수 변환
3. 2차 구조:

   $$
   H(z) = \frac{b_0 + b_1 z^{-1} + b_2 z^{-2}}
   {1 + a_1 z^{-1} + a_2 z^{-2}}
   $$

여기선 **Peaking EQ**의 간단한 예제를 수치적으로 만들어 보자  
(정확한 오디오 표준 공식을 따르기보다는 구조 감을 잡는 수준).

#### Peaking EQ 예제 (Octave: 구조 데모용)

```octave
clear; close all; clc;

Fs = 48000;
f0 = 1000;       % 중심 주파수 (Hz)
Q  = 4;          % Q-factor (bandwidth)
GdB = 6;         % 이득 (dB)

A = 10^(GdB/40); % amplitude ratio

w0 = 2*pi*f0/Fs;
alpha = sin(w0)/(2*Q);

b0 = 1 + alpha*A;
b1 = -2*cos(w0);
b2 = 1 - alpha*A;
a0 = 1 + alpha/A;
a1 = -2*cos(w0);
a2 = 1 - alpha/A;

% 정규화
b = [b0 b1 b2] / a0;
a = [1 a1/a0 a2/a0];

[H, w] = freqz(b, a, 4096);
f = w/(2*pi)*Fs;

figure;
plot(f, 20*log10(abs(H)+eps));
grid on;
xlabel('Frequency (Hz)'); ylabel('Magnitude (dB)');
title('Peaking EQ (f0=1kHz, Q=4, +6dB)');
xlim([0 8000]);
ylim([-12 12]);
```

이 구조는 미국/유럽 오디오 엔지니어링 문헌에서 널리 쓰이는 “표준 biquad EQ” 공식을 따른 형태다.

---

## 4. 예비 사항과 특수 필터 유형을 연결하는 관점

지금까지 정리한 “예비 사항”과 “특수 필터 유형”을 어떻게 연결해 보아야 하는가?

1. **예비 사항**  
   - IIR 필터를 이해하려면  
     - 차분방정식  
     - 전송함수와 극/영점  
     - 안정성 조건  
     - Direct Form / SOS 구조  
     를 먼저 확실히 잡아야 한다.
   - 이 단계에서 **z-평면**과 **주파수 응답**, **정규화 주파수**가 모두 자연스럽게 이해되어야 한다.

2. **특수 필터 유형(아날로그 프로토타입)**  
   - Butterworth / Chebyshev / Elliptic / Bessel은  
     - 통과대역 리플  
     - 저지대역 감쇠  
     - 전이대역 폭  
     - 군지연 특성  
     을 서로 다른 방식으로 트레이드오프한다.
   - 어떤 응용인지에 따라 패밀리를 선택해야 한다.
     - 스펙만 맞추면 되는 일반 저역통과 → Chebyshev 또는 Elliptic  
     - 시간 영역 파형 보존이 중요 → Bessel 또는 FIR 선형 위상

3. **특수 IIR 구조(Notch, Comb, Allpass, Resonator, EQ)**  
   - 필요에 따라 **아주 구체적인 목적**을 가진 필터가 필요할 때 사용한다.
   - 예:
     - 전력선 간섭(60 Hz) 제거 → Notch 필터
     - 주기적 구조를 가진 신호 강조/제거 → Comb 필터
     - 위상만 보정하고 크기는 유지 → Allpass
     - 특정 공진 모드 모델링 → Resonator
     - 음악 톤/색감 조절 → Shelving/Peaking EQ

4. **Octave 실습의 중요성**  
   - 이론만 읽고 넘어가면 감이 오지 않는다.
   - 위에서 제시한 예제들을 직접 실행하면서  
     - 극/영점 위치와 주파수 응답 사이의 관계  
     - 패밀리별 차수 차이  
     - Q, r, a 같은 파라미터가 응답에 미치는 영향  
     을 그래프로 “몸으로” 확인해야 한다.

실제 IIR 필터 설계 챕터를 쓸 때는

- (1) 예비 사항에서 위 내용을 정리하고  
- (2) Butterworth, Chebyshev, Elliptic, Bessel을 예제와 함께 설명한 뒤  
- (3) Notch/Comb/Allpass/Resonator/EQ 같은 특수 구조를 “도구 상자”처럼 나열하면서  
- (4) 각 구조에 대한 GNU Octave 스크립트를 붙여 두면,

독자가 나중에 **필요한 필터를 설계할 때 바로 가져다 쓸 수 있는 레퍼런스**가 된다.

이 글의 내용은 그런 “예비 사항 + 특수 필터 유형” 부분을 확장·보강한 초안으로 삼을 수 있을 것이다.