---
layout: post
title: 선형대수 - 이미지, 커널
date: 2025-06-10 23:20:23 +0900
category: 선형대수
---
# 이미지(Image) · 커널(Kernel)

## 한눈 요약

- **이미지** \( \mathrm{Im}(T) \): “**도달 가능한 출력**”의 전부.
  행렬 \(A\)로 보면 **열공간(Column space)**.
- **커널** \( \ker(T) \): “**0으로 사라지는 입력**”의 전부.
  행렬 \(A\)로 보면 **영공간(Null space)**, 즉 \(A\mathbf x=\mathbf 0\)의 해 공간.
- 차원 관계(랭크-널리티 정리, \(A\in\mathbb R^{m\times n}\)):
  $$
  \boxed{\ \mathrm{rank}(A)+\mathrm{nullity}(A)=n\ }.
  $$
- 직교관계(기본정리; FTLA):
  $$
  \mathrm{Col}(A)^\perp=\mathrm{Null}(A^\top),\quad
  \mathrm{Row}(A)^\perp=\mathrm{Null}(A).
  $$

---

## 정식 정의와 직관

### 이미지(Image, 상공간)

- **정의**
  $$
  \mathrm{Im}(T)=\{\,T(\mathbf v)\mid \mathbf v\in V\,\}\subseteq W.
  $$
- **행렬 관점** (\(T(\mathbf x)=A\mathbf x\)):
  $$
  \boxed{\ \mathrm{Im}(A)=\mathrm{Col}(A)=\mathrm{span}\{\text{열벡터들}\}\ }.
  $$
- **직관**: \(A\)의 **열 벡터들의 선형결합**으로 만들 수 있는 모든 출력.
  “이 변환이 도달할 수 있는 방향/공간의 전부”.

### 커널(Kernel, 영공간)

- **정의**
  $$
  \ker(T)=\{\,\mathbf v\in V\mid T(\mathbf v)=\mathbf 0\,\}.
  $$
- **행렬 관점**
  $$
  \boxed{\ \ker(A)=\{\mathbf x\in\mathbb R^n\mid A\mathbf x=\mathbf 0\}\ }.
  $$
- **직관**: 변환을 통과하면 **정보가 완전히 소멸되는 방향들**.
  같은 출력을 만드는 서로 다른 입력의 “차이”가 바로 커널.

---

## 손계산으로 이해하기: RREF(행 감소 사다리꼴)

행렬 \(A\)를 기본행연산으로 **RREF**로 바꾸면,
- 피벗 열들이 **이미지의 기저**(열공간의 기저)를 준다.
- 자유변수를 매개로 \(A\mathbf x=\mathbf 0\)을 풀면 **커널의 기저**가 나온다.

### 예제 2.1 (세로 3, 가로 2)

$$
A=\begin{bmatrix}
1 & 2\\
0 & 1\\
1 & 3
\end{bmatrix}.
$$

- **이미지**: 열 1, 열 2는 서로 독립 →
  \(\mathrm{Im}(A)=\mathrm{span}\big\{\begin{bmatrix}1\\0\\1\end{bmatrix},\begin{bmatrix}2\\1\\3\end{bmatrix}\big\}\),
  \(\mathrm{rank}(A)=2\).
- **커널**: \(A\mathbf x=\mathbf 0\) ⇒
  \(\begin{cases}x_1+2x_2=0\\ x_2=0\\ x_1+3x_2=0\end{cases}\Rightarrow x_2=0,x_1=0\).
  즉 \(\ker(A)=\{\mathbf 0\}\), \(\mathrm{nullity}=0\).
- **검산(랭크-널리티)**: \(2+0=2=n\) ✔

### 예제 2.2 (랭크 1의 2×2)

$$
A=\begin{bmatrix}
1&2\\
2&4
\end{bmatrix}.
$$
- 두 열이 종속(\(c_2=2c_1\)) → \(\mathrm{rank}=1\).
- **커널**: \(x_1+2x_2=0\Rightarrow \mathbf x=x_2(-2,1)^\top\)
  \(\ker(A)=\mathrm{span}\{(-2,1)^\top\}\), \(\mathrm{nullity}=1\).
- **이미지**: \(\mathrm{span}\{(1,2)^\top\}\) (한 줄짜리 직선).

---

## 기하학·모형 해석

- \(\mathrm{Im}(A)\): 출력 벡터가 **살아 움직이는 공간** = 데이터의 **유효 차원**.
- \(\ker(A)\): 서로 다른 입력이 **같은 출력**을 만들게 하는 “**비식별**” 방향.
- 최소제곱에서의 해 구조(과잉결정 \(m>n\)):
  - 정규방정식 \(A^\top A\mathbf x=A^\top\mathbf b\)의 해 \(\mathbf x_\ast\)는
    \(\mathbf b\)를 \(\mathrm{Col}(A)\)에 정사영한 결과 \(\mathbf p=A\mathbf x_\ast\)를 만든다.
  - 모든 해는 \(\mathbf x=\mathbf x_\ast+\mathbf z\) (\(\mathbf z\in\ker(A)\)).
    즉, **커널 방향으로는 비용이 변하지 않음**.

---

## 차원 공식과 핵심 정리

### 랭크-널리티 정리

\(A\in\mathbb R^{m\times n}\) 에 대해
$$
\boxed{\ \dim\mathrm{Im}(A)+\dim\ker(A)=n\ }.
$$

### 기본정리(FTLA, Fundamental Theorem of Linear Algebra)

- \(\mathrm{Col}(A)^\perp=\mathrm{Null}(A^\top)\).
- \(\mathrm{Row}(A)^\perp=\mathrm{Null}(A)\).
- \(\dim\mathrm{Col}(A)=\dim\mathrm{Row}(A)=\mathrm{rank}(A)\).

### 제1同型정리(First Isomorphism Theorem)

선형사상 \(T:V\to W\):
$$
V/\ker(T)\ \cong\ \mathrm{Im}(T),\qquad
\dim V=\dim\ker(T)+\dim\mathrm{Im}(T).
$$
> “입력공간에서 커널을 ‘접어’ 버리면 출력공간의 이미지와 동형.”

---

## 계산법: 안정성과 실용

### RREF (정확 구조 파악)

- 장점: 기저·자유변수 **명확**, 상징적 계산에 적합.
- 단점: 수치 오차에 민감(정수/유리수에 강함 → `sympy` 추천).

### SVD (수치 안정성 최고)

\(A=U\Sigma V^\top\) (특이값 \(\sigma_1\ge\cdots\ge\sigma_r>0\)):
- \(\mathrm{Im}(A)=\mathrm{span}\{U_{:\!,1},\ldots,U_{:\!,r}\}\).
- \(\ker(A)=\mathrm{span}\{V_{:\!,r+1},\ldots,V_{:\!,n}\}\).
- 미소 특이값을 **0으로 임계** 처리하면 **수치적 랭크**와 **근사 커널** 추정 가능.

### QR (열공간 기저)

- \(A=QR\) (`np.linalg.qr`)에서 \(Q_{:\!,1:r}\) 가 **열공간의 정규직교 기저**.

---

## 코드 실습(NumPy/SciPy/SymPy)

> 부동소수점 환경에서는 **임계값 `tol`** 로 0을 판별하세요.

```python
import numpy as np
from numpy.linalg import svd, matrix_rank
from scipy.linalg import null_space
from sympy import Matrix

# 예제 행렬들

A1 = np.array([[1, 2],
               [0, 1],
               [1, 3]], dtype=float)     # rank 2 (3x2)
A2 = np.array([[1, 2],
               [2, 4]], dtype=float)     # rank 1 (2x2)

def basis_image_via_qr(A, tol=1e-10):
    # 열공간 기저(QR)
    Q, R = np.linalg.qr(A)
    r = np.sum(np.abs(np.diag(R)) > tol)
    return Q[:, :r]

def basis_kernel_via_svd(A, tol=1e-12):
    U, S, Vt = svd(A, full_matrices=True)
    r = np.sum(S > tol)
    # Vt shape: (n, n). Nullspace basis = last n-r rows of Vt, transpose
    return Vt[r:, :].T

print("== A1 ==")
print("rank(A1) =", matrix_rank(A1))
print("image basis (QR):\n", basis_image_via_qr(A1))
print("kernel basis (SVD):\n", basis_kernel_via_svd(A1))  # expect empty (n=2, rank=2)

print("\n== A2 ==")
print("rank(A2) =", matrix_rank(A2))
print("image basis (QR):\n", basis_image_via_qr(A2))
print("kernel basis (SVD):\n", basis_kernel_via_svd(A2))

# SciPy null_space: 정규직교 기저 반환

print("\nSciPy nullspace(A2):\n", null_space(A2))

# SymPy로 정확 기저(유리수)

A2_sym = Matrix([[1, 2],[2, 4]])
print("\nSymPy nullspace(A2):", A2_sym.nullspace())  # 정확한 기저 벡터
```

### 정사영과 FTLA 확인(수치)

```python
# FTLA: Col(A)^\perp = Null(A^T)

def is_orthogonal_set(X, Y, tol=1e-10):
    # X: m x p, Y: m x q -> check X^T Y ≈ 0
    return np.allclose(X.T @ Y, 0, atol=tol)

A = A1
# 열공간 기저 Q_img (m x r)

Q_img = basis_image_via_qr(A)
# Null(A^T) 기저 (m x (m-r))

N_AT = basis_kernel_via_svd(A.T)

print("\nFTLA check for A1:")
print("dims:", Q_img.shape, N_AT.shape)
print("Col(A) ⟂ Null(A^T) ? ->", is_orthogonal_set(Q_img, N_AT))
```

---

## 실전 시나리오로 체감하기

### 선형회귀 \(A\mathbf x\approx\mathbf b\)

- \(\mathbf p=P\mathbf b\) with \(P=A(A^\top A)^{-1}A^\top=QQ^\top\) (QR 사용)
  → \(\mathbf p\in\mathrm{Im}(A)\).
- 해의 전체형:
  $$
  \mathbf x=\mathbf x_\ast+\mathbf z,\quad \mathbf z\in\ker(A).
  $$
  **커널 방향**은 비용 \(\|A\mathbf x-\mathbf b\|^2\) 를 **변화시키지 않는다**.

### 센서·특징 중복

- 특징행렬 \(A\) 열들이 종속 → \(\mathrm{rank}(A)\) 낮음 →
  상관된 센서/특징 제거(또는 주성분)로 \(\mathrm{Im}(A)\) 를 깔끔히.

### 제어·신호

- 제어가능성/관측가능성 행렬의 **랭크**로 시스템 가능/불능 판정.
  “도달가능한 상태공간”이 곧 해당 행렬의 **이미지**.

---

## 손계산 예제 더 보기

### 3×3, 랭크 2

$$
A=\begin{bmatrix}
1&1&2\\
0&1&1\\
1&2&3
\end{bmatrix}.
$$
- RREF 수행 시 피벗 열이 1,3이라면
  \(\mathrm{Im}(A)=\mathrm{span}\{(1,0,1)^\top,(2,1,3)^\top\}\), \(\mathrm{rank}=2\).
- \(\ker(A)\) 는 자유변수 1개 → \(\mathrm{nullity}=1\).
- 검산: \(2+1=3=n\).

### 사영행렬 \(P\) 의 이미지와 커널

$$
P=Q Q^\top\ (\text{정사영}),\quad P^2=P,\ P^\top=P.
$$
- \(\mathrm{Im}(P)=\mathrm{span}(Q)\).
- \(\ker(P)=\mathrm{Im}(P)^\perp\) (사영 잔차는 언제나 수직).

---

## 자주 하는 오해 · 함정

- **“열공간 vs 행공간”**: 이미지=열공간, **행공간은 \(A^\top\)의 열공간**.
  행공간의 직교여공간이 바로 \(\ker(A)\).
- **“랭크는 열/행 중 하나만 세면 된다”**: 두 값은 항상 같다(랭크 정리).
- **수치 환경**: “거의 0” 특이값을 **임계값**으로 잘라야 함(SVD 권장).
- **정방행렬만?”**: 이미지/커널은 **직사각형 행렬에도** 정의된다.

---

## 체크리스트

- [ ] \( \mathrm{rank}(A)+\mathrm{nullity}(A)=n\) 확인했는가?
- [ ] \(\mathrm{Col}(A)^\perp=\mathrm{Null}(A^\top)\) 수직성 확인했는가?
- [ ] 이미지/커널 기저를 **RREF**(정확), **SVD/QR**(수치)로 구분해 계산했는가?
- [ ] 모델(회귀·역문제)에서 **해 전체형** \( \mathbf x_\ast+\ker(A) \) 을 적었는가?

---

## 요약 표

| 개념 | 집합 | 기저 계산(권장) | 차원 |
|---|---|---|---|
| 이미지 \(\mathrm{Im}(A)\) | 가능한 모든 출력 | QR의 \(Q_{:\!,1:r}\) 또는 RREF 피벗열 | \(\mathrm{rank}(A)\) |
| 커널 \(\ker(A)\) | 0으로 가는 입력 | SVD의 \(V_{:\!,r+1:n}\) 또는 RREF 해 | \(n-\mathrm{rank}(A)\) |
| 보충관계 | \(\mathrm{Col}(A)^\perp=\mathrm{Null}(A^\top)\) | SVD로 직교 확인 | — |

---

## 한 줄 결론

> **이미지**는 “갈 수 있는 곳(출력 공간)”, **커널**은 “사라지는 방향(비식별)”이다.
> 이 둘을 연결해 주는 **랭크-널리티**와 **직교 여공간 관계**(FTLA)를 붙잡으면,
> 연립방정식/회귀/신호·제어의 구조가 한눈에 보인다.
