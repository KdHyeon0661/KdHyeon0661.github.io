---
layout: post
title: 형식언어와 오토마타 - 문맥 인식 문법과 문맥 인식 언어
date: 2025-08-05 18:20:23 +0900
category: 형식언어와 오토마타
---
# 문맥 인식 문법(Context–Sensitive Grammar, **CSG**)과 문맥 인식 언어(Context–Sensitive Language, **CSL**)

문맥 인식 언어(CSL)는 **문맥 인식 문법(CSG)** 으로 생성되거나, **선형 한정 오토마타(LBA: Linear Bounded Automaton)** 로 인식되는 언어류다.
정규·문맥자유보다 강하고(진포함), 무제한 공간의 튜링 기계(RE)보다는 약하다.
이 글은 **형식적 정의**, **Kuroda 정규형**, **LBA와의 동치**, **폐포 성질**, **결정 가능/불가능 성질**, **전형적 예시**와 **설계 패턴**, **의사코드**를 체계적으로 정리한다.

---

## 1. 문맥 인식 문법(CSG)의 정의

### 1.1 기본 정의(문맥 규칙 / 비축약성)

문맥 인식 문법 \(G=(V,\Sigma,R,S)\)의 생성 규칙은 “좌/우 **문맥**이 맞을 때만 치환”되는 꼴을 갖는다.

$$
\alpha A \beta \;\Rightarrow\; \alpha\,\gamma\,\beta
$$

- \(A\in V\) (비단말), \(\alpha,\beta\in (V\cup\Sigma)^*\) (좌·우 문맥), \(\gamma\in (V\cup\Sigma)^+\) (빈 문자열 불가).

이를 **길이 비축약(noncontracting)** 조건으로 요약하면:

$$
\alpha \Rightarrow \beta \ \text{라면 항상}\ |\alpha| \le |\beta| \quad(\ast)
$$

> 관례: \(\varepsilon\)을 허용하려면 **예외적으로** \(S\to\varepsilon\)만 허용하고, \(S\)는 어떤 규칙의 우변에도 나타나지 않게 한다(모든 유도 길이가 비축약이 되도록).

**직관**
- 유도 중 문자열 길이가 **줄어들지 않음** ⇒ 필요 공간이 입력 길이의 **선형 범위**로 제한 가능 ⇒ §3의 **LBA(선형 공간)** 와 맞닿는다.

### 1.2 Kuroda 정규형(Kuroda Normal Form)

모든 CSG는 다음 **네 형태**의 규칙만 갖는 동치 문법으로 변환 가능하다(상수 개 보조 기호 추가 허용).

$$
AB \to CD,\quad A \to BC,\quad A \to B,\quad A \to a \quad
(A,B,C,D\in V,\ a\in\Sigma)
$$

- 모든 규칙이 **비축약**이며, 지역적 패턴만 보면 되므로 **LBA 시뮬레이션**이 용이해진다.
- 실제 변환은: (i) 좌·우 문맥을 보조 기호로 끼워 넣어 **국소화**, (ii) 길이 보존/증가만 일어나게 **패딩**, (iii) 단말 도입은 **말단에서만** 하도록 정리.

---

## 2. 언어 계층과 포함 관계

$$
\boxed{\ \text{REG} \subsetneq \text{CFL} \subsetneq \textbf{CSL} \subsetneq \text{RE}\ }
$$

- 정규(REG), 문맥자유(CFL)는 **CSL의 진부분집합**.
- CSL은 RE(튜링 인식)의 **진부분집합**: 선형 공간으로 인식 불가한 RE 언어(혹은 심지어 결정 가능한 언어)들이 존재(공간 계층 정리).

---

## 3. CSG ↔ LBA(선형 한정 오토마타) — **표현력 동치**

$$
\boxed{\ \textbf{CSL} \;=\; \textbf{NLBA 인식 언어} \;=\; \mathrm{NSPACE}(O(n))\ }
$$

### 3.1 (CSG ⇒ LBA) 스케치

- 비축약성 \((\ast)\) 때문에 어떤 유도 \(S\Rightarrow^* w\) 중간의 모든 문장형 길이는 \(\le c\cdot |w|\) (상수 \(c\))로 제한 가능.
- LBA는 입력 테이프 길이만큼의 **작업 구간**(좌·우 경계 마커 포함)을 갖는 TM이다.
- LBA는 현재 문장형을 테이프에 유지하고, 규칙 \(\alpha\to\beta\)를 **국소 매칭**하여 \(\alpha\)를 \(\beta\)로 치환(좌·우로 스윕하며 탐색) ⇒ 유도 과정을 **선형 공간** 내에서 모사.

### 3.2 (LBA ⇒ CSG) 스케치

- LBA의 **구성(configuration)** 을 문자열로 코딩(상태·헤드·테이프 내용을 포함).
- 한 스텝 전이를 **문맥 규칙**으로 기술: 좌·우 이웃 문자/경계가 맞는 경우에만 해당 구간을 다음 구성으로 치환.
- 시작 구성 \(\Rightarrow^*\) 수용 구성 유도 ⇔ 입력 생성(혹은 인식).
- Kuroda NF를 쓰면 “전이 = 길이 보존/증가 국소 치환”으로 정리 가능.

> 결론: “**문맥을 보는 문법의 힘**”과 “**선형 공간 오토마타의 힘**”이 정확히 일치.

---

## 4. 폐포(닫힘) 성질

CSL은 다음 연산에 **닫혀** 있다.

- 합집합 \(\cup\), 교집합 \(\cap\), 연접(\(\cdot\)), Kleene★, **역순** \(L^R\)
- **보수(Complement)** — Immerman–Szelepcsényi 정리: \(s(n)\ge\log n\)이면 \(\mathrm{NSPACE}(s)=\mathrm{coNSPACE}(s)\)
  ⇒ \(\mathrm{NSPACE}(n)=\mathrm{coNSPACE}(n)\) ⇒ **CSL은 보수에 닫힘**
- **역호모모르피즘** \(h^{-1}(L)\), **λ-자유 호모모르피즘** \(h(L)\), **λ-자유 치환**

닫힘이 **보장되지 않는** 것: 임의 **소거(λ 포함) 호모모르피즘** 등 일부 연산.

**증 스케치 팁**
- \(\cup,\cap\): **곱 오토마타**(두 LBA 동시 시뮬) 또는 **두 인식기의 도베일링**.
- 보수: 그래프 탐색에서 **도달 불가능성**을 **비결정적**으로 증명하는 테크닉(노드 수 세기/재방문 방지)을 공간 \(O(n)\)으로 구현(Immerman–Szelepcsényi).

---

## 5. 결정(Decidability)·복잡도 성질

- **멤버십**
  - **“LBA + 입력”** 멤버십: \(\mathbf{NSPACE}(n)\)-**완전**. (구성 그래프 크기가 \(c^{O(n)}\); 비결정적 DFS/BFS로 판정)
  - **“CSG + 입력”** 멤버십: **PSPACE-완전**(고전적 결과).
    - Savitch: \(\mathrm{NSPACE}(n)\subseteq \mathrm{DSPACE}(n^2)\subseteq \mathrm{PSPACE}\).
    - 문법 멤버십은 유도 공간을 모사하는 데 **다항 공간**이 필요/충분.
- **공백성/보편성/포함성/동치성**: 일반적으로 **결정 불가능**(PCP/정지 문제 감소).
- **보수 멤버십**: 보수 닫힘 ⇒ 동일 등급에서 처리 가능.

---

## 6. 전형적 **CSL 예시**와 설계 직관

### 6.1 \(L_{abc}=\{\,a^n b^n c^n \mid n\ge 0\,\}\)

- **직관(LBA)**: 좌→우 스윕으로 미사용 \(a\) 하나를 **표시(Ā)**, 이어서 가장 왼쪽 미사용 \(b\)·\(c\)를 각각 **대응 표시**(\(\overline{b},\overline{c}\));
  우→좌로 돌아와 다음 \(a\)를 찾음. 모든 문자가 1:1 대응되면 수용, 남거나 모자라면 거절.
- **CFL이 아님**: 펌핑 보조정리/교차-일관성(무언가 2개 이상 카운터 필요) 논증.

### 6.2 \(L_{ww}=\{\,ww\mid w\in\{0,1\}^*\}\)

- **복제(reduplication)** 요구. LBA는 **테이프 절반 경계**를 추측/검증하거나, 좌에서 마킹하면서 우에서 대응 검사.

### 6.3 \(L_{\#}=\{\, w\in\{a,b,c\}^* \mid \#a(w)=\#b(w)=\#c(w)\,\}\)

- 3종류의 카운팅을 **동시에** 맞춰야 하므로 PDA(스택 1개)로는 불가.
- LBA는 **두 종류를 상대 비교**하며 남은 하나를 추적하는 마킹/스윕으로 가능.

---

## 7. **CSG 규칙 설계 패턴**(문맥 활용 미니 레시피)

> 아래 표기에서 대문자(예: \(A,B,X\))는 **비단말/표식**, 소문자(예: \(a,b,c\))는 **터미널**.

### 7.1 “표식 이동(Marker Sliding)”

```text
# X를 오른쪽으로 한 칸씩 이동
X a  ⇒  a X
X b  ⇒  b X
X c  ⇒  c X
X #  ⇒  #        # 경계에서 소거(또는 멈춤) — 비축약이 필요하면 #를 X#로 패딩 후 마지막에 교체
```

### 7.2 “짝맞춤(1:1 Matching)”

```text
# a 하나를 '사용'으로 바꾸고(Ā), 그 뒤 가장 왼쪽 미사용 b를 b̄ 로 매칭
a  ⇒  Ā
Ā b  ⇒  Ā b̄
b̄ c  ⇒  b̄ c̄
# 마지막에 Ā, b̄, c̄를 원문자로 되돌리며 위치가 맞는지 검사
```

> 실제 CSG에선 위 ‘하이레벨 규칙’을 Kuroda NF로 **국소화한 다수 규칙**으로 펼친다(문맥 조건을 보조기호로 구현).

### 7.3 “정렬(Alignment)과 정리(Cleanup)”

```text
# 보조 마커 제거/정리: (비축약성 유지 위해 치환 길이가 같거나 늘어나게 패딩)
Ā  ⇒  a
b̄ ⇒  b
c̄ ⇒  c
```

---

## 8. **a^n b^n c^n** 를 생성하는 **예시 CSG**(아이디어에 충실한 버전)

> 아래 문법은 **개념 전달용**으로, 실제론 모든 규칙을 Kuroda NF의 국소 규칙군으로 분해한다.

터미널 \(\Sigma=\{a,b,c\}\), 비단말 \(V=\{S, B, C, X, \overline{a},\overline{b},\overline{c}\}\) 등(필요 시 더 추가).

핵심 아이디어:
(1) \(S\)에서 **동시에** \(a\)/\(b\)/\(c\)의 슬롯을 생성,
(2) 마커를 이동시키며 **1:1:1 매칭**,
(3) 모든 마커 제거 시 \(a^n b^n c^n\)만 남게 한다.

```
(시작)   S      ⇒  a S B C    |    a b c
(교환)   C b    ⇒  b C
(교환)   B c    ⇒  c B
(결합)   B C    ⇒  X          # a-슬롯 하나와 b,c-슬롯 하나씩을 '결합' 표식 X로
(정리)   a X    ⇒  a b c      # a 왼쪽에서 결합 표식을 완성된 'abc'로 굳힘

# 유도 예시(스케치)
S ⇒ a S B C ⇒ a a S B C B C ⇒ … ⇒ a^n S (B C)^n
⇒ a^n X^n ⇒ a^{n-1} a X X^{n-1} ⇒ … ⇒ a^n b^n c^n
```

- 위 규칙들은 **길이 비축약**으로 설계(동일 길이 또는 증가).
- 실제 Kuroda NF로 내릴 때는 \(B C \to X\), \(a X \to a b c\) 같은 길이 변환을 **중간 비단말**들을 거쳐 **\(A\to BC, AB\to CD\)** 형태로 나눈다.
- **정밀한 완전 규칙군**은 다소 장문이 되므로, 블로그 본문에서는 **핵심 전개 흐름**과 함께 “Kuroda NF로의 분해 절차”를 별 표로 제공하는 방식을 권장.

> 검증 스케치:
> (i) \(S\Rightarrow a^n (B C)^n\) (귀납).
> (ii) 교환 규칙으로 각 \(B\)를 대응 \(C\)와 맞물리게 이동시켜 \(B C\) 인접쌍을 충분히 만든다.
> (iii) \(B C\Rightarrow X\)로 매칭, \(a X\Rightarrow a b c\)로 **순서보존** 결합.
> (iv) 전체가 소거 없이 \(a^n b^n c^n\)으로 도달.

---

## 9. **ww**(복제 언어)를 위한 LBA 설계(의사코드)

> 입력 \(x\) 길이를 \(2m\)이라 가정(길이가 홀수면 즉시 거절). 좌절반과 우절반이 같은지 검사.

```text
LBA_ww(x):
  if |x| is odd: REJECT
  place markers ⊢ x ⊣; let n := |x|
  # 1) 중앙 경계 m을 비결정적으로 '추측'하고 검증
  guess m in [0..n]  # 테이프 헤드 이동으로 경계 후보를 선택
  verify: number of symbols to the right equals m, to the left equals m
  if not verified: REJECT

  # 2) 왼쪽 i번째 미사용 문자와 오른쪽 i번째 미사용 문자가 같은지 반복 검사
  repeat m times:
    scan from left to find first unmarked symbol σ ∈ {0,1}; mark it (σ -> σ̄_L)
    scan from right to find first unmarked symbol τ ∈ {0,1}; mark it (τ -> τ̄_R)
    if σ ≠ τ: REJECT

  # 3) 모두 일치했으면 수용
  ACCEPT
```

- **공간**: 마킹은 입력 테이프 위 **그 자리에서** 수행 ⇒ **선형 공간**.
- **시간**: 최악 \(O(n^2)\) 스윕.
- **결함 처리**: 후보 경계 \(m\) 검증이 실패하면 다른 \(m\)을 **비결정적으로** 선택.

---

## 10. **멤버십 판정**을 위한 구성 그래프 탐색(의사코드)

### 10.1 LBA 멤버십 — \(\mathrm{NSPACE}(n)\) 알고리즘(BFS/DFS)

```text
LBA_Accepts(M, w):
  let Γ be tape alphabet of M; configs := set of all configurations bounded by O(|w|)
  start := initial_configuration(M, w)
  nondeterministically explore successors from start:
    if an accepting configuration is reached: ACCEPT
  # 탐색이 무한히 이어지면 비결정적으로 다른 분기를 고른다(존재 경로가 있으면 언젠가 수용)
```

- **구성 수**는 \(c^{O(n)}\) (상수 \(c=|Q|\cdot|\Gamma|\cdot O(n)\)).
- **저장 공간**은 현재 구성 + 깊이 카운터 등 **\(O(n)\)** 로 충분.

### 10.2 CSG 멤버십 — **PSPACE** 상한(도베일링 유도)

```text
CSG_Member(G, w):
  # 유도 길이가 비축약이므로 중간 문자열 길이 ≤ c·|w|
  # 심볼 표본/적용 위치만 저장하며 도베일링
  for depth = 0 .. poly(|w|):       # 다항 상한
    nondeterministically try a derivation S ⇒* w of length ≤ depth
    if success: ACCEPT
  # 실패하면 계속 시도; 결정판정기는 Savitch로 다항 공간에 압축
```

- **정확한 복잡도**: CSG 멤버십은 **PSPACE-완전**.

---

## 11. **감소(Undecidability) 스케치** — 공백성/보편성 등

- **목표**: PCP 혹은 \(A_{TM}\)에서 **CSG 공백성/보편성/포함성**으로 **many-one 감소**.
- **아이디어**: TM(혹은 Post 시스템) 계산 이력을 **Type-0 문법**으로 생성하듯, **CSG**로도 충분히 **인코딩** 가능(비축약으로 길이 관리).
  - “수용 계산이 있으면 \(G\)가 어떤 마커를 제거해 **특정 단말**을 생성한다”,
  - “수용 계산이 없으면 해당 단말은 **결코 생성되지 않는다**” 형식으로 등가 구성.
- 이로써 **공백성/보편성/포함성/동치성** 등 다수 전역 성질이 **결정 불가능**.

---

## 12. 실전 작성 체크리스트(블로그용)

- [ ] 문법은 **비축약** 확인: 모든 규칙 \(|lhs|\le|rhs|\).
- [ ] \(\varepsilon\) 필요 시 **\(S\to\varepsilon\)** 만 도입, \(S\) 우변 출현 금지.
- [ ] **Kuroda NF** 로 줄일 때: \(AB\to CD,\ A\to BC,\ A\to B,\ A\to a\) 네 가지로 분해.
- [ ] **표식(마커)** 를 적극 사용: 슬라이딩/결합/정리 규칙을 모듈화.
- [ ] LBA 모형 **등가 설명** 병기: 독자에게 “왜 선형 공간인지”를 감각으로 전달.
- [ ] **폐포표**와 **결정 성질 요약표**를 한눈에(시험/인터뷰 대비).

---

## 13. 요약 표

| 항목 | 핵심 사실 | 한 줄 설명 |
|---|---|---|
| 정의 | 문맥 규칙 / 비축약 | \(\alpha A \beta \Rightarrow \alpha\gamma\beta\), \(|lhs|\le|rhs|\) |
| 정규형 | **Kuroda** | \(AB\to CD,\ A\to BC,\ A\to B,\ A\to a\) |
| 동치 | **CSL = NLBA = NSPACE(n)** | 문맥의 힘 ↔ 선형 공간 |
| 폐포 | \(\cup,\cap,\cdot,★,R, h^{-1},(λ\text{-free }h)\), **보수** | Immerman–Szelepcsényi |
| 멤버십 | LBA: NSPACE(n)-완, CSG: **PSPACE-완** | 구성 그래프/도베일링 |
| 불가능 | 공백/보편/포함/동치 등 | PCP/정지 문제 감소 |
| 예시 | \(a^n b^n c^n\), \(ww\), \(\#a=\#b=\#c\) | 장거리 동기화/복제 |

---

## 14. 연습 문제 & 해설 힌트

1) **Kuroda NF 변환**: 임의 규칙 \(\alpha A \beta \to \alpha \gamma \beta\)를 \(AB\to CD,\ A\to BC,\ A\to B\) 유형의 **국소 규칙군**으로 분해해 보라.
   _힌트_: \(\alpha,\beta\) 를 **보조기호 레일**로 복사해 잠시 고정, 핵심 치환을 **두세 칸 반경**에서 끝낸 뒤 레일 제거.

2) **\(a^n b^n c^n\) 완전 규칙군**: §8의 개념 규칙을 실제 **비축약/국소** 규칙들로 풀어쓴 목록을 작성하라.
   _힌트_: \(B C\to X\) 는 길이 보존이므로 NF에 맞추기 쉽고, \(a X\to a b c\) 는 \(a X\to a Y,\ Y\to b Z,\ Z\to c\) 식으로 분해.

3) **LBA ww**: §9 의사코드를 실제 **상태/전이** 집합(간단 포맷)으로 적어 보라.
   _힌트_: 상태명 `q_guess`, `q_markL`, `q_markR`, `q_compare`, `q_done` 등으로 역할을 분할.

4) **보수 닫힘 직관**: 왜 \(\mathrm{NSPACE}(n)=\mathrm{coNSPACE}(n)\)이 **CFL과 차별점**이 되는지, PDA의 한계를 비교 설명하라.

---

## 15. 한 페이지 정리

- **정의**: CSG는 **문맥 의존** 비축약 재작성. \(\varepsilon\)은 \(S\to\varepsilon\)만.
- **정규형**: **Kuroda** 네 가지 규칙으로 축약 가능.
- **동치**: \(\boxed{\text{CSL}=\text{NLBA}=\mathrm{NSPACE}(n)}\).
- **폐포**: 합·교·연접·스타·역순·역호모(λ-자유)·**보수**에 닫힘.
- **복잡도**: LBA 멤버십 **NSPACE(n)-완**; CSG 멤버십 **PSPACE-완**.
- **불가능**: 공백/보편/포함/동치 다수 **Undecidable**.
- **패턴**: **마커 슬라이딩·짝맞춤·정리**, 국소 규칙군으로 설계.
- **예시**: \(a^n b^n c^n\), \(ww\), \(\#a=\#b=\#c\) — **장거리 동기화/복제**가 관건.

---

### 부록 A. 간단 “형식 검증기” 의사코드 (CSG 규칙 검증 스캐너)

```text
# 입력: G=(V, Σ, R, S), 문자열 w
# 출력: "RECOGNIZE" if G recognizes w (semi-decider style); otherwise may not halt
Recognize_CSG(G, w):
  frontier := { S }
  MaxLen := c * |w|  # c는 규칙·보조기호에 따른 안전 상수
  for steps = 0,1,2,...:
    next := ∅
    for α in frontier:
      if α == w: return RECOGNIZE
      if |α| > MaxLen: continue
      for each (ℓ -> r) in R:
        for each position i where α has ℓ at i:
          β := α with ℓ@i replaced by r
          if |β| ≤ MaxLen: next := next ∪ {β}
    frontier := frontier ∪ next
  # w ∉ L(G) 이면 종료 안 할 수 있음(반결정)
```

> 결정형 알고리즘은 Savitch 방식으로 **다항 공간** 안에서 경로 존재를 판정(PSPACE 상한).
