---
layout: post
title: 미적분 - 벡터곱
date: 2025-07-27 15:20:23 +0900
category: 미적분
---
# 벡터곱(Vector/Cross Product)

## 0) 문제의식: 벡터곱이 해결하는 일
- 두 벡터가 만드는 **평면의 “수직 방향(법선)”**을 즉시 얻는다.  
- 두 벡터가 만드는 **평행사변형 넓이**(및 삼각형 넓이)를 길이 1회 연산으로 얻는다.  
- **토크, 각운동량, 회전축** 등 “회전”과 관련된 물리량을 기술한다.  
- **면/다각형의 방향성(오리엔테이션)**, **광선-삼각형 교차**, **법선 셰이딩** 등 그래픽스 필수 로직에 직결.

---

## 1) 정의(3D에서만 진짜 벡터): 행렬식/Levi-Civita

### 1.1 표준 정의
두 벡터  
$$
\vec a=\langle a_1,a_2,a_3\rangle,\quad 
\vec b=\langle b_1,b_2,b_3\rangle
$$

벡터곱:
$$
\vec a\times \vec b
=
\begin{vmatrix}
\hat{\boldsymbol i}&\hat{\boldsymbol j}&\hat{\boldsymbol k}\\
a_1&a_2&a_3\\
b_1&b_2&b_3
\end{vmatrix}
=
\langle
a_2b_3-a_3b_2,\ 
a_3b_1-a_1b_3,\ 
a_1b_2-a_2b_1
\rangle.
$$

### 1.2 Levi-Civita 기호로
$$
(\vec a\times \vec b)_i=\sum_{j,k}\varepsilon_{ijk}a_j b_k,
\quad 
\varepsilon_{ijk}\in\{-1,0,1\}.
$$

---

## 2) 기하학적 의미 & 오른손 법칙

- **방향**: \(\vec a, \vec b\) 모두에 수직, **오른손 법칙**(엄지= \(\vec a\times \vec b\))을 따른다.  
- **크기**:  
  $$
  \|\vec a\times \vec b\|=\|\vec a\|\,\|\vec b\|\sin\theta
  $$
  → \(\vec a,\vec b\)가 만드는 **평행사변형 넓이**, 삼각형이면 절반.

- **영벡터 조건(평행)**: \(\vec a\parallel \vec b\ \iff\ \vec a\times \vec b=\vec0\).

---

## 3) 핵심 항등식(외워두면 평생 씀)

- **라그랑주 항등식**  
  $$
  \|\vec a\times \vec b\|^2=\|\vec a\|^2\|\vec b\|^2-(\vec a\cdot \vec b)^2
  $$
- **벡터 삼중곱(혼합곱) = 부피**  
  $$
  \vec a\cdot(\vec b\times \vec c)=
  \det[\vec a\ \vec b\ \vec c]
  \quad(\text{평행육면체 부피})
  $$
- **BAC–CAB(삼중곱 전개)**  
  $$
  \vec a\times(\vec b\times \vec c)=
  \vec b(\vec a\cdot \vec c)-\vec c(\vec a\cdot \vec b)
  $$
  $$
  (\vec a\times \vec b)\times \vec c=
  \vec a(\vec b\cdot \vec c)-\vec b(\vec a\cdot \vec c)
  $$

> 주의: 일반적으로 **결합법칙 불성립**: \((\vec a\times \vec b)\times \vec c\neq \vec a\times (\vec b\times \vec c)\).

---

## 4) 2D에서의 “유사” 벡터곱(스칼라 z성분)

2D 벡터 \(\vec u=(u_x,u_y)\), \(\vec v=(v_x,v_y)\)에 대해,  
“z성분 형식”의 스칼라:
$$
\operatorname{cross2D}(\vec u,\vec v)=u_x v_y - u_y v_x.
$$
- **부호 있는 넓이(오리엔테이션)**, 다각형 넓이/시계·반시계 판정에 사용.
- 3D 벡터곱의 z성분과 일치(두 벡터의 z가 0일 때).

---

## 5) 계산 관점: 수치 안정 & 정규화 팁

- 거의 평행(∥)하면 \(\|\vec a\times\vec b\|\)가 **매우 작아**서 **부동소수 오차**가 커진다.  
  → 넓이나 법선에 쓰면 **정규화 전에** 크기 체크(ε 비교).  
- 법선은 보통 **정규화**해서 쓴다: \(\hat{\boldsymbol n}=\dfrac{\vec a\times\vec b}{\|\vec a\times\vec b\|}\).  
- 면의 “앞/뒤”를 통일하려면 **정점 나열 방향(CCW/시계)**을 프로젝트 전반에서 규약화.

---

## 6) 실전 예제 (손계산)

### 예제 1 — 평행사변형/삼각형 넓이
\(\vec a=(1,2,3),\ \vec b=(4,5,6)\).
$$
\vec a\times \vec b=(-3,6,-3),\quad 
\|\vec a\times \vec b\|=\sqrt{(-3)^2+6^2+(-3)^2}=3\sqrt{6}.
$$
- 평행사변형 넓이 \(=3\sqrt6\)  
- 삼각형 넓이 \(=\dfrac12\cdot 3\sqrt6=\dfrac{3\sqrt6}{2}\)

### 예제 2 — 삼각형 법선(그래픽스)
삼각형 정점 \(P(1,0,1),Q(2,1,0),R(0,2,3)\).  
에지 \(\vec{PQ}=Q-P=(1,1,-1)\), \(\vec{PR}=R-P=(-1,2,2)\).
$$
\vec n=\vec{PQ}\times\vec{PR}
=\begin{vmatrix} \hat i&\hat j&\hat k\\1&1&-1\\-1&2&2\end{vmatrix}
=(4,-1,3).
$$
정규화: 
$$\hat{\boldsymbol n}=\dfrac{(4,-1,3)}{\sqrt{4^2+(-1)^2+3^2}}=\dfrac{(4,-1,3)}{\sqrt{26}}.$$

### 예제 3 — 토크(스패너/렌치)
축에서 힘 작용점까지 위치 \(\vec r=(0.2,0,0)\,\text{m}\),  
수직 위 방향 힘 \(\vec F=(0,50,0)\,\text{N}\).
$$
\vec\tau=\vec r\times \vec F
=
\begin{vmatrix}
\hat i&\hat j&\hat k\\
0.2&0&0\\
0&50&0
\end{vmatrix}
=(0,0,0.2\cdot 50)=(0,0,10)\ \text{N·m}.
$$
→ z축 양의 회전.

### 예제 4 — 각운동량 방향
질점 위치 \(\vec r=(1,0,0)\,\text{m}\), 선운동량 \(\vec p=(0,2,0)\,\text{kg·m/s}\).
$$
\vec L=\vec r\times \vec p
=(0,0,2)\ \text{kg·m}^2\!/\text{s}.
$$
→ z축 양의 방향, 평면 운동의 수직 축이 회전축.

### 예제 5 — 2D 오리엔테이션
\(\vec u=(2,1)\), \(\vec v=(3,4)\).
$$
\operatorname{cross2D}(\vec u,\vec v)=2\cdot 4-1\cdot 3=5>0
$$
→ \(\vec u\)에서 \(\vec v\)로 **반시계** 회전.

---

## 7) 응용 묶음

### 7.1 그래픽스/게임
- **법선 계산**(광원-재질 연산, 노멀 매핑 기준축)  
- **면의 앞뒤 판정**(백페이스 컬링): 시점 벡터와 법선 내적 부호  
- **광선-삼각형 교차**: Möller–Trumbore 알고리즘 내부에서도 에지 교차 판단에 cross 활용  
- **탄젠트-바이노멀 프레임**: \(\hat t\), \(\hat n\), \(\hat b=\hat n\times \hat t\)로 **오른손 좌표계** 구성

### 7.2 로보틱스/물리
- **토크 \(\vec\tau=\vec r\times\vec F\)**, **각운동량 \(\vec L=\vec r\times\vec p\)**  
- **회전축 방향**: 두 방향의 차이에서 **축 = \(\vec u\times\vec v\)**, 회전각은 \(\arctan2(\|\vec u\times\vec v\|,\ \vec u\cdot \vec v)\)

### 7.3 기하/계산기하
- **다각형 넓이(2D)**: 정점 \((x_i,y_i)\) CCW 나열 시  
  $$
  2A=\sum_i (x_i y_{i+1}-y_i x_{i+1})
  $$
- **선분 교차/점-다각형 내부 판정**: cross의 부호 일관성으로 CCW 유무 판별  
- **평면 회귀/법선 추정**: 점군에서 두 에지의 cross로 법선 → 정규화

---

## 8) 코드 예제

### 8.1 Python/NumPy: 기본 유틸

```python
import numpy as np

def cross(a, b):
    a = np.asarray(a, dtype=float)
    b = np.asarray(b, dtype=float)
    return np.cross(a, b)

def triangle_area(p, q, r):
    # 면적 = 0.5 * || (q-p) x (r-p) ||
    n = np.cross(np.asarray(q)-np.asarray(p),
                 np.asarray(r)-np.asarray(p))
    return 0.5 * np.linalg.norm(n)

def unit_normal(p, q, r, eps=1e-12):
    n = np.cross(np.asarray(q)-np.asarray(p),
                 np.asarray(r)-np.asarray(p))
    nrm = np.linalg.norm(n)
    if nrm < eps:
        raise ValueError("Nearly collinear points; normal is ill-defined.")
    return n / nrm

def torque(r, F):
    return np.cross(np.asarray(r, float), np.asarray(F, float))

# Demo
a = (1,2,3); b = (4,5,6)
print("a×b =", cross(a,b))               # [-3.  6. -3.]
print("△(P,Q,R) area =", triangle_area((1,0,1),(2,1,0),(0,2,3)))
print("normal =", unit_normal((1,0,1),(2,1,0),(0,2,3)))
print("torque =", torque((0.2,0,0),(0,50,0)))
```

### 8.2 C++17(Eigen): 빠른 법선/면적

```cpp
#include <Eigen/Dense>
#include <iostream>
using namespace Eigen;

int main() {
    Vector3d P(1,0,1), Q(2,1,0), R(0,2,3);
    Vector3d pq = Q - P, pr = R - P;
    Vector3d n = pq.cross(pr);
    double area = 0.5 * n.norm();
    Vector3d nhat = n.normalized();
    std::cout << "n = " << n.transpose() << "\n";
    std::cout << "triangle area = " << area << "\n";
    std::cout << "unit normal = " << nhat.transpose() << "\n";
    return 0;
}
```

### 8.3 2D 오리엔테이션 & 다각형 넓이 (Python)

```python
import numpy as np

def cross2d(u, v):
    return u[0]*v[1] - u[1]*v[0]

def orient(a,b,c):
    # >0: CCW, <0: CW, =0: collinear
    return cross2d(np.asarray(b)-np.asarray(a),
                   np.asarray(c)-np.asarray(a))

def polygon_area(vertices):
    s = 0.0
    n = len(vertices)
    for i in range(n):
        x1,y1 = vertices[i]
        x2,y2 = vertices[(i+1)%n]
        s += x1*y2 - y1*x2
    return 0.5*abs(s)

poly = [(0,0),(3,0),(3,2),(1,3),(0,2)]
print("orient(P0,P1,P2) =", orient(poly[0],poly[1],poly[2]))  # >0이면 CCW
print("polygon area =", polygon_area(poly))
```

---

## 9) 실전 시나리오

### 시나리오 A — Ray/Plane hit(법선 이용)
- 평면: 점 \(P_0\), 법선 \(\hat n\).  
- 광선: \(R(t)=O+tD\).  
교점 \(t^\*\):
$$
t^\*=\frac{\hat n\cdot(P_0-O)}{\hat n\cdot D},\ \ \hat n\cdot D\approx 0 \Rightarrow 평행.
$$
교점에서 **면의 앞뒤**: \(\operatorname{sign}(\hat n\cdot D)\).

### 시나리오 B — 회전축/각(정렬 문제)
두 정규화 방향 \(\hat u,\hat v\).  
축 \(\hat k=\dfrac{\hat u\times \hat v}{\|\hat u\times \hat v\|}\) (평행이면 임의 처리),  
각 \(\theta=\operatorname{atan2}(\|\hat u\times \hat v\|,\ \hat u\cdot \hat v)\).  
→ 회전행렬/쿼터니언 생성 가능.

### 시나리오 C — 합력의 모멘트
여러 힘 \(\vec F_i\)가 각 점 \(\vec r_i\)에서 작용:  
총 토크 
$$
\vec\tau=\sum_i \vec r_i\times \vec F_i.
$$
축 기준 변경: \(\vec r_i\to \vec r_i-\vec r_{\text{pivot}}\).

---

## 10) 자주하는 실수/주의점

- **2D에서의 “벡터곱”**: 결과가 벡터가 아니라 **스칼라(=z성분)**임을 잊지 말 것.  
- **정점 순서** 뒤집으면 법선 **부호 반전**. 광원 계산이 뒤집혀 보일 수 있음.  
- **정규화 누락**: 법선/회전축은 보통 단위벡터여야 한다.  
- **거의 평행**: 수치 오차에 취약 → ε 임계값을 두고 분기 처리.

---

## 11) 연습문제(간단 풀이 포함)

1) \(\vec a=(2,1,-1),\ \vec b=(0,3,4)\).  
   (a) \(\vec a\times \vec b\)와 크기.  
   (b) 두 벡터가 이루는 삼각형 넓이.  
   **풀이**  
   \(\vec a\times\vec b=(1\cdot4-(-1)\cdot3,\ -(2\cdot4-(-1)\cdot0),\ 2\cdot3-1\cdot0)=(7,\ -8,\ 6)\).  
   크기 \(\sqrt{49+64+36}=\sqrt{149}\). 삼각형 넓이 \(=\frac12\sqrt{149}\).

2) 점 \(P(1,2,3)\)에서 평면 \(2x-y+z-5=0\)의 법선 방향으로 길이 \(d\)만큼 이동한 점을 구하라.  
   **풀이**  
   법선 \(\vec n=(2,-1,1)\), 단위 \(\hat n=\vec n/\|\vec n\|\).  
   결과점 \(P'=P\pm d\,\hat n\).

3) 정점 \(A(0,0),B(4,0),C(4,3),D(0,3)\) 사각형 넓이를 cross2D로 구하라.  
   **풀이**  
   폴리곤 공식으로 \(2A=\sum x_i y_{i+1}-y_i x_{i+1}=24\Rightarrow A=12\).

---

## 12) 요약 표

| 목적 | 한 줄 요약 | 식 |
|---|---|---|
| 법선 | 두 에지의 수직 | $$\hat n=\dfrac{(Q-P)\times(R-P)}{\|(Q-P)\times(R-P)\|}$$ |
| 넓이 | 평행사변형/삼각형 | $$A_{\parallel}=\|\vec a\times \vec b\|,\ \ A_{\triangle}=\frac12\|\vec a\times \vec b\|$$ |
| 토크 | 회전시키는 “힘” | $$\vec\tau=\vec r\times \vec F$$ |
| 각운동량 | 회전량의 방향/크기 | $$\vec L=\vec r\times \vec p$$ |
| 2D 방향 | CCW(+)/CW(−) | $$\operatorname{cross2D}(\vec u,\vec v)=u_x v_y-u_y v_x$$ |
| 부피 | 혼합곱(삼중곱) | $$V=|\vec a\cdot(\vec b\times \vec c)|$$ |