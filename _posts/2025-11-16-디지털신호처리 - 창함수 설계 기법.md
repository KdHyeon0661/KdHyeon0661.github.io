---
layout: post
title: 디지털신호처리 - 창함수 설계 기법
date: 2025-11-16 18:25:23 +0900
category: 디지털신호처리
---
# FIR 필터 주파수 샘플링 설계 기법

앞에서

- **예비사항, 선형 위상 FIR 필터의 특성**
- **창함수(Window) 설계 기법**

을 정리하면서

- 이상적인 주파수 응답 \(H_d(e^{j\omega})\)
- 유한 길이 FIR 임펄스 응답 \(h[n]\)
- 선형 위상 FIR의 대칭 조건(4가지 타입)

을 준비해 두었다.
이번 글은 그 위에 **“주파수 샘플링(Frequency Sampling) 설계 기법”** 을 얹는 내용이다.

- 창함수법은 **시간 영역**에서 \(h_d[n]\) 에 창 \(w[n]\) 를 곱했다.
- 주파수 샘플링법은 **주파수 영역**에서 \(H_d(e^{j\omega})\) 를 직접 샘플링해서 설계한다.

즉,

- 창함수법:
  - 시간 영역에서 자름 → 주파수 응답이 부드럽게 번진다.
- 주파수 샘플링법:
  - 주파수 영역에서 점들을 지정 → 시간 영역에서 sinc 계열이 겹친다.

---

## 개요 — 주파수 샘플링 설계 기법이란?

### 기본 아이디어 한 줄 요약

주파수 샘플링 설계법의 아이디어는 다음 한 줄로 요약된다.

> “**원하는 주파수 응답을 DFT 격자에서 샘플링하고, 그 IDFT를 FIR 계수로 쓴다.**”

수식으로 쓰면:

- 원하는 디지털 필터의 주파수 응답: \(H_d(e^{j\omega})\)
- 길이 \(N\) FIR 필터 설계 (계수: \(h[0],\dots,h[N-1]\))

1. 먼저 **DFT 격자** 위에서 값 지정:
   - 각 \(k = 0,\dots,N-1\) 에 대해
     $$
     H[k] \approx H_d\!\left(e^{j\omega_k}\right), \quad
     \omega_k = \frac{2\pi k}{N}
     $$
2. 그 다음 **IDFT** 로 임펄스 응답 계산:
   $$
   h[n] = \frac{1}{N}\sum_{k=0}^{N-1} H[k] e^{j\frac{2\pi}{N}kn},
   \quad n=0,\dots,N-1
   $$

이렇게 얻은 \(h[n]\) 을 FIR 필터의 계수로 사용하면, 그 필터의 DFT는 정확히 \(H[k]\) 를 재현한다.
(단, DFT/IDFT는 **원주 주파수** 및 **순환(convolution)** 개념을 따른다.)

---

### 창함수법과 주파수 샘플링법의 비교

두 방법을 개념적으로 비교하면 다음과 같다.

| 관점                | 창함수(Window) 설계법                       | 주파수 샘플링 설계법                        |
|---------------------|----------------------------------------------|---------------------------------------------|
| 출발점              | 이상 임펄스 응답 \(h_d[n]\)                 | 이상 주파수 응답 \(H_d(e^{j\omega})\)      |
| 조작 영역           | 시간 영역(임펄스 응답 자르기)               | 주파수 영역(DFT 격자 값 지정)              |
| 핵심 연산           | 곱셈: \(h[n] = h_d[n]\cdot w[n]\)           | 샘플링 + IDFT: \(h[n] = \text{IDFT}\{H[k]\}\) |
| 주요 설계 파라미터  | 창 종류 + 길이                               | 샘플 위치 + 샘플 값 \(H[k]\)                |
| 장점                | 단순, 선형 위상 자연스러움                  | 주파수 응답 형태를 매우 직접적으로 제어 가능 |
| 단점                | 저지대역 감쇠/전이대역 폭 trade-off 고정    | 샘플링/보간 설계를 잘못하면 리플/왜곡 심함  |

주파수 샘플링법의 장점은

- **주파수 응답을 직접 조절** 가능
- 특수한 응답(예: Hilbert 변환기, differentiator 등)을 비교적 쉽게 구현

하지만, 샘플링 설계(샘플 위치, 수, 값)가 잘못되면
창함수법보다 더 나쁜 리플/왜곡을 만들 수도 있다.

---

## DFT/IDFT 복습과 주파수 샘플링 수식

### DFT/IDFT 정의

길이 \(N\) 의 시퀀스 \(h[n], n=0,\dots,N-1\) 에 대해
\(N\)-점 DFT와 IDFT는 다음과 같다.

- DFT:
  $$
  H[k] = \sum_{n=0}^{N-1} h[n] e^{-j\frac{2\pi}{N}kn},
  \quad k=0,\dots,N-1
  $$
- IDFT:
  $$
  h[n] = \frac{1}{N}\sum_{k=0}^{N-1} H[k] e^{j\frac{2\pi}{N}kn},
  \quad n=0,\dots,N-1
  $$

DFT의 중요한 해석:

- \(H[k]\) 는 **디지털 주파수** \(\omega_k = 2\pi k/N\) 에서의 **주기적 스펙트럼**이다.
- FIR 필터의 주파수 응답 \(H(e^{j\omega})\) 는
  이 값들을 부드럽게 보간한 형태로 볼 수 있다.

---

### 주파수 샘플링 설계 수식

주파수 샘플링 설계법에서는

1. 먼저 원하는 응답 \(H_d(e^{j\omega})\) 을 생각하고
2. DFT 격자 \(\omega_k = 2\pi k/N\) 에서

   $$
   H[k] = H_d\!\left(e^{j\omega_k}\right)
   $$

   로 값을 정한다.
3. 그 다음 IDFT:

   $$
   h[n] = \frac{1}{N}\sum_{k=0}^{N-1} H[k] e^{j\frac{2\pi}{N}kn}
   $$

이 \(h[n]\) 이 바로 설계된 FIR 계수이다.

---

### 순환 vs 선형 컨볼루션과 시간 정렬

DFT/IDFT 기반 설계에서는 **순환 컨볼루션** 개념이 자연스럽게 포함된다.

- \(h[n]\) 의 길이가 \(N\) 이고
- 입력 \(x[n]\) 에 \(N\)-점 DFT를 취해 필터링하면

이는 **원주(순환) 컨볼루션**에 해당한다.

필터를 **선형 컨볼루션 FIR 필터**로 사용하고 싶다면:

- 통상적으로
  - \(h[0]\) 부터 \(h[N-1]\) 까지 정의된 **비-중심(non-centered)** 임펄스 응답을 쓰거나
  - 0 위상을 맞추기 위해 **센터를 \(n = (N-1)/2\)** 로 두고 시간 시프트를 고려한다.

이 글에서는 선형 위상 FIR 중심을 \(n = (N-1)/2\) 로 잡는 관점을 유지하면서 설명한다.

---

## 실수/선형 위상 FIR을 위한 샘플링 규칙

\(H[k]\) 를 마음대로 정하면, IDFT 결과 \(h[n]\) 은 일반적으로 **복소수**가 된다.
우리가 원하는 것은

- **실수 계수** \(h[n] \in \mathbb{R}\)
- 더 나아가 **선형 위상** FIR

이기 때문에, \(H[k]\) 를 줄 때 **대칭 조건**을 맞춰줘야 한다.

---

### 실수 계수를 위한 공액 대칭 조건

\(h[n]\) 이 실수이기 위한 필요충분조건은

$$
H[k] = \overline{H[(N-k) \bmod N]}
$$

이다. 즉,

- \(k = 1,2,\dots,N-1\) 에 대해
  - 쌍 \((k, N-k)\) 사이에 **공액 대칭(conjugate symmetry)** 가 있어야 한다.
- 특별 케이스:
  - \(k=0\) (DC 성분): 반드시 실수
  - \(N\) 이 짝수일 때 \(k=N/2\) (Nyquist 주파수): 반드시 실수

요약 표:

| 인덱스 범위         | 조건                        |
|----------------------|-----------------------------|
| \(k=0\)              | \(H[0] \in \mathbb{R}\)     |
| \(k=N/2\) (N 짝수일 때) | \(H[N/2] \in \mathbb{R}\) |
| 일반 \(1\le k\le N-1\) | \(H[k] = \overline{H[N-k]}\) |

저역통과/고역통과/대역통과처럼 **실수 대역 통과/저지** 응답을 설계할 때는

- 대부분 \(H[k]\) 가 실수(0 또는 1)
- 따라서 자연스럽게 위 조건을 만족한다.

하지만 Hilbert 필터처럼 **위상만 제어**하는 경우 복소 \(H[k]\) 를 쓰기도 하므로,
그 때는 공액 대칭을 직접 확인해야 한다.

---

### 선형 위상을 위한 추가 구조

선형 위상 FIR은, 대략

$$
H(e^{j\omega}) = |H(e^{j\omega})| e^{-j\omega D}
$$

형태를 가진다. 여기서 \(D\) 는 **그룹 지연**(constant delay)이다.

주파수 샘플링법에서는 흔히 두 가지 전략을 쓴다.

1. **직접 선형 위상**을 샘플링하는 방법
2. **제로-위상(0-phase) 응답을 샘플링**한 뒤,
   전체를 시간 시프트하여 선형 위상으로 만드는 방법

두 번째 방법이 훨씬 직관적이다.

#### (1) 제로 위상 + 시간 시프트

제로 위상 FIR의 개념:

- 임펄스 응답이 중심 \(n_0\) 을 기준으로 **짝대칭**이면
- 그 주파수 응답의 위상은 0 또는 \(\pi\) (부호만)이다.

즉, **대칭 임펄스 응답의 DTFT**는 실수(부호 포함)이다.

주파수 샘플링 관점에서:

1. 먼저 제로 위상 응답 \(H_0(e^{j\omega})\) 를 설계하고,
2. 원하는 지연 \(D\) 만큼 **시간 시프트**를 적용하면:

   $$
   H(e^{j\omega}) = H_0(e^{j\omega}) e^{-j\omega D}
   $$

시간 영역에서는

$$
h[n] = h_0[n-D]
$$

(원주 정의 등 세부사항은 DFT 인덱싱에 따라 조금 조정).

보통은 **길이 \(N\) 홀수(FIR 타입 I)** 인 경우

- 중심: \(n_0 = (N-1)/2\)
- 지연: \(D = n_0\)

로 두고, 설계된 \(h[n]\) 을 그대로 쓰면 된다.

---

#### (2) 짝/홀 대칭과 DFT 샘플 대칭

선형 위상 FIR (타입 I, II, III, IV)에 대해 자세히 들어가면
DFT 인덱스 관점에서도 대칭이 등장한다. 예를 들어:

- 타입 I (길이 홀수, 짝대칭):
  - \(h[n] = h[N-1-n]\)
  - DFT \(H[k]\)는 실수 짝함수에 해당하는 형태.
- 타입 III (길이 홀수, 반대칭):
  - \(h[n] = -h[N-1-n]\)
  - \(H[k]\)는 순수 허수의 짝함수 형태.

주파수 샘플링 설계에서는 이 모든 세부를 다 파고들기보다는,

- 먼저 **실수/짝대칭 임펄스 응답**을 설계한 뒤
- `freqz` 로 위상이 실제로 선형인지 검증하고
- 필요한 경우 중심 시프트만 조정하는 실용적인 접근을 많이 쓴다.

이 글에서는 **길이 홀수, 짝대칭** FIR (타입 I)을 주로 예로 든다.

---

## 이상 저역통과를 이용한 주파수 샘플링 설계

이제 구체적인 예로 **저역통과 FIR**를 설계해 보자.
전형적인 “이상 주파수 응답 → 주파수 샘플링 → IDFT” 과정을 그대로 따른다.

### 이상 주파수 응답 정의

샘플링 주파수 \(F_s\) 에서, 이상적인 저역통과 응답을

- \(0 \le |f| \le F_c\) 에서 \(|H_d| = 1\)
- \(F_s'\le |f| \le F_s/2\) 에서 \(|H_d| = 0\)

와 같이 정의한다고 하자.
단순화를 위해 이번 섹션에서는 **전이대역(\(F_c \sim F_s'\))을 매우 좁게** 잡거나,
아예 **이상 계단**으로 취급해도 좋다.

디지털 정규화 주파수:

$$
\omega = 2\pi \frac{f}{F_s}
$$

이므로, 컷오프 \(\omega_c = 2\pi F_c/F_s\) 에 대해

$$
H_d(e^{j\omega}) =
\begin{cases}
1, & |\omega| \le \omega_c \\
0, & \omega_c < |\omega| \le \pi
\end{cases}
$$

같은 이상 응답을 생각할 수 있다.

---

### DFT 격자에서의 샘플링 규칙

길이 \(N\) FIR을 설계할 것이라 하자. DFT 격자는:

$$
\omega_k = \frac{2\pi k}{N}, \quad k=0,\dots,N-1
$$

이 때, 가장 단순한 샘플링은:

$$
H[k] =
\begin{cases}
1, & \omega_k \le \omega_c \\
0, & \omega_k > \omega_c
\end{cases}
$$

즉,

- **저주파 그리드 포인트**는 1,
- **고주파 그리드 포인트**는 0.

이렇게 정의하면 결과 FIR은 “DFT 주파수 점들에서는 정확히 이상응답을 가지는” 필터가 된다.
DFT 그리드 사이에서는 자연스럽게 **보간된 응답**이 된다.

이제 GNU Octave로 실제 예제를 보자.

---

### Octave 예제: 단순 주파수 샘플링 저역통과 FIR

사양:

- \(F_s = 48\,\text{kHz}\)
- 목표: 대략 \(F_c \approx 6\,\text{kHz}\) 저역통과
- 필터 길이: \(N = 31\) (타입 I 선형 위상 후보)

먼저 주파수 샘플들을 만들고 IDFT를 해 보자.

```octave
clear; clc; pkg load signal;

Fs = 48000;
Fc = 6000;
N  = 31;          % FIR 길이

% DFT 격자 (정규화 주파수)
k = 0:N-1;
w = 2*pi*k/N;        % [0, 2π)

wc = 2*pi*Fc/Fs;     % 컷오프 (rad/sample)

% 이상 저역통과 응답 샘플링: |H[k]| = 1 (w_k <= wc), 0 그 외
H = zeros(1, N);
H(w <= wc) = 1;

% 실수 대역 응답이므로 H[k]는 실수 (0 또는 1),
% 하지만 실수 계수를 위해 공액 대칭도 확인
% (현재 정의는 대칭 형태이므로 OK)

% IDFT → 임펄스 응답
h = ifft(H, N);

% h 결과는 일반적으로 복소수 형식을 가질 수 있으나,
% 현재 H가 실수/대칭이므로 허수부는 수치 오차 수준
h = real(h(:));   % 열 벡터로 변환

% 주파수 응답 확인
[Hf, w_plot] = freqz(h, 1, 1024);
f_plot = w_plot/pi*(Fs/2);

subplot(2,1,1);
stem(0:N-1, h, 'filled');
xlabel('n'); ylabel('h[n]');
title('주파수 샘플링으로 얻은 저역통과 FIR 계수 (N=31)');
grid on;

subplot(2,1,2);
plot(f_plot, 20*log10(abs(Hf)+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('주파수 응답 (freqz)');
grid on; axis([0 Fs/2 -80 5]);
```

이 코드를 실행해 보면:

- \(h[n]\) 이 대칭에 가까운 형태 (선형 위상 후보)
- 주파수 응답이
  - DFT 격자에서는 거의 0/1
  - 그 사이에서는 완만하게 변하는 형태

를 확인할 수 있다.

하지만 이 설계는 몇 가지 문제가 있다.

1. **중심 정렬**이 어색하다.
   - 지금의 \(h[n]\) 은 \(n=0\) 부터 \(N-1\) 까지 정의된 비대칭 시간축이다.
   - 보통 선형 위상 FIR에서는 중심 \(n_0=(N-1)/2\) 를 기준으로 symmetric 하게 쓰기를 원한다.
2. 전이대역에서의 리플/형태가 이상적이지 않을 수 있다.

다음 섹션에서 중심 정렬을 조금 더 깔끔하게 처리해 보자.

---

## 중심 정렬과 제로 위상 설계

### 제로 위상 FIR와 DFT 시프트

제로 위상 FIR의 임펄스 응답을 \(h_0[n]\) 라고 하자.
이것은 중심 \(n_0\) 에 대해 짝대칭이다.

$$
h_0[n] = h_0[2n_0 - n]
$$

이제 \(h_0[n]\) 를 시간축에서 \(n_0\) 만큼 뒤로 시프팅하면,

$$
h[n] = h_0[n - n_0]
$$

이고, 이때 주파수 응답은

$$
H(e^{j\omega}) = H_0(e^{j\omega}) e^{-j\omega n_0}
$$

가 되며, 이는 **엄밀한 선형 위상** (지연 \(n_0\)) 이다.

DFT 관점에서 시프트는 다음과 같이 구현된다.

- 시간축에서 **순환 시프트**는 주파수 축에서 **복소 지수 곱**과 대응된다.
- 실제로는 `fftshift`/`ifftshift` 등을 사용해 index를 재배치할 수 있다.

---

### 제로 위상 응답을 샘플링하고, FFT 시프트로 정렬하기

실용적인 절차:

1. 길이 \(N\) 의 **제로 위상 임펄스 응답**을 설계해서 DFT를 구한다.
2. DFT 격자에서 값을 직접 정의할 경우,
   - DC 주변에 대칭으로 샘플 값을 배치한 뒤
   - `ifftshift`/`fftshift`로 중심을 재배열하여 IDFT를 수행한다.
3. 그 결과를 **중심 \(n_0 = (N-1)/2\)** 에 대해 대칭으로 재정렬하여 FIR 계수로 쓴다.

그러나 이 절차는 인덱스 관리가 귀찮다.
그래서 실무에서는 다음과 같은 **단순화된 규칙**을 쓴다.

- **길이 홀수 \(N\)** 를 선택한다 (타입 I).
- IDFT로 얻은 \(h[n]\) 을 그냥 그대로 사용하되,
  설계할 때부터 \(H[k]\) 를 **짝대칭 실수**가 되도록 잘 선택한다.

또는, `fftshift` 를 사용해서

- \(h\) 를 중심 기준으로 재배열한 벡터를 임펄스 응답으로 사용한다.

---

### Octave: 중심 기준으로 재배열한 FIR 계수

위의 예제에서, `ifft` 결과 `h` 를 **중심 기준으로 재배열**해 보자.

```octave
clear; clc; pkg load signal;

Fs = 48000;
Fc = 6000;
N  = 31;          % 홀수 길이
k  = 0:N-1;
w  = 2*pi*k/N;
wc = 2*pi*Fc/Fs;

H  = zeros(1, N);
H(w <= wc) = 1;

h_raw = ifft(H, N);
h_raw = real(h_raw(:));   % 열 벡터

% 중심 기준으로 재배열 (시간축 시프트)
% fftshift는 주파수축용이지만, 동일한 패턴을 시간축에 써도 됨.
h_shift = fftshift(h_raw); % 중앙(N/2) 부근이 n=0으로 이동

% 이제 h_shift를 n = -(N-1)/2 ... +(N-1)/2로 생각할 수 있다.
% 선형 위상 FIR로 사용할 때는, h[n] = h_shift(n + n0) 로 쓰면 된다.
n0 = (N-1)/2;
n  = -n0:n0;

[Hf, w_plot] = freqz(h_shift, 1, 1024);  % 중심 시프트된 계수 사용
f_plot = w_plot/pi*(Fs/2);

subplot(2,1,1);
stem(n, h_shift, 'filled');
xlabel('n (centered)'); ylabel('h[n]');
title('중심 기준으로 재배열한 FIR 계수');
grid on;

subplot(2,1,2);
plot(f_plot, 20*log10(abs(Hf)+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('중심 정렬 계수를 사용한 주파수 응답');
grid on; axis([0 Fs/2 -80 5]);
```

여기서 `fftshift` 를 시간축에 썼지만, 핵심은

- **대칭 구조**와 **선형 위상**만 유지되면,
- 인덱스 관점의 정의는 유연하게 가져갈 수 있다는 것이다.

실제 구현에서는

- 필터 계수 배열에는 `h_shift` 그대로 저장해 두고
- 컨볼루션 시 표준 FIR 방식으로 사용하면 된다.

---

## 다양한 응답: 고역통과/대역통과/Hilbert/미분기

주파수 샘플링 설계법의 강점은,
저역통과뿐 아니라 여러 특수 응답들을 “직접 주파수 영역에서” 만들 수 있다는 점이다.

---

### 고역통과 필터

앞의 저역통과 예제를 약간만 바꾸면 고역통과가 된다.

이상 고역통과 응답:

$$
H_d(e^{j\omega}) =
\begin{cases}
0, & |\omega| \le \omega_c \\
1, & \omega_c < |\omega| \le \pi
\end{cases}
$$

DFT 격자에서도

$$
H[k] =
\begin{cases}
0, & \omega_k \le \omega_c \\
1, & \omega_k > \omega_c
\end{cases}
$$

로 설정하면 된다.

Octave 예제:

```octave
clear; clc; pkg load signal;

Fs = 48000;
Fc = 6000;
N  = 31;
k  = 0:N-1;
w  = 2*pi*k/N;
wc = 2*pi*Fc/Fs;

H = zeros(1, N);
H(w > wc) = 1;    % 저역은 0, 고역은 1

h = ifft(H, N);
h = real(h(:));
h = fftshift(h);  % 중심 정렬

[Hf, w_plot] = freqz(h, 1, 1024);
f_plot = w_plot/pi*(Fs/2);

subplot(2,1,1);
stem(-(N-1)/2:(N-1)/2, h, 'filled');
xlabel('n'); ylabel('h[n]');
title('주파수 샘플링 고역통과 FIR (N=31)');
grid on;

subplot(2,1,2);
plot(f_plot, 20*log10(abs(Hf)+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('크기 응답 (고역통과)');
grid on; axis([0 Fs/2 -80 5]);
```

---

### 대역통과 필터

대역통과의 이상 응답:

$$
H_d(e^{j\omega}) =
\begin{cases}
1, & \omega_1 \le |\omega| \le \omega_2 \\
0, & \text{그 외}
\end{cases}
$$

DFT 격자에서는, 저역/고역 경우보다 조금 더 신경써서
**대칭 대역**을 잡아야 한다.

정규화 주파수로:

- \(\omega_1 = 2\pi F_1/F_s\)
- \(\omega_2 = 2\pi F_2/F_s\)

이고, \(k\)-번째 그리드의 \(\omega_k\) 가 \([ \omega_1, \omega_2 ]\) 안에 있으면 \(H[k]=1\),
그 외는 0으로 하면 된다.

Octave 예제:

```octave
clear; clc; pkg load signal;

Fs = 48000;
F1 = 6000;   % passband start
F2 = 9000;   % passband end
N  = 63;     % 대역통과는 길이를 좀 늘려보자 (홀수)

k  = 0:N-1;
w  = 2*pi*k/N;
w1 = 2*pi*F1/Fs;
w2 = 2*pi*F2/Fs;

H = zeros(1, N);
H( (w >= w1 & w <= w2) | (w <= 2*pi-w1 & w >= 2*pi-w2) ) = 1;
% 위 조건은 [w1, w2] 대역과 대칭 대역에 대해 1을 주는 예시.
% (DFT 0~2π 구간에서 양쪽 대역을 고려)

h = ifft(H, N);
h = real(h(:));
h = fftshift(h);   % 중심 정렬 (선형 위상 후보)

[Hf, w_plot] = freqz(h, 1, 2048);
f_plot = w_plot/pi*(Fs/2);

subplot(2,1,1);
stem(-(N-1)/2:(N-1)/2, h, 'filled');
xlabel('n'); ylabel('h[n]');
title('주파수 샘플링 대역통과 FIR (N=63)');
grid on;

subplot(2,1,2);
plot(f_plot, 20*log10(abs(Hf)+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('대역통과 크기 응답');
grid on; axis([0 Fs/2 -80 5]);
```

주의할 점:

- `H[...] = 1` 을 줄 때
  - DFT 0~\(2\pi\) 구간에서 **양쪽 대역**을 모두 포함해야 한다.
  - 코드 예시는 간단한 논리식으로 양쪽을 한 번에 표시한 것.

---

### Hilbert 변환기 (90도 위상 이동 필터)

Hilbert 변환기는 **모든 주파수 성분을 90도 위상 이동**시키는 필터이다.

이상적인 Hilbert 변환기의 주파수 응답은 (디지털):

$$
H_d(e^{j\omega}) =
\begin{cases}
-j, & 0 < \omega < \pi \\
+j, & -\pi < \omega < 0
\end{cases}
$$

즉, 크기는 1이고 위상만 \(-90^\circ\) (양의 주파수) 또는 \(+90^\circ\) (음의 주파수)인 특수 필터다.

DFT 격자에서 이를 샘플링하면:

- DC(\(\omega=0\))와 Nyquist(\(\omega=\pi\)) 에서는 정의가 난해
  → 실제 설계에서는 0 또는 적절한 작은 값으로 처리
- 그 외 양의 주파수 \(k\) 에서는 \(H[k] = -j\)
- 음의 주파수 대역(DFT에서 \(k\) 가 큰 쪽)은 \(H[k] = +j\)

또한 **실수 계수 FIR** 을 원하면 공액 대칭 조건도 맞춰줘야 한다.

단순한 예: 길이 \(N=31\) Hilbert FIR (근삿값)

```octave
clear; clc; pkg load signal;

N = 31;
k = 0:N-1;
H = zeros(1, N);

% DFT 격자 인덱스:
% k=0           -> w=0 (DC)
% k=1..(N-1)/2  -> 양의 주파수
% k=(N+1)/2..N-1-> 음의 주파수

mid = (N-1)/2;

% 양의 주파수 영역: -j
H(2:mid) = -1j;
% 음의 주파수 영역: +j
H(mid+2:N) = +1j;

% DC와 Nyquist(N/2)는 0으로 둔다 (이상 Hilbert에서는 정의상 0)

h = ifft(H, N);
h = real(h(:));      % 실수 계수 (수치 오차 제거)
h = fftshift(h);     % 중심 정렬

[Hf, w_plot] = freqz(h, 1, 2048);
f_plot = w_plot/pi;  % 정규화 주파수 (0~1)

subplot(3,1,1);
stem(-(N-1)/2:(N-1)/2, h, 'filled');
xlabel('n'); ylabel('h[n]');
title('Hilbert 변환 FIR (N=31)');
grid on;

subplot(3,1,2);
plot(f_plot, abs(Hf));
xlabel('정규화 주파수 (\omega/\pi)'); ylabel('|H(e^{j\omega})|');
title('크기 응답');
grid on; axis([0 1 0 1.5]);

subplot(3,1,3);
plot(f_plot, unwrap(angle(Hf)));
xlabel('정규화 주파수 (\omega/\pi)'); ylabel('위상 [rad]');
title('위상 응답');
grid on;
```

이 필터는:

- 대략 \(|H|\approx 1\) (일부 대역에서는 약간 리플 있음)
- 위상이 \(-\pi/2\), \(+\pi/2\) 근처인 형태

를 보인다.
주파수 샘플링법을 쓰면 이런 **위상 필터**나 **분화기(differentiator)** 같은 특수 필터를 구현하기가 쉬워진다.

---

### 미분기(Differentiator) 예시 개념

이상적인 연속 시간 미분기는

$$
H_d(j\Omega) = j\Omega
$$

디지털로는

$$
H_d(e^{j\omega}) = j\omega
$$

에 해당하는 필터가 된다. (주파수에 비례하는 위상 기울기).
DFT 격자에서는

$$
H[k] = j\omega_k = j\frac{2\pi k}{N}
$$

형태로 샘플 값을 줄 수 있다.
실수/선형 위상 조건을 만족시키려면 마찬가지로 공액 대칭 등을 만족시키도록 정의해야 한다.

이 부분은 Hilbert와 유사한 원리이므로,
필요할 때 별도 글에서 자세히 다루면 좋다.

---

## 일반 주파수 샘플링법: 보간과 윈도우

지금까지는

- DFT 격자에서
  - 어떤 범위는 1,
  - 어떤 범위는 0

처럼 **계단형**으로 샘플 값을 줬다.
하지만 실제로는

- 격자 사이 주파수에서의 응답 형상을 좀 더 부드럽게 조절하거나
- 리플을 줄이기 위해

**주파수 도메인에서의 보간/윈도우**를 사용하기도 한다.

---

### 단순 주파수 샘플링의 한계

단순 주파수 샘플링은 다음과 같은 문제를 가진다.

1. 전이대역에서 크기 리플이 크다.
2. 디지털 주파수 축의 **중요 지점**에 정확히 그리드가 안 맞을 수 있다.
3. 일부 사양에서, 창함수법/최소 리플 설계보다 훨씬 큰 계수를 요구할 수도 있다.

이를 완화하기 위해:

- 특정 주파수들 (예: \(H(e^{j\omega})\) 가 급격히 변하는 지점) 에
  **더 촘촘하게** 샘플을 배치하고
- DFT 격자에서의 적절한 **보간/근사**를 이용하는
  **비균일 주파수 샘플링** 등도 연구되어 있다.

이 글에서는 깊게 들어가진 않고,
“샘플 값에 윈도우를 곱는” 정도의 간단한 기법만 언급한다.

---

### 주파수 영역에서의 윈도우: Gibbs 완화

시간 영역에서 창을 곱는 대신,
주파수 영역에서 **완만한 스무딩**을 한다고 생각해 보자.

- 이상 응답: 계단형
- 실제 응답: 낮은 주파수 응답은 1, 높은 주파수는 0이지만
  경계 근처에서는 0과 1 사이의 부드러운 전이

이런 식으로 주파수 샘플을 부드럽게 만들면
시간 영역에서의 **Gibbs 현상**이 완화되고,
리플이 줄어든다.

다만, 이 정도까지 고려할 거라면
실무에서는 보통 **창함수법** 또는 **최소 리플 설계**를 먼저 고려하는 편이다.

---

## GNU Octave 유틸 함수로 묶기

지금까지의 코드를 정리해서,
일반적인 “주파수 샘플링 FIR 설계”를 도와주는 유틸 함수를 몇 개 만들어 보자.

---

### 일반 주파수 샘플링 FIR 설계 함수

입력:

- 원하는 주파수 샘플 벡터 `Hk` (길이 N)
- 그에 대한 DFT 인덱스를 기준으로 FIR 설계

출력:

- FIR 계수 `h` (길이 N, 중심 정렬)

```octave
function h = fir_fsamp_from_H(Hk)
  % FIR 주파수 샘플링 설계 (일반)
  % Hk: 길이 N의 DFT 샘플 벡터 (k=0..N-1)
  % h : 길이 N FIR 계수, 중심 정렬 (fftshift 적용)

  N = length(Hk);
  h_raw = ifft(Hk(:), N);    % IDFT
  h_raw = real(h_raw);       % 실수화 (수치 오차 제거)

  % 중심 정렬
  h = fftshift(h_raw);
end
```

---

### 저역통과 전용 주파수 샘플링 함수

입력:

- `N` : 탭 수 (길이)
- `wc`: 컷오프 주파수 (rad/sample)
- `type`: `'lp'`, `'hp'`, `'bp'` 등 (고/대역통과까지 확장 가능)

간단한 저역통과 예:

```octave
function h = fir_fsamp_lpf(N, wc)
  % N: 길이
  % wc: 컷오프 (rad/sample)
  k = 0:N-1;
  w = 2*pi*k/N;

  Hk = zeros(1, N);
  Hk(w <= wc) = 1;

  h = fir_fsamp_from_H(Hk);
end
```

---

### 사용 예: fsamp_lpf vs window 설계 비교

이제 창함수법으로 설계한 것과
주파수 샘플링 설계법으로 설계한 것의 응답을 비교해 보자.

```octave
clear; clc; pkg load signal;

Fs = 48000;
Fc = 6000;
N  = 31;

wc = 2*pi*Fc/Fs;

% 주파수 샘플링 LPF
h_fs = fir_fsamp_lpf(N, wc);

% 같은 길이, Hamming 창 설계 FIR (fir1 사용)
n  = N-1;
Wn = Fc/(Fs/2);   % fir1 에서는 0~1 정규화
h_win = fir1(n, Wn, 'low', hamming(N));

[Hfs, w_plot]  = freqz(h_fs,  1, 1024);
[Hwin, ~]      = freqz(h_win, 1, 1024);
f_plot = w_plot/pi*(Fs/2);

subplot(2,1,1);
plot(f_plot, 20*log10(abs(Hfs)+eps), ...
     f_plot, 20*log10(abs(Hwin)+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('주파수 샘플링 FIR vs 창함수(Hamming) FIR');
legend('FSamp', 'Window');
grid on; axis([0 Fs/2 -100 5]);

subplot(2,1,2);
plot(f_plot, unwrap(angle(Hfs)), ...
     f_plot, unwrap(angle(Hwin)));
xlabel('Frequency [Hz]'); ylabel('Phase [rad]');
title('위상 응답 비교');
legend('FSamp', 'Window');
grid on;
```

이 비교를 통해:

- 같은 탭 수 \(N=31\) 에서
  - **주파수 샘플링 필터**의 전이대역/리플
  - **창함수 설계 필터**의 전이대역/리플
- 위상 응답은 둘 다 선형에 근접하지만,
  세부 특성에서의 차이

를 확인할 수 있다.

---

## 창함수법 vs 주파수 샘플링법 — 설계 관점 요약

지금까지의 내용을 바탕으로
두 설계법의 성격을 정리하면 다음과 같다.

### 설계 파라미터와 직관

- 창함수 설계법:
  - 입력 사양: 컷오프/전이대역/감쇠
  - 설계 파라미터: 창 종류 + 탭 수
  - 장점: 매우 직관적, 구현 간단, 선형 위상 자연스럽게 얻음
  - 단점: 리플/감쇠를 정밀하게 제어하기 어렵고,
    같은 사양에서 최소 리플 설계보다 긴 탭 수를 필요로 함.

- 주파수 샘플링 설계법:
  - 입력 사양: 여러 지점에서의 원하는 주파수 응답(크기+위상)
  - 설계 파라미터: 샘플 위치 및 샘플 값 \(H[k]\)
  - 장점: 특수 응답(Hilbert, 미분기, 진폭 보정 필터 등)에 유리
  - 단점: 샘플 값 설정이 잘못되면 리플/왜곡이 커짐,
    사양을 정량적으로 맞추기는 어렵다.

---

### 언제 주파수 샘플링법을 쓰는가?

대표적인 상황:

1. **특수 위상 응답**이 필요한 경우
   - Hilbert 변환기, 미분기(differentiator), fractional delay 필터 등
   - 주파수 샘플링 방식으로 위상/크기를 직접 지정하기 좋다.

2. **계측/보정(calibration) 필터**
   - 실제 측정한 주파수 응답 \(\hat{H}_\text{meas}(e^{j\omega})\) 를
     역보정하기 위한 보정 필터
   - 측정 데이터를 DFT 격자에서 샘플링한 뒤,
     그 역수를 취하거나, 원하는 목표 응답과의 비를 샘플링 → IDFT

3. **직관적인 “조각조각” 필터**
   - 예: 여러 대역에서 서로 다른 gain/phase를 주는 필터
   - 각 대역의 응답을 손으로 그린 뒤, sample & hold 형태로 DFT 격자에 반영

반대로:

- 단순 저역통과/대역통과/저지 필터를 설계할 때는
  **창함수법(또는 최소 리플 설계)** 이 더 안정적이고 구현도 쉬운 편이다.

---

## 간단 실습: 잡음 신호에 필터 적용

마지막으로, 설계한 주파수 샘플링 FIR을
실제 신호(두 개의 사인 + 잡음)에 적용해 보는 예제를 보자.

### 실습 시나리오

- 샘플링 주파수: \(F_s = 48 \text{kHz}\)
- 입력 신호:
  - \(1\,\text{kHz}\) 톤
  - \(8\,\text{kHz}\) 톤
  - 백색 잡음
- 목표: 0~5 kHz만 통과시키는 저역통과 필터
- 방법: 주파수 샘플링 FIR 설계 (길이 63)

### Octave 코드

```octave
clear; clc; pkg load signal;

Fs = 48000;
N  = 63;
Fc = 5000;
wc = 2*pi*Fc/Fs;

% 1) 입력 신호 생성
T  = 0.1;                 % 0.1초
t  = 0:1/Fs:T-1/Fs;
x  = 0.7*sin(2*pi*1000*t) ...
   + 0.7*sin(2*pi*8000*t) ...
   + 0.3*randn(size(t));

% 2) 주파수 샘플링 저역통과 필터 설계
h = fir_fsamp_lpf(N, wc);

% 3) 필터링
y = filter(h, 1, x);

% 4) 시간 영역 비교
subplot(3,1,1);
plot(t, x);
xlabel('Time [s]'); ylabel('x[n]');
title('입력 신호 (1 kHz + 8 kHz + 잡음)');
grid on;

subplot(3,1,2);
plot(t, y);
xlabel('Time [s]'); ylabel('y[n]');
title('출력 신호 (주파수 샘플링 LPF 통과)');
grid on;

% 5) 주파수 영역 비교 (간단 FFT)
Nfft = 4096;
X = fft(x, Nfft);
Y = fft(y, Nfft);
f = (0:Nfft-1)*(Fs/Nfft);

subplot(3,1,3);
plot(f(1:Nfft/2), 20*log10(abs(X(1:Nfft/2))+eps), ...
     f(1:Nfft/2), 20*log10(abs(Y(1:Nfft/2))+eps));
xlabel('Frequency [Hz]'); ylabel('Magnitude [dB]');
title('입력 vs 출력 스펙트럼');
legend('Input', 'Output');
grid on; axis([0 Fs/2 -80 20]);
```

실행 결과를 보면,

- 입력 신호 스펙트럼:
  - 1 kHz 성분
  - 8 kHz 성분
  - 전 대역에 퍼진 잡음
- 출력 신호 스펙트럼:
  - 1 kHz 성분은 거의 유지
  - 8 kHz 성분과 고주파 잡음은 크게 억제

하는 것을 확인할 수 있다.

---

## 연습문제 (풀이 힌트/Octave 코드 포함)

마지막으로, 글에서 다룬 내용을 복습·확장할 수 있는 연습문제를 정리한다.

### 문제 1: 사인 입력에 대한 주파수 샘플링 LPF 응답 검증

1. \(F_s = 48\text{kHz}\), \(F_c = 4\text{kHz}\), \(N=41\) 인 주파수 샘플링 저역통과 FIR을 설계하라.
2. 입력 신호를 \(x[n] = \sin(2\pi 2\text{kHz}\,n/F_s) + \sin(2\pi 10\text{kHz}\,n/F_s)\) 로 두고, 필터를 적용하라.
3. 출력 스펙트럼에서
   - 2 kHz 성분이 얼마나 남는지
   - 10 kHz 성분이 얼마나 감쇠되었는지(dB 단위로) 측정하라.

힌트:

```octave
% 설계
Fs = 48000;
Fc = 4000;
N  = 41;
wc = 2*pi*Fc/Fs;
h  = fir_fsamp_lpf(N, wc);

% 입력
T = 0.05;
t = 0:1/Fs:T-1/Fs;
x = sin(2*pi*2000*t) + sin(2*pi*10000*t);

% 필터링
y = filter(h, 1, x);
% FFT 후 각 성분의 크기 비교
```

---

### 문제 2: 대역통과 필터 설계 및 통과 대역 확인

1. \(F_s = 48\text{kHz}\), 통과대역 [6 kHz, 10 kHz]의 대역통과 필터를
   주파수 샘플링법으로 설계하라. (길이 \(N=63\))
2. 입력 신호에 3 kHz, 8 kHz, 13 kHz 성분을 모두 넣고 필터링한 후,
   통과 대역에 해당하는 8 kHz 성분만 남는지 확인하라.

힌트:

- 문제 2의 코드는 6.2 예제를 약간 수정하면 된다.
- FFT 후 3 kHz, 8 kHz, 13 kHz 근처의 주파수 성분을 각각 비교하라.

---

### 문제 3: Hilbert 변환기 응답 검증

1. 6.3의 길이 \(N=31\) Hilbert FIR을 그대로 사용하되,
   입력 신호를 \(x[n] = \cos(2\pi f_0 n/F_s)\) 로 설정하라.
2. 출력 \(y[n]\) 과 이론적인 Hilbert 변환 \(\hat{x}[n] = \sin(2\pi f_0 n/F_s)\) 를 비교하라.
3. 다양한 \(f_0\) (예: 500 Hz, 5 kHz, 10 kHz) 에 대해
   RMS 에러를 측정하고 주파수에 따라 성능이 어떻게 변하는지 관찰하라.

힌트:

```octave
% Hilbert FIR 설계 (예제 코드 재사용)
N = 31;
k = 0:N-1;
H = zeros(1, N);
mid = (N-1)/2;
H(2:mid)      = -1j;
H(mid+2:N)    = +1j;
h = fftshift(real(ifft(H)));

% 테스트
Fs = 48000; f0 = 5000;
T  = 0.05;
t  = 0:1/Fs:T-1/Fs;
x  = cos(2*pi*f0*t);
y  = filter(h, 1, x);
x_ideal = sin(2*pi*f0*t);  % 이상 Hilbert 변환
err = y - x_ideal;
RMS = sqrt(mean(err.^2));
```

---

### 문제 4: 주파수 샘플링 vs 창함수 설계의 리플 비교

1. 동일한 사양(예: \(F_s=48\text{kHz}, F_c=6\text{kHz}, N=63\)) 에 대해
   - Hamming 창 FIR (`fir1`)
   - 주파수 샘플링 FIR
   두 가지를 설계하라.
2. 둘의 주파수 응답을 겹쳐 그린 후,
   - 전이대역 폭
   - 저지대역 감쇠
   - 통과대역 리플
   을 정량적으로 비교하라.

힌트:

- `max(abs(|H_1|-|H_2|))` 등을 활용해 차이를 수치화할 수 있다.

---

### 문제 5: 측정 주파수 응답으로부터 보정 필터 만들기 (개념)

현장에서 어떤 시스템의 주파수 응답을 측정해
\(\hat{H}_\text{meas}(e^{j\omega})\) 를 얻었다고 하자.

1. DFT 격자에서 \(\hat{H}_\text{meas}[k]\) 를 알고 있다고 가정하고,
2. “원하는 목표 응답”을 \(H_\text{target}(e^{j\omega})\) 라 할 때,
3. 주파수 샘플링법으로 **보정 필터** \(H_\text{corr}[k]\) 를
   $$
   H_\text{corr}[k] = \frac{H_\text{target}[k]}{\hat{H}_\text{meas}[k]}
   $$
   형태로 정의하고 IDFT를 취하면 보정 FIR 필터를 얻을 수 있다.

연습문제:

- \(\hat{H}_\text{meas}\) 를 임의의 왜곡된 저역통과 응답으로 가정하고,
- 주파수 샘플링 설계법으로 보정 필터를 설계한 후,
- “시스템 + 보정 필터” 의 응답이 얼마나 이상값에 가까워지는지 관찰하라.

---

## 결론

이 글에서는 **FIR 필터 주파수 샘플링 설계 기법**을

- DFT/IDFT 수식과
- 실수/선형 위상 조건
- 저역통과/고역통과/대역통과/Hilbert 예제
- GNU Octave 실습 코드

까지 모두 포함하여 정리했다.

핵심 요약:

1. 주파수 샘플링법은
   $$
   h[n] = \frac{1}{N}\sum_{k=0}^{N-1} H[k] e^{j\frac{2\pi}{N}kn}
   $$
   으로 표현되는 **IDFT 기반 FIR 설계**이다.
2. 실수 계수 조건을 위해
   $$
   H[k] = \overline{H[(N-k)\bmod N]}
   $$
   공액 대칭을 맞춰야 한다.
3. 선형 위상 FIR을 위해
   - 길이 홀수, 대칭 임펄스 응답(타입 I)을 주로 사용하고
   - 필요하면 중심 정렬(fftshift 등)로 지연을 맞춘다.
4. 주파수 샘플링법은
   - 특수 위상 필터(Hilbert, 미분기)나
   - 측정/보정 필터 설계에 특히 유용하다.
5. 일반적인 LPF/BPF 설계에서는
   창함수 설계법/최소 리플 설계와 함께 비교하여
   **탭 수 vs 리플 vs 감쇠** 측면에서 적절한 방법을 선택해야 한다.

이제 “창함수 설계 기법” + “주파수 샘플링 설계 기법” 두 축이 갖춰졌으므로,
다음 단계로는

- 최소 리플(equiripple, Parks–McClellan) FIR 설계
- 최소자승 FIR 설계
- 다중레이트/Polyphase 구조
- 고정소수점/계수 양자화 영향

등을 더해 나가면, FIR 필터 설계 전반을 한 번에 꿰는 시리즈를 완성할 수 있다.
