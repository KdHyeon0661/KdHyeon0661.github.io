---
layout: post
title: 기계학습 - 계층적 군집화
date: 2025-08-19 15:25:23 +0900
category: 기계학습
---
# 계층적 군집화(Hierarchical Clustering)

## 1. 개요
**계층적 군집화(Hierarchical Clustering)**는 데이터의 **계층적 구조(Hierarchy)**를 탐색하면서 군집을 형성하는 방법입니다.  
K-평균처럼 **사전에 군집 개수 K를 지정할 필요가 없으며**, 대신 **덴드로그램(Dendrogram)**이라는 트리를 통해 군집 간의 관계를 시각적으로 표현할 수 있습니다.

- **병합적 방법(Agglomerative)**: 각 데이터 포인트에서 시작하여 점차 합쳐나가는(bottom-up).
- **분할적 방법(Divisive)**: 전체 데이터에서 시작하여 점차 쪼개나가는(top-down).

대체로 **병합적 방법**이 더 많이 사용됩니다.

---

## 2. 알고리즘 절차 (병합적 방법, Agglomerative)

1. **초기화**
   - 각 데이터 포인트를 하나의 군집으로 설정 (\(N\)개의 데이터 → \(N\)개의 군집).

2. **거리 계산**
   - 모든 군집 쌍 사이의 거리를 계산.

3. **군집 병합**
   - 가장 가까운 두 군집을 합침.

4. **거리 재계산**
   - 새로운 군집과 기존 군집 간의 거리를 다시 계산.

5. **반복**
   - 모든 데이터가 하나의 군집이 될 때까지 반복.

---

## 3. 거리 정의 (Linkage Methods)

군집 간 거리를 정의하는 방식에 따라 결과가 크게 달라집니다.

- **단일 연결(Single Linkage)**  
  두 군집 간 가장 가까운 점들의 거리  
  $$
  d(A,B) = \min_{x \in A, y \in B} \|x-y\|
  $$
  → 긴 사슬 모양(cluster chaining) 현상 발생 가능.

- **완전 연결(Complete Linkage)**  
  두 군집 간 가장 먼 점들의 거리  
  $$
  d(A,B) = \max_{x \in A, y \in B} \|x-y\|
  $$
  → 더 조밀한(closed) 군집 형성.

- **평균 연결(Average Linkage)**  
  모든 점 쌍의 평균 거리  
  $$
  d(A,B) = \frac{1}{|A||B|}\sum_{x\in A}\sum_{y\in B}\|x-y\|
  $$

- **중심 연결(Centroid Linkage)**  
  군집의 중심점 간 거리  
  $$
  d(A,B) = \| \mu_A - \mu_B \|
  $$

---

## 4. 수학적 정당성

### 4.1 목적
계층적 군집화는 K-평균처럼 명확한 "목적 함수"를 최소화하는 방식은 아닙니다. 대신, **군집 간 유사도를 기준으로 단계적으로 병합/분할**하는 탐욕적(greedy) 접근을 사용합니다.

### 4.2 병합적 알고리즘의 수학적 형태
- 초기 군집 수: \(N\)
- 반복적으로:
  $$
  (A^*,B^*) = \arg\min_{(A,B)} d(A,B)
  $$
  가장 가까운 군집 쌍 \((A,B)\)을 선택하여 병합.

---

## 5. 덴드로그램(Dendrogram)

- 트리 형태의 다이어그램으로, 데이터가 병합되는 과정을 시각적으로 표현.
- y축: 군집 간 거리.
- 적절한 높이에서 "잘라" 군집 개수를 결정.

예:
- 높이=3에서 자르면 3개의 군집 형성.
- 높이=5에서 자르면 2개의 군집 형성.

---

## 6. 장단점

### 장점
- 군집 개수를 사전에 지정할 필요 없음.
- 데이터 간 계층적 관계를 직관적으로 시각화 가능.
- 다양한 거리 척도 및 연결 방법 적용 가능.

### 단점
- 계산 복잡도 높음: \(O(n^2)\) (데이터가 많으면 느림).
- 이상치에 민감.
- 한 번 병합/분할되면 되돌릴 수 없음(탐욕적).

---

## 7. 파이썬 예제

```python
from sklearn.datasets import make_blobs
from scipy.cluster.hierarchy import dendrogram, linkage, fcluster
import matplotlib.pyplot as plt

# 데이터 생성
X, _ = make_blobs(n_samples=50, centers=3, random_state=42)

# 계층적 군집화 (ward linkage)
Z = linkage(X, method='ward')

# 덴드로그램 그리기
plt.figure(figsize=(8, 5))
dendrogram(Z)
plt.title("Hierarchical Clustering Dendrogram")
plt.xlabel("Data Index")
plt.ylabel("Distance")
plt.show()

# 특정 거리 기준으로 클러스터 나누기
clusters = fcluster(Z, t=3, criterion='maxclust')
print(clusters)
```

---

## 8. 확장 방법
- **Ward’s Method**: SSE를 최소화하는 방식으로 군집 병합 → K-평균과 유사한 효과.
- **혼합 거리 기반**: 유클리드 거리 외에도 코사인 거리, 맨해튼 거리 사용 가능.
- **Hybrid Clustering**: K-평균과 계층적 군집화를 혼합하여 초기 군집을 안정적으로 설정.

---

## 📌 요약
- 계층적 군집화는 **데이터의 계층적 구조**를 반영하며, **덴드로그램**으로 결과를 시각화.
- 군집 간 거리 정의 방식(Single, Complete, Average, Centroid)에 따라 결과가 달라짐.
- 계산량이 많아 대규모 데이터에는 비효율적이지만, 소규모 데이터 분석이나 데이터 구조 탐색에 적합.