---
layout: post
title: 미적분 - 연쇄법칙
date: 2025-06-19 19:20:23 +0900
category: 미적분
---
# 연쇄법칙 (Chain Rule)

합성함수 $$y=f(g(x))$$ 를 미분하려면 **연쇄법칙**이 필수입니다.

## 한눈에 개요

- **직관**: $$x\xrightarrow{\,g\,}u=g(x)\xrightarrow{\,f\,}y=f(u)$$. 아주 작은 $$\Delta x$$ 변화가 먼저 $$\Delta u\approx g'(x)\Delta x$$ 를 만들고, 다시 $$\Delta y\approx f'(u)\Delta u$$ 이므로
  $$\Delta y\approx f'(g(x))\,g'(x)\,\Delta x \Rightarrow \dfrac{dy}{dx}=f'(g(x))\,g'(x).$$
- **기억법**: “**밖을 미분하고, 안을 곱한다**(Outside, then multiply by inside)”.
- **확장**: 다단계 합성, 다변수(자코비안), 역함수/암시적 미분, 로그 미분, 고차(2차·헤시안, 파 브루노)까지 모두 같은 철학.

---

## 단변수 연쇄법칙

### 정의와 성립 조건

- $$f$$ 가 $$u$$ 근방에서 미분 가능, $$g$$ 가 $$x$$ 근방에서 미분 가능하고 $$u=g(x)$$ 일 때
$$
\frac{d}{dx}\,f(g(x))=f'(g(x))\,g'(x).
$$

### 표준 예제

**예제 A**: $$y=\sin(x^2)$$
외부 $$f(u)=\sin u\Rightarrow f'(u)=\cos u$$, 내부 $$g(x)=x^2\Rightarrow g'(x)=2x$$
결과 $$y'=\cos(x^2)\cdot 2x.$$

**예제 B**: $$y=\sqrt{3x+1}=(3x+1)^{1/2}$$
$$y'=\tfrac12(3x+1)^{-1/2}\cdot 3=\dfrac{3}{2\sqrt{3x+1}}.$$

**예제 C**: $$y=e^{\tan x}$$
$$y'=e^{\tan x}\cdot \sec^2 x.$$

**예제 D**: $$y=\ln(\cos x) \quad (\cos x>0)$$
$$y'=\dfrac{1}{\cos x}\cdot(-\sin x)=-\tan x.$$

---

## 다단계(중첩) 합성

합성이 여러 겹이면 **연쇄법칙을 반복**합니다.

**예제 E**: $$y=\sin^3 x=(\sin x)^3$$
$$y=(u)^3,\ u=\sin x \Rightarrow \dfrac{dy}{du}=3u^2,\ \dfrac{du}{dx}=\cos x \Rightarrow y'=3(\sin x)^2\cos x.$$

**예제 F**: $$y=\cos\!\big(\sqrt{1+x^2}\big)$$
$$u=\sqrt{1+x^2},\quad y=\cos u,\quad u'=\dfrac{x}{\sqrt{1+x^2}} \Rightarrow y'=-\sin(u)\,u'=-\sin\!\big(\sqrt{1+x^2}\big)\dfrac{x}{\sqrt{1+x^2}}.$$

**예제 G(지수의 지수)**: $$y=(x^2+1)^{\sin x}$$
로그 미분: $$\ln y=\sin x\cdot\ln(x^2+1)$$
$$\dfrac{y'}{y}=\cos x\cdot\ln(x^2+1)+\sin x\cdot\dfrac{2x}{x^2+1}$$
$$\Rightarrow y'=(x^2+1)^{\sin x}\!\left(\cos x\ln(x^2+1)+\dfrac{2x\sin x}{x^2+1}\right).$$

---

## 곱/몫과 함께 쓰는 연쇄법칙

**예제 H(곱)**: $$y=x\,\cos(x^2)$$
$$y'=1\cdot\cos(x^2)+x\cdot\big(-\sin(x^2)\cdot 2x\big)=\cos(x^2)-2x^2\sin(x^2).$$

**예제 I(몫)**: $$y=\dfrac{\sin(3x)}{x^2+1}$$
$$
y'=\frac{\ 3\cos(3x)\,(x^2+1)-\sin(3x)\cdot 2x\ }{(x^2+1)^2}.
$$

---

## 역함수·암시적 미분과 연쇄법칙

### 역함수 미분

$$
y=f^{-1}(x)\ \Rightarrow\ (f^{-1})'(x)=\frac{1}{f'(f^{-1}(x))}.
$$
**유도**: $$f(f^{-1}(x))=x$$ 를 미분하면 좌변은 연쇄법칙으로 $$f'(f^{-1}(x))\cdot (f^{-1})'(x)$$.

**예**: $$y=\ln x$$ 는 $$x=e^y$$ 의 역함수 → $$(\ln x)'=\dfrac{1}{e^{\ln x}}=\dfrac{1}{x}.$$

### 암시적 미분

$$
F(x,y)=0,\quad y=y(x)\ \Rightarrow\ \frac{dy}{dx}=-\frac{F_x}{F_y}
$$
(여기서 $$F_x,F_y$$ 는 편미분).
**예**: 원 $$x^2+y^2=1$$ → $$2x+2y\,y'=0 \Rightarrow y'=-\dfrac{x}{y}.$$

---

## 다변수(자코비안) 연쇄법칙

### 곡선에 따른 스칼라장 변화

$$
z=f(x,y),\quad x=x(t),\ y=y(t)\ \Rightarrow\
\frac{dz}{dt}=f_x\,\frac{dx}{dt}+f_y\,\frac{dy}{dt}.
$$

### 벡터형(자코비안 행렬)

$$
\mathbf{y}= \mathbf{f}(\mathbf{u}),\ \mathbf{u}=\mathbf{g}(\mathbf{x}) \ \Rightarrow\
J_{\mathbf{y}\leftarrow \mathbf{x}}=J_{\mathbf{y}\leftarrow \mathbf{u}}\cdot J_{\mathbf{u}\leftarrow \mathbf{x}}.
$$
즉, **자코비안의 곱**이 벡터형 연쇄법칙.

**예(극좌표→직교좌표)**: $$x=r\cos\theta,\ y=r\sin\theta,\ u=f(x,y)$$
$$\frac{\partial u}{\partial r}=u_x\cos\theta+u_y\sin\theta,\quad
\frac{\partial u}{\partial \theta}=-u_x r\sin\theta+u_y r\cos\theta.$$

---

## 고차 연쇄법칙 (2차, 헤시안, Faà di Bruno 스케치)

### 2차(단변수)

$$
\frac{d^2}{dx^2}f(g(x))=f''(g(x))\,[g'(x)]^2+f'(g(x))\,g''(x).
$$

**예**: $$y=\sin(x^2)$$
$$y'=\cos(x^2)\cdot 2x,\quad y''=-\sin(x^2)\cdot(2x)^2+\cos(x^2)\cdot 2 = -4x^2\sin(x^2)+2\cos(x^2).$$

### 헤시안(다변수)

$$
\nabla^2(f\circ g)(x)=J_g(x)^\top\,[\nabla^2 f](g(x))\,J_g(x)+\sum_{k} \frac{\partial f}{\partial u_k}(g(x))\,\nabla^2 g_k(x).
$$

### Faà di Bruno (개념 스냅샷)

고차 도함수의 연쇄법칙 일반형으로, 조합론적 합을 포함. 실전 계산은 상징 미분/자동미분 도구 또는 2차까지만 직접 활용하는 경우가 많습니다.

---

## 로그 미분과 연쇄법칙

곱/거듭제곱/복잡한 합성에서 구조를 단순화.

**예제 J**: $$y=\big(\sin x\big)^{\!\sqrt{x}}\ (x>0)$$
$$\ln y=\sqrt{x}\ln(\sin x) \Rightarrow \dfrac{y'}{y}=\dfrac{\ln(\sin x)}{2\sqrt{x}}+\sqrt{x}\cot x$$
$$\Rightarrow y'=(\sin x)^{\!\sqrt{x}}\!\left(\dfrac{\ln(\sin x)}{2\sqrt{x}}+\sqrt{x}\cot x\right).$$

**예제 K**: $$y=\dfrac{(x^2+1)^3\sqrt{x}}{e^{x}\sin x}\ (x>0,\ \sin x\neq 0)$$
$$
\ln y=3\ln(x^2+1)+\tfrac12\ln x - x - \ln(\sin x)
$$
$$
\Rightarrow \frac{y'}{y}=\frac{6x}{x^2+1}+\frac{1}{2x}-1-\cot x.
$$

---

## 물리·공학 “상황” 예시 (연쇄법칙 해석)

### 온도–높이–시간

고도 $$h(t)$$ 가 시간에 따라 변하고, 온도 $$T(h)$$ 가 고도의 함수면
$$
\frac{dT}{dt}= \frac{dT}{dh}\cdot \frac{dh}{dt}.
$$
- 등온층/대류권 모델에서 $$\tfrac{dT}{dh} \approx -6.5\,^\circ\!C/\text{km}$$, 상승률 $$\tfrac{dh}{dt}$$ 에 비례해 기온 변화율 계산.

### 회로·신호

출력 $$y=f(u)$$, 중간 $$u=g(x)$$, 입력 $$x$$:
이득(감도) $$\tfrac{dy}{dx}=f'(g(x))\,g'(x)$$.
비선형 증폭기 + 필터 같은 계단식 시스템의 국소 민감도 평가.

### 컴퓨터 그래픽스(감마 보정)

표시 밝기 $$L = f(V)$$ (감마 비선형), 입력톤매핑 $$V=g(x)$$ →
톤 커브 민감도 $$\tfrac{dL}{dx}=f'(g(x))g'(x)$$.

---

## 비매끄러운 합성 주의 (절댓값, max, ReLU)

- $$y=|g(x)|$$: $$g(x)\neq 0$$ 에선 $$y'=\operatorname{sgn}(g(x))\cdot g'(x)$$,
  **하지만** $$g(x)=0$$ 에서는 좌/우 미분이 다를 수 있어 미분 불가(서브그래디언트 개념 필요).
- $$y=\max\{0,g(x)\}$$(ReLU): $$g(x)>0$$ 에선 $$y'=g'(x)$$, $$g(x)<0$$ 에선 $$y'=0$$, 경계 $$g(x)=0$$ 에서 비미분.

---

## 시각화·수치 검증 코드

### 단변수 검증: $$y=\sin(x^2)$$

```python
import numpy as np
import matplotlib.pyplot as plt

x = np.linspace(-3, 3, 600)
y = np.sin(x**2)
yprime_chain = 2*x*np.cos(x**2)  # 연쇄법칙

# 유한차분 수치 도함수

h = 1e-4
y_fd = (np.sin((x+h)**2) - np.sin((x-h)**2)) / (2*h)

plt.plot(x, yprime_chain, label="연쇄법칙 도함수")
plt.plot(x, y_fd, '--', label="유한차분 근사")
plt.title("Chain Rule vs. Finite Difference")
plt.legend(); plt.grid(True); plt.show()
```

### 다변수 검증: $$f(x,y)=\ln(x^2+y^2),\ (x,y)=(r\cos\theta,r\sin\theta)$$

$$
\frac{\partial}{\partial r}f=\frac{2x\cos\theta+2y\sin\theta}{x^2+y^2}
=\frac{2r}{r^2}=\frac{2}{r}.
$$
```python
import numpy as np

r = 1.7
th = 1.2
x, y = r*np.cos(th), r*np.sin(th)
lhs = (np.log(( (r+1e-6)*np.cos(th) )**2 + ( (r+1e-6)*np.sin(th) )**2) -
       np.log(( (r-1e-6)*np.cos(th) )**2 + ( (r-1e-6)*np.sin(th) )**2)) / (2e-6)
rhs = 2/r
print("수치 ∂f/∂r ≈", lhs, "  |  이론 2/r =", rhs)
```

---

## 관련률(Related Rates) — 시간에 따른 합성

**문제 형태**: 어떤 길이/각도/면적이 시간에 따라 변할 때, 다른 변수의 시간 변화율을 구하라.

**예제 L(원 넓이)**: $$A=\pi r^2,\ r=r(t)$$
$$\frac{dA}{dt}=2\pi r\cdot \frac{dr}{dt}.$$

**예제 M(사다리 문제 스냅샷)**: 벽에 기대어 미끄러지는 사다리 길이 $$L$$ 고정, 밑변 $$x(t)$$, 높이 $$y(t)$$
$$x^2+y^2=L^2 \Rightarrow 2x\dot x+2y\dot y=0 \Rightarrow \dot y=-(x/y)\dot x.$$

---

## 극좌표·매개변수에서의 연쇄법칙

### 극좌표

$$
x=r\cos\theta,\ y=r\sin\theta,\ u=f(x,y)
$$
이면
$$
\frac{du}{dr}=u_x\cos\theta+u_y\sin\theta,\quad
\frac{du}{d\theta}=-u_x r\sin\theta+u_y r\cos\theta.
$$

### 매개변수 곡선

$$
x=x(t),\ y=y(t)\ \Rightarrow\ \frac{dy}{dx}=\frac{dy/dt}{dx/dt}\quad (dx/dt\neq 0).
$$

---

## 최적화·머신러닝: 역전파의 본질이 연쇄법칙

신경망에서 손실 $$\mathcal{L}(\mathbf{w})$$ 는 **합성 함수의 합성**.
가중치에 대한 기울기 $$\nabla_{\mathbf{w}}\mathcal{L}$$ 은 **자코비안들의 곱**으로 전파(Backpropagation).
실전에서는 자동미분(Reverse-mode AD)이 연쇄법칙을 효율적으로 전개.

---

## 자주 하는 실수 체크리스트

- [ ] **내부 도함수 빠뜨림**: $$\sin(g(x))'=\cos(g(x))\,\color{red}{g'(x)}$$.
- [ ] **정의역** 확인: $$\ln(\cos x)$$ 등은 실수 범위 제약.
- [ ] **몫/곱/합성 순서** 혼동 주의.
- [ ] **여러 겹 합성**은 단계별 변수치환(예: $$u=g(x),\ v=h(u)$$)로 정리.
- [ ] 로그 미분 후 **원래 함수 곱하기** 잊지 않기.
- [ ] 비미분점(절댓값, 최대/최소, ReLU 경계)에서 연쇄법칙을 **그대로 적용 금지**.

---

## 연습문제 (풀이 또는 스케치 포함)

**1)** $$y=\cos(5x^2-3x)$$
> $$y'=-\sin(5x^2-3x)\cdot(10x-3).$$

**2)** $$y=\sqrt{1+\sin(2x)}$$
> $$y'=\dfrac{\cos(2x)}{\sqrt{1+\sin(2x)}}.$$

**3)** $$y=\ln\!\big((x^2+1)^3\big)$$
> $$y'=\dfrac{6x}{x^2+1}.$$

**4)** $$y=e^{\,x\sin x}$$
> $$y'=e^{\,x\sin x}\,(\sin x+x\cos x).$$

**5)** $$y=\dfrac{\tan(3x)}{\sqrt{x}}\ (x>0)$$
> $$y'= \dfrac{3\sec^2(3x)\sqrt{x}-\tfrac{1}{2\sqrt{x}}\tan(3x)}{x}.$$

**6)** $$y=(\arctan x)^4$$
> $$y'=4(\arctan x)^3\cdot \dfrac{1}{1+x^2}.$$

**7)** $$y=\sin(\ln x),\ (x>0)$$
> $$y'=\cos(\ln x)\cdot \dfrac{1}{x}.$$

**8)** $$x=t^2+1,\ y=\ln(1+t) \Rightarrow \dfrac{dy}{dx}=?$$
> $$\dfrac{dy}{dx}=\dfrac{dy/dt}{dx/dt}=\dfrac{1/(1+t)}{2t}=\dfrac{1}{2t(1+t)}.$$

**9)** $$u=f(x,y),\ x=r\cos\theta,\ y=r\sin\theta \Rightarrow \dfrac{\partial u}{\partial r}=?$$
> $$u_x\cos\theta+u_y\sin\theta.$$

**10)** $$y=\ln\big(\sin(x^2+1)\big)$$ (정의역: $$\sin(x^2+1)>0$$)
> $$y'=\dfrac{\cos(x^2+1)}{\sin(x^2+1)}\cdot 2x=2x\cot(x^2+1).$$

---

## 확장 연습(해설 스케치)

**A.** $$y=\dfrac{(1+x^2)\,e^{\cos x}}{\sqrt{1-\sin x}}$$ (정의역 주의)
- 곱·몫·연쇄 결합.
- 스케치: 로그 미분 권장. $$\ln y=\ln(1+x^2)+\cos x-\tfrac12\ln(1-\sin x).$$

**B.** $$z=f(x,y)=e^{xy},\ x=t^2,\ y=\sin t$$
- $$\dfrac{dz}{dt}=z\cdot\big( y\,2t+x\,\cos t \big)=e^{t^2\sin t}\,(2t\sin t+t^2\cos t).$$

**C.** $$y=\exp\!\big(-x^2\,\sin(3x)\big)$$
- 외부 $$\exp(\cdot)$$, 내부 $$-x^2\sin(3x)$$ 미분 → 곱과 연쇄가 중첩.

---

## 마무리 요약

- **핵심 공식**: $$\displaystyle \frac{d}{dx}f(g(x))=f'(g(x))\,g'(x).$$
- **전략**: 겉을 미분해 **그대로 대입**하고, **안의 도함수**를 곱한다.
- 곱/몫/로그 미분·역함수/암시적·다변수(자코비안)·고차 미분까지 **모두 연쇄법칙의 변주**다.
- 비매끄러운 지점(절댓값, max, ReLU 등)과 정의역은 반드시 점검할 것.
- 코드/수치 검증으로 감을 잡고, 실제 “상황”(물리·신호·최적화)에서 **민감도**를 해석하라.

이제 합성함수 미분 문제를 **정의→공식→응용**으로 탄탄하게 풀어낼 수 있습니다.
