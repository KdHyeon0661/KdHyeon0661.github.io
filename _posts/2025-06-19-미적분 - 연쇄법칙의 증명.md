---
layout: post
title: 미적분 - 연쇄법칙의 증명
date: 2025-06-19 23:20:23 +0900
category: 미적분
---
# 연쇄법칙의 증명 (Proof of the Chain Rule)

합성함수 $$y=f(g(x))$$ 의 도함수는
$$
\boxed{\displaystyle \frac{d}{dx}\,f(g(x))=f'(g(x))\cdot g'(x)}
$$
입니다.

---

## 전제·기호·정의(아주 중요)

- 실함수 $$f:\mathbb{R}\to\mathbb{R}$$, $$g:\mathbb{R}\to\mathbb{R}$$.
- **가정**: $$g$$ 가 점 $$x$$ 에서 미분 가능, 그리고 $$f$$ 가 점 $$u_0=g(x)$$ 에서 미분 가능.
- 미분 가능의 **정의**(단변수):
  $$
  h\to 0 \ \Rightarrow\
  \frac{f(x+h)-f(x)}{h} \to f'(x).
  $$
- **소-오 표기**:
  $$
  r(h)=o(h)\ \Leftrightarrow\ \lim_{h\to 0}\frac{r(h)}{h}=0.
  $$

> 핵심 포인트: 연쇄법칙의 모든 증명은 “**미분 가능 ⇔ 국소적으로 선형근사 가능**”이라는 사실을 **어떤 방식으로든** 사용합니다.

---

## 표준 해석적 증명(정의 직진법)

**목표**: $$\dfrac{d}{dx}f\big(g(x)\big) = f'(g(x))\cdot g'(x)$$.

**출발**(도함수 정의):
$$
\frac{d}{dx}f(g(x))
=\lim_{h\to 0}\frac{f\big(g(x+h)\big)-f\big(g(x)\big)}{h}.
$$

**중간증분 삽입**(핵심 트릭):
$$
\frac{f(g(x+h))-f(g(x))}{h}
=
\underbrace{\frac{f(g(x+h))-f(g(x))}{g(x+h)-g(x)}}_{\text{(I)}}
\cdot
\underbrace{\frac{g(x+h)-g(x)}{h}}_{\text{(II)}}.
$$

- (II)는 $$g'(x)$$ 로 **수렴**.
- (I)에서 $$g(x+h)\to g(x)$$ 이므로, **도함수 정의**에 의해
  $$
  \frac{f(g(x+h))-f(g(x))}{g(x+h)-g(x)} \to f'(g(x)).
  $$

따라서 곱의 극한은
$$
\lim_{h\to 0}\frac{f(g(x+h))-f(g(x))}{h}
=
f'(g(x))\cdot g'(x).
$$
□

> **미세 주의**: 만약 $$g(x+h)-g(x)=0$$ 이 되는 $$h$$ 가 무한히 존재하더라도, 그 구간에서 (I)를 0으로 둘 수 있고(분자도 0), 나머지 부분열에서의 극한이 원하는 값으로 가는 것을 확인하면 됩니다. 본질은 $$g$$ 의 **연속성**(미분 가능 ⇒ 연속)과 $$f$$ 의 **도함수 정의**입니다.

---

## 잔차항(소-o) 기반의 ε–δ 엄밀 증명

**미분 가능 ⇔ 1차 선형근사 + 잔차항 소멸**:

- $$g$$ 가 $$x$$ 에서 미분 가능이면
  $$
  g(x+h)=g(x)+g'(x)\,h+\alpha(h),\quad \frac{\alpha(h)}{h}\xrightarrow[h\to 0]{}0.
  $$
- $$f$$ 가 $$u_0=g(x)$$ 에서 미분 가능이면
  $$
  f(u_0+\Delta)=f(u_0)+f'(u_0)\,\Delta+\beta(\Delta),\quad \frac{\beta(\Delta)}{\Delta}\xrightarrow[\Delta\to 0]{}0.
  $$

여기서 $$\Delta=g(x+h)-g(x)=g'(x)\,h+\alpha(h).$$
그러면
$$
\begin{aligned}
f(g(x+h))-f(g(x))
&= f'(u_0)\,\Delta+\beta(\Delta)\\
&= f'(u_0)\,(g'(x)\,h+\alpha(h))+\beta(\Delta).
\end{aligned}
$$
이를 $$h$$ 로 나누면
$$
\frac{f(g(x+h))-f(g(x))}{h}
= f'(u_0)\,g'(x) + f'(u_0)\frac{\alpha(h)}{h} + \frac{\beta(\Delta)}{h}.
$$
이때
- $$\dfrac{\alpha(h)}{h}\to 0$$,
- $$\dfrac{\beta(\Delta)}{h}=\left(\dfrac{\beta(\Delta)}{\Delta}\right)\!\left(\dfrac{\Delta}{h}\right) \to 0\cdot g'(x)=0$$
  (왜냐하면 $$\dfrac{\beta(\Delta)}{\Delta}\to 0$$, 그리고 $$\dfrac{\Delta}{h}=g'(x)+\dfrac{\alpha(h)}{h}\to g'(x)$$).

따라서
$$
\lim_{h\to 0}\frac{f(g(x+h))-f(g(x))}{h}=f'(g(x))\,g'(x).
$$
□

> 이 증명은 **ε–δ 수준의 엄밀성**을 갖추며, “미분 가능 = 선형근사 가능”을 명확히 사용합니다.

---

## 코시 평균값정리(CMVT) 기반 증명

$$h\neq 0$$ 에 대해
$$
A(t)=f(g(t)),\quad B(t)=g(t)
$$
를 두고, 구간 $$[x,x+h]$$ 에서 **Cauchy Mean Value Theorem**(코시 평균값정리)을 적용하면 **어떤** $$\xi\in(x,x+h)$$ 가 존재하여
$$
\frac{A(x+h)-A(x)}{B(x+h)-B(x)}=\frac{A'(\xi)}{B'(\xi)}.
$$
즉,
$$
\frac{f(g(x+h))-f(g(x))}{g(x+h)-g(x)}
=\frac{f'(g(\xi))\,g'(\xi)}{g'(\xi)}
=f'(g(\xi)),
$$
(단, 분모가 0이면 구간 내 적절한 점을 피하거나 극한 취급을 섬세히 다루면 동일 결론).
이제
$$
\frac{f(g(x+h))-f(g(x))}{h}
=
\underbrace{\frac{f(g(x+h))-f(g(x))}{g(x+h)-g(x)}}_{\to f'(g(x))}
\cdot
\underbrace{\frac{g(x+h)-g(x)}{h}}_{\to g'(x)}
\ \xrightarrow[h\to 0]{}\ f'(g(x))\,g'(x),
$$
여기서 $$\xi\to x$$, 연속성으로 $$f'(g(\xi))\to f'(g(x))$$. □

> CMVT 증명은 “**평균 변화율의 비 = 도함수의 비**” 라는 아이디어를 합성에 이식한 우아한 경로입니다.

---

## 선형화(가해석적 관점) 증명

미분 가능을 **선형변환 + 고차잔차**로 기술:
$$
g(x+h)=g(x)+g'(x)\,h+o(h),\qquad
f(u+\Delta)=f(u)+f'(u)\,\Delta+o(\Delta).
$$
합성하면
$$
\begin{aligned}
f(g(x+h))
&= f\big(g(x)+g'(x)\,h+o(h)\big)\\
&= f(g(x)) + f'(g(x))\big(g'(x)\,h+o(h)\big) + o(h)\\
&= f(g(x)) + f'(g(x))\,g'(x)\,h + o(h).
\end{aligned}
$$
따라서
$$
\frac{f(g(x+h))-f(g(x))}{h} \to f'(g(x))\,g'(x).
$$
□

> 이 관점은 다변수(프레셰 미분)로 자연스럽게 일반화됩니다: $$D(f\circ g)(x)=Df(g(x))\circ Dg(x)$$.

---

## 고급 확장: 다변수·선형대수 버전

### 자코비안 형태(일반 다변수)

- $$g:\mathbb{R}^n\to\mathbb{R}^m,\quad f:\mathbb{R}^m\to\mathbb{R}^k$$ 가 미분 가능.
- 자코비안(미분)의 곱:
  $$
  D\big(f\circ g\big)(x)= Df\big(g(x)\big)\cdot Dg(x).
  $$
- 좌변은 $$k\times n$$, 우변은 $$k\times m$$ 과 $$m\times n$$ 의 곱.

### 스칼라장에 대한 곡선 합성(그래디언트 버전)

- $$z=f(\mathbf{u}),\ \mathbf{u}=\mathbf{u}(t)\in\mathbb{R}^m$$:
  $$
  \frac{dz}{dt}= \nabla f(\mathbf{u}(t))^\top \cdot \frac{d\mathbf{u}}{dt}.
  $$

### 2차(헤시안) 연쇄

- 단변수:
  $$
  \frac{d^2}{dx^2}f(g(x))= f''(g(x))\,[g'(x)]^2 + f'(g(x))\,g''(x).
  $$
- 다변수(스냅샷):
  $$
  \nabla^2(f\circ g)(x)= J_g(x)^\top\,[\nabla^2 f](g(x))\,J_g(x)\ +\ \sum_{j=1}^m \frac{\partial f}{\partial u_j}(g(x))\,\nabla^2 g_j(x).
  $$

### 고차(파 브루노, Faà di Bruno) 스케치

고차 도함수는 조합론적 항(벨 다항식) 합으로 표현됩니다. 실전 계산은 보통 2차까지만 필요하며, 상징 미분/자동미분 도구가 활용됩니다.

---

## 경계·반례·주의(미분 불가능/정의역 문제)

- **정의역 확인**: $$f$$ 는 반드시 $$u_0=g(x)$$ 에서 미분 가능해야 하며, $$g$$ 는 $$x$$ 에서 미분 가능해야 합니다.
- **$$g'(x)=0$$**: 연쇄법칙은 여전히 성립(곱이 0이 될 뿐).
- **절댓값/비매끄러움**: $$f(u)=|u|$$ 는 $$u=0$$ 에서 미분 불가. 예컨대 $$g(x_0)=0$$ 이고 $$g$$ 가 매끄러워도, 합성 $$|g(x)|$$ 는 그 점에서 미분 불가일 수 있음(좌·우 기울기 다름).
- **Gateaux vs Fréchet**: 방향미분(게이트о)만 존재해도 연쇄법칙이 일반적으로 **보장되지 않습니다**. **프레셰 미분**(균일 선형근사)이 핵심.

---

## 연쇄법칙의 응용 증명들(선택)

### 역함수 미분

$$
y=f^{-1}(x)\ \Rightarrow\ (f^{-1})'(x)=\frac{1}{f'(f^{-1}(x))}.
$$
증명: $$f(f^{-1}(x))=x$$ 양변 미분 → 좌변은 연쇄법칙.

### 암시적 함수 정리

$$
F(x,y)=0,\ y=y(x)
\ \Rightarrow\
\frac{dy}{dx}=-\frac{F_x}{F_y}.
$$
증명: $$F(x,y(x))\equiv 0$$ 를 연쇄법칙으로 미분.

### 관련률(Related Rates)

합성에 시간 의존을 얹어 $$\frac{d}{dt}f(g(t))=f'(g(t))\,g'(t)$$. 물리·기하 문제에서 민감도 관계를 빠르게 연결.

---

## 증명 감각을 키우는 예제(정의→증명→계산)

### 예제 A: $$y=\sin(x^2)$$ (세 가지 관점)

- **정의 직진**: 덧셈정리+표준극한으로 직접.
- **소-o**: $$\sin(u+\Delta)=\sin u + \cos u\,\Delta+o(\Delta)$$, $$u=x^2$$, $$\Delta=2x\,h+o(h)$$ → 도함수 $$2x\cos(x^2)$$.
- **CMVT**: $$\dfrac{\sin(x^2+h)-\sin(x^2)}{h}=\underbrace{\dfrac{\sin(x^2+h)-\sin(x^2)}{(x^2+h)-x^2}}_{\to \cos(x^2)}\cdot\underbrace{\dfrac{(x^2+h)-x^2}{h}}_{\to 2x}$$.

### 예제 B: $$y=\ln(\cos x)$$ (정의역 주의: $$\cos x>0$$)

- 연쇄: 외부 $$\ln u$$, 내부 $$u=\cos x$$ → $$y'=\dfrac{1}{\cos x}\cdot(-\sin x)=-\tan x$$.

### 예제 C: $$y=e^{\tan x}$$

- 연쇄: $$y'=e^{\tan x}\cdot \sec^2 x$$.

### 예제 D: $$y=\sqrt{3x+1}=(3x+1)^{1/2}$$

- 연쇄: $$y'=\tfrac12(3x+1)^{-1/2}\cdot 3=\dfrac{3}{2\sqrt{3x+1}}$$.

---

## 수치 확인(유한차분 vs 연쇄법칙)

```python
import numpy as np
import matplotlib.pyplot as plt

# 예: y = sin(x^2), y' = 2x*cos(x^2)

x = np.linspace(-3, 3, 601)
y = np.sin(x**2)
y_chain = 2*x*np.cos(x**2)

# 중앙차분 수치 도함수

h = 1e-5
y_fd = (np.sin((x+h)**2) - np.sin((x-h)**2)) / (2*h)

plt.plot(x, y_chain, label="연쇄법칙 y' = 2x·cos(x^2)")
plt.plot(x, y_fd, '--', label="유한차분 근사")
plt.title("연쇄법칙 도함수 vs 유한차분")
plt.legend(); plt.grid(True); plt.show()
```

> 관찰: 두 곡선이 거의 일치. 수치오차는 경계/큰 곡률 부근에서 약간 증가할 수 있습니다.

---

## 실전 체크리스트(증명·적용 둘 다)

- [ ] **정의 기반 분해**: $$\dfrac{f(g(x+h))-f(g(x))}{h}=\dfrac{f(g(x+h))-f(g(x))}{g(x+h)-g(x)}\cdot\dfrac{g(x+h)-g(x)}{h}$$ 로 나눴는가?
- [ ] **연속성 연결**: $$g(x+h)\to g(x)$$, 따라서 첫 항이 $$f'(g(x))$$ 로 가는 논리를 적었는가?
- [ ] **소-o 버전**: $$g(x+h)=g(x)+g'(x)h+o(h)$$, $$f(u+\Delta)=f(u)+f'(u)\Delta+o(\Delta)$$ 에서 잔차 소멸을 분명히 했는가?
- [ ] **CMVT 버전**: 적당한 $$\xi$$ 도입과 $$\xi\to x$$ 를 명시했는가?
- [ ] **정의역/미분가능성**: $$f$$ 는 $$g(x)$$ 에서, $$g$$ 는 $$x$$ 에서 **미분 가능**인지 확인했는가?
- [ ] **비매끄러운 외부함수**: 절댓값, max, ReLU 등에서는 연쇄법칙을 그대로 쓰지 않는가?
- [ ] **다변수**: 자코비안 곱/그래디언트 내적 형태로 올바르게 썼는가?

---

## 연습 문제(증명 감각 + 계산력 강화)

1) **정의로 증명**: $$y=(x^3+1)^{1/5}$$ 의 도함수를 **소-o 방식**으로 도출하라.
   *힌트*: $$f(u)=u^{1/5}$$ 의 1차 선형근사와 $$u=x^3+1$$ 의 증분.

2) **CMVT 사용**: $$y=\arctan(\sqrt{x})\ (x>0)$$ 의 도함수를 CMVT 아이디어로 설득력 있게 유도하라.
   *답 스케치*: $$y'=\dfrac{1}{1+(\sqrt{x})^2}\cdot\dfrac{1}{2\sqrt{x}}=\dfrac{1}{2\sqrt{x}(1+x)}.$$

3) **비매끄러움**: $$y=|\cos x|$$ 에서 $$x=\dfrac{\pi}{2}$$ 부근의 미분 가능성을 판단하고, **연쇄법칙이 왜 직접 적용되지 않는지** 설명하라.
   *힌트*: 외부가 절댓값. 내부가 0이 되는 점에서 좌·우 도함수 비교.

4) **다변수 그래디언트**: $$f(x,y)=\ln(x^2+y^2),\ (x,y)=(r\cos\theta,r\sin\theta)$$. 연쇄법칙으로 $$\dfrac{\partial f}{\partial r}$$, $$\dfrac{\partial f}{\partial \theta}$$ 를 구하라.
   *답*: $$\dfrac{\partial f}{\partial r}=\dfrac{2}{r},\quad \dfrac{\partial f}{\partial \theta}=0.$$

5) **2차 연쇄**: $$y=\sin(x^2)$$ 에 대해 2차 도함수 $$y''$$ 를 **공식**으로 구하라.
   *답*: $$y''= -4x^2\sin(x^2)+2\cos(x^2).$$

6) **역함수 미분**: $$y=\ln x$$ 가 $$x=e^y$$ 의 역함수임을 이용해 도함수를 유도하라.
   *답*: $$(\ln x)'=\dfrac{1}{x}.$$

7) **로그 미분 + 연쇄**: $$y=\big(\sin x\big)^{\sqrt{x}}\ (x>0)$$ 의 도함수를 구하라.
   *답*: $$\displaystyle y'=(\sin x)^{\sqrt{x}}\!\left(\frac{\ln(\sin x)}{2\sqrt{x}}+\sqrt{x}\cot x\right).$$

---

## 한 페이지 요약

- **핵심 공식**: $$\displaystyle \frac{d}{dx}f(g(x))=f'(g(x))\,g'(x)$$.
- **증명 4총사**
  1) **정의 직진**: 중간증분 $$g(x+h)-g(x)$$ 로 분해
  2) **소-o 엄밀**: 선형근사 + 잔차 소멸
  3) **CMVT**: 평균값정리로 평균변화율의 비 → 도함수의 비
  4) **선형화**: 합성의 1차항만 추출
- **확장**: 자코비안 곱, 그래디언트 내적, 2차/헤시안, 파 브루노.
- **주의**: 외부/내부 **둘 다** 해당점에서 미분 가능해야 하며, 절댓값/최댓값 등 비매끄러움은 별도 취급.

---

## 보너스: 자동미분(AD)과 연쇄법칙

현대 최적화·딥러닝의 **역전파**는 자코비안의 곱을 효율적으로 전개하는 **연쇄법칙의 기계화**입니다.
Reverse-mode AD는 스칼라 출력에 대해 계산비용을 입력 차원에 거의 무관하게 유지합니다(자코비안 전치-벡터 곱).

```python
# 간단 수치 검증: y = exp(tan x), y' = exp(tan x)*sec^2 x

import numpy as np

def y(x):  return np.exp(np.tan(x))
def yp(x): return np.exp(np.tan(x))*(1/np.cos(x))**2

x0 = 0.7
h  = 1e-6
fd = (y(x0+h)-y(x0-h))/(2*h)
print("유한차분:", fd, " |  연쇄법칙:", yp(x0))
```

> 출력이 일치함을 확인할 수 있습니다(수치오차는 극히 작음).

---

## 마무리

연쇄법칙은 “미분 = 국소 선형화”라는 사실을 **합성에 적용**한 결과입니다.
정의·소-o·CMVT·선형화 **네 가지 관점**을 모두 익히면, 단변수·다변수·암시적·역함수·로그 미분·최적화·자동미분까지 **한 줄의 철학**으로 꿰어낼 수 있습니다:
$$
\boxed{D(f\circ g)= (Df\circ g)\cdot Dg.}
$$
