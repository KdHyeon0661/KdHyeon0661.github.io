---
layout: post
title: 디지털신호처리 - 아날로그 신호의 샘플링과 복원
date: 2025-11-08 20:25:23 +0900
category: 디지털신호처리
---
# 아날로그 신호의 샘플링과 복원

## 0. 맥락과 목표
앞선 글(이산 신호/시스템, 컨볼루션, 차분 방정식, DTFT, LTI 주파수 응답)을 토대로 **연속시간 ↔ 이산시간**을 잇는 **샘플링과 복원** 전과정을 이론→직관→실습 순으로 정리한다.
핵심 질문:
- 언제/어떻게 **연속 신호**를 **손실 없이** 샘플할 수 있는가?
- 샘플로부터 **원래 연속 신호**를 어떻게 **복원**하는가?
- 현실의 **에일리어싱, 이미지 스펙트럼, 지터, 양자화**는 무엇이며 어떻게 다루는가?

---

## 1. 이상적인 샘플링 이론

### 1.1 표기와 매핑
- 연속시간 신호: \(x(t)\), 각주파수 \(\Omega=2\pi f\) [rad/s]
- 샘플링 주기: \(T=1/f_s\); 샘플 \(x[n]=x(nT)\)
- 정규화 디지털 각주파수: \(\omega=\Omega T\in[-\pi,\pi)\)

$$
\omega=\Omega T\quad\Longleftrightarrow\quad \Omega=\frac{\omega}{T}.
$$

### 1.2 샘플링 정리(나이퀴스트–섀넌)
밴드제한 \(X(j\Omega)=0\) for \(|\Omega|>\Omega_B\)이면
$$
f_s>2f_B \quad(\text{또는 } \Omega_s=2\pi f_s>2\Omega_B)
$$
일 때 **샘플만으로 완전 복원** 가능.

### 1.3 이상 샘플링의 주파수 표현
이상 샘플링: \(x_s(t)=x(t)\sum_k\delta(t-kT)=\sum_n x[n]\delta(t-nT)\). CTFT:
$$
X_s(j\Omega)=\frac{1}{T}\sum_{k=-\infty}^{\infty}X\!\big(j(\Omega-k\Omega_s)\big),
$$
즉 **스펙트럼 복제(이미지)**가 \(\Omega_s\) 간격으로 생김.

### 1.4 이상 복원(아이디얼 저역통과 ↔ sinc 보간)
$$
x(t)=\sum_{n=-\infty}^{\infty}x[n]\ \mathrm{sinc}\!\left(\frac{t-nT}{T}\right),\qquad
\mathrm{sinc}(u)=\frac{\sin(\pi u)}{\pi u}.
$$
이상 복원은 완전하지만 **무한 지지·비인과**로 직접 구현 불가.

---

## 2. 에일리어싱과 안전 샘플링

### 2.1 에일리어싱 조건과 직관
복제 스펙트럼이 겹치면 **원복 불가**:
$$
\exists k\neq 0:\quad \big|\,\Omega\pm k\Omega_s\,\big|\le \Omega_B \ \Rightarrow \ \text{alias}.
$$
**대책**: 샘플러 전단 **AA(anti-alias) 아날로그 LPF**로 \(|\Omega|\le \Omega_B\)만 통과.

### 2.2 밴드패스 샘플링(언더샘플링) 조건(핵심식)
신호가 \([f_L, f_H]\) 대역(대역폭 \(B=f_H-f_L\))에만 있을 때,
정수 \(m\ge 1\)에 대해
$$
\frac{2f_H}{m}\le f_s \le \frac{2f_L}{m-1}\quad(\text{오른쪽은 }m\ge 2\text{일 때})
$$
를 만족하는 \(f_s\) 영역이 존재하면 **겹침 없이** 다운컨버전된 대역으로 샘플 가능. 또한 \(f_s>2B\)가 필요조건에 가깝다(정확한 불겹침은 위 구간으로 판정).

---

## 3. 이상 복원 vs. 실무 복원

### 3.1 이상 복원: sinc
- 장점: 이론적 완전 복원
- 단점: 무한 길이, 링잉(Gibbs), 구현 불가 → **윈도우드 sinc**로 근사

### 3.2 ZOH(Zero-Order Hold)
각 샘플을 \(T\) 동안 유지:
$$
h_{ZOH}(t)=\mathbf{1}_{[0,T)}(t),\qquad
H_{ZOH}(j\Omega)=T\,\mathrm{sinc}\!\left(\frac{\Omega T}{2}\right)e^{-j\Omega T/2}.
$$
- 장점: 실제 DAC 근사
- 단점: **고주파 롤오프 + 이미지** → **재구성 LPF**로 보정 필요

### 3.3 FOH(First-Order Hold)
선형 보간(삼각 펄스). ZOH보다 고주파 롤오프 완만, 위상 특성 개선.

### 3.4 재구성 체인
연속 \(x(t)\) → **AA LPF** → 샘플링(ADC) → 디지털 처리 → **DAC(ZOH/FOH)** → **재구성 LPF(AF)** → 연속 출력

---

## 4. GNU Octave로 전과정 실습(연속 근사 포함)

### 4.1 파이프라인 유틸
```octave
clear; close all; clc
pkg load signal

% 고해상도 "연속" 격자
Fref = 1e6; Tref = 1/Fref;

function t = tspan(t0, t1, Fref)
  N = floor((t1 - t0)*Fref) + 1;
  t = linspace(t0, t1, N);
endfunction

% 예시 연속신호: 1 kHz + 10 kHz
function x = x_cont(t)
  x = 0.8*cos(2*pi*1e3*t + pi/7) + 0.4*cos(2*pi*10e3*t);
endfunction

% 샘플링: x[n] = x(nT)
function [n, xn] = sample_cont(t, x, Fs)
  T = 1/Fs; n = 0:floor((t(end) - t(1))*Fs);
  ts = t(1) + n*T;
  xn = interp1(t, x, ts, "linear"); % 연속근사에서 샘플 취득
endfunction

% 이상 복원(sinc)
function xr = sinc_recon(n, xn, Fs, t_eval)
  T = 1/Fs; xr = zeros(size(t_eval));
  for k = 1:numel(n)
    xr += xn(k) .* sinc((t_eval - (n(k)*T + t_eval(1) - t_eval(1)))/T);
    % 위 식은 t=0 기준 정렬; 실제로는 shift 불필요한 동일식
  end
endfunction

% ZOH 복원
function xr = zoh_recon(n, xn, Fs, t_eval)
  T = 1/Fs; xr = zeros(size(t_eval));
  for k = 1:numel(n)
    mask = (t_eval >= (n(k))*T + t_eval(1)) & (t_eval < (n(k)+1)*T + t_eval(1));
    xr(mask) = xn(k);
  end
  xr(t_eval >= (n(end)+1)*T + t_eval(1)) = xn(end);
endfunction
```

### 4.2 나이퀴스트 만족/불만족 비교
```octave
t = tspan(0, 2e-3, Fref); x = x_cont(t);

% (A) 충분: Fs = 60 kHz (2*f_H=20 kHz보다 큼)
FsA = 60e3; [nA, xA] = sample_cont(t, x, FsA);
xA_sinc = sinc_recon(nA, xA, FsA, t);
xA_zoh  = zoh_recon(nA, xA, FsA, t);

% (B) 부족: Fs = 12 kHz
FsB = 12e3; [nB, xB] = sample_cont(t, x, FsB);
xB_sinc = sinc_recon(nB, xB, FsB, t);
xB_zoh  = zoh_recon(nB, xB, FsB, t);

subplot(2,1,1);
plot(t*1e3, x, 'k', 'linewidth', 1.5); hold on
plot(t*1e3, xA_sinc, 'b--'); plot(t*1e3, xA_zoh, 'r-.');
stem(nA*(1/FsA)*1e3, xA, 'filled'); grid on
title('Fs = 60 kHz (adequate)'); xlabel('ms'); ylabel('amp');
legend('continuous','sinc','ZOH','samples');

subplot(2,1,2);
plot(t*1e3, x, 'k', 'linewidth', 1.5); hold on
plot(t*1e3, xB_sinc, 'b--'); plot(t*1e3, xB_zoh, 'r-.');
stem(nB*(1/FsB)*1e3, xB, 'filled'); grid on
title('Fs = 12 kHz (aliasing)'); xlabel('ms'); ylabel('amp');
legend('continuous','sinc','ZOH','samples');
```

### 4.3 스펙트럼에서 이미지/에일리어싱 확인
```octave
function [F, X] = spectrum_cont_approx(x, Fref)
  N = numel(x); X = fftshift(fft(x)); F = linspace(-Fref/2, Fref/2, N);
endfunction

[F, X] = spectrum_cont_approx(x, Fref);

Nfft = 1<<18;
XA = fftshift(fft(xA, Nfft)); FA = linspace(-FsA/2, FsA/2, Nfft);
XB = fftshift(fft(xB, Nfft)); FB = linspace(-FsB/2, FsB/2, Nfft);

subplot(2,1,1);
plot(F/1e3, 20*log10(abs(X)/max(abs(X))+1e-12), 'k'); hold on
plot(FA/1e3, 20*log10(abs(XA)/max(abs(XA))+1e-12), 'b'); grid on
xlabel('kHz'); ylabel('norm dB'); title('continuous vs sampled (Fs=60 kHz)');
legend('cont(approx)','samples FFT');

subplot(2,1,2);
plot(F/1e3, 20*log10(abs(X)/max(abs(X))+1e-12), 'k'); hold on
plot(FB/1e3, 20*log10(abs(XB)/max(abs(XB))+1e-12), 'r'); grid on
xlabel('kHz'); ylabel('norm dB'); title('continuous vs sampled (Fs=12 kHz)');
legend('cont(approx)','samples FFT');
```

### 4.4 Anti-Alias 필터 효과(수치 모사)
```octave
Fc_AA = 6e3; Wn = Fc_AA/(Fref/2);
b_AA = fir1(511, Wn, hamming(512)); x_AA = filtfilt(b_AA, 1, x);

[nB2, xB2] = sample_cont(t, x_AA, FsB);
xB2_sinc = sinc_recon(nB2, xB2, FsB, t);

plot(t*1e3, x, 'k'); hold on
plot(t*1e3, xB_sinc, 'r--');        % AA 없이
plot(t*1e3, xB2_sinc, 'b-'); grid on % AA 적용
legend('cont','sinc(no AA)','sinc(with AA)');
title('Anti-Alias 필터 적용 효과 (Fs=12 kHz)'); xlabel('ms');
```

### 4.5 DAC 후 이미지 제거(재구성 LPF)
```octave
Fs = FsA; [na, xa] = sample_cont(t, x, Fs);
x_zoh = zoh_recon(na, xa, Fs, t);

Fc_AF = 0.45*Fs; W2 = Fc_AF/(Fref/2);
b_AF = fir1(511, W2, hamming(512)); x_rec = filtfilt(b_AF, 1, x_zoh);

plot(t*1e3, x, 'k', 'linewidth', 1.5); hold on
plot(t*1e3, x_zoh, 'r-.'); plot(t*1e3, x_rec, 'b--'); grid on
legend('continuous','ZOH only','ZOH + AF'); xlabel('ms'); ylabel('amp');
title('재구성 LPF로 ZOH 이미지 억제');
```

---

## 5. 밴드패스 샘플링(언더샘플링) 실험

### 5.1 설정과 이론
\(f_c=150\,\text{kHz}\) 정현파, \(f_s=60\,\text{kHz}\)로 샘플 시
$$
f_{\text{alias}} = |\,f_c - m f_s\,|,\quad m=\left\lfloor \frac{f_c}{f_s}+\tfrac{1}{2}\right\rfloor \Rightarrow 30\ \text{kHz}.
$$

### 5.2 Octave
```octave
Fref=10e6; t=tspan(0, 2e-3, Fref);
fc=150e3; x=cos(2*pi*fc*t);

Fs=60e3; [n, xs] = sample_cont(t, x, Fs);
Nfft=1<<18; Xs=fft(xs, Nfft);
f=(0:Nfft-1)*Fs/Nfft; [~,k]=max(abs(Xs(1:Nfft/2)));
f_alias=f(k);
printf("alias frequency ≈ %.1f kHz (theory 30 kHz)\n", f_alias/1e3);
```

---

## 6. 이상 복원의 현실적 구현: 윈도우드 sinc·FOH

### 6.1 윈도우드 sinc 보간기(유한 커널)
```octave
function y = wsinc_recon(n, x, Fs, t_eval, L)
  T=1/Fs; y=zeros(size(t_eval));
  for k=1:numel(n)
    tau=(t_eval - n(k)*T)/T; mask=(abs(tau)<=L);
    tw = tau(mask);
    w = 0.42 + 0.5*cos(pi*tw/L) + 0.08*cos(2*pi*tw/L); % Blackman
    y(mask) += x(k) .* sinc(tw) .* w;
  end
endfunction

% 테스트
Fs=60e3; [n, xs]=sample_cont(t, x_cont(t), Fs);
x_ws=wsinc_recon(n, xs, Fs, t, 8);
plot(t*1e3, x_cont(t), 'k'); hold on; plot(t*1e3, x_ws, 'b'); grid on
legend('cont','win-sinc L=8'); title('윈도우드 sinc 보간')
```

### 6.2 FOH(선형 보간) 주파수 응답 비교
FOH는 삼각펄스 컨볼루션 \(\Rightarrow |H_{FOH}| \propto \mathrm{sinc}^2(\Omega T/2)\). 고주파 롤오프는 ZOH보다 완만하나 완전 복원은 아님.

---

## 7. 샘플 타이밍 지터의 영향

### 7.1 이론 SNR 근사
정현파 \(f_{in}\), 지터 표준편차 \(\sigma_t\):
$$
\mathrm{SNR}_{\text{jitter}} \approx -20\log_{10}\!\big(2\pi f_{in}\sigma_t\big)\ \text{[dB]}.
$$

### 7.2 수치 실험
```octave
Fref=5e6; t=tspan(0, 2e-3, Fref);
fin=200e3; x=cos(2*pi*fin*t);
Fs=2e6; T=1/Fs; n=0:floor(t(end)*Fs);
sigma_t=10e-12; tn=n*T + sigma_t*randn(size(n));
xs=interp1(t, x, tn, "linear");
xrec=sinc_recon(n, xs, Fs, t);

plot(t*1e6, x, 'k'); hold on; plot(t*1e6, xrec, 'r'); grid on
xlabel('us'); title('지터가 큰 고주파 복원에 미치는 영향');
legend('cont','recon(with jitter)');
```

### 7.3 주파수별 지터 한계 곡선
```octave
sigma_t=1e-12; fin=logspace(3,7,200); % 1 kHz ~ 10 MHz
SNRj = -20*log10(2*pi*fin*sigma_t);
semilogx(fin, SNRj); grid on; xlabel('Hz'); ylabel('dB');
title('지터 한계 SNR (σ_t=1 ps)');
```

---

## 8. 양자화 한계와 ENOB

### 8.1 기본식
스텝 \(\Delta\) → 등가 잡음 \(\sigma_q^2\approx \Delta^2/12\), 이상 SNR:
$$
\mathrm{SNR}_{\text{quant}} \approx 6.02N + 1.76\ \text{dB}.
$$

### 8.2 ENOB, 윈도우/ENBW 주의
실측 SNR로 \( \mathrm{ENOB}\approx(\mathrm{SNR}-1.76)/6.02 \). FFT로 SNR 측정 시 **창 보정(ENBW)** 필수.

### 8.3 수치 실험(양자화·디더)
```octave
Fs=192e3; t=(0:1/Fs:0.1); fin=997; x=0.9*cos(2*pi*fin*t);
Nbits=12; Vfs=2; Delta=Vfs/(2^Nbits); % -1..+1 범위 가정
xq = round(x/Delta)*Delta;  % uniform quant
e  = xq - x;

subplot(2,1,1); plot(t(1:2000)*1e3, x(1:2000), 'k'); hold on
plot(t(1:2000)*1e3, xq(1:2000), 'r.'); grid on; xlabel('ms'); title('양자화 파형');

% SNR 추정(대충)
SNR = 10*log10(var(x)/var(e));
subplot(2,1,2); histogram(e, 60); grid on; title(sprintf('에러 분포, SNR≈%.1f dB', SNR));
```

---

## 9. 샘플·홀드의 개구(Aperture) 효과
샘플이 **순간**이 아니라 **폭 \(\tau_a\)** 로 평균될 때(트랙-앤-홀드),
$$
H_{ap}(j\Omega)=\mathrm{sinc}\!\left(\frac{\Omega\tau_a}{2}\right)e^{-j\Omega\tau_a/2},
$$
즉 추가 롤오프/위상지연이 발생. 고속 ADC에서 중요한 비이상성.

---

## 10. 재구성 필터 설계 가이드(아날로그 관점 요약)
- **Butterworth**: 평탄 크기, 군지연 중간
- **Chebyshev/Elliptic**: 날카로운 전이대역(리플/군지연 왜곡)
- **Bessel**: 최대 평탄 지연(파형 보존), 완만한 전이대역
- ZOH의 \(|H_{ZOH}|\) 롤오프를 **이퀄라이즈**하려면 저주파 이득 보정(프리엠퍼시스) 설계 가능

---

## 11. 디지털 도메인의 재샘플링(참고 확장)
- **업샘플링 L**: 제로삽입 → **이미징 필터**(LPF)
- **다운샘플링 M**: **AA 디지털 LPF** → decimate
- **창 sinc 보간, Lagrange, cubic spline, Farrow 구조** 등 실시간 보간기

간단 Farrow형 3차 Lagrange(개념 데모):
```octave
% 3차 Lagrange 분수지연 보간기 (Farrow 데모)
function y = lagrange3_fracdelay(x, D)
  % x: row, D in [0,1)
  c0 = -D*(1-D)*(2-D)/6;
  c1 = (1+D)*(1-D)*(2-D)/2;
  c2 = -D*(1+D)*(2-D)/2;
  c3 = D*(1+D)*(1-D)/6;
  % y[n] ≈ c0*x[n-1]+c1*x[n]+c2*x[n+1]+c3*x[n+2]
  x = [x(1), x, x(end), x(end)];  % pad
  y = zeros(1, numel(x)-3);
  for n=2:numel(x)-2
    y(n-1) = c0*x(n-1)+c1*x(n)+c2*x(n+1)+c3*x(n+2);
  end
endfunction
```

---

## 12. 종합 시나리오: 센서→ADC→DSP→DAC→AF

### 12.1 문제
- 센서: 0–8 kHz + 20 kHz 꼬리
- \(f_s=24\) kHz
- 전처리 AA, DSP로 0–4 kHz 통과, DAC(ZOH) 후 AF로 이미지 제거

### 12.2 Octave
```octave
clear; close all; clc
pkg load signal

Fref=1e6; t=linspace(0, 20e-3, 20e-3*Fref);
x = 0.9*cos(2*pi*1.2e3*t) + 0.5*cos(2*pi*3.5e3*t) + 0.1*randn(size(t)) ...
    + 0.2*cos(2*pi*20e3*t);

% (1) AA
Fc_AA=10e3; bAA=fir1(511, Fc_AA/(Fref/2), hamming(512));
xAA=filtfilt(bAA, 1, x);

% (2) 샘플
Fs=24e3; T=1/Fs; n=0:floor(t(end)*Fs); ts = t(1) + n*T;
xs=interp1(t, xAA, ts, "linear");

% (3) DSP LPF
[bD, aD]=butter(5, 4e3/(Fs/2)); ys=filtfilt(bD, aD, xs);

% (4) ZOH
function xr = zoh(n, x, Fs, t_eval)
  T=1/Fs; xr=zeros(size(t_eval));
  for k=1:numel(n)
    mask=(t_eval >= n(k)*T + t_eval(1)) & (t_eval < (n(k)+1)*T + t_eval(1));
    xr(mask)=x(k);
  end
endfunction
xZ = zoh(n, ys, Fs, t);

% (5) AF
Fc_AF=9e3; bAF=fir1(511, Fc_AF/(Fref/2), hamming(512));
xREC=filtfilt(bAF, 1, xZ);

plot(t*1e3, x, 'k'); hold on; plot(t*1e3, xREC, 'r'); grid on
xlim([0, 5]); legend('sensor cont(approx)','reconstructed out');
title('AA→ADC→DSP→DAC(ZOH)→AF 체인(시간영역)'); xlabel('ms');
```

---

## 13. 연결 고리: 연속–표본–DTFT–DFT/FFT

### 13.1 표본열의 DTFT와 CTFT 관계
샘플 \(x[n]\)의 DTFT \(X(e^{j\omega})\)와 \(X(j\Omega)\)의 관계:
$$
X_s(j\Omega)=\frac{1}{T}\sum_k X\big(j(\Omega-k\Omega_s)\big),\quad
X(e^{j\omega})=\sum_n x[n]e^{-j\omega n}.
$$
\(\omega=\Omega T\)에서, CT 스펙트럼 복제는 **디지털 주파수의 주기성**으로 나타난다.

### 13.2 DFT/FFT는 DTFT 샘플
길이 \(N\)의 DFT는 \(\omega_k=2\pi k/N\) 격자에서 DTFT 샘플. **제로패딩**은 해상도가 아니라 **보간 품질/시각화**를 개선.

---

## 14. 샘플링·복원 핵심 수식 모음

1) 샘플링 스펙트럼
$$
X_s(j\Omega)=\frac{1}{T}\sum_{k=-\infty}^{\infty}X\big(j(\Omega-k\Omega_s)\big).
$$

2) 이상 복원(sinc)
$$
x(t)=\sum_{n=-\infty}^{\infty}x[n]\ \mathrm{sinc}\!\left(\frac{t-nT}{T}\right).
$$

3) ZOH 응답
$$
H_{ZOH}(j\Omega)=T\,\mathrm{sinc}\!\left(\frac{\Omega T}{2}\right)e^{-j\Omega T/2}.
$$

4) 밴드패스 샘플링 직관
$$
f_s>2B,\ \ \frac{2f_H}{m}\le f_s \le \frac{2f_L}{m-1}\ \text{영역 존재 시 비겹침.}
$$

5) 지터 SNR
$$
\mathrm{SNR}_{\text{jitter}}\approx -20\log_{10}\!\big(2\pi f_{in}\sigma_t\big)\ \text{dB}.
$$

6) 양자화 SNR
$$
\mathrm{SNR}_{\text{quant}}\approx 6.02N+1.76\ \text{dB}.
$$

---

## 15. 실무 체크리스트
- **AA 필터**: 통과 리플/저지 감쇠/전이폭, 실현 가능한 차수·位相(군지연) 고려
- **샘플링률**: 베이스밴드 \(f_s\ge 2f_B\); 밴드패스는 **불겹침 조건**으로 설계
- **클럭**: 지터 \(\sigma_t\)가 타깃 SNR을 만족하는지(특히 고주파 입력)
- **ADC**: ENOB/INL/DNL/THD+N, 타임-인터리브 시 **채널 타이밍 스큐** 보정
- **DSP**: 고정소수점 스케일, 멀티레이트(다단 decim/interp), 윈도우/ENBW 준수
- **DAC/재구성**: ZOH+AF 합성응답, 저주파 이득 보정, 스텝/치르프 검증
- **검증**: 시간·주파수 비교, 컨볼루션 정리 일치, PSD 전파, SNR/ENOB 실측 vs 예측

---

## 16. 결론
- **샘플링 정리**는 밴드제한·충분한 샘플링률 하에 **완전 복원**을 보장한다.
- 현실에서는 **AA 필터, ZOH 이미지, 지터, 양자화, 개구효과**가 품질을 좌우한다.
- 본문 Octave 루틴은 **연속 근사→샘플→복원** 전과정과 **밴드패스 샘플링, 지터/양자화 한계**까지 재현·튜닝할 수 있게 구성했다. 실무에서는 **필터 스펙–샘플링률–클럭 품질–ENOB**를 **하나의 시스템 예산**으로 묶어 설계·검증하라.
