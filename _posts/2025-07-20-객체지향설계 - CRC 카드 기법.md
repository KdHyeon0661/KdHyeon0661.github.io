---
layout: post
title: 객체지향설계 - CRC 카드 기법
date: 2025-07-20 23:20:23 +0900
category: 객체지향설계
---
# CRC 카드 기법 소개

## CRC 카드 기법이란?

**CRC 카드(Class–Responsibility–Collaboration)**는 1989년 Ward Cunningham과 Kent Beck이 제안한 **책임 주도 설계(Responsibility-Driven Design)**의 대표 도구다.
핵심은 아주 단순하다:

- **Class**: 이름(역할/개념)
- **Responsibilities**: 무엇을 해야 하는가(행위/정책/의사결정)
- **Collaborators**: 이를 위해 **누구와 협력**하는가(메시지 교환 대상)

> 목적: **책임 중심 모델링**을 통해 **높은 응집도, 낮은 결합도**를 자연스럽게 유도하고, 복잡한 UML을 그리기 전 **빠르게 탐색·정제**하는 것이다.

---

## CRC 카드의 구성

| 영역 | 질문 | 예시 |
|---|---|---|
| **클래스명(Class)** | 이 카드가 나타내는 **개념/역할**은? | `Book`, `Member`, `Loan`, `Catalog` |
| **책임(Responsibility)** | 이 역할이 **반드시** 수행해야 하는 **행위/정책**은? | “대출 가능 여부 판정”, “연체료 계산” |
| **협력자(Collaboration)** | 책임을 수행하려면 **누구에게 무엇을 요청**하는가? | `Loan`에게 “대출기록 조회”, `FinePolicy`에게 “연체료 계산” |

**ASCII 카드 골격**
```
+----------------------------+
| Class: <이름>              |
+----------------------------+
| Responsibilities           |
|  - <행위1>                 |
|  - <행위2>                 |
|  - <행위3>                 |
+----------------------------+
| Collaborators              |
|  - <클래스A>: <요청/이유>  |
|  - <클래스B>: <요청/이유>  |
+----------------------------+
```

---

## CRC 카드 작성 절차 (워크숍 운영 팁 포함)

1) **요구/용어 정리(10–20분)**
   - 도메인 용어사전(카탈로그) 초안 작성. **명사**를 수집(후보 클래스), **동사**를 수집(후보 책임).

2) **시나리오 기반 도출(20–40분)**
   - 대표 **유스케이스**를 문장으로: “사용자가 X하면 시스템은 Y를 보장한다.”
   - 시나리오 단계별 **메시지(요청)**를 문장으로 적는다.

3) **클래스 식별 & 카드 만들기(20–40분)**
   - 명사→클래스, 동사→책임으로 **첫 카드**를 쓴다.
   - **한 책임당 최대 한 문장**, 측정 가능한 동사 사용(“검증한다”, “계산한다”, “승인한다”).

4) **협력 관계 배치(15–30분)**
   - 각 책임을 **누가 가장 잘할까?**(GRASP 정보전문가/Creator) 기준으로 **Collaborator**를 붙인다.
   - 메시지 흐름을 **화살표 없이 문장으로** 표현: “A는 ‘검증’을 위해 B에게 ‘조회’를 요청한다”.

5) **라운드-트립 점검(30분)**
   - 시나리오를 다시 따라가며 카드만으로 **흐름이 수행되는지** 검증.
   - 메시지 수가 과하면 **퍼사드/도메인 서비스** 카드로 **책임 묶기**.

6) **정제(지속)**
   - 책임이 6개 이상이면 **분할** 후보, 협력자가 5개 이상이면 **경계 재검토**.
   - 이름을 **역할 중심**으로 바꾼다(“Manager”, “Util” 지양).

---

## CRC 카드 예제 — 도서관 관리 시스템(확장 세트)

### 대표 시나리오

- **UC-01**: “회원이 도서를 대출한다.”
  전제: 회원 상태 유효, 도서 대출 가능, 대출 권수/기간 정책 준수.

### 카드들

**Book**
```
+----------------------------+
| Class: Book                |
+----------------------------+
| Responsibilities           |
|  - 자신의 대출 가능 여부 판단(상태/예약/손상 여부 포함) |
|  - 서지 정보 제공(제목/저자/ISBN)                     |
+----------------------------+
| Collaborators              |
|  - Catalog: 소장 정보/가용성 조회(옵션)               |
|  - Loan: 대출 이력 질의(옵션)                         |
+----------------------------+
```

**Member**
```
+----------------------------+
| Class: Member              |
+----------------------------+
| Responsibilities           |
|  - 대출 신청(정책 충족 확인 후 승인 요청)            |
|  - 반납 요청                                                |
|  - 연체/벌점 상태 확인                                     |
+----------------------------+
| Collaborators              |
|  - LoanService: 대출 생성/반납 처리                       |
|  - FinePolicy: 연체료 계산 질의                           |
+----------------------------+
```

**Loan**
```
+----------------------------+
| Class: Loan                |
+----------------------------+
| Responsibilities           |
|  - 대출 레코드의 수명주기 관리(생성/반납/연장)         |
|  - 만료/연체 상태 판단                                    |
+----------------------------+
| Collaborators              |
|  - Book: 대상 확인                                         |
|  - Member: 대출자 확인                                     |
|  - FinePolicy: 연체료 산정                                 |
+----------------------------+
```

**LoanService** (유스케이스 퍼사드)
```
+----------------------------+
| Class: LoanService         |
+----------------------------+
| Responsibilities           |
|  - 대출 프로세스 조정(검증→생성→알림)                  |
|  - 반납/연장 프로세스 조정                                |
+----------------------------+
| Collaborators              |
|  - Member, Book, Loan                                      |
|  - FinePolicy, Notifier                                    |
+----------------------------+
```

**FinePolicy**
```
+----------------------------+
| Class: FinePolicy          |
+----------------------------+
| Responsibilities           |
|  - 연체료/벌점 계산(정책 버전/휴무일 규칙 반영)        |
+----------------------------+
| Collaborators              |
|  - Loan: 반납기한/경과일 질의                            |
+----------------------------+
```

**Notifier**
```
+----------------------------+
| Class: Notifier            |
+----------------------------+
| Responsibilities           |
|  - 알림 전송(대출/반납/연체 통지)                       |
+----------------------------+
| Collaborators              |
|  - Member: 연락 수단                                      |
+----------------------------+
```

### 시나리오 실행(텍스트 시퀀스)

- `Member` → `LoanService`: “대출 요청(bookId)”
- `LoanService` → `Book`: “대출 가능?”
- `LoanService` → `FinePolicy`: “대출 허용 정책 위반 없음?”
- `LoanService` → `Loan`: “대출 생성(member, book, dueDate)”
- `LoanService` → `Notifier`: “대출 성공 알림”

---

## CRC → UML/코드 전개(트레이서빌리티)

### 클래스/시그니처로 매핑

- 책임 → **공개 메서드**(또는 도메인 서비스의 연산)
- 협력 → **메시지 송수신**(의존/연관)

```java
// CRC: LoanService - "대출 프로세스 조정"
public final class LoanService {
    private final FinePolicy fine;
    private final Notifier notifier;
    public LoanService(FinePolicy fine, Notifier notifier){
        this.fine = fine; this.notifier = notifier;
    }

    // 책임: 대출
    public Loan borrow(Member m, Book b){
        if(!b.isBorrowable()) throw new IllegalStateException("not borrowable");
        fine.ensureBorrowAllowed(m, b);      // 협력: 정책 검증
        Loan loan = Loan.create(m, b);       // 협력: Loan 생성
        notifier.onBorrowed(m, b, loan.dueDate());
        return loan;
    }
}
```

```java
// CRC: FinePolicy - "연체료/정책 계산"
public interface FinePolicy {
    void ensureBorrowAllowed(Member m, Book b);
    int calcLateFee(Loan loan, LocalDate returnedAt);
}
```

```java
// CRC: Loan - "대출 레코드 수명주기 관리"
public final class Loan {
    private final Member member;
    private final Book book;
    private final LocalDate dueDate;
    private LocalDate returnedAt;

    private Loan(Member m, Book b, LocalDate due){ member=m; book=b; dueDate=due; }
    public static Loan create(Member m, Book b){ return new Loan(m,b,LocalDate.now().plusDays(14)); }
    public boolean isOverdue(LocalDate today){ return returnedAt==null && today.isAfter(dueDate); }
    public LocalDate dueDate(){ return dueDate; }
}
```

> 팁: **CRC 책임 문구**를 메서드 주석/테스트 이름으로 옮기면 **설계 의도**가 코드에 살아남는다.

---

## 품질 체크리스트(현장용)

**클래스 단위**
- [ ] **책임 3–5개** 이내인가?(6개↑면 분리 고려)
- [ ] 책임 간 **주제 일관성**이 있는가?(응집도)
- [ ] 협력자 **5개 이하**인가?(결합도)
- [ ] “조정/오케스트레이션”과 “계산/정책” 책임이 **혼재**하지 않았는가?

**세트 단위**
- [ ] 동일 책임이 **이중 배치**되지 않았는가?
- [ ] **메시지 순환**이 없는가?(A→B→C→A)
- [ ] **용어/이름**이 도메인 언어와 일치하는가?
- [ ] 시나리오가 **카드만으로** 재생 가능한가?

---

## 지표와 간단 수식(의사결정 보조)

- 클래스 수 \(K\), 총 책임 수 \(R\), 총 협력 링크 수 \(E\).
- **책임 밀도**: \( \displaystyle D_R = \frac{R}{K} \) — 너무 높으면 분할 필요.
- **평균 협력도**: \( \displaystyle D_C = \frac{E}{K} \) — 높으면 결합도↑.
- **변경 파급 위험(근사)**:
$$
\text{Risk} \approx D_R \times D_C \times F
$$
여기서 \(F\)는 해당 서브도메인의 변경 빈도.

> 목표: **책임 밀도**와 **협력도**가 균형을 이루는 구조.

---

## 안티패턴과 리팩토링

| 냄새 | 증상 | 원인 | 리팩토링 |
|---|---|---|---|
| **God 카드** | 책임 7개 이상, 협력자 다수 | 역할 혼재 | **역할 분리**(정책 vs 조정), 퍼사드 도입 |
| **이름이 모호** | `Manager`, `Controller` 남발 | 역할 미정 | **도메인 용어**로 재명명 |
| **데이터만 있는 카드** | 행위 없이 필드/게터만 | 절차적 설계 | **책임 이동**(Information Expert) |
| **긴 협력 사슬** | A→B→C→D… | 과도한 분해 | **중간 퍼사드**로 뭉치기 |
| **순환 협력** | A↔B↔C | 경계 불명 | **경계 재설정**, 한쪽에 정책 집중 |

---

## 대규모 프로젝트에서의 CRC

- **서브도메인 단위**로 카드 세트를 나눈다(DDD: Core/Supporting/Generic).
- **버전 관리**: 카드에 ID/버전/작성자/날짜를 표기.
- **디지털화**: 마크다운/스프레드시트로 템플릿 관리, 이슈/PR에 링크.
- **추적성**: “카드ID → 테스트케이스 → 코드(클래스/메서드)”를 연결.

---

## 실전 워크숍 운영 스크립트(샘플 90분)

1) 10’ — 문제/용어 공유
2) 25’ — 시나리오 서술 & 메시지 도출
3) 25’ — 카드 작성(책임/협력 배치)
4) 20’ — 시나리오 재생(메시지 걷기) & 정제
5) 10’ — 액션아이템/추가 조사 기록

> 자료: 빈 카드 템플릿, 도메인 용어 표, 시나리오 시트, 타이머

---

## 템플릿 모음

### 마크다운 템플릿

```markdown
## Class: <이름>
### Responsibilities

- <책임1>
- <책임2>
- <책임3>

### Collaborators

- <클래스A>: <요청/이유>
- <클래스B>: <요청/이유>
```

### CSV 템플릿

```csv
Class,Responsibility,Collaborator,Message
LoanService,대출 프로세스 조정,FinePolicy,대출 허용 확인
LoanService,대출 프로세스 조정,Loan,대출 생성
LoanService,대출 프로세스 조정,Notifier,대출 알림
```

---

## CRC → 테스트(계약 테스트 예)

```java
// 책임: "대출 허용이면 Loan이 생성된다"
class LoanServiceTest {
    @Test
    void borrow_creates_loan_when_allowed() {
        var policy = new AllowAllPolicy();
        var notifier = new SpyNotifier();
        var svc = new LoanService(policy, notifier);

        var m = new Member("M1");
        var b = new Book("B1");

        Loan loan = svc.borrow(m, b);

        assertNotNull(loan);
        assertTrue(notifier.borrowedWasSent());
    }
}
```

- 테스트 **이름/검증 항목**이 CRC 책임 문구와 일치하도록 작성한다.

---

## 다른 도메인 예시(간단 카드 3종)

**결제 체크아웃**
```
Class: Checkout
Responsibilities:
 - 결제 시나리오 조정(재고확인→결제→확정)
Collaborators:
 - Inventory, PaymentPort, Order
```

**배송 라우팅**
```
Class: Router
Responsibilities:
 - 목적지/제약 기반 최적 경로 산출
Collaborators:
 - RoadGraph, ConstraintPolicy
```

**알림 스케줄러**
```
Class: NotificationScheduler
Responsibilities:
 - 스케줄 계산/등록/재시도
Collaborators:
 - Calendar, Notifier, RetryPolicy
```

---

## 요약

- **CRC는 “역할·책임·협력”을 카드 한 장으로 고정**해, 설계를 **빠르고 가볍게 시각화**한다.
- 시나리오를 따라 **메시지를 걷는 과정**에서 자연스럽게 **응집도↑·결합도↓** 구조가 나온다.
- 카드에서 시작해 **UML/코드/테스트**로 매끄럽게 전개하라.
- **체크리스트와 지표**로 과잉/누수/순환을 방지하라.

---

## 결론

CRC 카드는 **브레인스토밍**과 **초기 설계**에서 특히 강력하다.
작게 시작해 시나리오를 재생하며 **책임을 다듬고 협력을 안정화**하라.
그 다음 단계에서 **퍼사드·포트/어댑터·UML·테스트**로 구체화하면, **변화에 견고한 객체 지향 구조**가 완성된다.
