---
layout: post
title: TCPIP - 배경지식
date: 2025-08-29 14:25:23 +0900
category: TCPIP
---
# 0. 길잡이(Guide)

> 이 글은 앞으로의 **TCP/IP 시리즈를 어떻게 읽고**, **무엇을 준비하며**, **어떤 배경지식(2진수·16진수, 지연/대역폭/RTT/처리량)**을 익히면 좋은지 안내합니다.  
> 실습은 “개념 확인 → 간단 관찰 → 짧은 과제” 흐름으로, **숫자 감각**(예: \( \text{BDP} = \text{Bandwidth} \times \text{RTT} \))을 몸에 익히는 데 집중합니다.

---

## 0.1 이 글에서 얻을 것
- **시리즈 로드맵**: 기초 → 실무 → 심화 → 트러블슈팅 흐름을 한눈에.
- **필수 배경지식 정리**: 2진수·16진수, 지연/대역폭/RTT/처리량, BDP 직관.
- **실습 환경 청사진**: 로컬(Windows/Linux/WSL2), 가상화, 클라우드(VPC)에서 최소 구성과 관찰 포인트.

---

## 0.2 대상 독자와 목표 수준
- **대상**: 시스템/네트워크 초·중급 개발자, SRE/인프라 지망생, 성능 이슈를 겪는 애플리케이션 개발자.
- **목표 수준**  
  - *기초*: 용어·흐름의 큰 그림 + 단위/숫자 감각.  
  - *실무*: 장애 재현·관찰·가설수립·검증 루틴, 지표 해석, 튜닝 포인트.  
  - *심화*: 혼잡제어(CUBIC/BBR) 직관, BDP/큐잉, Anycast·QUIC 등 현대 트래픽 특성.

---

## 0.3 시리즈 로드맵(요약)
1. **큰 그림**(OSI↔TCP/IP, 패킷의 여정)  
2. **링크·L3 기초**(이더넷, IP/IPv6, ARP/NDP/ICMP)  
3. **라우팅·NAT**(정적/동적, BGP 개요, NAT/NAPT)  
4. **전송계층**(UDP, TCP 신뢰성/혼잡제어/윈도우 스케일)  
5. **보안·웹**(TLS, IPsec, HTTP/2·HTTP/3/QUIC)  
6. **성능·튜닝**(MTU/MSS/PMTUD, QoS/ECN, 버퍼블로트)  
7. **클라우드/컨테이너 네트워킹**(VPC, SG/NACL, CNI, 오버레이)  
8. **트러블슈팅**(도구·방법론, 케이스 스터디)

각 편은 “**왜 중요? → 핵심 개념 → 관찰 포인트 → 미니 실습 → 체크리스트**”로 구성됩니다.

---

## 0.4 표기 규칙 & 단위
- **주소 표기**: IPv4는 `192.0.2.0/24`, IPv6는 `2001:db8::/32`(문서 예시 대역).  
- **단위**  
  - 지연/RTT: ms(밀리초)  
  - 대역폭: Mbps/Gbps(초당 비트), 처리량은 MB/s(초당 바이트)도 병기  
  - 크기: KB/MB(십진), 필요 시 KiB/MiB(2진) 병기  
- **빠른 감산을 위한 근사**: `100 Mbps ≈ 12.5 MB/s`, `1 Gbps ≈ 125 MB/s`.

---

## 0.5 배경지식 A — 2진수와 16진수

### 0.5.1 왜 필요한가
- 헤더는 **비트 필드**의 집합입니다(예: IPv4 버전 4비트, TCP 포트 16비트).  
- 플래그/마스크/서브넷 계산, 패킷 분석에서 비트 경계 감각은 필수입니다.

### 0.5.2 핵심 개념
- 1 byte = 8 bits, 1 nibble = 4 bits(= 16진수 1자리).  
- **2진수 ↔ 16진수**: 2진 4자리 ↔ 16진 1자리 (예: \(1010_2 = A_{16}\)).  
- **엔디언**: 전송선상의 **네트워크 바이트 순서 = 빅엔디언**.

### 0.5.3 작은 예제(머릿속 변환)
- `0xFF = 1111 1111₂ = 255₁₀`  
- `0x400 = 1024₁₀` (16진 한 자리 이동은 2진 4비트 이동 = ×16)  
- TCP 포트 443(십진) = `0x01BB`(16진), 전송 시 2바이트 **빅엔디언**.

### 0.5.4 실전 연결
- **서브넷 마스크** `255.255.255.0` → `11111111.11111111.11111111.00000000` → `/24`.  
- **TCP 플래그**(SYN/ACK/FIN/RST)는 각 1비트: 캡처에서 플래그 조합으로 상태를 해석.

---

## 0.6 배경지식 B — 지연·대역폭·RTT·처리량·BDP

### 0.6.1 정의
- **지연(Latency)**: 한 번 편도 도달 시간.  
- **RTT**: 왕복 시간. 흔히 “핑 40ms”는 RTT 40ms.  
- **대역폭(Bandwidth)**: 초당 보낼 수 있는 **최대** 비트 수.  
- **처리량(Throughput)**: 실제 달성 속도(일반적으로 처리량 ≤ 대역폭).  
- **BDP(Bandwidth-Delay Product)**: 파이프에 동시에 떠 있는 데이터량.  
  \[
    \text{BDP} = \text{Bandwidth} \times \text{RTT}
  \]

### 0.6.2 숫자 감각(예제)
1) 100 Mbps, RTT 50 ms  
   \[
     100\,\text{Mbps} \approx 12.5\,\text{MB/s},\quad
     \text{BDP} = 12.5\,\text{MB/s} \times 0.05\,\text{s} \approx 0.625\,\text{MB} \,(\approx 640\,\text{KB})
   \]
   → 파이프를 **꾸준히** 채우려면 왕복 동안 약 \(0.625\,\text{MB}\)가 떠 있어야 함.

2) 1 Gbps, RTT 180 ms(국제 회선 가정)  
   \[
     1\,\text{Gbps} \approx 125\,\text{MB/s},\quad
     \text{BDP} = 125\,\text{MB/s} \times 0.18\,\text{s} = 22.5\,\text{MB}
   \]
   윈도우가 작으면 이론 대역폭을 활용 못 함(윈도우/RTT로 상한).

3) **윈도우 스케일** 필요성  
   - 16비트 윈도우(최대 \(65{,}535\)B)로는 고지연·고대역폭 링크를 채우기 어렵습니다.  
   - 윈도우 스케일로 효과적 윈도우를 수 MB~수십 MB로 확장(자세한 내용은 TCP 편).

### 0.6.3 지연의 구성 요소
- **전파 지연**(거리·매체), **전송 지연**(패킷크기/링크속도), **처리 지연**(호스트/라우터), **큐잉 지연**(혼잡).

### 0.6.4 짧은 생각 실험
- 같은 100 Mbps에서 **RTT 10 ms vs 100 ms**  
  \[
    \text{BDP}_{10ms} \approx 12.5\,\text{MB/s} \times 0.01\,\text{s} \approx 0.125\,\text{MB} \\
    \text{BDP}_{100ms} \approx 12.5\,\text{MB/s} \times 0.1\,\text{s} \approx 1.25\,\text{MB}
  \]
  → RTT가 클수록 “예열 시간”과 스로틀링 체감이 커집니다.

---

## 0.7 미리 해보는 관찰 실습(명령어 나열 대신 *무엇을 볼지*)
> 자신의 통제 가능한 환경에서만 수행하세요(정책·보안 준수).

### 0.7.1 핑/트레이스 관찰
- **평균 RTT**와 **표준편차**를 기록해 **지터** 감을 익힌다.  
- 특정 시간대에 RTT 스파이크가 반복되는지 확인(백업/배치/피크 회선).

### 0.7.2 DNS 응답 시간 비교
- 동일 도메인을 서로 다른 재귀 DNS로 조회해 **첫 조회 vs 재조회** 차이를 관찰(캐시/TTL).

### 0.7.3 대역폭·처리량 감각
- 같은 대상에 **작은 파일 다건 vs 큰 파일 1건** 전송 체감 비교: 초기 상승 구간(혼잡 윈도우 성장)을 유심히 본다.

---

## 0.8 실습 환경 제안(로컬 / 가상화 / 클라우드)

### 0.8.1 공통 준비물·원칙
- **패킷 뷰어**(GUI/텍스트), **이름해석 도구**(캐시/TTL 관찰), **전송 측정**(서버/클라 짝).  
- **원칙 3가지**  
  1) 먼저 “무엇을 확인하려는가?”를 **문장으로 적는다**.  
  2) 결과를 **숫자/상태/타임라인**으로 정리한다.  
  3) **동일 조건 3회 이상 반복**해 편차를 본다.

### 0.8.2 로컬: Windows / Linux(WSL2 포함)
- **Windows**: 진입 장벽이 낮음. ICMP 차단 여부(핑) 오판 주의.  
- **WSL2**: 가상 스위치 기반 NAT 구조. **호스트↔WSL2** vs **WSL2↔외부** RTT/MTU 차이를 비교해보면 좋음.  
- **네이티브 Linux**: MTU/MSS 조정, 인터페이스 큐/드롭/에러 카운터로 체감 좋은 학습.

### 0.8.3 가상화: Hyper-V / VirtualBox / VMware / KVM
- **NAT**: 외부 발신은 쉬우나 **인바운드**는 포트포워딩 필요.  
- **브리지**: VM이 실제 네트워크에 직접 참여(IP 직접 할당).  
- **호스트 전용**: 호스트↔VM 실험에 유리(외부와 단절).  

**추천 미니 토폴로지(3 VM)**  
- `VM-A(클라)`, `VM-B(서버)`, `VM-R(라우터/방화벽, NIC 2개)`  
- NAT/라우팅/필터 규칙을 적용하고 **소스 IP/포트 변화**, **TTL/플래그**를 관찰.

### 0.8.4 클라우드: 최소 VPC 실험(개념)
- **VPC/서브넷**(공개/비공개), **라우팅 테이블**, **인터넷 게이트웨이**, **NAT 게이트웨이**, **SG/NACL**.  
- 실험 예: 공개 서브넷 ↔ 인터넷 RTT/처리량, 비공개 서브넷의 아웃바운드(NAT)에서 **소스 IP 변환** 확인.

---

## 0.9 당신에게 맞는 실습 트랙
- **트랙 S(가벼움)**: 브라우저 네트워크 탭 + 패킷 뷰어 → RTT/캐시/초기혼잡 감각.  
- **트랙 M(손에 익힘)**: 3VM(클라/서버/라우터)로 NAT/라우팅/MTU 실험.  
- **트랙 L(현업 감각)**: 클라우드 VPC(공개/비공개·베스천·모니터링)로 보안경계·Anycast·비용/지연 트레이드오프 체감.

---

## 0.10 “숫자 감각” 체크 퀴즈(풀이 포함)

1) 100 Mbps, RTT 50 ms의 BDP는?  
\[
  12.5\,\text{MB/s} \times 0.05\,\text{s} \approx 0.625\,\text{MB} \;(\approx 640\,\text{KB})
\]

2) 윈도우 64 KB, RTT 100 ms의 이론 처리량 상한은?  
\[
  \frac{64\,\text{KB}}{0.1\,\text{s}} \approx 0.64\,\text{MB/s} \approx 5.12\,\text{Mbps}
\]

3) 1 Gbps, RTT 180 ms의 BDP는?  
\[
  125\,\text{MB/s} \times 0.18\,\text{s} = 22.5\,\text{MB}
\]

4) DNS 재조회가 빠른 이유? → **캐시**와 **TTL**.

5) NAT 뒤 호스트가 외부에서 직접 접속받기 어려운 이유? → 공용 IP/포트는 라우터에 있고, 내부 사설 IP는 라우터 뒤에 숨음(포트포워딩 필요).

---

## 0.11 초보 오류 방지 메모
- 핑 불가 = 통신 불가 **아님**(ICMP 차단 가능).  
- RTT만으로 대역폭을 추정하지 말 것(독립 요소).  
- 대역폭 테스트는 **양쪽 짝**(서버/클라)과 **동일 조건**이 핵심.  
- “작은 요청은 되는데 큰 응답이 끊긴다” → **MTU/PMTUD 블랙홀** 의심.  
- 시간대·주기성 기록: 매일 같은 시간 느림 → 백업/배치/피크 트래픽 가설.

---

## 0.12 읽는 요령(실무 루틴화)
1) **증상 기술**을 먼저 읽고,  
2) **계층별 관점**(L2→L3→L4→L7)을 통과시키며,  
3) **패킷/지표/로그** 중 **두 가지 이상**으로 근거를 확보,  
4) 끝의 **체크리스트**로 현장 적용.

---

## 0.13 첫날 체크리스트
- [ ] 즐겨 찾는 사이트 3개 **RTT 평균/최대/표준편차** 기록  
- [ ] **DNS 첫 조회 vs 재조회** 응답시간·TTL 기록  
- [ ] **작은 파일 10개 vs 큰 파일 1개** 전송 체감 비교(초기 상승 구간)  
- [ ] 측정 스크린샷 3장 보관(내일과 비교)

---

## 0.14 FAQ

**Q1. Windows만으로 충분?**  
초반 학습은 충분합니다. 중반부터 가상화/클라우드로 NAT/라우팅/MTU를 **직접 재현**해 보며 확장하세요.

**Q2. IPv6 꼭 필요?**  
현대 환경에서 점점 **필수**에 가깝습니다. 본 시리즈는 IPv4·IPv6를 함께 다룹니다.

**Q3. 패킷 캡처 범위는?**  
**본인 통제 환경**에서만. 조직 정책·개인정보·보안 규정 준수 필수.

---

## 0.15 지금 당장 5분 실천
1) 사이트 3개의 **RTT 평균/최대**를 적기.  
2) 같은 사이트 **두 번 연속** 열고, 두 번째가 빠른 이유(캐시/연결 재사용)를 **한 줄 설명**으로 적기.  
3) 내 환경의 BDP를 대략 계산:  
\[
  \text{BDP} = \text{대역폭(MB/s)} \times \text{RTT(s)}
\]
이 값이 **윈도우/버퍼**와 어떤 관계인지 한 줄 요약.

> 다음 편(1. 네트워크 큰 그림)에서는 OSI/TCP-IP 모델과 함께 **패킷의 실제 여정**을 그림 중심으로 풀어갑니다.

---

### 부록 A: 미니 용어 사전
- **RTT**: 왕복 지연.  
- **BDP**: 대역폭×RTT, 파이프 내 동시 체류 데이터량.  
- **PMTUD**: 경로 MTU 발견.  
- **버퍼블로트**: 큐가 과도해 지연 폭증.  
- **윈도우 스케일**: TCP 윈도우 확장 옵션.  
- **NAT/PAT**: 주소/포트 변환.  
- **SG/NACL**: 클라우드 상태저장 보안그룹 vs 무상태 ACL.

### 부록 B: 관찰 메모 템플릿
```text
[날짜/시간/망 종류]
[대상/목적] 예: example.com, 초기혼잡/캐시 관찰
[측정값] RTT avg/max/std, DNS 첫/재조회(ms, TTL), 처리량(MB/s)
[특이사항] 재전송, 손실 의심, MTU 의심, 특정 시간대 스파이크
[가설/다음 계획] 가능한 원인 2~3개, 다음 실험 1~2개
```