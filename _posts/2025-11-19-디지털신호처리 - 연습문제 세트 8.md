---
layout: post
title: 디지털신호처리 - 연습문제 세트 8
date: 2025-11-19 21:25:23 +0900
category: 디지털신호처리
---
# 샘플링률 변환(Sampling Rate Conversion) 연습문제

## 문제 1. 데시메이션에서의 에일리어싱 조건과 차단 대역 결정

### (1) 상황

미국의 오디오/계측 시스템에서 흔히 쓰는 샘플링률인
$$F_s = 48\,\text{kHz}$$
로 측정한 신호를 **D=3배 데시메이션(↓3)** 해서
$$F_s' = 16\,\text{kHz}$$
로 낮추려고 한다.

입력 신호 스펙트럼은 다음 성분을 포함한다.

- 1 kHz 톤
- 6 kHz 톤
- 9 kHz 톤
- 14 kHz 톤

### (2) 요구

1. 데시메이션 후 **에일리어싱이 발생하는 성분**이 무엇인지 찾고, 그 에일리어싱 주파수를 구하라.
2. 에일리어싱을 막기 위해 필요한 **anti-alias LPF의 이상적 컷오프**를 구하라(정규화 포함).
3. 위 요구를 만족하는 FIR를 설계할 때 통과대역/저지대역 경계를 어떻게 잡는지 설명하라.

---

### 풀이

#### 1) 데시메이션 후의 나이퀴스트

데시메이션 후 샘플링률

$$
F_s' = \frac{F_s}{D} = \frac{48}{3}=16\,\text{kHz}
$$

따라서 새 나이퀴스트는

$$
F_N' = \frac{F_s'}{2}=8\,\text{kHz}
$$

**8 kHz를 넘는 입력 성분은 에일리어싱 위험**이 있다.

#### 2) 각 톤이 어디로 접히는가

데시메이션은 주파수축이 D배 압축되며
$$F_N'$$ 밖 성분은 거울 대칭으로 접힌다.

에일리어싱 주파수는 일반적으로

$$
f_a = \left| f - kF_s' \right|, \quad k\in\mathbb{Z}
$$

로 가장 가까운 베이스밴드로 폴딩된 값이다.

- 1 kHz: $$1 < 8$$ → 안전. 그대로 1 kHz.
- 6 kHz: $$6 < 8$$ → 안전. 그대로 6 kHz.
- 9 kHz: $$9 > 8$$ → 폴딩.
  $$
  f_a = |9-1\cdot 16| = 7\,\text{kHz}
  $$
- 14 kHz: $$14 > 8$$ → 폴딩.
  $$
  f_a = |14-1\cdot 16| = 2\,\text{kHz}
  $$

따라서 **9 kHz와 14 kHz는 각각 7 kHz, 2 kHz로 에일리어싱**된다.

#### 3) 이상적 anti-alias 컷오프

에일리어싱 방지 조건은

$$
|f| \le \frac{F_s}{2D} = \frac{48}{6}=8\,\text{kHz}
$$

따라서 이상적 컷오프

$$
f_c \le 8\,\text{kHz}
$$

정규화(원 샘플링률 기준):

$$
\omega_c = \frac{f_c}{F_s/2}=\frac{8}{24}=\frac{1}{3}\approx 0.333
$$

즉 FIR 설계의 **정규화 컷오프는 약 0.333**이다.

#### 4) 실무적 통과/저지 경계

이상적 컷오프는 날카로운 벽이지만
실제 FIR는 전이대역이 필요하다.

- 통과대역 최대 주파수 $$f_p$$ 는 8 kHz보다 약간 낮게
- 저지대역 시작 $$f_s$$ 는 8 kHz보다 약간 높게

예:

$$
f_p = 7.2\,\text{kHz},\quad f_s = 8.8\,\text{kHz}
$$

(대역 여유는 시스템 요구 리플/감쇠에 따라 조정)

---

### GNU Octave 검증 코드

```octave
pkg load signal; clear; close all; clc;

Fs = 48000; D = 3; Fs2 = Fs/D; FN2 = Fs2/2;

t = 0:1/Fs:0.05-1/Fs;
x = sin(2*pi*1000*t) ...
  + sin(2*pi*6000*t) ...
  + sin(2*pi*9000*t) ...
  + sin(2*pi*14000*t);

% 이상적 컷오프 근처로 FIR 설계(kaiser)
fp = 7200; fsb = 8800;
Wp = fp/(Fs/2); Ws = fsb/(Fs/2);
Rp = 0.01; As = 80;
[M,Wn,beta,ftype] = kaiserord([Wp Ws],[1 0],[Rp 10^(-As/20)]);
M = M + rem(M,2);
h = fir1(M, Wn, kaiser(M+1,beta));

u = filter(h,1,x);
y = u(1:D:end);

% 주파수 확인
Nfft = 8192;
X = abs(fft(x, Nfft));
Y = abs(fft(y, Nfft));
f1 = (0:Nfft-1)*Fs/Nfft;
f2 = (0:Nfft-1)*Fs2/Nfft;

printf("Fs'=%g Hz, Nyquist'=%g Hz\n", Fs2, FN2);
printf("Peak near 1k,6k preserved. High tones removed.\n");
```

---

## 문제 2. 보간에서의 이미지(imaging)와 anti-imaging 필터 컷오프

### (1) 상황

통신 단말에서
$$F_s = 12\,\text{kHz}$$
로 샘플링된 베이스밴드 신호를
**I=4배 보간(↑4)** 해서
$$F_s' = 48\,\text{kHz}$$
로 업샘플한다.

입력은 0~4 kHz 대역에만 존재한다고 하자.

### (2) 요구

1. (↑4)만 수행했을 때 생기는 **이미지 복제 스펙트럼의 위치**를 설명하라.
2. anti-imaging LPF의 **이상적 정규화 컷오프**를 구하라(원 Fs 기준).
3. 보간 필터의 통과대역 이득을 왜 I로 스케일링하는지 설명하라.

---

### 풀이

#### 1) 업샘플링이 만드는 이미지

(↑I)은 시간축에서 0을 삽입한다.
주파수축에서는 **원 스펙트럼이 I배 압축되고 I개의 복사본이 2π 주기로 생긴다.**

입력 대역이 0~4 kHz면
업샘플 후 baseband는 0~4 kHz에 남고,
이미지는 새 나이퀴스트(24 kHz) 안에

$$
f = k\cdot \frac{F_s'}{I} \pm \text{baseband},\quad k=1,2,3
$$

즉

- 중심: 12 kHz, 24 kHz, 36 kHz
- 각 중심 주변으로 0~4 kHz 폭의 이미지가 복사

#### 2) anti-imaging 이상적 컷오프

보간 후 유효 대역은 원래 대역이므로(4 kHz)
이상적으로는

$$
f_c \le \frac{F_s}{2} = 6\,\text{kHz}
$$

정규화(원 Fs 기준)로는

$$
\omega_c = \frac{f_c}{F_s/2}=\frac{6}{6}=1
$$

하지만 보간 필터는 **업샘플된 고속 영역에서 동작**한다.
고속 Fs' 기준 정규화는

$$
\omega_c' = \frac{f_c}{F_s'/2} = \frac{6}{24}=0.25
$$

즉 보간 FIR 설계에서 **정규화 컷오프는 0.25(고속 기준)** 이다.

#### 3) 왜 이득 I를 곱하나

(↑I)은 스펙트럼을 I배 압축시키므로
baseband 에너지가 I배 작아지는 효과가 있다.
따라서 anti-imaging 필터 후

$$
y[n]=I\cdot u[n]
$$

로 스케일링해 **원 신호의 진폭/에너지 수준을 복원**한다.

---

### GNU Octave 검증 코드

```octave
pkg load signal; clear; close all; clc;

Fs = 12000; I = 4; Fs2 = Fs*I;

t = 0:1/Fs:0.04-1/Fs;
x = sin(2*pi*2000*t) + 0.7*sin(2*pi*3500*t);

% anti-imaging FIR (고속 기준 컷오프 0.25 근처)
fc = 6000;
Wp = (0.9*fc)/(Fs2/2); Ws = (1.1*fc)/(Fs2/2);
Rp = 0.01; As = 80;
[M,Wn,beta,ftype] = kaiserord([Wp Ws],[1 0],[Rp 10^(-As/20)]);
M = M + rem(M,2);
h = fir1(M, Wn, kaiser(M+1,beta));

% direct interpolation
v = zeros(1, length(x)*I); v(1:I:end)=x;
u = filter(h,1,v);
y = I*u;

printf("Interpolation done. Imaging components suppressed.\n");
```

---

## 문제 3. Polyphase 데시메이터의 연산량 절감 계산

### (1) 상황

D=8 데시메이션에서
length 129(차수 128) FIR를 사용한다고 하자.

### (2) 요구

1. Direct Form으로 구현할 때 **출력 샘플 1개당 곱셈 수**를 구하라.
2. D-phase polyphase로 구현할 때 **출력 샘플 1개당 곱셈 수**를 구하라.
3. 절감 비율을 계산하라.

---

### 풀이

- FIR 길이 \(L=129\).

#### 1) Direct Form

출력 y[m]를 얻기 위해 먼저 모든 u[n]을 계산한다.
출력 1개를 얻는 동안 **입력 D개가 지나가므로**
Direct Form은 입력 샘플당 L번 곱셈을 수행한다.

출력 1개당 곱셈 수:

$$
N_{\text{dir}} = D\cdot L = 8\cdot 129 = 1032
$$

#### 2) Polyphase

D-phase 분해 시 각 서브필터 길이는 대략

$$
L_r \approx \left\lceil \frac{L}{D}\right\rceil \approx \left\lceil\frac{129}{8}\right\rceil = 17
$$

출력 1개를 만들 때
각 위상 FIR를 **한 번씩만** 돌린다.

$$
N_{\text{poly}} \approx \sum_{r=0}^{D-1} L_r \approx D\cdot 17 = 136
$$

(정확히는 위상마다 길이가 16~17로 약간 다름)

#### 3) 절감 비율

$$
\text{reduction} = \frac{N_{\text{dir}}}{N_{\text{poly}}}
\approx \frac{1032}{136} \approx 7.59
$$

즉 **거의 D배 수준(≈8배)에 가까운 절감**을 얻는다.

---

## 문제 4. Polyphase 보간기의 위상 서브필터 출력이 왜 곧 y[n]인가

### (1) 상황

I=3 보간기에서 선형 위상 FIR \(h[n]\)을 I-phase polyphase로 분해했다.

### (2) 요구

1. $$u[mI+r]=\sum_\ell e_r[\ell]x[m-\ell]$$ 을 직접 유도하라.
2. 이것이 보간 구조에서 “서브필터 출력이 곧 특정 위상 출력”임을 의미함을 설명하라.

---

### 풀이

업샘플 후의 시퀀스 v[n]:

$$
v[n]=
\begin{cases}
x[m], & n=mI\\
0, & \text{else}
\end{cases}
$$

FIR 출력:

$$
u[n]=\sum_{k=0}^{M}h[k]v[n-k]
$$

이제 n을 위상으로 분해:

$$
n=mI+r,\quad r=0,1,\dots,I-1
$$

그러면

$$
u[mI+r]=\sum_{k=0}^{M}h[k]v[mI+r-k]
$$

v가 0이 아니려면

$$
mI+r-k = qI \quad(\exists q\in\mathbb{Z})
$$

즉

$$
k=r+I\ell
$$

형태만 기여한다. 따라서

$$
u[mI+r] = \sum_{\ell} h[r+I\ell]\,x[m-\ell]
$$

I-phase polyphase 정의

$$
e_r[\ell]=h[r+I\ell]
$$

를 대입하면

$$
u[mI+r]=\sum_\ell e_r[\ell]x[m-\ell]
$$

**해석**:
출력 시점이 r-위상이면
**e_r 서브필터만** 입력 x를 FIR 처리한 값이 바로 그 출력이다.
즉 “위상별 FIR bank + 커뮤테이터”가 보간기 구조가 된다.

---

## 문제 5. 유리수 I/D 변환에서 위상 선택 규칙 구하기

### (1) 상황

$$\frac{I}{D}=\frac{5}{3}$$
SRC를 polyphase bank로 구현한다.
I=5-phase 분해를 사용한다.

### (2) 요구

1. 출력 k번째에서 선택되는 위상 $$p_k$$ 를 수식으로 쓰고,
   k=0~9까지 p_k 값을 표로 구하라.
2. 위상 순환이 출력 주기에서 어떤 패턴을 만드는지 설명하라.

---

### 풀이

위상 선택 규칙:

$$
p_k = (kD)\bmod I
$$

여기서 D=3, I=5.

k=0~9:

| k | kD | p_k = (kD mod 5) |
|---|---:|---:|
| 0 | 0  | 0 |
| 1 | 3  | 3 |
| 2 | 6  | 1 |
| 3 | 9  | 4 |
| 4 | 12 | 2 |
| 5 | 15 | 0 |
| 6 | 18 | 3 |
| 7 | 21 | 1 |
| 8 | 24 | 4 |
| 9 | 27 | 2 |

패턴:

$$
0,\ 3,\ 1,\ 4,\ 2,\ 0,\ 3,\ 1,\ 4,\ 2,\dots
$$

이는 “출력마다 phase가 3씩 증가(mod 5)”하는 순환이며,
I와 D가 서로소이면 위상은 **모든 위상을 균일하게 순회**한다.

---

## 문제 6. 유리수 SRC를 직접 구현하고 resample()과 비교

### (1) 상황

샘플링률 44.1 kHz의 오디오를 48 kHz로 변환한다.
이는

$$
\frac{I}{D}=\frac{160}{147}
$$

유리수 변환이다.

### (2) 요구

1. I-phase polyphase bank로 SRC를 구현하라.
2. GNU Octave의 resample() 결과와 최대 오차를 비교하라.
3. 왜 I가 매우 큰데도 polyphase가 여전히 유리한지 설명하라.

---

### 풀이

#### 1) I/D

목표 비율:

$$
\frac{48}{44.1} = \frac{160}{147}
$$

따라서 I=160, D=147.

#### 2) 구현 전략(개념)

- h[n]을 I-phase로 분해: $$e_r[\ell]=h[r+I\ell]$$
- 출력 k마다 $$p_k=(kD)\bmod I$$ 위상 선택
- 입력 정수 위치 $$n_k=\lfloor kD/I\rfloor$$ 주변을 FIR로 보간

#### 3) 코드

```octave
pkg load signal; clear; close all; clc;

Fs_in = 44100; I = 160; D = 147; Fs_out = Fs_in*I/D;

% 테스트 입력: 혼합 톤
t = 0:1/Fs_in:0.1-1/Fs_in;
x = sin(2*pi*1000*t) + 0.4*sin(2*pi*8000*t);

% SRC용 FIR 설계(대역은 min(1/I,1/D)에 맞춰야 함)
Wcmax = min(1/I, 1/D);
Wp = 0.9*Wcmax; Ws = 1.1*Wcmax;
Rp = 0.01; As = 100;
[M,Wn,beta,ftype] = kaiserord([Wp Ws],[1 0],[Rp 10^(-As/20)]);
M = M + rem(M,2);
h = fir1(M, Wn, kaiser(M+1,beta));

% I-phase polyphase decomposition
E = cell(1,I);
for r=1:I
  E{r} = h(r:I:end);
end

% polyphase SRC
buflen = max(cellfun(@length,E));
buf = zeros(1, buflen);
p = 0; n_in = 1;
y = zeros(1, ceil(length(x)*I/D));

for k=1:length(y)
  p = mod(p + D, I);
  phase_idx = p + 1;
  n_req = floor((k-1)*D/I) + 1;

  while n_in <= n_req && n_in <= length(x)
    buf = [x(n_in), buf(1:end-1)];
    n_in += 1;
  end

  e = E{phase_idx};
  L = length(e);
  y(k) = I * sum(e .* buf(1:L));
end

% reference
y_ref = resample(x, I, D, h);

len = min(length(y), length(y_ref));
fprintf("Fs_out=%.3f Hz\n", Fs_out);
fprintf("max |y - y_ref| = %.3e\n", max(abs(y(1:len)-y_ref(1:len))));
```

#### 4) 왜 I가 커도 polyphase가 유리한가

- Direct Form에서는 (↑I)로 **샘플 수가 160배 증가**한 뒤
  그 모든 샘플을 FIR로 처리한다.
- Polyphase에서는 **출력 샘플마다 “단 하나의 위상 FIR”만** 호출한다.

I가 커질수록
Direct Form은 연산이 I배 폭증하지만
Polyphase는 **필터 길이만큼만** 증가한다.
따라서 I가 클수록 이득이 더 커진다.

---

## 문제 7. Half-band 필터를 이용한 2배 변환 구조 설계

### (1) 상황

48 kHz → 12 kHz로 내리려 한다.
즉 D=4 데시메이션.

### (2) 요구

1. 이를 (↓2) 두 번으로 분해하는 다단 구조를 제시하라.
2. 각 단계의 anti-alias 필터로 half-band FIR을 쓰는 이유를 설명하라.
3. half-band의 “계수 절반이 0” 성질이 Polyphase에서 어떤 연산 절감을 주는지 수식/그림으로 설명하라.

---

### 풀이

#### 1) 다단 분해

$$
\downarrow 4 = \downarrow 2 \; \circ\; \downarrow 2
$$

즉

```text
x ─▶ H1 ─▶ (↓2) ─▶ H2 ─▶ (↓2) ─▶ y
```

#### 2) half-band 사용 이유

2배 변환에서 이상적 컷오프는

$$
f_c = \frac{F_s}{4}
$$

half-band FIR은 정확히 이 조건에서

- 통과대역과 저지대역이 대칭
- 중간 주파수 $$\omega=\pi/2$$ 를 중심으로 구조적 단순화
- 선형 위상 + 특정 계수들이 0이 되도록 설계 가능

#### 3) 연산 절감

half-band의 계수 특성:

- 길이 L의 half-band FIR에서
  **홀수 인덱스 계수(중앙 제외)가 0**

즉

$$
h[2m+1]=0,\ \ m\neq \frac{L-1}{4}
$$

2-phase polyphase로 분해하면

- 한 위상 서브필터가 거의 0 계수만 가지므로
- 실제로는 **한 위상만 FIR 연산**하면 된다.

따라서 2× SRC에서
half-band polyphase는
**추가로 약 2배 절감**을 만든다.

---

## 문제 8. Polyphase Folding(대칭)으로 곱셈기 수 줄이기

### (1) 상황

I=5 보간용 FIR가 선형 위상(대칭)이라고 하자.
FIR 길이는 L=101.

### (2) 요구

1. Direct Form에서 대칭을 이용하면 곱셈기를 얼마로 줄일 수 있는가?
2. I-phase polyphase 서브필터들이 어떤 대칭 관계를 갖는지 설명하라.
3. 이 대칭을 이용해 polyphase 내부 곱셈기를 추가로 줄이는 아이디어를 서술하라.

---

### 풀이

#### 1) Direct Form에서의 folding

대칭:

$$
h[k]=h[L-1-k]
$$

출력:

$$
y[n]=\sum_{k=0}^{L-1} h[k]x[n-k]
$$

대칭 짝을 묶으면

$$
y[n]=\sum_{k=0}^{(L-1)/2} h[k]\,(x[n-k]+x[n-(L-1-k)])
$$

따라서 곱셈기 수는

$$
\frac{L+1}{2}=\frac{102}{2}=51
$$

#### 2) polyphase 서브필터의 대칭

I-phase 분해:

$$
e_r[m]=h[r+Im]
$$

원래 h가 대칭이면
e_r와 e_{I-1-r}가 **시간 반전된 쌍**으로 대응하는 경우가 많다.

직관적으로
“앞쪽 계수 집합”과 “뒤쪽 계수 집합”이 위상별로 짝을 이룬다.

#### 3) polyphase folding 아이디어

- e_r의 탭도 대칭이면 각 서브필터 내부에서 folding 적용
- 혹은 위상 쌍(e_r, e_{I-1-r})을 동시에 처리해
  공통 곱셈을 공유

결과적으로 polyphase에서도
**곱셈기 수가 약 2배 추가 감소**한다.

---

## 문제 9. 다단 SRC에서 단계별 컷오프/전이대역 설정

### (1) 상황

$$\frac{I}{D}=\frac{12}{5}$$ 변환을 해야 한다.
단일 단계 FIR는 너무 길다고 판단되어
다단으로 분해한다:

$$
\frac{12}{5}=\frac{3}{1}\cdot\frac{2}{5}\cdot\frac{2}{1}
$$

### (2) 요구

1. 이 분해를 해석해 단계별 구조를 그려라.
2. 각 단계 필터의 이상적 컷오프(정규화)를 구하라.
3. 왜 다단 분해가 탭 수를 줄이는지 전이대역 관점에서 설명하라.

---

### 풀이

#### 1) 구조

```text
Stage1: ↑3  + anti-imaging H1
Stage2: ↑2/↓5 + H2
Stage3: ↑2 + H3
```

#### 2) 단계별 이상적 컷오프

SRC 단계에서 이상적 컷오프는
그 단계의 I_k, D_k에 대해

$$
W_{c,k} = \min\left(\frac{1}{I_k}, \frac{1}{D_k}\right)
$$

- Stage1: I1=3, D1=1
  $$W_{c,1}=\min(1/3,1)=1/3$$
- Stage2: I2=2, D2=5
  $$W_{c,2}=\min(1/2,1/5)=1/5$$
- Stage3: I3=2, D3=1
  $$W_{c,3}=1/2$$

#### 3) 탭 수 감소 이유

단일 단계로 12/5 변환하면
최대 유효 대역은

$$
W_c=\min(1/12,1/5)=1/12
$$

매우 좁고
전이대역도 아주 좁아져
**필터 길이가 크게 증가**한다.

다단으로 나누면
각 단계는 더 넓은 컷오프를 가지므로
전이대역이 상대적으로 넓어지고
각 단계 탭 수의 합이 **단일 초장필터보다 훨씬 작아진다.**

---

## 문제 10. “나이브 구조로 하면 얼마를 낭비하는가?” 정량 계산

### (1) 상황

$$I/D=5/3$$ SRC용 FIR 길이가 L=150이라고 하자.

### (2) 요구

1. Direct Form(↑I → FIR → ↓D)로 구현 시
   입력 샘플 1개당 곱셈 수를 구하라.
2. 시간가변 polyphase 구조로 구현 시
   출력 샘플 1개당 곱셈 수를 구하라.
3. 대략적 절감 비율을 수치로 구하라.

---

### 풀이

#### 1) Direct Form

(↑I)로 샘플 수가 5배
따라서 입력 1개당 FIR 연산은
고속 시퀀스 기준으로 5개의 샘플이 생성되고
각 샘플마다 L번 곱셈:

$$
N_{\text{dir}} = I\cdot L = 5\cdot 150=750
$$

#### 2) Polyphase

I=5-phase 분해에서 서브필터 길이는

$$
L_r \approx L/I = 150/5=30
$$

출력 1개당 위상 서브필터 1개만 호출:

$$
N_{\text{poly}} \approx 30
$$

#### 3) 절감

$$
\frac{750}{30}=25
$$

즉 **약 25배 절감**.

---

## 문제 11. SRC FIR 구조에서 “지연(latency)” 계산

### (1) 상황

I-phase polyphase SRC에서
원 FIR 길이가 L=121(차수 120), 선형 위상이다.
I/D=3/2 변환을 수행한다.

### (2) 요구

1. 원 FIR의 군지연(group delay)을 샘플 단위로 구하라.
2. SRC 출력 샘플 기준 군지연(초 단위)을 구하라.
3. polyphase 구조가 지연을 바꾸는가? 이유를 설명하라.

---

### 풀이

#### 1) 원 FIR 군지연

선형 위상 FIR의 군지연:

$$
\tau = \frac{L-1}{2} = \frac{120}{2}=60\ \text{samples}
$$

입력 Fs 기준 시간지연:

$$
T_d=\frac{60}{F_s}
$$

#### 2) 출력 기준 시간지연

출력 Fs':

$$
F_s' = F_s\cdot \frac{I}{D} = F_s\cdot \frac{3}{2}
$$

시간지연은 물리적 시간으로 동일해야 하므로
출력 샘플 수로는

$$
\tau' = T_d\cdot F_s'
     = \frac{60}{F_s}\cdot F_s\frac{3}{2}
     = 60\cdot \frac{3}{2}=90\ \text{output samples}
$$

#### 3) polyphase가 지연을 바꾸나?

아니다.
polyphase는 **계산 순서/속도만 재배열**할 뿐
동일한 H(z)를 구현하므로
군지연은 시스템적으로 동일하다.

---

## 문제 12. 스트리밍 SRC에서 버퍼/상태 길이 결정

### (1) 상황

실시간 스트리밍 시스템에서
유리수 I/D SRC를 polyphase로 구현한다.
원 FIR 길이 L=257, I=7 phase를 사용한다.

### (2) 요구

1. polyphase 서브필터의 최대 길이를 구하라.
2. 스트리밍에서 필요한 입력 지연선(버퍼) 최소 길이를 구하라.
3. 위상 선택이 바뀌어도 버퍼 길이가 변하지 않는 이유를 설명하라.

---

### 풀이

#### 1) 서브필터 길이

I-phase 분해의 최대 길이:

$$
L_{\max}=\left\lceil\frac{L}{I}\right\rceil
= \left\lceil\frac{257}{7}\right\rceil
= \left\lceil 36.714 \right\rceil = 37
$$

#### 2) 입력 버퍼 길이

어떤 위상도 **최대 37개 입력 샘플을 참조**한다.
따라서 입력 delay-line은 최소

$$
37\ \text{samples}
$$

이상 필요하다.

#### 3) 위상 변화와 버퍼

위상은 “어떤 계수 집합을 쓰는가”만 결정한다.
참조되는 입력 시점은
항상 최근 샘플 주변 L_{\max} 범위 이내이므로
버퍼 길이는 위상과 무관하게 고정된다.

---

## 문제 13. 종합 구현 문제: 데시메이션+보간 체인 만들기

### (1) 상황

미국의 계측 장비에서
48 kHz 데이터를 16 kHz로 낮춘 다음(↓3),
다시 40 kHz로 올려야 한다(↑5/↓2).

전체 변환 비율은

$$
\frac{16}{48}\cdot \frac{40}{16}=\frac{40}{48}=\frac{5}{6}
$$

### (2) 요구

1. 전체 변환을 하나의 유리수 SRC(↑5/↓6)로 바꾸어라.
2. 단일 SRC와 두 단계 체인의 결과가 같음을 보이는 Octave 코드를 작성하라.
3. 단일 SRC가 두 단계 체인보다 유리한 조건/불리한 조건을 정리하라.

---

### 풀이

#### 1) 단일 SRC

전체 비율

$$
\frac{5}{6}
$$

따라서 I=5, D=6.

#### 2) Octave 검증

```octave
pkg load signal; clear; close all; clc;

Fs = 48000;

t = 0:1/Fs:0.05-1/Fs;
x = sin(2*pi*2000*t) + 0.5*sin(2*pi*9000*t);

% (A) two-stage: ↓3 then ↑5/↓2
yA1 = resample(x, 1, 3);      % 48 -> 16
yA  = resample(yA1, 5, 2);    % 16 -> 40

% (B) single-stage: ↑5/↓6
yB = resample(x, 5, 6);       % 48 -> 40

len = min(length(yA), length(yB));
fprintf("max |yA - yB| = %.3e\n", max(abs(yA(1:len)-yB(1:len))));
```

#### 3) 단일 vs 다단

- **단일 SRC 유리**
  - 전체 H(z)를 한 번만 적용 → 위상/버퍼 관리 단순
  - 지연이 작아질 수 있음(필터 하나)
- **다단 유리**
  - 각 단계 전이대역이 넓어져 탭 수 감소
  - half-band/정수 비율을 활용 가능
  - 큰 비율에서는 다단이 거의 필수

---

## 마무리 체크리스트(자가 점검)

1. 데시메이션은
   - $$F_N' = F_s/(2D)$$
   - **anti-alias 필수**
   - polyphase로 **D배 절감**

2. 보간은
   - 이미지가 $$kF_s/I$$ 근처에 생김
   - cutoff는 고속 기준 $$1/I$$
   - polyphase로 **I배 절감**

3. 유리수 SRC는
   - $$p_k=(kD)\bmod I$$
   - **시간가변 polyphase bank 호출**
   - Direct Form 대비 **I배 이상 절감**

4. 구조 고급화
   - 선형 위상 대칭 folding
   - half-band
   - 다단
   - FFT 블록 FIR

이 문제들을 모두 손으로 정리하고
코드를 직접 돌려보면
샘플링률 변환의 “원리→사양→구조→실장” 흐름이 완전히 연결된다.
